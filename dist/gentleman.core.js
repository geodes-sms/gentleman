/*! For license information please see gentleman.core.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Gentleman=t():e.Gentleman=t()}(self,(function(){return(()=>{"use strict";var e={835:(e,t,i)=>{function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function c(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?w(e)?t:e:x(e)?t:e}function d(e){return g(e)&&0===e.length}function u(e){return e instanceof Date||"object"===s(e)&&"[object Date]"===Object.prototype.toString.call(e)}function m(e){return"string"==typeof e||e instanceof String}function p(e){return"function"==typeof e}function f(e){return!x(e)&&"object"===s(e)}function g(e){return!x(e)&&"function"==typeof e[Symbol.iterator]}function v(e){return g(e)&&!m(e)}function b(e){return null===e}function y(e){return!e||m(e)&&(0===e.length||/^\s*$/.test(e))}function w(e){return void 0===e}function x(e){return b(e)||w(e)}function E(e,t,i){if(!Array.isArray(e)||!Number.isInteger(t))throw new TypeError("Bad argument");return e.splice(t,0,i),e.length}function A(e){if(!Array.isArray(e))throw new TypeError("Bad argument");if(!d(e))return e[e.length-1]}function O(e){if(!Array.isArray(e))throw new TypeError("Bad argument");return e[0]}i.r(t),i.d(t,{Accordion:()=>As,Collapsible:()=>Es,DELETE:()=>k,GET:()=>C,POST:()=>L,PUT:()=>S,Selector:()=>ts,SelectorFactory:()=>is,Switch:()=>ds,addAttributes:()=>Ue,addPath:()=>ae,all:()=>Q,appendChildren:()=>Se,assert:()=>J,boolToInt:()=>Z,camelCase:()=>q,capitalize:()=>$,capitalizeFirstLetter:()=>F,changeSelectValue:()=>He,cloneObject:()=>_,cloneTemplate:()=>Ei,compareTime:()=>M,copytoClipboard:()=>ki,createAbbreviation:()=>Vt,createAnchor:()=>gt,createArea:()=>vt,createArticle:()=>qe,createAside:()=>Ze,createAudio:()=>wt,createB:()=>Bt,createBase:()=>bt,createBlockQuotation:()=>ot,createButton:()=>ri,createCaption:()=>li,createCite:()=>$t,createCode:()=>zt,createDataList:()=>ti,createDeletedPart:()=>Ut,createDescriptionDetails:()=>ft,createDescriptionList:()=>mt,createDescriptionTerm:()=>pt,createDiv:()=>it,createDocFragment:()=>Pe,createEmbed:()=>nt,createEmphasis:()=>St,createFieldset:()=>Qt,createFigure:()=>Nt,createFigureCaption:()=>jt,createFooter:()=>ze,createForm:()=>Wt,createH1:()=>Ge,createH2:()=>Je,createH3:()=>Ke,createH4:()=>Qe,createH5:()=>et,createH6:()=>tt,createHeader:()=>Fe,createI:()=>Pt,createImage:()=>yt,createInput:()=>qt,createInsertedPart:()=>Ht,createLabel:()=>Yt,createLegend:()=>ei,createLineBreak:()=>rt,createLink:()=>_e,createListItem:()=>ut,createMain:()=>We,createMark:()=>kt,createMeter:()=>ii,createNav:()=>Ye,createObject:()=>st,createOption:()=>Gt,createOptionGroup:()=>Kt,createOrderedList:()=>dt,createOutput:()=>ni,createParagraph:()=>lt,createPicture:()=>Ot,createProgress:()=>si,createQuote:()=>Dt,createS:()=>Rt,createSample:()=>Tt,createSection:()=>Xe,createSelect:()=>Zt,createSource:()=>Et,createSpan:()=>Ct,createStrong:()=>Lt,createSubscript:()=>Mt,createSuperscript:()=>It,createTable:()=>ai,createTableBody:()=>ci,createTableCell:()=>gi,createTableColumn:()=>ui,createTableColumnGroup:()=>mi,createTableFooter:()=>di,createTableHeader:()=>hi,createTableHeaderCell:()=>fi,createTableRow:()=>pi,createTemplate:()=>$e,createTextArea:()=>Xt,createTextNode:()=>Re,createThematicBreak:()=>at,createTime:()=>Ft,createTrack:()=>At,createU:()=>_t,createUnorderedList:()=>ct,createVideo:()=>xt,fetchWithTimeout:()=>T,findAncestor:()=>ji,findByPath:()=>ce,first:()=>O,floatingLabel:()=>Ii,formatCase:()=>W,formatDate:()=>U,getDir:()=>le,getDirTarget:()=>oe,getElement:()=>yi,getElements:()=>wi,getNextElementSibling:()=>Ni,getPreviousElementSibling:()=>Oi,getRootUrl:()=>Ns,getTemplate:()=>xi,getUrlParams:()=>js,hasOwn:()=>P,htmlToElement:()=>Ee,htmlToElements:()=>Ae,inputCounter:()=>Ui,insert:()=>E,insertAfterElement:()=>Ce,insertBeforeElement:()=>je,isCollection:()=>v,isDate:()=>u,isDerivedOf:()=>R,isDocumentFragment:()=>we,isElement:()=>ge,isEmpty:()=>d,isFunction:()=>p,isHTMLCollection:()=>ye,isHTMLElement:()=>ve,isInElement:()=>Ne,isInViewport:()=>Oe,isIterable:()=>g,isNode:()=>pe,isNodeList:()=>fe,isNull:()=>b,isNullOrUndefined:()=>x,isNullOrWhitespace:()=>y,isObject:()=>f,isString:()=>m,isUndefined:()=>w,last:()=>A,lone:()=>ie,no:()=>te,one:()=>ee,pascalCase:()=>X,preprendChild:()=>Le,queryBuilder:()=>Cs,random:()=>ne,removeAccents:()=>Y,removeChildren:()=>Si,resolveDate:()=>I,shortDate:()=>H,shortDateTime:()=>D,some:()=>K,toBoolean:()=>G,valOrDefault:()=>c,windowHeight:()=>ue,windowWidth:()=>de});var N={OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,UnsupportedMediaType:415,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavaible:503,GatewayTimeout:504},j=function(e,t,i,s,n,r){var a=new XMLHttpRequest;return a.onreadystatechange=function(){var e;if(4===a.readyState){var t=function(e,t){return{status:e,message:t}}(a.status,a.responseText);i(a.status)?e=s:(e=n,a.status>=200&&a.status<300&&p(r)&&(e=r)),p(e)&&e(t)}},a.open(e,t,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a};function C(e,t,i,s){var n=(s=c(s,{})).successPred,r=p(n)?n:function(e){return e===N.OK};j("GET",e,r,t,i,s.pass).send()}function L(e,t,i,s,n){var r=(n=c(n,{})).successPred,a=p(r)?r:function(e){return[N.OK,N.Created].includes(e)};j("POST",e,a,i,s,n.pass).send(t)}function S(e,t,i,s,n){var r=(n=c(n,{})).successPred,a=p(r)?r:function(e){return[N.OK,N.NoContent].includes(e)};j("PUT",e,a,i,s,n.pass).send(t)}function k(e,t,i,s,n){var r=(n=c(n,{})).successPred,a=p(r)?r:function(e){return[N.OK,N.Accepted,N.NoContent].includes(e)};j("DELETE",e,a,i,s,n.pass).send(t)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,s=new AbortController,n=a(a({},t),{},{signal:s.signal});return setTimeout((function(){s.abort()}),i),fetch(e,n).then((function(e){if(!e.ok)throw new Error("".concat(e.status,": ").concat(e.statusText));return e})).catch((function(e){if("AbortError"===e.name)throw new Error("Response timed out");throw new Error(e.message)}))}function M(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";if(x(e)||x(t)||!e.includes(i)||!t.includes(i))return null;var s=e.split(i),n=t.split(i);if(+s[0]>+n[0])return 1;if(+s[0]<+n[0])return-1;if(+s[1]>+n[1])return 1;if(+s[1]<+n[1])return-1;if(s.length==n.length&&3==s.length){if(+s[2]>+n[2])return 1;if(+s[2]<+n[2])return-1}return 0}function I(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(x(e))return new Date;if(u(e))return e;var i=new Date(e),s=i.getTime();return Number.isNaN(s)?new Date:t?new Date(s+6e4*i.getTimezoneOffset()):i}function U(e,t){var i=e.getDate(),s=e.getMonth()+1,n=e.getFullYear().toString(),r=e.getHours(),a=e.getMinutes(),l=e.getSeconds(),o=function(e){return e<10?"0".concat(e):e};return t.replace("yyyy",n).replace("yy",n.slice(-2)).replace("mm",o(s)).replace("m",s).replace("dd",o(i)).replace("d",i).replace("hh",o(r)).replace("h",r).replace("MM",o(a)).replace("M",a).replace("ss",o(l)).replace("s",l)}function H(e){return U(I(e),"yyyy-mm-dd")}function D(e){return U(I(e,!1),"yyyy-mm-dd hh:MM")}var V=Object.prototype.hasOwnProperty,B=Object.prototype.isPrototypeOf,P=function(e,t){return V.call(e,t)},R=function(e,t){return Object.getPrototypeOf(e)!==t&&B.call(t,e)};function _(e){if(x(e)||!f(e))return e;var t=e.constructor();for(var i in e)P(e,i)&&(e.isActiveClone=null,t[i]=_(e[i]),delete e.isActiveClone);return t}function $(e){return y(e)?e:e.toLowerCase().replace(/\b\w/g,(function(e){return e.toUpperCase()}))}function F(e){return y(e)?e:e.charAt(0).toUpperCase()+e.slice(1)}var z={camel:function(e){return q(e)},pascal:function(e){return X(e)},upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()}};function W(e,t){return y(e)?e:P(z,t)?z[t](e):e}function q(e){if(y(e))return e;var t=X(e);return t.charAt(0).toLowerCase()+t.slice(1)}function X(e){return y(e)?e:$(e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim()).replace(/\s+/g,"")}function Y(e){return String.prototype.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e.replace(/[àâäæ]/gi,"a").replace(/[ç]/gi,"c").replace(/[éèê]/gi,"e").replace(/[îï]/gi,"i").replace(/[ôœ]/gi,"o").replace(/[ùûü]/gi,"u")}function Z(e){return e?1:0}function G(e){var t=c(e,!1);return m(t)&&"true"===t.toLowerCase()||Number.isInteger(t)&&1===t||!0===t}var J=function(e,t,i,s){if(!Array.isArray(e)||!p(t))throw new TypeError("Bad argument");var n=se(e,t);if(Q([i,s],Number.isInteger)){if(s<i)throw new Error("Bad argument: max must be greater than min");return n>=i&&n<=s}return Number.isInteger(i)?n>=i:Number.isInteger(s)?n<=s:n>0},K=function(e,t){if(!Array.isArray(e)||!p(t))throw new TypeError("Bad argument");for(var i=0;i<e.length;i++){var s=e[i];if(t.apply(void 0,l(Array.isArray(s)?s:[s])))return!0}return!1},Q=function(e,t){if(!Array.isArray(e)||!p(t))throw new TypeError("Bad argument");for(var i=0;i<e.length;i++){var s=e[i];if(!t.apply(void 0,l(Array.isArray(s)?s:[s])))return!1}return!0},ee=function(e,t){if(!Array.isArray(e)||!p(t))throw new TypeError("Bad argument");return 1===se(e,t)},te=function(e,t){if(!Array.isArray(e)||!p(t))throw new TypeError("Bad argument");return 0===se(e,t)},ie=function(e,t){if(!Array.isArray(e)||!p(t))throw new TypeError("Bad argument");return se(e,t)<=1};function se(e,t){for(var i=0,s=0;s<e.length;s++){var n=e[s];t.apply(void 0,l(Array.isArray(n)?n:[n]))&&i++}return i}function ne(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Number.isInteger(e))throw new TypeError("Bad argument");if(Number.isInteger(t)||(t=e,e=0),t<e)throw new Error("Bad argument: max must be greater than min");return e+Math.floor((i?re():Math.random())*(t-e+1))}function re(){return window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295}function ae(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return y(e)?t:"".concat(e).concat(i).concat(t)}function le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return e.substring(0,e.lastIndexOf(t))}function oe(e,t){return e.substring(0,e.lastIndexOf(t)-1)}function he(e,t,i){var s=+t[0].match(/\d+/g);return e[i][s]}function ce(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",s=/\[\d+\]/g,n=_(e),r=function(e,t,i){var s=e.match(t),r=e.substring(0,e.indexOf("["));return i(n,s,r)},a=t.split(i),l=0,o=a.length;l<o;l++){var h=a[l];if(x(n=s.test(h)?r(h,s,he):n[h]))return}return n}var de=function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},ue=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},me=function(e){return!x(e)&&e.nodeType===Node.ELEMENT_NODE},pe=function(e){return e instanceof Node},fe=function(e){return e instanceof NodeList},ge=function(e){return me(e)&&e instanceof Element},ve=function(e,t){return!!(me(e)&&e instanceof HTMLElement)&&(!g(t)||(i=e,s=Array.isArray(t)?t:[t],n=function(e){return i instanceof e},r=function(e){return i.tagName===e.toUpperCase()},a=function(e){return Array.isArray(e)?e.includes(i.type):i.type===e},s.some((function(e){if(!g(e))return!1;var t=e,i=null;if(Array.isArray(e)){var s=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,n=!1,r=void 0;try{for(var a,l=e[Symbol.iterator]();!(s=(a=l.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){n=!0,r=e}finally{try{s||null==l.return||l.return()}finally{if(n)throw r}}return i}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2);t=s[0],i=s[1]}t=t.toLowerCase();var l="HTML".concat(P(be,t)?be[t]:X(t),"Element");return!(!n(window[l])&&!r(t))&&(!(v(i)&&!d(i))||a(i))}))));var i,s,n,r,a},be={a:"Anchor",br:"BR",dl:"DList",datalist:"DataList",fieldset:"FieldSet",frameset:"FrameSet",hr:"HR",h1:"Heading",h2:"Heading",h3:"Heading",h4:"Heading",h5:"Heading",h6:"Heading",li:"LI",ol:"OList",optgroup:"OptGroup",p:"Paragraph",q:"Quote",blockquote:"Quote",caption:"TableCaption",td:"TableCell",th:"TableCell",col:"TableCol",tr:"TableRow",tbody:"TableSection",thead:"TableSection",tfoot:"TableSection",textarea:"TextArea",ul:"UList"},ye=function(e){return e instanceof HTMLCollection},we=function(e){return function(e){return!x(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(e)&&e instanceof DocumentFragment};function xe(e,t){if(!m(t))return null;var i=document.createElement("template");return i.innerHTML=t.trim(),i.content[e]}var Ee=xe.bind(null,"firstChild"),Ae=xe.bind(null,"childNodes");function Oe(e){if(!ve(e))throw new Error("The given element is not a valid HTML Element");var t=e.getBoundingClientRect(),i=t.top,s=t.right,n=t.bottom,r=t.left;return i>=0&&r>=0&&n<=ue()&&s<=de()}function Ne(e,t){if(!Q([e,t],ve))throw new Error("The given element is not a valid HTML Element");var i=e.getBoundingClientRect(),s=i.top,n=i.right,r=i.bottom,a=i.left,l=t.getBoundingClientRect(),o=l.top,h=l.right,c=l.bottom,d=l.left;return Q([[o,s],[d,a],[n,h],[r,c]],(function(e,t){return e<=t}))}function je(e,t){if(!Q([e,t],ge))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return e.insertAdjacentElement("beforebegin",t),e}function Ce(e,t){if(!Q([e,t],ge))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return e.insertAdjacentElement("afterend",t),e}function Le(e,t){if(!Q([e,t],ge))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return e.insertAdjacentElement("afterbegin",t),e}function Se(e,t){if(!pe(e))throw new TypeError("Bad argument: The given `parent` is not a valid Node");if(!ye(t)&&!v(t))throw new TypeError("Bad argument: The given `children` is not a valid HTMLCollection/HTMLElement array");var i=we(e)?e:document.createDocumentFragment();return Array.from(t).forEach((function(e){var t;x(e)||i.appendChild(pe(e)?e:(t=e.toString(),document.createTextNode(t.toString())))})),e!==i&&e.appendChild(i),e}function ke(e,t,i){e[t]=i}function Te(e,t,i){e.setAttribute(t,i)}var Me="accesskey,autocapitalize,class,dataset,editable,draggable,hidden,id,inputmode,lang,html,style,tabindex,text,title",Ie={accesskey:[ke,"accessKey"],autocapitalize:[ke,"autocapitalize"],class:[function(e,t){var i;if(!ve(e))throw new Error("Bad argument: The passed `element` argument is not a valid HTML Element");return(i=e.classList).add.apply(i,l(Array.isArray(t)?t:[t])),e}],dataset:[function(e,t,i){Object.assign(e[t],i)},"dataset"],draggable:[ke,"draggable"],editable:[ke,"contentEditable"],hidden:[ke,"hidden"],id:[ke,"id"],inputmode:[ke,"inputMode"],lang:[ke,"lang"],html:[ke,"innerHTML"],style:[ke,"style"],tabindex:[ke,"tabIndex"],text:[ke,"textContent"],title:[ke,"title"],data:[ke,"data"],cite:[ke,"cite"],download:[ke,"download"],ping:[ke,"ping"],target:[ke,"target"],coords:[ke,"coords"],shape:[ke,"shape"],autoplay:[ke,"autoplay"],buffered:[ke,"buffered"],controls:[ke,"controls"],loop:[ke,"loop"],muted:[ke,"muted"],playsinline:[Te,"playsinline"],poster:[ke,"poster"],preload:[ke,"preload"],crossorigin:[ke,"crossOrigin"],decoding:[ke,"decoding"],height:[ke,"height"],ismap:[ke,"isMap"],loading:[ke,"loading"],srcset:[ke,"srcset"],width:[ke,"width"],alt:[ke,"alt"],as:[ke,"as"],media:[ke,"media"],rel:[ke,"rel"],src:[ke,"src"],sizes:[ke,"sizes"],reversed:[ke,"reversed"],start:[ke,"start"],accept:[ke,"accept"],"accept-charset":[ke,"acceptCharset"],action:[ke,"action"],autocomplete:[ke,"autocomplete"],autofocus:[ke,"autofocus"],capture:[ke,"capture"],checked:[ke,"checked"],cols:[ke,"cols"],disabled:[ke,"disabled"],dirname:[ke,"dirName"],enctype:[ke,"enctype"],for:[ke,"for"],form:[ke,"form"],formaction:[ke,"formAction"],formenctype:[ke,"formEnctype"],formmethod:[ke,"formMethod"],formnovalidate:[ke,"formNoValidate"],formtarget:[ke,"formTarget"],high:[ke,"high"],label:[ke,"label"],list:[ke,"list"],low:[ke,"low"],max:[ke,"max"],maxlength:[ke,"maxLength"],method:[ke,"method"],min:[ke,"min"],minlength:[ke,"minLength"],multiple:[ke,"multiple"],name:[ke,"name"],novalidate:[ke,"noValidate"],optimum:[ke,"optimum"],pattern:[ke,"pattern"],placeholder:[ke,"placeholder"],readonly:[ke,"readOnly"],required:[ke,"required"],rows:[ke,"rows"],selected:[ke,"selected"],size:[ke,"size"],spellcheck:[Te,"spellcheck"],step:[ke,"step"],wrap:[ke,"wrap"],default:[ke,"default"],kind:[ke,"kind"],srclang:[ke,"srclang"],abbr:[ke,"abbr"],colspan:[ke,"colSpan"],span:[ke,"span"],rowspan:[ke,"rowSpan"],scope:[ke,"scope"],href:[ke,"href"],hreflang:[ke,"hreflang"],datetime:[ke,"dateTime"],type:[ke,"type"],value:[ke,"value"],usemap:[ke,"useMap"]};function Ue(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!ve(e))throw new Error("Bad argument: The given element argument is not a valid HTML Element");if(!f(t))return e;for(var s=function(e){return Me.includes(e)||i.includes(e)},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if(s(a)){var o=t[a],h=Ie[a].slice(0),c=h.shift();c.apply(void 0,[e].concat(l(h),[o]))}}return e}function He(e,t){if(!ve(e,"select"))throw new Error("Bad argument: The given select argument is not a valid HTML Select element");if(x(t))throw new Error("The given value parameter is a null or undefined");for(var i=e.options,s=0;s<i.length;s++){var n=i[s];if(n.value===t.toString())return n.selected=!0,!0}return!1}function De(e,t,i){var s=document.createElement(e);return ve(s)?(f(i)&&Ue(s,i,c(t,"")),s):null}function Ve(e,t,i,s){var n=De(e,t,i);return ve(n)?(x(s)||vi(n,s),n):null}function Be(e,t,i,s,n){var r=De(e,t,s);return ve(r)?(x(n)||vi(r,n,i),r):null}function Pe(e){var t=document.createDocumentFragment();return x(e)||vi(t,e),t}var Re=function(e){return document.createTextNode(e)},_e=De.bind(null,"link","as,crossorigin,disabled,href,hreflang,media,rel,sizes,type"),$e=Ve.bind(null,"template",""),Fe=Ve.bind(null,"header",""),ze=Ve.bind(null,"footer",""),We=Ve.bind(null,"main",""),qe=Ve.bind(null,"article",""),Xe=Ve.bind(null,"section",""),Ye=Ve.bind(null,"nav",""),Ze=Ve.bind(null,"aside",""),Ge=Ve.bind(null,"h1",""),Je=Ve.bind(null,"h2",""),Ke=Ve.bind(null,"h3",""),Qe=Ve.bind(null,"h4",""),et=Ve.bind(null,"h5",""),tt=Ve.bind(null,"h6",""),it=Ve.bind(null,"div",""),st=Ve.bind(null,"object","data,height,name,type,usemap,width"),nt=De.bind(null,"embed","height,src,type,width"),rt=De.bind(null,"br",""),at=De.bind(null,"hr",""),lt=Ve.bind(null,"p",""),ot=Ve.bind(null,"blockquote","cite"),ht=function(e){return ve(e,"li")?e:ut(null,e)},ct=Be.bind(null,"ul","",ht),dt=Be.bind(null,"ol","reversed,start,type",ht),ut=Ve.bind(null,"li","value"),mt=Ve.bind(null,"dl",""),pt=Ve.bind(null,"dt",""),ft=Ve.bind(null,"dd",""),gt=Ve.bind(null,"a","download,href,hreflang,ping,rel,target,type"),vt=De.bind(null,"area","alt,coords,download,href,hreflang,media,ping,rel,shape,target"),bt=De.bind(null,"base","href,target"),yt=De.bind(null,"img","alt,crossorigin,decoding,height,ismap,loading,sizes,src,srcset,usemap,width"),wt=Ve.bind(null,"audio","autoplay,controls,crossorigin,loop,muted,preload,src"),xt=Ve.bind(null,"video","autoplay,controls,crossorigin,height,loop,muted,playsinline,poster,preload,src,width"),Et=De.bind(null,"source","media,sizes,src,srcset,type"),At=De.bind(null,"track","default,kind,label,src,srclang"),Ot=Ve.bind(null,"picture",""),Nt=Ve.bind(null,"figure",""),jt=Ve.bind(null,"figcaption",""),Ct=Ve.bind(null,"span",""),Lt=Ve.bind(null,"strong",""),St=Ve.bind(null,"em",""),kt=Ve.bind(null,"mark",""),Tt=Ve.bind(null,"samp",""),Mt=Ve.bind(null,"sub",""),It=Ve.bind(null,"sup",""),Ut=Ve.bind(null,"del","cite,datetime"),Ht=Ve.bind(null,"ins","cite,datetime"),Dt=Ve.bind(null,"q","cite"),Vt=Ve.bind(null,"abbr",""),Bt=Ve.bind(null,"b",""),Pt=Ve.bind(null,"i",""),Rt=Ve.bind(null,"s",""),_t=Ve.bind(null,"u",""),$t=Ve.bind(null,"cite",""),Ft=Ve.bind(null,"time","datetime"),zt=Ve.bind(null,"code",""),Wt=Ve.bind(null,"form","accept-charset,action,autocomplete,enctype,method,name,novalidate,rel,target"),qt=De.bind(null,"input","accept,alt,autocomplete,autofocus,capture,checked,dirname,disabled,height,max,maxlength,minlength,min,multiple,name,pattern,placeholder,readonly,required,size,src,step,type,value,width"),Xt=Ve.bind(null,"textarea","autocomplete,autofocus,cols,disabled,maxlength,minlength,name,placeholder,readonly,required,rows,spellcheck,value,wrap"),Yt=Ve.bind(null,"label","for"),Zt=Be.bind(null,"select","autocomplete,autofocus,disabled,multiple,name,required,size",(function(e){return ve(e,["option","optgroup"])?e:Array.isArray(e)?Kt(null,e):Gt(null,e)})),Gt=Ve.bind(null,"option","disabled,label,selected,value"),Jt=function(e){return ve(e,"option")?e:Gt(null,e)},Kt=Be.bind(null,"optgroup","disabled,label",Jt),Qt=Ve.bind(null,"fieldset","disabled,name"),ei=Ve.bind(null,"legend",""),ti=Be.bind(null,"datalist","",Jt),ii=Ve.bind(null,"meter","high,low,max,min,optimum,value"),si=Ve.bind(null,"progress","max,value"),ni=Ve.bind(null,"output","name,value"),ri=Ve.bind(null,"button","autofocus,disabled,formaction,formenctype,formmethod,formnovalidate,formtarget,name,type,value"),ai=Ve.bind(null,"table",""),li=Ve.bind(null,"caption",""),oi=function(e){return ve(e,"tr")?e:pi(null,e)},hi=Be.bind(null,"thead","",oi),ci=Be.bind(null,"tbody","",oi),di=Be.bind(null,"tfoot","",oi),ui=De.bind(null,"col","span"),mi=Be.bind(null,"colgroup","span",(function(e){return ve(e,"col")?e:null})),pi=Be.bind(null,"tr","",(function(e){return ve(e,["th","td"])?e:gi(null,e)})),fi=Ve.bind(null,"th","abbr,colspan,rowspan,scope"),gi=Ve.bind(null,"td","colspan,rowspan");function vi(e,t,i){var s=Array.isArray(t)?t:[t];return p(i)&&(s=s.map((function(e){return i(e)}))),Se(e,s),e}var bi=function(e){return/^\.[a-zA-Z0-9_-]+$/.test(e)};function yi(e,t){var i=c(t,document);return y(e)?null:we(i)?i.querySelector(e):function(e){return/^#[a-zA-Z0-9_-]+$/.test(e)}(e)?document.getElementById(e.substring(1)):bi(e)?i.getElementsByClassName(e.substring(1))[0]:i.querySelector(e)}function wi(e,t){var i=c(t,document);return y(e)?null:we(i)?i.querySelectorAll(e):bi(e)?i.getElementsByClassName(e.substring(1)):i.querySelectorAll(e)}function xi(e,t){return"content"in document.createElement("template")?yi(e,t):null}function Ei(e,t){return e?document.importNode(e.content,c(t,!0)):e}function Ai(e,t,i){if(!ve(t))return null;var s=t[e];if(p(i))for(;ge(s)&&!i(s);)s=s[e];return s}var Oi=Ai.bind(null,"previousElementSibling"),Ni=Ai.bind(null,"nextElementSibling");function ji(e,t,i){if(!ge(e))throw new TypeError("Bad argument: The given target parameter is not a valid HTML Element");if(!p(t))throw new TypeError("Bad argument: The given pred parameter is not a valid Function");var s=e.parentElement;return i>0?Li(s,t,i-1):Ci(s,t)}function Ci(e,t){return x(e)?null:t(e)?e:Ci(e.parentElement,t)}function Li(e,t,i){return x(e)||0===i?null:t(e)?e:Li(e.parentElement,t,i-1)}function Si(e,t){if(!pe(e))throw new TypeError("Bad argument: The given `node` is not a valid Node");return p(t)?(Array.from(e.childNodes).forEach((function(i){t(i)&&e.removeChild(i)})),e):function(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild);return e}(e)}function ki(e){if(x(e))return!1;var t=Xt({value:ve(e)?e.textContent:e.toString(),readonly:!0});return!!ve(t)&&(document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),!0)}var Ti=function(e){return e.classList.add("down")},Mi=function(e){return e.classList.remove("down")};function Ii(e){for(var t=wi(".form-label",e),i=0;i<t.length;i++){var s=t[i];if("placeholder"==s.dataset.type&&!y(s.htmlFor)){var n=yi("#".concat(s.htmlFor));ve(n)?y(n.placeholder)?(r(n,s),d(n.value)&&Ti(s)):console.warn('%c@zenkai%c #FloatingLabel>%cfloatingLabel:%c Input "'.concat(s.htmlFor,'" contains a placeholder'),"text-decoration: underline","","font-weight: bold;","font-weight: normal;"):console.error('%c@zenkai%c #FloatingLabel>%cfloatingLabel:%c Missing input for label "'.concat(s.htmlFor,'"'),"text-decoration: underline","","font-weight: bold;","font-weight: normal;")}}function r(e,t){y(e.placeholder)&&(e.addEventListener("focus",(function(i){e.placeholder="",Mi(t),t.parentElement.classList.add("focused")})),e.addEventListener("blur",(function(e){d(this.value)&&Ti(t),t.parentElement.classList.remove("focused")})),e.addEventListener("input",(function(i){document.activeElement!=e&&(d(this.value)?Ti(t):Mi(t))})))}return t}function Ui(e){for(var t=wi("[data-counter]",e),i=0;i<t.length;i++){var s=t[i],n=s.dataset.counter,r=yi("#".concat(n));ve(r)?(s.dataset.counterMax=r.maxLength,s.dataset.counterVal=r.value.length,a(r,s)):console.error("%c@zenkai%c #InputCounter>%cinputCounter:%c Failed to add counter ".concat(n,". Input (referenced) was not found."),"text-decoration: underline","","font-weight: bold;","font-weight: normal;")}function a(e,t){e.addEventListener("input",(function(i){t.dataset.counterVal=e.value.length}))}return t}var Hi=function(e){return e.dataset.type},Di=function(e){return e.dataset.state},Vi=function(e,t){return e.dataset.state=t},Bi=function(e,t){return Vi(e,c(t,"checked"))},Pi=function(e,t){return Vi(e,c(t,"unchecked"))};function Ri(e,t,i){if(ve(e))return t(e)?[e]:wi(i,e);if(m(e)&&!d(e)){var s=yi(e);return x(s)?null:Ri(s)}return x(e)?wi(i):null}function _i(e,t){return y(t.htmlFor)?yi("input[type='".concat(c(e,"text"),"']"),t):yi("#".concat(t.htmlFor))}var $i="on",Fi={init:function(e){return Object.assign(this,e),this.isChecked()&&Bi(this.container,$i),this},container:null,index:null,get value(){return this.container.dataset.value},isChecked:function(){return Di(this.container)===$i},setChecked:function(e){return!x(e)&&(e?Bi(this.container,$i):Pi(this.container,"off"),!0)}},zi={name:"selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return b(this.selectedItem)&&!b(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=t.target;if(P(i.dataset,"selector")){var s=!1;if(p(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),!s){var n=e.items.find((function(e){return e.index===+c(i.dataset.selectorIndex,-1)}));x(n)||(e.setSelectedItem(n),p(e.afterChange)&&e.afterChange(e,t))}}}))}},Wi={init:function(e){return Object.assign(this,e),this.isChecked()&&Bi(this.container,"on"),this},container:null,input:null,index:null,get value(){return this.input.value},isChecked:function(){return this.input.checked},setChecked:function(e){return!x(e)&&(e?(this.input.checked=!0,Bi(this.container,"on")):(this.input.checked=!1,Pi(this.container,"off")),!0)}},qi={name:"form-selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return b(this.selectedItem)&&!b(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("change",(function(t){var i=t.target,s=!1;if(p(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),s)return i.checked=!1,void e.items[e.selectedIndex].setChecked(!0);var n=e.items.find((function(e){return e.index===+c(i.dataset.selectorIndex,-1)}));x(n)||(e.setSelectedItem(n),p(e.afterChange)&&e.afterChange(e,t))}))}},Xi="BAD_CONTAINER",Yi=function(e){return'[data-type="'.concat(e.name,'"]')},Zi={BaseSelector:Yi(zi),FormSelector:Yi(qi)},Gi={create:function(e,t){if(!ve(e))return Xi;var i=wi("[data-selector]",e);if(!fe(i))return Xi;var s=null,n=null,r=Hi(e);switch(r){case"selector":n=Ji(i,r,!1),s=Object.create(zi);break;case"form-selector":n=Ji(i,r,!0),s=Object.create(qi)}return Object.assign(s,t,{container:e,items:n,querySelector:Yi(s)}),s}};function Ji(e,t,i){for(var s=[],n={selector:function(){return Object.create(Fi)},"form-selector":function(){return Object.create(Wi)}},r=0;r<e.length;r++){var a=e[r];a.dataset.selectorIndex=r;var l={container:a,index:r};if(i){var o=_i("radio",a);if(!ve(o))return"BAD_INPUT";o.dataset.selectorIndex=r,Object.assign(l,{input:o})}var h=n[t]().init(l);s.push(h)}return s}var Ki={BAD_CONTAINER:new Error("Missing container: A selector requires a container"),BAD_INPUT:new Error("Missing input: FormSelector requires an input in the container")},Qi=function(e){return RegExp("selector|form-selector").test(e.dataset.type)},es=[Zi.BaseSelector,Zi.FormSelector].join(",");function ts(e,t){var i=Ri(e,Qi,es),s=c(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=Gi.create(i[r],s);if(P(Ki,a))throw Ki[a];a.init(),n.push(a)}return n}var is=Gi,ss={BAD_CONTAINER:new Error("Missing container: A switch requires a container"),BAD_INPUT:new Error("Missing input: FormSwitch requires an input in the container")},ns="on",rs=function(e){return'[data-type="'.concat(e.name,'"]')},as=function(e){return RegExp("switch|form-switch").test(e.dataset.type)},ls=function(e,t){if(!ve(e))return"BAD_CONTAINER";var i=null,s=null;switch(Hi(e)){case"switch":i=Object.create(os);break;case"form-switch":if(s=_i("checkbox",e),!ve(s))return"BAD_INPUT";t.input=s,i=Object.create(hs)}return Object.assign(i,t,{container:e,querySelector:rs(i)}),i},os={name:"switch",container:null,beforeChange:null,afterChange:null,get value(){return this.container.dataset.value},isChecked:function(){return Di(this.container)===ns},setChecked:function(e){return!x(e)&&(e?Bi(this.container,ns):Pi(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.isChecked()&&Bi(this.container,ns),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=!1;p(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i||(e.toggle(),p(e.afterChange)&&e.afterChange(e,t))}))}},hs={name:"form-switch",container:null,input:null,beforeChange:null,afterChange:null,get value(){return this.input.value},isChecked:function(){return Di(this.container)===ns},setChecked:function(e){return!x(e)&&(this.input.checked=e,e?Bi(this.container,ns):Pi(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.input.checked&&this.setChecked(!0),this.bindEvents(),this},bindEvents:function(){var e=this;this.input.addEventListener("change",(function(t){var i=!1;p(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i?e.input.checked=!e.input.checked:(e.toggle(),p(e.afterChange)&&e.afterChange(e,t))}))}},cs=[rs(os),rs(hs)].join(",");function ds(e,t){var i=Ri(e,as,cs),s=c(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=ls(i[r],s);if(P(ss,a))throw ss[a];a.init(),n.push(a)}return n}function us(e){e.style.display="block"}function ms(e){e.style.display="none"}var ps={BAD_CONTAINER_COLLAPSIBLE:"BAD_CONTAINER_COLLAPSIBLE",BAD_CONTAINER_ACCORDION:"BAD_CONTAINER_ACCORDION"},fs={BAD_CONTAINER_COLLAPSIBLE:new Error("Missing container: A collapsible requires a container"),BAD_CONTAINER_ACCORDION:new Error("Missing container: An accordion requires a container")},gs="expanded",vs="collapsed",bs=function(e){return"collapsible"in e.dataset},ys=function(e){return"accordion"===e.dataset.boost},ws={create:function(e,t){if(!ve(e))return ps.BAD_CONTAINER_COLLAPSIBLE;var i=Object.create(this);return Object.assign(i,t,{container:e}),i},name:"collapsible",container:null,header:null,content:null,beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null,getState:function(){return this.container.dataset[this.name]},setState:function(e){this.container.dataset[this.name]=e},isCollapsed:function(){return this.getState()===vs},isExpanded:function(){return this.getState()===gs},isClosed:!1,isInitialized:!1,open:function(){if(this.isInitialized&&!this.isClosed)return this;var e=!1;return p(this.beforeOpen)&&(e=!1===this.beforeOpen(this)),e||(this.toggle(us,gs,"add"),p(this.afterOpen)&&this.afterOpen(this),this.isClosed=!1),this},close:function(){if(this.isInitialized&&this.isClosed)return this;var e=!1;return p(this.beforeClose)&&(e=!1===this.beforeClose(this)),e||(this.toggle(ms,vs,"remove"),p(this.afterClose)&&this.afterClose(this),this.isClosed=!0),this},toggle:function(e,t,i){e(this.content),this.setState(t),this.container.classList[i]("expanded")},init:function(e){return Object.assign(this,e),this.header=yi("[data-".concat(this.name,"-header]"),this.container),this.content=yi("[data-".concat(this.name,"-content]"),this.container),this.isCollapsed()?this.close():this.isExpanded()&&(this.isClosed=!0,this.open()),this.bindEvents(),this.isInitialized=!0,this},bindEvents:function(){var e=this,t=this.container,i=this.header;i.addEventListener("click",(function(s){var n=ji(s.target,(function(t){return e.name in t.dataset}));t===n&&(e.isCollapsed()?e.open():i.parentNode===t&&e.close())}))}},xs={create:function(e,t){if(!ve(e))return ps.BAD_CONTAINER_ACCORDION;var i=Object.create(this);return Object.assign(i,t,{container:e}),i},container:null,sections:null,selectedSection:null,beforeChange:null,afterChange:null,init:function(){var e=this;this.sections=[];for(var t=wi("[data-accordion]",this.container),i=0;i<t.length;i++){var s=t[i],n=ws.create(s,{name:"accordion",index:i,afterOpen:function(t){p(e.beforeChange)&&e.beforeChange(t),e.sections.filter((function(e){return e.index!==t.index})).forEach((function(e){return e.close()})),p(e.afterChange)&&e.afterChange(t),e.selectedSection=t}});if(P(ps,n))return n;this.sections.push(n),n.init()}return this}};function Es(e,t){var i=Ri(e,bs,"[data-collapsible]"),s=c(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=ws.create(i[r],s);if(P(fs,a))throw fs[a];a.init(),n.push(a)}return n}function As(e,t){var i=Ri(e,ys,"[data-boost=accordion]"),s=c(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=xs.create(i[r],s);if(P(fs,a))throw fs[a];a.init(),n.push(a)}return n}var Os=encodeURIComponent;function Ns(e){return e.toString().replace(/^(.*\/\/[^/?#]*).*$/,"$1")}function js(e,t){var i=decodeURIComponent(window.location.search);if(y(i))return null;var s={};if("URLSearchParams"in window){var n,r=new URLSearchParams(i.substring(1)),a=function(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=o(e))){i&&(e=i);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){l=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(l)throw r}}}}(r.entries());try{for(a.s();!(n=a.n()).done;){var l=n.value;s[l[0]]=l[1]}}catch(e){a.e(e)}finally{a.f()}return e?r.get(e):s}return i.substring(1).split("&").forEach((function(e){var t=e.split("=",2);s[t[0]]=t[1]})),e?c(s[e],t):s}function Cs(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];return Object.keys(e).forEach((function(s){t&&y(e[s])||i.push("".concat(Os(s),"=").concat(Os(e[s])))})),i.join("&")}},185:(e,t,i)=>{i.r(t),i.d(t,{AnchorHandler:()=>n});var s=i(835);const n={models:null,init(){this.models=new Map},create(e,t){return(0,s.isNullOrUndefined)(this.models)&&this.init(),(0,s.isNullOrUndefined)(this.models.get(t.id))?this.createModel(t.id,t.rtag,e):this.register(t.id,t.rtag,e),this.models.get(t.id)},createModel(e,t,i){const s=i.projection.environment.getActiveReceiver(t);let n=[];for(let t=0;t<s.items.length;t++)if(s.items[t].render.contains(i.container))return n.push({id:i.id,pId:s.items[t].render.dataset.id,holder:s.items[t].render,elem:i}),void this.models.set(e,{items:n,index:0})},register(e,t,i){let s=this.models.get(e);const n=i.projection.environment.getActiveReceiver(t);for(let e=0;e<n.items.length;e++)if(n.items[e].render.contains(i.container)){s.items.push({id:i.id,pId:n.items[e].render.dataset.id,holder:n.items[e].render,elem:i});break}for(let e=0;e<s.index;e++)i.nextAnchor(!1)},nextAnchor(e,t){let i=this.models.get(e);for(let e=0;e<i.items.length;e++){let s=i.items[e];s.id!==t&&s.elem.nextAnchor(!1)}i.index++},findSource(e,t){const i=this.models.get(e).items,n={};let r,a;for(r=0;r<i.length;r++){const e=i[r].elem,l=e.items;if(!(0,s.isNullOrUndefined)(l))for(a=0;a<l.length;a++)if(l[a].render.contains(t)){n.x=Number(l[a].render.getAttribute("x"))+Number(i[r].holder.getAttribute("x"))+Number((e.container||e.element).getAttribute("x")),n.y=Number(l[a].render.getAttribute("y"))+Number(i[r].holder.getAttribute("y"))+Number((e.container||e.element).getAttribute("y")),n.calc={projItems:{x:Number(l[a].render.getAttribute("x")),y:Number(l[a].render.getAttribute("y"))},holder:i[r].holder,proj:e};break}if(!(0,s.isNullOrUndefined)(n.x))break}let l=i[r].elem.anchors.indexes;const o=Number(i[r].elem.items[a].render.getAttribute("x")),h=Number(i[r].elem.items[a].render.getAttribute("y"));for(let e=0;e<l.length;e++)if(l[e].x===o&&l[e].y===h)return n.index=e,n},unregister(e,t){let i=this.models.get(e).listeners;for(let e=0;e<i.length;e++)if(i[e]===t)return void i.splice(e,1)},createSubModel(e,t){let i=this.models.get(e);(0,s.isNullOrUndefined)(i.subModels)&&(i.subModels=[]),i.subModels.push({elem:t,size:1})},registerSubModel(e,t,i){let n,r=this.models.get(e);for(let e=0;e<r.subModels.length;e++)r.subModels[e].elem===t&&(n=r.subModels[e]);(0,s.isNullOrUndefined)(n.start)&&(n.start=this.estimateStart(r,n.elem));const a=r.items;let l;for(let e=0;e<a.length;e++){const t=a[e].elem,n=t.items;if(!(0,s.isNullOrUndefined)(t.items)){for(let e=0;e<n.length;e++)if(n[e].render.contains(i.container||i.element)){l={},l.j=e,l.index=n[e].index;break}if(!(0,s.isNullOrUndefined)(l)){l.i=e;break}}}if(l.index>n.start+n.size){const e=a[l.i].elem.moveElemToAnchor(n.start+n.size,l.j);a.forEach((t=>{t.elem.increaseAnchors(n.start+n.size,l.index,e,r.forbiden)}))}else if(l.index<n.start+n.size){const e=a[l.i].elem.moveElemToAnchor(n.start+n.size-1,l.j);a.forEach((t=>{t.elem.decreaseAnchors(l.index,n.start+n.size,e,r.forbiden)})),n.start--}n.elem.increaseSize(),n.size++,(0,s.isNullOrUndefined)(r.listeners)||r.listeners.forEach((e=>{e.updateValue()}))},estimateStart(e,t){const i=e.items;for(let e=0;e<i.length;e++){const s=i[e].elem.items;for(let e=0;e<s.length;e++)if(s[e].render.contains(t.container))return e}},findTarget(e,t,i){const s=this.models.get(e).items;for(let e=0;e<s.length;e++){const n=s[e].elem,r=s[e].holder,a=n.anchors.indexes;if(r.dataset.concept===t)return{x:a[i].x+Number(r.getAttribute("x"))+Number((n.container||n.element).getAttribute("x")),y:a[i].y+Number(r.getAttribute("y"))+Number((n.container||n.element).getAttribute("y")),calc:{projItems:a[i],holder:r,proj:n}}}},estimatePositionCondamn(e,t){const i=this.models.get(e),n=i.items;for(let e=0;e<n.length;e++){const r=n[e].elem,a=r.items;if(!(0,s.isNullOrUndefined)(a))for(let l=0;l<a.length;l++)if(a[l].render.contains(t.container))return(0,s.isNullOrUndefined)(this.condamn)&&(i.condamn=[],i.forbiden=[]),i.condamn.push({index:l,elem:t}),i.forbiden.push(l),i.subModels.forEach((e=>{e.elem.container===t.container&&(e.start=a[l].index)})),{x:Number(a[l].render.getAttribute("x"))+Number(n[e].holder.getAttribute("x"))+Number((r.container||r.element).getAttribute("x")),y:Number(a[l].render.getAttribute("y"))+Number(n[e].holder.getAttribute("y"))+Number((r.container||r.element).getAttribute("y")),anchors:r.anchors.next}}},estimatePosition(e){const{projItems:t,holder:i,proj:s}=e;return{x:t.x+Number(i.getAttribute("x"))+Number((s.container||s.element).getAttribute("x")),y:t.y+Number(i.getAttribute("y"))+Number((s.container||s.element).getAttribute("y"))}},registerListener(e,t){let i=this.models.get(e);(0,s.isNullOrUndefined)(i.listeners)&&(i.listeners=[]),i.listeners.push(t)},deleteItem(e,t,i){const n=this.models.get(e);if(n.items.forEach((e=>{e.id!==t&&e.elem.removeAnchor(i)})),!(0,s.isNullOrUndefined)(n.condamn)){for(let e=0;e<n.subModels.length;e++)n.subModels[e].start<i&&n.subModels[e].start+n.subModels[e].size>i&&(n.subModels[e].size--,n.subModels[e].elem.decreaseSize());for(let e=0;e<n.condamn.length;e++){if(n.condamn[e].index>i){n.condamn[e].index--,n.condamn[e].elem.decreaseAnchor();for(let e=0;e<n.subModels.length;e++)n.subModels[e].elem===n.elem&&n.subModels[e].start--}n.condamn[e].index===i&&(n.condamn.splice(e,1),e--)}for(let e=0;e<n.forbiden.length;e++)n.forbiden[e]===i&&(n.forbiden.splice(e,1),e--)}n.index--,(0,s.isNullOrUndefined)(n.listeners)||n.listeners.forEach((e=>{e.updateValue()}))}}},241:(e,t,i)=>{function s(e){let t=0;if(C(e))return e.selectionStart;if(0!==window.getSelection().rangeCount){const i=window.getSelection().getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),t=s.toString().length}return t}i.d(t,{D3:()=>O,n_:()=>A,sr:()=>w,hi:()=>E,k$:()=>x,_b:()=>$,wo:()=>b,p$:()=>F,jn:()=>y,GV:()=>P,qO:()=>s,As:()=>H,NI:()=>N,EE:()=>V,GF:()=>B,Sd:()=>D,sB:()=>U,Cp:()=>d,CH:()=>p,xj:()=>j,u7:()=>C,QE:()=>L,n2:()=>_,a2:()=>S,fP:()=>R,Ys:()=>g,lL:()=>m,$Z:()=>c,ZN:()=>u,HW:()=>f,hF:()=>v});var n=i(835);const r="hidden",a="collapsed",l="highlighted",o="shake",h="selected";function c(e){return(0,n.isHTMLElement)(e)?(e.classList.remove(r),e):e}function d(e){return(0,n.isHTMLElement)(e)?(e.classList.add(r),e):e}function u(e){return(0,n.isHTMLElement)(e)?(e.classList.toggle(r),e):e}function m(e){e.classList.contains(o)||(e.classList.add(o),setTimeout((()=>{e.classList.remove(o)}),1e3))}function p(e){return(0,n.isHTMLElement)(e)?(e.classList.add(l),e):e}function f(e){return(0,n.isHTMLElement)(e)?(e.classList.remove(l),e):e}function g(e){return(0,n.isHTMLElement)(e)?(e.classList.add(h),e):e}function v(e){return(0,n.isHTMLElement)(e)?(e.classList.remove(h),e):e}function b(e){return(0,n.isHTMLElement)(e)&&e.classList.add(a),e}function y(e){return(0,n.isHTMLElement)(e)&&e.classList.remove(a),e}const w={backspace:"Backspace",tab:"Tab",enter:"Enter",ctrl:"Control",shift:"Shift",alt:"Alt",escape:"Escape",spacebar:" ",page_up:"PageUp",page_down:"PageDown",insert:"Insert",end:"End",home:"Home",left_arrow:"ArrowLeft",up_arrow:"ArrowUp",right_arrow:"ArrowRight",down_arrow:"ArrowDown",delete:"Delete",period:"."},x={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},E={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},A={AAC:{type:"audio/aac",extension:"aac"},BIN:{type:"application/octet-stream",extension:"bin"},JPEG:{type:"image/jpeg",extension:"jpeg"},JSON:{type:"application/json",extension:"json"},JSONCP:{type:"application/json",extension:"jsoncp"},MP3:{type:"audio/mpeg",extension:"mp3"},PDF:{type:"application/pdf",extension:"pdf"},SVG:{type:"image/svg+xml",extension:"svg"},TEXT:{type:"text/plain",extension:"txt"},XML:{type:"text/xml",extension:"xml"},ZIP:{type:"application/zip",extension:"zip"}},O={"audio/aac":"aac","application/octet-stream":"bin","image/jpeg":"jpeg","application/json":"json","audio/mpeg":"mp3","application/pdf":"pdf","image/svg+xml":"svg","text/plain":"txt","text/xml":"xml","application/zip":"zip"};function N(e){const t=e=>!(0,n.hasOwn)(e.dataset,"ignore");return t(e)?e:(0,n.findAncestor)(e,t,10)}function j(e){if(!n.isHTMLElement)throw new TypeError("Bad parameter");return e.hidden||"none"===window.getComputedStyle(e).display}const C=e=>(0,n.isHTMLElement)(e,["input","textarea"]),L=e=>C(e)||"true"===e.contentEditable,S=e=>+e.substring(0,e.indexOf("px")),k={top:e=>e.marginTop,right:e=>e.marginRight,bottom:e=>e.marginBottom,left:e=>e.marginLeft},T={top:e=>e.paddingTop,right:e=>e.paddingRight,bottom:e=>e.paddingBottom,left:e=>e.paddingLeft},M={top:e=>e.borderTopWidth,right:e=>e.borderRightWidth,bottom:e=>e.borderBottomWidth,left:e=>e.borderLeftWidth};function I(e,t,i){const s=window.getComputedStyle(e),n=window.getComputedStyle(t),r=k[i](s),a=T[i](n),l=M[i](n);return o=e.getBoundingClientRect()[i]+S(r),h=t.getBoundingClientRect()[i]-S(a)-S(l),Math.abs(o-h)<2;var o,h}function U(e){for(let t=0;t<e.children.length;t++){const i=e.children[t];if(!j(i))return i}return null}function H(e,t,i,s){return"up"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&I(e,t,"top"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(j(i)||i.classList.contains("badge")||i===e)continue;const{bottom:h,left:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);n>=h-1&&(d<l||d===l&&u<o)&&(a=i,l=d,o=u)}return a}(e,i,s):"down"===t?function(e,t,i=!0){const s=t.children,{bottom:n,left:r}=e.getBoundingClientRect();if(i&&I(e,t,"bottom"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(j(i)||i.classList.contains("badge")||i===e)continue;const{top:h,left:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);n<=h+1&&(d<l||d===l&&u<o)&&(a=i,l=d,o=u)}return a}(e,i,s):"left"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&I(e,t,"left"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(j(i)||i.classList.contains("badge")||i===e)continue;const{top:h,right:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);r>=c-1&&(u<o||u===o&&d<l)&&(a=i,l=d,o=u)}return a}(e,i,s):"right"===t?function(e,t,i=!0){const s=t.children,{top:n,right:r}=e.getBoundingClientRect();if(i&&I(e,t,"right"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(j(i)||i.classList.contains("badge")||i===e)continue;const{top:h,left:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);r<=c+1&&(u<o||u===o&&d<l)&&(a=i,l=d,o=u)}return a}(e,i,s):(console.error("unknown direction",t),null)}function D(e,t){const i=e.children,{top:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let l=null,o=99999,h=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(j(n)||n.classList.contains("badge"))continue;const{top:c,left:d}=n.getBoundingClientRect();let u=Math.abs(s-c),m=Math.abs(r-d);s<=c+1&&(u<o||u===o&&m<h)&&(l=n,o=u,h=m)}return l}function V(e,t){const i=e.children,{top:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let l=null,o=99999,h=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(j(n)||n.classList.contains("badge"))continue;const{top:c,left:d}=n.getBoundingClientRect();let u=Math.abs(s-c),m=Math.abs(r-d);r<=d+1&&(m<h||m===h&&u<o)&&(l=n,o=u,h=m)}return l}function B(e,t){const i=e.children,{top:s,right:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let l=null,o=99999,h=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(j(n)||n.classList.contains("badge"))continue;const{top:c,right:d}=n.getBoundingClientRect();let u=Math.abs(s-c),m=Math.abs(r-d);r>=d-1&&(m<h||m===h&&u<o)&&(l=n,o=u,h=m)}return l}function P(e,t){const i=e.children,{bottom:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let l=null,o=99999,h=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(j(n)||n.classList.contains("badge"))continue;const{bottom:c,left:d}=n.getBoundingClientRect();let u=Math.abs(s-c),m=Math.abs(r-d);s>=c-1&&(u<o||u===o&&m<h)&&(l=n,o=u,h=m)}return l}function R(e){return(0,n.isHTMLElement)(e)?e:(0,n.isString)(e)&&!(0,n.isNullOrWhitespace)(e)?(0,n.getElement)(e):null}function _(e,t={}){const i=R(e);if(!(0,n.isHTMLElement)(i))return null;const s=Object.assign({horizontal:!0,vertical:!0,minWidth:60,minHeight:60},t),r=function(){let e=(0,n.createDiv)({class:["resizers"]});return["horizontal","vertical"].forEach((t=>{e.append((0,n.createDiv)({class:["resizer",`${t}`],dataset:{dir:t}}))})),e}();i.prepend(r),s.horizontal&&s.vertical?i.dataset.resizable="both":s.horizontal?i.dataset.resizable="horizontal":s.vertical&&(i.dataset.resizable="vertical");const{minWidth:a,minHeight:l}=getComputedStyle(i),o=(0,n.valOrDefault)(S(a),s.minWidth),h=(0,n.valOrDefault)(S(l),s.minHeight);let c=0,d=null;function u(e){const{dir:t}=d.dataset,{width:s,height:n}=getComputedStyle(i);let r="horizontal"===t?e.pageX:e.pageY;if("horizontal"===t){const e=S(s)+(r-c);e>o&&(i.style.width=`${e}px`)}else if("vertical"===t){const e=S(n)+(r-c);e>h&&(i.style.height=`${e}px`)}c=r}for(let e=0;e<r.childElementCount;e++){const t=r.children[e];t.addEventListener("mousedown",(function(e){e.preventDefault(),d=t;const{dir:i}=d.dataset;c="horizontal"===i?e.pageX:e.pageY,document.body.addEventListener("mousemove",u),document.body.addEventListener("mouseup",(()=>{document.body.removeEventListener("mousemove",u)}))}))}return i}const $=e=>(0,n.createStrong)({class:["text-bf"]},e).outerHTML,F=e=>JSON.parse(JSON.stringify(e));i(914)},914:(e,t,i)=>{i.d(t,{h:()=>s});const s=function(){var e={},t=[];for(let e=0;e<256;e++)t[e]=e<16?"0"+e.toString(16):e.toString(16);return e.generate=function(){var e=4294967296*Math.random()>>>0,i=4294967296*Math.random()>>>0,s=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]},e}()}},t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{s.r(n),s.d(n,{activateEditor:()=>Ca,createEditor:()=>La});var e=s(835),t=s(241);const r={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,e.isNullOrUndefined)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,t.Cp)(this.placeholder),(0,t.$Z)(this.conceptList)):(this.container.classList.add("empty"),(0,t.$Z)(this.placeholder),(0,t.Cp)(this.conceptList)),this.hasSelection||(0,t.Cp)(this.infoView),this},render(){return this.container=(0,e.createDiv)({class:["editor-config"]}),this.mainView=(0,e.createDiv)({class:["editor-config-main"]}),this.infoView=(0,e.createDiv)({class:["editor-config-info"]}),this.conceptList=(0,e.createUnorderedList)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,e.createParagraph)({class:["editor-config-placeholder"],html:`${(0,t._b)("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,e.removeChildren)(this.conceptList),(0,e.removeChildren)(this.infoView),this.cache.clear(),this.refresh()},selectItem(t){if(!this.cache.has(t))return null;let i=this.cache.get(t);return(0,e.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.refresh(),t},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},showInfo(i){let s=a(this.editor.conceptModel.getCompleteModelConcept(i),(0,e.getTemplate)("#concept-schema"));(0,e.removeChildren)(this.infoView).append(s),(0,t.$Z)(this.infoView)},addItem(t){let i=(0,e.createSpan)({class:["loaded-element-name","fit-content"]},t.name),s=(0,e.createListItem)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:t.name,status:"active"}}),n=(0,e.createButton)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:t.name}});s.append(i,n),this.conceptList.append(s),this.cache.set(t.name,s),this.refresh()},bindEvents(){}};function a(t,i){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad argument: The 'schema' is missing");if(!(0,e.isHTMLElement)(i))throw new TypeError("Bad argument: The given 'template' is not a valid HTML Element");const s=(0,e.cloneTemplate)(i);return(0,e.getElements)("[data-if]",s).forEach(((i,s)=>{let n=i.dataset.if;(0,e.hasOwn)(t,n)||i.remove()})),(0,e.getElements)("[data-name]",s).forEach(((e,i)=>{let s=e.dataset.name;e.textContent=t[s]})),(0,e.getElements)("[data-attr]",s).forEach(((e,i)=>{let s=e.dataset.attr,[n,r]=s.split(":"),a=(e=>e.startsWith("$")?t[e.substring(1)]:e)(r);delete e.dataset.attr,e.dataset[n]=a})),(0,e.getElements)("[data-bind]",s).forEach(((i,s)=>{let n=i.dataset.bind;if(!(0,e.hasOwn)(t,n))return;let r=(0,e.getElement)("[data-item]",i),l=r.dataset.item,o=(0,e.getTemplate)(`#${l}`);t[n].forEach((e=>{r.append(a(e,o))}))})),s}const l={PRIMITIVE:"E",CONCRETE:"C",PROTOTYPE:"P",DERIVATIVE:"D"},o={file:null,title:null,status:null,container:null,mainView:null,infoView:null,files:null,btnLoad:null,btnUnload:null,btnDownload:null,btnEdit:null,selection:null,concepts:null,selectedConcept:null,attributes:null,filter:null,init(){return this.concepts=new Map,this.attributes=new Map,this.filter=Object.create(c,{editor:{value:this.editor},settings:{value:this}}).init([{label:"Concrete",nature:"concrete"},{label:"Prototype",nature:"prototype"},{label:"Derivative",nature:"derivative"}]),this},get hasFile(){return this.concepts.size>0},get hasSelection(){return!(0,e.isNullOrUndefined)(this.selection)},getFile(){return this.file},setFile(e){this.file=e,this.refresh()},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,t.$Z)(this.files)):(this.container.classList.add("empty"),(0,t.Cp)(this.files)),this.btnUnload.disabled=!this.hasFile,this.editor.isReady?((0,t.Cp)(this.placeholder),this.placeholder.classList.remove("error")):this.hasFile?(this.editor.hasConceptModel||(this.placeholder.innerHTML=`${(0,t._b)("Missing projections")}`),this.editor.hasProjectionModel||(this.placeholder.innerHTML=`${(0,t._b)("Missing projections")}`),this.placeholder.classList.add("error"),(0,t.$Z)(this.placeholder)):(this.placeholder.innerHTML=`Add your ${(0,t._b)("concepts")} and ${(0,t._b)("projections")} or load a previously saved ${(0,t._b)("model")}`,this.placeholder.classList.remove("error")),this.hasSelection?(0,t.$Z)(this.infoView):(0,t.Cp)(this.infoView),this},reload(){this.editor.hasConceptModel&&(this.editor.conceptModel.schema.forEach((t=>{let i=(0,e.createListItem)({class:["editor-file-concept"],dataset:{name:t.name,nature:t.nature,root:(0,e.valOrDefault)(t.root,"false")}},t.name);if(t.root){let t=(0,e.createI)({class:["editor-file-concept-root"],title:"root concept"});i.append(t)}this.concepts.set(t.name,i),this.files.append(i)})),this.refresh())},render(){this.container=(0,e.createDiv)({class:["editor-file"]});let i=(0,e.createDiv)({class:["editor-file-actionbar"]});return this.btnLoad=(0,e.createButton)({class:["btn","editor-file__browse-button"],title:"Load file in editor",dataset:{action:"load"}},"Browse"),this.btnImport=(0,e.createButton)({class:["btn","editor-file__browse-button"],title:"Load file in editor",dataset:{action:"load"}},"Import"),this.btnUnload=(0,e.createButton)({class:["btn","editor-file-actionbar__button","editor-file-actionbar__btn-remove"],title:"Remove all files",dataset:{action:"unload"}}),i.append(this.btnLoad,this.btnUnload),this.mainView=(0,e.createDiv)({class:["editor-file-mainview"]}),this.files=(0,e.createUnorderedList)({class:["bare-list","editor-file__list"]}),this.infoView=(0,e.createDiv)({class:["detail-area","editor-file-detail"]}),this.placeholder=(0,e.createParagraph)({class:["editor-file-placeholder"],html:`Add your ${(0,t._b)("concepts")}, ${(0,t._b)("projections")} and all other ${(0,t._b)("resources")}`}),this.mainView.append(this.filter.render(),this.files,this.infoView),this.container.append(i,this.mainView),this.bindEvents(),this.refresh(),this.container},clear(){(0,e.removeChildren)(this.files)},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},selectItem(t){let i=this.concepts.get(t);(0,e.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.displayInfo(t),this.refresh()},displayConcept(t){if((0,e.isNullOrUndefined)(t))return;let i=this.editor.conceptModel.getConceptSchema(t);if((0,e.isNullOrUndefined)(i))return;this.selection=t;const{name:s,nature:n,attributes:r}=i;let a=(0,e.createDiv)({class:["app-model-concept"]}),o=(0,e.createDiv)({class:["app-model-concept-header"]}),c=(0,e.createI)({class:["app-model-concept-nature"],dataset:{name:n}},l[n.toUpperCase()]),d=(0,e.createSpan)({class:["app-model-concept-name"]},s);o.append(c,d);let u=(0,e.createUnorderedList)({class:["bare-list","app-model-concept-attributes"]});Array.isArray(r)&&r.forEach((t=>{let i=(0,e.createListItem)({class:["app-model-concept-attribute"],dataset:{name:t.name,type:"attribute"}}),s=(0,e.createDiv)({class:["app-model__attribute-header"]}),n=(0,e.createSpan)({class:["app-model__attribute-name"]},t.name);if(t.required){let t=(0,e.createI)({class:["app-model__attribute-required"]},(0,e.createSpan)({class:["help"]},"required"));s.append(t)}s.append(n);let r=(0,e.createDiv)({class:["app-model__attribute-target"]},h(t.target)),a=(0,e.createDiv)({class:["app-model__attribute-info"]},[s,r]);i.append(a),this.attributes.set(t.name,i),u.append(i)})),a.append(o,u),(0,e.removeChildren)(this.infoView),this.infoView.append(a),this.selectedConcept=i,this.refresh()},selectAttribute(t){return!(0,e.isNullOrUndefined)(t)&&(this.selectedAttribute!==t&&(this.selectedAttribute&&this.attributes.get(this.selectedAttribute).classList.remove("selected"),!!this.attributes.has(t)&&(this.selectedAttribute=t,this.attributes.get(t).classList.add("selected"),this.displayAttribute(t),this.refresh(),!0)))},displayAttribute(e){this.refresh()},bindEvents(){this.editor.registerHandler("editor.load-concept@post",(e=>{this.reload()})),this.editor.registerHandler("editor.unload-concept@post",(e=>{this.reload()})),this.editor.registerHandler("editor.unload-projection@post",(e=>{this.reload()})),this.container.addEventListener("dragenter",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragleave",(e=>{this.container.classList.remove("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragover",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("drop",(e=>{this.container.classList.remove("highlight");let t=e.dataTransfer.files[0];if(!t.name.endsWith(".json"))return void this.notify("This file is not supported. Please use a .json file");let i=new FileReader;i.onload=e=>{this.editor.load(i.result,this.type)},i.readAsText(t),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("click",(e=>{const{target:t}=e,{type:i,name:s}=t.dataset;this.displayConcept(s),"attribute"===i?this.selectAttribute(s):"concept"===i&&this.parent.selectConcept(s)}))}};function h(t){const i=(0,e.createDocFragment)();if((0,e.isNullOrUndefined)(t))return i;const{name:s,accept:n}=t;let r=(0,e.createSpan)({class:["target-name"],dataset:{type:"concept",name:s}},s);if(i.append(r),n){let t=(0,e.createDiv)({class:["target-accept"]});Array.isArray(n)?(t.append(...n.map((e=>h(e)))),t.classList.add("array")):t.append(h(n)),i.append(t)}return i}const c={container:null,values:null,filters:null,concepts:null,init(t){this.values=(0,e.valOrDefault)(t,[]);let i=1;return this.values.forEach((e=>{e.id=i++})),this.filters=new Map,this},refresh(){this.filters.forEach(((e,t)=>{e.checked?e.parentElement.classList.add("checked"):e.parentElement.classList.remove("checked")}))},render(){return(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:"concept-filter"})),this.search=(0,e.createInput)({class:["concept-filter-search"]}),this.values.forEach((t=>{let i=(0,e.createInput)({class:["cf-option-checkbox"],type:"checkbox",checked:!0,value:t.id}),s=(0,e.createSpan)({class:["cf-option-text"]},t.label),n=(0,e.createLabel)({class:"concept-filter-option"},[i,s]);this.filters.set(t,i),this.container.append(n)})),this.bindEvents(),this.refresh(),this.container},filterConcepts(){this.settings.concepts.forEach(((i,s)=>{const{nature:n,root:r}=i.dataset;this.filters.forEach(((s,a)=>{a.nature===n&&(s.checked?(0,t.$Z)(i):(0,t.Cp)(i)),a.root===(0,e.toBoolean)(r)&&(s.checked?(0,t.$Z)(i):(0,t.Cp)(i))}))})),this.refresh()},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e;this.filterConcepts()}))}},d={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,e.isNullOrUndefined)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,t.Cp)(this.placeholder),(0,t.$Z)(this.conceptList)):(this.container.classList.add("empty"),(0,t.$Z)(this.placeholder),(0,t.Cp)(this.conceptList)),this.hasSelection||(0,t.Cp)(this.infoView),this},render(){return this.container=(0,e.createDiv)({class:["editor-config"]}),this.mainView=(0,e.createDiv)({class:["editor-config-main"]}),this.infoView=(0,e.createDiv)({class:["editor-config-info"]}),this.conceptList=(0,e.createUnorderedList)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,e.createParagraph)({class:["editor-config-placeholder"],html:`${(0,t._b)("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,e.removeChildren)(this.conceptList),(0,e.removeChildren)(this.infoView),this.cache.clear(),this.refresh()},selectItem(t){if(!this.cache.has(t))return null;let i=this.cache.get(t);return(0,e.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.refresh(),t},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},addItem(t){let i=(0,e.createSpan)({class:["loaded-element-name","fit-content"]},t.name),s=(0,e.createListItem)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:t.name,status:"active"}}),n=(0,e.createButton)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:t.name}});s.append(i,n),this.conceptList.append(s),this.cache.set(t.name,s),this.refresh()},bindEvents(){}},u={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,e.isNullOrUndefined)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,t.Cp)(this.placeholder),(0,t.$Z)(this.conceptList)):(this.container.classList.add("empty"),(0,t.$Z)(this.placeholder),(0,t.Cp)(this.conceptList)),this.hasSelection||(0,t.Cp)(this.infoView),this},render(){return this.container=(0,e.createDiv)({class:["editor-config"]}),this.mainView=(0,e.createDiv)({class:["editor-config-main"]}),this.infoView=(0,e.createDiv)({class:["editor-config-info"]}),this.conceptList=(0,e.createUnorderedList)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,e.createParagraph)({class:["editor-config-placeholder"],html:`${(0,t._b)("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,e.removeChildren)(this.conceptList),(0,e.removeChildren)(this.infoView),this.cache.clear(),this.refresh()},selectItem(t){if(!this.cache.has(t))return null;let i=this.cache.get(t);return(0,e.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.refresh(),t},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},addItem(t){let i=(0,e.createSpan)({class:["loaded-element-name","fit-content"]},t.name),s=(0,e.createListItem)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:t.name,status:"active"}}),n=(0,e.createButton)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:t.name}});s.append(i,n),this.conceptList.append(s),this.cache.set(t.name,s),this.refresh()},bindEvents(){}},m={menu:null,schema:null,isOpen:!1,visible:!0,btnStart:null,settings:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,e.isHTMLElement)(this.container)},clear(){return(0,e.removeChildren)(this.container),this},update(){},render(){const t=(0,e.createDocFragment)();if(!(0,e.isHTMLElement)(this.container)){this.container=(0,e.createDiv)({class:["editor-home"]});let t=(0,e.createImage)({class:["editor-logo"],src:"https://gentlemancp.org/assets/images/logo_gentleman_200.png"}),i=(0,e.createH2)({class:["editor-title"]},"Settings"),s=(0,e.createDiv)({class:["editor-home-header"]},[t,i]);this.container.append(s)}return(0,e.isHTMLElement)(this.menu)||(this.menu=Object.create(p,{editor:{value:this.editor}}).init(),t.append(this.menu.render())),(0,e.isHTMLElement)(this.btnStart)||(this.btnStart=(0,e.createButton)({class:["btn","editor-home-section--model__button","editor-home-section__button--start"],dataset:{action:"close",context:"home"}},"Done!"),t.append(this.btnStart)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){const{hasConceptModel:e,hasProjectionModel:t}=this.editor;return this.btnStart.disabled=!(e&&t),this},actionHandler(e,t){const{concept:i}=t.dataset;"open-concept"===e&&(this.menu.config.selectItem(i),this.menu.config.showInfo(i))},bindEvents(){this.editor.registerHandler("concept-model.updated",(()=>{this.menu.config.clear(),this.editor.hasConceptModel&&this.editor.conceptModel.schema.filter((e=>e.root)).forEach((e=>{this.menu.config.addItem(e)}))}))}},p={container:null,tabsElement:null,tabs:null,currentTab:null,activeTab:null,fileIO:null,config:null,dataSettings:null,buildSettings:null,init(){return this.tabs=new Map,this.tabs.set("file","File"),this.tabs.set("config","Config"),this.tabs.set("data","Data"),this.tabs.set("build","Build"),this.currentTab="file",this},refresh(){},render(){return this.container=(0,e.createSection)({class:["editor-home-menu"]}),this.tabsElement=(0,e.createUnorderedList)({class:["bare-list","editor-home-menu-tabs"]}),this.tabs.forEach(((t,i)=>{let s=(0,e.createListItem)({class:["editor-home-menu-tab"],dataset:{name:i}},t);this.tabs.set(i,s),this.tabsElement.append(s)})),this.window=(0,e.createDiv)({class:["editor-home-menu-section"]}),this.fileIO=f.call(this),this.config=g.call(this),this.dataSettings=v.call(this),this.buildSettings=b.call(this),this.window.append(this.fileIO.render()),this.window.append(this.config.render()),this.window.append(this.dataSettings.render()),this.window.append(this.buildSettings.render()),this.selectTab(this.currentTab),this.container.append(this.tabsElement,this.window),this.bindEvents(),this.container},selectTab(i){(0,e.isNullOrUndefined)(i)||this.activeTab&&this.currentTab===i||("file"===i?(this.fileIO.show(),this.config.hide(),this.dataSettings.hide(),this.buildSettings.hide()):"config"===i&&(this.config.show(),this.fileIO.hide(),this.dataSettings.hide(),this.buildSettings.hide()),this.activeTab&&(0,t.hF)(this.activeTab),this.currentTab=i,this.activeTab=this.tabs.get(this.currentTab),(0,t.Ys)(this.activeTab))},bindEvents(){this.tabsElement.addEventListener("click",(e=>{const{target:t}=e,{name:i}=t.dataset;this.selectTab(i)}))}};function f(e){const t=Object.create(o,{editor:{value:this.editor}});return t.init(),t}function g(){const e=Object.create(r,{editor:{value:this.editor}});return e.init(),e}function v(){const e=Object.create(d,{editor:{value:this.editor}});return e.init(),e}function b(){const e=Object.create(u,{editor:{value:this.editor}});return e.init(),e}function y(t,i){const{name:s,object:n,id:r}=i,a=(0,e.createListItem)({class:["selector-concept",`selector-concept--${t}`],title:i.getName(),dataset:{concept:r,object:n}});var l=(0,e.createSpan)({class:["selector-concept-content"]},i.getName());a.append(l),"ancestor"===t&&l.classList.add("fit-content");const o=(0,e.createI)({class:["selector-concept-status"]});if(i.hasError){o.classList.add("error");let t=(0,e.createUnorderedList)({class:["bare-list","selector-concept-status__errors"]});i.errors.forEach((i=>{let s=(0,e.createListItem)({class:["selector-concept-status__error"]},i);s.style.minWidth=`${Math.min(.5*i.length,30)}em`,t.append(s)})),o.append(t),a.classList.add("error")}else o.classList.add("valid"),a.classList.add("valid");return a.append(o),a.addEventListener("mouseenter",(t=>{let i=(0,e.getElement)(`.projection[data-concept="${r}"]`,this.editor.body);i&&this.editor.highlight(i)})),a.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),a.addEventListener("click",(t=>{let i=(0,e.getElement)(`.projection[data-concept="${r}"]`,this.editor.body);i&&i.focus()})),a}const w={container:null,title:null,conceptList:null,header:null,body:null,get isRendered(){return(0,e.isHTMLElement)(this.container)},init(e={}){return this.schema=e,this},update(){},refresh(){const{activeInstance:t,activeConcept:i,hasActiveInstance:s,hasActiveConcept:n}=this.editor;if(!s||!n)return(0,e.removeChildren)(this.conceptList),this;const r=t.concept,a=(0,e.createDocFragment)();let l=y.call(this,"root",r);if(a.append(l),r===i&&l.classList.add("selector-concept--active"),r===i)return(0,e.removeChildren)(this.conceptList).append(a),this;if(!i.hasParent())return(0,e.removeChildren)(this.conceptList).append(a),this;let o=i.getParent(),h=[];for(;o&&o!==r;)h.unshift(o),o=o.getParent();return h.forEach((e=>{a.append(y.call(this,"ancestor",e))})),l=y.call(this,"active",i),a.append(l),(0,e.removeChildren)(this.conceptList).append(a),this},render(){const t=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["editor-breadcrumb"]})),(0,e.isHTMLElement)(this.notification)||(this.notification=(0,e.createDiv)({class:["notification","breadcrumb-notification"]}),t.append(this.notification));const i=(0,e.createSpan)({class:["breadcrumb-title","hidden"],dataset:{ignore:"all"}},"Breadcrumb");return t.append(i),(0,e.isHTMLElement)(this.conceptList)||(this.conceptList=(0,e.createUnorderedList)({class:["bare-list","selector-concepts"]}),t.append(this.conceptList)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.update(),this.refresh(),this.container},bindEvents(){}},x={schema:null,isOpen:!1,visible:!0,btnStart:null,logList:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,e.isHTMLElement)(this.container)},add(i,s,n=t.hi.NORMAL){if(!Array.isArray(i))return;let r=(0,e.createUnorderedList)({class:["bare-list","log-item-messages"]});i.forEach((t=>r.append((0,e.createListItem)({class:["log-item-message"]},t))));let a=(0,e.createListItem)({class:["log-item",`log-item--${n}`]}),l=(0,e.createButton)({class:["btn","btn-delete"],dataset:{action:"delete",target:"parent"}},"✖"),o=(0,e.createSpan)({class:["log-item__name"],dataset:{action:"delete",target:"parent"}},`${(0,e.valOrDefault)(s,"Log")} (${(0,e.shortDateTime)(Date.now())})`);return a.append(l,o,r),this.logList.append(a),this.refresh(),this},clear(){return(0,e.removeChildren)(this.logList),this},update(){},render(){const t=(0,e.createDocFragment)();return(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["editor-log"]})),(0,e.isHTMLElement)(this.logList)||(this.logList=(0,e.createUnorderedList)({class:["bare-list","log-list"]}),t.append(this.logList)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){return this.logList.hasChildNodes()?this.show():this.hide(),this},bindEvents(){}},E={modelstatus:null,editorstatus:null,notification:null,views:null,view:"grid",viewContainer:null,viewList:null,viewItem:null,activeViewItem:null,groupList:null,groupItem:null,activeGroupItem:null,visible:!0,container:null,get isRendered(){return(0,e.isHTMLElement)(this.container)},init(){return this.views=new Map,this},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},updateActiveView(){"tab"===this.view&&(this.editor.instances.forEach((e=>{e!==this.editor.activeInstance&&(e.view.classList.remove("active"),e.hide())})),this.editor.activeInstance.view.classList.add("active"),this.editor.activeInstance.show()),this.editor.refresh()},addView(t){if((0,e.isNullOrUndefined)(t))return!1;let i=t.title.textContent,s=(0,e.createI)({class:["ico","ico-delete"]},"✖"),n=(0,e.createButton)({class:["btn","btn-close"]},s),r=(0,e.createDiv)({class:[`editor-view-${this.view}list-item__content`,"fit-content"]},i),a=(0,e.createListItem)({class:[`editor-view-${this.view}list-item`],title:t.title.textContent},[r,n]);t.view=a,a.addEventListener("click",(i=>{if(function(t){const i=e=>e===a||e===n;return i(t)?t:(0,e.findAncestor)(t,(e=>i(e)),5)}(i.target)===n){let e=a.previousSibling||a.nextSibling;t.delete(),null===this.editor.activeInstance&&e&&e.click()}else this.editor.updateActiveInstance(t)})),this.tabView.append(a)},changeView(i){if(i===this.view)return this;this.view=i,(0,t.hF)(this.viewItem),this.viewItem=this.views.get(this.view),(0,t.Ys)(this.viewItem),(0,e.removeChildren)(this.editor.viewSection),"tab"===i?(this.tabView=(0,e.createUnorderedList)({class:["bare-list","editor-view-tablist"]}),(0,e.removeChildren)(this.tabView),this.editor.instances.forEach((e=>{e.expand(),this.addView(e)})),this.editor.viewSection.append(this.tabView)):"grid"===i&&this.editor.instances.forEach((e=>{e.show()})),this.updateActiveView()},addGroup(){(0,e.createListItem)({class:["editor-footer-group"]})},notify(t,i=4500){let s=t;const n="open";if(this.notification.classList.contains(n))return!1;this.notification.appendChild(s),setTimeout((()=>{this.notification.classList.add(n),this.container.classList.add("menu--notifying")}),50),setTimeout((()=>{this.notification.classList.remove(n),this.container.classList.remove("menu--notifying"),setTimeout((()=>{(0,e.removeChildren)(this.notification)}),500)}),i)},refresh(){const{conceptModel:t}=this.editor;if(this.editor.isReady){if(t.hasError){this.modelstatusBadge.classList.add("error"),this.modelstatusBadge.classList.remove("valid"),this.container.classList.add("error");let e=t.concepts.filter((e=>e.hasError)).length;this.modelstatusInfo.textContent=`${e} ${function(e,t,i){if(1===i)return e;let s="s".split("|");return 1===s.length?e+s[0]:e.substring(0,e.lastIndexOf(s[0]))+s[1]}("error",0,e)}`}else this.modelstatusBadge.classList.add("valid"),this.modelstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,e.removeChildren)(this.modelstatusInfo),this.editor.logs.clear();if(this.editor.hasError){this.editorstatusBadge.classList.add("error"),this.editorstatusBadge.classList.remove("valid"),this.container.classList.add("error");let e=this.editor.errors.length;this.editorstatusInfo.textContent=`${e}`}else this.editorstatusBadge.classList.add("valid"),this.editorstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,e.removeChildren)(this.editorstatusInfo),this.editor.logs.clear()}},render(){const t=(0,e.createDocFragment)();if((0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["editor-statusbar"]})),(0,e.isHTMLElement)(this.badgeContainer)||(this.badgeContainer=(0,e.createDiv)({class:["editor-statusbar-badge-container"]}),t.appendChild(this.badgeContainer)),(0,e.isHTMLElement)(this.modelstatus)||(this.modelstatus=(0,e.createDiv)({class:["editor-statusbar-model"]}),this.modelstatusBadge=(0,e.createI)({class:["editor-statusbar-model-badge"]}),this.modelstatusInfo=(0,e.createDiv)({class:["editor-statusbar-model-info"]}),this.modelstatus.append(this.modelstatusBadge,this.modelstatusInfo),this.badgeContainer.appendChild(this.modelstatus)),(0,e.isHTMLElement)(this.editorstatus)||(this.editorstatus=(0,e.createDiv)({class:["editor-statusbar-global"]}),this.editorstatusBadge=(0,e.createI)({class:["editor-statusbar-global-badge"]}),this.editorstatusInfo=(0,e.createDiv)({class:["editor-statusbar-global-info"]}),this.editorstatus.append(this.editorstatusBadge,this.editorstatusInfo),this.badgeContainer.appendChild(this.editorstatus)),(0,e.isHTMLElement)(this.viewContainer)||(this.viewContainer=(0,e.createDiv)({class:["editor-statusbar-viewer-container"]}),t.appendChild(this.viewContainer)),!(0,e.isHTMLElement)(this.btnGroup)){let t=(0,e.createI)({class:["ico","ico-plus","btn-content"],title:"Add a group",dataset:{ignore:"all"}},"+");this.btnGroup=(0,e.createButton)({class:["editor-statusbar-viewer__button-add"],dataset:{action:"add-group"}},t)}return(0,e.isHTMLElement)(this.groupContainer)||(this.groupContainer=(0,e.createDiv)({class:["editor-footer-group"]})),(0,e.isHTMLElement)(this.viewList)||(this.viewList=(0,e.createUnorderedList)({class:["bare-list","editor-statusbar-viewers"]}),this.viewContainer.appendChild(this.viewList)),["grid","tab"].forEach((t=>{let i=(0,e.createListItem)({class:["editor-statusbar-viewer"],dataset:{type:"viewer",action:"change-view",value:t}},t);this.views.set(t,i),this.viewList.append(i)})),this.viewItem=this.views.get(this.view),this.viewItem.classList.add("selected"),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},bindEvents(){function i(t,i){let s=(0,e.createEmphasis)({class:["link","error-message__link"]},t);const n=`.projection[data-concept="${i}"]`;return s.addEventListener("mouseenter",(t=>{let i=(0,e.getElement)(n,this.editor.body);i&&this.editor.highlight(i)})),s.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),s.addEventListener("click",(t=>{let i=this.editor.resolveElement((0,e.getElement)(n,this.editor.body));i&&i.focus()})),s}this.modelstatus.addEventListener("click",(s=>{if(!this.editor.conceptModel.hasError)return;let n=[];this.editor.conceptModel.concepts.forEach((t=>{t.hasError&&n.push(...t.errors.map((s=>{let n=i.call(this,t.getName(),t.id);return(0,e.createSpan)({class:["error-message"]},[n,`: ${s}`])})))})),this.editor.logs.clear(),this.editor.logs.add(n,"Validation error",t.hi.ERROR)})),this.editorstatus.addEventListener("click",(i=>{if(!this.editor.hasError)return;let s=[];s.push(...this.editor.errors.map((t=>(0,e.createSpan)({class:["error-message"]},[`${t.message}`])))),this.editor.logs.clear(),this.editor.logs.add(s,"Validation error",t.hi.ERROR)})),this.editor.registerHandler("editor.instance@active:updated",(()=>{this.updateActiveView()}))}},A={container:null,list:null,editor:null,dataList:null,fetch:null,init(e){return this.fetch=e,this},render(){const t=(0,e.createDocFragment)();return(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["container","container--editor-selectors"]})),(0,e.isHTMLElement)(this.list)||(this.list=(0,e.createUnorderedList)({class:["bare-list","editor-selectors","font-ui"]}),t.append(this.list)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){return this},update(){this.dataList=this.fetch(),(0,e.removeChildren)(this.list);let t=(0,e.valOrDefault)(this.editor.getConfig("concept"),{});return this.dataList.forEach((i=>{const{concept:s,accept:n}=i;let r=(0,e.createH4)({class:["title","editor-selector__title"]},`${a=i.name,(0,e.hasOwn)(t,a)?t[a].name:a}`);var a;s&&r.append((0,e.createSpan)({class:["editor-selector__title-concept"]},(s.name||s.prototype).replace(" ","-").toLowerCase())),n&&r.append((0,e.createSpan)({class:["editor-selector__title-accept"]},n.name)),(0,e.createButton)({class:["btn","editor-selector__header-button","editor-selector__header-button--info"],title:`View ${i.name||i.type} info`,dataset:{action:"collapse",rel:"parent",target:"selector"}},"i");let l=(0,e.createHeader)({class:["title","editor-selector__header"],title:`Expand/Collapse ${this.type}`},[r]),o=O[this.type],h=(0,e.createDiv)({class:["editor-selector__action-bar"]},o.call(this,i)),c=(0,e.createListItem)({class:["editor-selector","collapsed","font-ui"],tabindex:0,dataset:{type:this.type,alias:`${i.name||i.type}`,name:"selector",projection:i.id}},[l,h]);this.list.append(c)})),this.refresh(),this},show(){return(0,t.$Z)(this.container),this},hide(){return(0,t.Cp)(this.container),this},bindEvents(){}},O={projection:function(t){const i=(0,e.createDocFragment)();let s=(0,e.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"edit:projection",id:t.id}},"Edit");return i.append(s),i},value:function(t){const i=(0,e.createDocFragment)();let s=(0,e.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"create-instance:value",id:t.id}},(0,e.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),n=(0,e.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"copy:value",id:t.id}},(0,e.createI)({class:["ico","ico-copy","btn-content"],dataset:{ignore:"all"}})),r=(0,e.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:value",id:t.id}},(0,e.createI)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return i.append(r,n,s),i},concept:function(t){const i=(0,e.createDocFragment)();let s=this.editor.projectionModel.hasProjectionSchema(t),n=(0,e.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],disabled:!s,title:`Create an instance of "${t.name}"`,dataset:{action:"create-instance",concept:t.name}},(0,e.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+"));return s||(n.title=`The concept ${t.name} has no projection`),i.append(n),i},resource:function(t){const{name:i,type:s,required:n}=t,r=(0,e.createDocFragment)();let a=(0,e.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--add"],dataset:{action:"load-resource",id:i}},(0,e.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),l=(0,e.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:resource",id:i}},(0,e.createI)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return this.editor.getResource(i)?r.append(l):r.append(a),r}},N={editor:null,valueCount:0,fileCount:0,container:null,title:null,visible:!0,tabs:null,tabConcept:null,tabValue:null,tabProjection:null,tabResource:null,tabConceptNotification:null,tabValueNotification:null,tabProjectionNotification:null,tabResourceNotification:null,activeTab:null,activeTabValue:null,menu:null,header:null,body:null,btnHome:null,btnSave:null,btnClose:null,get isRendered(){return(0,e.isHTMLElement)(this.container)},init(e){return e&&(this.editor=e),this._conceptSelector=function(e,t,i){return Object.create(A,{object:{value:"selector"},model:{value:void 0},type:{value:"concept"},editor:{value:t}})}(0,this.editor).init((()=>this.editor.isReady?this.editor.conceptModel.getSchema("concrete").filter((e=>e.root)):[])),this},render(){const t=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["editor-header"],dataset:{name:"editor-header",alias:"header"}})),(0,e.isHTMLElement)(this.title)||(this.title=(0,e.createSpan)({class:["editor-header-title"]},"Gentleman")),(0,e.isHTMLElement)(this.menu)||(this.menu=(0,e.createDiv)({class:["editor-header-left"]},[this.title]));let i=(0,e.valOrDefault)(this.editor.getConfig("toolbar"),[]),s=(0,e.createDiv)({class:["editor-toolbar"]},i.map((t=>(0,e.createButton)({class:(0,e.valOrDefault)(t.class,[]),dataset:{name:t.name,action:t.action}},t.content))));return(0,e.isHTMLElement)(this.btnHome)||(this.btnHome=(0,e.createButton)({class:["btn","editor-toolbar__button","editor-toolbar__button--home"],title:"Toggle menu",dataset:{action:"home"}}),s.append(this.btnHome)),(0,e.isHTMLElement)(this.header)||(this.header=(0,e.createDiv)({class:["editor-header-menu"]},[this.menu,s]),t.append(this.header)),(0,e.isHTMLElement)(this.body)||(this.body=(0,e.createDiv)({class:["editor-header-main"]}),t.append(this.body)),(0,e.isHTMLElement)(this._conceptSelector.container)||this.body.append(this._conceptSelector.render()),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){let i=(0,e.valOrDefault)(this.editor.getConfig("settings"),!0),s=(0,e.valOrDefault)(this.editor.getConfig("header"),!0);return this.editor.hasConceptModel?(this._conceptSelector.update(),(0,t.$Z)(this.body)):(0,t.Cp)(this.body),!1===i&&(0,t.Cp)(this.btnHome),!1===s&&(0,t.Cp)(this.body),this},show(i){if(!(0,e.isHTMLElement)(this[i]))return(0,t.$Z)(this.container),this.visible=!0,this;(0,t.$Z)(this[i])},hide(i){if(!(0,e.isHTMLElement)(this[i]))return(0,t.Cp)(this.container),this.visible=!1,this;(0,t.Cp)(this[i])},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},bindEvents(){}};var j=0;const C={createInstance(i,s,n){if((0,e.isNullOrUndefined)(i))return this.notify("The concept is not valid",t.k$.ERROR),!1;let r="concept"===i.type?i:this.createConcept(i),a=s;(0,e.isNullOrUndefined)(a)&&this.hasProjectionModel&&(a=this.createProjection(r).init());let l=Object.create(L,{id:{value:"instance"+j++},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},concept:{value:r,writable:!0},projection:{value:a,writable:!0},editor:{value:this}});const o=Object.assign({type:"concept",resize:!0,maximize:!0,close:"DELETE-CONCEPT"},n);return l.init(o),this.addInstance(l),l},getInstance(e){return this.instances.get(e)},addInstance(e){return e.isRendered||this.instanceSection.append(e.render()),this.instances.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),e.concept.notify("displayed",e.projection.element.id),this.updateActiveInstance(e),this.refresh(),this},removeInstance(t){let i=this.getInstance(t);return!(0,e.isNullOrUndefined)(i)&&(i===this.activeInstance&&(this.activeInstance=null),i.view&&(0,e.removeChildren)(i.view).remove(),this.instances.delete(t),this.refresh(),!0)},moveInstance(e,t){return this.instanceSection.children[t].before(e),this},swapInstance(e,t){let i=Array.from(this.instanceSection.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveInstance(t,s),this.moveInstance(e,n),this}},L={window:null,container:null,title:null,visible:!0,menu:null,header:null,body:null,btnMaximize:null,btnClose:null,size:1,fullscreen:!1,collapsed:!1,schema:null,ctype:null,get isRendered(){return(0,e.isHTMLElement)(this.container)},init(t={}){return this.ctype=(0,e.valOrDefault)(t.type,"concept"),this.schema=t,this},setTitle(t){return!(0,e.isNullOrWhitespace)(t)&&(this.title.textContent=t,!0)},collapse(){return(0,t.wo)(this.container),this.collapsed=!0,this.fullscreen=!1,this.size="normal",this.refresh(),this},expand(){return(0,t.jn)(this.container),this.collapsed=!1,this.refresh(),this},changeSize(e){this.size=e,"fullscreen"===e?(this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height")):this.fullscreen=!1,this.refresh()},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},refresh(){return this.container.dataset.size=`${this.size}`,(0,e.isNullOrUndefined)(this.projection)&&(this.body.textContent="No projection found"),Array.from(this.editor.instances).some((e=>e.fullscreen))?this.editor.instanceSection.classList.add("fullscreen"):this.editor.instanceSection.classList.remove("fullscreen"),this},render(){const i=(0,e.createDocFragment)(),{name:s}=this.concept,n=s.toLowerCase();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["editor-concept",`editor-concept--${this.ctype}`],tabindex:0,dataset:{nature:"concept-container",type:this.ctype,size:1}})),(0,e.isHTMLElement)(this.header)||(this.header=(0,e.createHeader)({title:"concept"===this.schema.type?`Instance of "${n}"`:`Linked instance of "${n}"`,class:["editor-concept-header"]}),i.append(this.header)),(0,e.isHTMLElement)(this.btnClose)||(this.btnClose=(0,e.createButton)({class:["btn","editor-concept-toolbar__btn-delete"],title:`Delete the instance "${n}"`,dataset:{action:"close",context:this.type,id:this.id}}),"projection"===this.schema.type&&(this.btnClose.title=`Close the linked instance "${n}"`)),(0,e.isHTMLElement)(this.btnMaximize)||(this.btnMaximize=(0,e.createButton)({class:["btn","editor-concept-toolbar__btn-maximize"],title:`Maximize ${s.toLowerCase()}`,dataset:{action:"maximize",context:this.type,id:this.id}})),this.title=(0,e.createH3)({class:["title","editor-concept-title","fit-content"],dataset:{nature:"editable",id:this.id}},(0,e.valOrDefault)(this.schema.title,s));let r=(0,e.createDiv)({class:["editor-concept-toolbar"]},[this.btnMaximize,this.btnClose]);return(0,e.removeChildren)(this.header).append(this.title,r),this.body&&this.body.remove(),this.projection?this.body=this.projection.render():this.body=(0,e.createParagraph)(),i.append(this.body),i.hasChildNodes()&&(this.container.appendChild(i),this.bindEvents()),(0,t.n2)(this.container),this.refresh(),this.container},clear(){},actionHandler(e){switch(e){case"collapse":this.collapsed?this.expand():this.collapse();break;case"maximize":this.fullscreen?this.changeSize("normal"):this.changeSize("fullscreen");break;case"close":this.delete()}},delete(){switch(this.schema.close){case"DELETE-CONCEPT":if(!this.concept.delete(!0))return this.editor.notify("The concept could not be deleted",t.k$.ERROR),this;break;case"DELETE-PROJECTION":if(this.projection&&!this.projection.delete())return this.notify("The projection could not be deleted",t.k$.ERROR),this}(0,e.removeChildren)(this.container).remove(),this.editor.removeInstance(this.id),this.window&&this.window.removeInstance(this)},bindEvents(){this.container.addEventListener("focusin",(e=>{this.editor.updateActiveInstance(this)}))}};var S=0;const k={createWindow(e){let t=Object.create(T,{id:{value:"window"+S++},object:{value:"environment"},name:{value:"editor-window"},type:{value:"window"},editor:{value:this}});return t.refname=e,t.init(),this.addWindow(t),t},getWindow(e){return this.windows.get(e)},findWindow(e){return Array.from(this.windows.values()).find((t=>t.refname===e))},addWindow(e){return e.isRendered||this.body.append(e.render()),this.windows.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.refresh(),this},removeWindow(t){let i=this.getWindow(t);return!(0,e.isNullOrUndefined)(i)&&(i===this.activeWindow&&(this.activeWindow=null),i.view&&(0,e.removeChildren)(i.view).remove(),this.windows.delete(t),this.refresh(),!0)},moveWindow(e,t){return this.body.children[t].before(e),this},swapWindow(e,t){let i=Array.from(this.body.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveWindow(t,s),this.moveWindow(e,n),this}},T={container:null,title:null,visible:!0,instances:null,menu:null,header:null,body:null,btnClose:null,maxInstance:1,get isRendered(){return(0,e.isHTMLElement)(this.container)},init(t={}){return this.ctype=(0,e.valOrDefault)(t.type,"concept"),this.schema=t,this.instances=new Set,this},isEmpty(){return 0===this.instances.size},show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},close(){(0,e.removeChildren)(this.container).remove(),this.editor.removeWindow(this.id)},refresh(){return this.isEmpty()?this.hide():this.show(),this},render(){const t=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["editor-window"],tabindex:-1})),(0,e.isHTMLElement)(this.header)||(this.header=(0,e.createHeader)({class:["editor-window-header"]}),t.append(this.header)),(0,e.isHTMLElement)(this.title)||(this.title=(0,e.createH3)({class:["title","editor-window-title","fit-content"]})),(0,e.isHTMLElement)(this.btnClose)||(this.btnClose=(0,e.createButton)({class:["btn","editor-window-header__btn-delete"],title:"Close the window",dataset:{action:"close",context:this.type,id:this.id}}));let i=(0,e.createDiv)({class:["editor-window-toolbar"]},[this.btnClose]);return(0,e.removeChildren)(this.header).append(this.title,i),t.hasChildNodes()&&(this.container.appendChild(t),this.bindEvents()),this.refresh(),this.container},getInstance(t){return(0,e.isNullOrUndefined)(t)?null:Array.from(this.instances).find((e=>e.id===t))},addInstance(t){if(!(0,e.isNullOrUndefined)(t)&&!this.instances.has(t))return this.instances.add(t),t.window=this,this.container.append(t.container),this.refresh(),!0},removeInstance(t){if(!(0,e.isNullOrUndefined)(t)&&this.instances.has(t))return this.instances.delete(t),this.refresh(),!0},actionHandler(e){switch(e){case"close":this.close()}},bindEvents(){}},M={schema:null,isOpen:!1,visible:!0,btnClose:null,btnExport:null,outputName:null,selector:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,e.isHTMLElement)(this.container)},clear(){return(0,e.removeChildren)(this.logList),this},update(){},render(){const t=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["editor-exporter"]})),(0,e.isHTMLElement)(this.btnClose)||(this.btnClose=(0,e.createButton)({title:"Close window",class:["btn","btn-collapse"]}),t.append(this.btnClose));let i=(0,e.createH4)({class:["editor-exporter-title"]},"Export model");if(t.append(i),(0,e.isNullOrUndefined)(this.selector)){let i=(0,e.createParagraph)({class:["editor-exporter__instruction"]},"Select the export format");this.selector=(s=["JSON","XML"],Object.create(I).init(s)),t.append(i,this.selector.render()),this.selector.select("JSON")}var s;if(!(0,e.isHTMLElement)(this.outputName)){let i=(0,e.createLabel)({class:["editor-exporter-file__label"]}),s=(0,e.createLabel)({class:["editor-exporter-file__label-value"]},"File");this.outputName=(0,e.createInput)({placeholder:"File name",class:["editor-exporter-file__input"]}),i.append(s,this.outputName),t.append(i)}return(0,e.isHTMLElement)(this.btnExport)||(this.btnExport=(0,e.createButton)({class:["btn","btn-export"]},"Export"),t.append(this.btnExport)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),this.refresh(),this.container},refresh(){return this},execute(){switch(this.selector.getValue()){case"JSON":this.toJSON(this.outputName.value);break;case"XML":this.toXML(this.outputName.value)}},toXML(){const{conceptModel:e}=this.editor,t=e.toXML();this.editor.download(t,`${this.outputName.value}.xml`,"XML")},toJSON(){const{conceptModel:e}=this.editor,t=JSON.stringify({concept:e.schema,values:e.export()});this.editor.download(t,`${this.outputName.value}.json`,"JSON")},isValid(){return!(0,e.isNullOrWhitespace)(this.outputName.value)},bindEvents(){this.btnClose.addEventListener("click",(e=>{this.close()})),this.btnExport.addEventListener("click",(e=>{if(!this.isValid())return(0,t.lL)(this.btnExport),void this.editor.notify("Enter the file name",t.k$.ERROR,3e3);this.execute()}))}},I={container:null,values:null,selectors:null,selected:null,value:null,init(t){return this.values=(0,e.valOrDefault)(t,[]),this.selectors=new Map,this},getValue(){return this.value},refresh(){(0,e.isNullOrUndefined)(this.value)?this.container.classList.add("empty"):this.container.classList.remove("empty")},render(){let t=!1;return(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createUnorderedList)({class:["bare-list","export-selector"]}),t=!0),this.values.forEach((e=>{let t=this.createItem(e);this.container.append(t)})),t&&this.bindEvents(),this.container},select(t){if((0,e.isNullOrUndefined)(t))return;if(!this.selectors.has(t))return;let i=this.selectors.get(t);this.setSelectedItem(i),this.value=t,this.refresh()},createItem(t){let i=(0,e.createListItem)({class:["export-selector-item"],dataset:{value:t}}),s=(0,e.createLabel)({class:["export-selector-item__label"]}),n=(0,e.createInput)({type:"radio",name:"export-choice",value:t,class:["export-selector-item__input"]});return s.append(n,t),i.append(s),this.addItem(t,i),i},addItem(e,t){return this.selectors.set(e,t),this.refresh(),this},getItem(e){return this.selectors.get(e)},setSelectedItem(i){return!(!(0,e.isHTMLElement)(i)||i.parentElement!==this.container)&&(this.selected!==i?(this.selected&&(0,t.hF)(this.selected),this.selected=i,(0,t.Ys)(this.selected),!0):void 0)},bindEvents(){this.container.addEventListener("change",(t=>{const{target:i}=t;(0,e.isNullOrUndefined)(i.value)||this.select(i.value)}))}},U={container:null,isOpen:!1,visible:!0,show(){return(0,t.$Z)(this.container),this.visible=!0,this},hide(){return(0,t.Cp)(this.container),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this.editor.refresh(),this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this.editor.refresh(),this}};function H(){return Object.create(N,{object:{value:"environment"},name:{value:"editor-header"},editor:{value:this}})}function D(){return Object.create(w,{object:{value:"environment"},name:{value:"editor-breadcrumb"},type:{value:"breadcrumb"},editor:{value:this}})}function V(){return Object.assign(Object.create(U,{object:{value:"environment"},name:{value:"editor-home"},type:{value:"home"},editor:{value:this}}),m)}function B(){return Object.create(E,{object:{value:"environment"},name:{value:"editor-status"},type:{value:"status"},editor:{value:this}})}function P(){return Object.assign(Object.create(U,{object:{value:"environment"},name:{value:"editor-log"},type:{value:"log"},editor:{value:this}}),x)}function R(){return Object.assign(Object.create(U,{object:{value:"environment"},name:{value:"editor-exporter"},type:{value:"exporter"},editor:{value:this}}),M)}const _={getHandlers(t){return(0,e.valOrDefault)(this.handlers.get(t),[])},triggerEvent(t,i,s=!0){const{name:n,options:r,args:a}=t,l=this.getHandlers(n),o=(0,e.isFunction)(i);let h=!1;return l.forEach((e=>{let t=e.call(this,a,r);!1!==t?s&&o&&i.call(this,t):h=!0})),!h&&(!s&&o&&i.call(this),!0)},registerHandler(e,t){return this.hasHanlder(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),!0},unregisterHandler(e,t){if(!this.hasHanlder(e))return!1;let i=this.getHandlers(e);for(let e=0;e<i.length;e++)if(i[e]===t)return i.splice(e,1),!0;return!1},hasHanlder(e){return this.handlers.has(e)},registerReceiver(t,i){(0,e.isNullOrUndefined)(this.activeReceiver[i])&&(this.activeReceiver[i]=t),(0,e.isNullOrUndefined)(this.receivers[i])&&(this.receivers[i]={root:t,projections:[]},t.isRoot=!0),this.receivers[i].projections.push(t)},saturationRevolved(e,t){console.log("Revolving"),console.log(t),console.log(this.receivers);let i,s=this.receivers[t].projections;for(let t=0;t<s.length;t++)e.id===s[t].id&&(i=t);if(i>=s.length)return void this.setActiveReceiver(e,t);let n=s[i+1].transmitFirst();console.log("Transmitting first"),console.log(n),e.acceptAnchor(n)},getActiveReceiver(e){return this.activeReceiver[e]},setActiveReceiver(e,t){this.activeReceiver[t]=e},getRootReceiver(e){return this.receivers[e].root},findReceiverInstance(t,i){let s=this.receivers[i].projections;for(let i=0;i<s.length;i++){let n=s[i].instances.get(t);if((0,e.isHTMLElement)(n))return{container:s[i],instance:n}}alert("Not Found")}};var $=s(914);const F={create(e,t){const i=Object.create(this);return i.concept=e,i.schema=t,i},model:null,schema:null,source:null,id:null,value:null,object:"structure",init(e){throw new Error("This function has not been implemented")}};Object.defineProperty(F,"model",{get(){return this.concept.model}}),Object.defineProperty(F,"name",{get(){return this.schema.name}}),Object.defineProperty(F,"required",{get(){return(0,e.valOrDefault)(this.schema.required,!0)}});const z={object:"attribute",target:null,init(t){return this.target=this.model.createConcept(this.schema.target,{value:(0,e.valOrDefault)(t,this.schema.value),parent:this.concept,ref:this}),this},getValue(){return this.target.getValue()},hasValue(){return this.target.hasValue()},setValue(e){this.target.setValue(e)},getTarget(){return this.target},copy(){return this.target.hasValue()?this.target.copy(!1):null},clone(){return this.target.hasValue()?this.target.clone():null},export(){return this.target.hasValue()?{id:this.target.id,name:this.target.name}:null},toString(){return{[`attribute.${this.name}`]:this.target.toString()}},toXML(){return this.target.hasValue()?this.target.toXML():""}},W=Object.assign(Object.create(F),z),q={attributes:null,attributes_created:null,initAttribute(){return this.attributes=[],this.attributes_created=new Set,this.attributes_updated=new Set,this.attributes_deleted=new Set,Array.isArray(this.attributeSchema)&&this.attributeSchema.filter((t=>(0,e.valOrDefault)(t.required,!0))).forEach((e=>this.createAttribute(e.name))),this},getAttributes(){return this.attributes},getAttribute(t){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad argument");return this.getAttributeByName(t)},getAttributeSchema(t){if((0,e.isNullOrWhitespace)(t))throw new TypeError("Bad argument");if(!this.hasAttribute(t))throw new Error(`Attribute '${t}' does not exist`);return(0,e.cloneObject)(this.attributeSchema.find((e=>e.name===t)))},getAttributeByName(t){if((0,e.isNullOrWhitespace)(t))throw new TypeError("Bad argument");var i=this.attributes.find((e=>e.name===t));return(0,e.isNullOrUndefined)(i)&&(i=this.createAttribute(t)),i},createAttribute(e,t){if(!this.hasAttribute(e))throw new Error(`Attribute not found: The concept '${this.name}' does not contain an attribute named '${e}'`);if(this.isAttributeCreated(e)){let i=this.getAttributeByName(e);if(t){let e=this.model.getValue(t);i.target.initValue(e)}return i}const i=this.getAttributeSchema(e);let s=this.model.getValue(t);var n=W.create(this,i).init(s);return this.addAttribute(n),n},addAttribute(t){if((0,e.isNullOrUndefined)(t)||"attribute"!==t.object)throw new Error("Bad argument: 'attribute' must be an attribute object");return this.attributes.push(t),this.attributes_created.add(t.name),this.notify("attribute.added",t),this},hasAttributes(){return!(0,e.isEmpty)(this.attributeSchema)||!(0,e.isEmpty)(this.attributes)},hasAttribute(e){return-1!==this.attributeSchema.findIndex((t=>t.name===e))},isAttributeRequired(t){const i=this.getAttributeSchema(t);return(0,e.valOrDefault)(i.required,!0)},isAttributeCreated(e){return this.attributes_created.has(e)},listAttributes(){const e=[];return this.attributeSchema.forEach((t=>{e.push({type:"attribute",name:t.name,target:t.target,accept:t.accept,required:this.isAttributeRequired(name),created:this.isAttributeCreated(name)})})),e},removeAttribute(e){if(this.isAttributeRequired(e))return{message:`The attribute '${e}' is required.`,success:!1};var t=this.attributes.findIndex((t=>t.name===e));if(-1===t)return{message:`The attribute '${e}' was not found.`,success:!1};var i=this.attributes.splice(t,1)[0];return this.attributes_created.delete(e),this.notify("attribute.removed",i),{message:`The attribute '${e}' was successfully removed.`,success:!0}}},X={listeners:null,initObserver(){return this.listeners=[],this},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){var t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t,this)}))}},Y={model:null,schema:null,source:null,id:null,name:null,ref:null,actions:null,operations:null,accept:null,parent:null,references:null,errors:null,value:null,values:null,action:null,shadows:null,watchers:null,kind:"concept",init(t={}){return this.accept=t.accept,this.parent=t.parent,this.ref=t.ref,this.properties=(0,e.valOrDefault)(this.schema.properties,[]),Array.isArray(t.properties)&&this.properties.push(...t.properties),this.default=(0,e.valOrDefault)(this.schema.default,null),this.values=(0,e.valOrDefault)(t.values,(0,e.valOrDefault)(this.schema.values,[])),this.src=(0,e.valOrDefault)(this.schema.src,[]),this.constraint=this.schema.constraint,this.watchers=new Map,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},isRoot(){return(0,e.isNullOrUndefined)(this.parent)},initValue(){throw new Error("This function has not been implemented")},getName(){return this.ref&&"attribute"===this.ref.object?this.ref.name:this.name},getCandidates(){return this.values.forEach((t=>{(0,e.isObject)(t)&&(t.type="value")})),this.values},getStructure(){return[...this.listAttributes()]},getProperty(t,i){if("refname"===t){if((0,e.isNullOrUndefined)(this.ref))return;return this.ref.name}if("name"===t)return this.name;if("value"===t)return this.value;if(!this.hasProperty(t))return;let s=this.properties.find((e=>e.name===t));const{type:n,value:r}=s;return"string"===n?Z.call(this,r):"number"===n?+r:"boolean"===n?(0,e.toBoolean)(r):r},hasProperty(t){return!!["refname","name","value"].includes(t)||-1!==(0,e.valOrDefault)(this.schema.properties,[]).findIndex((e=>e.name===t))},getConstraint(e){if(this.hasConstraint(e))return this.constraint[e]},hasConstraint(t){return!(0,e.isNullOrUndefined)(this.constraint)&&(!!(0,e.isNullOrUndefined)(t)||(0,e.hasOwn)(this.constraint,t))},hasParent(){return!this.isRoot()},getParent(t){if(this.isRoot())return null;if((0,e.isNullOrWhitespace)(t))return this.parent;const i=this.parent;return i.name===t?i:i.getParent(t)},getParentWith(t){if(this.isRoot())return null;if((0,e.isNullOrWhitespace)(t))return this.parent;const i=this.parent;return i.hasPrototype(t)?i:i.getParentWith(t)},getPrototype(){return(0,e.isNullOrUndefined)(this.prototype)?null:this.prototype},hasPrototype(t){if((0,e.isNullOrUndefined)(this.schema.prototype))return!1;if((0,e.isNullOrUndefined)(t))return!0;let i=this.model.getConceptSchema(this.schema.prototype);for(;!(0,e.isNullOrUndefined)(i);){if(i.name===t)return!0;i=this.model.getConceptSchema(i.prototype)}return!1},getAncestor(e){const t=[];for(var i=this.getParent(e);i;)t.push(i),i=i.getParent(e);return t},getChildren(t){const i=[];return(0,e.isNullOrUndefined)(t)?this.getAttributes().forEach((e=>{i.push(e.target)})):this.getAttributes().forEach((e=>{e.target.name===t?i.push(e.target):i.push(...e.target.getChildren(t))})),i},getDescendant(e){const t=[];return this.getChildren(e).forEach((i=>{t.push(i),t.push(...i.getDescendant(e))})),t},propagate(e,t,i){this.watchers.has(e)&&this.signal(e,t,i),this.hasParent()&&this.getParent().propagate(e,t,i)},watch(e,t){this.watchers.has(e)||this.watchers.set(e,[]),this.watchers.get(e).push(t)},signal(e,t,i){this.watchers.has(e)&&this.watchers.get(e).forEach((e=>e(t,this)))},unwatch(t,i){if((0,e.isNullOrUndefined)(t)||!this.watchers.has(t))return!1;if(!(0,e.isFunction)(i))return this.watchers.delete(t),!0;let s=this.watchers.get(t).findIndex((e=>e===i));return-1!==s&&(this.watchers.splice(s,1),!0)},done(){this.unregisterAll(),this.watchers.clear()},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}this.getChildren().forEach((e=>{e&&e.delete(!0)}));try{this.model.removeConcept(this.id)&&this.notify("delete")}catch(e){return console.error(this),{message:"Concept not found",success:!1}}return{message:`The concept '${this.name}' was successfully deleted.`,success:!0}},copy(e=!0){const t={name:this.name,nature:this.nature};var i=[];return this.getAttributes().forEach((e=>{i.push({name:e.name,value:e.copy(!1)})})),t.attributes=i,e&&this.model.addValue(t),t},clone(){const e={id:this.id,name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.clone()})})),e.attributes=t,e},export(){const e={id:this.id,root:this.isRoot(),name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.export()})})),e.force=this.force,e.attributes=t,e},toString(){var e={};return this.attributes.forEach((t=>{Object.assign(e,t.toString())})),e},toXML(){let e=this.getName().replace(" ","-");return`<${e} id="${this.id}">`+this.attributes.map((e=>e.toXML())).join("")+`</${e}>`},toXMI(){let e=this.getName().replace(" ","-");return`<${e} id="${this.id}">`+this.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function Z(t){if((0,e.isString)(t))return t;const{type:i}=t;switch(i){case"concat":return J.call(this,t.concat)}}function G(e,t){const{type:i}=e;return"string"===i?Z.call(this,e.value):"property"===i?this.getProperty(e.name):t||e}function J(e,t=""){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");return e.length<2?G.call(this,e[0]):e.map((e=>G.call(this,e))).join(t)}const K=Object.assign(Y,X,q);Object.defineProperty(K,"attributeSchema",{get(){return this.schema.attributes}}),Object.defineProperty(K,"_prototype",{get(){return this.schema.prototype}}),Object.defineProperty(K,"hasError",{get(){return this.errors&&!(0,e.isEmpty)(this.errors)}});const Q={nature:"primitive",init(t={}){return this.parent=t.parent,this.ref=t.ref,this.default=(0,e.valOrDefault)(this.schema.default,!0),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},initValue(t){if((0,e.isNullOrUndefined)(t))return this.value=this.default,this;if((0,e.isObject)(t)){const{id:e="",value:i}=t;e.length>10&&(this.id=e),this.setValue(i)}else this.setValue(t);return this},hasValue(){return!(0,e.isNullOrUndefined)(this.value)},getValue(){return this.value},setValue(t){let i=(0,e.isObject)(t)?t.value:t;return 200!==this.validate(i)?{success:!1,message:"Validation failed: The value could not be updated."}:(this.value=(0,e.toBoolean)(i),this.notify("value.changed",i),{success:!0,message:"The value has been successfully updated."})},restore(e){const{value:t}=e;this.setValue(t)},update:(e,t)=>!0,getCandidates:()=>[!0,!1],getChildren:e=>[],validate(t){return this.errors=[],(0,e.isString)(t)&&["true","false"].includes(t.toLowerCase())||Number.isInteger(t)&&[1,0].includes(t)||[!0,!1].includes(t)?200:400},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}},ee=Object.assign(Object.create(K),Q);function te(e,t){switch(e){case 400:return{success:!1,message:"The value is not a number."};case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum allowed: ${t.value}.`};case 402:return{success:!1,message:`Minimum allowed: ${t.value}.`};case 404:return{success:!1,message:`Value allowed: ${t.value}.`}}}const ie={nature:"primitive",initValue(t){if((0,e.isNullOrUndefined)(t))return this.value=this.default,this;if((0,e.isObject)(t)){const{id:e="",value:i}=t;e.length>10&&(this.id=e),this.setValue(i)}else this.setValue(t);return this},hasValue(){return"number"==typeof this.value&&!isNaN(this.value)},getValue(){return this.hasValue()?+this.value:null},setValue(t){let i=(0,e.isObject)(t)?t.value:t;const{code:s,ctx:n}=this.validate(i);return this.value!==i&&(this.value=(0,e.isNullOrWhitespace)(i)?null:+i,this.notify("value.changed",i),this.propagate("value.changed",i,this)),200!==s?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},restore(e){const{value:t}=e;this.setValue(t)},getCandidates(){return this.values.forEach((t=>{(0,e.isObject)(t)&&(t.type="value")})),this.values},getChildren:e=>[],update:(e,t)=>!0,validate(t){if(this.errors=[],isNaN(t)){let e=400;return this.errors.push(te.call(this,e).message),{code:e}}if(!this.hasConstraint())return{code:200};if(this.hasConstraint("value")){let e=this.getConstraint("value");const{type:i}=e;if("range"===i){const{min:s,max:n}=e[i];if(s&&+t<s.value){let e=402;return this.errors.push(te.call(this,e,s).message),{code:e,ctx:s}}if(n&&+t>n.value){let e=403;return this.errors.push(te.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=e[i];if(t!==s){let t=404;return this.errors.push(te.call(this,t,e[i]).message),{code:t,ctx:e[i]}}}}if(this.hasConstraint("values")){let i=this.getConstraint("values").map((e=>se.call(this,e))).flat(),s=!1;for(let n=0;!s&&n<i.length;n++){const r=i[n];s=(0,e.isObject)(r)?r.value===t:r===t}if(!s){let e=401;return this.errors.push(te.call(this,e,i).message),{code:e,ctx:i}}}return{code:200}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function se(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}const ne=Object.assign(Object.create(K),ie),re={nature:"primitive",reference:null,path:null,init(t={}){return this.parent=t.parent,this.ref=t.ref,this.accept=this.schema.accept,this.path=this.schema.path,this.values=(0,e.valOrDefault)(this.schema.values,[]),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},initValue(t){return(0,e.isNullOrUndefined)(t)||this.setValue(t.value),this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!(0,e.isNullOrWhitespace)(this.value)},getValue(t=!1){return(0,e.isNullOrUndefined)(this.value)?null:t?this.reference:this.value},removeValue(){return this.reference&&this.reference.unregister(this),this.reference=null,this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getReference(){return(0,e.isNullOrUndefined)(this.reference)?null:this.reference},setValue(t,i=!0){let s=(0,e.isObject)(t)?t.id:t;return 200!==this.validate(s)?{success:!1,message:"Validation failed: The value could not be updated."}:(0,e.isNullOrUndefined)(s)||this.value===s?{success:!0,message:"The value has been ignored."}:(this.reference&&this.reference.unregister(this),this.value=s,this.reference=this.model.getConcept(s),console.log("This.ref"),console.log(this.reference),console.log(this),(0,e.isNullOrUndefined)(this.reference)&&i?setTimeout((()=>this.setValue(t,!1)),20):(this.reference.register(this),this.notify("value.changed",this.reference)),{success:!0,message:"The value has been successfully updated."})},getCandidates(){if((0,e.isNullOrUndefined)(this.accept))throw new Error("Bad reference: 'accept' property is not defined");var t=ae.call(this,this.accept);return this.path&&le(this,this.path).map((e=>({type:this.accept.type,value:e}))),t},getChildren(t){return(0,e.isNullOrUndefined)(this.reference)||t&&this.reference.name!==t?[]:[this.reference]},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(console.log("Updating"),console.log(e),e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference);break;case"value.changed":console.log("Received message"),this.setValue(this.value)}return!0},validate(t){return this.errors=[],(0,e.isNullOrUndefined)(t)||this.model.hasConcept(t)?200:(this.errors.push("This element is not valid"),401)},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function ae(e){const{name:t,scope:i,rel:s}=e;return"parent"===s?this.getParent(i).getChildren(t):"children"===s?this.getChildren(t):this.model.isPrototype(t)?this.model.getConceptsByPrototype(t):this.model.getConcepts(t)}function le(t,i){if((0,e.isNullOrUndefined)(i))return t;const{target:s,value:n,rel:r}=i;var a=[];return"parent"===r?a.push(t.getParentWith(s)):"children"===r?a.push(...t.getChildren(s)):"property"===r&&a.push(t.getProperty(s)),a.map((e=>le(e,n))).flat()}const oe=Object.assign({},K,re),he={SUCCESS:200,INVALID_VALUE:401,MIN_CARDINALITY_ERROR:402,MAX_CARDINALITY_ERROR:403,FIX_CARDINALITY_ERROR:404};function ce(e,t){switch(e){case he.INVALID_VALUE:return{success:!1,message:`Valid values: ${t}`};case he.MAX_CARDINALITY_ERROR:return{success:!1,message:`Maximum cardinality: ${this.value.length}/${t.value}.`};case he.MIN_CARDINALITY_ERROR:return{success:!1,message:`Minimum cardinality: ${this.value.length}/${t.value}.`};case he.FIX_CARDINALITY_ERROR:return{success:!1,message:`Fixed cardinality: ${t.value}.`};case he.PATTERN_ERROR:return{success:!1,message:"The value is not valid."}}}const de={nature:"primitive",init(t={}){return this.parent=t.parent,this.ref=t.ref,this.accept=this.schema.accept,this.ordered=(0,e.valOrDefault)(this.schema.ordered,!0),this.constraint=this.schema.constraint,this.watchers=new Map,this.value=[],this.initObserver(),this.initAttribute(),this.initValue(t.value),this},initValue(t){this.removeAllElement();let i=ue.call(this);if((0,e.isNullOrUndefined)(t)){let e=i;for(let t=0;t<e;t++)this.createElement();return this}const{id:s="",name:n,value:r}=t;s.length>10&&(this.id=s);for(let e=0;e<r.length;e++)this.createElement(r[e]);let a=i-r.length;for(let e=0;e<a;e++)this.createElement();return this},hasValue(){return!(0,e.isEmpty)(this.value)},getValue(e=!1){const t=this.value.map((e=>this.model.getConcept(e)));return e?t.map((e=>e.getValue())):t},removeValue(e){return this.hasValue()?(this.removeElement(e),{success:!0,message:"The value has been successfully updated."}):{success:!0,message:"The value has been successfully updated."}},isValidElement(t){const{name:i,accept:s}=this.accept;return this.model.isPrototype(i)?(0,e.isNullOrUndefined)(s)?this.model.hasPrototype(t.name,i):Array.isArray(s)?s.some((e=>e.name===t.name)):s.name===t.name:this.accept.name===t.name},setValue(e){let t=e.value||e;if(Array.isArray(t)){this.removeAllElement();for(let e=0;e<t.length;e++)this.createElement(t[e])}else this.isValidElement(t)&&this.createElement(t)},restore(e){const{value:t}=e;t.forEach(((e,t)=>{this.value.includes(e.id)||this.createElement(e)}))},getElements(){return this.value.map((e=>this.model.getConcept(e)))},getElement(t){var i=this.value.find((e=>e===t));if(!(0,e.isNullOrUndefined)(i))return this.model.getConcept(i)},getElementAt(e){if(!(e<0||e>=this.value.length))return this.model.getConcept(this.value[e])},getFirstElement(){return this.getElementAt(0)},getLastElement(){return this.getElementAt(this.count-1)},addElement(t){return!(0,e.isNullOrUndefined)(t)&&(this.value.push(t.id),t.index=this.value.length-1,t.parent=this,t.ref=this,this.validate(),this.notify("value.added",t),this.propagate("value.changed",t,this),!0)},addElementAt(t,i=0){return(0,e.isNullOrUndefined)(t)&&(t=this.createElement()),this.value.splice(i,0,t.id),this.validate(),this.notify("value.added",t),this.propagate("value.changed",t,this),this},swapElement(e,t){if(!this.ordered)return this;let i=this.value[e];this.value[e]=this.value[t],this.value[t]=i;let s=this.getElementAt(e);s.index=+e;let n=this.getElementAt(t);return n.index=+t,this.notify("value.swapped",[s,n]),this},removeElement(t){let i=(0,e.valOrDefault)(t.index,this.value.indexOf(t.id));return-1!==i&&this.removeElementAt(i)},removeElementAt(t){let i=this.getElementAt(t);if((0,e.isNullOrUndefined)(i))return{message:`The element at index '${t}' was not found.`,success:!1};i.delete(!0),this.value.splice(t,1);const s=this.getValue();for(let e=t;e<s.length;e++)s[e].index=e;return this.validate(),this.notify("value.removed",i),this.propagate("value.changed",i,this),{message:`The element '${i.name}' was successfully removed.`,success:!0}},removeAllElement(){return this.value.forEach((e=>{this.model.removeConcept(e)})),this.value=[],this.notify("value.changed",this.value),this.propagate("value.changed",this.value,this),this},createElement(e){const t={value:this.model.getValue(e),parent:this,ref:this},i=this.model.createConcept(this.accept,t);return this.addElement(i),i},getProperty(t,i){if("refname"===t)return this.ref.name;if("name"===t)return this.name;if("value"===t)return this.value;if("length"===t||"cardinality"===t)return this.value.length;let s=this.properties.find((e=>e.name===t));if((0,e.isNullOrUndefined)(s))return;const{type:n,value:r}=s;return"string"===n?r:"number"===n?+r:"boolean"===n?(0,e.toBoolean)(r):r},hasProperty(e){return!!["refname","name","value","length","cardinality"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){return me.call(this,this.accept)},getChildren(t){if(!this.hasValue())return[];const i=this.getElements();return(0,e.isNullOrUndefined)(t)?i:i.filter((e=>e.name===t))},validate(){if(this.errors=[],!this.hasConstraint())return{code:he.SUCCESS};if(this.hasConstraint("cardinality")){let e=this.getConstraint("cardinality");const{type:t}=e;if("range"===t){const{min:i,max:s}=e[t];if(i&&this.value.length<i.value){let e=he.MIN_CARDINALITY_ERROR;return this.errors.push(ce.call(this,e,i).message),{code:e,ctx:i}}if(s&&this.value.length>s.value){let e=he.MAX_CARDINALITY_ERROR;return this.errors.push(ce.call(this,e,s).message),{code:e,ctx:s}}}else if("fixed"===t){const{value:i}=e[t];if(this.value.length!==i){let i=he.FIX_CARDINALITY_ERROR;return this.errors.push(ce.call(this,i,e[t]).message),{code:i,ctx:e[t]}}}}return{code:he.SUCCESS}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue().map((e=>e.copy(!1)))};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue().map((e=>e.clone()))}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.value}},toString(){return this.getValue().map((e=>e.toString()))},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue().map((e=>e.toXML())).join("")+`</${e}>`}};function ue(){if(!this.hasConstraint("cardinality"))return 0;const e=this.getConstraint("cardinality"),{type:t}=e;if("range"===t){const{min:i}=e[t];return i.value}if("fixed"===t){const{value:i}=e[t];return i}return 0}function me(e){return this.model.getConceptSchema(e)}const pe=Object.assign(Object.create(K),de);Object.defineProperty(pe,"count",{get(){return this.value.length}}),Object.defineProperty(pe,"canAddValue",{get:()=>!0});const fe=200,ge=405;function ve(e,t){switch(e){case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum length: ${t.value}.`};case 402:return{success:!1,message:`Minimum length: ${t.value}.`};case 404:return{success:!1,message:`Fixed length: ${t.value}.`};case ge:return{success:!1,message:"The value is not valid."};case 406:return{success:!1,message:"The value is already used."}}}const be={nature:"primitive",initValue(t){if((0,e.isNullOrUndefined)(t))return this.value=this.default,this;if((0,e.isObject)(t)){const{id:e="",value:i}=t;e.length>10&&(this.id=e),this.setValue(i)}else this.setValue(t);return this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!(0,e.isNullOrWhitespace)(this.value)},getValue(){return this.value},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},setValue(t){let i=(0,e.isObject)(t)?t.value:t;var{code:s,ctx:n}=this.validate(i);return this.value!==i&&(this.value=i,this.notify("value.changed",i),this.propagate("value.changed",i,this)),s!==fe?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},getProperty(t,i){if("refname"===t)return this.ref.name;if("name"===t)return this.name;if("value"===t)return this.value;if("length"===t)return this.value.length;let s=this.properties.find((e=>e.name===t));if((0,e.isNullOrUndefined)(s))return;const{type:n,value:r}=s;return"string"===n?r:"number"===n?+r:"boolean"===n?(0,e.toBoolean)(r):r},hasProperty(e){return!!["refname","name","value","length"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){let i=(0,e.valOrDefault)(this.getConstraint("values"),[]);return(0,e.isEmpty)(i)?[...this.src.map((i=>{if("reference"===i.type){const{source:s,target:n}=i;let r=this.model.environment.getModel(s.name||s);if((0,e.isNullOrUndefined)(r))return null;let a=r.concept||r;if(!Array.isArray(a))return null;if(a.forEach((i=>{const s=function(i,s){var n=s;const r=[],a=s=>{let n=i.find((e=>e.name===s));if(!(0,e.isNullOrUndefined)(n))return(0,t.p$)(n)};for(;!(0,e.isNullOrUndefined)(n);){const t=(0,e.valOrDefault)(a(n),{});l=t.attributes,Array.isArray(l)&&l.forEach((t=>{const i=r.find((e=>e.name===t.name));(0,e.isNullOrUndefined)(i)?r.push(t):t.required&&(i.required=t.required)})),n=t.prototype}var l;return{attributes:r}}(a,i.prototype);i.attributes.push(...s.attributes)})),(0,e.isNullOrUndefined)(n.rel))return a.map((e=>e[n.value]));let l=we.call(this,n,a);return(0,e.isNullOrUndefined)(l)?[]:l}if("concept"===i.type){const{concept:e,value:t}=i;let s=this.model.getConceptsByPrototype(e.prototype);return"attribute"===t.type?s.map((e=>e.getAttribute(t.name).getValue())):[]}return i}))].flat().filter((t=>!(0,e.isNullOrUndefined)(t))):i.map((e=>ye.call(this,e))).flat().filter((t=>!(0,e.isNullOrWhitespace)(t)))},getChildren:e=>[],update:(e,t)=>!0,validate(t){if(this.errors=[],(0,e.isNullOrWhitespace)(t))return{code:fe};if(!this.hasConstraint())return{code:fe};if(this.hasConstraint("length")){let e=this.getConstraint("length");const{type:i}=e;if("range"===i){const{min:s,max:n}=e[i];if(s&&t.length<s.value){let e=402;return this.errors.push(ve.call(this,e,s).message),{code:e,ctx:s}}if(n&&t.length>n.value){let e=403;return this.errors.push(ve.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=e[i];if(t.length!==s){let t=404;return this.errors.push(ve.call(this,t,e[i]).message),{code:t,ctx:e[i]}}}}if(this.hasConstraint("value")){let e=this.getConstraint("value");const{type:i}=e;if("pattern"===i){const{value:i,insensitive:s=!0,global:n=!0}=e.pattern;let r="";if(s&&(r+="g"),n&&(r+="i"),!new RegExp(i,r).test(t)){let t=ge;return this.errors.push(ve.call(this,t,e.pattern).message),{code:t,ctx:e.pattern}}}else if(i==="match".startsWith){const{start:s,end:n}=e[i];if(s&&!t.startsWith<s.value){let t=ge;return this.errors.push(ve.call(this,t,e.match).message),{code:t,ctx:e.match}}if(n&&t.length>n.value){let t=ge;return this.errors.push(ve.call(this,t,e.match).message),{code:t,ctx:e.match}}}else if("unique"===i){const{rel:i="parent",prototype:s}=e.unique;let n=this.getParent(),r=[];if(s?(n.hasPrototype()||(r=[]),r=this.model.getConceptsByPrototype(n._prototype)):r=this.model.getConcepts(n.name),r.some((e=>e!==n&&Ee(e,this.ref.name)===t))){let t=406;return this.errors.push(ve.call(this,t,e.unique).message),{code:t,ctx:e.unique}}}}if(this.hasConstraint("values")){let i=this.getConstraint("values").map((e=>ye.call(this,e))).flat(),s=!1;for(let n=0;!s&&n<i.length;n++){const r=i[n];s=(0,e.isObject)(r)?r.value===t:r===t}if(!s){let e=401;return this.errors.push(ve.call(this,e,i).message),{code:e,ctx:i}}}return{code:fe}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function ye(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}if("meta-reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}function we(t,i){const{name:s,rel:n,scope:r,value:a}=t;let l=null;if("parent"===n){let t=this.getParent(s);if((0,e.isNullOrUndefined)(a))return t;if("reference"===a.type)return we.call(t,a);if("attribute"===a.type)return t.getAttributeByName(a.name).getValue()}if("children"===n){let t=this.getChildren(s);if((0,e.isNullOrUndefined)(a))return t;if("reference"===a.type)return t.map((e=>we.call(e,a)));if("attribute"===a.type)return t.filter((e=>Oe(e,a.name)&&Ae(e,a.name))).map((e=>Ee(e,a.name)))}if(t.source){const{type:e,value:i}=t.source;l="reference"===e?we.call(this,t.source):i}if((0,e.isNullOrUndefined)(l))return i.map((e=>e[s].map((e=>e[a]))));if((0,e.isIterable)(l)&&(0,e.isEmpty)(l))return[];let o=i.find((e=>Array.isArray(l)?l.includes(e.name):e.name===l));return(0,e.isNullOrUndefined)(o)||!(0,e.hasOwn)(o,s)?[]:o[s].map((e=>e[a]))}const xe=(e,t)=>e.getAttributeByName(t).target,Ee=(e,t)=>xe(e,t).getValue(),Ae=(e,t)=>xe(e,t).hasValue(),Oe=(e,t)=>e.isAttributeCreated(t),Ne=Object.assign(Object.create(K),be),je={nature:"concrete",initValue(t){if((0,e.isNullOrUndefined)(t))return!1;const{id:i="",attributes:s=[]}=t;return i.length>10&&(this.id=i),s.forEach((e=>{const{name:t,id:i,value:s}=e;this.createAttribute(t,s)})),!0},restore(e){const{attributes:t}=e;t.forEach((e=>{const{name:t,id:i,value:s}=e;this.isAttributeCreated(t)||this.createAttribute(t,s)}))},hasValue:()=>!0,getValue(){return{name:this.name,attributes:this.getAttributes().map((e=>({name:e.name,value:e.copy(!1)})))}},setValue(e){const{attributes:t=[]}=e;return t.forEach((e=>{const{name:t,id:i,value:s}=e;this.hasAttribute(t)&&this.createAttribute(t,s)})),!0}},Ce=Object.assign(Object.create(K),je),Le=200;function Se(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const ke={name:"prototype",nature:"prototype",initValue(t){if((0,e.isNullOrUndefined)(t)){if(this.default){let e=this.createConcept(this.default);this.setValue(e)}return this}const{id:i="",value:s}=t;i.length>10&&(this.id=i);let n=null;return s?(n=this.createConcept(s.name,s),this.setValue(n)):t.name&&t.attributes&&(n=this.createConcept(t.name,t),this.setValue(n)),this},getValue(t=!1){return(0,e.isNullOrUndefined)(this.value)?null:t?this.target:this.value},getTarget(){return this.target},restore(t){const{value:i}=t;if((0,e.isNullOrUndefined)(i))return;let s=this.createConcept(i.name,i);this.setValue(s)},setValue(t){let i=t.name||t;if(this.validate(i)!==Le)return{success:!1,message:"Validation failed: The value could not be updated."};let s=t;if(t&&"concept"===t.object&&(0,e.hasOwn)(t,"id")||(s=t.attributes?this.createConcept(i,t):this.createConcept(i)),this.target){let e=this.target.copy(!1);this.target.delete(!0),s.setValue(e)}return this.target=s,this.value=i,this.notify("value.changed",this.getCandidates().find((e=>e.name===this.value))),{success:!0,message:"The value has been successfully updated."}},removeValue(){return(0,e.isNullOrUndefined)(this.value)||(this.value=null,this.notify("value.changed",this.value)),{success:!0,message:"The value has been successfully updated."}},hasValue(){return!(0,e.isNullOrUndefined)(this.value)},getCandidates(){return this.candidates||(this.candidates=Te.call(this,this.schema.accept).map((e=>({type:"meta-concept",name:e.name,concept:Object.create(Me,{object:{value:"meta-concept"},type:{value:"meta-concept"},name:{value:e.name},model:{value:this.model},schema:{value:e}})})))),this.candidates},getChildren(t){if(!this.hasValue())return[];const i=[];return((0,e.isNullOrUndefined)(t)||this.target.name===t)&&i.push(this.target),i},createConcept(e,t){let i=this.model.getValue(t);const s={parent:this,ref:this};i&&(s.value=i);const n=this.model.createConcept(e,s);return n.prototype=this,n},validate(t){if((0,e.isNullOrWhitespace)(t))return Le;if((0,e.isEmpty)(this.values))return Le;var i=!1;for(let s=0;!i&&s<this.values.length;s++){const n=this.values[s];i=(0,e.isObject)(n)?n.value===t:n===t}if(!i){let e=401;return this.errors.push(Se.call(this,e).message),e}return Le},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.target.copy(!1)};return e&&this.model.addValue(t),t},clone(){let e=null;return this.hasValue()&&(e=this.target.clone()),{id:this.id,name:this.name,value:e}},export(){let e=null;return this.hasValue()&&(e={id:this.target.id,name:this.target.name}),{id:this.id,name:this.name,root:this.isRoot(),value:e}},toXML(){if(!this.hasValue())return"";let e=this.getName();return`<${e} id="${this.id}">`+this.target.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function Te(t){const i=this.model.getConcreteConcepts(this.name);return(0,e.isNullOrUndefined)(t)?i:Array.isArray(t)?i.filter((e=>t.some((t=>t.name===e.name)))):i.filter((e=>t===e.name))}const Me={getProperty(t,i){if("refname"===t)return this.name;if("name"===t)return this.name;let s=this.properties.find((e=>e.name===t));if((0,e.isNullOrUndefined)(s))return;const{type:n,value:r}=s;return"string"===n?r:"number"===n?+r:"boolean"===n?(0,e.toBoolean)(r):r},hasPrototype(t){if((0,e.isNullOrUndefined)(this.schema.prototype))return!1;let i=this.model.getConceptSchema(this.schema.prototype);for(;!(0,e.isNullOrUndefined)(i);){if(i.name===t)return!0;i=this.model.getConceptSchema(i.prototype)}return!1}},Ie=Object.assign({},K,ke);function Ue(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const He={name:"meta",reference:null,initValue(t){return(0,e.isNullOrUndefined)(t)||this.setValue(t.value),this},hasValue(){return!(0,e.isNullOrWhitespace)(this.value)},getValue(){return(0,e.isNullOrUndefined)(this.value)?null:this.value},getProperty(t){const i=this.schema[t];if((0,e.isObject)(i)){const e=[];for(const t in i){const s=i[t];e.push(Object.assign({},{name:t},s))}return e}return i},setValue(t){var i=this.validate(t);return 200!==i?{success:!1,message:"Validation failed: The value could not be updated.",errors:[Ue(i).message]}:(0,e.isNullOrUndefined)(t)||this.value===t?void 0:(this.reference&&this.reference.unregister(this),this.reference=this.model.getConcept(t),this.reference.register(this),this.value=t,this.notify("value.changed",this.reference),{success:!0,message:"The value has been successfully updated."})},getChildren:e=>[],delete(e=!1){if(!e){let e=this.getParent().remove(this);if(!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(t){return(0,e.isNullOrWhitespace)(t)||(0,e.isEmpty)(this.values),200},export(){return{id:this.id,name:this.name,value:this.value}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}},De=Object.assign({},K,He);function Ve(e,t){return{object:{value:"concept"},type:{value:"concept"},model:{value:e},name:{value:t.name},base:{value:t.base},schema:{value:t,writable:!0}}}const Be={boolean:(e,t)=>Object.create(ee,Ve(e,t)),number:(e,t)=>Object.create(ne,Ve(e,t)),reference:(e,t)=>Object.create(oe,Ve(e,t)),set:(e,t)=>Object.create(pe,Ve(e,t)),string:(e,t)=>Object.create(Ne,Ve(e,t)),meta:(e,t)=>Object.create(De,Ve(e,t))},Pe={primitive:(e,t)=>Be[t.name](e,t),prototype:(e,t)=>Object.create(Ie,Ve(e,t)),concrete:(e,t)=>Object.create(Ce,Ve(e,t)),derivative:(e,t)=>Be[t.base](e,t)},Re={createConcept(t,i,s){const{name:n,nature:r}=i,a=Pe[r];if((0,e.isNullOrUndefined)(a))throw new Error(`Missing handler: The '${n}' concept could not be handled`);const l=a(t,i);if((0,e.isNullOrUndefined)(l))throw new Error(`Bad request: The '${n}' concept could not be created`);return l.init(s),(0,e.isNullOrUndefined)(l.id)&&(l.id=$.h.generate()),l}};var _e=0;const $e={concepts:null,values:null,listeners:null,get hasError(){return this.concepts.some((e=>e.hasError))},init(e){return this.concepts=[],this.values=[],this.listeners=[],Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})})),this.values=e.filter((e=>e.id.startsWith("value")))),this},initValue(e){return console.log(e),Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})})),this.values=e.filter((e=>e.id.startsWith("value")))),this},done(){return this.concepts.forEach((e=>{e.done()})),this.concepts=[],!0},createConcept(t,i){const s=this.getCompleteModelConcept(t);if((0,e.isNullOrUndefined)(s))throw new Error(`Concept not found: ${t}`);var n=Re.createConcept(this,s,i);return this.addConcept(n),n},getConcepts(t){if((0,e.isIterable)(t)){const e=Array.isArray(t)?e=>t.includes(e.name):e=>e.name===t;return this.concepts.filter((t=>e(t)))}return this.concepts.slice()},getRootConcepts(){return this.concepts.filter((e=>e.isRoot()))},getConceptsByPrototype(e){return this.concepts.filter((t=>t.hasPrototype(e)))},getConcept(t){if(!(0,e.isString)(t)||(0,e.isEmpty)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");return this.concepts.find((e=>e.id===t))},addConcept(t){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad request: The 'concept' argument must be a Concept");return this.concepts.push(t),t.register(this.environment),this},removeConcept(t){if(!(0,e.isObject)(t)&&!(0,e.isString)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var i=this.concepts.findIndex((e=>e.id===t));return-1===i?null:this.concepts.splice(i,1)[0]},hasConcept(t){if(!(0,e.isObject)(t)&&!(0,e.isString)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");if((0,e.isEmpty)(this.concepts))return!1;let i=t.id||t;return t.name,this.concepts.some((e=>e.id===i))},getValues(t){if((0,e.isIterable)(t)){const e=Array.isArray(t)?e=>t.includes(e.name):e=>e.name===t;return this.values.filter((t=>e(t)))}return this.values.slice()},getValue(t){return(0,e.isNullOrUndefined)(t)?null:(0,e.hasOwn)(t,"value")||(0,e.hasOwn)(t,"attributes")?t:(0,e.hasOwn)(t,"id")?this.values.find((e=>e.id===t.id)):this.values.find((e=>e.id===t))},addValue(t){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad request: The 'value' argument must be a Value");return this.values.some((e=>{return s=t,(i=e).name===s.name&&(i.value?i.value===s.value:JSON.stringify(i.attributes)===JSON.stringify(s.attributes));var i,s}))||(t.id="value"+_e++,this.values.push(t),this.notify("value.added",t)),this},removeValue(t){if(!(0,e.isObject)(t)&&!(0,e.isString)(t))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var i=this.values.findIndex((e=>e.id===t));if(-1===i)return null;let s=this.values.splice(i,1)[0];return this.notify("value.removed",s),s},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){let t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t)}))},isConcept(t){return!!(0,e.isString)(t)&&-1!==this.schema.findIndex((e=>e.name===t))},isConcrete(t){if(!(0,e.isString)(t))return!1;const i=this.schema.find((e=>e.name===t));return!(0,e.isNullOrUndefined)(i)&&"concrete"===i.nature},isPrototype(t){if(!(0,e.isString)(t))return!1;const i=this.schema.find((e=>e.name===t));return!(0,e.isNullOrUndefined)(i)&&"prototype"===i.nature},hasPrototype(t,i){if(!this.isConcept(t))return!1;let s=this.getConceptSchema(t);for(;!(0,e.isNullOrUndefined)(s);){if(s.prototype===i)return!0;s=this.model.getConceptSchema(s.prototype)}return!1},addConceptSchema(e){let t=e.concept||e;return this.schema.push(...t),this.environment.update("concept-model.updated"),!0},getSchema(t){if((0,e.isIterable)(t)){const e=Array.isArray(t)?e=>t.includes(e.nature):e=>e.nature===t;return this.schema.filter((t=>e(t)))}return this.schema.slice()},getConceptSchema(i){const s=We(this.schema,i);if(!(0,e.isNullOrUndefined)(s))return(0,t.p$)(s)},getCompleteModelConcept(t){let i=t;(0,e.isString)(t)&&(i={name:t});const s=this.getConceptSchema(i.name);if((0,e.isNullOrUndefined)(s))return;Object.assign(s,i),(0,e.hasOwn)(s,"attributes")||(s.attributes=[]);const n=Fe.call(this,s.prototype);return s.attributes.push(...n.attributes),s},getConcreteConcepts(t){const i=i=>{for(var s=i.prototype;!(0,e.isNullOrUndefined)(s);){if(s===t)return!0;s=(0,e.valOrDefault)(We(this.schema,s),{}).prototype}return!1},s=this.schema.filter((e=>"concrete"===e.nature));return t?s.filter((e=>i(e))):s},getDerivedConcepts(t){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad argument");return this.schema.filter((e=>e.base===t))},export(){const e=[];return this.getConcepts().forEach((t=>{e.push(t.export())})),e.push(...this.getValues()),e},toString(){return JSON.stringify({[this.root.name]:this.root.toString()})},toXML(){return"<model:gentleman>"+this.getRootConcepts().map((e=>e.toXML())).join("")+"</model:gentleman>"},toXMI(){return'\n            <?xml version="1.0" encoding="ISO-8859-1"?>\n            <xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gent="geodes.sms.gentleman">\n                <gent:Model name="MindMap">\n        '+this.getRootConcepts().map((e=>e.toXMI())).join("")+"\n                </gent:Model>\n            </xmi:XMI>\n        "}};function Fe(t){var i=t;const s=[];for(;!(0,e.isNullOrUndefined)(i);){const t=(0,e.valOrDefault)(this.getConceptSchema(i),{});n=t.attributes,Array.isArray(n)&&n.forEach((t=>{const i=s.find((e=>e.name===t.name));(0,e.isNullOrUndefined)(i)?s.push(t):t.required&&(i.required=t.required)})),i=t.prototype}var n;return{attributes:s}}const ze=[{name:"string",nature:"primitive"},{name:"number",nature:"primitive"},{name:"boolean",nature:"primitive"},{name:"reference",nature:"primitive"},{name:"set",nature:"primitive"}];function We(t,i){let s=t.find((e=>e.name===i));return(0,e.isNullOrUndefined)(s)&&(s=ze.find((e=>e.name===i))),s}const qe=[],Xe={createModel(t,i){var s=Object.create($e,{schema:{value:(0,e.valOrDefault)(t,[])},environment:{value:i}});return qe.push(s),s}};function Ye(t){const{type:i}=t;let s=this.concept||this.source;return"property"===i?(0,e.valOrDefault)(s.getProperty(t.name),""):"param"===i?this.getParam(t.name):t}const Ze={css:function(t,i){return(0,e.isIterable)(i)?(et(t,i),t):t},ref:function(t,i){return(0,e.isIterable)(i)?(i.forEach((i=>{const{style:s={}}=(0,e.valOrDefault)(this.model.getStyleSchema(i),{});s.gss?Je.call(this,t,s):Ke.call(this,t,s)})),t):t},gss:Ke,text:Qe,box:nt,html:function(t,i){return(0,e.isIterable)(i)?(i.forEach((i=>{let s=`style${(0,e.capitalizeFirstLetter)(i.name)}`;t.dataset[s]=Ye.call(this,i.value),"property"===i.value.type&&this.registerHandler("value.changed",(e=>{t.dataset[s]=Ye.call(this,i.value)}))})),t):t}},Ge={text:Qe,box:nt};function Je(t,i){if(!(0,e.isObject)(i))return t;for(const s in i){const n=i[s];let r=Ze[s];(0,e.isFunction)(r)&&r.call(this,t,n)}return t}function Ke(t,i){if(!(0,e.isObject)(i))return t;for(const s in i){const n=i[s];let r=Ge[s];(0,e.isFunction)(r)&&r.call(this,t,n)}return t}function Qe(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"bold":e.style.fontWeight=it(s);break;case"italic":e.style.fontStyle="italic";break;case"underline":e.style.textDecoration="underline";break;case"strikethrough":e.style.textDecoration="line-through";break;case"color":e.style.color=tt(s);break;case"font":e.style.fontFamily=s.toString();break;case"size":e.style.fontSize=st(s);break;case"transform":e.style.textTransform=s}}return e}function et(t,i){if(Array.isArray(i))t.classList.add(...i);else{let s=i.replace(/\s+/g," ").trim();(0,e.isNullOrWhitespace)(t.className)?t.className=s:et(t,s.split(" "))}return t}function tt(t){if((0,e.isNullOrUndefined)(t))return"";const{type:i,value:s}=t;switch(i){case"rgb":return(0,e.isObject)(s)?`rgb(${s.red}, ${s.green}, ${s.blue})`:s;case"rgba":return(0,e.isObject)(s)?`rgba(${s.red}, ${s.green}, ${s.blue}, ${s.opacity/100})`:s;case"name":case"hexadecimal":return s;default:return s||t}}function it(t){if((0,e.isNullOrUndefined)(t))return"";const{type:i,value:s}=t;return Number.isInteger(t)?`${t}`:"bold"}function st(t){if((0,e.isNullOrUndefined)(t))return"";const{value:i,unit:s}=t;return(0,e.isNullOrUndefined)(i)?"":`${i}${s}`}function nt(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"inner":rt.call(this,e,s,"padding");break;case"outer":rt.call(this,e,s,"margin");break;case"border":ot.call(this,e,s);break;case"corner":ht.call(this,e,s);break;case"background":at.call(this,e,s);break;case"width":e.style.width=st.call(this,s);break;case"height":e.style.height=st.call(this,s);break;case"opacity":e.style.opacity=s/100;break;case"shadow":lt.call(this,e,s,"shadow")}}return e}function rt(t,i,s){if(!(0,e.isNullOrUndefined)(i))for(const e in i){const n=i[e];switch(e){case"all":t.style[`${[s]}`]=st.call(this,n);break;case"top":t.style[`${[s]}Top`]=st.call(this,n);break;case"right":t.style[`${[s]}Right`]=st.call(this,n);break;case"bottom":t.style[`${[s]}Bottom`]=st.call(this,n);break;case"left":t.style[`${[s]}Left`]=st.call(this,n)}}}function at(t,i){if((0,e.isNullOrUndefined)(i))return;const{color:s,image:n}=i;s&&(t.style.backgroundColor=tt.call(this,s)),n&&(t.style.backgroundImage=`url(${n})`)}function lt(t,i){if((0,e.isNullOrUndefined)(i))return null;const{offsetX:s,offsetY:n,blur:r,spread:a,inset:l=!1,color:o}=i;if((0,e.isNullOrUndefined)(s)||(0,e.isNullOrUndefined)(n))return null;let h=st.call(this,s),c=st.call(this,n),d=st.call(this,r),u=st.call(this,a),m=tt.call(this,o);t.style.boxShadow=l?`inset ${h} ${c} ${d} ${u} ${m}`.trim():`${h} ${c} ${d} ${u} ${m}`.trim()}function ot(t,i){if(!(0,e.isNullOrUndefined)(i))for(const s in i){const n=i[s];switch(s){case"all":t.style.borderStyle=(0,e.valOrDefault)(n.type,"solid"),t.style.borderWidth=st.call(this,n.width),t.style.borderColor=tt.call(this,n.color);break;case"top":t.style.borderTopStyle=(0,e.valOrDefault)(n.type,"solid"),t.style.borderTopWidth=st.call(this,n.width),t.style.borderTopColor=tt.call(this,n.color);break;case"right":t.style.borderRightStyle=(0,e.valOrDefault)(n.type,"solid"),t.style.borderRightWidth=st.call(this,n.width),t.style.borderRightColor=tt.call(this,n.color);break;case"bottom":t.style.borderBottomStyle=(0,e.valOrDefault)(n.type,"solid"),t.style.borderBottomWidth=st.call(this,n.width),t.style.borderBottomColor=tt.call(this,n.color);break;case"left":t.style.borderLeftStyle=(0,e.valOrDefault)(n.type,"solid"),t.style.borderLeftWidth=st.call(this,n.width),t.style.borderLeftColor=tt.call(this,n.color)}}}function ht(t,i){if((0,e.isNullOrUndefined)(i))return null;for(const e in i){const s=i[e];switch(e){case"all":t.style.borderRadius=st.call(this,s);break;case"top-left":t.style.borderTopLeftRadius=st.call(this,s);break;case"top-right":t.style.borderTopRightRadius=st.call(this,s);break;case"bottom-right":t.style.borderBottomRightRadius=st.call(this,s);break;case"bottom-left":t.style.borderBottomLeftRadius=st.call(this,s)}}}const ct={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,children:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasError(){return this.source.hasError},get hasAttached(){return!(0,e.isEmpty)(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(t){return(0,e.isFunction)(t)?this.attached.filter((e=>t(e))):this.attached},show(){return(0,t.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,t.Cp)(this.element),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},focus(e){return this.element.contentEditable=!1,this.element.focus(),this.focused=!0,this},getContainer(){return this.element},notify(e,i,s){(0,t.lL)(this.element),this.environment.notify(e,i)},append(t){if(!(0,e.isHTMLElement)(t))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.append(t),this},_focusIn:e=>!1,enable(){return this.disabled=!1,this},disable(){return this.disabled=!0,this},clear:()=>!0,delete(){var i=this.source.delete();i.success?(this.clear(),(0,e.removeChildren)(this.element),this.element.remove()):(this.environment.notify(i.message),(0,t.lL)(this.element))},spaceHandler(e){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){return console.warn(`ESCAPE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},enterHandler(e){this.focusOut()},deleteHandler(i){if(this.projection.element!==this)return(0,t.lL)(i),!1;if(!this.projection.optional)return(0,t.lL)(this.element),!1;let s=(0,e.findAncestor)(i,(e=>0===e.tabIndex)),n=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),n),this.source.delete();let r=this.environment.resolveElement(s);return(0,e.isNullOrUndefined)(r)||r.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){return console.warn(`ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()},shiftHandler(e,t){return console.warn(`SHIFT_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1}},dt=Object.assign(ct);function ut(t){if(!(0,e.isHTMLElement)(t))return!1;const{nature:i,id:s}=t.dataset;return"field-component"===i&&s===this.id}const mt={init(){return this.elements=new Map,this},render(){const t=(0,e.createDocFragment)(),{content:i="Add",items:s}=this.schema;(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:["field","add-button"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Je.call(this.projection,this.element,this.schema.style));let n=(0,e.createButton)({class:["field-action","field--list__add"],tabindex:0,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});return(0,e.isNullOrUndefined)(s)||(this.item=s),n.append(i),t.appendChild(n),t.hasChildNodes()&&this.element.append(t),this.bindEvent(),this.element},focusIn(){},clickHandler(t){const i=(t=>ut.call(this,t)?t:(0,e.findAncestor)(t,(e=>ut.call(this,e)),5))(t);if((0,e.isNullOrUndefined)(i))return;const{action:s,index:n,name:r}=i.dataset;"add"===s?(this.parent.prio=this.element,this.createElement()):"remove"===s&&this.delete(i.parentElement),this.parent.prio=this.element},createElement(){this.source.createElement()},addItem(e){return this.parent.addItem(e,this),this},removeItem(e){this.parent.removeItem(e)},refresh(){this.element&&this.source.getValue().forEach((e=>{this.addItem(e)}))},focusOut(){},bindEvent(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)}))}},pt=Object.assign(Object.create(dt),mt);function ft(t,i){if(!Array.isArray(i))return!1;t.currentState=null;for(let s=0;s<i.length;s++){const n=i[s],{rule:r,result:a}=n;if((0,e.isNullOrUndefined)(r))return a;let l=!1,o=gt[r.type];if((0,e.isFunction)(o)&&(l=o.call(this,r[r.type])),l)return t.currentState=s,a}return null}const gt={ref:function(t){const{rule:i={}}=(0,e.valOrDefault)(this.model.getRuleSchema(t),{});let s=gt[i.type];return!!(0,e.isFunction)(s)&&s.call(this,i[i.type])},eq:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return vt.call(this,e[0])==vt.call(this,e[1])},ne:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return vt.call(this,e[0])!=vt.call(this,e[1])},lt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return vt.call(this,e[0])<vt.call(this,e[1])},le:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return vt.call(this,e[0])<=vt.call(this,e[1])},gt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return vt.call(this,e[0])>vt.call(this,e[1])},ge:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return vt.call(this,e[0])>=vt.call(this,e[1])},and:function(e){return bt.call(this,e[0])&&bt.call(this,e[1])},or:function(e){return bt.call(this,e[0])||bt.call(this,e[1])},not:function(e){return!bt.call(this,e[0])},no:function(t){let i=vt.call(this,t);return(0,e.isIterable)(i)?(0,e.isEmpty)(i):(0,e.isNullOrUndefined)(i)}};function vt(t,i){if(t&&"property"===t.type){const{name:i}=t;let s=`get${(0,e.pascalCase)(i)}`;return this[s]?this[s]():this[i]}if(t&&"param"===t.type){const{name:e}=t;return this.projection.getParam(e)}if((0,e.isObject)(t)){let i=`get${(0,e.pascalCase)(t.prop)}`;return this[i]?this[i]():this[t.prop]}return i||t}function bt(t){let i=gt[t.type];return(0,e.isFunction)(i)?i.call(this,t[t.type]):(0,e.toBoolean)(vt.call(this,t))}function yt(t){const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.valOrDefault)(this.source.getProperty(t.name),"")):"param"===i?this.projection.getParam(t.name):"html"===i?(0,e.htmlToElement)(t.html):"raw"===i?(0,e.htmlToElement)(t.raw):t}const wt={input:null,label:null,value:"",state:null,init(){const{focusable:e=!0}=this.schema;return this.focusable=e,this.children=[],this},refresh(){if((0,e.valOrDefault)(ft.call(this,this.schema,this.schema.state),this.schema),this.schema.state){let t=this.schema.state[this.getValue().toString()];if(t&&t.content){const{style:i,content:s,value:n}=t;let r=(0,e.createDocFragment)();s.forEach((e=>{r.append(Yn.call(this,e))})),(0,e.removeChildren)(this.label).append(r),Je.call(this.projection,this.label,i)}}this.input.checked?this.element.dataset.state="on":this.element.dataset.state="off",this.hasError?(this.element.classList.add("error"),this.input.classList.add("error")):(this.element.classList.remove("error"),this.input.classList.remove("error"))},render(){const i=(0,e.createDocFragment)(),{checkbox:s}=this.schema;var n;if((0,e.isHTMLElement)(this.element)||(this.element=(n=this.id,(0,e.createDiv)({id:n,class:["field","field--binary"],tabindex:-1,dataset:{nature:"field",view:"binary",id:n}})),this.readonly&&this.element.classList.add("readonly"),Je.call(this.projection,this.element,this.schema.style)),!(0,e.isHTMLElement)(this.input)){if(this.input=function(t){return(0,e.createInput)({id:`checkbox${t}`,type:"checkbox",class:["field--binary__input"],tabindex:0,dataset:{nature:"field-component",view:"binary",id:t}})}(this.id),this.input.checked=this.source.getValue(),this.value=this.input.checked,this.readonly&&(this.input.classList.add("readonly"),this.input.disabled=!0),s){const{style:e}=s;Je.call(this.projection,this.input,e)}else(0,t.Cp)(this.input);i.append(this.input)}if(!(0,e.isHTMLElement)(this.label)){if(this.label=(0,e.createLabel)({class:["field--checkbox__label"],for:this.input.id,tabindex:0,dataset:{nature:"field-component",view:"binary",id:this.id}}),this.label.htmlFor=this.input.id,s&&s.label){const{content:t}=s.label;if(Array.isArray(t))t.forEach((t=>{let i=yt.call(this,t),s=(0,e.createSpan)({class:["field--checkbox__label-content"],dataset:{ignore:"all"}},i);Je.call(this.projection,s,t.style),this.label.append(s)}));else{let e=yt.call(this,t);this.label.append(e)}Je.call(this.projection,this.label,s.label.style)}i.append(this.label)}return i.hasChildNodes()&&(this.element.append(i),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.value=this.input.checked,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.hasChanges()&&this.setValue(this.input.checked),this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.choice&&(0,t.Cp)(this.choice),this.input.blur(),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!==this.input.checked},hasValue(){return this.input.checked},getValue(){return this.input.checked},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||this.environment.notify(i.message,"error"),this.input.checked=e,this.value=e,this.refresh()},getCandidates(){return this.source.getCandidates()},enable(){this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1},disable(){this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),s){let t=(0,e.findAncestor)(i,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}},backspaceHandler(e){return this.arrowHandler("left",e)},enterHandler(e){this.setValue(!this.input.checked,!0)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,this.element)},bindEvents(){this.element.addEventListener("change",(e=>{this.setValue(this.getValue(),!0)})),this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},xt=Object.assign(Object.create(dt),wt);function Et(t){const i=e=>e.parentElement===this.choices;return i(t)?t:(0,e.findAncestor)(t,i,5)}function At(e){const{type:t}=e.dataset;return t}function Ot(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)).id:"meta-concept"===t?this.values.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const Nt=(e,t)=>"concept"===e.type?Nt(e.id,t):"concept"===t.type?Nt(e,t.id):"meta-concept"===e.type?Nt(e.name,t):"meta-concept"===t.type?Nt(e,t.name):e===t,jt={value:null,placeholder:null,expanded:null,values:null,choices:null,input:null,items:null,selection:null,selectList:null,selectListValue:null,icoToggle:null,init(t={}){Object.assign(this.schema,t);const{focusable:i=!0,placeholder:s=!1,expanded:n=!0}=this.schema;return this.items=new Map,this.focusable=i,this.expanded=n,this.placeholder=s,this.children=[],(0,e.hasOwn)(this.schema,"choice")||(this.schema.choice={}),(0,e.hasOwn)(this.schema.choice,"option")||(this.schema.choice.option={}),this},hasChanges(){return this.value!=this.source.getValue()},reset(){this.source.removeValue()},hasValue(){return!(0,e.isNullOrUndefined)(this.value)},getValue(){return this.selection},setValue(i,s=!1){var n=null;if(s)return(n=this.source.setValue(i)).success||this.environment.notify(n.message,t.k$.ERROR),!0;(0,e.isNullOrUndefined)(i)?(this.selection&&this.selection.classList.remove("selected"),this.expanded||(0,e.removeChildren)(this.selectListValue),this.selection=null):this.setChoice(i),(0,e.isNullOrUndefined)(i)?this.value=null:"concept"===i.type?this.value=i.id:"meta-concept"===i.type?this.value=i.name:this.value=i;const{template:r={}}=this.schema.choice.option;if(this.selection&&!this.expanded&&i)if((0,e.removeChildren)(this.selectListValue),"meta-concept"===i.type){let t=this.model.getProjectionSchema(i.concept,(0,e.valOrDefault)(r.tag))[0],s=t.type,n={type:s,[s]:t.content||t.projection},a=Yn.call(this,n,i.concept,{focusable:!1,meta:i.name});this.selectListValue.append(a)}else if("concept"===i.type){let e=this.model.createProjection(i,r.tag).init({focusable:!1});e.readonly=!0,e.focusable=!1,e.parent=this.projection,this.selectListValue.append(e.render())}else this.selectListValue.append(i.toString());this.refresh()},refresh(){return this.hasValue()?(this.element.classList.remove("empty"),this.element.dataset.value=this.value.name||this.value):(this.element.classList.add("empty"),this.element.dataset.value="",!this.expanded&&this.placeholder&&(0,e.removeChildren)(this.selectListValue).append(this.placeholder)),this.input&&(this.element.dataset.input=this.input.value),this.element.classList.remove("querying"),this.hasError?(this.element.classList.add("error"),this.input&&this.input.classList.add("error")):(this.element.classList.remove("error"),this.input&&this.input.classList.remove("error")),this},render(){const t=(0,e.createDocFragment)(),{choice:i,input:s,style:n}=this.schema;if((0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:["field","field--choice"],tabindex:-1,dataset:{nature:"field",view:"choice",input:"",id:this.id}})),!(0,e.isHTMLElement)(this.input)&&s){const{placeholder:i="",type:n,style:r}=s;let a=zn.call(this,i);this.input=(0,e.createInput)({class:["field--choice__input"],type:(0,e.valOrDefault)(n,"text"),placeholder:a,title:a,dataset:{nature:"field-component",view:this.type,id:this.id}}),Je.call(this,this.input,r),t.append(this.input)}if(!(0,e.isHTMLElement)(this.choices)){const{style:s}=i;this.choices=(0,e.createUnorderedList)({class:["bare-list","field--choice__choices"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),Je.call(this,this.choices,s),t.append(this.choices)}if(!this.expanded){let i=(0,e.createDiv)({class:["field--choice__select-wrapper"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}});this.selectListValue=(0,e.createDiv)({class:["field--choice__select-value"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),this.icoToggle=(0,e.createI)({class:["field--choice__select-icon"],dataset:{nature:"field-component",view:"choice",id:this.id}}),i.append(this.selectListValue,this.icoToggle),this.selectList=(0,e.createDiv)({class:["field--choice__select-list","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.input&&this.selectList.append(this.input),this.selectList.append(this.choices),t.append(i),t.append(this.selectList)}if(Je.call(this,this.element,n),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),(0,e.removeChildren)(this.choices),this.placeholder){const{style:t}=this.schema.choice.option;let i=(0,e.createListItem)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(i),Je.call(this,i,t)}return this.values=this.source.getCandidates(),this.values.forEach((e=>{this.choices.append(this.createChoiceOption(e))})),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},focus(e){if(this.expanded)if(this.choices.hasChildNodes()){let e=(0,t.sB)(this.choices);e&&e.focus()}else this.input&&!(0,t.xj)(this.input)?this.input.focus():this.selection&&this.selection.focus();else this.input&&!(0,t.xj)(this.input)?this.input.focus():this.selectListValue.focus();return this.element.classList.add("active"),this},navigate(i,s,n){let r=null;if("up"===i?r=(0,t.GV)(this.element):"down"===i?r=(0,t.Sd)(this.element):"left"===i?r=(0,t.GF)(this.element):"right"===i&&(r=(0,t.EE)(this.element)),(0,e.isNullOrUndefined)(r))return!1;r.focus()},focusIn(){this.focused=!0,this.element.classList.add("active");const i=(0,e.createDocFragment)();return this.source.getCandidates().filter((e=>!this.values.some((t=>Nt(t,e))))).forEach((e=>{i.append(this.createChoiceOption(e)),this.values.push(e)})),this.choices.append(i),this.expanded||((0,t.$Z)(this.selectList),this.selectList.dataset.state="open"),this},focusOut(){if(this.readonly)return;this.input&&(0,e.isNullOrWhitespace)(this.input.value)&&(this.input.value=""),this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.input&&this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("querying");const{children:i}=this.choices;for(let e=0;e<i.length;e++){const s=i[e];(0,t.$Z)(s),s.hidden=!1}return this.expanded||((0,t.Cp)(this.selectList),this.selectList.dataset.state="close"),this.focused=!1,this},showChoices(){const{children:e}=this.choices;for(let i=0;i<e.length;i++){const s=e[i];(0,t.$Z)(s),s.hidden=!1}},enable(){return this.input&&(this.input.disabled=!1,this.input.tabIndex=0),this.disabled=!1,this},disable(){return this.input&&(this.input.disabled=!0,this.input.tabIndex=-1),this.disabled=!0,this},filterChoice(i){const{children:s}=this.choices;if(this.element.dataset.input=i.trim(),(0,e.isNullOrWhitespace)(i)){for(let e=0;e<s.length;e++){const i=s[e];(0,t.$Z)(i),i.hidden=!1}return}this.element.classList.add("querying");let n=i.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<s.length;e++){const i=s[e];let r=i.textContent.toLowerCase(),a=r.replace(/[_-]+/g," ").replace(/\s+/g,"").trim();n.some((e=>r.includes(e)||a.includes(e)))?((0,t.$Z)(i),i.hidden=!1):((0,t.Cp)(i),i.hidden=!0)}return!0},createChoiceOption(t){const{template:i={},style:s}=this.schema.choice.option,n=(0,e.isObject)(t),r=(0,e.createListItem)({class:["field--choice__choice"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:n?"concept":"value",value:n?t.id:t}});if(Je.call(this,r,s),this.items.set(t.id,r),"meta-concept"===t.type){let s=this.model.getProjectionSchema(t.concept,(0,e.valOrDefault)(i.tag))[0],n=s.type,a={type:n,[n]:s.content||s.projection},l=Yn.call(this,a,t.concept,{focusable:!1,meta:t.name});r.dataset.type="meta-concept",r.dataset.value=t.name,r.append(l)}else if(n){if(!this.model.hasProjectionSchema(t,i.tag))return r;let e=this.model.createProjection(t,i.tag).init({focusable:!1});e.readonly=!0,e.focusable=!1,e.parent=this.projection,r.append(e.render())}else r.append(t.toString());return r},setChoice(e){const{children:i}=this.choices;let s=!1;for(let n=0;n<i.length;n++){const r=i[n];let a=Ot.call(this,r);a&&Nt(a,e)?(r.classList.add("selected"),r.dataset.selected="selected",this.selection=r,(0,t.$Z)(r),s=!0):(r.classList.remove("selected"),delete r.dataset.selected)}return this},delete(){if(this.hasValue())this.reset();else{let i=this.source.delete();i.success?(this.clear(),(0,e.removeChildren)(this.element),this.element.remove()):(this.environment.notify(i.message),(0,t.lL)(this.element))}},_spaceHandler(i){let s=this.source.getCandidates();if((0,e.isEmpty)(s))return void this.notify("No candidates found.",t.k$.INFO);const n=(0,e.createDocFragment)();if(s.forEach((e=>{n.append(this.createChoiceOption(e))})),(0,e.removeChildren)(this.choices),this.placeholder){const{style:t}=this.schema.choice.option;let i=(0,e.createListItem)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(i),Je.call(this,i,t)}this.choices.append(n),this.filterChoice(this.input.value),(0,t.$Z)(this.choices),this.element.classList.add("querying")},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),!this.expanded&&"open"===this.selectList.dataset.state)return(0,t.Cp)(this.selectList),this.selectList.dataset.state="close",!0;if(s){let t=(0,e.findAncestor)(i,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}this.focus()},enterHandler(i){const s=Et.call(this,i);(0,e.isHTMLElement)(s)&&this.selection!==s&&("placeholder"===At(s)?this.source.removeValue():this.setValue(Ot.call(this,s),!0),this.expanded||((0,t.Cp)(this.selectList),this.selectList.dataset.state="close",this.focus()))},backspaceHandler(e){Et.call(this,e)&&this.input&&this.input.focus()},clickHandler(i){const s=Et.call(this,i);(0,e.isHTMLElement)(s)&&this.selection!==s?("placeholder"===At(s)?this.source.removeValue():this.setValue(Ot.call(this,s),!0),this.expanded||((0,t.Cp)(this.selectList),this.selectList.dataset.state="close")):i===this.selectListValue&&((0,t.$Z)(this.selectList),this.selectList.dataset.state="open")},arrowHandler(i,s){if(!(0,e.isHTMLElement)(s))return!1;const{parentElement:n}=s,r=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);if(!this.expanded&&s===this.selectListValue)return this.arrowHandler(i,this.selectListValue.parentElement);let a=Et.call(this,s);if(a){let s=(0,t.As)(a,i,this.choices,!1);return(0,e.isHTMLElement)(s)?(s.focus(),!0):this.arrowHandler(i,this.choices)}if(this.expanded&&n!==this.element)return r();let l=(0,t.As)(s,i,n,!1);return(0,e.isHTMLElement)(l)?(l===this.selectList&&(l=this.input||this.choices),l===this.choices&&this.choices.hasChildNodes()&&("up"===i?l=(0,t.GV)(this.choices):"down"===i?l=(0,t.Sd)(this.choices):"left"===i?l=(0,t.GF)(this.choices):"right"===i&&(l=(0,t.EE)(this.choices))),l.focus(),!0):r()},bindEvents(){(0,e.isHTMLElement)(this.input)&&this.element.addEventListener("input",(e=>{this.filterChoice(this.input.value)})),this.projection.registerHandler("value.changed",((e,t)=>{this.setValue(e)}))}},Ct=Object.assign(Object.create(dt),jt),Lt={init(){return this},render(){const t=(0,e.createDocFragment)(),{content:i,markers:s,marker:n,self:r}=this.schema;var a=new DOMParser;return(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"dynamic",id:this.id}})),(0,e.isHTMLElement)(this.content)||(this.content=a.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,t.appendChild(this.content)),(0,e.isNullOrUndefined)(this.place)&&(this.place=this.content.querySelector("[data-"+n+"]")),(0,e.isNullOrUndefined)(this.markers)&&(this.markers=new Map,this.content.querySelectorAll("[data-"+n+"]").forEach((t=>{let i=t.getAttribute("data-"+n);(0,e.isNullOrUndefined)(this.markers.get(i))?this.markers.set(i,[t]):this.markers.set(i,this.markers.get(i).concat([t]))}))),(0,e.isNullOrUndefined)(this.aliases)&&(this.aliases=new Map,s.forEach((t=>{let i=[];t.aliases.forEach((t=>{let s=this.markers.get(t.mv);const n=[];s.forEach((i=>{const s={};s.target=i;let r=[];t.props.forEach((t=>{const s={};s.property=t.props,s.value=t.value,(0,e.isNullOrUndefined)(i.style)||(0,e.isNullOrUndefined)(i.style[t.props])?s.default=i[t.props]:s.default=i.style[t.props],r.push(s)})),s.impacts=r,n.push(s)})),i.push(n)})),this.aliases.set(t.mv,i)}))),(0,e.isNullOrUndefined)(this.self)&&!(0,e.isEmpty)(r)&&(this.self=[],r.forEach((t=>{const i={};i.property=t,(0,e.isNullOrUndefined)(this.place.style[t])?i.default=this.place[t]:i.default=this.place.style[t],this.self.push(i)}))),t.hasChildNodes()&&this.element.appendChild(t),this.update=this.refresh,this.clear=this.clean,this},refresh(t){let i=this.aliases.get(t.toString());(0,e.isNullOrUndefined)(i)||i.forEach((t=>{t.forEach((t=>{t.impacts.forEach((i=>{(0,e.isNullOrUndefined)(t.target[i.property])?t.target.style[i.property]=i.value:t.target[i.property]=i.value}))}))})),(0,e.isNullOrUndefined)(this.self)||this.self.forEach((i=>{(0,e.isNullOrUndefined)(this.place.style[i.property])?this.place[i.property]=t:this.place.style[i.property]=t}))},clean(t){let i=this.aliases.get(t);(0,e.isNullOrUndefined)(i)||i.forEach((t=>{t.forEach((t=>{t.impacts.forEach((i=>{(0,e.isNullOrUndefined)(t.target.style[i.property])?t.target[i.property]=i.default:t.target.style[i.property]=i.default}))}))})),(0,e.isNullOrUndefined)(this.self)||this.self.forEach((t=>{(0,e.isNullOrUndefined)(this.place.style[t.property])?this.place[t.property]=t.default:this.place.style[t.property]=t.default}))}},St=Object.assign(Object.create(dt),Lt),kt={content:"",init(){return this},render(){const t=(0,e.createDocFragment)(),{content:i,marker:s,tag:n}=this.schema;var r=new DOMParser;return(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"interactive",id:this.id}})),(0,e.isHTMLElement)(this.content)||(this.content=r.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,t.appendChild(this.content)),(0,e.isNullOrUndefined)(this.place)&&(this.place=this.content.querySelector("[data-"+s+"]")),(0,e.isHTMLElement)(this.field)||(0,e.isNullOrUndefined)(n)||(this.field=Yn.call(this,{type:"external",tag:n},null,this.args)),t.hasChildNodes()&&this.element.appendChild(t),this.initValue=this.update,this.bindEvents(),this.element},createForeign(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i=this.place.getBBox(),s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x",i.x),s.setAttribute("y",i.y),s.setAttribute("width",i.width),s.setAttribute("height",i.height),s.style.fill="red",t.setAttribute("width",i.width),t.setAttribute("height",i.height),e.setAttribute("width",i.width),e.setAttribute("height",i.height),e.append(t),t.append(this.field),this.place.replaceWith(e),e.setAttribute("x",120),e.setAttribute("y",50);let n=this.field.getBoundingClientRect();t.setAttribute("width",n.width),t.setAttribute("height",n.height),e.setAttribute("viewBox","0 0 "+n.width+" "+n.height)},selfUpdate(){let t;(0,e.isNullOrUndefined)(this.aliases)||(t=this.aliases.get(this.value)),(0,e.isNullOrUndefined)(t)||t.forEach((t=>{t.forEach((t=>{t.impacts.forEach((i=>{(0,e.isNullOrUndefined)(t.target[i.property])?t.target.style[i.property]=i.value:t.target[i.property]=i.value}))}))})),(0,e.isNullOrUndefined)(this.self)||this.self.forEach((t=>{(0,e.isNullOrUndefined)(this.place.style[t.property])?this.place[t.property]=this.value:this.place.style[t.property]=this.value}))},clear(){let t;(0,e.isNullOrUndefined)(this.aliases)||(t=this.aliases.get(this.value)),(0,e.isNullOrUndefined)(t)||t.forEach((t=>{t.forEach((t=>{t.impacts.forEach((i=>{(0,e.isNullOrUndefined)(t.target.style[i.property])?t.target[i.property]=i.default:t.target.style[i.property]=i.default}))}))})),(0,e.isNullOrUndefined)(this.self)||this.self.forEach((t=>{(0,e.isNullOrUndefined)(this.place.style[t.property])?this.place[t.property]=t.default:this.place.style[t.property]=t.default}))},updateStatics(){if(!(0,e.isNullOrUndefined)(this.sd)){let t=this.sd.get(this.value);(0,e.isNullOrUndefined)(t)||this.content.appendChild(t.content)}},clearStatics(){if(!(0,e.isNullOrUndefined)(this.sd)){let t=this.sd.get(this.value);(0,e.isNullOrUndefined)(t)||t.content.parentNode.removeChild(t.content)}},updateDynamics(t){(0,e.isNullOrUndefined)(this.dd)||this.dd.forEach((e=>{e.update(t)}))},clearDynamics(t){(0,e.isNullOrUndefined)(this.dd)||this.dd.forEach((e=>{e.clear(t)}))},update(t){(0,e.isNullOrUndefined)(this.value)||(this.clearStatics(),this.clearDynamics(this.value),this.clear()),""===t?this.value=this.attributeName:(0,e.isNullOrUndefined)(this.property)?this.value=t:this.value=this.translateProperty(t),this.selfUpdate(),this.updateDynamics(this.value),this.updateStatics()},bindEvents(){this.place.addEventListener("click",(t=>{(0,e.isNullOrUndefined)(this.foreign)?this.createForeign():(this.place.replaceWith(this.foreign),this.field.focus())}))},getContent(){return(0,e.isHTMLElement)(this.content)||(this.content=parser.parseFromString(content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.content},arrowHandler(e,t){return this.parent.arrowHandler(e,this)},focus(){this.focusIn()},focusIn(){this.place.replaceWith(this.foreign),this.field.focus()},focusOut(){this.foreign.replaceWith(this.place),""===this.field.value?this.update(this.attributeName):this.update(this.field.value)}},Tt=Object.assign(Object.create(dt),kt),Mt={content:[{type:"static",static:{type:"text",content:"+",focusable:!1}}]};function It(t){if(!(0,e.isHTMLElement)(t))return!1;const{nature:i,id:s}=t.dataset;return"field-component"===i&&s===this.id}function Ut(t){const i=e=>e.parentElement===this.list;return i(t)?t:(0,e.findAncestor)(t,i,3)}const Ht={list:null,items:null,elements:null,selection:null,content:null,init(t){const{focusable:i=!0}=this.schema;return this.items=new Map,this.elements=new Map,this.children=[],this.focusable=i,(0,e.hasOwn)(this.schema,"list")||(this.schema.list={item:{}}),this},hasChanges:()=>!1,hasValue(){return this.items.size>0},getValue(){return this.list.children},setValue(t,i=!1){i&&this.source.setValue(t),this.list&&((0,e.removeChildren)(this.list),t.forEach((e=>{var t=this.createItem(e);this.list.append(t)}))),this.refresh()},clear(){this.items.clear(),this.list&&(0,e.removeChildren)(this.list)},focus(i){if(this.hasValue()&&this.list)this.list.firstElementChild.focus();else{let i=(0,t.Sd)(this.element,(e=>e!==this.list));if(!(0,e.isHTMLElement)(i))return this;i.focus()}return this},navigate(i,s,n){let r=null;if("up"===i?r=(0,t.GV)(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"down"===i?r=(0,t.Sd)(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"left"===i?r=(0,t.GF)(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"right"===i&&(r=(0,t.EE)(this.element,(e=>e!==this.notification&&e.hasChildNodes()))),!(0,e.isHTMLElement)(r))return!1;let a=this.environment.resolveElement(r);return!(0,e.isNullOrUndefined)(a)&&(a.focus(),!0)},focusIn(e){this.focused=!0,this.element.classList.add("active");const{component:t}=e.dataset},focusOut(){if(!this.readonly)return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},createElement(){return this.source.createElement()},getItem(t){return(0,e.isNullOrUndefined)(t)?null:(0,e.hasOwn)(t,"id")?this.items.get(t.id):this.items.get(t)},getItemIndex:t=>(0,e.isHTMLElement)(t)?t.dataset.index:null,createItem(e){const{template:t={},style:i}=this.schema.list.item;if(!this.model.hasProjectionSchema(e,t.tag))return"";let s=this.model.createProjection(e,t.tag);s.optional=!0,s.collapsible=!0,s.parent=this.projection;let n=s.init(t.options).render();return n.dataset.index=e.index,s.element.parent=this,s.registerHandler("view.changed",(e=>{Je.call(this.projection,e,i)})),Je.call(this.projection,n,i),this.items.set(e.id,n),n},addItem(t){if(!(0,e.isHTMLElement)(this.list))return;const i=this.createItem(t);t.index?this.list.children[t.index-1].after(i):this.list.append(i),this.refresh()},removeItem(t){this.hasList&&!(0,e.isNullOrUndefined)(t)&&(this.items.delete(t.id),this.items.forEach(((e,t)=>{let i=this.source.getElement(t);i&&(e.dataset.index=i.index)})),this.refresh())},moveItem(e,t,i=!1){return this.list.children[t].before(e),e.dataset.index=t,i&&this.source.swapElement(+this.getItemIndex(e),+t),this},swapItem(e,t,i=!1){const s=this.getItemIndex(e),n=this.getItemIndex(t);return this.moveItem(t,s),this.moveItem(e,n),i&&this.source.swapElement(+s,+n),this},delete(e){if(e===this.element)return this.environment.save(this.source.getParent()),void this.source.remove();const{index:i}=e.dataset;var s=this.source.removeElementAt(+i);if(s.success)if(this.hasValue()){let e=+i<this.list.childElementCount?+i:this.list.childElementCount-1;this.list.children[e].focus()}else this.focus();else this.environment.notify(`This element cannot be deleted: ${s.message}`),(0,t.lL)(e)},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.list&&this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list&&this.list.classList.add("empty")),this.elements.forEach(((t,i)=>{if(!Array.isArray(i.state))return;const{currentState:s}=i,n=ft.call(this,i,i.state);if(s===i.currentState)return;let r=i.content;n&&(r=n.content);let a=(0,e.createDocFragment)();r.forEach((e=>{let t=Yn.call(this,e,null,{focusable:!1});a.append(t)})),(0,e.removeChildren)(t).append(a)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},render(){const t=(0,e.createDocFragment)(),{list:i,style:s,action:n={}}=this.schema;if((0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Je.call(this.projection,this.element,this.schema.style)),i&&!(0,e.isHTMLElement)(this.list)){const{style:s}=i;this.list=(0,e.createDiv)({class:["field--list__list"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.source.hasValue()||this.list.classList.add("empty"),i.currentState=null,this.elements.set(i,this.list),Je.call(this.projection,this.list,s),t.append(this.list)}let r=(0,e.valOrDefault)(n.add,Mt);if(r){const{position:i="after",content:s,help:n,style:a}=r;let l=(0,e.createButton)({class:["field-action","field--list__add"],tabindex:0,title:n,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});s.forEach((e=>{let t=Yn.call(this,e,null,{focusable:!1});l.append(t)})),r.currentState=null,this.elements.set(r,l),Je.call(this.projection,l,a),"before"===i&&this.list?this.list.before(l):t.append(l)}return this.list&&this.source.getValue().forEach((e=>{var t=this.createItem(e);this.list.append(t)})),Je.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},_spaceHandler(e){this.notify(`Add or remove ${this.source.accept.name}`)},spaceHandler(t){return!!(0,e.isHTMLElement)(t)&&t.parentElement===this.list&&(this.createElement(),!0)},deleteHandler(e){return!(!It.call(this,e)||e.parentElement!==this.list||(this.delete(e),0))},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),s){let t=(0,e.findAncestor)(i,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}return this.focus(),!1},enterHandler(t){const i=(t=>It.call(this,t)?t:(0,e.findAncestor)(t,(e=>It.call(this,e)),5))(t);if((0,e.isNullOrUndefined)(i))return this.focus(),!1;const{action:s,index:n,component:r}=i.dataset;return"add"===s?(this.createElement(),!0):"remove"===s&&(this.delete(i.parentElement),!0)},backspaceHandler:e=>!1,clickHandler(t){const i=(t=>It.call(this,t)?t:(0,e.findAncestor)(t,(e=>It.call(this,e)),5))(t);if((0,e.isNullOrUndefined)(i))return;const{action:s,index:n,name:r}=i.dataset;"add"===s?this.createElement():"remove"===s&&this.delete(i.parentElement)},_arrowHandler(i,s){if(!(0,e.isHTMLElement)(s))return!1;let n=Ut.call(this,s);if(n){let s=(0,t.As)(n,i,this.list);return!!(0,e.isHTMLElement)(s)&&(this.swapItem(n,s,!0),n.focus(),!0)}return!1},arrowHandler(i,s){if(!(0,e.isHTMLElement)(s))return!1;const{parentElement:n}=s,r=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);if(n===this.list){let n=(0,t.As)(s,i,this.list);return(0,e.isHTMLElement)(n)?(this.environment.resolveElement(n).focus(),!0):this.arrowHandler(i,this.list)}if(n!==this.element)return r();let a=(0,t.As)(s,i,this.element);if(!(0,e.isHTMLElement)(a))return r();if(a===this.notification)return this.arrowHandler(i,a);if(a===this.list){if(!this.list.hasChildNodes())return r();"up"===i?a=(0,t.GV)(this.list):"down"===i?a=(0,t.Sd)(this.list):"left"===i?a=(0,t.GF)(this.list):"right"===i&&(a=(0,t.EE)(this.list))}return a.focus(),!0},bindEvents(){this.projection.registerHandler("value.added",(t=>{this.projection.listen&&!(0,e.isNullOrUndefined)(this.environment.activeReceiver)?this.environment.activeReceiver.addItem(t,this,this.schema.list.item.template.tag):this.addItem(t)})),this.projection.registerHandler("value.removed",(t=>{this.projection.listen&&!(0,e.isNullOrUndefined)(this.environment.activeReceiver)?this.environment.activeReceiver.removeItem(t):this.removeItem(t)})),this.projection.registerHandler("value.changed",(e=>{this.clear(),this.list&&this.source.getValue().forEach((e=>{let t=this.createItem(e);this.list.append(t)}))})),this.projection.registerHandler("value.swapped",(e=>{const[t,i]=e;let s=this.getItem(t),n=this.getItem(i),r=+this.getItemIndex(s);this.getItemIndex(n),r!==t.index&&this.swapItem(s,n)}))}},Dt=Object.assign(Object.create(dt),Ht);Object.defineProperty(Dt,"size",{get(){return this.items.size}}),Object.defineProperty(Dt,"hasList",{get(){return(0,e.isHTMLElement)(this.list)}});const Vt={init(){return this},render(){const t=(0,e.createDocFragment)(),{content:i,mv:s}=this.schema;var n=new DOMParser;return(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"static",id:this.id}})),(0,e.isHTMLElement)(this.content)||(this.content=n.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,t.appendChild(this.content)),(0,e.isNullOrUndefined)(this.mv)&&(this.mv=s),t.hasChildNodes()&&this.element.appendChild(t),this}},Bt=Object.assign(Object.create(dt),Vt);var Pt=0;const Rt={content:{type:"static",static:{type:"text",content:"Add"}}},_t={content:{type:"static",static:{type:"text",content:"Remove"}}},$t={table:null,header:null,body:null,footer:null,elements:null,contentElements:null,content:null,init(){const{content:e=[],template:t,focusable:i=!0}=this.schema;return this.elements=new Map,this.focusable=i,this.content=e,this.contentElements=new Map,this.template=this.model.getProjectionSchema(this.source.accept,t.tag)[0].projection,this},render(){const{content:t,action:i={}}=this.schema,{disposition:s}=this.template,n=(0,e.createDocFragment)();if(!Array.isArray(t))throw new Error("Empty content for listfield");if((0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({class:["field","field--table"],id:this.id,tabindex:-1,dataset:{nature:"field",view:"table",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Je.call(this.projection,this.element,this.schema.style)),t.forEach((t=>{if("table"===t.type){let i=(0,e.valOrDefault)(t.table,{});const{style:s,header:r,body:a={},footer:l}=i;if(this.table=(0,e.createTable)({class:["field--table__table"],tabindex:0,dataset:{nature:"field-component",view:"table",id:this.id}}),r){const{style:t}=r;this.header=(0,e.createTableHeader)({class:["field--table-header"],dataset:{nature:"field-component",view:"table",id:this.id}}),Je.call(this.projection,this.header,t),this.table.append(this.header)}if(a){const{style:t}=a;this.body=(0,e.createTableBody)({class:["field--table-body"],dataset:{nature:"field-component",view:"table",id:this.id}}),Je.call(this.projection,this.body,t),this.table.append(this.body)}if(l){const{style:t}=l;this.footer=(0,e.createTableFooter)({class:["field--table-footer"],dataset:{nature:"field-component",view:"table",id:this.id}}),Je.call(this.projection,this.footer,t),this.table.append(this.footer)}i.currentState=null,this.contentElements.set(i,this.table),Je.call(this.projection,this.table,s),n.append(this.table)}else if("action"===t.type){let i=(0,e.valOrDefault)(t,Rt);const{content:s,style:r}=i;let a=Yn.call(this,s,null),l=(0,e.createButton)({class:["field-action","field--table__add"],tabindex:0,dataset:{nature:"field-component",view:"table",component:"action",id:this.id,action:"add"}},[a]);i.currentState=null,this.contentElements.set(i,l),Je.call(this.projection,l,r),n.append(l)}else{let e=Yn.call(this,t);this.contentElements.set(t,e),n.append(e)}})),this.header){let t=(0,e.createTableRow)({class:["field--table-header-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id}});s.forEach((i=>{const{header:s}=i,{style:n,content:r}=s;var a=Yn.call(this,r),l=(0,e.createTableHeaderCell)({class:["field--table-header-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);Je.call(this.projection,l,n),t.append(l)}));let i=(0,e.createTableCell)({class:["field--table-header-cell","field--table-header-cell--action"]},"Action");t.append(i),this.header.append(t)}return this.source.hasValue()&&this.source.getValue().forEach((e=>{this.addRow(e)})),n.hasChildNodes()&&(this.element.append(n),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,hasValue(){return this.body.rows.length>0},getValue(){return this.body.rows},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.table.classList.remove("empty")):(this.element.classList.add("empty"),this.table.classList.add("empty")),this.contentElements.forEach(((t,i)=>{if(!Array.isArray(i.state))return;const{currentState:s}=i,n=ft.call(this,i,i.state);if(s===i.currentState)return;let r=null;r=n?Yn.call(this,n.content,null):Yn.call(this,i.content,null),(0,e.removeChildren)(t).append(r)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},createElement(){return this.source.createElement()},addRow(t){const{action:i={},before:s={},after:n={}}=this.schema,{disposition:r}=this.template,a=(0,e.valOrDefault)(t.index,this.table.rows.length),l="row"+Pt++,o=(0,e.createTableRow)({class:["field--table-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id,index:a,elementId:l}});this.elements.set(l,o),r.forEach((i=>{const{body:s}=i,{style:n,content:r}=s;var a=Yn.call(this,r,t),l=(0,e.createTableCell)({class:["field--table-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);Je.call(this.projection,l,n),o.append(l)}));var h=(0,e.createTableCell)({class:["field--table__cell-action"]}),{content:c,style:d}=(0,e.valOrDefault)(i.remove,_t),u=Yn.call(this,c),m=(0,e.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",rowId:l}},u),p=(0,e.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-up",rowId:l}},"Move up"),f=(0,e.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-down",rowId:l}},"Move down");Je.call(this.projection,m,d),h.append(m,p,f),o.append(h),this.body.append(o),this.refresh()},removeRow(t){var i=this.body.rows.item(t.index);if(!(0,e.isHTMLElement)(i))throw new Error("Table error: Row not found");(0,e.removeChildren)(i),i.remove();for(let e=t.index;e<this.body.rows.length;e++){const t=this.body.rows.item(e),{index:i}=t.dataset;t.dataset.index=+i-1}this.refresh()},removeElement(e){return this.source.removeElement(e)},delete(e){if(e===this.element||e===this.table)return void this.source.delete();const{index:i}=e.dataset;this.source.removeElementAt(+i)||(this.environment.notify("This element cannot be deleted"),(0,t.lL)(e))},bindEvents(){this.element.addEventListener("click",(t=>{const{target:i}=t,s=function(t){const i="field-component";return t.dataset.nature===i?t:(0,e.findAncestor)(t,(e=>e.dataset.nature===i))}(i);if(!(0,e.isHTMLElement)(s))return;const{id:n,action:r}=s.dataset;if(n===this.id)if("add"===r)this.createElement();else if("remove"===r){const{rowId:e}=s.dataset;let t=this.elements.get(e);this.delete(t)}else if("move-up"===r){const{rowId:e}=s.dataset;let t=this.elements.get(e),i=t.previousElementSibling;i&&i.before(t)}else if("move-down"===r){const{rowId:e}=s.dataset;let t=this.elements.get(e),i=t.nextElementSibling;i&&i.after(t)}}),!0),this.projection.registerHandler("value.added",(e=>{this.addRow(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeRow(e)})),this.projection.registerHandler("value.changed",(t=>{(0,e.removeChildren)(this.body),this.source.getValue().forEach((e=>{this.addRow(e)}))}))}},Ft=Object.assign(Object.create(dt),$t),zt=t=>(0,e.isHTMLElement)(t,["input","textarea"]),Wt="error";function qt(){return(0,e.isHTMLElement)(this.choice)||(this.choice=(0,e.createUnorderedList)({class:["bare-list","field--textbox__choices"],dataset:{nature:"field-component",view:"text",component:"choice",id:this.id}}),this.append(this.choice)),this.choice}function Xt(t){return(0,e.createListItem)({class:["field--textbox__choice"],tabindex:0,dataset:{nature:"field-component",view:"text",component:"choice-item",value:t,id:this.id}},t)}function Yt(t){return t.parentElement===this.choice?t:(0,e.findAncestor)(t,(e=>e.parentElement===this.choice),3)}function Zt(t){const{placeholder:i="",type:s}=t;let n="";return n=this._placeholder?(0,e.valOrDefault)(zn.call(this,this._placeholder),""):(0,e.valOrDefault)(zn.call(this,i),""),this.readonly||this.resizable?(0,e.createSpan)({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:n,dataset:{placeholder:n,nature:"field-component",view:this.type,id:this.id}}):this.multiline?(0,e.createTextArea)({class:["field--textbox__input"],placeholder:n,title:n,dataset:{nature:"field-component",view:this.type,id:this.id}}):(0,e.createInput)({class:["field--textbox__input"],type:(0,e.valOrDefault)(s,"text"),placeholder:n,title:n,dataset:{nature:"field-component",view:this.type,id:this.id}})}const Gt={input:null,choice:null,value:"",placeholder:null,multiline:!1,resizable:!1,content:null,hasOwnSource:!1,init(t={}){Object.assign(this.schema,t);const{multiline:i=!1,placeholder:s="",resizable:n=!1,focusable:r=!0,source:a}=this.schema;if(this.multiline=i,this.focusable=r,this.resizable=n,this.children=[],this._placeholder=s,a){const e=this.projection.concept.getAttribute(a).getTarget();e.register(this),this.source=e,this.hasOwnSource=!0}return(0,e.hasOwn)(this.schema,"choice")||(this.schema.choice={}),this},focus(e){return this.input.focus(),this},focusIn(){return this.focused=!0,this.value=this.getValue(),this.element.classList.add("active"),this.element.classList.add("focus"),this},focusOut(){return this.hasChanges()&&this.setValue(this.getValue(),!0),(0,e.isNullOrWhitespace)(this.getValue())&&(this.input.textContent=""),this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.choice&&(0,t.Cp)(this.choice),this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("focus"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!=this.getValue()},hasValue(){return!(0,e.isEmpty)(this.getValue())},getValue(){return zt(this.input)?this.input.value:this.input.textContent},setValue(e,i=!1){var s;(s=i?this.source.setValue(e):{success:!0}).success||((0,t.lL)(this.element),this.environment.notify(s.message,"error")),this.setInputValue(e),this.value=e,this.refresh()},setInputValue(e){zt(this.input)?this.input.value=e:this.input.textContent=e},getCandidates(){let e=this.source.getCandidates();return Array.isArray(e)?e:[]},enable(){return this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1,this.element.classList.add("disabled"),this},disable(){return this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0,this.element.classList.remove("disabled"),this},refresh(){ft.call(this,this.schema,this.schema.state),this.hasValue()?this.element.classList.remove("empty"):this.element.classList.add("empty"),this.element.dataset.value=this.value,this.hasError?(this.element.classList.add(Wt),this.input.classList.add(Wt)):(this.element.classList.remove(Wt),this.input.classList.remove(Wt)),this.choice&&this.filterChoice(this.getValue())},render(){const t=(0,e.createDocFragment)(),{container:i,input:s={},style:n}=this.schema;if((0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:["field","text-field","field--textbox"],dataset:{nature:"field",view:"text",id:this.id,disabled:this.disabled,readonly:this.readonly,value:""}}),this.readonly&&this.element.classList.add("readonly"),this.disabled&&this.element.classList.add("disabled"),Je.call(this.projection,this.element,this.schema.style)),i){const{content:e=[],style:s}=i;e.forEach((e=>{if("input"===e.type){const{style:i}=e.input;this.input=Zt.call(this,e.input),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Je.call(this.projection,this.input,i),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),t.append(this.input)}else{let i=Yn.call(this,e,null,{focusable:!1});t.append(i)}})),Je.call(this.projection,this.element,s)}else{if(!(0,e.isHTMLElement)(this.input)){const{style:e}=s;this.input=Zt.call(this,s),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Je.call(this,this.input,e),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),t.append(this.input)}Je.call(this.projection,this.element,n)}return t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},filterChoice(i){const{children:s}=this.choice;if((0,e.isNullOrWhitespace)(i)){for(let e=0;e<s.length;e++){const i=s[e];(0,t.$Z)(i),i.hidden=!1}return!0}let n=i.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<s.length;e++){const i=s[e],{value:r}=i.dataset;n.some((e=>r.toLowerCase().includes(e)))?((0,t.$Z)(i),i.hidden=!1):((0,t.Cp)(i),i.hidden=!0)}return!0},selectChoice(i){if(!(0,e.isHTMLElement)(i))return;const s=function(e){return e.dataset.value}(i);return this.setValue(s,!0),this.input.focus(),(0,t.Cp)(this.choice),this},update(e,t,i){"delete"!==e?"value.changed"===e&&this.setValue(t):this.delete()},_spaceHandler(i){const s=new Set(this.getCandidates());if(0===s.size)this.notify("Enter any text.",t.k$.INFO);else{qt.call(this);const i=(0,e.createDocFragment)();s.forEach((e=>i.append(Xt.call(this,e)))),(0,e.removeChildren)(this.choice).append(i),this.filterChoice(this.getValue()),(0,t.$Z)(this.choice)}},escapeHandler(i){let s=!0;if(this.messageElement&&!(0,t.xj)(this.messageElement)&&((0,t.Cp)(this.messageElement),s=!1),this.choice&&!(0,t.xj)(this.choice)&&((0,t.Cp)(this.choice),s=!1),s){let t=(0,e.findAncestor)(i,(e=>0===e.tabIndex)),s=this.environment.resolveElement(t);return s&&s.focus(t),!1}return this.input.focus(),!0},enterHandler(e){const t=Yt.call(this,e);return t?this.selectChoice(t):this.multiline||(e===this.input?this.setValue(this.getValue(),!0):this.focus()),!0},backspaceHandler(e){Yt.call(this,e)&&this.input.focus()},clickHandler(t){const i=Yt.call(this,t);(0,e.isHTMLElement)(i)&&this.selectChoice(i)},arrowHandler(i,s){if(!(0,e.isHTMLElement)(s))return!1;const{parentElement:n}=s,r=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);let a=Yt.call(this,s);if((0,e.isHTMLElement)(a)){let s=(0,t.As)(a,i,this.choice);return(0,e.isHTMLElement)(s)?(s.focus(),!0):this.arrowHandler(i,this.choice)}if(n!==this.element)return r();let l=null;if("right"===i){if(s===this.input&&!(this.getValue().length<(0,t.qO)(this.input)+1))return!1;l=(0,t.As)(s,i,this.element,!1)}else if("left"===i){if(s===this.input&&0!==(0,t.qO)(this.input))return!1;l=(0,t.As)(s,i,this.element,!1)}else l=(0,t.As)(s,i,this.element,!1);return(0,e.isHTMLElement)(l)&&l.dataset.id===this.id?("up"===i?l=(0,t.GV)(this.choice):"down"===i?l=(0,t.Sd)(this.choice):"left"===i?l=(0,t.GF)(this.choice):"right"===i&&(l=(0,t.EE)(this.choice)),l.focus(),!0):r()},bindEvents(){this.element.addEventListener("input",(e=>{this.hasError&&this.source.setValue(this.getValue(),!0),this.refresh()})),this.hasOwnSource||this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},Jt=Object.assign(Object.create(dt),Gt);var Kt=s(185);const Qt={init(){const{arrowStyle:t=null,path:i,attach:s={}}=this.schema;return(0,e.isNullOrUndefined)(t)?this.arrowStyle={}:this.arrowStyle=t,i&&(this.meet=i.meet),s&&(this.attach=s.type),this},render(){const{reference:t,decorator:i=!1}=this.schema;if((0,e.isHTMLElement)(this.element)||(this.element=document.createElementNS("http://www.w3.org/2000/svg","path"),this.element.style.fill="transparent",this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="arrow",this.element.dataset.id=this.id),(0,e.isNullOrUndefined)(this.reference))switch(t.type){case"multiple":this.reference=this.source.getAttributeByName(t.listen).target,this.multiple=!0;break;case"duo":this.from=this.source.getAttributeByName(t.from).target,this.to=this.source.getAttributeByName(t.to).target,this.multiple=!1}return this.computeStyle(),this.bindEvent(),this.element},getStyle(){},signal(){(0,e.isNullOrUndefined)(this.valSource)||(0,e.isNullOrUndefined)(this.valTarget)||this.projection.parent.accept(this.valSource,this.valTarget,this)},computeStyle(){const{stroke:t="black",dasharray:i=null,width:s=1,linecap:n="butt",end:r=!1,start:a=!1}=this.arrowStyle;this.element.style.stroke=t,(0,e.isNullOrUndefined)(i)||(this.element.style["stroke-dasharray"]=i),this.element.style["stroke-width"]=(0,e.valOrDefault)(s,5),this.element.style["stroke-linecap"]=n,r&&this.createMarkerEnd()},createMarkerEnd(){(0,e.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.end=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.end.id="marker"+this.id,this.end.setAttribute("refY",5),this.end.setAttribute("refX",10),this.end.setAttribute("markerUnit","strokeWidth"),this.end.setAttribute("markerWidth",10),this.end.setAttribute("markerHeight",10),this.end.setAttribute("orient","auto"),this.end.classList.add("end");let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t.setAttribute("fill","black"),this.end.appendChild(t),this.definitions.appendChild(this.end),this.path.setAttribute("marker-end","url(#"+this.end.id+")")},createMarkerStart(){(0,e.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.start=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.start.id="marker"+this.id,this.start.setAttribute("refY",5),this.start.setAttribute("refX",1),this.start.setAttribute("markerUnit","strokeWidth"),this.start.setAttribute("markerWidth",10),this.start.setAttribute("markerHeight",10),this.start.setAttribute("orient","auto"),this.start.classList.add("start");let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t.setAttribute("fill","black"),this.start.appendChild(t),this.definitions.appendChild(this.end),this.element.setAttribute("marker-start","url(#"+this.end.id+")")},setValues(){(0,e.isNullOrUndefined)(this.source.getAttributeByName("target").target.value)||(this.valTarget=this.source.getAttributeByName("target").target.value),(0,e.isNullOrUndefined)(this.source.getAttributeByName("source").target.value)||(this.valSource=this.source.getAttributeByName("source").target.value)},refresh(){this.setValues(),this.updateRegister(),this.signal()},deleteRef(e,t){this.valTarget!==e.id&&this.valSource!==e.id||this.projection.parent.removeArrow(this,t)},setLine(e,t){this.element.setAttribute("d","M "+e.x+", "+e.y+"L "+t.x+", "+t.y)},setPath(e){this.element.setAttribute("d",e)},updateRegister(){for(let e=0;e<this.registered.length;e++)this.registered[e]={name:this.registered[e].name,value:this.source.getAttributeByName(this.registered[e].name).target.value}},register(t){(0,e.isNullOrUndefined)(this.getAttribute)&&(this.registered.push({name:t,value:this.source.getAttributeByName(t).target.value}),this.source.getAttributeByName(t).target.register(this.projection),this.projection.registerHandler("value.added",(e=>{this.refresh()})))},get(e){for(let t=0;t<this.registered.length;t++)if(this.registered[t].name===e)return this.registered[t].value},registerValue(t){(0,e.isNullOrUndefined)(this.registered)&&(this.registered=[]),t.register(this),this.registered.push({concept:t,currentVal:t.value})},update(e,t){switch(e){case"value.changed":this.updatePath(t)}},updatePath(){this.lineUpdate(),this.parent.container.append(this.element)},updatePathDuo(){switch(this.attach){case"anchor":this.anchorAttach()}},anchorAttach(){this.occupied&&Kt.AnchorHandler.freeOccupation(this),this.occupant&&this.occupant.removeAnchor(this);let e=this.parent.container.querySelector('[data-concept="'+this.valueF+'"]'),t=this.parent.container.querySelector('[data-concept="'+this.valueT+'"]'),i=Kt.AnchorHandler.findCommonIndex(e.dataset.id,t.dataset.id,this.occupant,this),s=Kt.AnchorHandler.getAnchorAt(e.dataset.id,i),n=Kt.AnchorHandler.getAnchorAt(t.dataset.id,i),r=e.getBoundingClientRect(),a=this.parent.container.createSVGPoint();a.x=r.x+s.x,a.y=r.y+s.y;let l=a.matrixTransform(this.parent.container.getScreenCTM().inverse());r=t.getBoundingClientRect(),a.x=r.x+n.x,a.y=r.y+n.y;let o=a.matrixTransform(this.parent.container.getScreenCTM().inverse());this.setPath("M "+l.x+" "+l.y+" L "+o.x+" "+o.y),this.parent.container.append(this.element),this.occupant&&this.occupant.accept(this,l,o,i),Kt.AnchorHandler.registerOccupation(this,i,e.dataset.id,t.dataset.id),this.occupied=!0},forceAnchor(e){let t=this.parent.container.querySelector('[data-concept="'+this.valueF+'"]'),i=this.parent.container.querySelector('[data-concept="'+this.valueT+'"]'),s=Kt.AnchorHandler.getAnchorAt(t.dataset.id,e),n=Kt.AnchorHandler.getAnchorAt(i.dataset.id,e),r=t.getBoundingClientRect(),a=this.parent.container.createSVGPoint();a.x=r.x+s.x,a.y=r.y+s.y;let l=a.matrixTransform(this.parent.container.getScreenCTM().inverse());r=i.getBoundingClientRect(),a.x=r.x+n.x,a.y=r.y+n.y;let o=a.matrixTransform(this.parent.container.getScreenCTM().inverse());return this.setPath("M "+l.x+" "+l.y+" L "+o.x+" "+o.y),this.parent.container.append(this.element),this.occupant&&this.occupant.accept(this,l,o,e),Kt.AnchorHandler.registerOccupation(this,e,t.dataset.id,i.dataset.id),this.occupied=!0,{e:this,from:t.dataset.id,to:i.dataset.id,index:e}},lineUpdate(){let e=this.targetInformations();switch(this.meet){case"minY":let t=e[0].y,i=e[0];for(let s=1;s<e.length;s++){let n=e[s].y;n<t&&(t=n,i=e[s])}this.computeLineMin(e,e[0],i)}},computeLineMin(t,i,s,n){let r=i.x,a=s.x,l=i.y,o=(l-s.y)/(r-a),h=l-o*r;(0,e.isNullOrUndefined)(n)||(h-=n);for(let e=0;e<t.length;e++){let n=o*t[e].x+h;if(n>t[e].y)return this.computeLineMin(t,i,s,n-t[e].y)}let c="M "+(r-.5)+" "+(a*o+h)+" L "+(t[t.length-1].x+.5)+" "+(a*o+h);this.setPath(c),(0,e.isNullOrUndefined)(this.subPath)&&(this.subPath=[]),(0,e.isEmpty)(this.subPath)||(this.subPath.forEach((e=>{e.remove()})),this.subPath=[]);let d=a*o+h;for(let e=0;e<t.length;e++)if(t[e].y>d){let i=document.createElementNS("http://www.w3.org/2000/svg","line");i.classList.add("subPath"),this.subPath.push(i),i.setAttribute("x1",t[e].x),i.setAttribute("x2",t[e].x),i.setAttribute("y1",t[e].y),i.setAttribute("y2",d),this.parent.container.append(i),i.style["stroke-width"]=.75,i.setAttribute("stroke","black")}},targetInformations(){let t=[],i=!1;return this.registered.forEach((s=>{let n=s.concept.value;if((0,e.isNullOrUndefined)(n))return void(i=!0);let r=this.parent.container.querySelector('[data-concept="'+n+'"]'),a=this.projection.resolveElement(r),l=this.parent.container.createSVGPoint(),o=r.getBoundingClientRect();l.x=o.x,l.y=o.y;let h=l.matrixTransform(this.parent.container.getScreenCTM().inverse());(0,e.isNullOrUndefined)(a.schema.arrowAnchor)||(h.x+=a.schema.arrowAnchor.x,h.y+=a.schema.arrowAnchor.y),t.push({x:h.x,y:h.y})})),!i&&t},duoUpdate(){this.valueF=this.from.value,this.valueT=this.to.value,(0,e.isNullOrUndefined)(this.valueF)||(0,e.isNullOrUndefined)(this.valueT)||this.updatePathDuo()},updatePosition(e){let t=this.projection.resolveElement(this.projection.parent.findItem(e.id).render),i=this.projection.resolveElement(this.projection.parent.findAncestor(this.bind.container).render),s=i.findAnchorIndex(this.bind.container),n=t.findAnchor(s),r=i.findAnchor(s);const a=Number(i.container.getAttribute("x"))+r.x,l=Number(i.container.getAttribute("y"))+r.y,o=Number(t.container.getAttribute("x"))+n.x,h=Number(t.container.getAttribute("y"))+n.y;this.element.setAttribute("d","M "+a+" "+l+" L "+o+" "+h),this.projection.parent.container.append(this.element)},bindProj(e){this.bind=e;const t=this.schema.reference.target;this.objectiv=this.source.getAttributeByName(t).target,this.objectiv.register(this.projection),this.projection.registerHandler("value.changed",(e=>{this.updatePosition(e)}))},bindEvent(){switch(this.schema.reference.type){case"duo":this.from.register(this.projection),this.to.register(this.projection),this.projection.registerHandler("value.changed",(e=>{this.duoUpdate()}));break;case"multiple":this.reference.register(this.projection),this.projection.registerHandler("value.added",(e=>{this.registerValue(e)}))}}},ei=Object.assign(Object.create(dt),Qt),ti={init(t){if(!(0,e.isNullOrUndefined)(t)){const{focusable:e=!1}=t;this.focusable=e}return this},render(){const{placeholder:t,style:i,readonly:s,breakDown:n=!1}=this.schema;return(0,e.isNullOrUndefined)(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","text"),this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="svg",this.element.style["dominant-baseline"]="hanging",this.element.dataset.id=this.id,this.element.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")),this.source.hasValue()?this.content=this.source.getValue().toString():this.content=t,n&&(this.breakDown=n),this.breakDown?this.element.textContent=this.content.substring(0,n):this.element.textContent=this.content,this.caps=!1,this.readonly=s,this.bindEvents(),this.style(),this.element},registerDimensionsObserver(t){(0,e.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(t)},setActiveChar(e,t,i){let{target:s,end:n=!1}=this.findChar(t,i);this.index=s,this.end=n,this.char=n?this.element.getEndPositionOfChar(s):this.element.getStartPositionOfChar(s),this.createCursor(),this.switchOn(),this.addListeners()},style(){const{font:e,size:t,anchor:i="left",weight:s,baseline:n}=this.schema.style;this.element.setAttribute("text-anchor",i),this.element.setAttribute("font-family",e),this.element.setAttribute("font-size",t),this.element.style["dominant-baseline"]=n,s&&this.element.setAttribute("font-weight",s),this.baseline=n,this.size=t},setValue(){"number"===this.source.name?this.source.setValue(Number(this.content)):this.source.setValue(this.content)},addListeners(){this.element.addEventListener("keydown",(e=>{let t=e.keyCode;if(27===t)return""===this.content&&(this.content=this.schema.placeholder,this.element.textContent=this.content),this.setValue(this.content),void this.switchOff();if(e.stopPropagation(),t!==this.lastKey||!this.repeat){switch(t){case 8:0===this.index&&this.end&&""!==this.content&&(this.content="",this.element.textContent=""),this.index>0&&(this.end?(this.content=this.content.slice(0,this.index),this.element.textContent=this.content):(this.content=this.content.slice(0,this.index-1)+this.content.slice(this.index),this.element.textContent=this.content),this.index--);break;case 46:this.index<this.content.length-1&&!this.end&&(this.content=this.content.slice(0,this.index)+this.content.slice(this.index+1),this.element.textContent=this.content),this.index!==this.content.length-1||this.end||(this.content=this.content.slice(0,this.index),this.element.textContent=this.content,this.end=!0,this.index--),0===this.index&&1===this.content.length&&(this.content="",this.element.textContent=this.content);break;case 20:this.caps=!this.caps;break;case 32:e.preventDefault(),this.end?(this.content+=" ",this.element.textContent=this.content):(this.content=this.content.slice(0,this.index)+" "+this.content.slice(this.index),this.element.textContent=this.content),this.index++}"number"!==this.source.name&&(t>=65&&t<=90||t>=48&&t<=57||t>=90&&t<=105)&&(this.caps?this.end?this.content=this.content+String.fromCharCode(e.keyCode):this.content=this.content.slice(0,this.index)+String.fromCharCode(e.keyCode)+this.content.slice(this.index):this.end?this.content=this.content+String.fromCharCode(e.keyCode).toLowerCase():this.content=this.content.slice(0,this.index)+String.fromCharCode(e.keyCode).toLowerCase()+this.content.slice(this.index),this.element.textContent=this.content,this.index++),"number"===this.source.name&&(t>=48&&t<=57||t>=96&&t<=105)&&(t>=96&&t<=105&&(t-=48),this.end?this.content=this.content+String.fromCharCode(t):this.content=this.content.slice(0,this.index)+String.fromCharCode(t)+this.content.slice(this.index),this.element.textContent=this.content,this.index++),this.lastKey=e.keyCode,this.repeat=!0,setTimeout((()=>{this.repeat=!1}),50),this.updateCursor(),this.setValue(this.content)}}))},switchOn(){this.on=!0,this.element.parentNode.append(this.cursor),(0,e.isNullOrUndefined)(this.interval)||clearInterval(this.interval),this.interval=setInterval((()=>{this.on?(this.cursor.remove(),this.on=!1):(this.element.parentNode.append(this.cursor),this.on=!0)}),1e3)},switchOff(){this.on=!1,(0,e.isNullOrUndefined)(this.cursor)||this.cursor.remove(),clearInterval(this.interval)},createCursor(){(0,e.isNullOrUndefined)(this.cursor)||this.cursor.remove();let t=this.element.getBBox();switch(e.isNullOrUndefined&&(this.cursor=document.createElementNS("http://www.w3.org/2000/svg","rect")),this.cursor.setAttribute("x",this.char.x),this.baseline){case"middle":case"auto":this.cursor.setAttribute("y",Number(this.element.getAttribute("y"))-t.height/2);break;case"hanging":this.cursor.setAttribute("y",this.element.getAttribute("y"))}this.cursor.setAttribute("width",1),this.cursor.setAttribute("height",t.height)},updateCursor(){if(""!==this.content){if(this.end)return this.char=this.element.getEndPositionOfChar(this.content.length-1),void this.cursor.setAttribute("x",this.char.x);this.char=this.element.getStartPositionOfChar(this.index),this.cursor.setAttribute("x",this.char.x)}else this.cursor.setAttribute("x",Number(this.element.getAttribute("x")))},findChar(e,t){let i=0,s=this.element.getStartPositionOfChar(0),n=s.x,r=this.element.getBoundingClientRect().x,a=(e-r)*(e-r);for(let t=1;t<this.element.getNumberOfChars();t++){let s=e-(r-n+this.element.getStartPositionOfChar(t).x);if(!(a>s*s))return{target:t,end:!1};a=s*s,i=t}s=this.element.getEndPositionOfChar(this.element.getNumberOfChars()-1);let l=e-(r-n+s.x);return l*l<a?{target:this.element.getNumberOfChars()-1,end:!0}:{target:this.element.getNumberOfChars()-1,end:!1}},findCharRelative(e){let t,i=0,s=this.element.getStartPositionOfChar(0),n=e.x-s.x,r=e.y-s.y,a=Math.sqrt(n*n+r*r),l=a;for(t=1;t<this.element.getNumberOfChars();t++){if(s=this.element.getStartPositionOfChar(t),n=e.x-s.x,r=e.y-s.y,a=Math.sqrt(n*n+r*r),!(a<l))return{target:i,start:!0};l=a,i=t}return s=this.element.getEndPositionOfChar(t-1),n=e.x-s.x,r=e.y-s.y,a=Math.sqrt(n*n+r*r),a<l?{target:t-1,start:!1,end:!0}:{target:i,start:!0}},focusIn(){},focusOut(){console.log("SwitchOff"),this.readonly||(console.log("SwitchOff"),this.switchOff(),this.setValue(this.content))},bindEvents(){this.readonly||this.element.addEventListener("click",(e=>{this.setActiveChar(e.target,e.clientX,e.clientY)})),this.projection.registerHandler("value.changed",(e=>{this.content=e.toString(),this.breakDown&&e.length>this.breakDown?this.element.textContent=this.content.substring(0,this.breakDown):this.element.textContent=this.content}))}},ii=Object.assign(Object.create(dt),ti),si={createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return t.append(i),i.append(e),t},analysePos(e,t){console.log("Analysing"),console.log(t);let i=t.coordinates;const s={};switch(s.type=i.type,s.render=e,console.log(i.type),i.type){case"delegate":s.await=!1;break;default:s.anchor=i.anchor,s.x=i.x,s.y=i.y,s.await=!0}return console.log(s),s},positionElement(e,t){switch(e.anchor){case"middle":return t.setAttribute("x",e.x-Number(t.getAttribute("width"))/2),void t.setAttribute("y",e.y);case"right":return t.setAttribute("x",e.x-Number(t.getAttribute("width"))),void t.setAttribute("y",e.y);case"center":return t.setAttribute("x",e.x-Number(t.getAttribute("width"))/2),void t.setAttribute("y",e.x-Number(t.getAttribute("height"))/2);default:console.log("Undefined"),console.log(t),t.setAttribute("x",e.x),t.setAttribute("y",e.y)}},analyseDim(e,t){let i=t.dimension;const s={};switch(s.type=i.type,s.item=e,i.type){case"fixed":s.value=i.value,s.holder=this.createHolder(e),s.await=!0;break;case"absolute":s.width=i.width,s.height=i.height,s.holder=this.createHolder(e),s.await=!0;break;case"ratio":s.ratio=i.ratio,s.holder=this.createHolder(e),s.await=!0;break;case"pure":s.await=!1}return s},setDimensions(e){switch(e.type){case"fixed":this.adaptFixed(e.item,e.value);break;case"absolute":this.adaptAbsolute(e.item,e.width,e.height);break;case"ratio":this.adaptRatio(e.item,e.ratio)}},adaptFixed(e,t){let i=e.parentNode,s=i.parentNode,n=e.getBoundingClientRect();i.setAttribute("width",n.width),i.setAttribute("height",n.height),s.setAttribute("width",t),s.setAttribute("height",t*n.height/n.width),s.setAttribute("viewBox","0 0 "+n.width+" "+n.height)},adaptAbsolute(e,t,i){let s=e.parentNode,n=s.parentNode;s.setAttribute("width",t),s.setAttribute("height",i),n.setAttribute("width",t),n.setAttribute("height",i)},adaptRatio(e,t){let i=Number(e.getAttribute("width")),s=Number(e.getAttribute("height")),n=e.parentNode,r=n.parentNode;n.setAttribute("width",i),n.setAttribute("height",s),r.setAttribute("width",i*t),r.setAttribute("height",s*t),r.setAttribute("viewBox","0 0 "+i+" "+s)}},{createDocFragment:ni,isNullOrUndefined:ri,createI:ai,createArticle:li,findAncestor:oi,removeChildren:hi,windowWidth:ci,isObject:di,valOrDefault:ui}=s(835);function mi(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.candidates.find((e=>e.id===i)).id:"meta-concept"===t?this.candidates.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const pi={init(){return this.width=0,this.height=0,this.items=new Map,this},render(){const{selection:e,dimensions:t,openSelection:i}=this.schema;if(ri(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-choice",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),t?(this.element.setAttribute("width",t.width),this.element.setAttribute("height",t.height)):this.element.style.overflow="visible",this.candidates=this.source.getCandidates(),ri(this.selection)&&(this.createSelection(e),this.element.append(this.selection)),i&&ri(this.openSelection)){const e=new DOMParser;this.openSelection=e.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.element.append(this.openSelection),this.openSelection.addEventListener("click",(()=>{if(this.open)return this.selection.remove(),void(this.open=!1);this.element.append(this.selection),this.open=!0}))}return this.open=!0,this.bindEvents(),this.element},setValue(e){this.source.setValue(e)},createSelection(e){const{item:t,breakPoint:i=!1,direction:s,close:n}=e;this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg");let r=0;this.candidates.forEach((e=>{const n=di(e),{dimension:a,tag:l}=t;let{holder:o,foreign:h}=this.createChoiceContainer(a);if(this.items.set(e.id,o),"meta-concept"===e.type){let t=this.model.getProjectionSchema(e.concept,ui(l))[0],i=t.type,s={type:i,[i]:t.content||t.projection},n=Yn.call(this,s,e.concept,{focusable:!1,meta:e.name});o.dataset.type="meta-concept",o.dataset.value=e.name,n.style.position="fixed",h.append(n)}else if(n){if(!this.model.hasProjectionSchema(e,l))return container;let t=this.model.createProjection(e,l).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,h.append(t.render()),h.childNodes[0].style.position="fixed",o.dataset.type="concept",o.dataset.value=e.id}else h.append(e.toString());switch(s){case"horizontal":i?(o.setAttribute("y",~~(r/i)*a.height),o.setAttribute("x",r%i*a.width),this.width=i*a.width,this.height=(1+~~(r/i))*a.height):(o.setAttribute("x",r*a.width),this.width=(r+1)*a.width,this.height=a.height);break;case"vertical":i?(o.setAttribute("x",~~(r/i)*a.width),o.setAttribute("y",r%i*a.height)):o.setAttribute("y",r*a.height)}this.bindEvent(o),this.selection.append(o),o.style.border="dotted black",r++}))},registerDimensionsObserver(e){ri(this.observers)&&(this.observers=[]),this.observers.push(e)},notifyDimObservers(){ri(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))},bindEvent(e){e.addEventListener("click",(()=>{this.setValue(mi.call(this,e)),this.schema.selection.close&&(this.open=!1,this.selection.remove(),this.width=0,this.height=0,this.notifyDimObservers())}))},bindEvents(){this.projection.registerHandler("displayed",(()=>{this.displayed||(this.displayed=!0,this.items.forEach(((e,t)=>{const i=e.childNodes[0].childNodes[0];this.projection.resolveElement(i).projection.update("displayed")})))})),this.projection.registerHandler("value.changed",(()=>{this.schema.selection.close&&(this.open=!1,this.selection.remove(),this.width=0,this.height=0,this.notifyDimObservers())}))},createChoiceContainer(e){const{width:t,height:i}=e;let s=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return s.setAttribute("width",t),s.setAttribute("height",i),n.setAttribute("width",t),n.setAttribute("height",i),s.append(n),{holder:s,foreign:n}},focusIn(){},focusOut(){}},fi=Object.assign(Object.create(dt),pi),{createDocFragment:gi,isNullOrUndefined:vi,createI:bi,createArticle:yi,findAncestor:wi,removeChildren:xi,windowWidth:Ei,isObject:Ai,valOrDefault:Oi}=s(835);function Ni(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.candidates.find((e=>e.id===i)).id:"meta-concept"===t?this.candidates.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const ji={init(){return this.width=0,this.height=0,this.items=new Map,this},render(){const{selection:e,dimensions:t,open:i,overflow:s=!1}=this.schema;if(vi(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-placeholder",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),s&&(this.element.style.overflow="visible"),t&&(this.element.setAttribute("width",t.width),this.element.setAttribute("height",t.height)),vi(this.openBack)){const{render:e,coordinates:t,dimensions:s}=i;console.log("rendering open-back"),console.log(i),this.openBack=Yn.call(this,Object.assign(e,{action:{type:"OPEN",target:this}})),this.openBack.setAttribute("x",Oi(t.x,0)),this.openBack.setAttribute("y",Oi(t.y,0))}return this.candidates=this.source.getCandidates(),vi(this.selection)&&(this.createSelection(e),this.element.append(this.selection)),vi(this.source.value)?this.opened=!0:(this.opened=!1,this.element.append(this.openBack)),this.element},clickHandler(e){},setValue(e){this.source.setValue(e),this.element.append(this.openBack),this.opened=!1},open(){this.opened=!0,this.element.append(this.selection),this.openBack.remove(),this.source.removeValue()},createSelection(e){const{item:t,breakPoint:i=!1,direction:s,close:n}=e;this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.candidates.forEach((e=>{const i=Ai(e),{tag:s}=t;if("meta-concept"===e.type){let t=this.model.getProjectionSchema(e.concept,Oi(s))[0],i=t.type,n={type:i,[i]:t.content||t.projection},r=Yn.call(this,n,e.concept,{focusable:!1,meta:e.name});r.dataset.type="meta-concept",r.dataset.value=e.name;const a=this.projection.resolveElement(r).schema.coordinates;r.setAttribute("x",a.x),r.setAttribute("y",a.y),this.bindEvent(r),this.selection.append(r),this.items.set(e.id,r)}else if(i){if(!this.model.hasProjectionSchema(e,s))return container;let t=this.model.createProjection(e,s).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection;let i=t.render();const n=t.element.schema.coordinates;i.setAttribute("x",n.x),i.setAttribute("y",n.y),this.bindEvent(i),this.selection.append(i),this.items.set(e.id,i)}}))},focusIn(){this.opened||this.element.append(this.openBack)},focusOut(){this.opened||this.openBack.remove()},registerDimensionsObserver(e){vi(this.observers)&&(this.observers=[]),this.observers.push(e)},notifyDimObservers(){vi(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))},bindEvent(e){e.addEventListener("click",(()=>{const t=Ni.call(this,e);this.setValue(t),this.selection.remove(),this.element.append(this.openBack)}))}},Ci=Object.assign(Object.create(dt),ji),{isNull:Li,isNullOrUndefined:Si}=s(835),ki={init(){return this},render(){const{order:e,dimensions:t=!1}=this.schema;if(Si(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-switch",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),t&&(this.element.setAttribute("width",t.width),this.element.setAttribute("height",t.height)),Si(this.index)&&(this.index=0),this.order=e,this.source.hasValue())for(let e=0;e<this.order.length;e++)if(this.order[e]===this.source.value){this.index=e;break}return this.bindEvents(),this.element},clickHandler(){this.index=(this.index+1)%this.order.length,this.source.setValue(this.order[this.index])},registerDimensionsObserver(e){},focusIn(){},focusOut(){},bindEvents(){}},Ti=Object.assign(Object.create(dt),ki),Mi={binary:(e,t,i)=>Object.create(xt,{object:{value:"field"},name:{value:"binary-field"},type:{value:"binary"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),choice:(e,t,i)=>Object.create(Ct,{object:{value:"field"},name:{value:"choice-field"},type:{value:"choice"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),list:(e,t,i)=>Object.create(Dt,{object:{value:"field"},name:{value:"list-field"},type:{value:"list"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),table:(e,t,i)=>Object.create(Ft,{object:{value:"field"},name:{value:"table-field"},type:{value:"table"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),text:(e,t,i)=>Object.create(Jt,{object:{value:"field"},name:{value:"text-field"},type:{value:"text"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),interactive:(e,t,i)=>Object.create(Tt,{object:{value:"field"},name:{value:"interactive-field"},type:{value:"interactive"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),static:(e,t,i)=>Object.create(Bt,{object:{value:"field"},name:{value:"static-field"},type:{value:"static"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),dynamic:(e,t,i)=>Object.create(St,{object:{value:"field"},name:{value:"dynamic-field"},type:{value:"dynamic"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),add:(e,t,i)=>Object.create(pt,{object:{value:"field"},name:{value:"add-field"},type:{value:"add"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),arrow:(e,t,i)=>Object.create(ei,{object:{value:"field"},name:{value:"arrow"},type:{value:"arrow"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),svg:(e,t,i)=>Object.create(ii,{object:{value:"field"},name:{value:"svg"},type:{value:"svg"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),"svg-choice":(e,t,i)=>Object.create(fi,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),"svg-placeholder":(e,t,i)=>Object.create(Ci,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),"svg-switch":(e,t,i)=>Object.create(Ti,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:Ui()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}})};var Ii=0;const Ui=()=>"field"+Ii++,Hi={createField(t,i,s){const{type:n}=i,r=Mi[n];if((0,e.isNullOrUndefined)(r))throw new Error(`Missing handler: The '${n}' field could not be handled`);var a=r(t,i,s);if((0,e.isNullOrUndefined)(a))throw new Error(`Bad request: The '${n}' field could not be created`);return a.errors=[],a.readonly=(0,e.valOrDefault)(i.readonly,!1),(0,e.isNullOrUndefined)(a.id)&&(a.id=Ui()),a}},Di={init(){throw new Error("This function has not been implemented")},element:null,children:null,statusElement:null,attached:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasAttached(){return!(0,e.isEmpty)(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(t){return(0,e.isFunction)(t)?this.attached.filter((e=>t(e))):this.attached},show(){return(0,t.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,t.Cp)(this.element),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},focus(){return this.element.focus(),this.focused=!0,this.active=!0,this},_focusIn:e=>!1,navigate(e,t,i){return this.focusable?(this.element.focus(),!0):this.parent.arrowHandler(e,this.element)},clear:()=>!0,delete(){this.environment.notify("This element cannot be removed",t.k$.WARNING,1500),(0,t.lL)(this.element)},spaceHandler(e){return this.arrowHandler("right",e)},_spaceHandler(e){return this.environment.notify("Nothing do here.",t.k$.NORMAL,1500),!1},escapeHandler(t){let i=(0,e.findAncestor)(t,(e=>0===e.tabIndex));return this.projection.resolveElement(i).focus(i),!0},enterHandler(e){this.element.click()},deleteHandler(e){return this.environment.notify("This element cannot be removed",t.k$.WARNING,1500),(0,t.lL)(this.element),!1},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,t)},clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler:e=>(console.warn("CONTROL NOT IMPLEMENTED"),!1)},Vi=Object.assign(Di),Bi={init(){return this.children=[],this},render(){const t=(0,e.createDocFragment)(),{help:i,style:s,content:n}=this.schema;return(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createAudio)({class:["static","audio-static"],src:n,dataset:{nature:"static",static:"audio",id:this.id,ignore:"all"}})),(0,e.isNullOrUndefined)(i)||(this.element.title=i),Je.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},bindEvents(){}},Pi=Object.assign(Object.create(Vi),Bi);function Ri(t,i){let s=t.param.find((e=>e.name===i));if((0,e.isNullOrUndefined)(s))return;const{type:n="string",value:r}=s;let a=(0,e.valOrDefault)(r,s.default);return(0,e.isNullOrUndefined)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}function _i(t){if((0,e.isNullOrUndefined)(t))return"";const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.valOrDefault)(this.source.getProperty(t.name),"")):"param"===i?Ri.call(this,this.schema.template,t.name):"raw"===i?(0,e.htmlToElement)(t.raw):t}function $i(t){return(0,e.isNullOrWhitespace)(t)?"":t.startsWith("http://")||t.startsWith("https://")?new URL(t).href:$i(`https://${t}`)}const Fi={url:null,alt:null,width:null,height:null,init(){const{url:e,width:t,height:i,alt:s}=this.schema;return this.width=t,this.height=i,this.alt=s,this},render(){let t=!1;const{help:i,style:s,url:n}=this.schema;return this.url=$i(_i.call(this,n)),(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createImage)({class:["static","image-static"],src:this.url,alt:this.alt,dataset:{nature:"static",static:"image",id:this.id,ignore:"all"}}),t=!0),(0,e.isNullOrUndefined)(this.width)||isNaN(this.width)||(this.element.width=this.width),(0,e.isNullOrUndefined)(this.height)||isNaN(this.height)||(this.element.height=this.height),(0,e.isNullOrUndefined)(i)||(this.element.title=i),Je.call(this.projection,this.element,s),t&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return(0,e.isNullOrWhitespace)(this.url)?this.element.classList.add("empty"):this.element.classList.remove("empty"),this},update(){const{url:e}=this.schema;return this.url=$i(_i.call(this,e)),this.element.src=this.url,this.refresh(),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},zi=Object.assign(Object.create(Vi),Fi),Wi={email:e=>`mailto:${e}`,phone:e=>`tel:${e}`,link:e=>`${e}`,url:e=>`${e}`};function qi(t,i){let s=t.param.find((e=>e.name===i));if((0,e.isNullOrUndefined)(s))return;const{type:n="string",value:r}=s;let a=(0,e.valOrDefault)(r,s.default);return(0,e.isNullOrUndefined)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}function Xi(t){if((0,e.isNullOrUndefined)(t))return"";const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.valOrDefault)(this.source.getProperty(t.name),"")):"param"===i?qi.call(this,this.schema.template,t.name):"raw"===i?(0,e.htmlToElement)(t.raw):t}const Yi={url:null,urlType:null,href:null,hrefHandler:null,content:null,init(){const{content:t=[],urlType:i="link"}=this.schema;if(this.content=t,this.urlType=i,this.children=[],this.hrefHandler=Wi[this.urlType],!(0,e.isFunction)(this.hrefHandler))throw new TypeError("type not handled");return this},render(){let t=!1;const i=(0,e.createDocFragment)(),{help:s,style:n,url:r}=this.schema;return this.href=this.hrefHandler(Xi.call(this,r)),(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createAnchor)({class:["static","link"],href:this.href,dataset:{nature:"static",static:"link",id:this.id,ignore:"all"}}),"link"===this.urlType&&(this.element.target="_blank"),t=!0),this.content.forEach((e=>{let t=Yn.call(this,e,this.projection.concept,{focusable:!1});i.append(t)})),(0,e.isNullOrUndefined)(s)||(this.element.title=s),Je.call(this.projection,this.element,n),i.hasChildNodes()&&this.element.append(i),t&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},update(){const{url:t}=this.schema;return this.element.href=this.hrefHandler(Xi.call(this,t)),(0,e.removeChildren)(this.element),this.content.forEach((e=>{this.element.append(Yn.call(this,e,this.projection.concept,{focusable:!1}))})),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},Zi=Object.assign(Object.create(Vi),Yi);function Gi(t,i){let s=t.param.find((e=>e.name===i));if((0,e.isNullOrUndefined)(s))return;const{type:n="string",value:r}=s;let a=(0,e.valOrDefault)(r,s.default);return(0,e.isNullOrUndefined)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}function Ji(t){if((0,e.isNullOrUndefined)(t))return"";const{type:i}=t;return"property"===i?(this.hasProperty=!0,(0,e.valOrDefault)(this.source.getProperty(t.name),"")):"param"===i?Gi.call(this,this.schema.template,t.name):"html"===i?(0,e.htmlToElement)(t.html):"raw"===i?(0,e.htmlToElement)(t.raw):t}const Ki={editable:null,focusable:null,hasProperty:!1,asHTML:!1,init(e={}){Object.assign(this.schema,e);const{content:t,editable:i=!1,focusable:s=!1}=this.schema;return this.children=[],this._content=t,this.editable=i,this.focusable=s,this},render(){let t=!1;const{content:i,help:s,style:n}=this.schema;if(!(0,e.isHTMLElement)(this.element)){if(this.element=(0,e.createSpan)({class:["text","static","text-static"],editable:this.editable,dataset:{nature:"static",view:"text",static:"text",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0),Array.isArray(i))i.forEach((t=>{let i=Ji.call(this,t),s=(0,e.createSpan)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",content:i,id:this.id,ignore:"all"}},i);Je.call(this.projection,s,t.style),this.element.append(s)}));else{let e=Ji.call(this,i);this.element.append(e),this.element.content=e}t=!0}return(0,e.isNullOrUndefined)(s)||(this.element.title=s),Je.call(this.projection,this.element,n),t&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},getLength(){return this.element.textContent.length},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,i){if(!this.editable&&this.parent)return this.parent.arrowHandler(e,i);if("right"===e){if(this.getLength()<(0,t.qO)(this.element)+1&&this.parent)return this.parent.arrowHandler(e,i)}else if("left"===e){if(0===(0,t.qO)(this.element)&&this.parent)return this.parent.arrowHandler(e,i)}else if(this.parent)return this.parent.arrowHandler(e,i);return!1},escapeHandler(t){let i=(0,e.findAncestor)(t,(e=>0===e.tabIndex));this.projection.resolveElement(i).focus(i)},update(){const{content:t}=this.schema;return(0,e.removeChildren)(this.element),Array.isArray(t)?t.forEach((t=>{this.element.append((0,e.createSpan)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",id:this.id,ignore:"all"}},Ji.call(this,t)))})):this.element.append(Ji.call(this,t)),this},refresh(){return this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},Qi=Object.assign(Object.create(Vi),Ki),es={contentType:null,editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.children=[],this.focusable=t,this},render(){const t=(0,e.createDocFragment)(),{help:i,style:s,content:n}=this.schema;return(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createButton)({class:["btn","static"],dataset:{nature:"static",view:"plink",static:"plink",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),n.forEach((e=>{let i=Yn.call(this,e,this.projection.concept,{focusable:!1});t.append(i)})),(0,e.isNullOrUndefined)(i)||(this.element.title=i),Je.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(t){let i=(0,e.findAncestor)(t,(e=>0===e.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){let t=this.projection.findView(this.schema.tag);return-1===t||this.projection.changeView(t),!1},refresh(){return this},bindEvents(){}},ts=Object.assign(Object.create(Vi),es),is={template:null,selector:null,content:null,init(){return this.selector=this.schema.selector,this.template=(0,e.getTemplate)(this.selector),this},render(){const{style:t,content:i}=this.schema;return(0,e.isNode)(this.element)||(this.element=(0,e.cloneTemplate)(this.template)),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},ss=Object.assign(Object.create(Vi),is);function ns(t,i){let s=t.param.find((e=>e.name===i));if((0,e.isNullOrUndefined)(s))return;const{type:n="string",value:r}=s;let a=(0,e.valOrDefault)(r,s.default);return(0,e.isNullOrUndefined)(a)?null:"string"===n?a.toString():"number"===n?+a:void 0}const rs={contentType:null,editable:null,focusable:null,disabled:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0,disabled:i=!1}=this.schema;return this.children=[],this.focusable=t,this.disabled=i,this},render(){const t=(0,e.createDocFragment)(),{help:i,style:s,content:n}=this.schema;return(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createButton)({class:["btn","static"],dataset:{nature:"static",view:"button",static:"button",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),n.forEach((e=>{let i=Yn.call(this,e,this.projection.concept,{template:this.schema.template,focusable:!1});t.append(i)})),(0,e.isNullOrUndefined)(i)||(this.element.title=i),Je.call(this.projection,this.element,s),t.hasChildNodes()&&(this.element.append(t),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(t){let i=(0,e.findAncestor)(t,(e=>0===e.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(t){let i=this.source;if(this.schema.bind&&(i=this.source.getValue(!0)),this.schema.action){const{type:t,value:s,target:n}=this.schema.action;switch(t){case"CREATE":if((0,e.isNullOrUndefined)(n)&&i.createElement(),(0,e.isObject)(s))for(const e in s){const t=s[e];"param"===t.type&&(s[e]=ns.call(this,this.schema.template,t.name))}"attribute"===n.type&&i.getAttribute(n.name).target.createElement({value:s});break;case"SELECT":if((0,e.isNullOrUndefined)(n)&&i.createElement(),(0,e.isObject)(s))for(const e in s){const t=s[e];"param"===t.type&&(s[e]=ns.call(this,this.schema.template,t.name))}"attribute"===n.type&&i.getAttribute(n.name).target.setValue((0,e.valOrDefault)(s.name,s)),"bind"===n.type&&i.setValue((0,e.valOrDefault)(s.name,s));break;case"CREATES":if((0,e.isNullOrUndefined)(n)&&i.createElement(),(0,e.isObject)(s))for(const e in s){const t=s[e];"param"===t.type&&(s[e]=ns.call(this,this.schema.template,t.name))}"attribute"===n.type&&i.getAttribute(n.name).target.createElement().getAttribute(n.attribute).target.setValue((0,e.valOrDefault)(s.name,s));break;case"SIDE":let t=this.environment.createProjection(i,n),r=this.environment.findWindow("side-instance");(0,e.isNullOrUndefined)(r)&&(r=this.environment.createWindow("side-instance"),r.container.classList.add("model-projection-sideview")),r.instances.size>0&&Array.from(r.instances)[0].delete();let a=this.environment.createInstance(i,t,{type:"projection",close:"DELETE-PROJECTION"});r.addInstance(a)}return"attribute"===n.type&&(console.log(s),i.getAttribute(n.name).target.createElement({value:s})),!1}return this.environment.triggerEvent({name:this.schema.trigger,args:[i]}),!1},refresh(){return this},bindEvents(){}},as=Object.assign(Object.create(Vi),rs),ls={editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.focusable=t,this},render(){(0,e.createDocFragment)();const{help:t,style:i,content:s,external:n=!0,tag:r}=this.schema,a=new DOMParser;return(0,e.isHTMLElement)(this.element)||(this.element=a.parseFromString(s.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.element.classList.add(["btn","static"]),this.element.dataset.nature="static",this.element.dataset.view="svg-alt",this.element.dataset.id=this.id,this.element.dataset.ignore="all",this.focusable&&(this.element.tabIndex=0)),(0,e.isNullOrUndefined)(t)||(this.element.title=t),this.refresh(),this.bindEvents(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,t.Cp)(this.messageElement),(0,e.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(t){let i=(0,e.findAncestor)(t,(e=>0===e.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){},refresh(){return this},bindEvents(){this.element.addEventListener("click",(()=>{let t=this.source,i=this.environment.createProjection(t,this.schema.tag),s=this.environment.findWindow("side-instance");(0,e.isNullOrUndefined)(s)&&(s=this.environment.createWindow("side-instance"),s.container.classList.add("model-projection-sideview")),s.instances.size>0&&Array.from(s.instances)[0].delete();let n=this.environment.createInstance(t,i,{type:"projection",close:"DELETE-PROJECTION"});s.addInstance(n)}))}},os=Object.assign(Object.create(Vi),ls),hs={CREATE:function(e,t){this.source.createElement(t)},DELETE:cs,EXTRACT:function(e,t){let i=this.projection.environment.actions.get("extract-instance")("graphical").getAttribute("shape").target.getAttribute("elements").target.createElement();i.setValue(this.source.name),ds.call(this,i.getValue(!0)),us.call(this,i.getValue(!0)),cs.call(this)},SIDE:function(t,i){let s=this.environment.createProjection(this.source,t),n=this.environment.findWindow("side-instance");(0,e.isNullOrUndefined)(n)&&(n=this.environment.createWindow("side-instance"),n.container.classList.add("model-projection-sideview")),n.instances.size>0&&Array.from(n.instances)[0].delete();let r=this.environment.createInstance(this.source,s,{type:"projection",close:"DELETE-PROJECTION"});n.addInstance(r)},OPEN:function(t){(0,e.isNullOrUndefined)(this.target)&&(this.target=t),this.target.open()}};function cs(e,t){"prototype"!==this.source.parent.schema.nature?this.source.delete():this.source.parent.delete()}function ds(e){switch(this.source.name){case"circle":e.getAttributeByName("cx").target.setValue(this.source.getAttributeByName("cx").target.value),e.getAttributeByName("cy").target.setValue(this.source.getAttributeByName("cy").target.value),e.getAttributeByName("r").target.setValue(this.source.getAttributeByName("r").target.value);break;case"ellipse":e.getAttributeByName("cx").target.setValue(this.source.getAttributeByName("cx").target.value),e.getAttributeByName("cy").target.setValue(this.source.getAttributeByName("cy").target.value),e.getAttributeByName("rx").target.setValue(this.source.getAttributeByName("rx").target.value),e.getAttributeByName("ry").target.setValue(this.source.getAttributeByName("ry").target.value);break;case"rectangle":e.getAttributeByName("x").target.setValue(this.source.getAttributeByName("x").target.value),e.getAttributeByName("y").target.setValue(this.source.getAttributeByName("y").target.value),e.getAttributeByName("width").target.setValue(this.source.getAttributeByName("width").target.value),e.getAttributeByName("height").target.setValue(this.source.getAttributeByName("height").target.value);break;case"polygon":e.getAttributeByName("points").target.setValue(this.source.getAttributeByName("points").target.value);break;case"path":e.getAttributeByName("d").target.setValue(this.source.getAttributeByName("d").target.value)}}function us(e){const t=e.getAttributeByName("style").target,i=this.source.getAttributeByName("style").target;t.getAttributeByName("fill").target.setValue(i.getAttributeByName("fill").target.value),t.getAttributeByName("stroke").target.setValue(i.getAttributeByName("stroke").target.value),t.getAttributeByName("s-width").target.setValue(i.getAttributeByName("s-width").target.value),t.getAttributeByName("s-dash").target.setValue(i.getAttributeByName("s-dash").target.value),t.getAttributeByName("rx").target.setValue(i.getAttributeByName("rx").target.value),t.getAttributeByName("ry").target.setValue(i.getAttributeByName("ry").target.value)}const ms={init(){return this},render(){const{action:t,content:i}=this.schema;if((0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="static",this.container.dataset.algorithm="button",this.container.dataset.id=this.id),i&&(0,e.isNullOrUndefined)(this.content)&&this.createContent(i),this.schema.dimensions){const{width:e,height:t}=this.schema.dimensions;this.container.setAttribute("width",e),this.container.setAttribute("height",t)}return this.container.style.width="fit-content",this.container},createContent(e){const t=new DOMParser;this.content=t.parseFromString(e.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.content),this.content.addEventListener("click",(()=>{const{type:e,target:t,value:i}=this.schema.action;console.log("target"),console.log(t),console.log(this.schema.action),hs[e].call(this,t,i)}))},focusIn(){},focusOut(){}},ps=Object.assign({},Vi,ms),fs={init(){return this},render(){const t=new DOMParser,{content:i}=this.schema;return(0,e.isNullOrUndefined)(this.element)&&(this.element=t.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.element},focusIn(){},focusOut(){},clickHandler(e){}},gs=Object.assign(Object.create(Vi),fs),vs={init(){return this},render(){new DOMParser;const{content:t,style:i}=this.schema;return(0,e.isNullOrUndefined)(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","text"),this.element.textContent=t),this.style(),this.element},style(){const{font:e,size:t,anchor:i="left",weight:s,baseline:n}=this.schema.style;this.element.setAttribute("text-anchor",i),this.element.setAttribute("font-family",e),this.element.setAttribute("font-size",t),this.element.style["dominant-baseline"]=n,s&&this.element.setAttribute("font-weight",s)},focusIn(){},focusOut(){},clickHandler(e){}},bs=Object.assign(Object.create(Vi),vs);var ys=0;const ws=()=>"static"+ys++,xs={audio:(e,t,i)=>Object.create(Pi,{object:{value:"static"},name:{value:"audio-static"},type:{value:"audio"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),plink:(e,t,i)=>Object.create(ts,{object:{value:"static"},name:{value:"plink-static"},type:{value:"plink"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),image:(e,t,i)=>Object.create(zi,{object:{value:"static"},name:{value:"image-static"},type:{value:"image"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),link:(e,t,i)=>Object.create(Zi,{object:{value:"field"},name:{value:"link-static"},type:{value:"link"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),text:(e,t,i)=>Object.create(Qi,{object:{value:"static"},name:{value:"text-static"},type:{value:"text"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),html:(e,t,i)=>Object.create(ss,{object:{value:"static"},name:{value:"html-static"},type:{value:"html"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),button:(e,t,i)=>Object.create(as,{object:{value:"static"},name:{value:"button-static"},type:{value:"button"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),"svg-alt":(e,t,i)=>Object.create(os,{object:{value:"static"},name:{value:"svg-static"},type:{value:"svgAlt"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),"svg-button":(e,t,i)=>Object.create(ps,{object:{value:"static"},name:{value:"svg-button"},type:{value:"svgButton"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),svg:(e,t,i)=>Object.create(gs,{object:{value:"static"},name:{value:"svg-static"},type:{value:"svg"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}}),"svg-text":(e,t,i)=>Object.create(bs,{object:{value:"static"},name:{value:"svgText-static"},type:{value:"svgText"},id:{value:ws()},model:{value:e},schema:{value:t},projection:{value:i}})},Es={createStatic(t,i,s){const{type:n}=i,r=xs[n];if((0,e.isNullOrUndefined)(r))throw new Error(`Missing handler: The '${n}' static could not be handled`);var a=r(t,i,s);if((0,e.isNullOrUndefined)(a))throw new Error(`Bad request: The '${n}' static could not be created`);return(0,e.isNullOrUndefined)(a.id)&&(a.id=ws()),a}},As={focusable:null,readonly:!1,visible:!1,editable:!1,active:!1,container:null,elements:null,children:null,editing:!1,getStyle(){return this.schema.style},setStyle(e){return this.schema.style=e,Je.call(this.projection,this.container,e),this.refresh(),!0},getContainer(){return this.container},isRoot(){return(0,e.isNullOrUndefined)(this.parent)},getField(e){return this.projection.getField(e)},getStatic(e){return this.projection.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},show(){return(0,t.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,t.Cp)(this.element),this.visible=!1,this},toggle(){return(0,t.ZN)(this.container),this.visible=!this.visible,this},_focusIn:e=>!1,spaceHandler(t){return t===this.container&&!(0,e.isNullOrUndefined)(this.parent)&&this.parent.spaceHandler(this.container)},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(t){if(this.isRoot())return!1;let i=(0,e.findAncestor)(t,(e=>0===e.tabIndex)),s=this.environment.resolveElement(i);return!(0,e.isNullOrUndefined)(s)&&(s.focus(i),!0)},enterHandler(t){let i=(0,e.getElement)('[tabindex]:not([tabindex="-1"])',this.container),s=this.environment.resolveElement(i);return!(0,e.isNullOrUndefined)(s)&&(s.focus(),!0)},delete(){var e=this.source.delete();e.success||this.environment.notify(e.message)},deleteHandler(i){if(this.projection.element!==this)return!1;if(!this.projection.optional)return(0,t.lL)(this.container),!1;let s=(0,e.findAncestor)(i,(e=>0===e.tabIndex)),n=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),n),this.source.delete();let r=this.environment.resolveElement(s);return(0,e.isNullOrUndefined)(r)||r.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(i,s){if(s===this.container)return!(0,e.isNullOrUndefined)(this.parent)&&this.parent.arrowHandler(i,this.container);let n=(0,t.As)(s,i,this.container);if(!(0,e.isHTMLElement)(n))return!(0,e.isNullOrUndefined)(this.parent)&&"layout"===this.parent.object&&this.parent.arrowHandler(i,this.container);let r=this.environment.resolveElement(n);return r&&((0,e.isFunction)(r.navigate)?r.navigate(i):r.focus()),!0},shiftHandler(e,i){if("up"===e){let e=(0,t.a2)(window.getComputedStyle(this.container).marginTop);this.container.style.marginTop=`${e+1}px`}return!0},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()}},Os={ROW:"row",COLUMN:"column"},Ns={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},js={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"};var Cs=0;function Ls(e,t,i){return Object.create(ks,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:"layout"+Cs++},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})}const Ss={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema,{orientation:s=Os.ROW,wrappable:n=!0,alignItems:r,justifyContent:a}=this.schema.layout;return this.orientation=s,this.wrappable=n,this.alignItems=r,this.justifyContent=a,this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(t){(0,e.hasOwn)(Os,t)&&(this.orientation=t,this.refresh())},collapse(t=!1){if(!this.collapsed||t)return this.collapseContainer=(0,e.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(t=!1){if(!this.collapsed&&!t)return;let i=(0,e.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{label:t,content:i,style:s,help:n}=this.schema,r=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),n&&(this.container.title=n);for(let e=0;e<i.length;e++){let t=Yn.call(this,i[e],null,this.args),s=this.environment.resolveElement(t);s&&(s.parent=this),this.elements.push(t),r.append(t)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Je.call(this.projection,this.container,s),r.hasChildNodes()&&(this.container.append(r),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=js[this.justifyContent],this.container.style.alignItems=Ns[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.isNullOrUndefined)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},ks=Object.assign({},As,Ss),Ts={clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},getContainer(){return this.container},getWidth(){return this.width},getHeight(){return this.height},setViewBox(e){this.container.setAttribute("viewBox",e),this.notifyObsevers()},setWidth(e){this.width=e,this.container.setAttribute("width",e),this.notifyObsevers()},setWidth(e){this.height=e,this.container.setAttribute("height",e),this.notifyObsevers()},notifyDimObservers(){(0,e.isNullOrUndefined)(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))},registerDimensionsObserver(t){(0,e.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(t)},setInteraction(t){(0,e.isNullOrUndefined)(this.items)||((0,e.isNullOrUndefined)(this.warnings)&&(this.warnings=[]),this.warnings.push(t),this.items.forEach((e=>{this.projection.resolveElement(e.render).warn(t)})))},checkAugment(t,i){if(!(0,e.isNullOrUndefined)(this.background))if(t.x+Number(i.getAttribute("x"))>Number(this.background.getAttribute("x"))+Number(this.background.getAttribute("width"))||t.y+Number(i.getAttribute("y"))>Number(this.background.getAttribute("y"))+Number(this.background.getAttribute("height"))){let e=this.background.querySelector("[data-augment]");const s=Number(e.getAttribute("y")),n=t.y+Number(i.getAttribute("y"));e.setAttribute("height",n-s)}else if(t.y+Number(i.getAttribute("y"))<Number(this.background.getAttribute("y"))+Number(this.background.getAttribute("height"))){let e=this.background.querySelector("[data-augment]");const s=Number(e.getAttribute("y")),n=t.y+Number(i.getAttribute("y"));e.setAttribute("height",n-s)}},createDelete(){const{type:t}=this.schema.rmv;switch(t){case"bind":this.deleteMap=new Map;let t=0;this.schema.rmv.bind.forEach((e=>{t++;const{alias:i,focus:s,coordinates:n,content:r}=e;let a=(new DOMParser).parseFromString(r.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement;a.dataset.nature="static",a.dataset.algorithm="button",a.setAttribute("x",n.x),a.setAttribute("y",n.y),a.addEventListener("click",(()=>{this.source.delete()})),this.deleteMap.set(i,a)})),this.projection.registerHandler("value.changed",(t=>{(0,e.isNullOrUndefined)(this.deleteElem)||this.deleteElem.remove(),this.deleteMap.get("default").remove();const i=t.name||t;let s=this.deleteMap.get(i);if(!s.dataset.focusable||this.focused)return(0,e.isNullOrUndefined)(s)?(this.container.append(this.deleteMap.get("default")),void(this.deleteElem=this.deleteMap.get("default"))):(this.container.append(s),void(this.deleteElem=s));this.deleteElem=s})),this.source.hasValue()?(this.container.append(this.deleteMap.get(this.source.value)),this.deleteElem=this.deleteMap.get(this.source.value)):(this.container.append(this.deleteMap.get("default")),this.deleteElem=this.deleteMap.get("default"));break;default:const{focus:i,coordinates:s,dimensions:n,render:r}=this.schema.rmv;let a=Yn.call(this,r);a.setAttribute("x",s.x),a.setAttribute("y",s.y),this.container.append(a),a.addEventListener("click",(()=>{this.source.delete()})),i&&(this.rmv=a)}},findItem(e){for(let t=0;t<this.items.length;t++)if(this.items[t].render.dataset.concept===e)return this.items[t]},findAncestor(e){for(let t=0;t<this.items.length;t++)if(this.items[t].render.contains(e))return this.items[t]},findAnchorIndex(e){for(let t=0;t<this.items.length;t++)if(this.items[t].render===e)return this.items[t].index},findAnchorIndex(e){return this.anchors.indexes[e]}},Ms={init(){const{dimensions:t={}}=this.schema;return this.ratio=.4,this.width=(0,e.valOrDefault)(t.width,500),this.height=(0,e.valOrDefault)(t.height,500),this.buttons=[],this.dummies=[],this.transLink=[],this.transLinkId=[],this.arrowInventory=[],this.linkInventory=new Map,this},render(){const{dimensions:t,style:i}=this.schema,s=(0,e.createDocFragment)();return(0,e.isNullOrUndefined)(this.instances)&&(this.instances=new Map),(0,e.isNullOrUndefined)(this.holders)&&(this.holders=new Map),(0,e.isHTMLElement)(this.container)||(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="force",this.container.dataset.id=this.id,this.container.tabindex=1,this.container.id=this.id),t&&(this.container.setAttribute("width",t.width),this.container.setAttribute("height",t.height)),this.focusable=!0,(0,e.isHTMLElement)(this.ids)||(this.ids=[]),s.hasChildNodes()&&this.container.append(s),i&&(this.container.style=i),(0,e.isNullOrUndefined)(this.content)&&(this.content=[]),this.bindEvents(),this.container},setUpForce(){const{intensity:e,linkval:t}=this.schema.force;this.force=d3.layout.force().size([this.width,this.height]).nodes([]).links([]).linkDistance(t).charge(e).on("tick",this.ticked.bind(this));var i=d3.select("#"+this.id);this.nodes=this.force.nodes(),this.node=i.selectAll("svg"),this.links=this.force.links(),this.link=i.selectAll(".link"+this.id),this.force.start()},restart(){let t=d3.select("#"+this.id);this.node=t.selectAll(".node"+this.id).data(this.nodes),(0,e.isNullOrUndefined)(this.links)||(this.link=t.selectAll(".link"+this.id).data(this.links)),this.force.start()},addItem(t){(0,e.isNullOrUndefined)(this.force)&&this.setUpForce(this.width,this.height,this.intensity,this.direction),"prototype"===t.schema.nature&&(t.register(this.projection),this.projection.registerHandler("value.changed",(e=>{if(t.hasValue())for(let e=0;e<this.nodes.length;e++)this.nodes[e].concept===t.id&&(this.nodes[e].meta=this.nodes[e].concept,this.nodes[e].concept=t.getValue(!0).id)})));let i=this.createItem(t,this.schema.tag);i.classList.add("node"+this.id),this.container.append(i);let s=this.projection.resolveElement(i);if(s.projection.update("displayed"),s.registerDimensionsObserver(this),this.content.push(s),"prototype"===t.schema.nature)if(t.force)t.force.index=this.nodes.length,t.force.id=s.id,this.nodes.push(t.force),t.force=this.nodes[this.nodes.length-1];else{const e={nbLink:0,points:[],width:s.width,height:s.height,id:s.id,concept:t.id};this.nodes.push(e),t.force=e}else if(t.force)t.force.index=this.nodes.length,t.force.id=s.id,this.nodes.push(t.force),t.force=this.nodes[this.nodes.length-1];else{const e={nbLink:0,points:[],width:s.width,height:s.height,id:s.id,concept:t.id,shape:this.computeShape(i)};this.nodes.push(e),t.force=e}i.getBoundingClientRect(),this.restart()},checkForContent(e,t){const i=this.findIndex(e),s=this.findIndex(t);return i>=0&&s>=0},addArrow(t,i,s){if((0,e.isNullOrUndefined)(this.force)&&this.setUpForce(),(0,e.isNullOrUndefined)(this.links)&&(this.links=this.force.links()),this.containsArrow(t,i,s))return;this.containsTransArrow(t,i,s),this.force.stop();const n=i.id||i,r=s.id||s,a=this.findIndex(n),l=this.findIndex(r);if(a<0||l<0){let e=this.environment.getReceivers(this.projection.rtag);for(let n=0;n<e.length;n++)if(e[n].checkForContent(i,s))return t.projection.parent=e[n],void e[n].addArrow(t,i,s);return this.environment.getRootReceiver(this.projection.rtag).addTransLink(t,i,s),void this.restart()}let o=this.linkInventory.get(a+","+l);(0,e.isNullOrUndefined)(o)?(this.linkInventory.set(a+","+l,{length:1}),this.links.push({source:a,target:l,id:t.id,indexL:1})):(o.length++,this.links.push({source:a,target:l,id:t.id,indexL:o.length})),t.path.classList.add("link"+this.id),this.container.append(t.path),t.definitions&&this.container.append(t.definitions),this.addDummy(t,t.decorator,this.links.length-1),this.restart()},addDummy(t,i=!1,s){if((0,e.isNullOrUndefined)(i)){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("node"+this.id),e.classList.add("dummy"),this.container.append(e)}else this.container.append(i),i.classList.add("node"+this.id),i.classList.add("dummy");const n=i.getBBox();this.nodes.push({dummy:!0,ref:s,fixed:!0,width:n.width,height:n.height})},addTransLink(t,i,s){t.projection.parent=this,(0,e.isNullOrUndefined)(this.transLinks)&&(this.transLinks=[]),this.transLinks.push({id:t.id,from:i.id||i,to:s.id||s,arrow:t}),this.container.append(t.path),t.definitions&&this.container.append(t.definitions),this.restart()},containsTransArrow(t,i,s){if(!(0,e.isNullOrUndefined)(this.transLinks))for(let e=0;e<this.transLinks.length;e++)if(this.transLinks[e].id===t.id)return void this.transLinks.splice(e,1)},containsArrow(t,i,s){for(let n=0;n<this.links.length;n++)if(this.links[n].id===t.id){const r=i.id||i,a=s.id||s,l=this.findIndex(r),o=this.findIndex(a);if(l<0||o<0)this.removeArrow(t,n),this.addTransLink(t,i,s);else{let t=this.links[n].source.index,i=this.links[n].target.index;if(!(0,e.isNullOrUndefined)(this.linkInventory.get(t+","+i))){let e=this.linkInventory.get(t+","+i);e.length--,e.length<=0&&this.linkInventory.delete(t+","+i)}this.links[n].source=l,this.links[n].target=o,(0,e.isNullOrUndefined)(this.linkInventory.get(l+","+o))?this.linkInventory.set(l+","+o,{length:1}):this.linkInventory.get(l+","+o).length++}return this.restart(),!0}return!1},removeArrow(t,i=-1,s,n){if((0,e.isNullOrUndefined)(this.links))return;let r=0;if(i>=0){if(!(0,e.isNullOrUndefined)(this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index))){let e=this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index);e.length--,0===e.length&&this.linkInventory.delete(this.links[i].source.index+","+this.links[i].target.index)}return this.links.splice(i,1),t.decorator&&(r=this.removeDummy(i),t.decorator.remove()),t.path.remove(),this.restart(),r}for(let i=0;i<this.links.length;i++)if(this.links[i].id===t.id){if(!(0,e.isNullOrUndefined)(this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index))){let e=this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index);e.length--,0===e.length&&this.linkInventory.delete(this.links[i].source.index+","+this.links[i].target.index)}return t.decorator&&(r=this.removeDummy(i),t.decorator.remove()),this.links.splice(i,1),t.path.remove(),void this.restart()}},findIndex(e){for(let t=0;t<this.nodes.length;t++)if(this.nodes[t].concept===e)return t;return-1},createItem(e,t){t.item;const i=this.schema.item;let s=this.model.createProjection(e,i);s.optional=!0,s.parent=this.projection;let n=s.init().render();return this.instances.set(s.element.source.id,n),n},removeItem(t){let i;for(this.force.stop(),i=0;i<this.nodes.length&&this.nodes[i].meta!==t.id&&this.nodes[i].concept!==t.id;i++);if((0,e.isNullOrUndefined)(this.links)||(0,e.isEmpty)(this.links))return this.nodes.splice(i,1),void this.restart();for(let t=0;t<this.links.length;t++){let s;if(this.links[t].source.index===i||this.links[t].target.index===i){let e=this.projection.model.getArrow(this.links[t].id);s=this.removeArrow(e,t,null,i),t--}(0,e.isNullOrUndefined)(this.links[t])||(this.links[t].source.index>i&&this.links[t].source.index--,this.links[t].target.index>i&&this.links[t].target.index--)}this.nodes.splice(i,1),this.restart()},removeDummy(e){for(let t=0;t<this.nodes.length;t++)this.nodes[t].ref===e&&(this.nodes.splice(t,1),t--),this.nodes[t].ref>e&&this.nodes[t].ref--},ticked(){let t=!0;for(;t&&!(0,e.isEmpty)(this.nodes);)this.nodes.forEach((e=>{this.nodes.forEach((i=>{t=this.collide(e,i)}))}));let i=this.links,s=this.container,n=this.linkInventory;const r=this.width,a=this.height;(0,e.isNullOrUndefined)(this.link)||this.link.attr("d",(function(e){if(e.source===e.target)return;const t=Is.computeBorder(e.source,e.target),i=Is.computeBorder(e.target,e.source);let s=i.x-t.x,r=i.y-t.y,a=Math.sqrt(s*s+r*r);e.dr=a,e.s=t,e.t=i;let l=n.get(e.source.index+","+e.target.index);return l.length>1&&(a/=1+1/l.length*(e.indexL-1)),"M"+i.x+","+i.y+"A"+a+","+a+" 0 0 1,"+t.x+","+t.y+"A"+a+","+a+" 0 0 0,"+i.x+","+i.y})),(0,e.isNullOrUndefined)(this.transLinks)||this.transLinks.forEach((t=>{const{arrow:i,id:n,from:r,to:a}=t,l=this.container.getBoundingClientRect();let o=this.container.querySelector("[data-concept='"+r+"']");(0,e.isNullOrUndefined)(o)&&(o=document.querySelector("[data-concept='"+r+"']"));let h=this.container.querySelector("[data-concept='"+a+"']");(0,e.isNullOrUndefined)(h)&&(h=document.querySelector("[data-concept='"+a+"']"));const c=o.getBoundingClientRect(),d=h.getBoundingClientRect(),u={x:c.x+c.width/2-l.x,y:c.y+c.height/2-l.y},m={x:d.x+d.width/2-l.x,y:d.y+d.height/2-l.y};u.shape=this.computeRelativeShape(s,o),m.shape=this.computeRelativeShape(s,h);const p=Is.computeBorder(u,m),f=Is.computeBorder(m,u),g=f.x-p.x,v=f.y-p.y,b=Math.sqrt(g*g+v*v);i.setPath("M"+f.x+","+f.y+"A"+b+","+b+" 0 0 1,"+p.x+","+p.y+"A"+b+","+b+" 0 0 0,"+f.x+","+f.y)})),this.node.attr("x",(function(t){if(!(0,e.isNullOrUndefined)(t.ref)){let r=i[t.ref].dr,a=n.get(i[t.ref].source.index+","+i[t.ref].target.index);a.length>1&&(r/=1+1/a.length*(i[t.ref].indexL-1));let l=Is.getEllipseCenter(r,i[t.ref].s,i[t.ref].t,s),o=Is.getPerpendicularLine(i[t.ref].s,i[t.ref].t),h=Is.getPointConstructedEllipse(o,r,r,l),c=Is.getCloserBorder(h,i[t.ref].t);return t.fx=c.x,(0,e.isNullOrUndefined)(t.width)?c.x:(t.fx=c.x-t.width/2,c.x-t.width/2)}return(t.x=Math.max(t.width/2,Math.min(r-t.width/2,t.x)))-t.width/2})).attr("y",(function(t){if(!(0,e.isNullOrUndefined)(t.ref)){let r=i[t.ref].dr,a=n.get(i[t.ref].source.index+","+i[t.ref].target.index);a.length>1&&(r/=1+1/a.length*(i[t.ref].indexL-1));let l=Is.getEllipseCenter(r,i[t.ref].s,i[t.ref].t,s),o=Is.getPerpendicularLine(i[t.ref].s,i[t.ref].t),h=Is.getPointConstructedEllipse(o,r,r,l),c=Is.getCloserBorder(h,i[t.ref].t);return t.fy=c.y,(0,e.isNullOrUndefined)(t.height)?c.y:c.y-t.height/2}return(t.y=Math.max(t.height/2,Math.min(a-t.height/2,t.y)))-t.height/2}))},analyseContentDim(){this.content.forEach((e=>{for(let t=0;t<this.nodes.length;t++)if(this.nodes[t].id===e.id){this.nodes[t].width=e.width,this.nodes[t].height=e.height,this.nodes[t].shape=this.computeShape(e.container||e.element);break}})),this.force.start()},computeRelativeShape(t,i){const s=i.querySelector("[data-shape]");if((0,e.isUndefined)(s))return;const n=t.getBoundingClientRect(),r=s.getBoundingClientRect(),a=i.getBoundingClientRect(),l=Number(t.getAttribute("width")),o=Number(t.getAttribute("height")),h={};h.width=l*r.width/n.width,h.height=o*r.height/n.height;const c=t.createSVGPoint();c.x=r.x,c.y=r.y;const d=c.matrixTransform(t.getScreenCTM().inverse());h.x=d.x,h.y=d.y;const u={};u.width=l*a.width/n.width,u.height=o*a.height/n.height;const m=t.createSVGPoint();m.x=r.x,m.y=r.y;const p=m.matrixTransform(t.getScreenCTM().inverse());let f;switch(u.x=p.x,u.y=p.y,s.tagName){case"circle":return{type:"circle",r:h.width/2};case"ellipse":return f=Number(s.getAttribute("width"))/r.width,a.width,f=Number(s.getAttribute("height"))/r.height,a.height,{type:"ellipse",rx:h.width/2,ry:h.height/2};default:f=Number(s.getAttribute("width"))/r.width;const e=a.width*f;return f=Number(s.getAttribute("height"))/r.height,{type:"rect",w:e,h:a.height*f}}},computeShape(t){const i=t.querySelector("[data-shape]");if((0,e.isNullOrUndefined)(i))return;const s=i.getBoundingClientRect(),n=t.getBoundingClientRect();let r;switch(i.tagName){case"circle":return r=Number(i.getAttribute("r"))/(s.width/2),{type:"circle",r:n.width*r/2};case"ellipse":r=Number(i.getAttribute("width"))/s.width;const e=n.width*r;return r=Number(i.getAttribute("height"))/s.height,{type:"ellipse",rx:e,ry:n.height*r};case"polygon":let t=i.getAttribute("data-points").split(" "),a=[];for(let e=0;e<t.length;e++)a.push({x:Number(t[e].split(",")[0])/s.width,y:Number(t[e].split(",")[1])/s.height});return{type:"polygon",points:a};default:r=Number(i.getAttribute("width"))/s.width;const l=n.width*r;return r=Number(i.getAttribute("height"))/s.height,{type:"rect",w:l,h:n.height*r}}},collide(t,i){let s=!1;const n=this.width,r=this.height;if(!(0,e.isNullOrUndefined)(t.ref)&&!(0,e.isNullOrUndefined)(i.ref))return s;if(!(0,e.isNullOrUndefined)(t.ref)){if(t.fx<i.x&&t.fy<i.y&&t.fx+t.width/2>i.x-i.width/2&&t.fy+t.height>i.x-i.height/2){let e=t.fx+t.width/2-(i.x-i.width/2),s=1.1*(t.fy+t.height/2-(i.y-i.height/2));switch(Math.min(e,s)){case e:i.x+=e;break;case s:i.y+=s}}else if(t.fx>i.x&&t.fy<i.y&&i.x+i.width/2>t.fx-t.width/2&&t.fy+t.height/2>i.y-i.height/2){let e=i.x+i.width/2-(t.fx-t.width/2),s=1.1*(t.fy+t.height/2-(i.y-i.height/2));switch(Math.min(e,s)){case e:i.x-=e;break;case s:i.y+=s}}else if(t.fx>i.x&&t.fy>i.y&&i.x+i.width/2>t.fx-t.width/2&&i.y+i.height/2>t.fy-t.height){let e=i.x+i.width/2-(t.fx-t.width/2),s=1.1*(i.y+i.height/2-(t.fy-t.height/2));switch(Math.min(e,s)){case e:i.x-=e;break;case s:i.y-=s}}else if(t.fx<i.x&&t.fy>i.y&&t.fx+t.width/2>i.x-i.width/2&&t.fy-t.height<i.y+i.height/2){let e=t.x+t.width-(i.x-i.width/2),s=1.1*(i.y+i.height/2-(t.y-t.height/2));switch(Math.min(e,s)){case e:i.x+=e;break;case s:i.y-=s}}return s}if(!(0,e.isNullOrUndefined)(i.ref)){if(t.x<i.fx&&t.y<i.fy&&t.x+t.width/2>i.fx-i.width/2&&t.y+t.height/2>i.fx-i.height/2){let e=t.x+t.width/2-(i.fx-i.width/2),s=1.1*(t.y+t.height/2-(i.fy-i.height/2));switch(Math.min(e,s)){case e:t.x-=e;break;case s:t.y-=s}}else if(t.x>i.fx&&t.y<i.fy&&i.fx+i.width/2>t.x-t.width/2&&t.y+t.height/2>i.fy-i.height/2){let e=i.fx+i.width/2-(t.x-t.width/2),s=1.1*(t.y+t.height/2-(i.fy-i.height/2));switch(Math.min(e,s)){case e:t.x+=e;break;case s:t.y-=s}}else if(t.x>i.fx&&t.y>i.fy&&i.fx+i.width/2>t.x-t.width/2&&i.fy+i.height/2>t.y-t.height/2){let e=i.fx+i.width/2-(t.x-t.width/2),s=1.1*(i.fy+i.height/2-(t.y-t.height/2));switch(Math.min(e,s)){case e:t.x+=e;break;case s:t.y+=s}}else if(t.x<i.fx&&t.y>i.fy&&t.x+t.width/2>i.fx-i.width/2&&t.y-t.height/2<i.fy+i.height/2){let e=t.x+t.width/2-(i.fx-i.width/2),s=1.1*(i.fy+i.height/2-(t.y-t.height/2));switch(Math.min(e,s)){case e:t.x-=e;break;case s:t.y+=s}}return s}if(i&&i!==t)if(t.x<=i.x&&t.y<=i.y&&t.x+t.width/2>=i.x-i.width/2&&t.y+t.height/2>=i.y-i.height/2){let e=t.x+t.width/2-(i.x-i.width/2),s=1.1*(t.y+t.height/2-(i.y-i.height/2));switch(Math.min(e,s)){case e:if(t.x-e/2<0){i.x+=e;break}if(i.x+e/2>n){t.x-=e;break}t.x-=e/2,i.x+=e/2;break;case s:if(t.y-s/2<0){i.x+=s;break}if(i.y+s/2>r){t.x-=s;break}t.y-=s/2,i.y+=s/2}}else if(t.x>i.x&&t.y<i.y&&i.x+i.width/2>t.x-t.width/2&&t.y+t.height/2>i.y-i.height/2){let e=i.x+i.width/2-(t.x-t.width/2),s=1.1*(t.y+t.height/2-(i.y-i.height/2));switch(Math.min(e,s)){case e:if(t.x+e/2>n){i.x-=e;break}if(i.x-e/2<0){t.x+=e;break}t.x+=e/2,i.x-=e/2;break;case s:if(t.y-s/2<0){i.x+=s;break}if(i.y+s/2>r){t.x-=s;break}t.y-=s/2,i.y+=s/2}}else if(t.x>i.x&&t.y>i.y&&i.x+i.width/2>t.x-t.width/2&&i.y+i.height/2>t.y-t.height/2){let e=i.x+i.width/2-(t.x-t.width/2),s=1.1*(i.y+i.height/2-(t.y-t.height/2));switch(Math.min(e,s)){case e:if(t.x+e/2>n){i.x-=e;break}if(i.x-e/2<0){t.x+=e;break}t.x+=e/2,i.x-=e/2;break;case s:if(t.y+s/2>r){i.y-=s;break}if(i.y-s/2<0){t.y+=s;break}t.y+=s/2,i.y-=s/2}}else if(t.x<i.x&&t.y>i.y&&t.x+t.width/2>i.x-i.width/2&&t.y-t.height/2<i.y+i.height/2){let e=t.x+t.width/2-(i.x-i.width/2),s=1.1*(i.y+i.height/2-(t.y-t.height/2));switch(Math.min(e,s)){case e:if(t.x-e/2<0){i.x+=e;break}if(i.x+e/2>n){t.x-=e;break}t.x-=e/2,i.x+=e/2;break;case s:if(t.y+s/2>r){i.y-=s;break}if(i.y-s/2<0){t.y+=s;break}t.y+=s/2,i.y-=s/2}}return s},focus(){return this.container.focus(),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this.container.focus(),this},focusOut(){return this.focused=!1,this.container.classList.remove("active"),this.container.classList.remove("focus"),this},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)})),this.projection.registerHandler("displayed",(()=>{(0,e.isEmpty)(this.source.value)||this.source.values.forEach((e=>{this.addItem(e),"prototype"===value.schema.nature&&(this.nodes[this.nodes.length-1].meta=this.nodes[i].concept,this.nodes[this.nodes.length-1].concept=value.getValue(!0).id)}))}))}},Is={getPointEllipse(e,t,i){const s=i.rx/2,n=i.ry/2,r=e.x,a=e.y,l=this.getDeq(e,t);let o=n*n+s*s*l.a*l.a,h=2*s*s*l.a*l.b-2*r*n*n-2*a*l.a*s*s,c=h*h-4*o*(r*r*n*n+s*s*a*a+s*s*l.b*l.b-2*a*s*s*l.b-s*s*n*n);if(c>=0){let e=(-h-Math.sqrt(c))/(2*o),t=e*l.a+l.b,i=(-h+Math.sqrt(c))/(2*o);return{x1:{x:e,y:t},x2:{x:i,y:i*l.a+l.b}}}},getPointConstructedEllipse(e,t,i,s){const n=t,r=i,a=s.x,l=s.y;let o=r*r+n*n*e.a*e.a,h=2*n*n*e.a*e.b-2*a*r*r-2*l*e.a*n*n,c=h*h-4*o*(a*a*r*r+n*n*l*l+n*n*e.b*e.b-2*l*n*n*e.b-n*n*r*r);if(c>=0){let t=(-h-Math.sqrt(c))/(2*o),i=t*e.a+e.b,s=(-h+Math.sqrt(c))/(2*o);return[{x:t,y:i},{x:s,y:s*e.a+e.b}]}},getEllipseCenter(e,t,i,s){let n=(t.x-i.x)/2,r=(t.y-i.y)/2,a=-Math.sqrt((e*e*(e*e)-e*e*(r*r)-e*e*(n*n))/(e*e*(r*r)+e*e*n*n)),l=a*(-e*n/e);return{x:a*(e*r/e)+(t.x+i.x)/2,y:l+(t.y+i.y)/2}},getPerpendicularLine(e,t){let i=(e.x+t.x)/2,s=(e.y+t.y)/2,n=-1/Is.getDeq(e,t).a;return{a:n,b:s-n*i}},getSelfPointEllipse(e){let t={x:e.x-e.ellipse.rx/2,y:e.y},i={x:e.x+e.ellipse.rx/2,y:e.y},s={x:e.x,y:e.y-e.ellipse.ry/2},n={x:e.x,y:e.y-e.ellipse.ry/2},r=0,a=0,l=0,o=0;switch(e.points.forEach((e=>{r+=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),a+=Math.sqrt((e.x-i.x)*(e.x-i.x)+(e.y-i.y)*(e.y-i.y)),l+=Math.sqrt((e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y)),o+=Math.sqrt((e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y))})),Math.max(r,a,l,o)){case l:return{x:s.x,y:s.y,direction:"top"};case a:return{x:i.x,y:i.y,direction:"right"};case o:return{x:n.x,y:n.y,direction:"bot"};default:return{x:t.x,y:t.y,direction:"left"}}},getPointPolygon(e,t,i){let s=[];i.points.forEach((t=>{s.push({x:t.x*e.width+e.x-e.width/2,y:t.y*e.height+e.y-e.height/2})}));let n=s[0].x-t.x,r=s[0].y-t.y,a=Math.sqrt(n*n+r*r),l=a,o=0;for(let e=1;e<s.length;e++)n=s[e].x-t.x,r=s[e].y-t.y,a=Math.sqrt(n*n+r*r),a<l&&(l=a,o=e);return s[o]},getDeq(e,t){let i=(t.y-e.y)/(t.x-e.x);return{a:i,b:e.y-i*e.x}},getCloserBorder(e,t){let i=Math.sqrt((e[0].x-t.x)*(e[0].x-t.x)+(e[0].y-t.y)*(e[0].y-t.y));return Math.sqrt((e[1].x-t.x)*(e[1].x-t.x)+(e[1].y-t.y)*(e[1].y-t.y))<i?e[1]:e[0]},getPointRect(e,t,i){let s=e.x-i.w/2,n=e.y-i.h/2,r=e.x+i.w/2,a=e.y-i.h/2,l=e.y+i.h/2,o=Is.getDeq({x:e.x,y:e.y},{x:t.x,y:t.y}),h=Is.getDeq({x:s,y:n},{x:r,y:a}),c=Is.getLineIntersection(o,h);return c&&c.x>s&&c.x<r?[c,{x:(l-o.b)/o.a,y:l}]:[{x:r,y:o.a*r+o.b},{x:s,y:o.a*s+o.b}]},getLineIntersection(e,t){if(e.a===t.a)return!1;let i=e.a-t.a,s=t.b-e.b;return{x:s/i,y:e.a*(s/i)+e.b}},getPointCircle(e,t,i){let s=Is.getDeq({x:e.x,y:e.y},{x:t.x,y:t.y}),n=s.a*s.a+1,r=2*s.a*s.b-2*s.a*e.y-2*e.x,a=r*r-4*n*(s.b*s.b-s.b*e.y*2+e.y*e.y+e.x*e.x-i.r*i.r);if(a>0){let e=(-r+Math.sqrt(a))/(2*n),t=(-r-Math.sqrt(a))/(2*n);return[{x:e,y:s.a*e+s.b},{x:t,y:s.a*t+s.b}]}},computeBorder(e,t){let i={},s={};switch(e.shape.type){case"rect":return i=Is.getPointRect(e,t,e.shape),s=Is.getCloserBorder(i,t),s;case"circle":return i=Is.getPointCircle(e,t,e.shape),s=Is.getCloserBorder(i,t),s;case"ellipse":return i=Is.getPointEllipse(e,t,e.shape),s=Is.getCloserBorder(i,t),s;case"polygon":return i=Is.getPointPolygon(e,t,e.shape),i}}},Us=Object.assign({},Ts,Ms),Hs={init(){const{dimensions:e}=this.schema;return this.dimensions=e,this},render(){(0,e.createDocFragment)();const{dimensions:t,saturation:i,overflow:s=!1,create:n,add:r,style:a}=this.schema;if(this.focusable=!0,(0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),t&&(this.container.setAttribute("width",t.width),this.container.setAttribute("height",t.height)),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="pattern",this.container.dataset.id=this.id,this.container.dataset.click="container",this.container.tabIndex=0),s&&(this.container.style.overflow="visible"),i&&(this.saturation=i.value,this.satTarget=i.target,(0,e.isNullOrUndefined)(i.satParams)||(this.satParams=i.satParams),(0,e.isNullOrUndefined)(i.acceptTarget)||(this.acceptTarget=i.acceptTarget)),(0,e.isNullOrUndefined)(this.anchors)&&this.setUpAnchors(),r&&(0,e.isNullOrUndefined)(this.add)){const{coordinates:e=!1,render:t}=r;this.add=Yn.call(this,t),e?(this.add.setAttribute("x",e.x),this.add.setAttribute("y",e.y)):(this.add.setAttribute("x",this.anchors.current.x),this.add.setAttribute("y",this.anchors.current.y)),this.container.append(this.add),this.add.style.overflow="visible",this.add.addEventListener("click",(()=>{}))}return this.displayed=!1,a&&(this.container.style=a),this.bindEvents(),n&&this.source.createElement(),a&&(this.container.style=a),this.container},checkDim(e,t,i){t+20+Number(i.getAttribute("y"))>Number(this.items[0].render.getAttribute("height"))&&this.items.forEach((e=>{this.projection.resolveElement(e.render).augment()}))},checkSpeDim(e,t,i){for(;t+20+Number(i.getAttribute("y"))>Number(this.items[this.items.length-1].render.getAttribute("height"));)this.projection.resolveElement(this.items[this.items.length-1].render).augment()},createItem(e){const{tag:t}=this.schema.pattern;let i=this.model.createProjection(e,t);return i.optional=!0,i.parent=this.projection,{render:i.init().render(),projection:i}},addItem(t){if(console.log("Saturation test"),console.log(this),console.log(this.count),console.log(this.saturation),this.saturation&&((0,e.isNullOrUndefined)(this.count)&&(this.count=0),this.count>=this.saturation))return console.log(this.satTarget),this.environment.getActiveReceiver(this.satTarget).source.createElement(),void this.saturate(t);let{render:i,projection:s}=this.createItem(t);(0,e.isNullOrUndefined)(this.dimSchema)&&(this.dimSchema=new Map),this.dimSchema.set(i.dataset.id,si.analyseDim(i,this.schema.pattern)),this.container.append(i);let n=this.anchors.current;(0,e.isNullOrUndefined)(this.items)&&(this.items=[]),this.items.push({render:i,position:n,index:this.anchorIndex,id:t.id}),this.displayed?(si.setDimensions(this.dimSchema.get(i.dataset.id)),s.update("displayed",i.dataset.id)):((0,e.isNullOrUndefined)(this.waiting)&&(this.waiting=[]),this.waiting.push({render:i,projection:s})),(0,e.isNullOrUndefined)(this.anchors)&&this.setUpAnchors(),si.positionElement(n,i),this.nextAnchor(!0),this.count++,this.warnings&&this.warnings.forEach((e=>{s.warn(e)}))},placeAdd(){this.add.setAttribute("x",this.anchors.current.x),this.add.setAttribute("y",this.anchors.current.y)},setUpAnchors(){const{first:e,next:t}=this.schema.pattern;this.anchors={},this.anchors.current=e,this.anchors.next=t,this.anchors.indexes=[e],this.anchorIndex=0},saturate(e){let t=this.environment.projectionModel.createProjection(this.projection.concept,this.projection.tag).init();t.render(),console.log("SATPARAMS"),console.log(this.satParams),console.log(this.satParams.coordinates),this.environment.getActiveReceiver("solo").accept(t.element.container,this.satParams.dimension,this.satParams.coordinates),t.element.addItem(e),this.full=!0,this.saturated=!0},accept(e,t=!1){const{render:i,params:s}=e;if(t){let e=this.projection.resolveElement(i);return e.parent=this,void(e.definitions&&this.container.append(e.definitions))}this.container.append(i)},acceptAnchor(e){console.log("AcceptingAnchor"),this.container.append(e);let t=this.anchors.current;this.items.push({render:e,anchor:t,index:this.anchorIndex,id:e.id}),si.positionElement(t,e),this.nextAnchor(!0),this.count++,this.count>=this.saturation&&(this.full=!0)},nextAnchor(t=!1){let{x:i,y:s}=this.anchors.current,n=this.anchors.next.x,r=this.anchors.next.y;this.anchors.current={x:i+n,y:s+r},t&&this.anchorModel&&Kt.AnchorHandler.nextAnchor(this.schema.handler.id,this.id),(0,e.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),this.anchors.indexes.push({x:i+n,y:s+r}),this.anchorIndex++,(0,e.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container)},createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return i.append(e),t.append(i),t},adapt(e,t){let i,s=e.parentNode.parentNode,n=e.parentNode;switch(t.type){case"fixed":s.setAttribute("width",t.value),n.setAttribute("width",t.value),i=e.getBoundingClientRect(),n.setAttribute("height",i.height),n.setAttribute("width",i.width),s.setAttribute("height",i.height*t.value/i.width),s.setAttribute("viewBox","0 0 "+i.width+" "+i.height)}},transmitFirst(){const{render:e,position:t,index:i,id:s}=this.items[0];return console.log("Transmitting"),console.log(e),this.removeItem({id:s}),console.log("Removed"),e},removeItem(t){let i,s;for(s=0;s<this.items.length;s++)if(this.items[s].id===t.id){const{position:e}=this.items[s];i=e;break}if(console.log("Value"),console.log(t),console.log(s),s>=this.items.length||(0,e.isNullOrUndefined)(this.items[s]))return;const n=this.items[s].index;for(this.items.splice(s,1),s>this.items.length&&s--;s<this.items.length;){let e=this.items[s].position;this.items[s].position=i,this.items[s].render.setAttribute("x",i.x),this.items[s].render.setAttribute("y",i.y),this.items[s].index--,i=e,s++}this.anchors.indexes.splice(this.anchors.indexes.length-1,1),this.anchors.current=this.anchors.indexes[this.anchors.indexes.length-1],(0,e.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),(0,e.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container),this.anchorModel&&Kt.AnchorHandler.deleteItem(this.schema.handler.id,this.id,n),(0,e.isNullOrUndefined)(this.count)||(this.count--,this.full&&(this.full=!1,this.environment.saturationRevolved(this,this.projection.rtag),this.saturated=!0),this.count)},removeAnchor(t){if(!(0,e.isNullOrUndefined)(this.items))for(let e=0;e<this.items.length;e++)this.items[e].index>t&&(this.items[e].position.x-=this.anchors.next.x,this.items[e].position.y-=this.anchors.next.y,this.items[e].render.setAttribute("x",this.items[e].position.x),this.items[e].render.setAttribute("y",this.items[e].position.y),this.items[e].index--);this.anchors.indexes.splice(this.anchors.indexes.length-1,1),this.anchors.current=this.anchors.indexes[this.anchors.indexes.length-1],(0,e.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),(0,e.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container)},moveElemToAnchor(t,i){this.anchors.indexes.length<=t+1&&(this.nextAnchor(!0),(0,e.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd());let s=this.anchors.indexes[t];this.items[i].position=s,this.items[i].index=t;let n=this.items[i].render;return n.setAttribute("x",s.x),n.setAttribute("y",s.y),n},increaseAnchors(t,i,s,n){i>this.anchors.indexes.length&&this.nextAnchor(!0),(0,e.isNullOrUndefined)(this.items)||this.items.forEach((e=>{e.render!==s&&e.index>=t&&e.index<=i&&(e.index++,n.includes(e.index)?this.projection.resolveElement(e.render).increaseAnchor():(e.position=this.anchors.indexes[e.index],e.render.setAttribute("x",e.position.x),e.render.setAttribute("y",e.position.y)))}))},decreaseAnchors(t,i,s,n){(0,e.isNullOrUndefined)(this.items)||this.items.forEach((e=>{e.render!==s&&e.index>=t&&e.index<=i&&(e.index--,n.includes(e.index)?this.projection.resolveElement(e.render).decreaseAnchor():(e.position=this.anchors.indexes[e.index],e.render.setAttribute("x",e.position.x),e.render.setAttribute("y",e.position.y)))}))},clickHandler(e){},focusIn(){return this.add&&this.container.append(this.add),this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.hide&&this.add&&this.add.remove(),this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.projection.registerHandler("displayed",(t=>{this.displayed||(this.displayed=!0,(0,e.isNullOrUndefined)(this.waiting)||this.waiting.forEach((e=>{let{render:t,projection:i}=e;si.setDimensions(this.dimSchema.get(t.dataset.id)),i.update("displayed")}))),this.schema.handler&&(this.anchorModel=Kt.AnchorHandler.create(this,this.schema.handler))})),this.projection.registerHandler("value.added",(e=>{this.full?this.saturated||this.saturate():this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)}))}},Ds=Object.assign({},Ts,Hs),{isHTMLElement:Vs,createDiv:Bs,isNullOrUndefined:Ps,createDocFragment:Rs,isEmpty:_s,isNull:$s,valOrDefault:Fs,isUndefined:zs}=s(835),Ws={init(){return this},render(){const{content:e=[],coordinates:t=!1,overflow:i=!1,background:s,data:n=!1,reference:r=!1,dimensions:a=!1,style:l,rmv:o=!1,anchor:h=!1}=this.schema,c=Rs(),d=new DOMParser;if(Ps(this.container)){if(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),s&&(this.background=d.parseFromString(s.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.background),this.container.setAttribute("width",this.background.getAttribute("width")),this.container.setAttribute("height",this.background.getAttribute("height")),this.width=Number(this.background.getAttribute("width")),this.height=Number(this.background.getAttribute("height")),this.fixed=!0),a){const{width:e,height:t,viewBox:i=!1}=a;this.container.setAttribute("width",e),this.container.setAttribute("height",t),this.width=a.width,this.height=a.height,this.fixed=!0,i&&this.container.setAttribute("viewBox",i.minX+" "+i.minY+" "+i.width+" "+i.height)}if(i&&(this.container.style.overflow="visible"),s||a||(this.container.style.overflow="visible"),t){const{x:e,y:i}=t;this.container.setAttribute("x",e),this.container.setAttribute("y",i)}this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="decoration",this.container.dataset.id=this.id,r&&(this.container.dataset.reference=!0)}return n&&this.container.setAttribute("data-shape",n),h&&(this.attachPoint=h),Ps(this.content)&&!_s(e)&&(this.waiting=[],this.positioning=[],this.itemsPos=new Map,this.itemsDim=new Map,this.content=[],e.forEach((e=>{let t=Yn.call(this,e.render),i=si.analyseDim(t,e);this.itemsDim.set(t.dataset.id,i);let s=this.projection.resolveElement(t);Ps(s)?this.waitingRendered=!0:this.content.push(s),i.await&&this.waiting.push(t.dataset.id);let n=si.analysePos(t,e);this.itemsPos.set(t.dataset.id,n),n.await&&this.positioning.push(n),Ps(i.holder)?this.container.append(i.item):this.container.append(i.holder)}))),c.hasChildNodes()&&this.container.append(c),l&&(this.container.style=l),this.displayed=!1,this.bindEvents(),this.container},focus(e){this.container.focus()},focusIn(){return!Ps(this.deleteElem)&&this.deleteElem.dataset.focusable&&this.container.append(this.deleteElem),Ps(this.focusedElement)||this.focusedElement.forEach((e=>{this.container.append(e)})),Ps(this.content)||this.content.forEach((e=>{e.focusIn()})),this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this.rmv&&this.container.append(this.rmv),this},focusOut(){return!Ps(this.deleteElem)&&this.deleteElem.dataset.focusable&&this.deleteElem.remove(),Ps(this.focusedElement)||this.focusedElement.forEach((e=>{e.remove()})),Ps(this.content)||this.content.forEach((e=>{e.focusOut()})),this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this.rmv&&this.rmv.remove(),this},notify(e){this.updateContentDim(e.id)},augment(){let e=this.container.querySelector("[data-augment]");e.setAttribute("height",Number(e.getAttribute("height"))+30),Ps(this.container.getAttribute("height"))||this.container.setAttribute("height",Number(this.container.getAttribute("height"))+30),$s(this.background)||this.background.setAttribute("height",Number(this.background.getAttribute("height"))+30)},updateContentDim(e){let t=this.itemsDim.get(e),i=this.itemsPos.get(e);"ratio"===t.type&&(si.adaptRatio(t.item,t.ratio),si.positionElement(i,t.holder))},accept(e,t,i){console.log("Accepting"),console.log(i);let s=si.analyseDim(e,{dimension:t}),n=si.analysePos(e,{coordinates:i});Ps(this.itemsDim)&&(this.itemsDim=new Map),this.itemsDim.set(e.dataset.id,s),Ps(this.itemsPos)&&(this.itemsPos=new Map),this.itemsPos.set(e.dataset.id,n),this.displayed?(si.setDimensions(s),Ps(s.holder)?si.positionElement(n,e):si.positionElement(n,s.holder)):(Ps(this.content)&&(this.content=[],this.waiting=[],this.positioning=[]),this.content.push(this.projection.resolveElement(e)),s.await&&this.waiting.push(e.dataset.id),n.await&&this.positioning.push(n)),Ps(s.holder)?this.container.append(s.item):this.container.append(s.holder)},analyseContentDim(){if(this.fixed)return;let e=0;if(0===this.content.length)return;for(;e<this.content.length&&Ps(this.content[e]);)e++;if(e>this.content.length)return;let t=this.itemsDim.get(this.content[e].id);if("pure"===t.type){let t,i,s,n;Ps(this.content[e].container)?(t=Number(this.content[e].element.getAttribute("x")),i=Number(this.content[e].element.getAttribute("y")),s=Number(this.content[e].width),n=Number(this.content[e].height)):(t=Number(this.content[e].container.getAttribute("x")),i=Number(this.content[e].container.getAttribute("y")),s=Number(this.content[e].width),n=Number(this.content[e].height)),this.width=t+s,this.height=i+n}for(let i=e+1;i<this.content.length;i++)if(!Ps(this.content[i])&&(t=this.itemsDim.get(this.content[i].id),"pure"===t.type)){let e,t,s,n;Ps(this.content[i].container)?(e=Number(this.content[i].element.getAttribute("x")),t=Number(this.content[i].element.getAttribute("y")),s=Number(this.content[i].width),n=Number(this.content[i].height)):(e=Number(this.content[i].container.getAttribute("x")),t=Number(this.content[i].container.getAttribute("y")),s=Number(this.content[i].width),n=Number(this.content[i].height)),(Ps(this.width)||this.width<e+s)&&(this.width=e+s),(Ps(this.height)||this.height<t+n)&&(this.height=t+n)}this.notifyDimObservers()},notifyDim(e,t,i){if(this.fixed)return;this.analyseContentDim();let s=Number(i.getAttribute("x")),n=Number(i.getAttribute("y"));(Ps(this.width)||this.width<s+e)&&(this.width=s+e),(Ps(this.height)||this.height<n+t)&&(this.height=n+t)},clickHandler(e){if(this.container.contains(e)){for(;e!==this.container&&Ps(e.dataset.nature);)e=e.parentNode;e!==this.container&&this.projection.resolveElement(e).clickHandler(e)}return!1},bindEvents(){Ps(this.content)||this.content.forEach((e=>{Ps(e)||"static"===e.object||"simulation"===e.object||e.registerDimensionsObserver(this)})),this.projection.registerHandler("displayed",(e=>{this.displayed||(this.displayed=!0,Ps(this.waiting)||this.waiting.forEach((e=>{si.setDimensions(this.itemsDim.get(e))})),Ps(this.positioning)||this.positioning.forEach((e=>{let t=this.itemsDim.get(e.render.dataset.id);t.holder?si.positionElement(e,t.holder):si.positionElement(e,e.render)})),Ps(this.content)||this.content.forEach((e=>{Ps(e)||e.projection.update("displayed",e.id)})),Ps(this.width)&&this.analyseContentDim(),Ps(this.parent)||Vs(this.parent.element)||Vs(this.parent.container)||this.parent.notifyDim(this.width,this.height,this.container))})),this.waitingRendered&&this.projection.registerHandler("binding",(e=>{this.itemsDim.set(e.dataset.id,{await:!1,item:e,type:"pure"}),this.content.push(this.projection.resolveElement(e)),this.analyseContentDim()}))}},qs=Object.assign({},Ts,Ws),Xs={init(){return this},render(){const{interaction:t,algorithm:i}=this.schema,s=(0,e.createDocFragment)();if((0,e.isNullOrUndefined)(this.container)&&(this.container=(0,e.createDiv)({id:this.id,class:["algorithm","algorithm--holder"],tabindex:-1,dataset:{nature:"algorithm",view:"holder",id:this.id}})),(0,e.isNullOrUndefined)(this.interactionArea)&&(this.interactionArea=Yn.call(this,t),s.append(this.interactionArea)),(0,e.isNullOrUndefined)(this.svgArea)){let e=this.source.getAttributeByName(i.name).target,t=this.environment.projectionModel.createProjection(e,i.tag);this.svgArea=t.init().render(),s.append(this.svgArea)}return s.hasChildNodes()&&this.container.append(s),this.container}},Ys=Object.assign({},Ts,Xs),{createDocFragment:Zs,isNullOrUndefined:Gs,isEmpty:Js,isNull:Ks}=s(835),{AnchorHandler:Qs}=s(185),en={init(){return this},render(){const{dimensions:e,overflow:t=!1,contains:i,reserve:s,model:n,style:r,offset:a,zindex:l,content:o=[]}=this.schema;if(Gs(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="anchor",this.container.dataset.id=this.id),t&&(this.container.style.overflow="visible"),e){const{width:t,height:i}=e;this.container.setAttribute("width",t),this.container.setAttribute("height",i)}return!Js(o)&&Gs(this.items)&&(this.items=[],o.forEach((e=>{const{coordinates:t,render:i,dimension:s}=e;let n=Yn.call(this,i);n.setAttribute("x",t.x),n.setAttribute("y",t.y),this.container.append(n),this.items.push(n)}))),n&&(Qs.createSubModel(n,this),this.anchorModel=n),this.bindEvents(),r&&this.createStyleMimic(r),this.container},focusIn(){},focusOut(){},increaseSize(){const e=Number(this.container.getAttribute("height"));this.container.setAttribute("height",e+this.anchors.y),this.mimic.setAttribute("height",e+this.anchors.y)},decreaseSize(){const e=Number(this.container.getAttribute("height"));this.container.setAttribute("height",e-this.anchors.y),this.mimic.setAttribute("height",e-this.anchors.y)},increaseAnchor(){const e=Number(this.container.getAttribute("y"));this.container.setAttribute("y",e+this.anchors.y)},decreaseAnchor(){const e=Number(this.container.getAttribute("y"));this.container.setAttribute("y",e-this.anchors.y)},createStyleMimic(e){this.mimic=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.mimic.setAttribute("width",this.container.getAttribute("width")),this.mimic.setAttribute("height",this.container.getAttribute("height")),this.mimic.style=e,this.container.prepend(this.mimic)},checkCover(){let e,t;for(let i=0;i<this.covering.length;i++)Gs(e)?(e=Math.min(this.covering[i].from.x,this.covering[i].to.x),t=Math.max(this.covering[i].from.x,this.covering[i].to.x)):(e>Math.min(this.covering[i].from.x,this.covering[i].to.x)&&(e=Math.min(this.covering[i].from.x,this.covering[i].to.x)),t<Math.max(this.covering[i].from.x,this.covering[i].to.x)&&(t=Math.max(this.covering[i].from.x,this.covering[i].to.x)));const i=Number(this.container.getAttribute("x"));i<e?(this.container.setAttribute("width",t-e+2*this.schema.offset.x+(e-i)),this.mimic.setAttribute("width",t-e+2*this.schema.offset.x+(e-i))):(this.container.setAttribute("width",t-e+2*this.schema.offset.x),this.mimic.setAttribute("width",t-e+2*this.schema.offset.x))},bindEvents(){this.projection.registerHandler("displayed",(()=>{let e=Qs.estimatePositionCondamn(this.anchorModel,this);const{offset:t=!1}=this.schema;t&&(this.container.setAttribute("x",e.x-t.x),this.container.setAttribute("y",e.y-t.y)),this.anchors=e.anchors,this.rtag=this.environment.getActiveReceiver(this.schema.rtag),this.rtag.container.prepend(this.container)})),this.projection.registerHandler("accept",(e=>{Qs.registerSubModel(this.anchorModel,this,e)})),this.projection.registerHandler("cover",(e=>{Gs(this.rtag)&&(this.rtag=this.findActiveReceiver(this.schema.rtag));const t=Qs.estimatePosition(e.calcS),i=Qs.estimatePosition(e.calcT);Gs(this.covering)&&(this.covering=[]),this.setCovering(e,t,i),this.checkCover()}))},setCovering(e,t,i){for(let s=0;s<this.covering.length;s++)if(this.covering[s].item===e)return this.covering[s].from=t,void(this.covering[s].to=i);this.covering.push({item:e,from:t,to:i})}},tn=Object.assign({},Ts,en),sn={init(){return this},render(){const{button:t,view:i}=this.schema;if((0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="decoration",this.container.dataset.id=this.id),(0,e.isNullOrUndefined)(this.button)){const e=new DOMParser,{content:i,coordinates:s}=t;this.button=e.parseFromString(parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.button.setAttribute("x",s.x),this.button.setAttribute("y",s.y),this.container.append(t)}return this.bindEvents(),this.container},bindEvents(){}},nn=Object.assign({},Ts,sn),{isHTMLElement:rn,createDiv:an,isNullOrUndefined:ln,createDocFragment:on,isEmpty:hn,isNull:cn,valOrDefault:dn}=s(835),un={init(){return this},render(){const{content:e,dimensions:t}=this.schema;return ln(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","text"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="add",this.container.dataset.id=this.id,this.container.setAttribute("font-size",12),this.container.style["dominant-baseline"]="hanging"),this.container.textContent=e,this.container},focusIn(){},focusOut(){},clickHandler(){this.source.createElement()},bindEvents(){this.container.addEventListener("click",(()=>{this.source.createElement()}))}},mn=Object.assign({},Ts,un),pn={init(){return this},render(){const{action:t,content:i,background:s}=this.schema;if((0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="button",this.container.dataset.id=this.id),i&&(0,e.isNullOrUndefined)(this.content)&&this.createContent(i),s){const e=new DOMParser;this.background=e.parseFromString(s.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.background)}return this.container},createContent(e){switch(e.type){case"text":this.content=document.createElementNS("http://www.w3.org/2000/svg","text");const{placeholder:t,font:i,size:s,anchor:n}=e.text;this.content.setAttribute("font-family",i),this.content.setAttribute("font-size",s),this.content.setAttribute("text-anchor",n),this.content.style["dominant-baseline"]="hanging",this.content.textContent=t,this.container.append(this.content)}},focusIn(){},focusOut(){}},fn=Object.assign({},Ts,pn);var gn=0;const vn=()=>"algo"+gn++,bn={force:(e,t,i)=>Object.create(Us,{object:{value:"algorithm"},name:{value:"force-algorithm"},type:{value:"force"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(e,t,i)=>Object.create(Ds,{object:{value:"algorithm"},name:{value:"pattern-algorithm"},type:{value:"pattern"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),decoration:(e,t,i)=>Object.create(qs,{object:{value:"algorithm"},name:{value:"decoration-algorithm"},type:{value:"decoration"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(e,t,i)=>Object.create(Ys,{object:{value:"algorithm"},name:{value:"holder-algorithm"},type:{value:"holder"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),anchor:(e,t,i)=>Object.create(tn,{object:{value:"algorithm"},name:{value:"anchor-algorithm"},type:{value:"anchor"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),"alt-view":(e,t,i)=>Object.create(nn,{object:{value:"algorithm"},name:{value:"alt-view"},type:{value:"alt-view"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),add:(e,t,i)=>Object.create(mn,{object:{value:"algorithm"},name:{value:"add"},type:{value:"add"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),button:(e,t,i)=>Object.create(fn,{object:{value:"algorithm"},name:{value:"svg-button"},type:{value:"button"},id:{value:vn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},yn={createAlgo(t,i,s){const{type:n}=i,r=bn[n];if((0,e.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${n}' algo could not be handled`);const a=r(t,i,s);if((0,e.isNullOrUndefined)(a))throw new Error(`Bad request: The '${n}' algo could not be created`);return a.createAlgo=this.createAlgo,(0,e.isNullOrUndefined)(a.id)&&(a.id=vn()),a}},wn={notifyDimObservers(){isNullOrUndefined(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))}},xn={init(){return this.width=700,this.height=700,this},render(){(0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",350),this.container.setAttribute("height",350),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.simulationArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.simulationArea.setAttribute("width",350),this.simulationArea.setAttribute("height",350),this.simulationArea.setAttribute("viewBox","0 0 700 700"),this.simulationArea.setAttribute("preserveAspectRatio","xMidYMid meet"),this.simulationArea.id=this.id,this.settingArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.settingArea.setAttribute("x",0),this.settingArea.setAttribute("y",0),this.container.append(this.settingArea),this.container.append(this.simulationArea)),(0,e.isNullOrUndefined)(this.circleRadiusTxt)&&(this.circleRadiusTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.circleRadiusTxt.textContent="Radius:",this.circleRadiusTxt.setAttribute("x",5),this.circleRadiusTxt.setAttribute("y",30),this.circleRadiusTxt.setAttribute("font-size",8),this.circleRadiusTxt.setAttribute("font-weight",500),this.circleRadiusTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.circleRadiusTxt)),(0,e.isNullOrUndefined)(this.radiusTxt)&&(this.radiusTxt=Yn.call(this,{type:"attribute",name:"radius",tag:"simulation"}),this.radiusTxt.setAttribute("x",37),this.radiusTxt.setAttribute("y",30),this.settingArea.append(this.radiusTxt)),(0,e.isNullOrUndefined)(this.widthTxt)&&(this.widthTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.widthTxt.textContent="Width:",this.widthTxt.setAttribute("x",5),this.widthTxt.setAttribute("y",40),this.widthTxt.setAttribute("font-size",8),this.widthTxt.setAttribute("font-weight",500),this.widthTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.widthTxt)),(0,e.isNullOrUndefined)(this.wTxt)&&(this.wTxt=Yn.call(this,{type:"attribute",name:"width",tag:"simulation"}),this.wTxt.setAttribute("x",37),this.wTxt.setAttribute("y",40),this.settingArea.append(this.wTxt)),(0,e.isNullOrUndefined)(this.heightTxt)&&(this.heightTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.heightTxt.textContent="Height",this.heightTxt.setAttribute("x",5),this.heightTxt.setAttribute("y",50),this.heightTxt.setAttribute("font-size",8),this.heightTxt.setAttribute("font-weight",500),this.heightTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.heightTxt)),(0,e.isNullOrUndefined)(this.hTxt)&&(this.hTxt=Yn.call(this,{type:"attribute",name:"height",tag:"simulation"}),this.hTxt.setAttribute("x",37),this.hTxt.setAttribute("y",50),this.settingArea.append(this.hTxt)),this.button=document.createElementNS("http://www.w3.org/2000/svg","text"),this.button.textContent="Simulate",this.settingArea.append(this.button),this.button.addEventListener("click",(()=>{this.setUpForce()})),this.button.setAttribute("x",5),this.button.setAttribute("y",12),this.button.setAttribute("font-size",12),this.button.setAttribute("font-weight",500),this.button.setAttribute("font-family","Segoe UI");let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.classList.add("linkSimulation"),t.id="linkSimulation"+this.id,t.setAttribute("stroke","black"),this.simulationArea.append(t),this.svgNode=[];for(let e=0;e<3;e++){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.style.fill="red",e.style.stroke="black",e.setAttribute("r",50),e.classList.add("nodeSimulation"),e.classList.add("hidden"),this.svgNode.push(e),this.simulationArea.append(e)}let i=document.createElementNS("http://www.w3.org/2000/svg","circle");return i.classList.add("nodeSimulation"),i.classList.add("hidden"),this.svgNode.push(i),this.simulationArea.append(i),this.bindEvents(),this.intensity=Number(this.intensityAttr.value),this.linkVal=Number(this.linkDistAttr.value),this.container},branch(){this.setUpForce()},setUpForce(){if((0,e.isNullOrUndefined)(this.force)){this.svgNode.forEach((e=>{e.classList.remove("hidden")})),this.source.getAttributeByName("intensity").target.value;const e=Number(this.source.getAttributeByName("linkVal").target.value);this.force=d3.layout.force().size([this.width,this.height]).nodes([]).links([{source:0,target:1}]).linkDistance(e).charge(-500).on("tick",this.tick.bind(this));var t=d3.select("#"+this.id);this.nodes=this.force.nodes(),this.nodes.push({x:25,y:25}),this.nodes.push({x:325,y:25}),this.nodes.push({x:175,y:75}),this.nodes.push({ref:!0}),this.node=t.selectAll("circle").data(this.nodes),this.links=this.force.links(),this.link=t.selectAll("path").data(this.links)}this.force.start()},clickHandler(){},tick(){let e=this.nodes;this.node.attr("cx",(function(t){if(t.ref){En.getMediatrice(e[0],e[1]);let t={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2};return e[0].x,e[1].x,e[0].x,e[1].x,e[0].y,e[1].y,e[0].y,e[1].y,t.x}return t.x})).attr("cy",(function(t){if(t.ref){En.getMediatrice(e[0],e[1]);let t={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2};return e[0].x,e[1].x,e[0].x,e[1].x,e[0].y,e[1].y,e[0].y,e[1].y,t.y}return t.y})),this.link.attr("d",(function(e){return"M"+e.target.x+","+e.target.y+"A1,1 0 0 1,"+e.source.x+","+e.source.y+"A1,1 0 0 0,"+e.target.x+","+e.target.y}))},updateClean(){this.height=this.heightAttr.value,this.width=this.widthAttr.value,this.height>0&&this.width>0&&this.simulationArea.setAttribute("viewBox","0 0 "+this.width+" "+this.height);for(let e=0;e<3;e++)this.radius.value>0&&this.svgNode[e].setAttribute("r",this.radius.value)},focusIn(){},focusOut(){},updateParams(){if((0,e.isNullOrUndefined)(this.force))this.updateClean();else{this.force.stop(),this.intensity=Math.min(-1*Number(this.intensityAttr.value),-1*Number(this.intensityAttr.value)),this.linkVal=Number(this.linkDistAttr.value);for(let e=0;e<3;e++)this.radius.value>0&&this.svgNode[e].setAttribute("r",this.radius.value);this.height=this.heightAttr.value,this.width=this.widthAttr.value,this.height>0&&this.width>0&&(this.simulationArea.setAttribute("viewBox","0 0 "+this.width+" "+this.height),this.force.size([this.width,this.height])),this.force.linkDistance(this.linkVal).charge(this.intensity),this.force.start()}},bindEvents(){this.intensityAttr=this.source.getAttributeByName("intensity").target,this.linkDistAttr=this.source.getAttributeByName("linkVal").target,this.widthAttr=this.source.getAttributeByName("width").target,this.heightAttr=this.source.getAttributeByName("height").target,this.radius=this.source.getAttributeByName("radius").target,this.intensityAttr.register(this.projection),this.linkDistAttr.register(this.projection),this.widthAttr.register(this.projection),this.heightAttr.register(this.projection),this.radius.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateParams()}))}},En={getMediatrice(e,t){let i=(e.x+t.x)/2,s=(e.y+t.y)/2,n=(t.y-e.y)/(t.x-e.x);return{k:-1/n,h:s+-1/n*i}},findPoint(e,t,i){let s=1-e.k*e.k,n=2*t.y*e.k-2-2*e.k*e.h,r=n*n-4*s*(t.x*t.x-t.y*t.y-e.h*e.h+2*t.y*e.h-i);if(r>0)return(-n-Math.sqrt(r))/(2*s);console.log(r),console.log("Not Found")}},An=Object.assign(Object.create(wn),xn),On={init(){return this.width=350,this.height=100,this},focusIn(){},focusOut(){},render(){return(0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",300),this.container.setAttribute("height",50),this.container.setAttribute("x",100),this.container.setAttribute("y",0),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("d","M 0 25 L 200 25"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.id=this.id,this.path.id="path"+this.id,this.container.append(this.path)),this.markerStart=Yn.call(this,{type:"attribute",name:"start",placeholder:!1,tag:"simulation-start"}),this.markerEnd=Yn.call(this,{type:"attribute",name:"end",placeholder:!1,tag:"simulation-end"}),this.container.append(this.markerStart),this.container.append(this.markerEnd),this.bindEvents(),this.container},applyStyle(){this.stroke.hasValue()&&this.path.setAttribute("stroke",this.stroke.value),this.width.hasValue()&&this.path.setAttribute("stroke-width",this.width.value),this.dasharray.hasValue()&&this.path.setAttribute("stroke-dasharray",this.dasharray.value),this.linecap.hasValue()&&this.path.setAttribute("stroke-linecap",this.linecap.value)},bindEvents(){this.stroke=this.source.getAttributeByName("stroke").target,this.stroke.register(this.projection),this.path.setAttribute("stroke","black"),this.width=this.source.getAttributeByName("width").target,this.width.register(this.projection),this.width.hasValue()&&this.path.setAttribute("stroke-width",this.width.value),this.dasharray=this.source.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.dasharray.hasValue()&&this.path.setAttribute("stroke-dasharray",this.dasharray.value),this.linecap=this.source.getAttributeByName("linecap").target,this.linecap.register(this.projection),this.linecap.hasValue()&&this.path.setAttribute("stroke-linecap",this.linecap.value),this.projection.registerHandler("value.changed",(()=>{this.applyStyle()}))}},Nn=Object.assign(Object.create(wn),On),jn={init(){return this.width=350,this.height=100,this},render(){return(0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",200),this.container.setAttribute("height",200),this.container.setAttribute("viewBox","0 0 50 50"),this.text=document.createElementNS("http://www.w3.org/2000/svg","text"),this.text.setAttribute("x",25),this.text.setAttribute("y",25),this.text.textContent="Element",this.heightTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.heightTxt.setAttribute("x",2),this.heightTxt.setAttribute("y",45),this.heightTxt.setAttribute("font-size",2),this.heightTxt.textContent="dimensions: 50x50",this.xyText=document.createElementNS("http://www.w3.org/2000/svg","text"),this.xyText.setAttribute("x",2),this.xyText.setAttribute("y",47),this.xyText.setAttribute("font-size",2),this.xyText.textContent="x,y: 25, 25",this.container.append(this.text),this.container.append(this.widthTxt),this.container.append(this.heightTxt),this.container.append(this.xyText),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="text",this.container.dataset.id=this.id,this.container.style="border:solid rgb(135, 161, 255); border-radius:10%;",this.container.id=this.id),this.bindEvents(),this.container},applyStyle(){this.font.hasValue()&&this.text.setAttribute("font-family",this.font.value),this.size.hasValue()&&this.text.setAttribute("font-size",this.size.value),this.anchor.hasValue()&&this.text.setAttribute("text-anchor",this.anchor.value),this.weight.hasValue()&&this.text.setAttribute("font-weight",this.weight.value),this.baseline.hasValue()&&(this.text.style["dominant-baseline"]=this.baseline.value)},bindEvents(){this.font=this.source.getAttributeByName("font").target,this.font.register(this.projection),this.text.setAttribute("font-family","Verdana"),this.size=this.source.getAttributeByName("size").target,this.size.register(this.projection),this.size.hasValue()&&this.text.setAttribute("font-size",this.size.value),this.weight=this.source.getAttributeByName("weight").target,this.weight.register(this.projection),this.weight.hasValue()&&this.text.setAttribute("font-weight",this.weight.value),this.anchor=this.source.getAttributeByName("anchor").target,this.anchor.register(this.projection),this.anchor.hasValue()&&this.text.setAttribute("text-anchor",this.anchor.value),this.baseline=this.source.getAttributeByName("baseline").target,this.baseline.register(this.projection),this.baseline.hasValue()&&this.text.setAttribute("dominant-baseline",this.anchor.value),this.projection.registerHandler("value.changed",(()=>{this.applyStyle()}))}},Cn=Object.assign(Object.create(wn),jn),Ln={init(){return this.width=400,this.height=200,this},render(){return(0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",200),this.container.setAttribute("height",200),this.container.setAttribute("viewBox","0 0 400 400"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.simulation="selection",this.container.dataset.id=this.id,this.container.style="border:solid rgb(135, 161, 255); border-radius:10%;",this.container.id=this.id),this.bindEvents(),this.setUpSimulation(),this.container},bindEvents(){this.nbItem=this.source.getAttributeByName("nbItem").target,this.orientation=this.source.getAttributeByName("orientation").target,this.break=this.source.getAttributeByName("break").target,this.itemW=this.source.getAttributeByName("dimensions").target.getAttributeByName("width").target,this.itemH=this.source.getAttributeByName("dimensions").target.getAttributeByName("height").target,this.nbItem.register(this.projection),this.orientation.register(this.projection),this.break.register(this.projection),this.itemW.register(this.projection),this.itemH.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.setUpSimulation()}))},setUpSimulation(){this.baseLetter=65,(0,e.isNullOrUndefined)(this.selection)||this.selection.remove(),this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg");for(let e=0;e<this.nbItem.value;e++){let t=this.createItem();this.place(t,e),this.baseLetter++}this.center(),this.container.append(this.selection)},focusIn(){},focusOut(){},place(t,i){const s=(0,e.valOrDefault)(this.itemW.value,50),n=(0,e.valOrDefault)(this.itemH.value,50),r=this.break.value;switch(this.orientation.value){case"horizontal":r>0?(t.setAttribute("x",i%r*s),t.setAttribute("y",~~(i/r)*n)):t.setAttribute("x",i*s);break;case"vertical":r>0?(t.setAttribute("x",~~(i/r)*n),t.setAttribute("y",i%r*s)):t.setAttribute("y",i*n)}},createItem(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");const i=(0,e.valOrDefault)(this.itemW.value,50),s=(0,e.valOrDefault)(this.itemH.value,50);this.break.value,t.setAttribute("width",i),t.setAttribute("height",s);let n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.textContent=String.fromCharCode(this.baseLetter),n.setAttribute("x",i/2),n.setAttribute("y",s/2),n.setAttribute("text-anchor","middle"),n.setAttribute("font-size",s/2),n.setAttribute("font-family","Segoe UI"),n.setAttribute("font-weight",500),t.append(n),this.selection.append(t),t},center(){const t=this.orientation.value,i=this.break.value,s=(0,e.valOrDefault)(this.itemW.value,50),n=(0,e.valOrDefault)(this.itemH.value,50),r=this.nbItem.value;switch(t){case"horizontal":i>0&&r>i?(this.selection.setAttribute("x",200-i*s/2),this.selection.setAttribute("y",200-Math.ceil(r/i)*n/2)):(this.selection.setAttribute("x",200-r*s/2),this.selection.setAttribute("y",200-n/2));break;case"vertical":i>0&&r>i?(this.selection.setAttribute("y",200-i*n/2),this.selection.setAttribute("x",200-Math.ceil(r/i)*s/2)):(this.selection.setAttribute("y",200-r*n/2),this.selection.setAttribute("x",200-s/2))}}},Sn=Object.assign(Object.create(wn),Ln),kn={init(){return this},focusIn(){},focusOut(){},render(){return(0,e.isNullOrUndefined)(this.def)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.def=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.marker=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.marker.setAttribute("orient","auto"),this.marker.setAttribute("markerUnit","strokeWidth"),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="marker",this.container.dataset.id=this.id,this.def.append(this.marker),this.marker.append(this.path),this.container.append(this.def)),this.bindEvents(),this.container},focus(){},updateParams(){(0,e.isNullOrUndefined)(this.idAttr.value)||(this.marker.setAttribute("id",this.idAttr.value),this.user=this.container.parentNode.getElementById("path"+this.container.parentNode.id),this.user.setAttribute("marker-"+(this.schema.start?"start":"end"),"url(#"+this.idAttr.value+")")),(0,e.isNullOrUndefined)(this.minX.value)||(0,e.isNullOrUndefined)(this.minY.value)||(0,e.isNullOrUndefined)(this.width.value)||(0,e.isNullOrUndefined)(this.height.value)||this.marker.setAttribute("viewBox",this.minX.value+" "+this.minY.value+" "+this.width.value+" "+this.height.value),(0,e.isNullOrUndefined)(this.refX.value)||this.marker.setAttribute("refX",this.refX.value),(0,e.isNullOrUndefined)(this.refY.value)||this.marker.setAttribute("refY",this.refY.value),(0,e.isNullOrUndefined)(this.markerWidth.value)||this.marker.setAttribute("markerWidth",this.markerWidth.value),(0,e.isNullOrUndefined)(this.markerHeight.value)||this.marker.setAttribute("markerHeight",this.markerHeight.value),(0,e.isNullOrUndefined)(this.d.value)||this.path.setAttribute("d",this.d.value)},bindEvents(){this.idAttr=this.source.getAttributeByName("id").target,this.idAttr.register(this.projection),this.minX=this.source.getAttributeByName("minX").target,this.minX.register(this.projection),this.minY=this.source.getAttributeByName("minY").target,this.minY.register(this.projection),this.width=this.source.getAttributeByName("width").target,this.width.register(this.projection),this.height=this.source.getAttributeByName("height").target,this.height.register(this.projection),this.refX=this.source.getAttributeByName("refX").target,this.refX.register(this.projection),this.refY=this.source.getAttributeByName("refY").target,this.refY.register(this.projection),this.markerWidth=this.source.getAttributeByName("markerWidth").target,this.markerWidth.register(this.projection),this.markerHeight=this.source.getAttributeByName("markerHeight").target,this.markerHeight.register(this.projection),this.d=this.source.getAttributeByName("d").target,this.d.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateParams()}))}},Tn=Object.assign(Object.create(wn),kn),Mn={init(){return this.width=350,this.height=350,this},render(){return(0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="content",this.container.dataset.id=this.id,this.container.setAttribute("width",300),this.container.setAttribute("height",300),this.holder=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.append(this.holder)),this.bindEvent(),this.container},focusIn(){},focusOut(){},scale(){const e=this.content.width.baseVal.value,t=this.content.height.baseVal.value;let i=Math.max(e,t)/100;this.holder.setAttribute("viewBox","0 0 "+e+" "+t),this.holder.setAttribute("width",e/i),this.holder.setAttribute("height",t/i),this.holder.setAttribute("x",100),this.holder.setAttribute("y",100)},bindEvent(){const t=new DOMParser;this.projection.registerHandler("value.changed",(i=>{(0,e.isNullOrUndefined)(this.content)||this.content.remove(),this.content=t.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.holder.append(this.content),this.scale()})),this.source.hasValue()&&(this.content=t.parseFromString(this.source.value.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.holder.append(this.content),this.scale())}},In=Object.assign(Object.create(wn),Mn),Un={init(){return this.width=350,this.height=350,this},render(){return(0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",400),this.container.setAttribute("height",400),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="pattern",this.container.dataset.id=this.id),(0,e.isNullOrUndefined)(this.visualization)&&(this.visualization=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.visualization.setAttribute("viewBox","0 0 400 400"),this.visualization.setAttribute("width",400),this.visualization.setAttribute("height",400),this.visualization.setAttribute("preserveAspectRatio","xMidYMid meet"),this.container.append(this.visualization)),(0,e.isNullOrUndefined)(this.interaction)&&(this.interaction=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.interaction.setAttribute("viewBox","0 0 400 400"),this.interaction.setAttribute("width",400),this.interaction.setAttribute("height",400),this.container.append(this.interaction)),(0,e.isNullOrUndefined)(this.firstX)&&(this.firstX=this.source.getAttributeByName("first").target.getAttributeByName("x").target,this.firstY=this.source.getAttributeByName("first").target.getAttributeByName("y").target),(0,e.isNullOrUndefined)(this.nextX)&&(this.nextX=this.source.getAttributeByName("next").target.getAttributeByName("x").target,this.nextY=this.source.getAttributeByName("next").target.getAttributeByName("y").target),(0,e.isNullOrUndefined)(this.itemWidth)&&(this.itemWidth=this.source.getAttributeByName("itemWidth").target,this.itemWidthTextual=Yn.call(this,{type:"attribute",name:"itemWidth",tag:"simulation-large"}),this.itemWidthTextual.setAttribute("x",57),this.itemWidthTextual.setAttribute("y",30),this.itemWidthStatic=Yn.call(this,{kind:"static",type:"svg-text",content:"ItemWidth:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.itemWidthStatic.setAttribute("x",56),this.itemWidthStatic.setAttribute("y",30),this.interaction.append(this.itemWidthTextual),this.interaction.append(this.itemWidthStatic)),(0,e.isNullOrUndefined)(this.widthTextual)&&(this.widthAttr=this.source.getAttributeByName("width").target,this.widthTextual=Yn.call(this,{type:"attribute",name:"width",tag:"simulation-large"}),this.widthTextual.setAttribute("x",34),this.widthTextual.setAttribute("y",45),this.widthStatic=Yn.call(this,{kind:"static",type:"svg-text",content:"Width:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.widthStatic.setAttribute("x",33),this.widthStatic.setAttribute("y",45),this.interaction.append(this.widthTextual),this.interaction.append(this.widthStatic)),(0,e.isNullOrUndefined)(this.heightTextual)&&(this.heightAttr=this.source.getAttributeByName("height").target,this.heightTextual=Yn.call(this,{type:"attribute",name:"height",tag:"simulation-large"}),this.heightTextual.setAttribute("x",38),this.heightTextual.setAttribute("y",60),this.heightStatic=Yn.call(this,{kind:"static",type:"svg-text",content:"Height:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.heightStatic.setAttribute("x",37),this.heightStatic.setAttribute("y",60),this.interaction.append(this.heightTextual),this.interaction.append(this.heightStatic)),(0,e.isNullOrUndefined)(this.nbItem)&&(this.nbItem=this.source.getAttributeByName("nbItem").target,this.nbItemText=Yn.call(this,{type:"attribute",name:"nbItem",tag:"simulation-large"}),this.nbItemStatic=Yn.call(this,{kind:"static",type:"svg-text",content:"nbItem:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.nbItemText.setAttribute("x",26),this.nbItemText.setAttribute("y",15),this.nbItemStatic.setAttribute("x",25),this.nbItemStatic.setAttribute("y",15),this.interaction.append(this.nbItemStatic),this.interaction.append(this.nbItemText),this.setUpItems()),this.bindEvents(),this.container},setUpItems(){let e=this.nbItem.value;this.items=[];for(let t=0;t<e;t++){let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("width",this.itemWidth.value),e.setAttribute("height",this.itemWidth.value),e.setAttribute("fill","white"),e.setAttribute("stroke","#738CFF"),e.setAttribute("stroke-width",5),e.setAttribute("x",t*this.nextX.value+this.firstX.value),e.setAttribute("y",t*this.nextY.value+this.firstY.value),this.visualization.append(e),this.items.push(e)}},updateContainer(){(0,e.isNullOrUndefined)(this.widthAttr.value)||(0,e.isNullOrUndefined)(this.heightAttr.value)||this.visualization.setAttribute("viewBox","0 0 "+this.widthAttr.value+" "+this.heightAttr.value)},updateItems(){let t=this.nbItem.value;if(!(0,e.isNullOrUndefined)(t)){if(this.items.length>t){for(let e=t;e<this.items.length;e++)this.items[e].remove();this.items.splice(t,this.items.length-t)}if(this.items.length<t)for(let e=this.items.length;e<t;e++){let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("fill","white"),e.setAttribute("stroke","#738CFF"),e.setAttribute("stroke-width",5),this.visualization.append(e),this.items.push(e)}for(let t=0;t<this.items.length;t++)this.items[t].setAttribute("width",(0,e.valOrDefault)(this.itemWidth.value,50)),this.items[t].setAttribute("height",(0,e.valOrDefault)(this.itemWidth.value,50)),this.items[t].setAttribute("x",t*this.nextX.value+this.firstX.value),this.items[t].setAttribute("y",t*this.nextY.value+this.firstY.value)}},bindEvents(){this.nbItem.register(this.projection),this.firstX.register(this.projection),this.firstY.register(this.projection),this.nextX.register(this.projection),this.nextY.register(this.projection),this.itemWidth.register(this.projection),this.widthAttr.register(this.projection),this.heightAttr.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateContainer(),this.updateItems()}))}},Hn=Object.assign(Object.create(wn),Un),Dn={init(){return this.width=460,this.height=220,this},render(){if((0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,e.isNullOrUndefined)(this.nodes)){this.nodes=[];for(let e=0;e<3;e++){let e=Yn.call(this,{kind:"static",type:"svg",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" width="10" height="10" version="1"><circle r="5" cx="5" cy="5"></circle></svg>'});this.container.append(e),this.nodes.push(e)}this.nodes[0].setAttribute("x",50),this.nodes[0].setAttribute("y",110),this.nodes[1].setAttribute("x",225),this.nodes[1].setAttribute("y",35),this.nodes[2].setAttribute("x",400),this.nodes[2].setAttribute("y",190)}return(0,e.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("stroke","black"),this.path.setAttribute("fill","transparent"),this.container.append(this.path)),this.sp=Yn.call(this,{type:"attribute",name:"sub-paths",tag:"simulation"}),this.container.append(this.sp),this.subPaths=this.projection.resolveElement(this.sp),this.bindEvents(),this.bindStyle(),this.bindSubPath(),this.bindSubStyle(),this.setPath(),this.container},setPath(){let e=this.meet.value;switch(e){case"free":this.path.setAttribute("d","M 55 115 L 230 40 L 405 195");break;case"minX":this.path.setAttribute("d","M 55 40 L 55 195");break;case"maxX":this.path.setAttribute("d","M 405 40 L 405 195");break;case"minY":this.path.setAttribute("d","M 55 40 L 405 40");break;case"maxY":this.path.setAttribute("d","M 55 195 L 405 195")}this.style(),this.subPaths.setPath(e,{x:0,y:0})},bindEvents(){this.meet=this.source.getAttributeByName("meet").target,this.meet.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.setPath()}))},style(){this.path.setAttribute("stroke",this.stroke.value),this.path.setAttribute("stroke-width",this.width.value),this.path.setAttribute("stroke-linecap",this.linecap.value),(0,e.isNullOrUndefined)(this.dasharray.value)||(this.path.style["stroke-dasharray"]=this.dasharray.value)},bindStyle(){const e=this.source.getAttributeByName("arrow-style").target;this.dasharray=e.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.stroke=e.getAttributeByName("stroke").target.getAttributeByName("value").target,this.stroke.register(this.projection),this.width=e.getAttributeByName("width").target,this.width.register(this.projection),this.linecap=e.getAttributeByName("linecap").target,this.linecap.register(this.projection),console.log(this)},bindSubPath(){},bindSubStyle(){}},Vn=Object.assign(Object.create(wn),Dn),Bn={init(){return this.width=460,this.height=220,this},render(){if((0,e.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,e.isNullOrUndefined)(this.paths)){this.paths=[];for(let e=0;e<3;e++){let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("stroke","black"),e.setAttribute("fill","transparent"),console.log(e),this.container.append(e),this.paths.push(e)}}return this.bindEvents(),this.bindStyle(),console.log("Returning this"),console.log(this.container),this.container},setPath(t,i){if((0,e.isNullOrUndefined)(t)||(this.meet=t),(0,e.isNullOrUndefined)(i)||(this.offset=i),"free"===this.meet)return this.paths[0].remove(),this.paths[1].remove(),this.paths[2].remove(),void this.style();switch(this.container.append(this.paths[0]),this.container.append(this.paths[1]),this.container.append(this.paths[2]),this.meet){case"minX":this.paths[0].setAttribute("d","M "+(55+this.offset.x)+" 110 L 60 110"),this.paths[1].setAttribute("d","M "+(55+this.offset.x)+" 40 L 230 40"),this.paths[2].setAttribute("d","M "+(55+this.offset.x)+" 195 L 405 195");break;case"maxX":this.paths[0].setAttribute("d","M "+(405+this.offset.x)+" 110 L 60 110"),this.paths[1].setAttribute("d","M "+(405+this.offset.x)+" 35 L 230 110"),this.paths[2].setAttribute("d","M "+(405+this.offset.x)+" 190 L 405 190");break;case"minY":this.paths[0].setAttribute("d","M 110 "+(35+this.offset.y)+" 110 L 60 110"),this.paths[1].setAttribute("d","M 35 "+(35+this.offset.y)+" 35 L 230 110"),this.paths[2].setAttribute("d","M 190 "+(35+this.offset.y)+" 190 L 405 190");break;case"maxY":this.paths[0].setAttribute("d","M 110 "+(190+this.offset.y)+" 110 L 60 110"),this.paths[1].setAttribute("d","M 35 "+(190+this.offset.y)+" 35 L 230 110"),this.paths[2].setAttribute("d","M 190 "+(190+this.offset.y)+" 190 L 405 190")}this.style()},bindEvents(){this.projection.registerHandler("value.changed",(()=>{this.setPath()}))},style(){for(let t=0;t<3;t++)this.paths[t].setAttribute("stroke",this.stroke.value),this.paths[t].setAttribute("stroke-width",this.width.value),this.paths[t].setAttribute("stroke-linecap",this.linecap.value),(0,e.isNullOrUndefined)(this.dasharray.value)||(this.path.style["stroke-dasharray"]=this.dasharray.value)},bindStyle(){const e=this.source.getAttributeByName("arrow-style").target;this.dasharray=e.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.stroke=e.getAttributeByName("stroke").target.getAttributeByName("value").target,this.stroke.register(this.projection),this.width=e.getAttributeByName("width").target,this.width.register(this.projection),this.linecap=e.getAttributeByName("linecap").target,this.linecap.register(this.projection),console.log(this)}},Pn=Object.assign(Object.create(wn),Bn);var Rn=0;const _n=()=>"algo"+Rn++,$n={force:(e,t,i)=>Object.create(An,{object:{value:"simulation"},name:{value:"force-simulation"},type:{value:"force"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),arrow:(e,t,i)=>Object.create(Nn,{object:{value:"simulation"},name:{value:"arrow-simulation"},type:{value:"arrow"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),text:(e,t,i)=>Object.create(Cn,{object:{value:"simulation"},name:{value:"text-simulation"},type:{value:"text"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),selection:(e,t,i)=>Object.create(Sn,{object:{value:"simulation"},name:{value:"selection-simulation"},type:{value:"selection"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),marker:(e,t,i)=>Object.create(Tn,{object:{value:"simulation"},name:{value:"marker-simulation"},type:{value:"marker"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),content:(e,t,i)=>Object.create(In,{object:{value:"simulation"},name:{value:"content-simulation"},type:{value:"content"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(e,t,i)=>Object.create(Hn,{object:{value:"simulation"},name:{value:"pattern-simulation"},type:{value:"pattern"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),multi:(e,t,i)=>Object.create(Vn,{object:{value:"simulation"},name:{value:"multi-simulation"},type:{value:"multi"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),"sub-path":(e,t,i)=>Object.create(Pn,{object:{value:"simulation"},name:{value:"subPath-simulation"},type:{value:"subPath"},id:{value:_n()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},Fn={createSimulation(t,i,s){console.log(i);const{type:n}=i,r=$n[n];if((0,e.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${n}' simulation could not be handled`);const a=r(t,i,s);if((0,e.isNullOrUndefined)(a))throw new Error(`Bad request: The '${n}' simulation could not be created`);return a.createSimulation=this.createSimulation,(0,e.isNullOrUndefined)(a.id)&&(a.id=_n()),console.log("About to return simu"),console.log(a),a}};function zn(e){return"property"===e.type?this.projection.concept.getProperty(e.name):e}function Wn(i,s,n){const{tag:r,placeholder:a={},style:l,options:o,listen:h}=s;if(!n.hasAttribute(i)){let s=`Attribute '${i}' does not exist in the concept '${n.name}'`;return this.environment.notify(s,t.k$.ERROR),this.environment.addError({source:"projection",code:"attribute_not_found",message:s}),(0,e.createI)({hidden:!0},i)}(0,e.valOrDefault)(s.required,n.isAttributeRequired(i))&&!n.isAttributeCreated(i)&&n.createAttribute(i);const c={name:i,get created(){return n.isAttributeCreated(i)},schema:s,placeholder:(0,e.createI)({class:["projection-element"],hidden:!0},i),parent:this,projection:this.projection,element:null};if(this.projection.attributes.push(c),!c.created){const{content:t}=a;return c.placeholder=t?Yn.call(this,t,n,{focusable:!0}):(0,e.createI)({class:["projection-element","projection-element--placeholder"],tabindex:0,dataset:{object:"attribute",id:i}},`Add ${i}`),c.placeholder.addEventListener("click",(e=>{n.createAttribute(i),this.projection.resolveElement(c.element).focus()})),c.placeholder}{const{target:t,schema:s}=n.getAttributeByName(i);let a=this.projection.model.createProjection(t,r).init(o);if(h&&(a.listen=!0),a.parent=this.projection,a._style=l,c.element=a.render(),(0,e.isNullOrUndefined)(c.element))return(0,e.createI)({hidden:!0},i);a.element.parent=this}return c.element}function qn(t,i){const{value:s,placement:n}=t,{target:r,description:a}=i.getAttributeByName(s);let l=this.projection.model.createProjection(r,n.tag).init();l.parent=this.projection,l.render(),(0,e.isNullOrUndefined)(r.value)||l.element.initValue(r.value),l.element.parent=this;let o=s[0].toUpperCase()+s.substring(1);return l.element.attributeName=o,l.element}function Xn(e,t){let i=this.projection.model.createProjection(t,e).init();return i.parent=this.projection,i.render(),i.element.parent=this,i.element.container}function Yn(t,i,s={}){if(t.kind)return Zn.call(this,t,i,s);const n=(0,e.valOrDefault)(i,this.projection.concept);if("container"===t.type){let e=Ls(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("layout"===t.type){let e=Ar.createLayout(this.model,t.layout,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("field"===t.type){let e=Hi.createField(this.model,t.field,this.projection);return e.parent=this,e.init(s),this.model.registerField(e),e.render()}if("static"===t.type){let e=Es.createStatic(this.model,t.static,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerStatic(e),e.render()}if("algorithm"===t.type){let e=yn.createAlgo(this.model,t.algorithm,this.projection);return e.init(),this.model.registerAlgorithm(e),e.render()}if("simulation"===t.type){let e=Fn.createSimulation(this.model,t.simulation,this.projection);return e.init(),this.model.registerSimulation(e),e.render()}if("dynamic"===t.type)return Yn.call(this,t.dynamic,i,s);if("attribute"===t.type)return Wn.call(this,t.name,t,n);if("svg-attribute"===t.type)return qn.call(this,t,n);if("external"===t.type)return Xn.call(this,t.tag,n);if("g-fragment"===t.type){let e=t.name,i=this.model.getGFragmentSchema(e.toLowerCase());return(new DOMParser).parseFromString(i.content.content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement}if("template"===t.type){let n=t.name;"param"===n.type&&(n=this.projection.getParam(n.name)),console.log(t);let r=this.model.getTemplateSchema(n);r.param&&(t.param&&r.param.forEach((e=>{Object.assign(e,t.param.find((t=>t.name===e.name)))})),this.projection.addParam(r.param));const a=(0,e.createDocFragment)();let l,o=Object.assign({template:r},s),h=!1;return r.content.forEach((e=>{a.append(Yn.call(this,e,i,o))})),h?l:a}if("projection"===t.type){const{tag:i,style:s,src:r,required:a=!1}=t;if(r&&"attribute"===r.type)return Wn.call(this,r.name,t,n);const l={schema:t,placeholder:(0,e.createI)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return l.update=function(t,r,a){if(l.element&&(l.element.remove(),l.element=null),n.hasValue()){let t=n.getValue(!0),r=this.projection.model.createProjection(t,i).init();r.placeholder=l.placeholder,r.parent=this.projection,l.element=r.render(),l.placeholder&&l.placeholder.after(l.element),(0,e.isHTMLElement)(l.element)&&Je.call(this.projection,l.element,s),r.element.parent=this.projection.element,r.update("displayed"),this.projection.update("binding",r.element.container||r.element.element)}},n.register(l),l.update(),l.element||l.placeholder}if("property"===t.type){const{name:e}=t;return this.projection.concept.getProperty(e)}if("html"===t.type){const{html:i}=t;return(0,e.htmlToElement)(i)}if("raw"===t.type){const{raw:e}=t;return e}if("state"===t.type){let e={},n=ft.call(this,e,t.state);return Yn.call(this,n.content,i,s)}throw console.error(t),new TypeError("Bad argument: The type is not recognized")}function Zn(t,i,s={}){const n=(0,e.valOrDefault)(i,this.projection.concept),{kind:r}=t;if("container"===r){let e=Ls(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("layout"===r){let e=Ar.createLayout(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerLayout(e),e.render()}if("field"===r){let e=Hi.createField(this.model,t,this.projection);return e.parent=this,e.init(s),this.model.registerField(e),e.render()}if("static"===r){let e=Es.createStatic(this.model,t,this.projection);return e.source=n,e.parent=this,e.init(s),this.model.registerStatic(e),e.render()}if("attribute"===r||"dynamic"===r)return Wn.call(this,t.name,t,n);if("template"===r){let n=t.name;"param"===n.type&&(n=this.projection.getParam(n.name));let r=this.model.getTemplateSchema(n);r.param&&(t.param&&r.param.forEach((e=>{Object.assign(e,t.param.find((t=>t.name===e.name)))})),this.projection.addParam(r.param));const a=(0,e.createDocFragment)();return r.content.forEach((e=>{a.append(Yn.call(this,e,i,s))})),a}if("projection"===r){const{tag:i,style:s,required:r=!1}=t,a={schema:t,placeholder:(0,e.createI)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return a.update=function(t,r,l){if(a.element&&(a.element.remove(),a.element=null),n.hasValue()){let t=n.getValue(!0),r=this.projection.model.createProjection(t,i).init();r.placeholder=a.placeholder,r.parent=this.projection,a.element=r.render(),a.placeholder&&a.placeholder.after(a.element),(0,e.isHTMLElement)(a.element)&&Je.call(this.projection,a.element,s),r.element.parent=this.projection.element}},n.register(a),a.update(),a.element||a.placeholder}if("property"===r){const{name:e}=t;return this.projection.concept.getProperty(e)}if("html"===r){const{html:i}=t;return(0,e.htmlToElement)(i)}if("raw"===r){const{raw:e}=t;return e}if("state"===r){let e={},n=ft.call(this,e,t.state);return Yn.call(this,n.content,i,s)}throw console.error(t),new TypeError("Bad argument: The type is not recognized")}const Gn={HORIZONTAL:"horizontal",VERTICAL:"vertical"},Jn=[{concept:{name:"stack-layout"},type:"layout",tags:[],projection:{type:"stack",orientation:"vertical",disposition:[{type:"attribute",name:"orientation"}]}}],Kn={orientation:null,args:null,init(e={}){const{orientation:t=Gn.HORIZONTAL,editable:i=!0,focusable:s=!1}=this.schema;return this.orientation=t,this.focusable=s,this.editable=i,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){this.orientation=e,this.refresh()},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["layout-container","stack-layout"],title:s,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let e=0;e<t.length;e++){let i=Yn.call(this,t[e],null,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),n.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Je.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.container.style.display="flex",this.container.style.flexWrap="nowrap",this.refresh(),this.container},design(){return{concept:[{name:"stack-layout",nature:"concrete",attributes:[{name:"orientation",target:{name:"string",default:this.orientation,constraint:{values:["horizontal","vertical"]}}}]}],projection:Jn,handlers:{orientation:(e,t)=>{this.setOrientation(t)}}}},refresh(){return this.orientation===Gn.VERTICAL?this.container.style.flexDirection="column":this.orientation===Gn.HORIZONTAL&&(this.container.style.flexDirection="row"),this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.isNullOrUndefined)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Qn=Object.assign({},As,Kn),er={args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema;return this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["layout-container"],title:s,dataset:{nature:"layout",layout:"wrap",id:this.id}}));for(let e=0;e<t.length;e++){let i=Yn.call(this,t[e],this.source,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),n.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Je.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="inline-flex",this.container.style.alignItems="baseline",this.refresh(),this.container},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.isNullOrUndefined)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},tr=Object.assign({},As,er),ir={elements:null,edit:!1,btnEdit:!1,btnCollapse:!1,menu:!1,collapsed:!1,init(e={}){const{editable:t=!0,collapsible:i=!1,focusable:s=!1}=this.schema;return this.focusable=s,this.collapsible=i,this.editable=t,this.elements=[],this.children=[],Object.assign(this,e),this},collapse(t){if(!this.collapsed)return this.collapseContainer=(0,e.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(t){if(!this.collapsed)return;let i=(0,e.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!0,this.refresh(),this},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"table"}})),this.focusable?this.container.tabIndex=-1:this.container.dataset.ignore="all";for(let i=0;i<t.length;i++){let s=t[i],r=(0,e.createDiv)({class:["table-row"]});r.style.display="table-row";for(let t=0;t<s.length;t++){const i=s[t];let n=(0,e.createDiv)({class:["table-cell"]},Yn.call(this,i.content));n.style.display="table-cell",Je.call(this.projection,n,i.style),r.append(n)}n.append(r)}return Je.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.container.style.display="table",this.refresh(),this.container},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},sr=Object.assign({},As,ir),nr={ROW:"row",COLUMN:"column"},rr={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},ar={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"},lr={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{orientation:t=nr.ROW,wrappable:i=!0,alignItems:s,justifyContent:n,editable:r=!0,focusable:a=!1}=this.schema;return this.orientation=t,this.wrappable=i,this.alignItems=s,this.justifyContent=n,this.focusable=a,this.editable=r,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(t){(0,e.hasOwn)(nr,t)&&(this.orientation=t,this.refresh())},collapse(t=!1){if(!this.collapsed||t)return this.collapseContainer=(0,e.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(t=!1){if(!this.collapsed&&!t)return;let i=(0,e.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:t,style:i,help:s}=this.schema;if(!Array.isArray(t))throw new SyntaxError("Bad disposition");const n=(0,e.createDocFragment)();(0,e.isHTMLElement)(this.container)||(this.container=(0,e.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),s&&(this.container.title=s);for(let e=0;e<t.length;e++){let i=Yn.call(this,t[e],null,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),n.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Je.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=ar[this.justifyContent],this.container.style.alignItems=rr[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(t){if(this.focusable)this.container.focus();else{let t=(0,e.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,e.isNullOrUndefined)(t))return!1;let i=this.environment.resolveElement(t);i&&i.focus(t)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},or=Object.assign({},As,lr),hr={content:"",init(){return this},render(){const t=(0,e.createDocFragment)(),{content:i,attributes:s=[],link:n,dimensions:r={}}=this.schema;var a=new DOMParser;return(0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,class:[],dataset:{nature:"layout",view:"svg",id:this.id}})),this.element.setAttribute("tabIndex",0),this.focusable=!0,!(0,e.isHTMLElement)(this.content)&&i?(this.content=a.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,t.appendChild(this.content)):(0,e.isHTMLElement)(this.content)||(this.content=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.appendChild(this.content)),(0,e.isEmpty)(s)||s.forEach((e=>{let t=Yn.call(this,e.attribute);this.environment.resolveElement(t),e.marker?this.content.querySelector("[data-"+e.marker+"]").append(t):this.content.append(t)})),r.type&&(this.dimensions=r),t.hasChildNodes()&&this.element.appendChild(t),this.element},getWidth(){return Number(this.content.getAttribute("width"))},getHeight(){return Number(this.content.getAttribute("height"))},registerDimObsever(t){(0,e.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(t)},attributeHandler(e,t){switch(e.type){case"interactive":this.content.querySelector("[data-"+t+"]").append(e.content);break;case"text-svg":case"choice":break;default:let i=this.content.querySelector("[data-"+t+"]");e.element.append(e.element);let s=this.createHolder(e.element);i.append(s),this.adapt(e.element,e.ratio)}},createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreign");i.append(e),t.append(i)},adapt(t,i){let s=t.getBoundingClientRect();t.parentNode.setAttribute("width",s.width),t.parentNode.setAttribute("height",s.height);let n=t.parentNode.parentNode;if(!(0,e.isNullOrUndefined)(i)){let e=this.content.width.baseVal.value;this.content.height.baseVal.value,n.setAttribute("width",e*i),n.setAttribute("height",e*i)}},_attributeHandler(t){let i=[];return t.forEach((t=>{switch(t.placement.type){case"in-place":let s=this.content.querySelector("[data-"+t.placement.marker+"]");t.type="svg-attribute";let n=Yn.call(this,t,null,this.args);(0,e.isNullOrUndefined)(t.property)||(n.property=propertyHandler(t.property)),i.push(n),s.appendChild(n.content);break;case"link-place":let{type:r,sd:a=[],dd:l=[]}=t.placement;(0,e.isNullOrUndefined)(this.linkAttr)&&(this.linkAttr=[]);let o={};o.name=t.value,o.field=this.informations.get(t.value),"list"===o.field.type?o.value=o.field.items:o.value=o.field.value,(0,e.isNullOrUndefined)(t.property)||(o.property=propertyHandler(t.property)),(0,e.isEmpty)(a)||(o.sd=new Map,a.forEach((e=>{e.type="template";const t={};var i=Yn.call(this,e,null,this.args);t.render=i,t.parent=this.content.querySelector("[data-"+e.marker+"]"),o.sd.set(i.mv,t)}))),!(0,e.isNullOrUndefined)(this.dd)||(0,e.isEmpty)(l)||(0,e.isNullOrUndefined)(l)||(o.dd=[],l.forEach((t=>{t.type="template";var i=Yn.call(this,t,null,this.args);o.dd.push(i),i.property=o.property;var s=this.content.querySelector("[data-"+t.marker+"]");(0,e.isNullOrUndefined)(s)?"before"===this.content.getAttribute("data-"+t.marker)?this.content.prepend(i.content):this.content.appendChild(i.content):"before"===s.getAttribute("data-"+t.marker)?s.prepend(i.content):s.appendChild(i.content)}))),this.linkAttr.push(o)}})),i},update(){(0,e.isNullOrUndefined)(this.linkAttr)||this.linkAttr.forEach((t=>{this.clearStatics(t.sd,t.value),(0,e.isNullOrUndefined)(t.property)?this.clearDynamics(t.dd,t.value):this.clearDynamics(t.dd,this.translateProperty(t.value,t.property)),"list"===t.field.type?t.value=t.field.items:t.value=t.field.value,(0,e.isNullOrUndefined)(t.property)?this.updateDynamics(t.dd,t.value):this.updateDynamics(t.dd,this.translateProperty(t.value,t.property)),this.updateStatics(t.sd,t.value)})),(0,e.isNullOrUndefined)(this.deciders)||(0,e.isEmpty)(this.deciders)||this.deciders.forEach((e=>{e.update(e.field.value)}))},clearDynamics(t,i){(0,e.isNullOrUndefined)(t)||t.forEach((e=>{e.clear(i)}))},updateDynamics(t,i){(0,e.isNullOrUndefined)(t)||t.forEach((e=>{e.update(i)}))},clearStatics(t,i){if(!(0,e.isNullOrUndefined)(t)){let s=t.get(i);(0,e.isNullOrUndefined)(s)||s.parent.removeChild(s.render.content)}},updateStatics(t,i){if(!(0,e.isNullOrUndefined)(t)){let s=t.get(i);(0,e.isNullOrUndefined)(s)||s.parent.appendChild(s.render.content)}},focus(){return this.element.focus(),this.focused=!0,(0,e.isNullOrUndefined)(this.deciders)||this.deciders.forEach((e=>{e.focusOut()})),this},focusIn(){return this.focus(),this},focusOut(){return this.focused=!1,this},arrowHandler(t,i){if(i===this.element)return!(0,e.isNullOrUndefined)(this.parent)&&this.parent.arrowHandler(t,this.element);let s=getClosestSVG(i.foreign,t,this,!1);return!(0,e.isNullOrUndefined)(s)&&(i.focusOut(),s.focus(),!0)},enterHandler(e){this.index=0,this.deciders[0].focusIn()},escapeHandler(t){if(t!==this.element)return this.focus();let i=(0,e.findAncestor)(t,(e=>0===e.tabIndex)),s=this.environment.resolveElement(i);return s&&s.focus(i),!1},getDimensions(){switch(this.dimensions.type){case"absolute":return{height:this.dimensions.height,width:this.dimensions.width}}},setIndex(e){let t=0;this.deciders.forEach((i=>{i.id!==e.id?t++:this.index=t}))}},cr=Object.assign(Object.create(As),hr);function dr(t){const{placeholder:i="",type:s}=t;let n=zn.call(this,i);return this.readonly||this.resizable?(0,e.createSpan)({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:n,dataset:{placeholder:n,nature:"field-component",view:this.type,id:this.id}}):this.multiline?(0,e.createTextArea)({class:["field--textbox__input"],placeholder:n,title:n,dataset:{nature:"field-component",view:this.type,id:this.id}}):(0,e.createInput)({class:["field--textbox__input"],type:(0,e.valOrDefault)(s,"text"),placeholder:n,title:n,dataset:{nature:"field-component",view:this.type,id:this.id}})}const ur={init(){return this},render(){const t=(0,e.createDocFragment)(),{current:i={},root:s}=this.schema;this.isRoot=s;var n=new DOMParser;if((0,e.isHTMLElement)(this.element)||(this.element=(0,e.createDiv)({id:this.id,dataset:{nature:"layout",view:"visualizer",id:this.id}})),!(0,e.isHTMLElement)(this.content)&&(this.svg=this.source.value,!(0,e.isNullOrUndefined)(this.svg))){if(this.content=n.parseFromString(this.svg.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,"svg"!==this.content.tagName){let e=n.parseFromString('<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"/>',"image/svg+xml").documentElement;e.appendChild(this.content),this.content=e}t.appendChild(this.content)}if(!(0,e.isHTMLElement)(this.input)){const{placeholder:e="",type:s,style:n}=i;this.input=dr.call(this,i),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Je.call(this,this.input,n),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),t.append(this.input)}if(s&&(0,e.isNullOrUndefined)(this.buttons)){this.buttons=[];const e={type:"static",static:{type:"button",trigger:"make interactive",content:[{type:"static",static:{type:"text",content:"Interactive",focusable:!0}}]}};this.mkeInteractive=Yn.call(this,e,null,this.args);let i=this.environment.resolveElement(this.mkeInteractive);i.parent=this,i.visualizer=this,this.buttons.push(i),t.append(this.mkeInteractive);const s={type:"static",static:{type:"button",trigger:"make dynamic",content:[{type:"static",static:{type:"text",content:"Dynamic",focusable:!0}}]}};this.mkeDynamic=Yn.call(this,s,null,this.args),i=this.environment.resolveElement(this.mkeDynamic),i.visualizer=this,i.parent=this,this.buttons.push(i),t.append(this.mkeDynamic);const n={type:"static",static:{type:"button",trigger:"make static",content:[{type:"static",static:{type:"text",content:"Static",focusable:!0}}]}};this.mkeStatic=Yn.call(this,n,null,this.args),i=this.environment.resolveElement(this.mkeStatic),i.visualizer=this,i.parent=this,this.buttons.push(i),t.append(this.mkeStatic)}return t.hasChildNodes()&&this.element.appendChild(t),this.bindEvent(),this.element},focusIn(e){return this.input.focus()},focusOut(){},createProj(){let e=this.current;"tspan"===e.tagName.toLowerCase()&&(e=e.parentNode);let t=new XMLSerializer;return this.cleanInput(),this.updateInput(t.serializeToString(this.content)),'<g xmlns="http://www.w3.org/2000/svg">'+t.serializeToString(e)+"</g>"},cleanInput(){this.input.value="",this.current.parentNode.removeChild(this.current)},updateInput(e){this.source.setValue(e)},bindEvent(){this.content.addEventListener("click",(e=>{var t=new XMLSerializer;let i=e.target;"tspan"===i.tagName.toLowerCase()&&(i=i.parentNode);var s=t.serializeToString(i);this.input.value=s,this.current=i})),this.input.addEventListener("keydown",(t=>{if(""!==this.input.value&&!(0,e.isNullOrUndefined)(this.current)&&"Enter"===t.key){var i=(new DOMParser).parseFromString(this.input.value.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement;this.current!==this.content?this.current.replaceWith(i):this.content=i,this.current=i;var s=new XMLSerializer;this.isRoot?this.updateInput(s.serializeToString(this.content)):this.updateInput(s.serializeToString(this.content.childNodes[0]))}}))}},mr=Object.assign(Object.create(As),ur),{createDocFragment:pr,isNullOrUndefined:fr,isEmpty:gr,isHTMLElement:vr}=s(835),br={init(){const{coordinates:e=null,dimensions:t=null}=this.schema;return this.coordinates=e,this.dimensions=t,this},render(){const{content:e}=this.schema,t=pr();return fr(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("layout-container"),this.container.dataset.nature="layout",this.container.dataset.layout="holder",this.container.dataset.id=this.id),fr(this.foreign)&&(this.foreign=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),t.append(this.foreign)),fr(this.content)&&!gr(e)&&(this.content=new Map,e.forEach((e=>{switch(e.type){case"projection":let t=this.projection.model.createProjection(this.projection.concept.getValue(!0),e.tag).init().render(),i=this.projection.resolveElement(t);this.element=t,this.foreign.append(t),this.content.set(e.correspondance,{render:t,projection:i});break;case"attribute":this.container.append(Yn.call(this,e))}}))),t.hasChildNodes()&&this.container.append(t),this.bindEvents(),this.container},registerRelative(e){switch(this.apply=e.apply,this.relative=!0,e.listen.type){case"duo":this.from=this.source.getValue(!0).getAttributeByName(e.listen.from).target,this.from.register(this.projection),this.to=this.source.getValue(!0).getAttributeByName(e.listen.to).target,this.to.register(this.projection),this.rtag=this.environment.getActiveReceiver(e.rtag)}},adapt(){},getDimensions(){return{width:this.dimensions.width,height:this.dimensions.height}},placeItem(e){switch(this.coordinates.type){case"delegate":this.container.setAttribute("x",e.schema.coordinates.x),this.container.setAttribute("y",e.schema.coordinates.y)}},setDimensions(){if(this.relative){let e=this.rtag.container.querySelector('[data-concept="'+this.from.value+'"]'),t=this.rtag.container.querySelector('[data-concept="'+this.to.value+'"]'),i=this.rtag.container.createSVGPoint(),s=e.getBoundingClientRect();i.x=s.x,i.y=s.y;let n=i.matrixTransform(this.rtag.container.getScreenCTM().inverse());s=t.getBoundingClientRect(),i.x=s.x,i.y=s.y;let r=i.matrixTransform(this.rtag.container.getScreenCTM().inverse()),a=n.x-r.x,l=n.y-r.y,o=Math.sqrt(a*a+l+l);this.width=o,this.container.setAttribute("width",this.width),this.container.setAttribute("height",30),this.foreign.setAttribute("width",this.width),this.foreign.setAttribute("height",30),this.container.setAttribute("x",n.x),this.container.setAttribute("y",n.y),this.projection.resolveElement(this.element).setDimensions(this.width)}else this.adapt(),this.parent.notify(this.container)},setHolder(e,t){this.container.setAttribute("width",e),fr(t)?this.container.setAttribute("height",e*this.height/this.width):this.container.setAttribute("height",t)},bindEvents(){this.projection.registerHandler("value.changed",(e=>{})),this.projection.registerHandler("displayed",(e=>{let{render:t,projection:i}=this.content.get(this.source.value);this.element=t,this.foreign.append(this.element),this.setDimensions(),this.coordinates&&this.placeItem(i)}))}},yr=Object.assign(Object.create(As),br);var wr=0;const xr=()=>"layout"+wr++,Er={stack:(e,t,i)=>Object.create(Qn,{object:{value:"layout"},name:{value:"stack-layout"},type:{value:"stack"},id:{value:xr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),wrap:(e,t,i)=>Object.create(tr,{object:{value:"layout"},name:{value:"wrap-layout"},type:{value:"wrap"},id:{value:xr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),table:(e,t,i)=>Object.create(sr,{object:{value:"layout"},name:{value:"table-layout"},type:{value:"table"},id:{value:xr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),flex:(e,t,i)=>Object.create(or,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:xr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),svg:(e,t,i)=>Object.create(cr,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:xr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),visualizer:(e,t,i)=>Object.create(mr,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:xr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(e,t,i)=>Object.create(yr,{object:{value:"layout"},name:{value:"holder-layout"},type:{value:"holder"},id:{value:xr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},Ar={createLayout(t,i,s){const{type:n}=i,r=Er[n];if((0,e.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${n}' layout could not be handled`);const a=r(t,i,s);if((0,e.isNullOrUndefined)(a))throw new Error(`Bad request: The '${n}' layout could not be created`);return a.createLayout=this.createLayout,(0,e.isNullOrUndefined)(a.id)&&(a.id=xr()),a}},Or={stylePath(t){const{stroke:i="black",dasharray:s=null,width:n=1,linecap:r="butt",end:a=!1,start:l=!1}=t;this.path.style.stroke=i,(0,e.isNullOrUndefined)(s)||(this.path.style["stroke-dasharray"]=s),this.path.style["stroke-width"]=(0,e.valOrDefault)(n,5),this.path.style["stroke-linecap"]=r,a&&this.createMarkerEnd()},styleSubPath(t,i){const{stroke:s="black",dasharray:n=null,width:r=1,linecap:a="butt",end:l=!1,start:o=!1}=t;i.style.stroke=s,(0,e.isNullOrUndefined)(n)||(i.style["stroke-dasharray"]=n),i.style["stroke-width"]=(0,e.valOrDefault)(r,5),i.style["stroke-linecap"]=a},createMarkerEnd(){(0,e.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.end=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.end.id="marker"+this.id,this.end.setAttribute("refY",5),this.end.setAttribute("refX",10),this.end.setAttribute("markerUnit","strokeWidth"),this.end.setAttribute("markerWidth",10),this.end.setAttribute("markerHeight",10),this.end.setAttribute("orient","auto"),this.end.classList.add("end");let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t.setAttribute("fill","black"),this.end.appendChild(t),this.definitions.appendChild(this.end),this.path.setAttribute("marker-end","url(#"+this.end.id+")")},setPath(e){this.path.setAttribute("d",e)}},Nr={init(){return this},render(){const{aiming:t,model:i,move:s,decorator:n=!1,style:r}=this.schema;return(0,e.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="anchor",this.path.dataset.id=this.id),(0,e.isNullOrUndefined)(this.aiming)&&(this.aiming=this.source.getAttributeByName(t.name).target),(0,e.isNullOrUndefined)(this.anchorModel)&&(this.anchorModel=i,Kt.AnchorHandler.registerListener(i,this)),s&&(this.movingPiece=this.source.getAttributeByName(s.name).target,this.movingPiece.register(this)),n&&(0,e.isNullOrUndefined)(this.decorator)&&this.createDecorator(n),this.bind=this.projection.bind,this.bindEvents(),this.stylePath(r),this.path},update(){if(!(0,e.isNullOrUndefined)(this.movingPiece)&&this.movingPiece.hasValue()){let t=this.movingPiece.getValue();(0,e.isString)(t)&&(t=this.movingPiece.getValue(!0)),t.notify("accept",this.bind),(0,e.isNullOrUndefined)(this.path.parenNode)||t.notify("cover",this)}},deleteFromView(){Kt.AnchorHandler.unregister(this.anchorModel,this),this.movingPiece=null,this.path.remove(),this.decorator.remove()},createDecorator(e){this.decorator=Yn.call(this,e.render)},updateValue(){if(!this.aiming.hasValue())return this.path.remove(),this.decorator.remove(),void this.definitions.remove();let t=this.aiming.value.id||this.aiming.value,i=Kt.AnchorHandler.findSource(this.anchorModel,this.bind.element||this.bind.container),s=Kt.AnchorHandler.findTarget(this.anchorModel,t,i.index);if(this.schema.offset&&(i.x+=this.schema.offset.x,i.y+=this.schema.offset.y,s.x+=this.schema.offset.x,s.y+=this.schema.offset.y),this.decorator){const{origin:e,x:t,y:n}=this.schema.decorator.coordinates;switch(e){case"source":this.decorator.setAttribute("x",i.x+t),this.decorator.setAttribute("y",i.y+n),this.projection.parent.container.append(this.decorator);break;case"target":this.decorator.setAttribute("x",s.x+t),this.decorator.setAttribute("y",s.y+n),this.projection.parent.container.append(this.decorator);break;case"minX":i.x<s.x?(this.decorator.setAttribute("x",i.x+t),this.decorator.setAttribute("y",i.y+n)):(this.decorator.setAttribute("x",s.x+t),this.decorator.setAttribute("y",s.y+n)),this.projection.parent.container.append(this.decorator);break;case"minY":i.y<s.y?(this.decorator.setAttribute("x",i.x+t),this.decorator.setAttribute("y",i.y+n)):(this.decorator.setAttribute("x",s.x+t),this.decorator.setAttribute("y",s.y+n)),this.projection.parent.container.append(this.decorator);break;case"maxX":i.x>s.x?(this.decorator.setAttribute("x",i.x+t),this.decorator.setAttribute("y",i.y+n)):(this.decorator.setAttribute("x",s.x+t),this.decorator.setAttribute("y",s.y+n)),this.projection.parent.container.append(this.decorator);break;case"maxY":i.y>s.y?(this.decorator.setAttribute("x",i.x+t),this.decorator.setAttribute("y",i.y+n)):(this.decorator.setAttribute("x",s.x+t),this.decorator.setAttribute("y",s.y+n)),this.projection.parent.container.append(this.decorator)}}if(i.x===s.x&&i.y===s.y?this.setSelfPath(i):this.setPath("M "+i.x+" "+i.y+" L "+s.x+" "+s.y),this.definitions&&this.projection.parent.container.append(this.definitions),this.projection.parent.container.prepend(this.path),this.decorator&&this.environment.resolveElement(this.decorator).projection.update("displayed"),this.calcS=i.calc,this.calcT=s.calc,this.movingPiece&&this.movingPiece.hasValue()){let t=this.movingPiece.value;(0,e.isString)(t)&&(t=this.movingPiece.getValue(!0)),t.notify("cover",this)}},setSelfPath(e){const t=this.schema.self.points;let i={x:e.x,y:e.y},s="M "+e.x+" "+e.y+" ";for(let e=0;e<t.length;e++){const{x:n,y:r}=t[e];s+=" L "+(i.x+n)+" "+(i.y+r)+" ",i.x+=n,i.y+=r}this.path.setAttribute("d",s),this.path.setAttribute("fill","transparent")},bindEvents(){this.aiming.register(this.projection),this.projection.registerHandler("value.changed",(e=>{this.updateValue(e)}))}},jr=Object.assign({},Or,Nr),Cr={init(){return this},render(){const{style:t,from:i,to:s,decorator:n}=this.schema;return(0,e.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="force",this.path.dataset.id=this.id),(0,e.isNullOrUndefined)(this.from)&&this.registerAttribute(i,!0),(0,e.isNullOrUndefined)(this.to)&&this.registerAttribute(s),t&&this.stylePath(t),n&&(0,e.isNullOrUndefined)(this.decorator)&&(this.decorator=Yn.call(this,n)),this.bindEvents(),this.path},registerAttribute(e,t=!1){const{name:i}=e;t?this.from=this.source.getAttributeByName(i).target:this.to=this.source.getAttributeByName(i).target},updateValue(){this.fromVal=this.from.value,this.toVal=this.to.value,(0,e.isNullOrUndefined)(this.fromVal)||(0,e.isNullOrUndefined)(this.toVal)?(0,e.isNullOrUndefined)(this.path.parentNode)||this.projection.parent.removeArrow(this,-1,this.decorator):this.projection.parent.addArrow(this,this.fromVal,this.toVal,this.decorator)},setPath(e){this.path.setAttribute("d",e)},bindEvents(){this.from.register(this.projection),this.to.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateValue()}))}},Lr=Object.assign({},Or,Cr),Sr={minY:function(e){let t=e[0].y,i=e[0].x,s=e[0].x;for(let n=0;n<e.length;n++){const{x:r,y:a}=e[n];r<i&&(i=r),r>s&&(s=r),a<t&&(t=a)}this.setPath("M "+i+" "+t+" L "+s+" "+t),this.drawSupPath(e,t,!1)}},kr={init(){return this.subPath=[],this.targets=[],this.elements=[],this},render(){const{style:t}=this.schema;return(0,e.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="multi",this.path.dataset.id=this.id),this.bindEvents(),this.stylePath(t),this.path},addTarget(e){this.targets=[],this.elements.forEach((e=>{e.hasValue()&&this.targets.push(e.getValue())})),this.targets.length>1&&(this.drawPath(),this.projection.parent.container.append(this.path),this.subPath.forEach((e=>{this.projection.parent.container.append(e)})))},drawSupPath(t,i,s){(0,e.isEmpty)(this.subPath)||(this.subPath.forEach((e=>{e.remove()})),this.subPath=[]),t.forEach((e=>{if(e.y===i&&!s)return;if(e.x===i&&s)return;let t=document.createElementNS("http://www.w3.org/2000/svg","path");this.path.classList.add("arrow-subpath"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="multi",this.path.dataset.id=this.id,s||t.setAttribute("d","M "+e.x+" "+i+" L "+e.x+" "+e.y),this.styleSubPath(this.schema.subpath.style,t),this.subPath.push(t)}))},drawPath(){const t=this.projection.parent.container;let i=[];for(let s=0;s<this.targets.length;s++){const n=this.targets[s];let r=t.querySelector("[data-concept='"+n+"']"),a=this.projection.resolveElement(r);if((0,e.isNullOrUndefined)(r))return;i.push({item:r,proj:a})}let s=[];for(let n=0;n<i.length;n++){let r=i[n].item.getBoundingClientRect();const a=t.createSVGPoint();a.x=r.x,a.y=r.y;const l=a.matrixTransform(t.getScreenCTM().inverse());(0,e.isNullOrUndefined)(i[n].proj.attachPoint)?s.push({x:l.x,y:l.y}):s.push({x:l.x+i[n].proj.attachPoint.x,y:l.y+i[n].proj.attachPoint.y})}Sr[this.schema.meet].call(this,s)},removeTarget(t){(0,e.isNullOrUndefined)(this.targets)},registerElem(t){(0,e.isNullOrUndefined)(this.elements)&&(this.elements=[]),this.elements.push(t),t.register(this.projection)},unregisterElem(t){for(let e=0;e<this.elements.length;e++)if(this.elements[e]===t){this.elements[e].unregister(this.projection),this.elements.splice(e,1);break}this.elements.length>1?this.addTarget():(this.path.remove(),(0,e.isEmpty)(this.subPath)||this.subPath.forEach((e=>{e.remove()})))},deletePaths(){this.path.remove(),(0,e.isEmpty)(this.subPath)||this.subPath.forEach((e=>{e.remove()}))},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.registerElem(e)})),this.projection.registerHandler("value.removed",(e=>{this.unregisterElem(e)})),this.projection.registerHandler("value.changed",(e=>{this.addTarget(e)}))}},Tr=Object.assign({},Or,kr);var Mr=0;const Ir=()=>"algo"+Mr++,Ur={force:(e,t,i)=>Object.create(Lr,{object:{value:"arrow"},name:{value:"force-arrow"},type:{value:"force"},id:{value:Ir()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),anchor:(e,t,i)=>Object.create(jr,{object:{value:"arrow"},name:{value:"anchor-arrow"},type:{value:"anchor"},id:{value:Ir()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),multi:(e,t,i)=>Object.create(Tr,{object:{value:"arrow"},name:{value:"multi-arrow"},type:{value:"multi"},id:{value:Ir()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},Hr={createArrow(t,i,s){const{type:n}=i,r=Ur[n];if((0,e.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${n}' arrow could not be handled`);const a=r(t,i,s);if((0,e.isNullOrUndefined)(a))throw new Error(`Bad request: The '${n}' arrow could not be created`);return a.createArrow=this.createArrow,(0,e.isNullOrUndefined)(a.id)&&(a.id=Ir()),a}},Dr={},{isNullOrUndefined:Vr,valOrDefault:Br}=s(835),Pr={init(){return this},render(){const{content:e}=this.schema;return Vr(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="canas",this.container.dataset.id=this.id),Vr(e)||e.forEach((e=>{this.container.append(Yn.call(this,e))})),this.w=this.source.getAttributeByName("width").target,this.h=this.source.getAttributeByName("height").target,this.minX=this.source.getAttributeByName("minX").target,this.minY=this.source.getAttributeByName("minY").target,this.windowW=this.source.getAttributeByName("windowW").target,this.windowH=this.source.getAttributeByName("windowH").target,this.container.style.border="solid #87a1ff",this.refresh(),this.bindEvents(),this.container},refresh(){this.container.setAttribute("width",this.w.value),this.container.setAttribute("height",this.h.value);const e=Br(this.windowW.value,this.w.value),t=Br(this.windowH.value,this.h.value);this.container.setAttribute("viewBox",this.minX.value+" "+this.minY.value+" "+e+" "+t)},update(){this.refresh()},bindEvents(){this.w.register(this),this.h.register(this),this.minX.register(this),this.minY.register(this),this.windowW.register(this),this.windowH.register(this),this.container.addEventListener("click",(e=>{const t=e.target,{concept:i=null,nature:s=null,shape:n=null}=t.dataset;Vr(s)||"shape"!==s||"canvas"===n||this.source.getAttributeByName("current").setValue(i)}))},focusIn(){},focusOut(){},clickHandler(e){}},Rr=Object.assign(Object.create(Dr),Pr),{isNullOrUndefined:_r,isEmpty:$r}=s(835),Fr={init(){return this.items=[],this},render(){const{add:e}=this.schema;return _r(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="group",this.container.dataset.id=this.id),e&&(this.addButton=Yn.call(this,{kind:"static",type:"svg-button",action:{type:"CREATE"},content:'<svg style="overflow:visible" xmlns="http://www.w3.org/2000/svg" version="1.0"><text style="dominant-baseline:hanging;" font-family="Segoe UI" font-size="16">+</text></svg>'}),this.container.append(this.addButton)),$r(this.source)||this.reconstruct(),this.bindEvents(),this.container},reconstruct(){let e=this.source.value;for(let t=0;t<e.length;t++){let i=this.projection.environment.conceptModel.getConcept(e[t]).getValue(!0),s=this.model.createProjection(i,"shape");s.parent=this.projection;let n=s.init().render();this.items.push({concept:s.concept,projection:n,centered:!0}),s.concept.register(this.projection),this.container.append(n),this.blur()}},createItem(e){let t=this.model.createProjection(e,"shape");t.parent=this.projection;let i=t.init().render();return this.items.push({concept:t.concept,projection:i,centered:!1}),t.concept.register(this.projection),this.blur(),i},addItem(e){let t=this.createItem(e);this.container.append(t)},removeItem(e){for(let t=0;t<this.items.length;t++)if(this.items[t].concept.id===e.id)return this.items[t].projection.remove(),_r(this.items[t].container)||this.items[t].container.remove(),void this.items.splice(t,1)},update(){for(let e=0;e<this.items.length;e++)this.items[e].centered||this.center(this.items[e]),this.items[e].centered=!0},center(e){const t=e.concept.getValue(!0),i=this.getWindow();switch(t.name){case"circle":t.getAttributeByName("cx").setValue((i.minX+i.vW)/2),t.getAttributeByName("cy").setValue((i.minY+i.vH)/2),t.getAttributeByName("r").setValue(20*i.vW/i.width);break;case"rectangle":const e=40*i.vW/i.width,s=30*i.vH/i.height;t.getAttributeByName("x").setValue((i.minX+i.vW)/2-e/2),t.getAttributeByName("y").setValue((i.minY+i.vH)/2-s/2),t.getAttributeByName("width").setValue(e),t.getAttributeByName("height").setValue(s);break;case"ellipse":const n=40*i.vW/(2*i.width),r=30*i.vH/(2*i.height);t.getAttributeByName("cx").setValue((i.minX+i.vW)/2),t.getAttributeByName("cy").setValue((i.minY+i.vH)/2),t.getAttributeByName("rx").setValue(n),t.getAttributeByName("ry").setValue(r);break;case"polygon":const a=40*i.vW/(2*i.width),l=30*i.vH/(2*i.height),o=(i.minX+i.vW)/2,h=(i.minY+i.vH)/2,c={x:o-a/4,y:h-l/2},d={x:o+a/4,y:h-l/2},u={x:o+a/2,y:h-l/4},m={x:o+a/2,y:h+l/4},p={x:o+a/4,y:h+l/2},f={x:o-a/4,y:h+l/2},g={x:o-a/2,y:h+l/4},v={x:o-a/2,y:h-l/4};t.getAttributeByName("points").setValue(c.x+" "+c.y+", "+d.x+" "+d.y+", "+u.x+" "+u.y+", "+m.x+" "+m.y+", "+p.x+" "+p.y+", "+f.x+" "+f.y+", "+g.x+" "+g.y+", "+v.x+" "+v.y);break;case"path":const b=40*i.vW/(2*i.width),y=(i.vH,i.height,(i.minX+i.vW)/2),w=(i.minY+i.vH)/2;t.getAttributeByName("d").setValue("M "+(y-b/2)+" "+w+" L "+(y+b/2)+" "+w)}let s=this.model.createProjection(t,"shape");s.parent=this.projection;let n=s.init().render();this.container.append(n),e.container=n},focusIn(){},focusOut(){},blur(){},getWindow(){const e=this.container.parentNode,t=e.viewBox.baseVal;return{width:Number(e.getAttribute("width")),height:Number(e.getAttribute("height")),vW:t.width,vH:t.height,minX:t.x,minY:t.y}},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)}))}},zr=Object.assign(Object.create(Dr),Fr),{isNullOrUndefined:Wr}=s(835),qr={init(){return this},render(){return Wr(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="circle",this.element.dataset.id=this.id),this.cx=this.source.getAttributeByName("cx").target,this.cy=this.source.getAttributeByName("cy").target,this.r=this.source.getAttributeByName("r").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("cx",this.cx.value),this.element.setAttribute("cy",this.cy.value),this.element.setAttribute("r",this.r.value)},bindEvents(){this.cx.register(this),this.cy.register(this),this.r.register(this),this.element.addEventListener("click",(()=>{this.source.notify("current.updated",this.source)}))},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.width=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},update(e){this.refresh(),Wr(this.fill.value)||this.element.setAttribute("fill",this.fill.value),Wr(this.stroke.value)||this.element.setAttribute("stroke",this.stroke.value),Wr(this.width.value)||(this.element.style["stroke-width"]=this.width.value),Wr(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},focusIn(){},focusOut(){}},Xr=Object.assign(Object.create(Dr),qr),{isNullOrUndefined:Yr}=s(835),Zr={init(){return this},render(){return Yr(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="group",this.container.dataset.id=this.id),this.bindEvents(),this.container.style.overflow="visible",this.container},bindEvents(){this.projection.registerHandler("value.changed",(e=>{let t=this.model.createProjection(this.source.getValue(!0),"shape");t.parent=this.projection;let i=t.init().render();this.container.append(i)}))}},Gr=Object.assign(Object.create(Dr),Zr),{isNullOrUndefined:Jr}=s(835),Kr={init(){return this},render(){return Jr(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="circle",this.element.dataset.id=this.id),this.x=this.source.getAttributeByName("x").target,this.y=this.source.getAttributeByName("y").target,this.width=this.source.getAttributeByName("width").target,this.height=this.source.getAttributeByName("height").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("x",this.x.value),this.element.setAttribute("y",this.y.value),this.element.setAttribute("height",this.height.value),this.element.setAttribute("width",this.width.value)},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.widthS=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.rx=e.getAttributeByName("rx").target,this.ry=e.getAttributeByName("ry").target,this.fill.register(this),this.stroke.register(this),this.widthS.register(this),this.dash.register(this),this.rx.register(this),this.ry.register(this)},update(e){this.refresh(),Jr(this.fill.value)||this.element.setAttribute("fill",this.fill.value),Jr(this.stroke.value)||(this.element.style.stroke=this.stroke.value),Jr(this.widthS.value)||(this.element.style["stroke-width"]=this.widthS.value),Jr(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value),Jr(this.rx.value)||this.element.setAttribute("rx",this.rx.value),Jr(this.ry.value)||this.element.setAttribute("ry",this.ry.value)},bindEvents(){this.x.register(this),this.y.register(this),this.width.register(this),this.height.register(this)}},Qr=Object.assign(Object.create(Dr),Kr),{isNullOrUndefined:ea}=s(835),ta={init(){return this},render(){return ea(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="ellipse",this.element.dataset.id=this.id),this.cx=this.source.getAttributeByName("cx").target,this.cy=this.source.getAttributeByName("cy").target,this.rx=this.source.getAttributeByName("rx").target,this.ry=this.source.getAttributeByName("ry").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("cx",this.cx.value),this.element.setAttribute("cy",this.cy.value),this.element.setAttribute("ry",this.ry.value),this.element.setAttribute("rx",this.rx.value)},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.width=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},update(e){this.refresh(),ea(this.fill.value)||this.element.setAttribute("fill",this.fill.value),ea(this.stroke.value)||(this.element.style.stroke=this.stroke.value),ea(this.width.value)||(this.element.style["stroke-width"]=this.width.value),ea(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},bindEvents(){this.cx.register(this),this.cy.register(this),this.rx.register(this),this.ry.register(this)}},ia=Object.assign(Object.create(Dr),ta),{isNullOrUndefined:sa}=s(835),na={init(){return this},render(){return sa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","polygon"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="polygon",this.element.dataset.id=this.id),this.points=this.source.getAttributeByName("points").target,this.refresh(),this.bindEvents(),this.element},refresh(){this.element.setAttribute("points",this.points.value)},update(e){this.refresh()},bindEvents(){this.points.register(this)}},ra=Object.assign(Object.create(Dr),na),{isNullOrUndefined:aa}=s(835),la={init(){return this},render(){return aa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","path"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="path",this.element.dataset.id=this.id),this.d=this.source.getAttributeByName("d").target,this.element.style["stroke-width"]=5,this.element.style.stroke="black",this.source.getAttributeByName("style").target.getAttributeByName("s-width").setValue(5),this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("d",this.d.value)},bindEvents(){this.d.register(this)},bindStyle(){},update(e){this.refresh(),aa(this.stroke.value)||this.element.setAttribute("fill",this.fill.value),aa(this.stroke.value)||(this.element.style.stroke=this.stroke.value),aa(this.width.value)||(this.element.style["stroke-width"]=this.width.value),aa(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.width=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},focusIn(){},focusOut(){}},oa=Object.assign(Object.create(Dr),la);var ha=0;const ca=()=>"algo"+ha++,da={canvas:(e,t,i)=>Object.create(Rr,{object:{value:"shape"},name:{value:"canvas-shape"},type:{value:"canvas"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),group:(e,t,i)=>Object.create(zr,{object:{value:"shape"},name:{value:"group-shape"},type:{value:"group"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),circle:(e,t,i)=>Object.create(Xr,{object:{value:"shape"},name:{value:"circle-shape"},type:{value:"circle"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(e,t,i)=>Object.create(Gr,{object:{value:"shape"},name:{value:"holder-shape"},type:{value:"holder"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),rectangle:(e,t,i)=>Object.create(Qr,{object:{value:"shape"},name:{value:"rectangle-shape"},type:{value:"rectangle"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),ellipse:(e,t,i)=>Object.create(ia,{object:{value:"shape"},name:{value:"ellipse-shape"},type:{value:"ellipse"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),polygon:(e,t,i)=>Object.create(ra,{object:{value:"shape"},name:{value:"polygon-shape"},type:{value:"polygon"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),path:(e,t,i)=>Object.create(oa,{object:{value:"shape"},name:{value:"path-shape"},type:{value:"path"},id:{value:ca()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},ua={createShape(t,i,s){const{type:n}=i,r=da[n];if((0,e.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${n}' shape could not be handled`);const a=r(t,i,s);if((0,e.isNullOrUndefined)(a))throw new Error(`Bad request: The '${n}' shape could not be created`);return a.createShape=this.createShape,(0,e.isNullOrUndefined)(a.id)&&(a.id=ca()),a}};var ma=0;const pa={createProjection(t,i,s,n){var r=Object.create(fa,{id:{value:(0,e.valOrDefault)(i.id,"projection"+ma++)},model:{value:t},schema:{value:i,writable:!0},environment:{value:n}});return r.concept=s,r}},fa={handlers:null,init(e={}){return this.containers=new Map,this.attributes=[],this.params=[],this.templates=[],this.handlers={},this.args=e,this.concept.register(this),this},schema:null,concept:null,environment:null,parent:null,containers:null,placeholder:null,element:null,attributes:null,params:null,index:0,editing:!1,optional:!1,collapsible:!1,searchable:!1,focusable:!0,get hasMultipleViews(){return this.schema.length>1},get isReadOnly(){return(0,e.valOrDefault)(this.getSchema().readonly,!1)},isRoot(){return(0,e.isNullOrUndefined)(this.parent)},getSchema(t){return this.schema[(0,e.valOrDefault)(t,this.index)]},hasSchema(e){return-1!==this.schema.findIndex((t=>t.tags.includes(e)))},getContainer(t){return this.containers.get((0,e.valOrDefault)(t,this.index))},getStyle(){const{style:e}=this.getSchema();return e},addTemplate(e){this.templates.push(e)},addParam(e){this.params.push(...Array.isArray(e)?e:[e])},getParam(t,i){let s=this.params.find((e=>e.name===t));if((0,e.isNullOrUndefined)(s))return;const{type:n="string",value:r}=s;let a=(0,e.valOrDefault)(r,s.default);return(0,e.isNullOrUndefined)(a)?null:"string"===n?a.toString():"number"===n?+a:"boolean"===n?(0,e.toBoolean)(a):void 0},getParent(){return this.isRoot()?null:this.parent},getAttributes(e){return this.attributes.filter((t=>t.name===e))},getField(e){return this.environment.getField(e)},getStatic(e){return this.environment.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},resolveElement(e){return this.environment.resolveElement(e)},getHandlers(t){return(0,e.valOrDefault)(this.handlers[t],[])},update(i,s,n){if((0,e.isEmpty)(this.containers))return;if("delete"===i&&n.parent!==this.concept)return void this.delete();const r=this.getHandlers(i);switch((0,e.isEmpty)(r)||r.forEach((e=>{e(s,n)})),i){case"attribute.added":return void this.getAttributes(s.name).forEach((e=>{const{schema:i}=e,n=this.model.createProjection(s.target,i.tag).init();n.parent=this,n.optional=!0;const r=n.render();Je.call(this,r,i.style),n.element.parent=e.parent,e.element=r,e.placeholder&&(e.placeholder.after(r),(0,t.Cp)(e.placeholder))}));case"attribute.removed":return void this.getAttributes(s.name).forEach((i=>{i.element&&((0,e.removeChildren)(i.element).remove(),i.element=null),i.placeholder&&(0,t.$Z)(i.placeholder)}))}},delete(){return this.concept&&this.concept.unregister(this),this.placeholder&&this.getContainer().after(this.placeholder),this.containers.forEach((t=>{if((0,e.removeChildren)(t),(0,e.isHTMLElement)(t)&&t.remove(),"path"===t.tagName){if("force"===t.dataset.algorithm){let e=this.environment.resolveElement(t);e.projection.parent.removeArrow(e)}"anchor"===t.dataset.algorithm&&this.environment.resolveElement(t).deleteFromView(),"multi"===t.dataset.algorithm&&this.environment.resolveElement(t).deletePaths()}["svg","text"].includes(t.tagName)&&t.remove(),this.sibling&&this.sibling.delete()})),this.model.removeProjection(this.id),!0},registerHandler(e,t){return Array.isArray(this.handlers[e])||(this.handlers[e]=[]),this.handlers[e].push(t),!0},unregisterHandler(t,i){if(!(0,e.hasOwn)(this.handlers,t))return!1;for(let e=0;e<this.handlers[t].length;e++)if(this.handlers[t][e]===i)return this.handlers[t].splice(e,1),!0;return!1},focus(){this.element.focus()},render(){const t=this.getSchema();if((0,e.isNullOrUndefined)(t))return null;const{type:i,projection:s,content:n,kind:r,sibling:a,rtag:l,ratio:o}=t;var h=null;if("layout"===i||"layout"===r)this.element=Ar.createLayout(this.model,(0,e.valOrDefault)(s,n),this).init(this.args),this.model.registerLayout(this.element);else if("field"===i||"field"===r){let i=(0,e.hasOwn)(t,"field")?t.field:(0,e.valOrDefault)(s,n);this.element=Hi.createField(this.model,i,this).init(this.args),this.model.registerField(this.element)}else"static"===i||"static"===r?(this.element=Es.createStatic(this.model,(0,e.valOrDefault)(s,n),this).init(this.args),this.element.source=this.concept,this.model.registerStatic(this.element)):"dynamic"===i||"dynamic"===r?(this.element=Es.createStatic(this.model,(0,e.valOrDefault)(s,n),this).init(this.args),this.model.registerStatic(this.element)):"algorithm"===i?(this.element=yn.createAlgo(this.model,(0,e.valOrDefault)(s,n),this).init(this.args),this.model.registerAlgorithm(this.element)):"arrow"===i?(this.element=Hr.createArrow(this.model,(0,e.valOrDefault)(s,n),this).init(this.args),this.model.registerArrow(this.element)):"shape"===i?(this.element=ua.createShape(this.model,(0,e.valOrDefault)(s,n),this).init(this.args),this.model.registerShape(this.element)):"simulation"===i?(this.element=Fn.createSimulation(this.model,(0,e.valOrDefault)(s,n),this).init(this.args),this.model.registerSimulation(this.element)):(this.element=Ls(this.model,t.container,this).init(this.args),this.model.registerLayout(this.element));if(this.isRoot()&&(this.element.focusable=!0),this.focusable||(this.element.focusable=!1),this.readonly&&(this.element.readonly=!0),h=this.element.render(),this.element.focusable||(h.tabIndex=-1),!(0,e.isNode)(h))throw new Error("Projection element container could not be created");if(h.classList.add("projection"),Object.assign(h.dataset,{projection:this.id,concept:this.concept.id,object:this.concept.object}),this.optional)if(this.element.schema.rmv)this.element.createDelete(),h.dataset.deletable=!0;else{let t=(0,e.createButton)({class:["btn","structure__btn-delete","projection__btn-delete"],title:`Delete ${this.concept.name}`,tabindex:-1,dataset:{action:"delete",projection:this.id}});t.addEventListener("click",(t=>{let i=this.getContainer(),s=(0,e.findAncestor)(i,(e=>0===e.tabIndex));this.environment.save(this.concept.getParent(),i.cloneNode(!0)),this.concept.delete();let n=this.environment.resolveElement(s);(0,e.isNullOrUndefined)(n)||n.focus()})),h.dataset.deletable=!0,h.prepend(t)}if(this.collapsible){let t=(0,e.createButton)({class:["btn","projection__btn-collapse"],title:`Collapse ${this.concept.name}`,tabindex:-1,dataset:{action:"collapse",projection:this.id}});t.addEventListener("click",(e=>{this.getContainer().classList.toggle("collapsed")})),h.dataset.collapsible=!0,h.prepend(t)}return this._style&&Je.call(this,h,this._style),this.containers.set(this.index,h),a&&this.createSibling(this.concept,a,this.element),l&&(this.rtag=l,this.environment.registerReceiver(this.element,l)),h},refresh(){this.editing?this.containers.forEach((e=>{e.tabIndex=0})):this.containers.forEach((e=>{e.tabIndex=null}))},createSibling(t,i){const{render:s,params:n=!1,bind:r}=i,{tag:a,rtag:l}=s;if(this.checkForAliveSibling(t.id,a,l))return;let o=this.model.createProjection(t,a).init();r&&(o.bind=this.element);let h=o.render();if(n){const{coordinates:e,dimension:t}=n;h.setAttribute("x",e.x),h.setAttribute("y",e.y)}let c=this.environment.getActiveReceiver(l);o.parent=c,(0,e.isNullOrUndefined)(o.element.path)&&c.container.append(o.element.element||o.element.container),this.sibling=o},checkForAliveSibling(t,i,s){if((0,e.isNullOrUndefined)(this.environment.siblingModel)&&(this.environment.siblingModel=new Map),(0,e.isNullOrUndefined)(this.environment.siblingModel.get(t)))return this.environment.siblingModel.set(t,[{tag:i,rtag:s}]),!1;let n=this.environment.siblingModel.get(t);for(let e=0;e<n.length;e++)if(n[e].rtag===s&&n[e].tag===i)return!0;return n.push([{tag:i,rtag:s}]),this.environment.siblingModel.set(t,n),!1},changeView(t){if(!this.hasMultipleViews)return void this.environment.notify("There is no alternative projection for this concept");let i=this.getContainer();this.index=(0,e.valOrDefault)(t,(this.index+1)%this.schema.length);let s=this.getContainer();(0,e.isHTMLElement)(s)||(this.params=[],s=this.render()),i.replaceWith(s),this.element=this.resolveElement(s),"svg"===this.element.type&&this.element.update();const n=this.getHandlers("view.changed");return(0,e.isEmpty)(n)||n.forEach((e=>e(s))),this.focus(),this},findView(e){if(!this.hasSchema(e)){if(!this.model.hasProjectionSchema(this.concept,e))return-1;let t=this.model.getProjectionSchema(this.concept,e);this.schema.push(...t)}return this.schema.findIndex((t=>t.tags.includes(e)))},export(){return{id:this.id,root:this.isRoot(),concept:{id:this.concept.id,name:this.concept.name}}},bindEvents(){}},ga=[{concept:{name:"set"},type:"field",tags:[],content:{type:"list"}},{concept:{name:"boolean"},type:"field",tags:[],content:{type:"binary"}},{concept:{name:"string"},type:"field",tags:[],content:{type:"text"}},{concept:{name:"number"},type:"field",tags:[],content:{type:"text",input:{type:"number"}}},{concept:{name:"reference"},type:"field",tags:[],content:{type:"choice"}}];function va(t,i){return Object.create(ba,{schema:{value:(0,e.valOrDefault)(t,{projection:[],algorithm:[],template:[],style:[]}),writable:!0},editor:{value:i},environment:{value:i}})}const ba={projections:null,fields:null,statics:null,layouts:null,algos:null,init(e){return this.projections=[],this.fields=new Map,this.statics=new Map,this.layouts=new Map,this.algos=new Map,this.arrows=new Map,this.shapes=new Map,this.simulations=new Map,this},addSchema(e){return Array.isArray(e.projection)&&this.schema.projection.push(...e.projection),Array.isArray(e.template)&&this.schema.template.push(...e.template),Array.isArray(e.style)&&this.schema.style.push(...e.style),this.environment.update("projection-model.updated"),!0},setSchema(e){return this.schema=[...e,...ga],this.environment.update("projection-model.updated"),this},done(){for(;!(0,e.isEmpty)(this.projections);)this.projections[0].delete();return this.projections=[],this.fields.clear(),this.layouts.clear(),this.statics.clear(),this},createProjection(i,s){const n=this.getProjectionSchema(i,s);(0,e.isEmpty)(n)&&this.environment.notify(`Missing projection (#${s}) for ${i.name}`,t.k$.WARNING);const r=pa.createProjection(this,n,i,this.environment);return r.tag=s,this.addProjection(r),r},getProjections(){return this.projections.slice()},getProjection(e){return Number.isInteger(e)?this.projections[e]:this.projections.find((t=>t.id===e))},addProjection(t){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad request: The 'projection' argument must be a Projection");return this.projections.push(t),this},removeProjection(e){var t=this.projections.findIndex((t=>t.id===e));return-1!==t&&(this.projections.splice(t,1),!0)},registerField(e){return e.environment=this.environment,e.editor=this.environment,this.fields.set(e.id,e),this},unregisterField(e){var t=this.fields.get(e.id);return t&&(t.environment=null,this.fields.delete(t.id)),this},getField(e){return this.fields.get(e)},registerStatic(e){return e.environment=this.environment,e.editor=this.environment,this.statics.set(e.id,e),this},unregisterStatic(e){var t=this.statics.get(e.id);return t&&(t.environment=null,this.statics.delete(t.id)),this},getStatic(e){return this.statics.get(e)},registerLayout(e){return e.environment=this.environment,e.editor=this.environment,this.layouts.set(e.id,e),this},unregisterLayout(e){var t=this.layouts.get(e.id);return t&&(t.environment=null,this.layouts.delete(t.id)),this},getLayout(e){return this.layouts.get(e)},registerArrow(e){return e.environment=this.environment,this.arrows.set(e.id,e),this},unregisterArrow(e){var t=this.arrows.get(e.id);return t&&(t.environment=null,this._arrow.delete(t.id)),this},getArrow(e){return this.arrows.get(e)},registerShape(e){return e.environment=this.environment,this.shapes.set(e.id,e),this},registerSimulation(e){return e.environment=this.environment,this.simulations.set(e.id,e),this},unregisterArrow(e){var t=this.shapes.get(e.id);return t&&(t.environment=null,this._shape.delete(t.id)),this},getArrow(e){return this.shapes.get(e)},registerAlgorithm(e){return e.environment=this.environment,this.algos.set(e.id,e),this},unregisterAlgorithm(e){var t=this.algos.get(e.id);return t&&(t.environment=null,this.algos.delete(t.id)),this},getAlgo(e){return this.algos.get(e)},getSimulation(e){return this.simulations.get(e)},getArrow(e){return this.arrows.get(e)},getMetadata(e){let t=this.schema.find((t=>t.id===e));return t?t.metadata:null},hasConceptProjection(t,i){let s=null;return s=(0,e.isString)(t)?this.schema.projection.filter((e=>e.concept.name===t)):this.schema.projection.filter((i=>{return(e=>e&&(e===t.name||t.schema&&e===t.schema.base))(i.concept.name)||(s=i.concept.prototype,!(0,e.isNullOrUndefined)(s)&&"prototype"!==t.nature&&t.hasPrototype(s));var s})),(0,e.isIterable)(i)&&!(0,e.isEmpty)(i)?-1!==s.findIndex((e=>(e=>Array.isArray(e.tags)&&e.tags.includes(i))(e))):!(0,e.isEmpty)(s)},getSchema(){return this.schema},getProjectionSchema(t,i){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad parameter: concept");var s=null;return s=(0,e.isString)(t)?this.schema.projection.filter((e=>e.concept.name===t)):this.schema.projection.filter((i=>{return(e=>e&&(e===t.name||t.schema&&e===t.schema.base))(i.concept.name)||(s=i.concept.prototype,!(0,e.isNullOrUndefined)(s)&&"prototype"!==t.nature&&t.hasPrototype(s));var s})),(0,e.isIterable)(i)&&!(0,e.isEmpty)(i)?s.filter((e=>e.tags&&e.tags.includes(i))):s},getTemplateSchema(i){let s=this.schema.template.find((e=>e.name===i));return(0,e.isNullOrUndefined)(s)?null:(0,t.p$)(s)},getGFragmentSchema(i){let s=this.schema.find((e=>"g-fragment"===e.type&&e.name===i));return(0,e.isNullOrUndefined)(s)?null:(0,t.p$)(s)},getRuleSchema(i){let s=this.schema.find((e=>"rule"===e.type&&e.name===i));return(0,e.isNullOrUndefined)(s)?null:(0,t.p$)(s)},getStyleSchema(i){let s=this.schema.style.find((e=>e.name===i));return(0,e.isNullOrUndefined)(s)?null:(0,t.p$)(s)},hasProjectionSchema(t,i){if((0,e.isNullOrUndefined)(t))throw new TypeError("Bad parameter: concept");let s=[];return s=(0,e.isString)(t)?this.schema.projection.filter((e=>e.concept.name===t)):this.schema.projection.filter((i=>{return(e=>e&&(e===t.name||t.schema&&e===t.schema.base))(i.concept.name)||(s=i.concept.prototype,!(0,e.isNullOrUndefined)(s)&&"prototype"!==t.nature&&t.hasPrototype&&t.hasPrototype(s));var s})),(0,e.isIterable)(i)&&!(0,e.isEmpty)(i)?s.some((e=>e.tags&&e.tags.includes(i))):!(0,e.isEmpty)(s)},export(){const e=[];return this.getProjections().forEach((t=>{e.push(t.export())})),e}},ya={unloadAllConcept(){return this.hasConceptModel&&(this.conceptModel.done(),this.conceptModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-concept@post"}),this},unloadAllProjection(){return this.hasProjectionModel&&(this.projectionModel.done(),this.projectionModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-projection@post"}),this},loadSession(){this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)}))},loadConcept(i,s){let n=i.concept||i,r=i.values;return Array.isArray(n)?(0,e.isEmpty)(n)?(this.notify("The concept schema is empty",t.k$.ERROR),!1):((0,e.isNullOrUndefined)(this.conceptModel)&&(this.conceptModel=Xe.createModel(null,this).init()),this.conceptModel.addConceptSchema(n),this.conceptModel.init(r),this.triggerEvent({name:"editor.load-concept@post",args:[s,JSON.stringify(i)]}),this.refresh(),this):(this.notify("Invalid concept schema",t.k$.ERROR),!1)},loadValues(t,i){let s=t;if(!(0,e.isNullOrUndefined)(this.conceptModel))return this.conceptModel.initValue(s),this.loadSession(),this.triggerEvent({name:"editor.load-values@post",args:[i,JSON.stringify(s)]}),this.refresh(),this;console.error("concept model not found")},loadConcepts(i){return Array.isArray(i)?(0,e.isEmpty)(i)?(this.notify("The concept schema is empty",t.k$.ERROR),!1):((0,e.isNullOrUndefined)(this.conceptModel)&&(this.conceptModel=Xe.createModel(null,this).init()),i.forEach((e=>{this.conceptModel.addConceptSchema(e)})),this.refresh(),this):(this.notify("Invalid concept schema",t.k$.ERROR),!1)},loadProjection(t,i){return this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,(0,e.isNullOrUndefined)(this.projectionModel)&&(this.projectionModel=va(t,this).init()),this.projectionModel.addSchema(t),(0,e.isNullOrUndefined)(this.projectionModel),this.instances.forEach((e=>{e.projection=this.projectionModel.createProjection(e.concept).init(),e.render()})),this.triggerEvent({name:"editor.load-projection@post",args:[i,JSON.stringify(t)]}),this.refresh(),this},loadProjections(i){return Array.isArray(i)?(0,e.isEmpty)(i)?(this.notify("The concept schema is empty",t.k$.ERROR),!1):(this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,(0,e.isNullOrUndefined)(this.projectionModel)&&(this.projectionModel=va(null,this).init()),i.forEach((e=>{this.projectionModel.addSchema(e)})),this.refresh(),this):(this.notify("Invalid concept schema",t.k$.ERROR),!1)},load(i,s){let n=i.type;if((0,e.isNullOrWhitespace)(n)){let e=i.name.indexOf(".")+1;n=i.name.substring(e)}else n=t.D3[n];"jsoncp"===n&&"json"===n||this.addResource(i,s);let r=new FileReader;return r.onload=e=>{const t=JSON.parse(r.result),{type:i}=t;"concept"===i?this.loadConcept(t,s):"projection"===i?this.loadProjection(t,s):"model"===i&&(this.loadConcept(t.concept,"model"),this.loadValues(t.values))},r.readAsText(i),!0},unload(){return this.unloadAllConcept(),this.unloadAllProjection(),this.clear(),this}},wa={getField(t){if(!(0,e.isHTMLElement)(t)&&"path"!==t.tagName&&"text"!==t.tagName&&"svg"!==t.tagName)return console.warn("Field error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.isNullOrUndefined)(i)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(s)?this.projectionModel.getField(i):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(t){if(!(0,e.isHTMLElement)(t)&&"svg"!==t.tagName)return console.warn("Static error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.isNullOrUndefined)(i)?(console.warn("Static error: Missing id attribute on field"),null):["static","static-component"].includes(s)?this.projectionModel.getStatic(i):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(t){if(!(0,e.isHTMLElement)(t)&&"svg"!==t.tagName)return console.warn("Layout error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.isNullOrUndefined)(i)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(s)?this.projectionModel.getLayout(i):(console.warn("Layout error: Unknown nature attribute on field"),null)},getAlgo(t){if(!(0,e.isHTMLElement)(t)&&"svg"!==t.tagName&&"text"!==t.tagName)return console.warn("Algo error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.isNullOrUndefined)(i)?(console.warn("Algo error: Missing id attribute on field"),null):["algorithm"].includes(s)?this.projectionModel.getAlgo(i):(console.warn("algo error: Unknown nature attribute on field"),null)},getSimulation(t){if(!(0,e.isHTMLElement)(t)&&"svg"!==t.tagName&&"text"!==t.tagName)return console.warn("Simulation error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.isNullOrUndefined)(i)?(console.warn("Simulation error: Missing id attribute on Simulation"),null):["simulation"].includes(s)?this.projectionModel.getSimulation(i):(console.warn("Simulation error: Unknown nature attribute on Simulation"),null)},getArrow(t){if("path"!==t.tagName)return console.warn("Arrow error: Bad argument"),null;const{id:i,nature:s}=t.dataset;return(0,e.isNullOrUndefined)(i)?(console.warn("Arrow error: Missing id attribute on field"),null):["arrow","arrow-path"].includes(s)?this.projectionModel.getArrow(i):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(t){if(t instanceof SVGElement){let i=t;for(;!(0,e.isNullOrUndefined)(i.parentNode)&&(0,e.isNullOrUndefined)(i.dataset);)i=i.parentNode;(0,e.isNullOrUndefined)(i.dataset.nature)||(t=i)}if(!(0,e.isHTMLElement)(t)&&"path"!==t.tagName&&"svg"!==t.tagName&&"text"!==t.tagName)return null;const{nature:i}=t.dataset;if((0,e.isNullOrUndefined)(i))return null;let s=null;switch(i){case"field":case"field-component":s=this.getField(t);break;case"layout":case"layout-component":s=this.getLayout(t);break;case"static":case"static-component":s=this.getStatic(t);break;case"algorithm":s=this.getAlgo(t);break;case"simulation":s=this.getSimulation(t);break;case"arrow":s=this.getArrow(t)}return s&&(s.environment=this),s}};var xa=0;const Ea={createState(t,i){const{id:s,name:n}=t;let r="value"+xa++,a=JSON.stringify(t.clone()),l=((0,e.formatDate)(new Date,"hh:dd"),(0,e.createI)({class:["ico","ico-delete"]},"✖")),o=(0,e.createButton)({class:["btn","btn-delete"],title:`Delete ${n} state`},l),h=(0,e.createDiv)({class:["model-state-preview"],title:`Preview ${n}`},i),c=(0,e.createSpan)({class:["model-state-content","fit-content"]},`${t.getName()}`),d=(0,e.createListItem)({class:["model-state"],title:`Restore ${n} state`,dataset:{id:r,concept:s}},[o,c,h]);d.addEventListener("click",(t=>{let i=function(t){const i=e=>e===d||e===o;return i(t)?t:(0,e.findAncestor)(t,(e=>i(e)),5)}(t.target);if(this.unhighlight(),i===o)this.removeState(r);else{let t=this.restore(a);this.removeState(r);let i=(0,e.getElement)(`.projection[data-concept="${t.id}"]`,this.body);i&&i.focus()}}));let u=`.projection[data-concept="${s}"]`;if(d.addEventListener("mouseenter",(t=>{let i=(0,e.getElement)(u,this.body);i&&this.highlight(i)})),d.addEventListener("mouseleave",(e=>{this.unhighlight()})),this.states.length>8){let{id:e}=this.stateList.lastChild.dataset;this.removeValue(e)}let m=Object.create({},{id:{value:r},object:{value:"value"},type:{value:"state"},element:{value:d},concept:{value:t},value:{value:a}});return this.addState(m),m},getState(t){if(!(0,e.isNullOrUndefined)(t)&&!(0,e.isEmpty)(this.states))return this.states[t]},addState(e){return this.stateList.append(e.element),this.states.push(e),this.refresh(),e},removeState(t){if((0,e.isNullOrUndefined)(t))return;const i=this.states.findIndex((e=>e.id===t));if(-1===i)return null;let s=this.states.splice(i,1)[0],{element:n}=s;return(0,e.removeChildren)(n).remove(),this.refresh(),this}};var Aa=0;const Oa={conceptModel:null,projectionModel:null,concept:null,activeConcept:null,activeProjection:null,activeReceiver:null,activeInstance:null,container:null,header:null,body:null,instanceSection:null,designSection:null,navigationSection:null,valueWindow:null,valueList:null,breadcrumb:null,filter:null,home:null,exporter:null,style:null,logs:null,status:null,group:null,input:null,copyValue:null,states:null,activeElement:null,decoratedElements:null,config:null,active:!1,visible:!1,frozen:!1,handlers:null,actions:null,attached:null,instances:null,windows:null,values:null,resources:null,models:null,errors:null,init(e={}){const{conceptModel:t,projectionModel:i,toolbar:s=[],config:n={},handlers:r={},actions:a={}}=e;this.config=Object.assign({},n),this.handlers=new Map,this.actions=new Map,this.attached=[],this.instances=new Map,this.windows=new Map,this.values=new Map,this.resources=new Map,this.models=new Map,this.errors=[],Object.assign(this,C,k),this.states=[],this.decoratedElements=new Set;for(const e in r){const t=r[e];this.registerHandler(e,t)}return this.header=H.call(this).init(),this.home=V.call(this).init(),this.breadcrumb=D.call(this).init(),this.logs=P.call(this).init(),this.status=B.call(this).init(),this.exporter=R.call(this).init(),this.render(),Array.isArray(t)?this.loadConcepts(t):t&&this.loadConcept(t),Array.isArray(i)?this.loadProjections(i):i&&this.loadProjection(i),this.isReady?(this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)})),this.open()):(this.home.open(),this.refresh()),this},setConfig(t){return!(0,e.isNullOrUndefined)(t)&&(this.config=t,this.refresh(),this)},getConfig(t){return(0,e.isNullOrUndefined)(t)?this.config:this.config[t]},getName(){return(0,e.valOrDefault)(this.config.name,`editor${(new Date).getTime()}`)},createConcept(i){if((0,e.isNullOrUndefined)(i))throw new TypeError("Missing argument: The 'name' is required to create a concept");return this.conceptModel.isConcept(i)?this.conceptModel.createConcept(i):(this.notify(`The concept '${i}' is not defined in the model`,t.k$.ERROR),!1)},addConcept(e){let t=e.concept||e;Array.isArray(t)?this.conceptModel.schema.push(...t):this.conceptModel.schema.push(t),this.refresh()},createProjection(i,s){if((0,e.isNullOrUndefined)(i))throw new TypeError("Missing argument: The 'concept' is required to create a projection");return this.projectionModel.hasConceptProjection(i,s)?this.projectionModel.createProjection(i,s).init():(this.notify(`The projection for the concept '${i.name}' is not defined in the model`,t.k$.ERROR),!1)},addProjection(e){Array.isArray(e)?this.projectionModel.schema.projection.push(...e):this.projectionModel.addSchema(e),this.refresh()},download(i,s,n){const r=t.n_[n.toUpperCase()].type;window.URL=window.webkitURL||window.URL;var a=(0,e.createAnchor)({class:["bare-link","download-item__link"]},"Download");(0,e.isNullOrWhitespace)(a.href)||window.URL.revokeObjectURL(a.href);var l=new Blob([i],{type:r});return Object.assign(a,{download:s,href:window.URL.createObjectURL(l)}),a.dataset.downloadurl=[r,a.download,a.href].join(":"),a.click(),setTimeout((()=>{window.URL.revokeObjectURL(a.href),a.remove()}),1500),i},save(t,i){(0,e.isNullOrUndefined)(t)||(this.createState(t,i),this.refresh())},restore(e){let t=JSON.parse(e),i=this.conceptModel.getConcept(t.id);return i.restore(t),this.refresh(),i},undo(){if((0,e.isEmpty)(this.states))return void this.notify("There are no previous state",t.k$.NORMAL,2e3);let i=(0,e.last)(this.states);this.restore(i.value),this.removeState(i.id)},notify(t,i,s=4500){let n=(0,e.createParagraph)({class:["notify"],html:t});const r="open";i&&n.classList.add(i),this.container.append(n),setTimeout((()=>{n.classList.add(r)}),50),setTimeout((()=>{n.classList.remove(r),setTimeout((()=>{n.remove()}),500)}),s)},addResource(t,i){let s=(0,e.valOrDefault)(i,t.name.split(".")[0]);this.resources.set(s,t);let n=new FileReader;return n.onload=e=>{const t=JSON.parse(n.result);console.log("Resulting Schema"),console.log(t),this.addModel(s,t)},n.readAsText(t),this.refresh(),t},getResource(e){return this.resources.get(e)},hasResource(e){return this.resources.has(e)},removeResource(e){return this.resources.delete(e),this.triggerEvent({name:"resource.removed"}),this.refresh(),!0},addError(e){return this.errors.push(e),this.refresh(),(0,t.lL)(this.status.editorstatusBadge),e},removeError(e){return this.errors.pop(),this.refresh(),!0},clearError(e){return this.errors=[],this.refresh(),!0},getModel(t){let i=this.models.get(t);return(0,e.isNullOrUndefined)(i)?null:JSON.parse(i)},addModel(e,t){this.models.set(e,t)},removeModel(e){return this.triggerEvent({name:"model.remove@pre",args:[e]},(()=>{this.models.delete(e),this.refresh(),this.triggerEvent({name:"model.remove@post"})}),!1),!0},hasModel(e){return this.models.has(e)},getValue(e){if(this.values.has(e))return this.values.get(e)},addValue(t){let i="value"+Aa++,s=(0,e.createI)({class:["ico","ico-copy"]}),n=(0,e.createI)({class:["ico","ico-delete"]},"✖"),r=(0,e.createButton)({class:["btn","btn-copy","fit-content"],title:`Copy ${t.name}`},[s,t.name]),a=(0,e.createButton)({class:["btn","btn-delete"]},n),l=(0,e.createListItem)({class:["model-value"],dataset:{id:i}},[r,a]);if(r.addEventListener("click",(e=>{this.copy(t)})),a.addEventListener("click",(e=>{this.removeValue(i)})),this.values.size>5){let{id:e}=this.valueList.lastChild.dataset;this.removeValue(e)}return this.valueList.prepend(l),this.values.set(i,{element:l,value:t}),this.refresh(),t},removeValue(t){if((0,e.isNullOrUndefined)(t)||!this.values.has(t))return;let{element:i}=this.values.get(t);return(0,e.removeChildren)(i).remove(),this.values.delete(t),this.refresh(),this},copy(i,s=!1){return(0,e.isNullOrUndefined)(i)||(this.copyValue=i,(0,e.copytoClipboard)(JSON.stringify(i)),s&&this.addValue(i),this.notify(`${i.name} copied`,t.k$.NORMAL)),this},paste(t,i){let s=(0,e.valOrDefault)(i,this.copyValue);if(!(0,e.isNullOrUndefined)(s)){if((0,e.isNullOrUndefined)(t)){let e=this.createConcept(s.name).init();e.setValue(s),this.createInstance(e)}else"prototype"===s.nature?t.setValue(s.value):t.setValue(s);return this}},show(){return this.triggerEvent({name:"editor.show@pre"},(()=>{(0,t.$Z)(this.container),this.attached.forEach((e=>e.show())),this.visible=!0,this.triggerEvent({name:"editor.show@post"})}),!1),this},hide(){return this.triggerEvent({name:"editor.hide@pre"},(()=>{(0,t.Cp)(this.container),this.attached.forEach((e=>e.hide())),this.visible=!1,this.triggerEvent({name:"editor.hide@post"})}),!1),this},toggle(){return this.triggerEvent({name:"editor.toggle@pre"},(()=>{(0,t.ZN)(this.container),this.visible=!this.visible,this.triggerEvent({name:"editor.toggle@post"})}),!1),this},open(){return this.triggerEvent({name:"editor.open@pre"},(()=>{this.show(),this.active=!0,this.isReady&&this.home.close(),this.triggerEvent({name:"editor.open@post"})}),!1),this},close(){return this.triggerEvent({name:"editor.close@pre"},(()=>{this.hide(),this.active=!1,this.done(),this.clear(),this.triggerEvent({name:"editor.close@post"})}),!1),this},destroy(){return this.triggerEvent({name:"editor.destroy@pre"},(()=>{this.hide(),this.done(),this.instances.forEach((e=>e.delete())),(0,e.removeChildren)(this.container).remove()}),!1),!0},freeze(){return this.triggerEvent({name:"editor.freeze@pre"},(()=>{this.frozen=!0,this.refresh(),this.triggerEvent({name:"editor.freeze@post"})}),!1),this},unfreeze(){return this.frozen=!1,this.refresh(),this},done(){return this.conceptModel&&this.conceptModel.done(),this.projectionModel&&this.projectionModel.done(),this},highlight(i){return(0,e.isHTMLElement)(i)?((0,t.CH)(i),this.decoratedElements.add(i),this):this},unhighlight(i){return(0,e.isHTMLElement)(i)?((0,t.HW)(i),this.decoratedElements.delete(i),this):(this.decoratedElements.forEach((e=>(0,t.HW)(e))),this.decoratedElements.clear(),this)},createWindow(){let t=(0,e.createDiv)({class:["editor-window"],tabindex:0});this.body.append(t)},clear(){return this.triggerEvent({name:"editor.clear@pre"},(()=>{this.instances.forEach((e=>e.delete())),this.instances.clear(),this.resources.clear(),this.models.clear(),this.states.forEach((e=>e.element.remove())),this.states=[],this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,this.refresh(),this.triggerEvent({name:"editor.clear@post"})}),!1),this},update(e,t,i){this.triggerEvent({name:e})},attach(e){this.attached.push(e)},detach(e){let t=this.attached.findIndex((t=>t===e));if(-1===t)return null;this.attached.splice(t,1)},render(t){const i=(0,e.createDocFragment)();if(this.home.isRendered||i.append(this.home.render()),this.header.isRendered||i.append(this.header.render()),this.exporter.isRendered||i.append(this.exporter.render()),(0,e.isHTMLElement)(this.navigationSection)||(this.navigationSection=(0,e.createSection)({class:["model-navigation-section"]}),this.viewSection=(0,e.createAside)({class:["model-view-section"]}),this.navigationSection.append(this.viewSection),i.append(this.navigationSection)),!(0,e.isHTMLElement)(this.body)){this.body=(0,e.createDiv)({class:["editor-body"],tabindex:0});let t=(0,e.createDiv)({class:["editor-body-main"],tabindex:0});this.instanceSection=(0,e.createSection)({class:["model-concept-section"]}),t.append(this.instanceSection),this.body.append(t),i.append(this.body)}return(0,e.isHTMLElement)(this.timeline)||(this.timeline=(0,e.createDiv)({class:["editor-timeline"]}),this.stateList=(0,e.createUnorderedList)({class:["bare-list","model-state-list"]}),this.timeline.append(this.stateList),i.append(this.timeline)),this.logs.isRendered||i.append(this.logs.render()),this.breadcrumb.isRendered||this.navigationSection.append(this.breadcrumb.render()),(0,e.isHTMLElement)(this.valueSection)||(this.valueSection=(0,e.createDiv)({class:["model-value-window"]}),this.valueList=(0,e.createUnorderedList)({class:["bare-list","model-value-list"]}),this.valueSection.append(this.valueList),this.navigationSection.append(this.valueSection)),this.status.isRendered||i.append(this.status.render()),(0,e.isHTMLElement)(this.input)||(this.input=(0,e.createInput)({type:"file",class:["hidden"],accept:".json,.jsoncp"}),i.append(this.input)),i.hasChildNodes()&&(this.container.append(i),this.bindEvents()),(0,e.isHTMLElement)(t)&&t.append(this.container),this.refresh(),this.container},refresh(i=!1){return this.frozen&&!i||(this.home.isOpen?this.container.classList.add("unfocus"):this.container.classList.remove("unfocus"),this.hasValues?(0,t.$Z)(this.valueWindow):(0,t.Cp)(this.valueWindow),this.header.refresh(),this.breadcrumb.refresh(),this.home.refresh(),this.logs.refresh(),this.status.refresh(),this.instanceSection.dataset.view=this.status.view,["grid"].includes(this.status.view)?(0,t.Cp)(this.viewSection):["tab"].includes(this.status.view)&&(0,t.$Z)(this.viewSection),(0,e.isEmpty)(this.states)?(0,t.Cp)(this.timeline):((0,t.$Z)(this.timeline),this.states.forEach((e=>{this.conceptModel.hasConcept(e.concept.id)?this.hasActiveConcept&&this.activeConcept===e.concept?e.element.classList.add("active"):e.element.classList.remove("active"):this.removeState(e.id)})))),this},updateActiveElement(e){return this.activeElement&&this.activeElement===e||(this.activeElement=e,this.triggerEvent({name:"editor.element@active:updated"})),this},updateActiveConcept(e){return this.hasActiveConcept&&this.activeConcept===e||(this.activeConcept=e,this.triggerEvent({name:"editor.concept@active:updated"}),this.refresh()),this},updateActiveProjection(t){if(this.activeProjection&&this.activeProjection===t)return this;let i=(0,e.getElements)(".active-parent",this.body);for(let e=0;e<i.length;e++)i[e].classList.remove("active-parent");this.activeProjection=t;let s=this.activeProjection.parent;for(;s;)s.getContainer().classList.add("active-parent"),s=s.parent;return this.triggerEvent({name:"editor.projection@active:updated"}),this.refresh(),this},updateActiveInstance(e){if(this.activeInstance){if(this.activeInstance===e)return this;this.activeInstance,this.activeInstance.container.classList.remove("active")}return this.activeInstance=e,this.activeInstance.container.classList.add("active"),this.triggerEvent({name:"editor.instance@active:updated"}),this.refresh(),this},registerReceiver(t,i){(0,e.isNullOrUndefined)(this.receivers)&&(this.receivers={}),(0,e.isNullOrUndefined)(this.receivers[i])?this.receivers[i]={root:t,projections:[t]}:this.receivers[i].projections.push(t),this.setActiveReceiver(t,i)},setActiveReceiver(t,i){(0,e.isNullOrUndefined)(this.activeReceiver)&&(this.activeReceiver={}),this.activeReceiver[i]=t},getActiveReceiver(e){return this.activeReceiver[e]},getReceivers(e){return this.receivers[e].projections},getRootReceiver(e){return this.receivers[e].root},bindEvents(){var i=null,s=null;const n={open:e=>{const{context:t}=e.dataset;t?this[t].open():this.open()},close:e=>{const{context:t,id:i,type:s}=e.dataset;t?this[t].close():this.close()},collapse:t=>{const{rel:i,target:s}=t.dataset;if("parent"===i){let i=(0,e.findAncestor)(t,(e=>e.dataset.name===s));if((0,e.isHTMLElement)(i)){const{alias:e=""}=i.dataset;i.classList.toggle("collapsed");let s=i.classList.contains("collapsed");t.dataset.state=s?"ON":"OFF",t.title=s?`Expand ${e.toLowerCase()}`:`Collapse ${e.toLowerCase()}`}}},delete:t=>{const{target:i}=t.dataset;if("parent"===i){let i=t.parentElement;(0,e.removeChildren)(i),i.remove()}},"delete:value":e=>{const{id:t}=e.dataset;this.conceptModel.removeValue(t),this.header._valueSelector.update()},"delete:resource":e=>{const{id:t}=e.dataset;this.removeResource(t)},"change-view":e=>{const{value:t}=e.dataset;this.status.changeView(t)},"add-group":e=>{this.status.addGroup()},style:e=>{this.style.toggle()},home:e=>{this.home.toggle()},logs:e=>{this.logs.toggle()},export:e=>{this.export()},"export--copy":e=>{this.export(!0)},"create-instance":e=>{const{concept:t}=e.dataset;let i=this.createConcept(t);this.createInstance(i)},"create-instance:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t),s=this.createConcept(i.name);s.initValue(i),this.createInstance(s)},"copy:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t);this.copy(i)},save:e=>{this.save()},undo:e=>{this.undo()},load:e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},unload:e=>{this.unload()},"load-concept":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-concept":e=>{this.unloadAllConcept()},"download-concept":e=>{const{schema:t,values:i}=this.conceptModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({concept:t},`${s}_model`)},"load-projection":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-projection":e=>{this.unloadAllProjection()},"download-projection":e=>{const{schema:t,views:i}=this.projectionModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({projection:t},`${s}_projection`)}},r={[t.sr.up_arrow]:"up",[t.sr.right_arrow]:"right",[t.sr.down_arrow]:"down",[t.sr.left_arrow]:"left"};this.container.addEventListener("click",(i=>{var s=(0,t.NI)(i.target);const{action:r,context:a,id:l}=s.dataset;if("instance"===a)return void this.getInstance(l).actionHandler(r);if("menu"===a)return void this.home.actionHandler(r,s);if(this.activeElement&&this.activeElement.clickHandler(s),(0,e.isNullOrUndefined)(r))return;if(this.actions.has(r))return console.warn(r),this.actions.get(r).call(this,s),void s.blur();const o=n[r];(0,e.isFunction)(o)?(o(s),s.blur()):r&&this.triggerEvent({name:r})}),!0),this.input.addEventListener("change",(e=>{let t=this.input.files[0];this.load(t,s),this.input.value=""})),this.body.addEventListener("copy",(e=>{if(!(0,t.QE)(e.target)){let t=this.activeConcept.copy(!1);this.copy(t,!0),e.preventDefault()}})),this.body.addEventListener("keydown",(s=>{const{target:n}=s,{nature:a}=n.dataset;var l=!1;switch(s.key){case t.sr.backspace:this.activeElement&&i!==t.sr.ctrl&&!0===this.activeElement.backspaceHandler(n)&&s.preventDefault();break;case t.sr.ctrl:case t.sr.shift:s.preventDefault(),l=!0;break;case t.sr.delete:this.activeElement&&i!==t.sr.ctrl&&!(0,t.QE)(n)&&this.activeElement.deleteHandler(n)&&s.preventDefault();break;case t.sr.spacebar:this.activeElement&&i!==t.sr.ctrl&&this.activeElement.spaceHandler(n)&&s.preventDefault();break;case t.sr.alt:s.preventDefault();break;case t.sr.enter:this.activeElement?!0===this.activeElement.enterHandler(n)&&s.preventDefault():"concept-container"===a?this.activeInstance.projection.focus():"editable"===a?n.blur():"BUTTON"===n.tagName?(n.click(),s.preventDefault()):s.preventDefault();break;case t.sr.escape:this.activeElement&&(!0===this.activeElement.escapeHandler(n)?s.preventDefault():(0,e.findAncestor)(n,(e=>0===e.tabIndex)).focus());break;case t.sr.insert:this.activeElement&&s.preventDefault();break;case t.sr.up_arrow:case t.sr.right_arrow:case t.sr.down_arrow:case t.sr.left_arrow:if(this.activeElement&&![t.sr.ctrl,t.sr.shift,t.sr.alt].includes(i))!0===this.activeElement.arrowHandler(r[s.key],n)&&s.preventDefault();else if("concept-container"===a&&![t.sr.ctrl,t.sr.shift,t.sr.alt].includes(i)){let i=(0,t.As)(n,r[s.key],this.instanceSection);if(!(0,e.isHTMLElement)(i))return!1;i.focus()}break;case"s":i===t.sr.ctrl&&(this.activeConcept.copy(),this.header.valueCount++,this.refresh(),s.preventDefault());break;case"c":if(i===t.sr.ctrl){let e=new ClipboardEvent("copy");this.body.dispatchEvent(e)}break;case"v":if(i===t.sr.ctrl){if((0,t.QE)(n))return;this.paste(this.activeConcept,this.copyValue)}break;case"e":i===t.sr.ctrl&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{type:"projection",close:"DELETE-PROJECTION"}),s.preventDefault());break;case"f":break;case"z":i===t.sr.ctrl&&((0,t.QE)(n)||(this.undo(),s.preventDefault()))}l&&(i=s.key)}),!1),this.body.addEventListener("keyup",(s=>{var n=s.target;const{nature:a}=n.dataset;switch(s.key){case t.sr.spacebar:this.activeElement&&i===t.sr.ctrl&&this.activeElement._spaceHandler(n);break;case t.sr.delete:this.activeElement&&i===t.sr.ctrl&&this.activeElement.delete(n);break;case t.sr.alt:break;case t.sr.up_arrow:case t.sr.down_arrow:case t.sr.right_arrow:case t.sr.left_arrow:if(this.activeElement&&i===t.sr.ctrl)!0===this.activeElement._arrowHandler(r[s.key],n)&&s.preventDefault();else if("concept-container"===a&&i===t.sr.ctrl){let a=(0,t.As)(n,r[s.key],this.instanceSection);if(!(0,e.isHTMLElement)(a))return!1;this.swapInstance(n,a,!0),n.focus(),i=t.sr.ctrl}}i===s.key&&(i=-1)}),!1),this.body.addEventListener("focusin",(e=>{const{target:t}=e,s=this.resolveElement(t);if(i=-1,s?(this.activeElement&&this.activeElement!==s&&(this.activeElement.focusOut(),this.activeElement=null),this.updateActiveElement(s),this.activeElement.focusIn(t)):(this.activeElement&&this.activeElement.focusOut(t),this.activeElement=null),this.activeElement){let e=this.activeElement.projection;this.updateActiveProjection(e),this.updateActiveConcept(e.concept)}else this.activeConcept=null,this.activeProjection=null;this.refresh()})),this.registerHandler("value.changed",(()=>this.refresh())),this.registerHandler("value.added",(()=>this.refresh())),this.registerHandler("value.removed",(()=>this.refresh())),this.registerHandler("load-resource",(e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});s=e[0],this.input.dispatchEvent(t)}))}},Na=Object.assign(Ea,ya,wa,_,Oa);Object.defineProperty(Na,"hasConceptModel",{get(){return!(0,e.isNullOrUndefined)(this.conceptModel)}}),Object.defineProperty(Na,"hasProjectionModel",{get(){return!(0,e.isNullOrUndefined)(this.projectionModel)}}),Object.defineProperty(Na,"hasInstances",{get(){return this.instances.size>0}}),Object.defineProperty(Na,"hasWindows",{get(){return this.windows.size>0}}),Object.defineProperty(Na,"hasValues",{get(){return this.values.size>0}}),Object.defineProperty(Na,"isReady",{get(){return this.hasConceptModel&&this.hasProjectionModel}}),Object.defineProperty(Na,"hasActiveConcept",{get(){return!(0,e.isNullOrUndefined)(this.activeConcept)}}),Object.defineProperty(Na,"hasActiveProjection",{get(){return!(0,e.isNullOrUndefined)(this.activeProjection)}}),Object.defineProperty(Na,"hasActiveInstance",{get(){return!(0,e.isNullOrUndefined)(this.activeInstance)}}),Object.defineProperty(Na,"hasError",{get(){return!(0,e.isEmpty)(this.errors)}});const ja="editor";function Ca(i){const s=(0,t.fP)(i),n=(t=>(0,e.isHTMLElement)(t)&&(0,e.hasOwn)(t.dataset,"gentleman"))(s)?[s]:(0,e.getElements)('[data-gentleman="editor"]',s),r=[];return n.forEach((e=>{r.push(La(e))})),r}function La(i){let s=(0,t.fP)(i);return(0,e.isHTMLElement)(i)||(s=(0,e.createDiv)({tabindex:-1})),s.classList.add("gentleman-editor"),s.dataset.gentleman=ja,Object.create(Na,{object:{value:"environment"},type:{value:ja},name:{value:"gentleman editor"},container:{value:s}})}})(),n})()}));