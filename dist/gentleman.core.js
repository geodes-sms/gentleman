!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Gentleman=t():e.Gentleman=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?v(e)?t:e:g(e)?t:e}function l(e){return d(e)&&0===e.length}function o(e){return e instanceof Date||"object"===i(e)&&"[object Date]"===Object.prototype.toString.call(e)}function c(e){return"string"==typeof e||e instanceof String}function h(e){return"function"==typeof e}function u(e){return!g(e)&&"object"===i(e)}function d(e){return!g(e)&&"function"==typeof e[Symbol.iterator]}function p(e){return d(e)&&!c(e)}function m(e){return null===e}function f(e){return!e||c(e)&&(0===e.length||/^\s*$/.test(e))}function v(e){return void 0===e}function g(e){return m(e)||v(e)}function b(e,t){var i=e.getDate(),s=e.getMonth()+1,n=e.getFullYear().toString(),r=e.getHours(),a=e.getMinutes(),l=e.getSeconds(),o=function(e){return e<10?"0".concat(e):e};return t.replace("yyyy",n).replace("yy",n.slice(-2)).replace("mm",o(s)).replace("m",s).replace("dd",o(i)).replace("d",i).replace("hh",o(r)).replace("h",r).replace("MM",o(a)).replace("M",a).replace("ss",o(l)).replace("s",l)}function y(e){return b(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(g(e))return new Date;if(o(e))return e;var i=new Date(e),s=i.getTime();return Number.isNaN(s)?new Date:t?new Date(s+6e4*i.getTimezoneOffset()):i}(e,!1),"yyyy-mm-dd hh:MM")}e.r(t),e.d(t,{activateEditor:()=>Bn,createEditor:()=>Fn});var w=Object.prototype.hasOwnProperty,E=(Object.prototype.isPrototypeOf,function(e,t){return w.call(e,t)});function C(e){if(g(e)||!u(e))return e;var t=e.constructor();for(var i in e)E(e,i)&&(e.isActiveClone=null,t[i]=C(e[i]),delete e.isActiveClone);return t}function j(e){return f(e)?e:function(e){return f(e)?e:e.toLowerCase().replace(/\b\w/g,(function(e){return e.toUpperCase()}))}(e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim()).replace(/\s+/g,"")}function L(e){var t=a(e,!1);return c(t)&&"true"===t.toLowerCase()||Number.isInteger(t)&&1===t||!0===t}var x=function(e){return!g(e)&&e.nodeType===Node.ELEMENT_NODE},_=function(e){return e instanceof Node},A=function(e){return x(e)&&e instanceof Element},O=function(e,t){return!!(x(e)&&e instanceof HTMLElement)&&(!d(t)||(i=e,s=Array.isArray(t)?t:[t],r=function(e){return i instanceof e},a=function(e){return i.tagName===e.toUpperCase()},o=function(e){return Array.isArray(e)?e.includes(i.type):i.type===e},s.some((function(e){if(!d(e))return!1;var t,i,s=e,c=null;if(Array.isArray(e)){var h=(i=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,n=!1,r=void 0;try{for(var a,l=e[Symbol.iterator]();!(s=(a=l.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){n=!0,r=e}finally{try{s||null==l.return||l.return()}finally{if(n)throw r}}return i}}(t,i)||n(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());s=h[0],c=h[1]}s=s.toLowerCase();var u="HTML".concat(E(S,s)?S[s]:j(s),"Element");return!(!r(window[u])&&!a(s))&&(!(p(c)&&!l(c))||o(c))}))));var i,s,r,a,o},S={a:"Anchor",br:"BR",dl:"DList",datalist:"DataList",fieldset:"FieldSet",frameset:"FrameSet",hr:"HR",h1:"Heading",h2:"Heading",h3:"Heading",h4:"Heading",h5:"Heading",h6:"Heading",li:"LI",ol:"OList",optgroup:"OptGroup",p:"Paragraph",q:"Quote",blockquote:"Quote",caption:"TableCaption",td:"TableCell",th:"TableCell",col:"TableCol",tr:"TableRow",tbody:"TableSection",thead:"TableSection",tfoot:"TableSection",textarea:"TextArea",ul:"UList"},I=function(e){return function(e){return!g(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(e)&&e instanceof DocumentFragment};function V(e,t){if(!c(t))return null;var i=document.createElement("template");return i.innerHTML=t.trim(),i.content[e]}var R=V.bind(null,"firstChild");function M(e,t,i){e[t]=i}function T(e,t,i){e.setAttribute(t,i)}V.bind(null,"childNodes");var k="accesskey,autocapitalize,class,dataset,editable,draggable,hidden,id,inputmode,lang,html,style,tabindex,text,title",N={accesskey:[M,"accessKey"],autocapitalize:[M,"autocapitalize"],class:[function(e,t){var i;if(!O(e))throw new Error("Bad argument: The passed `element` argument is not a valid HTML Element");return(i=e.classList).add.apply(i,s(Array.isArray(t)?t:[t])),e}],dataset:[function(e,t,i){Object.assign(e[t],i)},"dataset"],draggable:[M,"draggable"],editable:[M,"contentEditable"],hidden:[M,"hidden"],id:[M,"id"],inputmode:[M,"inputMode"],lang:[M,"lang"],html:[M,"innerHTML"],style:[M,"style"],tabindex:[M,"tabIndex"],text:[M,"textContent"],title:[M,"title"],data:[M,"data"],cite:[M,"cite"],download:[M,"download"],ping:[M,"ping"],target:[M,"target"],coords:[M,"coords"],shape:[M,"shape"],autoplay:[M,"autoplay"],buffered:[M,"buffered"],controls:[M,"controls"],loop:[M,"loop"],muted:[M,"muted"],playsinline:[T,"playsinline"],poster:[M,"poster"],preload:[M,"preload"],crossorigin:[M,"crossOrigin"],decoding:[M,"decoding"],height:[M,"height"],ismap:[M,"isMap"],loading:[M,"loading"],srcset:[M,"srcset"],width:[M,"width"],alt:[M,"alt"],as:[M,"as"],media:[M,"media"],rel:[M,"rel"],src:[M,"src"],sizes:[M,"sizes"],reversed:[M,"reversed"],start:[M,"start"],accept:[M,"accept"],"accept-charset":[M,"acceptCharset"],action:[M,"action"],autocomplete:[M,"autocomplete"],autofocus:[M,"autofocus"],capture:[M,"capture"],checked:[M,"checked"],cols:[M,"cols"],disabled:[M,"disabled"],dirname:[M,"dirName"],enctype:[M,"enctype"],for:[M,"for"],form:[M,"form"],formaction:[M,"formAction"],formenctype:[M,"formEnctype"],formmethod:[M,"formMethod"],formnovalidate:[M,"formNoValidate"],formtarget:[M,"formTarget"],high:[M,"high"],label:[M,"label"],list:[M,"list"],low:[M,"low"],max:[M,"max"],maxlength:[M,"maxLength"],method:[M,"method"],min:[M,"min"],minlength:[M,"minLength"],multiple:[M,"multiple"],name:[M,"name"],novalidate:[M,"noValidate"],optimum:[M,"optimum"],pattern:[M,"pattern"],placeholder:[M,"placeholder"],readonly:[M,"readOnly"],required:[M,"required"],rows:[M,"rows"],selected:[M,"selected"],size:[M,"size"],spellcheck:[T,"spellcheck"],step:[M,"step"],wrap:[M,"wrap"],default:[M,"default"],kind:[M,"kind"],srclang:[M,"srclang"],abbr:[M,"abbr"],colspan:[M,"colSpan"],span:[M,"span"],rowspan:[M,"rowSpan"],scope:[M,"scope"],href:[M,"href"],hreflang:[M,"hreflang"],datetime:[M,"dateTime"],type:[M,"type"],value:[M,"value"],usemap:[M,"useMap"]};function H(e,t,i){var n=document.createElement(e);return O(n)?(u(i)&&function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!O(e))throw new Error("Bad argument: The given element argument is not a valid HTML Element");if(!u(t))return e;for(var n=function(e){return k.includes(e)||i.includes(e)},r=0,a=Object.keys(t);r<a.length;r++){var l=a[r];if(n(l)){var o=t[l],c=N[l].slice(0);c.shift().apply(void 0,[e].concat(s(c),[o]))}}}(n,i,a(t,"")),n):null}function P(e,t,i,s){var n=H(e,t,i);return O(n)?(g(s)||be(n,s),n):null}function $(e,t,i,s,n){var r=H(e,t,s);return O(r)?(g(n)||be(r,n,i),r):null}function D(e){var t=document.createDocumentFragment();return g(e)||be(t,e),t}H.bind(null,"link","as,crossorigin,disabled,href,hreflang,media,rel,sizes,type"),P.bind(null,"template","");var B=P.bind(null,"header",""),F=(P.bind(null,"footer",""),P.bind(null,"main",""),P.bind(null,"article",""),P.bind(null,"section","")),z=(P.bind(null,"nav",""),P.bind(null,"aside","")),W=(P.bind(null,"h1",""),P.bind(null,"h2",""),P.bind(null,"h3","")),q=P.bind(null,"h4",""),U=(P.bind(null,"h5",""),P.bind(null,"h6",""),P.bind(null,"div","")),X=(P.bind(null,"object","data,height,name,type,usemap,width"),H.bind(null,"embed","height,src,type,width"),H.bind(null,"br",""),H.bind(null,"hr",""),P.bind(null,"p","")),J=(P.bind(null,"blockquote","cite"),function(e){return O(e,"li")?e:Y(null,e)}),G=$.bind(null,"ul","",J),Y=($.bind(null,"ol","reversed,start,type",J),P.bind(null,"li","value")),K=(P.bind(null,"dl",""),P.bind(null,"dt",""),P.bind(null,"dd",""),P.bind(null,"a","download,href,hreflang,ping,rel,target,type")),Z=(H.bind(null,"area","alt,coords,download,href,hreflang,media,ping,rel,shape,target"),H.bind(null,"base","href,target"),H.bind(null,"img","alt,crossorigin,decoding,height,ismap,loading,sizes,src,srcset,usemap,width")),Q=P.bind(null,"audio","autoplay,controls,crossorigin,loop,muted,preload,src"),ee=(P.bind(null,"video","autoplay,controls,crossorigin,height,loop,muted,playsinline,poster,preload,src,width"),H.bind(null,"source","media,sizes,src,srcset,type"),H.bind(null,"track","default,kind,label,src,srclang"),P.bind(null,"picture",""),P.bind(null,"figure",""),P.bind(null,"figcaption",""),P.bind(null,"span","")),te=(P.bind(null,"strong",""),P.bind(null,"em","")),ie=(P.bind(null,"mark",""),P.bind(null,"samp",""),P.bind(null,"sub",""),P.bind(null,"sup",""),P.bind(null,"del","cite,datetime"),P.bind(null,"ins","cite,datetime"),P.bind(null,"q","cite"),P.bind(null,"abbr",""),P.bind(null,"b",""),P.bind(null,"i","")),se=(P.bind(null,"s",""),P.bind(null,"u",""),P.bind(null,"cite",""),P.bind(null,"time","datetime"),P.bind(null,"code",""),P.bind(null,"form","accept-charset,action,autocomplete,enctype,method,name,novalidate,rel,target"),H.bind(null,"input","accept,alt,autocomplete,autofocus,capture,checked,dirname,disabled,height,max,maxlength,minlength,min,multiple,name,pattern,placeholder,readonly,required,size,src,step,type,value,width")),ne=P.bind(null,"textarea","autocomplete,autofocus,cols,disabled,maxlength,minlength,name,placeholder,readonly,required,rows,spellcheck,value,wrap"),re=P.bind(null,"label","for"),ae=($.bind(null,"select","autocomplete,autofocus,disabled,multiple,name,required,size",(function(e){return O(e,["option","optgroup"])?e:Array.isArray(e)?oe(null,e):ae(null,e)})),P.bind(null,"option","disabled,label,selected,value")),le=function(e){return O(e,"option")?e:ae(null,e)},oe=$.bind(null,"optgroup","disabled,label",le),ce=(P.bind(null,"fieldset","disabled,name"),P.bind(null,"legend",""),$.bind(null,"datalist","",le),P.bind(null,"meter","high,low,max,min,optimum,value"),P.bind(null,"progress","max,value"),P.bind(null,"output","name,value"),P.bind(null,"button","autofocus,disabled,formaction,formenctype,formmethod,formnovalidate,formtarget,name,type,value")),he=P.bind(null,"table",""),ue=(P.bind(null,"caption",""),function(e){return O(e,"tr")?e:fe(null,e)}),de=$.bind(null,"thead","",ue),pe=$.bind(null,"tbody","",ue),me=$.bind(null,"tfoot","",ue),fe=(H.bind(null,"col","span"),$.bind(null,"colgroup","span",(function(e){return O(e,"col")?e:null})),$.bind(null,"tr","",(function(e){return O(e,["th","td"])?e:ge(null,e)}))),ve=P.bind(null,"th","abbr,colspan,rowspan,scope"),ge=P.bind(null,"td","colspan,rowspan");function be(e,t,i){var s=Array.isArray(t)?t:[t];return h(i)&&(s=s.map((function(e){return i(e)}))),function(e,t){if(!_(e))throw new TypeError("Bad argument: The given `parent` is not a valid Node");if(!(t instanceof HTMLCollection||p(t)))throw new TypeError("Bad argument: The given `children` is not a valid HTMLCollection/HTMLElement array");var i=I(e)?e:document.createDocumentFragment();Array.from(t).forEach((function(e){var t;g(e)||i.appendChild(_(e)?e:(t=e.toString(),document.createTextNode(t.toString())))})),e!==i&&e.appendChild(i)}(e,s),e}var ye=function(e){return/^\.[a-zA-Z0-9_-]+$/.test(e)};function we(e,t){var i=a(t,document);return f(e)?null:I(i)?i.querySelector(e):function(e){return/^#[a-zA-Z0-9_-]+$/.test(e)}(e)?document.getElementById(e.substring(1)):ye(e)?i.getElementsByClassName(e.substring(1))[0]:i.querySelector(e)}function Ee(e,t){var i=a(t,document);return f(e)?null:I(i)?i.querySelectorAll(e):ye(e)?i.getElementsByClassName(e.substring(1)):i.querySelectorAll(e)}function Ce(e,t,i){if(!O(t))return null;var s=t[e];if(h(i))for(;A(s)&&!i(s);)s=s[e];return s}function je(e,t,i){if(!A(e))throw new TypeError("Bad argument: The given target parameter is not a valid HTML Element");if(!h(t))throw new TypeError("Bad argument: The given pred parameter is not a valid Function");var s=e.parentElement;return i>0?xe(s,t,i-1):Le(s,t)}function Le(e,t){return g(e)?null:t(e)?e:Le(e.parentElement,t)}function xe(e,t,i){return g(e)||0===i?null:t(e)?e:xe(e.parentElement,t,i-1)}function _e(e,t){if(!_(e))throw new TypeError("Bad argument: The given `node` is not a valid Node");return h(t)?(Array.from(e.childNodes).forEach((function(i){t(i)&&e.removeChild(i)})),e):function(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild);return e}(e)}function Ae(e){if(g(e))return!1;var t=ne({value:O(e)?e.textContent:e.toString(),readonly:!0});return!!O(t)&&(document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),!0)}Ce.bind(null,"previousElementSibling"),Ce.bind(null,"nextElementSibling");var Oe=function(e){return e.dataset.state},Se=function(e,t){return e.dataset.state=t},Ie=function(e,t){return Se(e,a(t,"checked"))},Ve=function(e,t){return Se(e,a(t,"unchecked"))},Re={name:"form-selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return m(this.selectedItem)&&!m(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("change",(function(t){var i=t.target,s=!1;if(h(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),s)return i.checked=!1,void e.items[e.selectedIndex].setChecked(!0);var n=e.items.find((function(e){return e.index===+a(i.dataset.selectorIndex,-1)}));g(n)||(e.setSelectedItem(n),h(e.afterChange)&&e.afterChange(e,t))}))}},Me=function(e){return'[data-type="'.concat(e.name,'"]')},Te={BaseSelector:Me({name:"selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return m(this.selectedItem)&&!m(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=t.target;if(E(i.dataset,"selector")){var s=!1;if(h(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),!s){var n=e.items.find((function(e){return e.index===+a(i.dataset.selectorIndex,-1)}));g(n)||(e.setSelectedItem(n),h(e.afterChange)&&e.afterChange(e,t))}}}))}}),FormSelector:Me(Re)};new Error("Missing container: A selector requires a container"),new Error("Missing input: FormSelector requires an input in the container"),[Te.BaseSelector,Te.FormSelector].join(","),new Error("Missing container: A switch requires a container"),new Error("Missing input: FormSwitch requires an input in the container");var ke="on",Ne=function(e){return'[data-type="'.concat(e.name,'"]')},He={name:"form-switch",container:null,input:null,beforeChange:null,afterChange:null,get value(){return this.input.value},isChecked:function(){return Oe(this.container)===ke},setChecked:function(e){return!g(e)&&(this.input.checked=e,e?Ie(this.container,ke):Ve(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.input.checked&&this.setChecked(!0),this.bindEvents(),this},bindEvents:function(){var e=this;this.input.addEventListener("change",(function(t){var i=!1;h(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i?e.input.checked=!e.input.checked:(e.toggle(),h(e.afterChange)&&e.afterChange(e,t))}))}};function Pe(e){let t=0;if(0!==window.getSelection().rangeCount){const i=window.getSelection().getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),t=s.toString().length}return t}[Ne({name:"switch",container:null,beforeChange:null,afterChange:null,get value(){return this.container.dataset.value},isChecked:function(){return Oe(this.container)===ke},setChecked:function(e){return!g(e)&&(e?Ie(this.container,ke):Ve(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.isChecked()&&Ie(this.container,ke),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=!1;h(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i||(e.toggle(),h(e.afterChange)&&e.afterChange(e,t))}))}}),Ne(He)].join(","),new Error("Missing container: A collapsible requires a container"),new Error("Missing container: An accordion requires a container"),encodeURIComponent;const $e="hidden",De="collapsed",Be="highlighted",Fe="shake",ze="selected";function We(e){return O(e)?(e.classList.remove($e),e):e}function qe(e){return O(e)?(e.classList.add($e),e):e}function Ue(e){return O(e)?(e.classList.toggle($e),e):e}function Xe(e){e.classList.contains(Fe)||(e.classList.add(Fe),setTimeout((()=>{e.classList.remove(Fe)}),1e3))}function Je(e){return O(e)?(e.classList.remove(Be),e):e}const Ge={backspace:"Backspace",tab:"Tab",enter:"Enter",ctrl:"Control",shift:"Shift",alt:"Alt",escape:"Escape",spacebar:" ",page_up:"PageUp",page_down:"PageDown",insert:"Insert",end:"End",home:"Home",left_arrow:"ArrowLeft",up_arrow:"ArrowUp",right_arrow:"ArrowRight",down_arrow:"ArrowDown",delete:"Delete",period:"."},Ye={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"};function Ke(e){const t=e=>!E(e.dataset,"ignore");return t(e)?e:je(e,t,10)}function Ze(e){if(!O)throw new TypeError("Bad parameter");return e.hidden||"none"===window.getComputedStyle(e).display}const Qe=e=>O(e,["input","textarea"])||"true"===e.contentEditable,et=e=>+e.substring(0,e.indexOf("px")),tt={top:e=>e.marginTop,right:e=>e.marginRight,bottom:e=>e.marginBottom,left:e=>e.marginLeft},it={top:e=>e.paddingTop,right:e=>e.paddingRight,bottom:e=>e.paddingBottom,left:e=>e.paddingLeft},st={top:e=>e.borderTopWidth,right:e=>e.borderRightWidth,bottom:e=>e.borderBottomWidth,left:e=>e.borderLeftWidth};function nt(e,t,i){const s=window.getComputedStyle(e),n=window.getComputedStyle(t),r=tt[i](s),a=it[i](n),l=st[i](n);return o=e.getBoundingClientRect()[i]+et(r),c=t.getBoundingClientRect()[i]-et(a)-et(l),Math.abs(o-c)<2;var o,c}function rt(e,t,i,s){return"up"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&nt(e,t,"top"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{bottom:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n>=c-1&&(u<l||u===l&&d<o)&&(a=i,l=u,o=d)}return a}(e,i,s):"down"===t?function(e,t,i=!0){const s=t.children,{bottom:n,left:r}=e.getBoundingClientRect();if(i&&nt(e,t,"bottom"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n<=c+1&&(u<l||u===l&&d<o)&&(a=i,l=u,o=d)}return a}(e,i,s):"left"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&nt(e,t,"left"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{top:c,right:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r>=h-1&&(d<o||d===o&&u<l)&&(a=i,l=u,o=d)}return a}(e,i,s):"right"===t?function(e,t,i=!0){const s=t.children,{top:n,right:r}=e.getBoundingClientRect();if(i&&nt(e,t,"right"))return null;let a=null,l=99999,o=99999;for(let t=0;t<s.length;t++){const i=s[t];if(Ze(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r<=h+1&&(d<o||d===o&&u<l)&&(a=i,l=u,o=d)}return a}(e,i,s):(console.error("unknown direction",t),null)}function at(e,t){const i=e.children,{top:s,left:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,l=99999,o=99999;for(let e=0;e<i.length;e++){const c=i[e];if(r&&!t(c))continue;if(Ze(c)||c.classList.contains("badge"))continue;const{top:h,left:u}=c.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(n-u);s<=h+1&&(d<l||d===l&&p<o)&&(a=c,l=d,o=p)}return a}function lt(e,t){const i=e.children,{top:s,left:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,l=99999,o=99999;for(let e=0;e<i.length;e++){const c=i[e];if(r&&!t(c))continue;if(Ze(c)||c.classList.contains("badge"))continue;const{top:h,left:u}=c.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(n-u);n<=u+1&&(p<o||p===o&&d<l)&&(a=c,l=d,o=p)}return a}function ot(e,t){const i=e.children,{top:s,right:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,l=99999,o=99999;for(let e=0;e<i.length;e++){const c=i[e];if(r&&!t(c))continue;if(Ze(c)||c.classList.contains("badge"))continue;const{top:h,right:u}=c.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(n-u);n>=u-1&&(p<o||p===o&&d<l)&&(a=c,l=d,o=p)}return a}function ct(e,t){const i=e.children,{bottom:s,left:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,l=99999,o=99999;for(let e=0;e<i.length;e++){const c=i[e];if(r&&!t(c))continue;if(Ze(c)||c.classList.contains("badge"))continue;const{bottom:h,left:u}=c.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(n-u);s>=h-1&&(d<l||d===l&&p<o)&&(a=c,l=d,o=p)}return a}function ht(e){return O(e)?e:c(e)&&!f(e)?we(e):null}const ut=e=>JSON.parse(JSON.stringify(e)),dt=function(){var e={},t=[];for(let e=0;e<256;e++)t[e]=e<16?"0"+e.toString(16):e.toString(16);return e.generate=function(){var e=4294967296*Math.random()>>>0,i=4294967296*Math.random()>>>0,s=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]},e}(),pt={create(e,t){const i=Object.create(this);return i.concept=e,i.schema=t,i},model:null,schema:null,source:null,id:null,value:null,object:"structure",init(e){throw new Error("This function has not been implemented")}};Object.defineProperty(pt,"model",{get(){return this.concept.model}}),Object.defineProperty(pt,"name",{get(){return this.schema.name}}),Object.defineProperty(pt,"description",{get(){return this.schema.description}}),Object.defineProperty(pt,"required",{get(){return a(this.schema.required,!0)}});const mt={object:"attribute",target:null,init(e){return this.target=this.model.createConcept(this.schema.target,{value:a(e,this.schema.value),parent:this.concept,ref:this}),this},getValue(){return this.target.getValue()},hasValue(){return this.target.hasValue()},copy(){return this.target.hasValue()?this.target.copy(!1):null},clone(){return this.target.hasValue()?this.target.clone():null},export(){return this.target.hasValue()?{id:this.target.id,name:this.target.name}:null},toString(){return{[`attribute.${this.name}`]:this.target.toString()}},toXML(){return this.target.hasValue()?this.target.toXML():""}},ft=Object.assign(Object.create(pt),mt),vt={attributes:null,attributes_created:null,initAttribute(){return this.attributes=[],this.attributes_created=new Set,this.attributes_updated=new Set,this.attributes_deleted=new Set,Array.isArray(this.attributeSchema)&&this.attributeSchema.filter((e=>a(e.required,!0))).forEach((e=>this.createAttribute(e.name))),this},getAttributes(){return this.attributes},getAttribute(e){if(g(e))throw new TypeError("Bad argument");return this.getAttributeByName(e)},getAttributeSchema(e){if(f(e))throw new TypeError("Bad argument");if(!this.hasAttribute(e))throw new Error(`Attribute '${e}' does not exist`);return C(this.attributeSchema.find((t=>t.name===e)))},getAttributeByName(e){if(f(e))throw new TypeError("Bad argument");var t=this.attributes.find((t=>t.name===e));return g(t)&&(t=this.createAttribute(e)),t},createAttribute(e,t){if(!this.hasAttribute(e))throw new Error(`Attribute not found: The concept '${this.name}' does not contain an attribute named '${e}'`);if(this.isAttributeCreated(e)){let i=this.getAttributeByName(e);if(t){let e=this.model.getValue(t);i.target.initValue(e)}return i}const i=this.getAttributeSchema(e);let s=this.model.getValue(t);var n=ft.create(this,i).init(s);return this.addAttribute(n),n},addAttribute(e){if(g(e)||"attribute"!==e.object)throw new Error("Bad argument: 'attribute' must be an attribute object");return this.attributes.push(e),this.attributes_created.add(e.name),this.notify("attribute.added",e),this},hasAttributes(){return!l(this.attributeSchema)||!l(this.attributes)},hasAttribute(e){return-1!==this.attributeSchema.findIndex((t=>t.name===e))},isAttributeRequired(e){return a(this.getAttributeSchema(e).required,!0)},isAttributeCreated(e){return this.attributes_created.has(e)},listAttributes(){const e=[];return this.attributeSchema.forEach((t=>{e.push({type:"attribute",name:t.name,description:t.description,target:t.target,accept:t.accept,required:this.isAttributeRequired(name),created:this.isAttributeCreated(name)})})),e},removeAttribute(e){if(this.isAttributeRequired(e))return{message:`The attribute '${e}' is required.`,success:!1};var t=this.attributes.findIndex((t=>t.name===e));if(-1===t)return{message:`The attribute '${e}' was not found.`,success:!1};var i=this.attributes.splice(t,1)[0];return this.attributes_created.delete(e),this.notify("attribute.removed",i),{message:`The attribute '${e}' was successfully removed.`,success:!0}}},gt={listeners:null,initObserver(){return this.listeners=[],this},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){var t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t,this)}))}},bt={model:null,schema:null,source:null,id:null,name:null,description:null,ref:null,actions:null,operations:null,accept:null,parent:null,references:null,errors:null,value:null,values:null,action:null,shadows:null,kind:"concept",init(e={}){return this.accept=e.accept,this.parent=e.parent,this.ref=e.ref,this.default=a(this.schema.default,null),this.values=a(e.values,a(this.schema.values,[])),this.description=a(e.description,this.schema.description),this.src=a(this.schema.src,[]),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},isRoot(){return g(this.parent)},initValue(){throw new Error("This function has not been implemented")},getName(){return this.ref&&"attribute"===this.ref.object?this.ref.name:this.name},getCandidates(){return this.values.forEach((e=>{u(e)&&(e.type="value")})),this.values},getStructure(){return[...this.listAttributes()]},getProperty(e,t){if("refname"===e){if(g(this.ref))return;return this.ref.name}if("name"===e)return this.name;if("value"===e)return this.value;if(!this.hasProperty(e))return;let i=this.schema.properties.find((t=>t.name===e));const{type:s,value:n}=i;return"string"===s?yt.call(this,n):"number"===s?+n:"boolean"===s?L(n):n},hasProperty(e){return!!["refname","name","value"].includes(e)||-1!==a(this.schema.properties,[]).findIndex((t=>t.name===e))},getConstraint(e){if(this.hasConstraint(e))return this.constraint[e]},hasConstraint(e){return!g(this.constraint)&&(!!g(e)||E(this.constraint,e))},hasParent(){return!this.isRoot()},getParent(e){if(this.isRoot())return null;if(f(e))return this.parent;const t=this.parent;return t.name===e?t:t.getParent(e)},getParentWith(e){if(this.isRoot())return null;if(f(e))return this.parent;const t=this.parent;return t.hasPrototype(e)?t:t.getParentWith(e)},hasPrototype(e){if(g(this.schema.prototype))return!1;let t=this.model.getConceptSchema(this.schema.prototype);for(;!g(t);){if(t.name===e)return!0;t=this.model.getConceptSchema(t.prototype)}return!1},getAncestor(e){const t=[];for(var i=this.getParent(e);i;)t.push(i),i=i.getParent(e);return t},getChildren(e){const t=[];return g(e)?this.getAttributes().forEach((e=>{t.push(e.target)})):this.getAttributes().forEach((i=>{i.target.name===e?t.push(i.target):t.push(...i.target.getChildren(e))})),t},getDescendant(e){const t=[];return this.getChildren(e).forEach((i=>{t.push(i),t.push(...i.getDescendant(e))})),t},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}this.getChildren().forEach((e=>{e&&e.delete(!0)}));try{this.model.removeConcept(this.id)&&this.notify("delete")}catch(e){return console.error(this),{message:"Concept not found",success:!1}}return{message:`The concept '${this.name}' was successfully deleted.`,success:!0}},copy(e=!0){const t={name:this.name,nature:this.nature};var i=[];return this.getAttributes().forEach((e=>{i.push({name:e.name,value:e.copy(!1)})})),t.attributes=i,e&&this.model.addValue(t),t},clone(){const e={id:this.id,name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.clone()})})),e.attributes=t,e},export(){const e={id:this.id,root:this.isRoot(),name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.export()})})),e.attributes=t,e},toString(){var e={};return this.attributes.forEach((t=>{Object.assign(e,t.toString())})),e},toXML(){let e=this.getName().replace(" ","-");return`<${e} id="${this.id}">`+this.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function yt(e){if(c(e))return e;const{type:t}=e;switch(t){case"concat":return Et.call(this,e.concat)}}function wt(e,t){const{type:i}=e;return"string"===i?yt.call(this,e.value):"property"===i?this.getProperty(e.name):t||e}function Et(e,t=""){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");return e.length<2?wt.call(this,e[0]):e.map((e=>wt.call(this,e))).join(t)}const Ct=Object.assign(bt,gt,vt);Object.defineProperty(Ct,"attributeSchema",{get(){return this.schema.attributes}}),Object.defineProperty(Ct,"_prototype",{get(){return this.schema.prototype}}),Object.defineProperty(Ct,"hasError",{get(){return this.errors&&!l(this.errors)}});const jt={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.default=a(this.schema.default,!0),this.description=this.schema.description,this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if(g(e))return this.value=this.default,this;if(u(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return!g(this.value)},getValue(){return this.value},setValue(e){let t=u(e)?e.value:e;return 200!==this.validate(t)?{success:!1,message:"Validation failed: The value could not be updated."}:(this.value=L(t),this.notify("value.changed",t),{success:!0,message:"The value has been successfully updated."})},restore(e){const{value:t}=e;this.setValue(t)},update:(e,t)=>!0,getCandidates:()=>[!0,!1],getChildren:e=>[],validate(e){return this.errors=[],c(e)&&["true","false"].includes(e.toLowerCase())||Number.isInteger(e)&&[1,0].includes(e)||[!0,!1].includes(e)?200:400},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}},Lt=Object.assign(Object.create(Ct),jt);function xt(e,t){switch(e){case 400:return{success:!1,message:"The value is not a number."};case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum allowed: ${t.value}.`};case 402:return{success:!1,message:`Minimum allowed: ${t.value}.`};case 404:return{success:!1,message:`Value allowed: ${t.value}.`}}}const _t={nature:"primitive",initValue(e){if(g(e))return this.value=this.default,this;if(u(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return"number"==typeof this.value&&!isNaN(this.value)},getValue(){return this.hasValue()?+this.value:null},setValue(e){let t=u(e)?e.value:e;const{code:i,ctx:s}=this.validate(t);return this.value!==t&&(this.value=f(t)?null:+t,this.notify("value.changed",t)),200!==i?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},restore(e){const{value:t}=e;this.setValue(t)},getCandidates(){return this.values.forEach((e=>{u(e)&&(e.type="value")})),this.values},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(this.errors=[],isNaN(e)){let e=400;return this.errors.push(xt.call(this,e).message),{code:e}}if(!this.hasConstraint())return{code:200};if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("range"===i){const{min:s,max:n}=t[i];if(s&&e.length<s.value){let e=402;return this.errors.push(xt.call(this,e,s).message),{code:e,ctx:s}}if(n&&e.length>n.value){let e=403;return this.errors.push(xt.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=t[i];if(e.length!==s){let e=404;return this.errors.push(xt.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("values")){let t=this.getConstraint("values").map((e=>At.call(this,e))).flat(),i=!1;for(let s=0;!i&&s<t.length;s++){const n=t[s];i=u(n)?n.value===e:n===e}if(!i){let e=401;return this.errors.push(xt.call(this,e,t).message),{code:e,ctx:t}}}return 200},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function At(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}const Ot=Object.assign(Object.create(Ct),_t),St={nature:"primitive",reference:null,path:null,init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.path=this.schema.path,this.values=a(this.schema.values,[]),this.description=this.schema.description,this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){return g(e)||this.setValue(e.value),this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!f(this.value)},getValue(e=!1){return g(this.value)?null:e?this.reference:this.value},removeValue(){return this.reference&&this.reference.unregister(this),this.reference=null,this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getReference(){return g(this.reference)?null:this.reference},setValue(e,t=!0){let i=u(e)?e.id:e;return 200!==this.validate(i)?{success:!1,message:"Validation failed: The value could not be updated."}:g(i)||this.value===i?{success:!0,message:"The value has been ignored."}:(this.reference&&this.reference.unregister(this),this.value=i,this.reference=this.model.getConcept(i),g(this.reference)&&t?setTimeout((()=>this.setValue(e,!1)),20):(this.reference.register(this),this.notify("value.changed",this.reference)),{success:!0,message:"The value has been successfully updated."})},getCandidates(){if(g(this.accept))throw new Error("Bad reference: 'accept' property is not defined");var e=It.call(this,this.accept);return this.path&&Vt(this,this.path).map((e=>({type:this.accept.type,value:e}))),e},getChildren(e){return g(this.reference)||e&&this.reference.name!==e?[]:[this.reference]},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(e){return this.errors=[],g(e)||this.model.hasConcept(e)?200:(this.errors.push("This element is not valid"),401)},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function It(e){const{name:t,scope:i,rel:s}=e;return"parent"===s?this.getParent(i).getChildren(t):"children"===s?this.getChildren(t):this.model.isPrototype(t)?this.model.getConceptsByPrototype(t):this.model.getConcepts(t)}function Vt(e,t){if(g(t))return e;const{target:i,value:s,rel:n}=t;var r=[];return"parent"===n?r.push(e.getParentWith(i)):"children"===n?r.push(...e.getChildren(i)):"property"===n&&r.push(e.getProperty(i)),r.map((e=>Vt(e,s))).flat()}const Rt=Object.assign({},Ct,St),Mt={SUCCESS:200,INVALID_VALUE:401,MIN_CARDINALITY_ERROR:402,MAX_CARDINALITY_ERROR:403,FIX_CARDINALITY_ERROR:404};function Tt(e,t){switch(e){case Mt.INVALID_VALUE:return{success:!1,message:`Valid values: ${t}`};case Mt.MAX_CARDINALITY_ERROR:return{success:!1,message:`Maximum cardinality: ${this.value.length}/${t.value}.`};case Mt.MIN_CARDINALITY_ERROR:return{success:!1,message:`Minimum cardinality: ${this.value.length}/${t.value}.`};case Mt.FIX_CARDINALITY_ERROR:return{success:!1,message:`Fixed cardinality: ${t.value}.`};case Mt.PATTERN_ERROR:return{success:!1,message:"The value is not valid."}}}const kt={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.description=this.schema.description,this.ordered=a(this.schema.ordered,!0),this.constraint=this.schema.constraint,this.value=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){this.removeAllElement();let t=Nt.call(this);if(g(e)){let e=t;for(let t=0;t<e;t++)this.createElement();return this}const{id:i="",name:s,value:n}=e;i.length>10&&(this.id=i);for(let e=0;e<n.length;e++)this.createElement(n[e]);let r=t-n.length;for(let e=0;e<r;e++)this.createElement();return this},hasValue(){return!l(this.value)},getValue(e=!1){const t=this.value.map((e=>this.model.getConcept(e)));return e?t.map((e=>e.getValue())):t},removeValue(e){return this.hasValue()?(this.removeElement(e),{success:!0,message:"The value has been successfully updated."}):{success:!0,message:"The value has been successfully updated."}},isValidElement(e){const{name:t,accept:i}=this.accept;return this.model.isPrototype(t)?g(i)?this.model.hasPrototype(e.name,t):Array.isArray(i)?i.some((t=>t.name===e.name)):i.name===e.name:this.accept.name===e.name},setValue(e){let t=e.value||e;if(Array.isArray(t)){this.removeAllElement();for(let e=0;e<t.length;e++)this.createElement(t[e]);this.notify("value.changed",t)}else this.isValidElement(t)&&(this.createElement(t),this.notify("value.changed",t))},restore(e){const{value:t}=e;t.forEach(((e,t)=>{this.value.includes(e.id)||this.createElement(e)}))},getElements(){return this.value.map((e=>this.model.getConcept(e)))},getElement(e){var t=this.value.find((t=>t===e));if(!g(t))return this.model.getConcept(t)},getElementAt(e){if(!(e<0||e>=this.value.length))return this.model.getConcept(this.value[e])},getFirstElement(){return this.getElementAt(0)},getLastElement(){return this.getElementAt(this.count-1)},addElement(e){return!g(e)&&(this.value.push(e.id),e.index=this.value.length-1,this.validate(),this.notify("value.added",e),!0)},addElementAt(e,t=0){return g(e)&&(e=this.createElement()),this.value.splice(t,0,e.id),this.validate(),this.notify("value.added",e),this},swapElement(e,t){if(!this.ordered)return this;let i=this.value[e];this.value[e]=this.value[t],this.value[t]=i;let s=this.getElementAt(e);s.index=+e;let n=this.getElementAt(t);return n.index=+t,this.notify("value.swapped",[s,n]),this},removeElement(e){let t=this.value.indexOf(e.id);return-1!==t&&this.removeElementAt(t)},removeElementAt(e){let t=this.getElementAt(e);if(g(t))return{message:`The element at index '${e}' was not found.`,success:!1};t.delete(!0),this.value.splice(e,1);const i=this.getValue();for(let t=e;t<i.length;t++)i[t].index=t;return this.validate(),this.notify("value.removed",t),{message:`The element '${t.name}' was successfully removed.`,success:!0}},removeAllElement(){return this.value.forEach((e=>{this.model.removeConcept(e)})),this.value=[],this.notify("value.changed",this.value),this},createElement(e){const t={value:this.model.getValue(e),parent:this,ref:this},i=this.model.createConcept(this.accept,t);return this.addElement(i),i},getProperty(e,t){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e||"cardinality"===e)return this.value.length;let i=a(this.schema.properties,[]).find((t=>t.name===e));if(g(i))return;const{type:s,value:n}=i;return"string"===s?n:"number"===s?+n:"boolean"===s?L(n):n},hasProperty(e){return!!["refname","name","value","length","cardinality"].includes(e)||-1!==a(this.schema.properties,[]).findIndex((t=>t.name===e))},getCandidates(){return Ht.call(this,this.accept)},getChildren(e){if(!this.hasValue())return[];const t=this.getElements();return g(e)?t:t.filter((t=>t.name===e))},validate(){if(this.errors=[],!this.hasConstraint())return{code:Mt.SUCCESS};if(this.hasConstraint("cardinality")){let e=this.getConstraint("cardinality");const{type:t}=e;if("range"===t){const{min:i,max:s}=e[t];if(i&&this.value.length<i.value){let e=Mt.MIN_CARDINALITY_ERROR;return this.errors.push(Tt.call(this,e,i).message),{code:e,ctx:i}}if(s&&this.value.length>s.value){let e=Mt.MAX_CARDINALITY_ERROR;return this.errors.push(Tt.call(this,e,s).message),{code:e,ctx:s}}}else if("fixed"===t){const{value:i}=e[t];if(this.value.length!==i){let i=Mt.FIX_CARDINALITY_ERROR;return this.errors.push(Tt.call(this,i,e[t]).message),{code:i,ctx:e[t]}}}}return{code:Mt.SUCCESS}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue().map((e=>e.copy(!1)))};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue().map((e=>e.clone()))}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.value}},toString(){return this.getValue().map((e=>e.toString()))},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue().map((e=>e.toXML())).join("")+`</${e}>`}};function Nt(){if(!this.hasConstraint("cardinality"))return 0;const e=this.getConstraint("cardinality"),{type:t}=e;if("range"===t){const{min:i}=e[t];return i.value}if("fixed"===t){const{value:i}=e[t];return i}return 0}function Ht(e){return this.model.getConceptSchema(e)}const Pt=Object.assign(Object.create(Ct),kt);Object.defineProperty(Pt,"count",{get(){return this.value.length}}),Object.defineProperty(Pt,"canAddValue",{get:()=>!0});const $t=200,Dt=405;function Bt(e,t){switch(e){case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum length: ${t.value}.`};case 402:return{success:!1,message:`Minimum length: ${t.value}.`};case 404:return{success:!1,message:`Fixed length: ${t.value}.`};case Dt:return{success:!1,message:"The value is not valid."}}}const Ft={nature:"primitive",initValue(e){if(g(e))return this.value=this.default,this;if(u(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!f(this.value)},getValue(){return this.value},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},setValue(e){let t=u(e)?e.value:e;var{code:i,ctx:s}=this.validate(t);return this.value!==t&&(this.value=t,this.notify("value.changed",t)),i!==$t?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},getProperty(e,t){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e)return this.value.length;let i=a(this.schema.properties,[]).find((t=>t.name===e));if(g(i))return;const{type:s,value:n}=i;return"string"===s?n:"number"===s?+n:"boolean"===s?L(n):n},hasProperty(e){return!!["refname","name","value","length"].includes(e)||-1!==a(this.schema.properties,[]).findIndex((t=>t.name===e))},getCandidates(){let e=a(this.getConstraint("values"),[]);return l(e)?[...this.src.map((e=>{if("reference"===e.type){const{source:t,target:i}=e;let s=this.model.environment.getModel(t.name||t);if(g(s))return null;let n=s.concept||s;if(!Array.isArray(n))return null;if(n.forEach((e=>{const t=function(e,t){var i=t;const s=[],n=t=>{let i=e.find((e=>e.name===t));if(!g(i))return ut(i)};for(;!g(i);){const e=a(n(i),{});r=e.attributes,Array.isArray(r)&&r.forEach((e=>{const t=s.find((t=>t.name===e.name));g(t)?s.push(e):(e.required&&(t.required=e.required),e.description&&(t.description=e.description))})),i=e.prototype}var r;return{attributes:s}}(n,e.prototype);e.attributes.push(...t.attributes)})),g(i.rel))return n.map((e=>e[i.value]));let r=Wt.call(this,i,n);return g(r)?[]:r}return e}))].flat().filter((e=>!g(e))):e.map((e=>zt.call(this,e))).flat().filter((e=>!f(e)))},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(this.errors=[],f(e))return{code:$t};if(!this.hasConstraint())return{code:$t};if(this.hasConstraint("length")){let t=this.getConstraint("length");const{type:i}=t;if("range"===i){const{min:s,max:n}=t[i];if(s&&e.length<s.value){let e=402;return this.errors.push(Bt.call(this,e,s).message),{code:e,ctx:s}}if(n&&e.length>n.value){let e=403;return this.errors.push(Bt.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=t[i];if(e.length!==s){let e=404;return this.errors.push(Bt.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("pattern"===i){const{value:i,insensitive:s=!0,global:n=!0}=t.pattern;let r="";if(s&&(r+="g"),n&&(r+="i"),!new RegExp(i,r).test(e)){let e=Dt;return this.errors.push(Bt.call(this,e,t.pattern).message),{code:e,ctx:t.pattern}}}else if(i==="match".startsWith){const{start:s,end:n}=t[i];if(s&&!e.startsWith<s.value){let e=Dt;return this.errors.push(Bt.call(this,e,t.match).message),{code:e,ctx:t.match}}if(n&&e.length>n.value){let e=Dt;return this.errors.push(Bt.call(this,e,t.match).message),{code:e,ctx:t.match}}}}if(this.hasConstraint("values")){let t=this.getConstraint("values").map((e=>zt.call(this,e))).flat(),i=!1;for(let s=0;!i&&s<t.length;s++){const n=t[s];i=u(n)?n.value===e:n===e}if(!i){let e=401;return this.errors.push(Bt.call(this,e,t).message),{code:e,ctx:t}}}return{code:$t}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function zt(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}if("meta-reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}function Wt(e,t){const{name:i,rel:s,scope:n,value:r}=e;let a=null;if("parent"===s){let e=this.getParent(i);if(g(r))return e;if("reference"===r.type)return Wt.call(e,r);if("attribute"===r.type)return e.getAttributeByName(r.name).getValue()}if("children"===s){let e=this.getChildren(i);if(g(r))return e;if("reference"===r.type)return e.map((e=>Wt.call(e,r)));if("attribute"===r.type)return e.filter((e=>Jt(e,r.name)&&Xt(e,r.name))).map((e=>Ut(e,r.name)))}if(e.source){const{type:t,value:i}=e.source;a="reference"===t?Wt.call(this,e.source):i}if(g(a))return t.map((e=>e[i].map((e=>e[r]))));if(d(a)&&l(a))return[];let o=t.find((e=>Array.isArray(a)?a.includes(e.name):e.name===a));return g(o)||!E(o,i)?[]:o[i].map((e=>e[r]))}const qt=(e,t)=>e.getAttributeByName(t).target,Ut=(e,t)=>qt(e,t).getValue(),Xt=(e,t)=>qt(e,t).hasValue(),Jt=(e,t)=>e.isAttributeCreated(t),Gt=Object.assign(Object.create(Ct),Ft),Yt={nature:"concrete",initValue(e){if(g(e))return!1;const{id:t="",attributes:i=[]}=e;return t.length>10&&(this.id=t),i.forEach((e=>{const{name:t,id:i,value:s}=e;this.createAttribute(t,s)})),!0},restore(e){const{attributes:t}=e;t.forEach((e=>{const{name:t,id:i,value:s}=e;this.isAttributeCreated(t)||this.createAttribute(t,s)}))},hasValue:()=>!0,getValue(){return{name:this.name,attributes:this.getAttributes().map((e=>({name:e.name,value:e.copy(!1)})))}},setValue(e){const{attributes:t=[]}=e;return t.forEach((e=>{const{name:t,id:i,value:s}=e;this.hasAttribute(t)&&this.createAttribute(t,s)})),!0}},Kt=Object.assign(Object.create(Ct),Yt),Zt=200;function Qt(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const ei={name:"prototype",nature:"prototype",initValue(e){if(g(e)){if(this.default){let e=this.createConcept(this.default);this.setValue(e)}return this}const{id:t="",value:i}=e;t.length>10&&(this.id=t);let s=null;return i?(s=this.createConcept(i.name,i),this.setValue(s)):e.name&&e.attributes&&(s=this.createConcept(e.name,e),this.setValue(s)),this},getValue(e=!1){return g(this.value)?null:e?this.target:this.value},getTarget(){return this.target},restore(e){const{value:t}=e;if(g(t))return;let i=this.createConcept(t.name,t);this.setValue(i)},setValue(e){let t=e.name||e;if(this.validate(t)!==Zt)return{success:!1,message:"Validation failed: The value could not be updated."};let i=e;if(e&&"concept"===e.object&&E(e,"id")||(i=e.attributes?this.createConcept(t,e):this.createConcept(t)),this.target){let e=this.target.copy(!1);i.setValue(e),this.target.delete(!0)}return this.target=i,this.value=t,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},removeValue(){return g(this.value)||(this.value=null,this.notify("value.changed",this.value)),{success:!0,message:"The value has been successfully updated."}},hasValue(){return!g(this.value)},getCandidates(){return this.candidates||(this.candidates=ti.call(this,this.schema.accept).map((e=>({type:"meta-concept",name:e.name,concept:Object.create(ii,{object:{value:"meta-concept"},type:{value:"meta-concept"},name:{value:e.name},model:{value:this.model},schema:{value:e}})})))),this.candidates},getChildren(e){if(!this.hasValue())return[];const t=[];return(g(e)||this.target.name===e)&&t.push(this.target),t},createConcept(e,t){let i=this.model.getValue(t);const s={parent:this,ref:this};i&&(s.value=i);const n=this.model.createConcept(e,s);return n.prototype=this,n},validate(e){if(f(e))return Zt;if(l(this.values))return Zt;var t=!1;for(let i=0;!t&&i<this.values.length;i++){const s=this.values[i];t=u(s)?s.value===e:s===e}if(!t){let e=401;return this.errors.push(Qt.call(this,e).message),e}return Zt},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.target.copy(!1)};return e&&this.model.addValue(t),t},clone(){let e=null;return this.hasValue()&&(e=this.target.clone()),{id:this.id,name:this.name,value:e}},export(){let e=null;return this.hasValue()&&(e={id:this.target.id,name:this.target.name}),{id:this.id,name:this.name,root:this.isRoot(),value:e}},toXML(){if(!this.hasValue())return"";let e=this.getName();return`<${e} id="${this.id}">`+this.target.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function ti(e){const t=this.model.getConcreteConcepts(this.name);return g(e)?t:Array.isArray(e)?t.filter((t=>e.some((e=>e.name===t.name)))):t.filter((t=>e===t.name))}const ii={getProperty(e,t){if("refname"===e)return this.name;if("name"===e)return this.name;let i=a(this.schema.properties,[]).find((t=>t.name===e));if(g(i))return;const{type:s,value:n}=i;return"string"===s?n:"number"===s?+n:"boolean"===s?L(n):n},hasPrototype(e){if(g(this.schema.prototype))return!1;let t=this.model.getConceptSchema(this.schema.prototype);for(;!g(t);){if(t.name===e)return!0;t=this.model.getConceptSchema(t.prototype)}return!1}},si=Object.assign({},Ct,ei);function ni(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const ri={name:"meta",reference:null,initValue(e){return g(e)||this.setValue(e.value),this},hasValue(){return!f(this.value)},getValue(){return g(this.value)?null:this.value},getProperty(e){const t=this.schema[e];if(u(t)){const e=[];for(const i in t){const s=t[i];e.push(Object.assign({},{name:i},s))}return e}return t},setValue(e){var t=this.validate(e);return 200!==t?{success:!1,message:"Validation failed: The value could not be updated.",errors:[ni(t).message]}:g(e)||this.value===e?void 0:(this.reference&&this.reference.unregister(this),this.reference=this.model.getConcept(e),this.reference.register(this),this.value=e,this.notify("value.changed",this.reference),{success:!0,message:"The value has been successfully updated."})},getChildren:e=>[],delete(e=!1){if(!e){let e=this.getParent().remove(this);if(!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(e){return f(e)||l(this.values),200},export(){return{id:this.id,name:this.name,value:this.value}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}},ai=Object.assign({},Ct,ri);function li(e,t){return{object:{value:"concept"},type:{value:"concept"},model:{value:e},name:{value:t.name},base:{value:t.base},schema:{value:t,writable:!0}}}const oi={boolean:(e,t)=>Object.create(Lt,li(e,t)),number:(e,t)=>Object.create(Ot,li(e,t)),reference:(e,t)=>Object.create(Rt,li(e,t)),set:(e,t)=>Object.create(Pt,li(e,t)),string:(e,t)=>Object.create(Gt,li(e,t)),meta:(e,t)=>Object.create(ai,li(e,t))},ci={primitive:(e,t)=>oi[t.name](e,t),prototype:(e,t)=>Object.create(si,li(e,t)),concrete:(e,t)=>Object.create(Kt,li(e,t)),derivative:(e,t)=>oi[t.base](e,t)},hi={createConcept(e,t,i){const{name:s,nature:n}=t,r=ci[n];if(g(r))throw new Error(`Missing handler: The '${s}' concept could not be handled`);const a=r(e,t);if(g(a))throw new Error(`Bad request: The '${s}' concept could not be created`);return a.init(i),g(a.id)&&(a.id=dt.generate()),a}};var ui=0;const di={concepts:null,values:null,listeners:null,get hasError(){return this.concepts.some((e=>e.hasError))},init(e){return this.concepts=[],this.values=[],this.listeners=[],Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})})),this.values=e.filter((e=>e.id.startsWith("value")))),this},done(){return this.concepts.forEach((e=>{e.unregisterAll()})),this.concepts=[],!0},createConcept(e,t){const i=this.getCompleteModelConcept(e);var s=hi.createConcept(this,i,t);return this.addConcept(s),s},getConcepts(e){if(d(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.concepts.filter((e=>t(e)))}return this.concepts.slice()},getRootConcepts(){return this.concepts.filter((e=>e.isRoot()))},getConceptsByPrototype(e){return this.concepts.filter((t=>t.hasPrototype(e)))},getConcept(e){if(!c(e)||l(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");return this.concepts.find((t=>t.id===e))},addConcept(e){if(g(e))throw new TypeError("Bad request: The 'concept' argument must be a Concept");return this.concepts.push(e),e.register(this.environment),this},removeConcept(e){if(!u(e)&&!c(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.concepts.findIndex((t=>t.id===e));return-1===t?null:this.concepts.splice(t,1)[0]},hasConcept(e){if(!u(e)&&!c(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");if(l(this.concepts))return!1;let t=e.id||e;return e.name,this.concepts.some((e=>e.id===t))},getValues(e){if(d(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.values.filter((e=>t(e)))}return this.values.slice()},getValue(e){return g(e)?null:E(e,"value")||E(e,"attributes")?e:E(e,"id")?this.values.find((t=>t.id===e.id)):this.values.find((t=>t.id===e))},addValue(e){if(g(e))throw new TypeError("Bad request: The 'value' argument must be a Value");return this.values.some((t=>{return s=e,(i=t).name===s.name&&(i.value?i.value===s.value:JSON.stringify(i.attributes)===JSON.stringify(s.attributes));var i,s}))||(e.id="value"+ui++,this.values.push(e),this.notify("value.added",e)),this},removeValue(e){if(!u(e)&&!c(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.values.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.values.splice(t,1)[0];return this.notify("value.removed",i),i},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){let t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t)}))},isConcept(e){return!!c(e)&&-1!==this.schema.findIndex((t=>t.name===e))},isConcrete(e){if(!c(e))return!1;const t=this.schema.find((t=>t.name===e));return!g(t)&&"concrete"===t.nature},isPrototype(e){if(!c(e))return!1;const t=this.schema.find((t=>t.name===e));return!g(t)&&"prototype"===t.nature},hasPrototype(e,t){if(!this.isConcept(e))return!1;let i=this.getConceptSchema(e);for(;!g(i);){if(i.prototype===t)return!0;i=this.model.getConceptSchema(i.prototype)}return!1},getSchema(e){if(d(e)){const t=Array.isArray(e)?t=>e.includes(t.nature):t=>t.nature===e;return this.schema.filter((e=>t(e)))}return this.schema.slice()},getConceptSchema(e){const t=fi(this.schema,e);if(!g(t))return ut(t)},getCompleteModelConcept(e){let t=e;c(e)&&(t={name:e});const i=this.getConceptSchema(t.name);if(g(i))return;Object.assign(i,t),E(i,"attributes")||(i.attributes=[]);const s=pi.call(this,i.prototype);return i.attributes.push(...s.attributes),i},getConcreteConcepts(e){const t=t=>{for(var i=t.prototype;!g(i);){if(i===e)return!0;i=a(fi(this.schema,i),{}).prototype}return!1},i=this.schema.filter((e=>"concrete"===e.nature));return e?i.filter((e=>t(e))):i},getDerivedConcepts(e){if(g(e))throw new TypeError("Bad argument");return this.schema.filter((t=>t.base===e))},export(){const e=[];return this.getConcepts().forEach((t=>{e.push(t.export())})),e.push(...this.getValues()),e},toString(){return JSON.stringify({[this.root.name]:this.root.toString()})},toXML(){return"<model:gentleman>"+this.getRootConcepts().map((e=>e.toXML())).join("")+"</model:gentleman>"}};function pi(e){var t=e;const i=[];for(;!g(t);){const e=a(this.getConceptSchema(t),{});s=e.attributes,Array.isArray(s)&&s.forEach((e=>{const t=i.find((t=>t.name===e.name));g(t)?i.push(e):(e.required&&(t.required=e.required),e.description&&(t.description=e.description))})),t=e.prototype}var s;return{attributes:i}}const mi=[{name:"string",nature:"primitive"},{name:"number",nature:"primitive"},{name:"boolean",nature:"primitive"},{name:"reference",nature:"primitive"},{name:"set",nature:"primitive"}];function fi(e,t){let i=e.find((e=>e.name===t));return g(i)&&(i=mi.find((e=>e.name===t))),i}const vi=[],gi={createModel(e,t){var i=Object.create(di,{schema:{value:e},environment:{value:t}});return vi.push(i),i}};function bi(e){const{type:t}=e;let i=this.concept||this.source;return"property"===t?a(i.getProperty(e.name),""):"param"===t?this.projection.getParam(e.name):e}const yi={css:function(e,t){return d(t)?(Li(e,t),e):e},ref:function(e,t){return d(t)?(t.forEach((t=>{const{style:i={}}=a(this.model.getStyleSchema(t),{});i.gss?Ei.call(this,e,i):Ci.call(this,e,i)})),e):e},gss:Ci,text:ji,box:Oi,html:function(e,t){return d(t)?(t.forEach((t=>{let i=`style${s=t.name,f(s)?s:s.charAt(0).toUpperCase()+s.slice(1)}`;var s;e.dataset[i]=bi.call(this,t.value),"property"===t.value.type&&this.registerHandler("value.changed",(s=>{e.dataset[i]=bi.call(this,t.value)}))})),e):e}},wi={text:ji,box:Oi};function Ei(e,t){if(!u(t))return e;for(const i in t){const s=t[i];let n=yi[i];h(n)&&n.call(this,e,s)}return e}function Ci(e,t){if(!u(t))return e;for(const i in t){const s=t[i];let n=wi[i];h(n)&&n.call(this,e,s)}return e}function ji(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"bold":e.style.fontWeight=_i(s);break;case"italic":e.style.fontStyle="italic";break;case"underline":e.style.textDecoration="underline";break;case"strikethrough":e.style.textDecoration="line-through";break;case"color":e.style.color=xi(s);break;case"font":e.style.fontFamily=s.toString();break;case"size":e.style.fontSize=Ai(s);break;case"transform":e.style.textTransform=s}}return e}function Li(e,t){if(Array.isArray(t))e.classList.add(...t);else{let i=t.replace(/\s+/g," ").trim();f(e.className)?e.className=i:Li(e,i.split(" "))}return e}function xi(e){if(g(e))return"";const{type:t,value:i}=e;switch(t){case"rgb":return u(i)?`rgb(${i.red}, ${i.green}, ${i.blue})`:i;case"name":case"hexadecimal":return i;default:return i||e}}function _i(e){if(g(e))return"";const{type:t,value:i}=e;return Number.isInteger(e)?`${e}`:"bold"}function Ai(e){if(g(e))return"";const{value:t=0,unit:i}=e;return`${t}${i}`}function Oi(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"inner":Si.call(this,e,s,"padding");break;case"outer":Si.call(this,e,s,"margin");break;case"border":Vi.call(this,e,s);break;case"corner":Ri.call(this,e,s);break;case"background":Ii.call(this,e,s);break;case"width":e.style.width=Ai.call(this,s);break;case"height":e.style.height=Ai.call(this,s);break;case"opacity":e.style.opacity=s/100}}return e}function Si(e,t,i){if(!g(t))for(const s in t){const n=t[s];switch(s){case"all":e.style[`${[i]}`]=Ai.call(this,n);break;case"top":e.style[`${[i]}Top`]=Ai.call(this,n);break;case"right":e.style[`${[i]}Right`]=Ai.call(this,n);break;case"bottom":e.style[`${[i]}Bottom`]=Ai.call(this,n);break;case"left":e.style[`${[i]}Left`]=Ai.call(this,n)}}}function Ii(e,t){if(g(t))return;const{color:i,image:s}=t;i&&(e.style.backgroundColor=xi.call(this,i)),s&&(e.style.backgroundImage=`url(${s})`)}function Vi(e,t){if(!g(t))for(const i in t){const s=t[i];switch(i){case"all":e.style.borderStyle=a(s.type,"solid"),e.style.borderWidth=Ai.call(this,s.width),e.style.borderColor=xi.call(this,s.color);break;case"top":e.style.borderTopStyle=a(s.type,"solid"),e.style.borderTopWidth=Ai.call(this,s.width),e.style.borderTopColor=xi.call(this,s.color);break;case"right":e.style.borderRightStyle=a(s.type,"solid"),e.style.borderRightWidth=Ai.call(this,s.width),e.style.borderRightColor=xi.call(this,s.color);break;case"bottom":e.style.borderBottomStyle=a(s.type,"solid"),e.style.borderBottomWidth=Ai.call(this,s.width),e.style.borderBottomColor=xi.call(this,s.color);break;case"left":e.style.borderLeftStyle=a(s.type,"solid"),e.style.borderLeftWidth=Ai.call(this,s.width),e.style.borderLeftColor=xi.call(this,s.color)}}}function Ri(e,t){if(g(t))return;const{radius:i}=t;i&&Mi.call(this,e,t.radius)}function Mi(e,t){if(!g(t))for(const i in t){const s=t[i];switch(i){case"all":e.style.borderRadius=Ai.call(this,s);break;case"top-left":e.style.borderTopLeftRadius=Ai.call(this,s);break;case"top-right":e.style.borderTopRightRadius=Ai.call(this,s);break;case"bottom-right":e.style.borderBottomRightRadius=Ai.call(this,s);break;case"bottom-left":e.style.borderBottomLeftRadius=Ai.call(this,s)}}}function Ti(e,t){if(!Array.isArray(t))return!1;e.currentState=null;for(let i=0;i<t.length;i++){const s=t[i],{rule:n,result:r}=s;if(g(n))return r;let a=!1,l=ki[n.type];if(h(l)&&(a=l.call(this,n[n.type])),a)return e.currentState=i,r}return null}const ki={ref:function(e){const{rule:t={}}=a(this.model.getRuleSchema(e),{});let i=ki[t.type];return!!h(i)&&i.call(this,t[t.type])},eq:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Ni.call(this,e[0])==Ni.call(this,e[1])},ne:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Ni.call(this,e[0])!=Ni.call(this,e[1])},lt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Ni.call(this,e[0])<Ni.call(this,e[1])},le:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Ni.call(this,e[0])<=Ni.call(this,e[1])},gt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Ni.call(this,e[0])>Ni.call(this,e[1])},ge:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Ni.call(this,e[0])>=Ni.call(this,e[1])},and:function(e){return Hi.call(this,e[0])&&Hi.call(this,e[1])},or:function(e){return Hi.call(this,e[0])||Hi.call(this,e[1])},not:function(e){return!Hi.call(this,e[0])},no:function(e){let t=Ni.call(this,e);return d(t)?l(t):g(t)}};function Ni(e,t){if(e&&"property"===e.type){const{name:t}=e;let i=`get${j(t)}`;return this[i]?this[i]():this[t]}if(e&&"param"===e.type){const{name:t}=e;return this.projection.getParam(t)}if(u(e)){let t=`get${j(e.prop)}`;return this[t]?this[t]():this[e.prop]}return t||e}function Hi(e){let t=ki[e.type];return h(t)?t.call(this,e[e.type]):L(Ni.call(this,e))}const Pi={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,children:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasError(){return this.source.hasError},get hasAttached(){return!l(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return h(e)?this.attached.filter((t=>e(t))):this.attached},getMessageElement(){return O(this.messageElement)||(this.messageElement=ie({class:["field-message","hidden"],dataset:{nature:"field-component",view:this.type,id:this.id}}),this.element.prepend(this.messageElement)),this.messageElement},show(){return We(this.element),this.visible=!0,this.active=!0,this},hide(){return qe(this.element),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},focus(e){return this.element.contentEditable=!1,this.element.focus(),this.focused=!0,this},getContainer(){return this.element},notify(e,t,i=4500){let s=this.getMessageElement();_e(s),s.append(function(e,t){var i=ee({class:["notification-message",`notification-message--${e}`]},t);return Array.isArray(t)?i.style.minWidth=`${Math.min(.5*t[0].length,30)}em`:i.style.minWidth=`${Math.min(.5*t.length,30)}em`,i}(t,e)),We(s)},append(e){if(!O(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.append(e),this},_focusIn:e=>!1,enable(){return this.disabled=!1,this},disable(){return this.disabled=!0,this},clear:()=>!0,delete(){var e=this.source.delete();e.success?(this.clear(),_e(this.element),this.element.remove()):(this.environment.notify(e.message),Xe(this.element))},spaceHandler(e){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){return console.warn(`ESCAPE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},enterHandler(e){this.focusOut()},deleteHandler(e){if(this.projection.element!==this)return Xe(e),!1;if(!this.projection.optional)return Xe(this.element),!1;let t=je(e,(e=>0===e.tabIndex)),i=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),i),this.source.delete();let s=this.environment.resolveElement(t);return g(s)||s.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){return console.warn(`ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()},shiftHandler(e,t){return console.warn(`SHIFT_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1}},$i=Object.assign(Pi);function Di(e){const{type:t}=e;return"property"===t?(this.hasProperty=!0,a(this.source.getProperty(e.name),"")):"param"===t?this.projection.getParam(e.name):"html"===t?R(e.html):"raw"===t?R(e.raw):e}const Bi={input:null,label:null,value:"",state:null,init(){const{focusable:e=!0}=this.schema;return this.focusable=e,this.children=[],this},refresh(){if(a(Ti.call(this,this.schema,this.schema.state),this.schema),this.schema.state){let e=this.schema.state[this.getValue().toString()];if(e&&e.content){const{style:t,content:i,value:s}=e;let n=D();i.forEach((e=>{n.append(Bs.call(this,e))})),_e(this.label).append(n),Ei.call(this.projection,this.label,t)}}this.input.checked?this.element.dataset.state="on":this.element.dataset.state="off",this.hasError?(this.element.classList.add("error"),this.input.classList.add("error")):(this.element.classList.remove("error"),this.input.classList.remove("error"))},render(){const e=D(),{checkbox:t}=this.schema;var i;if(O(this.element)||(this.element=(i=this.id,U({id:i,class:["field","field--binary"],tabindex:-1,dataset:{nature:"field",view:"binary",id:i}})),this.readonly&&this.element.classList.add("readonly"),Ei.call(this.projection,this.element,this.schema.style)),!O(this.input)){if(this.input=function(e){return se({id:`checkbox${e}`,type:"checkbox",class:["field--binary__input"],tabindex:0,dataset:{nature:"field-component",view:"binary",id:e}})}(this.id),this.input.checked=this.source.getValue(),this.value=this.input.checked,this.readonly&&(this.input.classList.add("readonly"),this.input.disabled=!0),t){const{style:e}=t;Ei.call(this.projection,this.input,e)}else qe(this.input);e.append(this.input)}if(!O(this.label)){if(this.label=re({class:["field--checkbox__label"],for:this.input.id,tabindex:0,dataset:{nature:"field-component",view:"binary",id:this.id}}),this.label.htmlFor=this.input.id,t&&t.label){const{content:e}=t.label;if(Array.isArray(e))e.forEach((e=>{let t=Di.call(this,e),i=ee({class:["field--checkbox__label-content"],dataset:{ignore:"all"}},t);Ei.call(this.projection,i,e.style),this.label.append(i)}));else{let t=Di.call(this,e);this.label.append(t)}Ei.call(this.projection,this.label,t.label.style)}e.append(this.label)}return e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.value=this.input.checked,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.hasChanges()&&this.setValue(this.input.checked),this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.choice&&qe(this.choice),this.input.blur(),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!==this.input.checked},hasValue(){return this.input.checked},getValue(){return this.input.checked},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||this.environment.notify(i.message,"error"),this.input.checked=e,this.value=e,this.refresh()},getCandidates(){return this.source.getCandidates()},enable(){this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1},disable(){this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(qe(this.messageElement),t=!1),t){let t=je(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}},backspaceHandler(e){return this.arrowHandler("left",e)},enterHandler(e){this.setValue(!this.input.checked,!0)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,this.element)},bindEvents(){this.element.addEventListener("change",(e=>{this.setValue(this.getValue(),!0)})),this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},Fi=Object.assign(Object.create($i),Bi);function zi(e){const t=e=>e.parentElement===this.choices;return t(e)?e:je(e,t,5)}function Wi(e){const{type:t}=e.dataset;return t}function qi(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)).id:"meta-concept"===t?this.values.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const Ui=(e,t)=>"concept"===e.type?Ui(e.id,t):"concept"===t.type?Ui(e,t.id):"meta-concept"===e.type?Ui(e.name,t):"meta-concept"===t.type?Ui(e,t.name):e===t,Xi={value:null,placeholder:null,expanded:null,values:null,choices:null,input:null,items:null,selection:null,selectList:null,selectListValue:null,icoToggle:null,init(){const{focusable:e=!0,placeholder:t=!1,expanded:i=!0}=this.schema;return this.items=new Map,this.focusable=e,this.expanded=i,this.placeholder=t,this.children=[],E(this.schema,"choice")||(this.schema.choice={}),E(this.schema.choice,"option")||(this.schema.choice.option={}),this},hasChanges(){return this.value!=this.source.getValue()},reset(){this.source.removeValue()},hasValue(){return!g(this.value)},getValue(){return this.selection},setValue(e,t=!1){var i=null;if(t)return(i=this.source.setValue(e)).success||this.environment.notify(i.message,Ye.ERROR),!0;g(e)?(this.selection&&this.selection.classList.remove("selected"),this.expanded||_e(this.selectListValue),this.selection=null):this.setChoice(e),g(e)?this.value=null:"concept"===e.type?this.value=e.id:"meta-concept"===e.type?this.value=e.name:this.value=e;const{template:s={}}=this.schema.choice.option;if(this.selection&&!this.expanded&&e)if(_e(this.selectListValue),"meta-concept"===e.type){let t=this.model.getProjectionSchema(e.concept,a(s.tag))[0],i=t.type,n={type:i,[i]:t.content||t.projection},r=Bs.call(this,n,e.concept,{focusable:!1,meta:e.name});this.selectListValue.append(r)}else if("concept"===e.type){let t=this.model.createProjection(e,s.tag).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,this.selectListValue.append(t.render())}else this.selectListValue.append(e.toString());this.refresh()},refresh(){return this.hasValue()?(this.element.classList.remove("empty"),this.element.dataset.value=this.value.name||this.value):(this.element.classList.add("empty"),this.element.dataset.value="",!this.expanded&&this.placeholder&&_e(this.selectListValue).append(this.placeholder)),this.input&&(this.element.dataset.input=this.input.value),this.element.classList.remove("querying"),this.hasError?(this.element.classList.add("error"),this.input&&this.input.classList.add("error")):(this.element.classList.remove("error"),this.input&&this.input.classList.remove("error")),this},render(){const e=D(),{choice:t,input:i,style:s}=this.schema;if(O(this.element)||(this.element=U({id:this.id,class:["field","field--choice"],tabindex:-1,dataset:{nature:"field",view:"choice",input:"",id:this.id}})),!O(this.input)&&i){const{placeholder:t="",type:s,style:n}=i;let r=$s.call(this,t);this.input=se({class:["field--choice__input"],type:a(s,"text"),placeholder:r,title:r,dataset:{nature:"field-component",view:this.type,id:this.id}}),Ei.call(this,this.input,n),e.append(this.input)}if(!O(this.choices)){const{style:i}=t;this.choices=G({class:["bare-list","field--choice__choices"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),Ei.call(this,this.choices,i),e.append(this.choices)}if(!this.expanded){let t=U({class:["field--choice__select-wrapper"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}});this.selectListValue=U({class:["field--choice__select-value"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),this.icoToggle=ie({class:["field--choice__select-icon"],dataset:{nature:"field-component",view:"choice",id:this.id}}),t.append(this.selectListValue,this.icoToggle),this.selectList=U({class:["field--choice__select-list","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.input&&this.selectList.append(this.input),this.selectList.append(this.choices),e.append(t),e.append(this.selectList)}if(Ei.call(this,this.element,s),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),_e(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let t=Y({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(t),Ei.call(this,t,e)}return this.values=this.source.getCandidates(),this.values.forEach((e=>{this.choices.append(this.createChoiceOption(e))})),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},focus(e){if(this.expanded)if(this.choices.hasChildNodes()){let e=function(e){for(let t=0;t<e.children.length;t++){const i=e.children[t];if(!Ze(i))return i}return null}(this.choices);e&&e.focus()}else this.input&&!Ze(this.input)?this.input.focus():this.selection&&this.selection.focus();else this.input&&!Ze(this.input)?this.input.focus():this.selectListValue.focus();return this.element.classList.add("active"),this},navigate(e,t,i){let s=null;if("up"===e?s=ct(this.element):"down"===e?s=at(this.element):"left"===e?s=ot(this.element):"right"===e&&(s=lt(this.element)),g(s))return!1;s.focus()},focusIn(){this.focused=!0,this.element.classList.add("active");const e=D();return this.source.getCandidates().filter((e=>!this.values.some((t=>Ui(t,e))))).forEach((t=>{e.append(this.createChoiceOption(t)),this.values.push(t)})),this.choices.append(e),this.expanded||(We(this.selectList),this.selectList.dataset.state="open"),this},focusOut(){if(this.readonly)return;this.input&&f(this.input.value)&&(this.input.value=""),this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.input&&this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("querying");const{children:e}=this.choices;for(let t=0;t<e.length;t++){const i=e[t];We(i),i.hidden=!1}return this.expanded||(qe(this.selectList),this.selectList.dataset.state="close"),this.focused=!1,this},showChoices(){const{children:e}=this.choices;for(let t=0;t<e.length;t++){const i=e[t];We(i),i.hidden=!1}},enable(){return this.input&&(this.input.disabled=!1,this.input.tabIndex=0),this.disabled=!1,this},disable(){return this.input&&(this.input.disabled=!0,this.input.tabIndex=-1),this.disabled=!0,this},filterChoice(e){const{children:t}=this.choices;if(this.element.dataset.input=e.trim(),f(e)){for(let e=0;e<t.length;e++){const i=t[e];We(i),i.hidden=!1}return}this.element.classList.add("querying");let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e];let n=s.textContent.toLowerCase(),r=n.replace(/[_-]+/g," ").replace(/\s+/g,"").trim();i.some((e=>n.includes(e)||r.includes(e)))?(We(s),s.hidden=!1):(qe(s),s.hidden=!0)}return!0},createChoiceOption(e){const{template:t={},style:i}=this.schema.choice.option,s=u(e),n=Y({class:["field--choice__choice"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:s?"concept":"value",value:s?e.id:e}});if(Ei.call(this,n,i),this.items.set(e.id,n),"meta-concept"===e.type){let i=this.model.getProjectionSchema(e.concept,a(t.tag))[0],s=i.type,r={type:s,[s]:i.content||i.projection},l=Bs.call(this,r,e.concept,{focusable:!1,meta:e.name});n.dataset.type="meta-concept",n.dataset.value=e.name,n.append(l)}else if(s){if(!this.model.hasProjectionSchema(e,t.tag))return n;let i=this.model.createProjection(e,t.tag).init({focusable:!1});i.readonly=!0,i.focusable=!1,i.parent=this.projection,n.append(i.render())}else n.append(e.toString());return n},setChoice(e){const{children:t}=this.choices;let i=!1;for(let s=0;s<t.length;s++){const n=t[s];let r=qi.call(this,n);r&&Ui(r,e)?(n.classList.add("selected"),n.dataset.selected="selected",this.selection=n,We(n),i=!0):(n.classList.remove("selected"),delete n.dataset.selected)}return this},delete(){if(this.hasValue())this.reset();else{let e=this.source.delete();e.success?(this.clear(),_e(this.element),this.element.remove()):(this.environment.notify(e.message),Xe(this.element))}},_spaceHandler(e){let t=this.source.getCandidates();if(l(t))return void this.notify("No candidates found.",Ye.INFO);const i=D();if(t.forEach((e=>{i.append(this.createChoiceOption(e))})),_e(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let t=Y({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(t),Ei.call(this,t,e)}this.choices.append(i),this.filterChoice(this.input.value),We(this.choices),this.element.classList.add("querying")},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(qe(this.messageElement),t=!1),!this.expanded&&"open"===this.selectList.dataset.state)return qe(this.selectList),this.selectList.dataset.state="close",!0;if(t){let t=je(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}this.focus()},enterHandler(e){const t=zi.call(this,e);O(t)&&this.selection!==t&&("placeholder"===Wi(t)?this.source.removeValue():this.setValue(qi.call(this,t),!0),this.expanded||(qe(this.selectList),this.selectList.dataset.state="close",this.focus()))},backspaceHandler(e){zi.call(this,e)&&this.input&&this.input.focus()},clickHandler(e){const t=zi.call(this,e);O(t)&&this.selection!==t?("placeholder"===Wi(t)?this.source.removeValue():this.setValue(qi.call(this,t),!0),this.expanded||(qe(this.selectList),this.selectList.dataset.state="close")):e===this.selectListValue&&(We(this.selectList),this.selectList.dataset.state="open")},arrowHandler(e,t){if(!O(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);if(!this.expanded&&t===this.selectListValue)return this.arrowHandler(e,this.selectListValue.parentElement);let n=zi.call(this,t);if(n){let t=rt(n,e,this.choices,!1);return O(t)?(t.focus(),!0):this.arrowHandler(e,this.choices)}if(this.expanded&&i!==this.element)return s();let r=rt(t,e,i,!1);return O(r)?(r===this.selectList&&(r=this.input||this.choices),r===this.choices&&this.choices.hasChildNodes()&&("up"===e?r=ct(this.choices):"down"===e?r=at(this.choices):"left"===e?r=ot(this.choices):"right"===e&&(r=lt(this.choices))),r.focus(),!0):s()},bindEvents(){O(this.input)&&this.element.addEventListener("input",(e=>{this.filterChoice(this.input.value)})),this.projection.registerHandler("value.changed",((e,t)=>{this.setValue(e)}))}},Ji=Object.assign(Object.create($i),Xi),Gi={content:[{type:"static",static:{type:"text",content:"+",focusable:!1}}]};function Yi(e){if(!O(e))return!1;const{nature:t,id:i}=e.dataset;return"field-component"===t&&i===this.id}function Ki(e){const t=e=>e.parentElement===this.list;return t(e)?e:je(e,t,3)}const Zi={list:null,items:null,elements:null,selection:null,content:null,init(){const{focusable:e=!0}=this.schema;return this.items=new Map,this.elements=new Map,this.children=[],this.focusable=e,E(this.schema,"list")||(this.schema.list={item:{}}),this},hasChanges:()=>!1,hasValue(){return this.items.size>0},getValue(){return this.list.children},setValue(e,t=!1){t&&this.source.setValue(e),this.list&&(_e(this.list),e.forEach((e=>{var t=this.createItem(e);this.list.append(t)}))),this.refresh()},clear(){this.items.clear(),this.list&&_e(this.list)},focus(e){if(this.hasValue()&&this.list)this.list.firstElementChild.focus();else{let e=at(this.element,(e=>e!==this.list));if(!O(e))return this;e.focus()}return this},navigate(e,t,i){let s=null;if("up"===e?s=ct(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"down"===e?s=at(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"left"===e?s=ot(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"right"===e&&(s=lt(this.element,(e=>e!==this.notification&&e.hasChildNodes()))),!O(s))return!1;let n=this.environment.resolveElement(s);return!g(n)&&(n.focus(),!0)},focusIn(e){this.focused=!0,this.element.classList.add("active");const{component:t}=e.dataset},focusOut(){if(!this.readonly)return this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},createElement(){return this.source.createElement()},getItem(e){return g(e)?null:E(e,"id")?this.items.get(e.id):this.items.get(e)},getItemIndex:e=>O(e)?e.dataset.index:null,createItem(e){const{template:t={},style:i}=this.schema.list.item;if(!this.model.hasProjectionSchema(e,t.tag))return"";let s=this.model.createProjection(e,t.tag);s.optional=!0,s.parent=this.projection;let n=s.init().render();return n.dataset.index=e.index,s.element.parent=this,Ei.call(this.projection,n,i),this.items.set(e.id,n),n},addItem(e){if(!O(this.list))return;const t=this.createItem(e);e.index?this.list.children[e.index-1].after(t):this.list.append(t),this.refresh()},removeItem(e){this.hasList&&!g(e)&&(this.items.delete(e.id),this.items.forEach(((e,t)=>{let i=this.source.getElement(t);i&&(e.dataset.index=i.index)})),this.refresh())},moveItem(e,t,i=!1){return this.list.children[t].before(e),e.dataset.index=t,i&&this.source.swapElement(+this.getItemIndex(e),+t),this},swapItem(e,t,i=!1){const s=this.getItemIndex(e),n=this.getItemIndex(t);return this.moveItem(t,s),this.moveItem(e,n),i&&this.source.swapElement(+s,+n),this},delete(e){if(e===this.element)return this.environment.save(this.source.getParent()),void this.source.remove();const{index:t}=e.dataset;var i=this.source.removeElementAt(+t);if(i.success)if(this.hasValue()){let e=+t<this.list.childElementCount?+t:this.list.childElementCount-1;this.list.children[e].focus()}else this.focus();else this.environment.notify(`This element cannot be deleted: ${i.message}`),Xe(e)},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.list&&this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list&&this.list.classList.add("empty")),this.elements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=Ti.call(this,t,t.state);if(i===t.currentState)return;let n=t.content;s&&(n=s.content);let r=D();n.forEach((e=>{let t=Bs.call(this,e,null,{focusable:!1});r.append(t)})),_e(e).append(r)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},render(){const e=D(),{list:t,style:i,action:s={}}=this.schema;if(O(this.element)||(this.element=U({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Ei.call(this.projection,this.element,this.schema.style)),t&&!O(this.list)){const{style:i}=t;this.list=U({class:["field--list__list"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.source.hasValue()||this.list.classList.add("empty"),t.currentState=null,this.elements.set(t,this.list),Ei.call(this.projection,this.list,i),e.append(this.list)}let n=a(s.add,Gi);if(n){const{position:t="after",content:i,help:s,style:r}=n;let a=ce({class:["field-action","field--list__add"],tabindex:0,title:s,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});i.forEach((e=>{let t=Bs.call(this,e,null,{focusable:!1});a.append(t)})),n.currentState=null,this.elements.set(n,a),Ei.call(this.projection,a,r),"before"===t&&this.list?this.list.before(a):e.append(a)}return this.list&&this.source.getValue().forEach((e=>{var t=this.createItem(e);this.list.append(t)})),Ei.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},_spaceHandler(e){this.notify(`Add or remove ${this.source.accept.name}`)},spaceHandler(e){return!!O(e)&&e.parentElement===this.list&&(this.createElement(),!0)},deleteHandler(e){return!(!Yi.call(this,e)||e.parentElement!==this.list||(this.delete(e),0))},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(qe(this.messageElement),t=!1),t){let t=je(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}return this.focus(),!1},enterHandler(e){const t=(e=>Yi.call(this,e)?e:je(e,(e=>Yi.call(this,e)),5))(e);if(g(t))return this.focus(),!1;const{action:i,index:s,component:n}=t.dataset;return"add"===i?(this.createElement(),!0):"remove"===i&&(this.delete(t.parentElement),!0)},backspaceHandler:e=>!1,clickHandler(e){const t=(e=>Yi.call(this,e)?e:je(e,(e=>Yi.call(this,e)),5))(e);if(g(t))return;const{action:i,index:s,name:n}=t.dataset;"add"===i?this.createElement():"remove"===i&&this.delete(t.parentElement)},_arrowHandler(e,t){if(!O(t))return!1;let i=Ki.call(this,t);if(i){let t=rt(i,e,this.list);return!!O(t)&&(this.swapItem(i,t,!0),i.focus(),!0)}return!1},arrowHandler(e,t){if(!O(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);if(i===this.list){let i=rt(t,e,this.list);return O(i)?(this.environment.resolveElement(i).focus(),!0):this.arrowHandler(e,this.list)}if(i!==this.element)return s();let n=rt(t,e,this.element);if(!O(n))return s();if(n===this.notification)return this.arrowHandler(e,n);if(n===this.list){if(!this.list.hasChildNodes())return s();"up"===e?n=ct(this.list):"down"===e?n=at(this.list):"left"===e?n=ot(this.list):"right"===e&&(n=lt(this.list))}return n.focus(),!0},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)})),this.projection.registerHandler("value.changed",(e=>{this.clear(),this.list&&this.source.getValue().forEach((e=>{let t=this.createItem(e);this.list.append(t)}))})),this.projection.registerHandler("value.swapped",(e=>{const[t,i]=e;let s=this.getItem(t),n=this.getItem(i),r=+this.getItemIndex(s);this.getItemIndex(n),r!==t.index&&this.swapItem(s,n)}))}},Qi=Object.assign(Object.create($i),Zi);Object.defineProperty(Qi,"size",{get(){return this.items.size}}),Object.defineProperty(Qi,"hasList",{get(){return O(this.list)}});var es=0;const ts={content:{type:"static",static:{type:"text",content:"Add"}}},is={content:{type:"static",static:{type:"text",content:"Remove"}}},ss={table:null,header:null,body:null,footer:null,elements:null,contentElements:null,content:null,init(){const{content:e=[],template:t,focusable:i=!0}=this.schema;return this.elements=new Map,this.focusable=i,this.content=e,this.contentElements=new Map,this.template=this.model.getProjectionSchema(this.source.accept,t.tag)[0].projection,this},render(){const{content:e,action:t={}}=this.schema,{disposition:i}=this.template,s=D();if(!Array.isArray(e))throw new Error("Empty content for listfield");if(O(this.element)||(this.element=U({class:["field","field--table"],id:this.id,tabindex:-1,dataset:{nature:"field",view:"table",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Ei.call(this.projection,this.element,this.schema.style)),e.forEach((e=>{if("table"===e.type){let t=a(e.table,{});const{style:i,header:n,body:r={},footer:l}=t;if(this.table=he({class:["field--table__table"],tabindex:0,dataset:{nature:"field-component",view:"table",id:this.id}}),n){const{style:e}=n;this.header=de({class:["field--table-header"],dataset:{nature:"field-component",view:"table",id:this.id}}),Ei.call(this.projection,this.header,e),this.table.append(this.header)}if(r){const{style:e}=r;this.body=pe({class:["field--table-body"],dataset:{nature:"field-component",view:"table",id:this.id}}),Ei.call(this.projection,this.body,e),this.table.append(this.body)}if(l){const{style:e}=l;this.footer=me({class:["field--table-footer"],dataset:{nature:"field-component",view:"table",id:this.id}}),Ei.call(this.projection,this.footer,e),this.table.append(this.footer)}t.currentState=null,this.contentElements.set(t,this.table),Ei.call(this.projection,this.table,i),s.append(this.table)}else if("action"===e.type){let t=a(e,ts);const{content:i,style:n}=t;let r=Bs.call(this,i,null),l=ce({class:["field-action","field--table__add"],tabindex:0,dataset:{nature:"field-component",view:"table",component:"action",id:this.id,action:"add"}},[r]);t.currentState=null,this.contentElements.set(t,l),Ei.call(this.projection,l,n),s.append(l)}else{let t=Bs.call(this,e);this.contentElements.set(e,t),s.append(t)}})),this.header){let e=fe({class:["field--table-header-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id}});i.forEach((t=>{const{header:i}=t,{style:s,content:n}=i;var r=Bs.call(this,n),a=ve({class:["field--table-header-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},r);Ei.call(this.projection,a,s),e.append(a)}));let t=ge({class:["field--table-header-cell","field--table-header-cell--action"]},"Action");e.append(t),this.header.append(e)}return this.source.hasValue()&&this.source.getValue().forEach((e=>{this.addRow(e)})),s.hasChildNodes()&&(this.element.append(s),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,hasValue(){return this.body.rows.length>0},getValue(){return this.body.rows},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.table.classList.remove("empty")):(this.element.classList.add("empty"),this.table.classList.add("empty")),this.contentElements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=Ti.call(this,t,t.state);if(i===t.currentState)return;let n=null;n=s?Bs.call(this,s.content,null):Bs.call(this,t.content,null),_e(e).append(n)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},createElement(){return this.source.createElement()},addRow(e){const{action:t={},before:i={},after:s={}}=this.schema,{disposition:n}=this.template,r=a(e.index,this.table.rows.length),l="row"+es++,o=fe({class:["field--table-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id,index:r,elementId:l}});this.elements.set(l,o),n.forEach((t=>{const{body:i}=t,{style:s,content:n}=i;var r=Bs.call(this,n,e),a=ge({class:["field--table-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},r);Ei.call(this.projection,a,s),o.append(a)}));var c=ge({class:["field--table__cell-action"]}),{content:h,style:u}=a(t.remove,is),d=Bs.call(this,h),p=ce({class:["btn","field--table__button"],dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",rowId:l}},d),m=ce({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-up",rowId:l}},"Move up"),f=ce({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-down",rowId:l}},"Move down");Ei.call(this.projection,p,u),c.append(p,m,f),o.append(c),this.body.append(o),this.refresh()},removeRow(e){var t=this.body.rows.item(e.index);if(!O(t))throw new Error("Table error: Row not found");_e(t),t.remove();for(let t=e.index;t<this.body.rows.length;t++){const e=this.body.rows.item(t),{index:i}=e.dataset;e.dataset.index=+i-1}this.refresh()},removeElement(e){return this.source.removeElement(e)},delete(e){if(e===this.element||e===this.table)return void this.source.delete();const{index:t}=e.dataset;this.source.removeElementAt(+t)||(this.environment.notify("This element cannot be deleted"),Xe(e))},bindEvents(){this.element.addEventListener("click",(e=>{const{target:t}=e,i=function(e){const t="field-component";return e.dataset.nature===t?e:je(e,(e=>e.dataset.nature===t))}(t);if(!O(i))return;const{id:s,action:n}=i.dataset;if(s===this.id)if("add"===n)this.createElement();else if("remove"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e);this.delete(t)}else if("move-up"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.previousElementSibling;s&&s.before(t)}else if("move-down"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.nextElementSibling;s&&s.after(t)}}),!0),this.projection.registerHandler("value.added",(e=>{this.addRow(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeRow(e)})),this.projection.registerHandler("value.changed",(e=>{_e(this.body),this.source.getValue().forEach((e=>{this.addRow(e)}))}))}},ns=Object.assign(Object.create($i),ss),rs=e=>O(e,["input","textarea"]),as="error";function ls(){return O(this.choice)||(this.choice=G({class:["bare-list","field--textbox__choices"],dataset:{nature:"field-component",view:"text",component:"choice",id:this.id}}),this.append(this.choice)),this.choice}function os(e){return Y({class:["field--textbox__choice"],tabindex:0,dataset:{nature:"field-component",view:"text",component:"choice-item",value:e,id:this.id}},e)}function cs(e){return e.parentElement===this.choice?e:je(e,(e=>e.parentElement===this.choice),3)}function hs(e){const{placeholder:t="",type:i}=e;let s=$s.call(this,t);return this.readonly||this.resizable?ee({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:s,dataset:{placeholder:s,nature:"field-component",view:this.type,id:this.id}}):this.multiline?ne({class:["field--textbox__input"],placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}}):se({class:["field--textbox__input"],type:a(i,"text"),placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}})}const us={input:null,choice:null,value:"",placeholder:null,multiline:!1,resizable:!1,content:null,init(){const{multiline:e=!1,resizable:t=!1,focusable:i=!0}=this.schema;return this.multiline=e,this.focusable=i,this.resizable=t,this.children=[],E(this.schema,"choice")||(this.schema.choice={}),this},focus(e){return this.input.focus(),this},focusIn(){return this.focused=!0,this.value=this.getValue(),this.element.classList.add("active"),this.element.classList.add("focus"),this},focusOut(){return this.hasChanges()&&this.setValue(this.getValue(),!0),f(this.getValue())&&(this.input.textContent=""),this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.choice&&qe(this.choice),this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("focus"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!=this.getValue()},hasValue(){return!l(this.getValue())},getValue(){return rs(this.input)?this.input.value:this.input.textContent},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||this.environment.notify(i.message,"error"),this.setInputValue(e),this.value=e,this.refresh()},setInputValue(e){rs(this.input)?this.input.value=e:this.input.textContent=e},getCandidates(){let e=this.source.getCandidates();return Array.isArray(e)?e:[]},enable(){return this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1,this.element.classList.add("disabled"),this},disable(){return this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0,this.element.classList.remove("disabled"),this},refresh(){Ti.call(this,this.schema,this.schema.state),this.hasValue()?this.element.classList.remove("empty"):this.element.classList.add("empty"),this.element.dataset.value=this.value,this.hasError?(this.element.classList.add(as),this.input.classList.add(as)):(this.element.classList.remove(as),this.input.classList.remove(as)),this.choice&&this.filterChoice(this.getValue())},render(){const e=D(),{input:t={},style:i}=this.schema;if(O(this.element)||(this.element=U({id:this.id,class:["field","text-field","field--textbox"],dataset:{nature:"field",view:"text",id:this.id,disabled:this.disabled,readonly:this.readonly,value:""}}),this.readonly&&this.element.classList.add("readonly"),this.disabled&&this.element.classList.add("disabled"),Ei.call(this.projection,this.element,this.schema.style)),!O(this.input)){const{placeholder:i="",type:s,style:n}=t;this.input=hs.call(this,t),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Ei.call(this,this.input,n),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}return Ei.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},filterChoice(e){const{children:t}=this.choice;if(f(e)){for(let e=0;e<t.length;e++){const i=t[e];We(i),i.hidden=!1}return!0}let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e],{value:n}=s.dataset;i.some((e=>n.toLowerCase().includes(e)))?(We(s),s.hidden=!1):(qe(s),s.hidden=!0)}return!0},selectChoice(e){if(!O(e))return;const t=function(e){return e.dataset.value}(e);return this.setValue(t,!0),this.input.focus(),qe(this.choice),this},_spaceHandler(e){const t=new Set(this.getCandidates());if(0===t.size)this.notify("Enter any text.",Ye.INFO);else{ls.call(this);const e=D();t.forEach((t=>e.append(os.call(this,t)))),_e(this.choice).append(e),this.filterChoice(this.getValue()),We(this.choice)}},escapeHandler(e){let t=!0;if(this.messageElement&&!Ze(this.messageElement)&&(qe(this.messageElement),t=!1),this.choice&&!Ze(this.choice)&&(qe(this.choice),t=!1),t){let t=je(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return i&&i.focus(t),!1}return this.input.focus(),!0},enterHandler(e){const t=cs.call(this,e);return t?this.selectChoice(t):this.multiline||(e===this.input?this.setValue(this.getValue(),!0):this.focus()),!0},backspaceHandler(e){cs.call(this,e)&&this.input.focus()},clickHandler(e){const t=cs.call(this,e);O(t)&&this.selectChoice(t)},arrowHandler(e,t){if(!O(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);let n=cs.call(this,t);if(O(n)){let t=rt(n,e,this.choice);return O(t)?(t.focus(),!0):this.arrowHandler(e,this.choice)}if(i!==this.element)return s();let r=null;if("right"===e){if(t===this.input&&!(this.getValue().length<Pe(this.input)+1))return!1;r=rt(t,e,this.element,!1)}else if("left"===e){if(t===this.input&&0!==Pe(this.input))return!1;r=rt(t,e,this.element,!1)}else r=rt(t,e,this.element,!1);return O(r)&&r.dataset.id===this.id?("up"===e?r=ct(this.choice):"down"===e?r=at(this.choice):"left"===e?r=ot(this.choice):"right"===e&&(r=lt(this.choice)),r.focus(),!0):s()},bindEvents(){this.element.addEventListener("input",(e=>{this.hasError&&this.source.setValue(this.getValue(),!0),this.refresh()})),this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},ds=Object.assign(Object.create($i),us),ps={binary:(e,t,i)=>Object.create(Fi,{object:{value:"field"},name:{value:"binary-field"},type:{value:"binary"},id:{value:fs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),choice:(e,t,i)=>Object.create(Ji,{object:{value:"field"},name:{value:"choice-field"},type:{value:"choice"},id:{value:fs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),list:(e,t,i)=>Object.create(Qi,{object:{value:"field"},name:{value:"list-field"},type:{value:"list"},id:{value:fs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),table:(e,t,i)=>Object.create(ns,{object:{value:"field"},name:{value:"table-field"},type:{value:"table"},id:{value:fs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),text:(e,t,i)=>Object.create(ds,{object:{value:"field"},name:{value:"text-field"},type:{value:"text"},id:{value:fs()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}})};var ms=0;const fs=()=>"field"+ms++,vs={createField(e,t,i){const{type:s}=t,n=ps[s];if(g(n))throw new Error(`Missing handler: The '${s}' field could not be handled`);var r=n(e,t,i);if(g(r))throw new Error(`Bad request: The '${s}' field could not be created`);return r.errors=[],r.readonly=a(t.readonly,!1),g(r.id)&&(r.id=fs()),r}},gs={init(){throw new Error("This function has not been implemented")},element:null,children:null,statusElement:null,attached:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasAttached(){return!l(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return h(e)?this.attached.filter((t=>e(t))):this.attached},show(){return We(this.element),this.visible=!0,this.active=!0,this},hide(){return qe(this.element),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},focus(){return this.element.focus(),this.focused=!0,this.active=!0,this},_focusIn:e=>!1,navigate(e,t,i){return this.focusable?(this.element.focus(),!0):this.parent.arrowHandler(e,this.element)},clear:()=>!0,delete(){this.environment.notify("This element cannot be removed",Ye.WARNING,1500),Xe(this.element)},spaceHandler(e){return this.arrowHandler("right",e)},_spaceHandler(e){return this.environment.notify("Nothing do here.",Ye.NORMAL,1500),!1},escapeHandler(e){let t=je(e,(e=>0===e.tabIndex));return this.projection.resolveElement(t).focus(t),!0},enterHandler(e){this.element.click()},deleteHandler(e){return this.environment.notify("This element cannot be removed",Ye.WARNING,1500),Xe(this.element),!1},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,t)},clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler:e=>(console.warn("CONTROL NOT IMPLEMENTED"),!1)},bs=Object.assign(gs),ys={init(){return this.children=[],this},render(){const e=D(),{help:t,style:i,content:s}=this.schema;return O(this.element)||(this.element=Q({class:["static","audio-static"],src:s,dataset:{nature:"static",static:"audio",id:this.id,ignore:"all"}})),g(t)||(this.element.title=t),Ei.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},bindEvents(){}},ws=Object.assign(Object.create(bs),ys);function Es(e){return f(e)?"":e.startsWith("http://")||e.startsWith("https://")?new URL(e).href:Es(`https://${e}`)}const Cs={url:null,alt:null,width:null,height:null,init(){const{url:e,width:t,height:i,alt:s}=this.schema;return this.url=Es(e),this.width=t,this.height=i,this.alt=s,this},render(){const{help:e,style:t}=this.schema;return O(this.element)||(this.element=Z({class:["static","image-static"],src:this.url,alt:this.alt,dataset:{nature:"static",static:"image",id:this.id,ignore:"all"}})),g(this.width)||isNaN(this.width)||(this.element.width=this.width),g(this.height)||isNaN(this.height)||(this.element.height=this.height),g(e)||(this.element.title=e),Ei.call(this.projection,this.element,t),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},js=Object.assign(Object.create(bs),Cs),Ls={email:e=>`mailto:${e}`,phone:e=>`tel:${e}`,link:e=>`${e}`};function xs(e){return e.startsWith("http://")||e.startsWith("https://")?new URL(e).href:xs(`https://${e}`)}const _s={url:null,urlType:null,href:null,content:null,init(){const{url:e,content:t=[],urlType:i="link"}=this.schema;this.url=xs(e),this.content=t,this.urlType=i,this.children=[];const s=Ls[this.urlType];if(!h(s))throw new TypeError("type not handled");return this.href=s(this.url),this},render(){if(f(this.url))throw new Error("There is no URL defined for this link");if(l(this.content))throw new Error("There is no content defined for this link");const e=D(),{help:t,style:i}=this.schema;return O(this.element)||(this.element=K({class:["static","link"],href:this.href,target:"_blank",dataset:{nature:"static",static:"link",id:this.id,ignore:"all"}})),this.content.forEach((t=>{let i=Bs.call(this,t,this.projection.concept,{focusable:!1});e.append(i)})),g(t)||(this.element.title=t),Ei.call(this.projection,this.element,i),e.hasChildNodes()&&this.element.append(e),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},As=Object.assign(Object.create(bs),_s);function Os(e){const{type:t}=e;return"property"===t?(this.hasProperty=!0,a(this.source.getProperty(e.name),"")):"param"===t?this.projection.getParam(e.name):"html"===t?R(e.html):"raw"===t?R(e.raw):e}const Ss={editable:null,focusable:null,hasProperty:!1,init(e={}){Object.assign(this.schema,e);const{content:t,editable:i=!1,focusable:s=!1}=this.schema;return this.children=[],this._content=t,this.editable=i,this.focusable=s,this},render(){let e=!1;const{content:t,help:i,style:s}=this.schema;if(!O(this.element)){if(this.element=ee({class:["text","static","text-static"],editable:this.editable,dataset:{nature:"static",view:"text",static:"text",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0),Array.isArray(t))t.forEach((e=>{let t=Os.call(this,e),i=ee({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",content:t,id:this.id,ignore:"all"}},t);Ei.call(this.projection,i,e.style),this.element.append(i)}));else{let e=Os.call(this,t);this.element.append(e),this.element.content=e}e=!0}return g(i)||(this.element.title=i),Ei.call(this.projection,this.element,s),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},getLength(){return this.element.textContent.length},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){if(!this.editable&&this.parent)return this.parent.arrowHandler(e,t);if("right"===e){if(this.getLength()<Pe(this.element)+1&&this.parent)return this.parent.arrowHandler(e,t)}else if("left"===e){if(0===Pe(this.element)&&this.parent)return this.parent.arrowHandler(e,t)}else if(this.parent)return this.parent.arrowHandler(e,t);return!1},escapeHandler(e){let t=je(e,(e=>0===e.tabIndex));this.projection.resolveElement(t).focus(t)},update(){const{content:e}=this.schema;return _e(this.element),Array.isArray(e)?e.forEach((e=>{this.element.append(ee({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",id:this.id,ignore:"all"}},Os.call(this,e)))})):this.element.append(Os.call(this,e)),this},refresh(){return this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},Is=Object.assign(Object.create(bs),Ss),Vs={contentType:null,editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.children=[],this.focusable=t,this},render(){const e=D(),{help:t,style:i,content:s}=this.schema;return O(this.element)||(this.element=ce({class:["btn","static"],dataset:{nature:"static",view:"plink",static:"plink",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),s.forEach((t=>{let i=Bs.call(this,t,this.projection.concept,{focusable:!1});e.append(i)})),g(t)||(this.element.title=t),Ei.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(qe(this.messageElement),_e(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(e){let t=je(e,(e=>0===e.tabIndex));this.environment.resolveElement(t).focus(t)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},refresh(){return this},bindEvents(){}},Rs=Object.assign(Object.create(bs),Vs),Ms={template:null,selector:null,content:null,init(){var e;return this.selector=this.schema.selector,this.template=(e=this.selector,"content"in document.createElement("template")?we(e,undefined):null),this},render(){const{style:e,content:t}=this.schema;var i;return _(this.element)||(this.element=(i=this.template)?document.importNode(i.content,a(undefined,!0)):i),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},Ts=Object.assign(Object.create(bs),Ms);var ks=0;const Ns=()=>"static"+ks++,Hs={audio:(e,t,i)=>Object.create(ws,{object:{value:"static"},name:{value:"audio-static"},type:{value:"audio"},id:{value:Ns()},model:{value:e},schema:{value:t},projection:{value:i}}),plink:(e,t,i)=>Object.create(Rs,{object:{value:"static"},name:{value:"plink-static"},type:{value:"plink"},id:{value:Ns()},model:{value:e},schema:{value:t},projection:{value:i}}),image:(e,t,i)=>Object.create(js,{object:{value:"static"},name:{value:"image-static"},type:{value:"image"},id:{value:Ns()},model:{value:e},schema:{value:t},projection:{value:i}}),link:(e,t,i)=>Object.create(As,{object:{value:"field"},name:{value:"link-static"},type:{value:"link"},id:{value:Ns()},model:{value:e},schema:{value:t},projection:{value:i}}),text:(e,t,i)=>Object.create(Is,{object:{value:"static"},name:{value:"text-static"},type:{value:"text"},id:{value:Ns()},model:{value:e},schema:{value:t},projection:{value:i}}),html:(e,t,i)=>Object.create(Ts,{object:{value:"static"},name:{value:"html-static"},type:{value:"html"},id:{value:Ns()},model:{value:e},schema:{value:t},projection:{value:i}})},Ps={createStatic(e,t,i){const{type:s}=t,n=Hs[s];if(g(n))throw new Error(`Missing handler: The '${s}' static could not be handled`);var r=n(e,t,i);if(g(r))throw new Error(`Bad request: The '${s}' static could not be created`);return g(r.id)&&(r.id=Ns()),r}};function $s(e){return"property"===e.type?this.projection.concept.getProperty(e.name):e}function Ds(e,t){const{name:i,merge:s=!1,required:n=t.isAttributeRequired(i),tag:r,placeholder:a={},style:l}=e;if(!t.hasAttribute(i))return console.error(`Attribute '${i}' does not exist in the concept '${t.name}'`),ie({hidden:!0},i);n&&!t.isAttributeCreated(i)&&t.createAttribute(i);const o={name:i,get created(){return t.isAttributeCreated(i)},schema:e,placeholder:ie({class:["projection-element"],hidden:!0},i),parent:this,projection:this.projection,element:null};if(this.projection.attributes.push(o),!o.created){const{content:e}=a;return o.placeholder=e?Bs.call(this,e,t,{focusable:!0}):ie({class:["projection-element","projection-element--placeholder"],tabindex:0,dataset:{object:"attribute",id:i}},`Add ${i}`),o.placeholder.addEventListener("click",(e=>{t.createAttribute(i),this.projection.resolveElement(o.element).focus()})),o.placeholder}{const{target:e,description:s,schema:n}=t.getAttributeByName(i);let a=this.projection.model.createProjection(e,r).init();a.parent=this.projection,a._style=l,o.element=a.render(),a.element.parent=this}return o.element}function Bs(e,t,i={}){const s=a(t,this.projection.concept);if("layout"===e.type){let t=nn.createLayout(this.model,e.layout,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("field"===e.type){let t=vs.createField(this.model,e.field,this.projection);return t.parent=this,t.init(i),this.model.registerField(t),t.render()}if("static"===e.type){let t=Ps.createStatic(this.model,e.static,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerStatic(t),t.render()}if("dynamic"===e.type)return Bs.call(this,e.dynamic,t,i);if("attribute"===e.type)return Ds.call(this,e,s);if("template"===e.type){let s=e.name;"param"===s.type&&(s=this.projection.getParam(s.name));let n=this.model.getTemplateSchema(s);n.param&&(e.param&&n.param.forEach((t=>{Object.assign(t,e.param.find((e=>e.name===t.name)))})),this.projection.addParam(n.param));const r=D();return n.content.forEach((e=>{r.append(Bs.call(this,e,t,i))})),r}if("projection"===e.type){const{tag:t,style:i,required:n=!1}=e,r={schema:e,placeholder:ie({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return r.update=function(e,n,a){if(r.element&&(r.element.remove(),r.element=null),s.hasValue()){let e=s.getValue(!0),n=this.projection.model.createProjection(e,t).init();n.placeholder=r.placeholder,n.parent=this.projection,r.element=n.render(),r.placeholder&&r.placeholder.after(r.element),O(r.element)&&Ei.call(this.projection,r.element,i),n.element.parent=this.projection.element}},s.register(r),r.update(),r.element||r.placeholder}if("property"===e.type){const{name:t}=e;return this.projection.concept.getProperty(t)}if("html"===e.type){const{html:t}=e;return R(t)}if("state"===e.type){let s={},n=Ti.call(this,s,e.state);return Bs.call(this,n.content,t,i)}if("trigger"===e.type){let t=ce({class:["btn","static"],dataset:{nature:"static"}});return e.content.forEach((e=>{let i=Bs.call(this,e,this.projection.concept,{focusable:!1});t.append(i)})),t.addEventListener("click",(t=>{let i=s;e.bind&&(i=s.getValue(!0)),this.environment.triggerEvent({name:e.name,args:[i]})})),Ei.call(this.projection,t,e.style),t}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}const Fs={focusable:null,readonly:!1,visible:!1,editable:!1,active:!1,container:null,elements:null,children:null,editing:!1,getStyle(){return this.schema.style},setStyle(e){return this.schema.style=e,Ei.call(this.projection,this.container,e),this.refresh(),!0},getContainer(){return this.container},isRoot(){return g(this.parent)},getField(e){return this.projection.getField(e)},getStatic(e){return this.projection.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},show(){return We(this.element),this.visible=!0,this.active=!0,this},hide(){return qe(this.element),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},_focusIn:e=>!1,spaceHandler(e){return e===this.container&&!g(this.parent)&&this.parent.spaceHandler(this.container)},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){if(this.isRoot())return!1;let t=je(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return!g(i)&&(i.focus(t),!0)},enterHandler(e){let t=we('[tabindex]:not([tabindex="-1"])',this.container),i=this.environment.resolveElement(t);return!g(i)&&(i.focus(),!0)},delete(){var e=this.source.delete();e.success||this.environment.notify(e.message)},deleteHandler(e){if(this.projection.element!==this)return!1;if(!this.projection.optional)return Xe(this.container),!1;let t=je(e,(e=>0===e.tabIndex)),i=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),i),this.source.delete();let s=this.environment.resolveElement(t);return g(s)||s.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){if(t===this.container)return!g(this.parent)&&this.parent.arrowHandler(e,this.container);let i=rt(t,e,this.container);if(!O(i))return!g(this.parent)&&"layout"===this.parent.object&&this.parent.arrowHandler(e,this.container);let s=this.environment.resolveElement(i);return s&&(h(s.navigate)?s.navigate(e):s.focus()),!0},shiftHandler(e,t){if("up"===e){let e=et(window.getComputedStyle(this.container).marginTop);this.container.style.marginTop=`${e+1}px`}return!0},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()}},zs={HORIZONTAL:"horizontal",VERTICAL:"vertical"},Ws=[{concept:{name:"stack-layout"},type:"layout",tags:[],projection:{type:"stack",orientation:"vertical",disposition:[{type:"attribute",name:"orientation"}]}}],qs={orientation:null,args:null,init(e={}){const{orientation:t=zs.HORIZONTAL,editable:i=!0,focusable:s=!1}=this.schema;return this.orientation=t,this.focusable=s,this.editable=i,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){this.orientation=e,this.refresh()},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=D();O(this.container)||(this.container=U({class:["layout-container","stack-layout"],title:i,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let t=0;t<e.length;t++){let i=Bs.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Ei.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.container.style.display="flex",this.container.style.flexWrap="nowrap",this.refresh(),this.container},design(){return{concept:[{name:"stack-layout",nature:"concrete",attributes:[{name:"orientation",target:{name:"string",default:this.orientation,constraint:{values:["horizontal","vertical"]}}}]}],projection:Ws,handlers:{orientation:(e,t)=>{this.setOrientation(t)}}}},refresh(){return this.orientation===zs.VERTICAL?this.container.style.flexDirection="column":this.orientation===zs.HORIZONTAL&&(this.container.style.flexDirection="row"),this},focus(e){if(this.focusable)this.container.focus();else{let e=we('[tabindex]:not([tabindex="-1"])',this.container);if(g(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Us=Object.assign({},Fs,qs),Xs={args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema;return this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=D();O(this.container)||(this.container=U({class:["layout-container"],title:i,dataset:{nature:"layout",layout:"wrap",id:this.id}}));for(let t=0;t<e.length;t++){let i=Bs.call(this,e[t],this.source,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Ei.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="inline-flex",this.container.style.alignItems="baseline",this.refresh(),this.container},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},focus(e){if(this.focusable)this.container.focus();else{let e=we('[tabindex]:not([tabindex="-1"])',this.container);if(g(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Js=Object.assign({},Fs,Xs),Gs={elements:null,edit:!1,btnEdit:!1,btnCollapse:!1,menu:!1,collapsed:!1,init(e={}){const{editable:t=!0,collapsible:i=!1,focusable:s=!1}=this.schema;return this.focusable=s,this.collapsible=i,this.editable=t,this.elements=[],this.children=[],Object.assign(this,e),this},collapse(e){if(!this.collapsed)return this.collapseContainer=U({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e){if(!this.collapsed)return;let t=D(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!0,this.refresh(),this},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=D();O(this.container)||(this.container=U({class:["layout-container"],dataset:{nature:"layout",layout:"table"}})),this.focusable?this.container.tabIndex=-1:this.container.dataset.ignore="all";for(let t=0;t<e.length;t++){let i=e[t],n=U({class:["table-row"]});n.style.display="table-row";for(let e=0;e<i.length;e++){const t=i[e];let s=U({class:["table-cell"]},Bs.call(this,t.content));s.style.display="table-cell",Ei.call(this.projection,s,t.style),n.append(s)}s.append(n)}return Ei.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.container.style.display="table",this.refresh(),this.container},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},Ys=Object.assign({},Fs,Gs),Ks={ROW:"row",COLUMN:"column"},Zs={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{orientation:t=Ks.ROW,wrappable:i=!0,alignItems:s,justifyContent:n,editable:r=!0,focusable:a=!1}=this.schema;return this.orientation=t,this.wrappable=i,this.alignItems=s,this.justifyContent=n,this.focusable=a,this.editable=r,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){E(Ks,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=U({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let t=D(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=D();O(this.container)||(this.container=U({class:["layout-container"],title:i,dataset:{nature:"layout",layout:"flex",id:this.id}}));for(let t=0;t<e.length;t++){let i=Bs.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Ei.call(this,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=this.justifyContent,this.container.style.alignItems=this.alignItems,this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=we('[tabindex]:not([tabindex="-1"])',this.container);if(g(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},Qs=Object.assign({},Fs,Zs);var en=0;const tn=()=>"layout"+en++,sn={stack:(e,t,i)=>Object.create(Us,{object:{value:"layout"},name:{value:"stack-layout"},type:{value:"stack"},id:{value:tn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),wrap:(e,t,i)=>Object.create(Js,{object:{value:"layout"},name:{value:"wrap-layout"},type:{value:"wrap"},id:{value:tn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),table:(e,t,i)=>Object.create(Ys,{object:{value:"layout"},name:{value:"table-layout"},type:{value:"table"},id:{value:tn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),flex:(e,t,i)=>Object.create(Qs,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:tn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},nn={createLayout(e,t,i){const{type:s}=t,n=sn[s];if(g(n))throw new TypeError(`Missing handler: The '${s}' layout could not be handled`);const r=n(e,t,i);if(g(r))throw new Error(`Bad request: The '${s}' layout could not be created`);return r.createLayout=this.createLayout,g(r.id)&&(r.id=tn()),r}};var rn=0;const an={createProjection(e,t,i,s){var n=Object.create(ln,{id:{value:a(t.id,"projection"+rn++)},model:{value:e},schema:{value:t,writable:!0},environment:{value:s}});return n.concept=i,n}},ln={handlers:null,init(e={}){return this.containers=new Map,this.attributes=[],this.params=[],this.handlers={},this.args=e,this.concept.register(this),this},schema:null,concept:null,environment:null,parent:null,containers:null,placeholder:null,element:null,attributes:null,params:null,index:0,editing:!1,optional:!1,searchable:!1,focusable:!0,get hasMultipleViews(){return this.schema.length>1},get isReadOnly(){return a(this.getSchema().readonly,!1)},isRoot(){return g(this.parent)},getSchema(e){return this.schema[a(e,this.index)]},getContainer(e){return this.containers.get(a(e,this.index))},getStyle(){const{style:e}=this.getSchema();return e},addParam(e){this.params.push(...Array.isArray(e)?e:[e])},getParam(e){let t=this.params.find((t=>t.name===e));if(g(t))return;const{type:i="string",value:s}=t;let n=a(s,t.default);return g(n)?null:"string"===i?n.toString():"number"===i?+n:"boolean"===i?L(n):void 0},getParent(){return this.isRoot()?null:this.parent},getAttributes(e){return this.attributes.filter((t=>t.name===e))},getField(e){return this.environment.getField(e)},getStatic(e){return this.environment.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},resolveElement(e){return this.environment.resolveElement(e)},getHandlers(e){return a(this.handlers[e],[])},update(e,t,i){if(l(this.containers))return;if("delete"===e)return void this.delete();const s=this.getHandlers(e);switch(l(s)||s.forEach((e=>{e(t,i)})),e){case"attribute.added":return void this.getAttributes(t.name).forEach((e=>{const{schema:i}=e,s=this.model.createProjection(t.target,i.tag).init();s.parent=this,s.optional=!0;const n=s.render();Ei.call(this,n,i.style),s.element.parent=e.parent,e.element=n,e.placeholder&&(e.placeholder.after(n),qe(e.placeholder))}));case"attribute.removed":return void this.getAttributes(t.name).forEach((e=>{e.element&&(_e(e.element).remove(),e.element=null),e.placeholder&&We(e.placeholder)}))}},delete(){return this.concept&&this.concept.unregister(this),this.placeholder&&this.getContainer().after(this.placeholder),this.containers.forEach((e=>{_e(e),O(e)&&e.remove()})),this.model.removeProjection(this.id),!0},registerHandler(e,t){return Array.isArray(this.handlers[e])||(this.handlers[e]=[]),this.handlers[e].push(t),!0},unregisterHandler(e,t){if(!E(this.handlers,e))return!1;for(let i=0;i<this.handlers[e].length;i++)if(this.handlers[e][i]===t)return this.handlers[e].splice(i,1),!0;return!1},focus(){this.element.focus()},render(){const e=this.getSchema(),{type:t,projection:i,content:s}=e;var n=null;if("layout"===t?(this.element=nn.createLayout(this.model,a(i,s),this).init(this.args),this.model.registerLayout(this.element)):"field"===t?(this.element=vs.createField(this.model,a(i,s),this).init(this.args),this.model.registerField(this.element)):"static"===t&&(this.element=Ps.createStatic(this.model,a(i,s),this).init(this.args),this.model.registerStatic(this.element)),this.isRoot()&&(this.element.focusable=!0),this.focusable||(this.element.focusable=!1),this.readonly&&(this.element.readonly=!0),n=this.element.render(),this.element.focusable||(n.tabIndex=-1),!_(n))throw new Error("Projection element container could not be created");if(n.classList.add("projection"),Object.assign(n.dataset,{projection:this.id,concept:this.concept.id,object:this.concept.object}),this.optional){let e=ce({class:["btn","structure__btn-delete","projection__btn-delete"],title:`Delete ${this.concept.name}`,tabindex:-1,dataset:{action:"delete",projection:this.id}});e.addEventListener("click",(e=>{let t=this.getContainer(),i=je(t,(e=>0===e.tabIndex));this.environment.save(this.concept.getParent(),t.cloneNode(!0)),this.concept.delete();let s=this.environment.resolveElement(i);g(s)||s.focus()})),n.dataset.deletable=!0,n.classList.add("has-toolbar"),n.prepend(e)}return this._style&&Ei.call(this,n,this._style),this.containers.set(this.index,n),n},refresh(){this.editing?this.containers.forEach((e=>{e.tabIndex=0})):this.containers.forEach((e=>{e.tabIndex=null}))},changeView(e){if(!this.hasMultipleViews)return void this.environment.notify("There is no alternative projection for this concept");let t=this.getContainer();this.index=a(e,(this.index+1)%this.schema.length);let i=this.getContainer();return O(i)||(this.params=[],i=this.render()),t.replaceWith(i),this.element=this.resolveElement(i),this.focus(),this},export(){return{id:this.id,root:this.isRoot(),concept:{id:this.concept.id,name:this.concept.name}}},bindEvents(){}},on=[{concept:{name:"set"},type:"field",tags:[],content:{type:"list"}},{concept:{name:"boolean"},type:"field",tags:[],content:{type:"binary"}},{concept:{name:"string"},type:"field",tags:[],content:{type:"text"}},{concept:{name:"number"},type:"field",tags:[],content:{type:"text",input:{type:"number"}}},{concept:{name:"reference"},type:"field",tags:[],content:{type:"choice"}}];function cn(e,t){return Object.create(hn,{schema:{value:[...e,...on],writable:!0},environment:{value:t}})}const hn={projections:null,fields:null,statics:null,layouts:null,init(e){return this.projections=[],this.fields=new Map,this.statics=new Map,this.layouts=new Map,this},setSchema(e){return this.schema=[...e,...on],this},done(){for(;!l(this.projections);)this.projections[0].delete();return this.projections=[],this.fields.clear(),this.layouts.clear(),this.statics.clear(),this},createProjection(e,t){const i=this.getProjectionSchema(e,t);l(i)&&console.warn(e,i,t);const s=an.createProjection(this,i,e,this.environment);return s.tag=t,this.addProjection(s),s},getProjections(){return this.projections.slice()},getProjection(e){return Number.isInteger(e)?this.projections[e]:this.projections.find((t=>t.id===e))},addProjection(e){if(g(e))throw new TypeError("Bad request: The 'projection' argument must be a Projection");return this.projections.push(e),this},removeProjection(e){var t=this.projections.findIndex((t=>t.id===e));return-1!==t&&(this.projections.splice(t,1),!0)},registerField(e){return e.environment=this.environment,this.fields.set(e.id,e),this},unregisterField(e){var t=this.fields.get(e.id);return t&&(t.environment=null,this.fields.delete(t.id)),this},getField(e){return this.fields.get(e)},registerStatic(e){return e.environment=this.environment,this.statics.set(e.id,e),this},unregisterStatic(e){var t=this.statics.get(e.id);return t&&(t.environment=null,this.statics.delete(t.id)),this},getStatic(e){return this.statics.get(e)},registerLayout(e){return e.environment=this.environment,this.layouts.set(e.id,e),this},unregisterLayout(e){var t=this.layouts.get(e.id);return t&&(t.environment=null,this.layouts.delete(t.id)),this},getLayout(e){return this.layouts.get(e)},getMetadata(e){let t=this.schema.find((t=>t.id===e));return t?t.metadata:null},hasConceptProjection(e,t){const i=t=>t.concept.name===e.name;return g(t)?-1!==this.schema.findIndex((e=>i(e))):-1!==this.schema.findIndex((e=>{return s=e.type,!["template","rule","style"].includes(s)&&i(e)&&(e=>Array.isArray(e.tags)&&e.tags.includes(t))(e);var s}))},getSchema(){return this.schema},getProjectionSchema(e,t){if(g(e))throw new TypeError("Bad parameter: concept");var i=null;const s=e=>!["template","rule","style"].includes(e);return i=c(e)?this.schema.filter((t=>s(t.type)&&t.concept.name===e)):this.schema.filter((t=>{return s(t.type)&&((t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||!g(i=t.concept.prototype)&&"prototype"!==e.nature&&e.hasPrototype(i));var i})),d(t)&&!l(t)?i.filter((e=>e.tags&&e.tags.includes(t))):i},getTemplateSchema(e){let t=this.schema.find((t=>"template"===t.type&&t.name===e));return g(t)?null:ut(t)},getRuleSchema(e){let t=this.schema.find((t=>"rule"===t.type&&t.name===e));return g(t)?null:ut(t)},getStyleSchema(e){let t=this.schema.find((t=>"style"===t.type&&t.name===e));return g(t)?null:ut(t)},hasProjectionSchema(e,t){if(g(e))throw new TypeError("Bad parameter: concept");let i=[];const s=e=>!["template","rule","style"].includes(e);return i=c(e)?this.schema.filter((t=>s(t.type)&&t.concept.name===e)):this.schema.filter((t=>{return s(t.type)&&((t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||!g(i=t.concept.prototype)&&"prototype"!==e.nature&&e.hasPrototype&&e.hasPrototype(i));var i})),d(t)&&!l(t)?i.some((e=>e.tags&&e.tags.includes(t))):!l(i)},export(){const e=[];return this.getProjections().forEach((t=>{e.push(t.export())})),e}},un={container:null,menu:null,schema:null,isOpen:!1,visible:!0,btnStart:null,modelFileIO:null,projectionFileIO:null,init(e){return e&&(this.schema=e),this},get isRendered(){return O(this.container)},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this},clear(){return _e(this.container),this},update(){},render(){const e=D();return O(this.container)||(this.container=U({class:["editor-home"]})),O(this.menu)||(this.menu=dn.call(this),e.append(this.menu)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){const{hasConceptModel:e,hasProjectionModel:t}=this.editor;return e&&t||this.show(),this.modelFileIO.setFile(e?"file":null),this.projectionFileIO.setFile(t?"file":null),this.btnStart.disabled=!(e&&t),this},bindEvents(){}};function dn(){const e=F({class:["editor-home-section","editor-home-section--model"]});W({class:["title","editor-home-section__title","font-ui"]},"Modelling activity");let t=U({class:["editor-home-section__content","editor-home-section--model__content"]});this.modelFileIO=pn.call(this,"model"),this.projectionFileIO=pn.call(this,"projection");let i=U({class:["editor-home-section__menu","editor-home-section__menu--concept"]},[this.modelFileIO.render()]),s=U({class:["editor-home-section__menu","editor-home-section__menu--projection"]},[this.projectionFileIO.render()]);return t.append(i,s),this.btnStart=ce({class:["btn","editor-home-section--model__button","editor-home-section__button--start"],dataset:{action:"close",context:"home"}},"Start"),e.append(t,this.btnStart),e}function pn(e,t){const i=Object.create(mn,{editor:{value:this.editor}});return i.init(e,t),i}const mn={file:null,type:null,title:null,status:null,container:null,btnLoad:null,btnUnload:null,btnDownload:null,btnReLoad:null,init(e,t){return this.type=e,this.title=a(t,e),this},get hasFile(){return!g(this.file)},getFile(){return this.file},setFile(e){this.file=e,this.refresh()},refresh(){return this.hasFile?this.container.classList.remove("empty"):this.container.classList.add("empty"),this.btnReLoad.disabled=!this.hasFile,this.btnUnload.disabled=!this.hasFile,this.btnDownload.disabled=!this.hasFile,this},render(){this.container=U({class:["drop-area","editor-home-section__drop-area",`editor-home-section__drop-area--${this.type}`],dataset:{type:this.type}});let e=U({class:["drop-area__file-section"]}),t=ie({class:["icon","file-section__icon"]},`${this.type}`),i=U({class:["file-section__actionbar"]});var s;this.btnUnload=ce({class:["btn","file-section__actionbar-button","file-section__actionbar-button--remove"],title:`Unload the ${this.type}`,dataset:{action:`unload-${this.type}`}},"UN.load"),this.btnReLoad=ce({class:["btn","file-section__actionbar-button","file-section__actionbar-button--reload"],title:`Reload the ${this.type}`,dataset:{action:`reload-${this.type}`}},"RE.load"),this.btnDownload=ce({class:["btn","file-section__actionbar-button","file-section__actionbar-button--download"],title:`Download the ${this.type}`,dataset:{action:`download-${this.type}`}},"Download"),i.append(this.btnUnload,this.btnReLoad,this.btnDownload),e.append(t,i),this.btnLoad=ce({class:["btn","drop-area__button","drop-area__button--open"],title:`Load the ${this.type}`,dataset:{action:`load-${this.type}`}},`Select ${s=this.title.charAt(0),s&&["a","e","i","o","u"].includes(s.toLowerCase())?"an":"a"} ${this.title}`);let n=X({class:["drop-area__instruction"]},[this.btnLoad,"or drop it here"]);return this.container.append(e,n),this.bindEvents(),this.refresh(),this.container},bindEvents(){this.container.addEventListener("dragenter",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragleave",(e=>{this.container.classList.remove("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragover",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("drop",(e=>{this.container.classList.remove("highlight");let t=e.dataTransfer.files[0];if(!t.name.endsWith(".json"))return void this.notify("This file is not supported. Please use a .json file");let i=new FileReader;i.onload=e=>{this.editor.load(i.result,this.type)},i.readAsText(t),e.preventDefault(),e.stopPropagation()}),!1)}};function fn(e,t){const{name:i,object:s,id:n}=t,r=Y({class:["selector-concept",`selector-concept--${e}`],title:t.getName(),dataset:{concept:n,object:s}});var a=ee({class:["selector-concept-content"]},t.getName());r.append(a),"ancestor"===e&&a.classList.add("fit-content");const l=ie({class:["selector-concept-status"]});if(t.hasError){l.classList.add("error");let e=G({class:["bare-list","selector-concept-status__errors"]});t.errors.forEach((t=>{let i=Y({class:["selector-concept-status__error"]},t);i.style.minWidth=`${Math.min(.5*t.length,30)}em`,e.append(i)})),l.append(e),r.classList.add("error")}else l.classList.add("valid"),r.classList.add("valid");return r.append(l),r.addEventListener("mouseenter",(e=>{let t=we(`.projection[data-concept="${n}"]`,this.editor.body);t&&this.editor.highlight(t)})),r.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),r.addEventListener("click",(e=>{let t=we(`.projection[data-concept="${n}"]`,this.editor.body);t&&t.focus()})),r}const vn={container:null,title:null,visible:!0,conceptList:null,header:null,body:null,get isRendered(){return O(this.container)},init(e={}){return this.schema=e,this},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},update(){},refresh(){const{activeInstance:e,activeConcept:t,hasActiveInstance:i,hasActiveConcept:s}=this.editor;if(!i||!s)return _e(this.conceptList),this;const n=e.concept,r=D();let a=fn.call(this,"root",n);if(r.append(a),n===t&&a.classList.add("selector-concept--active"),n===t)return _e(this.conceptList).append(r),this;if(!t.hasParent())return _e(this.conceptList).append(r),this;let l=t.getParent(),o=[];for(;l&&l!==n;)o.unshift(l),l=l.getParent();return o.forEach((e=>{r.append(fn.call(this,"ancestor",e))})),a=fn.call(this,"active",t),r.append(a),_e(this.conceptList).append(r),this},render(){const e=D();O(this.container)||(this.container=U({class:["editor-breadcrumb"]})),O(this.notification)||(this.notification=U({class:["notification","breadcrumb-notification"]}),e.append(this.notification));const t=ee({class:["breadcrumb-title","hidden"],dataset:{ignore:"all"}},"Breadcrumb");return e.append(t),O(this.conceptList)||(this.conceptList=G({class:["bare-list","selector-concepts"]}),e.append(this.conceptList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.update(),this.refresh(),this.container},bindEvents(){}},gn={container:null,schema:null,isOpen:!1,visible:!0,btnStart:null,modelFileIO:null,projectionFileIO:null,get isRendered(){return O(this.container)},init(e){return e&&(this.schema=e),this},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this},clear(){return _e(this.container),this},update(){},render(){const e=D();return O(this.container)||(this.container=U({class:["editor-style"]})),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.close(),this.refresh(),this.container},refresh(){return this},bindEvents(){}},bn={container:null,schema:null,isOpen:!1,visible:!0,btnStart:null,logList:null,init(e){return e&&(this.schema=e),this},get isRendered(){return O(this.container)},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this},add(e,t,i="normal"){if(!Array.isArray(e))return;let s=G({class:["bare-list","log-item-messages"]});e.forEach((e=>s.append(Y({class:["log-item-message"]},e))));let n=Y({class:["log-item",`log-item--${i}`]}),r=ce({class:["btn","btn-delete"],dataset:{action:"delete",target:"parent"}},""),l=ee({class:["log-item__name"],dataset:{action:"delete",target:"parent"}},`${a(t,"Log")} (${y(Date.now())})`);return n.append(r,l,s),this.logList.append(n),this.refresh(),this},clear(){return _e(this.logList),this},update(){},render(){const e=D();return O(this.container)||(this.container=U({class:["editor-log"]})),O(this.logList)||(this.logList=G({class:["bare-list","log-list"]}),e.append(this.logList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this.logList.hasChildNodes()?this.show():this.hide(),this},bindEvents(){}},yn={container:null,list:null,editor:null,dataList:null,fetch:null,init(e){return this.fetch=e,this},render(){const e=D();return O(this.container)||(this.container=U({class:["container","container--editor-selectors"]})),O(this.list)||(this.list=G({class:["bare-list","editor-selectors","font-ui"]}),e.append(this.list)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this},update(){return this.dataList=this.fetch(),_e(this.list),this.dataList.forEach((e=>{const{concept:t,accept:i}=e;let s=q({class:["title","editor-selector__title"],title:e.description},`${e.name||e.type}`);t&&s.append(ee({class:["editor-selector__title-concept"]},(t.name||t.prototype).replace(" ","-").toLowerCase())),i&&s.append(ee({class:["editor-selector__title-accept"]},i.name));let n=ce({class:["btn","editor-selector__header-button","editor-selector__header-button--info"],title:`View ${e.name||e.type} info`,dataset:{action:"collapse",rel:"parent",target:"selector"}},"i"),r=B({class:["title","editor-selector__header"],title:`Expand/Collapse ${this.type}`},[s,n]),a=wn[this.type],l=U({class:["editor-selector__preview"]},a.call(this,e)),o=En[this.type],c=U({class:["editor-selector__action-bar"]},o.call(this,e)),h=Y({class:["editor-selector","collapsed","font-ui"],tabindex:0,dataset:{type:this.type,alias:`${e.name||e.type}`,name:"selector",projection:e.id}},[r,l,c]);this.list.append(h)})),this.refresh(),this},show(){return We(this.container),this},hide(){return qe(this.container),this},bindEvents(){}},wn={projection:function(e){const{concept:t,tags:i=[]}=e,s=D();let n=ee({class:["editor-selector__preview-concept"]},t.name||t.prototype),r=G({class:["bare-list","editor-selector__preview-tags"]});return i.forEach((e=>r.append(Y({class:["editor-selector__preview-tag"]},e)))),s.append(n,r),s},value:function(e){if(g(e))return te({class:["editor-selector__preview-null"]},"null");const{name:t,nature:i,value:s,attributes:n}=e;if(["string","number","boolean"].includes(t))return ee({class:["editor-selector__preview-text"]},s);if("set"===t){let e=G({class:["bare-list","editor-selector__preview-list"]});return Array.isArray(s)&&s.forEach((t=>{let i=Y({class:["editor-selector__preview-list-item"]},wn.value(t));e.append(i)})),e}if("prototype"===i){let e=D(),t=ee({class:["editor-selector__preview-text"]},s.name);return e.append(t,wn.value(s)),e}if(n){let e=G({class:["bare-list","editor-selector__preview-attributes"]});return n.forEach((t=>{const{name:i,value:s}=t;let n=ee({class:["editor-selector__preview-text","editor-selector__preview-text--attribute"]},i),r=Y({class:["editor-selector__preview-attribute"]},[n,wn.value(s)]);e.append(r)})),e}return s?wn.value(s):e.toString()},concept:function(e){const t=D();if(Array.isArray(e.attributes)){let i=G({class:["bare-list","editor-selector__attributes"]});e.attributes.forEach((e=>{const{name:t,required:s,target:n={}}=e;let r=ee({class:["editor-selector__preview-text","editor-selector__preview-text--attribute"]},t),a=ee({class:["editor-selector__preview-text","editor-selector__preview-text--target"]},n.name);n.accept&&n.accept.name&&a.append(ee({class:["editor-selector__preview-text--target-accept"]},n.accept.name));let l=Y({class:["editor-selector__attribute"]},[r,a]);s&&(l.classList.add("required"),ie({class:["editor-selector__badge"]})),i.append(l)})),t.append(i)}return t},resource:function(e){return D()}},En={projection:function(e){const t=D();let i=ce({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"edit:projection",id:e.id}},"Edit");return t.append(i),t},value:function(e){const t=D();let i=ce({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"create-instance:value",id:e.id}},ie({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),s=ce({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"copy:value",id:e.id}},ie({class:["ico","ico-copy","btn-content"],dataset:{ignore:"all"}})),n=ce({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:value",id:e.id}},ie({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},""));return t.append(n,s,i),t},concept:function(e){const t=D();let i=this.editor.projectionModel.hasProjectionSchema(e),s=ce({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],disabled:!i,title:`Create an instance of "${e.name}"`,dataset:{action:"create-instance",concept:e.name}},ie({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+"));return i||(s.title=`The concept ${e.name} has no projection`),t.append(s),t},resource:function(e){const{name:t,type:i,required:s}=e,n=D();let r=ce({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--add"],dataset:{action:"load-resource",id:t}},ie({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),a=ce({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:resource",id:t}},ie({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},""));return this.editor.getResource(t)?n.append(a):n.append(r),n}},Cn={editor:null,valueCount:0,fileCount:0,container:null,title:null,visible:!0,tabs:null,tabConcept:null,tabValue:null,tabProjection:null,tabResource:null,tabConceptNotification:null,tabValueNotification:null,tabProjectionNotification:null,tabResourceNotification:null,activeTab:null,activeTabValue:null,menu:null,header:null,body:null,btnHome:null,btnSave:null,get isRendered(){return O(this.container)},init(e){return e&&(this.editor=e),this._conceptSelector=function(e,t,i){return Object.create(yn,{object:{value:"selector"},model:{value:void 0},type:{value:"concept"},editor:{value:t}})}(0,this.editor).init((()=>{if(!this.editor.isReady)return[];const{conceptModel:e}=this.editor;let t=this.editor.getConfig("concepts");return g(t)&&(t=e.getSchema("concrete")),t.map((t=>e.getCompleteModelConcept(t)))})),this},render(){const e=D();O(this.container)||(this.container=U({class:["editor-header"],dataset:{name:"editor-header",alias:"header"}})),O(this.title)||(this.title=ee({class:["editor-header-title"]},"Editor")),O(this.menu)||(this.menu=U({class:["editor-header-left"]},[this.title])),this.btnSave=ce({class:["btn","editor-toolbar__button","editor-toolbar__button--save"],title:"Export your model",dataset:{action:"export"}}),this.btnHome=ce({class:["btn","editor-toolbar__button","editor-toolbar__button--home"],title:"Toggle the home menu",dataset:{action:"home"}});let t=U({class:["editor-toolbar"]},[this.btnSave,this.btnHome]);return O(this.header)||(this.header=U({class:["editor-header-menu"]},[this.menu,t]),e.append(this.header)),O(this.body)||(this.body=U({class:["editor-header-main"]}),e.append(this.body)),O(this.btnCollapse)||(this.btnCollapse=ce({class:["btn","editor-header__button","editor-header__button--collapse"],title:`Collapse ${this.container.dataset.alias}`,dataset:{action:"collapse",rel:"parent",target:this.container.dataset.name}}),e.append(this.btnCollapse)),O(this._conceptSelector.container)||this.body.append(this._conceptSelector.render()),this.btnCollapse.dataset.state=this.container.classList.contains("collapsed")?"ON":"OFF",e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){let e=this.editor.getConfig("name"),t=a(this.editor.getConfig("settings"),!0);return e&&(this.title.textContent=e),this.editor.hasConceptModel?(this._conceptSelector.update(),We(this.body),We(this.btnCollapse)):(qe(this.body),qe(this.btnCollapse)),this.btnHome.disabled=!this.editor.isReady,this.btnSave.disabled=!this.editor.hasInstances,!1===t&&qe(this.btnHome),this},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},bindEvents(){}};var jn=0;const Ln={createInstance(e,t,i){if(g(e))return this.notify("The concept is not valid",Ye.ERROR),!1;let s=t;g(s)&&this.hasProjectionModel&&(s=this.projectionModel.createProjection(e).init());let n=Object.create(xn,{id:{value:"instance"+jn++},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},concept:{value:e},projection:{value:s,writable:!0},editor:{value:this}});const r=Object.assign({type:"concept",minimize:!0,resize:!0,maximize:!0,close:"DELETE-CONCEPT"},i);return n.init(r),this.addInstance(n),n},getInstance(e){return this.instances.get(e)},addInstance(e){return e.isRendered||this.instanceSection.append(e.render()),this.instances.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.updateActiveInstance(e),this.refresh(),this},removeInstance(e){let t=this.getInstance(e);return!g(t)&&(t===this.activeInstance&&(this.activeInstance=null),t.view&&_e(t.view).remove(),this.instances.delete(e),this.refresh(),!0)},moveInstance(e,t){return this.instanceSection.children[t].before(e),this},swapInstance(e,t){let i=Array.from(this.instanceSection.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveInstance(t,s),this.moveInstance(e,n),this}},xn={window:null,container:null,title:null,visible:!0,menu:null,header:null,body:null,btnCollapse:null,btnMaximize:null,btnClose:null,size:1,fullscreen:!1,collapsed:!1,schema:null,ctype:null,get isRendered(){return O(this.container)},init(e={}){return this.ctype=a(e.type,"concept"),this.schema=e,this},collapse(){var e;return e=this.container,O(e)&&e.classList.add(De),this.collapsed=!0,this.fullscreen=!1,this.size="normal",this.refresh(),this},expand(){var e;return e=this.container,O(e)&&e.classList.remove(De),this.collapsed=!1,this.refresh(),this},changeSize(e){this.size=e,"fullscreen"===e?(this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height")):this.fullscreen=!1,this.refresh()},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},refresh(){return this.container.dataset.size=`${this.size}`,g(this.projection)&&(this.body.textContent="No projection found"),Array.from(this.editor.instances).some((e=>e.fullscreen))?this.editor.instanceSection.classList.add("fullscreen"):this.editor.instanceSection.classList.remove("fullscreen"),this},render(){const e=D(),{name:t}=this.concept,i=t.toLowerCase();O(this.container)||(this.container=U({class:["editor-concept",`editor-concept--${this.ctype}`],tabindex:0,title:"concept"===this.schema.type?`Instance of "${i}"`:`Linked instance of "${i}"`,dataset:{nature:"concept-container",type:this.ctype,size:1}})),O(this.header)||(this.header=B({class:["editor-concept-header"]}),e.append(this.header)),O(this.btnClose)||(this.btnClose=ce({class:["btn","editor-concept-toolbar__btn-delete"],title:`Delete the instance "${i}"`,dataset:{action:"close",context:this.type,id:this.id}}),"projection"===this.schema.type&&(this.btnClose.title=`Close the linked instance "${i}"`)),O(this.btnCollapse)||(this.btnCollapse=ce({class:["btn","editor-concept-toolbar__btn-collapse"],title:`Collapse ${t.toLowerCase()}`,dataset:{action:"collapse",context:this.type,id:this.id}})),O(this.btnMaximize)||(this.btnMaximize=ce({class:["btn","editor-concept-toolbar__btn-maximize"],title:`Maximize ${t.toLowerCase()}`,dataset:{action:"maximize",context:this.type,id:this.id}})),this.title=W({class:["title","editor-concept-title","fit-content"],dataset:{nature:"editable",id:this.id}},t);let s=U({class:["editor-concept-toolbar"]},[this.btnCollapse,this.btnMaximize,this.btnClose]);return _e(this.header).append(this.title,s),this.body&&this.body.remove(),this.projection?this.body=this.projection.render():this.body=X(),e.append(this.body),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),function(e,t={}){const i=ht(e);if(!O(i))return null;const s=Object.assign({horizontal:!0,vertical:!0,minWidth:60,minHeight:60},t),n=function(){let e=U({class:["resizers"]});return["horizontal","vertical"].forEach((t=>{e.append(U({class:["resizer",`${t}`],dataset:{dir:t}}))})),e}();i.prepend(n),s.horizontal&&s.vertical?i.dataset.resizable="both":s.horizontal?i.dataset.resizable="horizontal":s.vertical&&(i.dataset.resizable="vertical");const{minWidth:r,minHeight:l}=getComputedStyle(i),o=a(et(r),s.minWidth),c=a(et(l),s.minHeight);let h=0,u=null;function d(e){const{dir:t}=u.dataset,{width:s,height:n}=getComputedStyle(i);let r="horizontal"===t?e.pageX:e.pageY;if("horizontal"===t){const e=et(s)+(r-h);e>o&&(i.style.width=`${e}px`)}else if("vertical"===t){const e=et(n)+(r-h);e>c&&(i.style.height=`${e}px`)}h=r}for(let e=0;e<n.childElementCount;e++){const t=n.children[e];t.addEventListener("mousedown",(function(e){e.preventDefault(),u=t;const{dir:i}=u.dataset;h="horizontal"===i?e.pageX:e.pageY,document.body.addEventListener("mousemove",d),document.body.addEventListener("mouseup",(()=>{document.body.removeEventListener("mousemove",d)}))}))}}(this.container),this.refresh(),this.container},actionHandler(e){switch(e){case"collapse":this.collapsed?this.expand():this.collapse();break;case"maximize":this.fullscreen?this.changeSize("normal"):this.changeSize("fullscreen");break;case"close":this.delete()}},delete(){switch(this.schema.close){case"DELETE-CONCEPT":if(!this.concept.delete(!0))return this.editor.notify("The concept could not be deleted",Ye.ERROR),this;break;case"DELETE-PROJECTION":if(this.projection&&!this.projection.delete())return this.notify("The projection could not be deleted",Ye.ERROR),this}_e(this.container).remove(),this.editor.removeInstance(this.id),this.window&&this.window.removeInstance(this)},bindEvents(){this.container.addEventListener("focusin",(e=>{this.editor.updateActiveInstance(this)})),this.header.addEventListener("focusout",(e=>{f(this.title.textContent)&&(this.title.textContent=this.concept.name)}))}};var _n=0;const An={createWindow(e){let t=Object.create(On,{id:{value:"window"+_n++},object:{value:"environment"},name:{value:"editor-window"},type:{value:"window"},editor:{value:this}});return t.refname=e,t.init(),this.addWindow(t),t},getWindow(e){return this.windows.get(e)},findWindow(e){return Array.from(this.windows.values()).find((t=>t.refname===e))},addWindow(e){return e.isRendered||this.body.append(e.render()),this.windows.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.refresh(),this},removeWindow(e){let t=this.getWindow(e);return!g(t)&&(t===this.activeWindow&&(this.activeWindow=null),t.view&&_e(t.view).remove(),this.windows.delete(e),this.refresh(),!0)},moveWindow(e,t){return this.body.children[t].before(e),this},swapWindow(e,t){let i=Array.from(this.body.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveWindow(t,s),this.moveWindow(e,n),this}},On={container:null,title:null,visible:!0,instances:null,menu:null,header:null,body:null,btnClose:null,maxInstance:1,get isRendered(){return O(this.container)},init(e={}){return this.ctype=a(e.type,"concept"),this.schema=e,this.instances=new Set,this},isEmpty(){return 0===this.instances.size},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},close(){_e(this.container).remove(),this.editor.removeWindow(this.id)},refresh(){return this.isEmpty()?this.hide():this.show(),this},render(){const e=D();O(this.container)||(this.container=U({class:["editor-window"],tabindex:-1})),O(this.header)||(this.header=B({class:["editor-window-header"]}),e.append(this.header)),O(this.title)||(this.title=W({class:["title","editor-window-title","fit-content"]})),O(this.btnClose)||(this.btnClose=ce({class:["btn","editor-window-header__btn-delete"],title:"Close the window",dataset:{action:"close",context:this.type,id:this.id}}));let t=U({class:["editor-window-toolbar"]},[this.btnClose]);return _e(this.header).append(this.title,t),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},addInstance(e){if(!g(e)&&!this.instances.has(e))return this.instances.add(e),e.window=this,this.container.append(e.container),this.refresh(),!0},removeInstance(e){if(!g(e)&&this.instances.has(e))return this.instances.delete(e),this.refresh(),!0},actionHandler(e){switch(e){case"close":this.close()}},bindEvents(){}},Sn={conceptModel:null,projectionModel:null,concept:null,projection:null,container:null,title:null,visible:!0,menu:null,header:null,body:null,btnClose:null,schema:null,get isRendered(){return O(this.container)},init(e={}){this.schema=e;const{concept:t,projection:i,handlers:s}=this.element.design();return this.conceptModel=gi.createModel(t).init(),this.projectionModel=cn(i,this).init(),this.concept=this.conceptModel.createConcept(this.element.name),this.projection=this.projectionModel.createProjection(this.concept).init(),this.concept.getAttributes().forEach((e=>{if(s[e.name]){let t={update:s[e.name]};e.target.register(t)}})),this},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},refresh(){return this},render(){const e=D();O(this.container)||(this.container=U({class:["editor-element"],dataset:{nature:"concept-container",size:1}}));const{name:t}=this.element;O(this.header)||(this.header=B({class:["editor-element-header"]}),e.append(this.header)),O(this.btnClose)||(this.btnClose=ce({class:["btn","editor-element-toolbar__btn-delete"],title:`Delete ${t.toLowerCase()}`,dataset:{action:"close",context:this.type,id:this.id}}));let i=W({class:["title","editor-concept-title","fit-content"]},t),s=U({class:["editor-concept-toolbar"]},[this.btnClose]);return _e(this.header).append(i,s),e.append(this.projection.render()),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},getField(e){if(!O(e))return console.warn("Field error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return g(t)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(i)?this.projectionModel.getField(t):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(e){if(!O(e))return console.warn("Static error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return g(t)?(console.warn("Static error: Missing id attribute on field"),null):["static"].includes(i)?this.projectionModel.getStatic(t):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(e){if(!O(e))return console.warn("Layout error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return g(t)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(i)?this.projectionModel.getLayout(t):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(e){if(!O(e))return null;const{nature:t}=e.dataset;if(g(t))return null;let i=null;switch(t){case"field":case"field-component":i=this.getField(e);break;case"layout":case"layout-component":i=this.getLayout(e);break;case"static":i=this.getStatic(e)}return i&&(i.environment=this),i},updateActiveElement(e){return this.activeElement&&this.activeElement===e||(this.activeElement=e),this},actionHandler(e){},bindEvents(){var e=null;this.container.addEventListener("click",(e=>{var t=Ke(e.target);const{action:i,context:s,id:n,handler:r}=t.dataset;this.activeElement&&this.activeElement.clickHandler(t)}),!0),this.container.addEventListener("keydown",(t=>{const{target:i}=t,{nature:s}=i.dataset;var n=!1;switch(t.key){case Ge.backspace:this.activeElement&&e!==Ge.ctrl&&!0===this.activeElement.backspaceHandler(i)&&t.preventDefault();break;case Ge.ctrl:case Ge.shift:t.preventDefault(),n=!0;break;case Ge.delete:this.activeElement&&e!==Ge.ctrl&&this.activeElement.deleteHandler(i)&&t.preventDefault();break;case Ge.spacebar:this.activeElement&&e!==Ge.ctrl&&this.activeElement.spaceHandler(i)&&t.preventDefault();break;case Ge.alt:t.preventDefault();break;case Ge.enter:this.activeElement?!0===this.activeElement.enterHandler(i)&&t.preventDefault():"BUTTON"===i.tagName?(i.click(),t.preventDefault()):t.preventDefault();break;case Ge.escape:this.activeElement&&!0===this.activeElement.escapeHandler(i)&&t.preventDefault();break;case Ge.insert:this.activeElement&&t.preventDefault();break;case Ge.up_arrow:this.activeElement&&![Ge.ctrl,Ge.shift,Ge.alt].includes(e)&&!0===this.activeElement.arrowHandler("up",i)&&t.preventDefault();break;case Ge.down_arrow:this.activeElement&&![Ge.ctrl,Ge.shift,Ge.alt].includes(e)&&!0===this.activeElement.arrowHandler("down",i)&&t.preventDefault();break;case Ge.right_arrow:this.activeElement&&![Ge.ctrl,Ge.shift,Ge.alt].includes(e)&&!0===this.activeElement.arrowHandler("right",i)&&t.preventDefault();break;case Ge.left_arrow:this.activeElement&&![Ge.ctrl,Ge.shift,Ge.alt].includes(e)&&!0===this.activeElement.arrowHandler("left",i)&&t.preventDefault();break;case"s":e===Ge.ctrl&&(this.activeConcept.copy(),t.preventDefault());break;case"e":e===Ge.ctrl&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{type:"projection",close:"DELETE-PROJECTION"}),t.preventDefault())}n&&(e=t.key)}),!1),this.container.addEventListener("keyup",(t=>{var i=t.target;switch(t.key){case Ge.spacebar:this.activeElement&&e===Ge.ctrl&&this.activeElement._spaceHandler(i);break;case Ge.delete:this.activeElement&&e===Ge.ctrl&&this.activeElement.delete(i);break;case Ge.alt:this.activeElement&&e===Ge.ctrl&&this.design(this.activeElement);break;case Ge.up_arrow:this.activeElement&&e===Ge.ctrl&&!0===this.activeElement._arrowHandler("up",i)&&t.preventDefault(),this.activeElement&&e===Ge.shift&&!0===this.activeElement.shiftHandler("up",i)&&t.preventDefault();break;case Ge.down_arrow:this.activeElement&&e===Ge.ctrl&&!0===this.activeElement._arrowHandler("down",i)&&t.preventDefault();break;case Ge.right_arrow:this.activeElement&&e===Ge.ctrl&&!0===this.activeElement._arrowHandler("right",i)&&t.preventDefault();break;case Ge.left_arrow:this.activeElement&&e===Ge.ctrl&&!0===this.activeElement._arrowHandler("left",i)&&t.preventDefault()}e===t.key&&(e=-1)}),!1),this.container.addEventListener("focusin",(e=>{const{target:t}=e,i=this.resolveElement(t);if(i&&i.projection.focusable&&i.focusable){if(this.activeElement&&this.activeElement!==i&&(this.activeElement.focusOut(),this.activeElement=null),g(i)||i===this.activeElement)return void(this.activeElement&&this.activeElement._focusIn(t));this.updateActiveElement(i),this.activeElement.focusIn(t)}else i||(this.activeElement&&this.activeElement.focusOut(t),this.activeElement=null)}))}},In={modelstatus:null,notification:null,views:null,view:"grid",viewContainer:null,viewList:null,viewItem:null,activeViewItem:null,groupList:null,groupItem:null,activeGroupItem:null,visible:!0,container:null,get isRendered(){return O(this.container)},init(){return this.views=new Map,this},show(){return We(this.container),this.visible=!0,this},hide(){return qe(this.container),this.visible=!1,this},toggle(){return Ue(this.container),this.visible=!this.visible,this},updateActiveView(){"tab"===this.view&&(this.editor.instances.forEach((e=>{e!==this.editor.activeInstance&&(e.view.classList.remove("active"),e.hide())})),this.editor.activeInstance.view.classList.add("active"),this.editor.activeInstance.show()),this.editor.refresh()},addView(e){if(g(e))return!1;let t=e.title.textContent,i=ie({class:["ico","ico-delete"]},""),s=ce({class:["btn","btn-close"]},i),n=U({class:[`editor-view-${this.view}list-item__content`,"fit-content"]},t),r=Y({class:[`editor-view-${this.view}list-item`],title:e.title.textContent},[n,s]);e.view=r,r.addEventListener("click",(t=>{if(function(e){const t=e=>e===r||e===s;return t(e)?e:je(e,(e=>t(e)),5)}(t.target)===s){let t=r.previousSibling||r.nextSibling;e.delete(),null===this.editor.activeInstance&&t&&t.click()}else this.editor.updateActiveInstance(e)})),this.tabView.append(r)},changeView(e){if(e===this.view)return this;var t;this.view=e,t=this.viewItem,O(t)&&t.classList.remove(ze),this.viewItem=this.views.get(this.view),function(e){O(e)&&e.classList.add(ze)}(this.viewItem),_e(this.editor.viewSection),"tab"===e?(this.tabView=G({class:["bare-list","editor-view-tablist"]}),_e(this.tabView),this.editor.instances.forEach((e=>{e.expand(),this.addView(e)})),this.editor.viewSection.append(this.tabView)):("grid"===e||"row"===e||"col"===e)&&this.editor.instances.forEach((e=>{e.show()})),this.updateActiveView()},addGroup(){Y({class:["editor-footer-group"]})},notify(e,t=4500){let i=e;const s="open";if(this.notification.classList.contains(s))return!1;this.notification.appendChild(i),setTimeout((()=>{this.notification.classList.add(s),this.container.classList.add("menu--notifying")}),50),setTimeout((()=>{this.notification.classList.remove(s),this.container.classList.remove("menu--notifying"),setTimeout((()=>{_e(this.notification)}),500)}),t)},refresh(){const{conceptModel:e}=this.editor;if(this.editor.isReady)if(e.hasError){this.modelstatusBadge.classList.add("error"),this.modelstatusBadge.classList.remove("valid"),this.container.classList.add("error");let t=e.concepts.filter((e=>e.hasError)).length;this.modelstatusInfo.textContent=`${t} ${function(e,t,i){if(1===i)return e;let s="s".split("|");return 1===s.length?e+s[0]:e.substring(0,e.lastIndexOf(s[0]))+s[1]}("error",0,t)}`}else this.modelstatusBadge.classList.add("valid"),this.modelstatusBadge.classList.remove("error"),this.container.classList.remove("error"),_e(this.modelstatusInfo),this.editor.logs.clear()},render(){const e=D();if(O(this.container)||(this.container=U({class:["editor-statusbar"]})),O(this.modelstatus)||(this.modelstatus=U({class:["editor-statusbar-model"]}),this.modelstatusBadge=ie({class:["editor-statusbar-model-badge"]}),this.modelstatusInfo=U({class:["editor-statusbar-model-info"]}),this.modelstatus.append(this.modelstatusBadge,this.modelstatusInfo),e.appendChild(this.modelstatus)),O(this.viewContainer)||(this.viewContainer=U({class:["editor-statusbar-viewer-container"]}),e.appendChild(this.viewContainer)),!O(this.btnGroup)){let e=ie({class:["ico","ico-plus","btn-content"],title:"Add a group",dataset:{ignore:"all"}},"+");this.btnGroup=ce({class:["editor-statusbar-viewer__button-add"],dataset:{action:"add-group"}},e)}return O(this.groupContainer)||(this.groupContainer=U({class:["editor-footer-group"]})),O(this.viewList)||(this.viewList=G({class:["bare-list","editor-statusbar-viewers"]}),this.viewContainer.appendChild(this.viewList)),["tab","grid","row"].forEach((e=>{let t=Y({class:["editor-statusbar-viewer"],dataset:{type:"viewer",action:"change-view",value:e}},e);this.views.set(e,t),this.viewList.append(t)})),this.viewItem=this.views.get(this.view),this.viewItem.classList.add("selected"),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},bindEvents(){function e(e,t){let i=te({class:["link","error-message__link"]},e);const s=`.projection[data-concept="${t}"]`;return i.addEventListener("mouseenter",(e=>{let t=we(s,this.editor.body);t&&this.editor.highlight(t)})),i.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),i.addEventListener("click",(e=>{let t=this.editor.resolveElement(we(s,this.editor.body));t&&t.focus()})),i}this.modelstatus.addEventListener("click",(t=>{if(!this.editor.conceptModel.hasError)return;let i=[];this.editor.conceptModel.concepts.forEach((t=>{t.hasError&&i.push(...t.errors.map((i=>{let s=e.call(this,t.getName(),t.id);return ee({class:["error-message"]},[s,`: ${i}`])})))})),this.editor.logs.clear(),this.editor.logs.add(i,"Validation error","error")})),this.editor.registerHandler("editor.instance@active:updated",(()=>{this.updateActiveView()}))}};var Vn=0;const Rn=()=>"value"+Vn++;function Mn(){return Object.create(Cn,{object:{value:"environment"},name:{value:"editor-header"},editor:{value:this}})}function Tn(){return Object.create(vn,{object:{value:"environment"},name:{value:"editor-breadcrumb"},type:{value:"breadcrumb"},editor:{value:this}})}function kn(){return Object.create(un,{object:{value:"environment"},name:{value:"editor-home"},type:{value:"home"},editor:{value:this}})}function Nn(){return Object.create(gn,{object:{value:"environment"},name:{value:"editor-style"},type:{value:"style"},editor:{value:this}})}function Hn(){return Object.create(In,{object:{value:"environment"},name:{value:"editor-status"},type:{value:"status"},editor:{value:this}})}function Pn(){return Object.create(bn,{object:{value:"environment"},name:{value:"editor-log"},type:{value:"log"},editor:{value:this}})}const $n={conceptModel:null,projectionModel:null,concept:null,activeConcept:null,activeProjection:null,activeInstance:null,container:null,header:null,body:null,instanceSection:null,designSection:null,navigationSection:null,valueWindow:null,valueList:null,breadcrumb:null,filter:null,home:null,style:null,logs:null,status:null,group:null,input:null,copyValue:null,states:null,activeElement:null,decoratedElements:null,config:null,active:!1,visible:!1,frozen:!1,handlers:null,instances:null,windows:null,values:null,resources:null,models:null,init(e={}){const{conceptModel:t,projectionModel:i,config:s={},handlers:n={}}=e;this.config=s,this.handlers=new Map,this.instances=new Map,this.windows=new Map,this.values=new Map,this.resources=new Map,this.models=new Map,Object.assign(this,Ln,An),this.states=[],this.decoratedElements=new Set;for(const e in n){const t=n[e];this.registerHandler(e,t)}return this.header=Mn.call(this).init(),this.home=kn.call(this).init(),this.breadcrumb=Tn.call(this).init(),this.style=Nn.call(this).init(),this.logs=Pn.call(this).init(),this.status=Hn.call(this).init(),this.render(),t&&this.loadConceptModel(t),i&&this.loadProjectionModel(i),this.isReady&&(this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)})),this.open()),this},setConfig(e){return!g(e)&&(this.config=e,this.refresh(),this)},getConfig(e){return g(e)?this.config:this.config[e]},getName(){return a(this.config.name,`editor${(new Date).getTime()}`)},get hasConceptModel(){return!g(this.conceptModel)},get hasProjectionModel(){return!g(this.projectionModel)},get hasInstances(){return this.instances.size>0},get hasWindows(){return this.windows.size>0},get hasValues(){return this.values.size>0},get isReady(){return this.hasConceptModel&&this.hasProjectionModel},get hasActiveConcept(){return!g(this.activeConcept)},get hasActiveProjection(){return!g(this.activeProjection)},get hasActiveInstance(){return!g(this.activeInstance)},createConcept(e){if(g(e))throw new TypeError("Missing argument: The 'name' is required to create a concept");return this.conceptModel.isConcept(e)?this.conceptModel.createConcept(e):(this.notify(`The concept '${e}' is not defined in the model`,Ye.ERROR),!1)},addConcept(e){let t=e.concept||e;Array.isArray(t)?this.conceptModel.schema.push(...t):this.conceptModel.schema.push(t),this.refresh()},createProjection(e,t){if(g(e))throw new TypeError("Missing argument: The 'concept' is required to create a projection");return this.projectionModel.hasConceptProjection(e,t)?this.projectionModel.createProjection(e,t).init():(this.notify(`The projection for the concept '${e.name}' is not defined in the model`,Ye.ERROR),!1)},addProjection(e){let t=e.projection||e;Array.isArray(t)?this.projectionModel.schema.push(...t):this.projectionModel.schema.push(t),this.refresh()},getField(e){if(!O(e))return console.warn("Field error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return g(t)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(i)?this.projectionModel.getField(t):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(e){if(!O(e))return console.warn("Static error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return g(t)?(console.warn("Static error: Missing id attribute on field"),null):["static","static-component"].includes(i)?this.projectionModel.getStatic(t):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(e){if(!O(e))return console.warn("Layout error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return g(t)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(i)?this.projectionModel.getLayout(t):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(e){if(!O(e))return null;const{nature:t}=e.dataset;if(g(t))return null;let i=null;switch(t){case"field":case"field-component":i=this.getField(e);break;case"layout":case"layout-component":i=this.getLayout(e);break;case"static":case"static-component":i=this.getStatic(e)}return i&&(i.environment=this),i},download(e,t,i){const s="application/json";window.URL=window.webkitURL||window.URL;var n=K({class:["bare-link","download-item__link"]},"Download");f(n.href)||window.URL.revokeObjectURL(n.href);var r=new Blob([JSON.stringify(e)],{type:s});return Object.assign(n,{download:`${a(t,(new Date).getTime())}.jsoncp`,href:window.URL.createObjectURL(r)}),n.dataset.downloadurl=[s,n.download,n.href].join(":"),n.click(),setTimeout((()=>{window.URL.revokeObjectURL(n.href),n.remove()}),1500),e},export(e=!1){const t="application/json";window.URL=window.webkitURL||window.URL;var i=K({});this.container.append(i),f(i.href)||window.URL.revokeObjectURL(i.href);const s={concept:this.conceptModel.schema,values:this.conceptModel.export(),editor:this.config,meta:{date:y(),device:navigator.userAgent}};var n=new Blob([JSON.stringify(s)],{type:t});return Object.assign(i,{download:"model.jsoncp",href:window.URL.createObjectURL(n)}),i.dataset.downloadurl=[t,i.download,i.href].join(":"),e?(Ae(JSON.stringify(s)),this.notify("The model has been copied to clipboard",Ye.SUCCESS)):(i.click(),this.notify("The model has been downloaded",Ye.SUCCESS)),setTimeout((()=>{window.URL.revokeObjectURL(i.href),i.remove()}),1500),s},createState(e,t){const{id:i,name:s}=e;let n=Rn(),r=JSON.stringify(e.clone()),a=(b(new Date,"hh:dd"),ie({class:["ico","ico-delete"]},"")),l=ce({class:["btn","btn-delete"],title:`Delete ${s} state`},a),o=U({class:["model-state-preview"],title:`Preview ${s}`},t),c=ee({class:["model-state-content","fit-content"]},`${e.getName()}`),h=Y({class:["model-state"],title:`Restore ${s} state`,dataset:{id:n,concept:i}},[l,c,o]);h.addEventListener("click",(e=>{let t=function(e){const t=e=>e===h||e===l;return t(e)?e:je(e,(e=>t(e)),5)}(e.target);if(this.unhighlight(),t===l)this.removeState(n);else{let e=this.restore(r);this.removeState(n);let t=we(`.projection[data-concept="${e.id}"]`,this.body);t&&t.focus()}}));let u=`.projection[data-concept="${i}"]`;if(h.addEventListener("mouseenter",(e=>{let t=we(u,this.body);t&&this.highlight(t)})),h.addEventListener("mouseleave",(e=>{this.unhighlight()})),this.states.length>8){let{id:e}=this.stateList.lastChild.dataset;this.removeValue(e)}let d=Object.create({},{id:{value:n},object:{value:"value"},type:{value:"state"},element:{value:h},concept:{value:e},value:{value:r}});return this.addState(d),d},getState(e){if(!g(e)&&!l(this.states))return this.states[e]},addState(e){return this.stateList.append(e.element),this.states.push(e),this.refresh(),e},removeState(e){if(g(e))return;const t=this.states.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.states.splice(t,1)[0],{element:s}=i;return _e(s).remove(),this.refresh(),this},save(e,t){this.createState(e,t),this.refresh()},restore(e){let t=JSON.parse(e),i=this.conceptModel.getConcept(t.id);return i.restore(t),this.refresh(),i},undo(){if(l(this.states))return void this.notify("There are no previous state",Ye.NORMAL,2e3);let e=function(e){if(!Array.isArray(e))throw new TypeError("Bad argument");if(!l(e))return e[e.length-1]}(this.states);this.restore(e.value),this.removeState(e.id)},notify(e,t,i=4500){let s=X({class:["notify"],html:e});const n="open";t&&s.classList.add(t),this.container.append(s),setTimeout((()=>{s.classList.add(n)}),50),setTimeout((()=>{s.classList.remove(n),setTimeout((()=>{s.remove()}),500)}),i)},addResource(e,t){let i=a(t,e.name.split(".")[0]);this.resources.set(i,e);let s=new FileReader;return s.onload=e=>{this.addModel(i,s.result)},s.readAsText(e),this.refresh(),e},getResource(e){return this.resources.get(e)},hasResource(e){return this.resources.has(e)},removeResource(e){return this.resources.delete(e),this.triggerEvent({name:"resource.removed"}),this.refresh(),!0},getModel(e){let t=this.models.get(e);return g(t)?null:JSON.parse(t)},addModel(e,t){this.models.set(e,t)},removeModel(e){return this.triggerEvent({name:"model.remove@pre",args:[e]},(()=>{this.models.delete(e),this.refresh(),this.triggerEvent({name:"model.remove@post"})}),!1),!0},hasModel(e){return this.models.has(e)},getValue(e){if(this.values.has(e))return this.values.get(e)},addValue(e){let t=Rn(),i=ie({class:["ico","ico-copy"]}),s=ie({class:["ico","ico-delete"]},""),n=ce({class:["btn","btn-copy","fit-content"],title:`Copy ${e.name}`},[i,e.name]),r=ce({class:["btn","btn-delete"]},s),a=Y({class:["model-value"],dataset:{id:t}},[n,r]);if(n.addEventListener("click",(t=>{this.copy(e)})),r.addEventListener("click",(e=>{this.removeValue(t)})),this.values.size>5){let{id:e}=this.valueList.lastChild.dataset;this.removeValue(e)}return this.valueList.prepend(a),this.values.set(t,{element:a,value:e}),this.refresh(),e},removeValue(e){if(g(e)||!this.values.has(e))return;let{element:t}=this.values.get(e);return _e(t).remove(),this.values.delete(e),this.refresh(),this},copy(e,t=!1){return g(e)||(this.copyValue=e,Ae(JSON.stringify(e)),t&&this.addValue(e),this.notify(`${e.name} copied`,Ye.NORMAL)),this},paste(e,t){let i=a(t,this.copyValue);if(g(e)){let e=this.createConcept(i.name).init();e.setValue(i),this.createInstance(e)}else"prototype"===i.nature?e.setValue(i.value):e.setValue(i);return this},show(){return this.triggerEvent({name:"editor.show@pre"},(()=>{We(this.container),this.visible=!0,this.triggerEvent({name:"editor.show@post"})}),!1),this},hide(){return this.triggerEvent({name:"editor.hide@pre"},(()=>{qe(this.container),this.visible=!1,this.triggerEvent({name:"editor.hide@post"})}),!1),this},toggle(){return this.triggerEvent({name:"editor.toggle@pre"},(()=>{Ue(this.container),this.visible=!this.visible,this.triggerEvent({name:"editor.toggle@post"})}),!1),this},open(){return this.triggerEvent({name:"editor.open@pre"},(()=>{this.show(),this.active=!0,this.isReady&&this.home.close(),this.triggerEvent({name:"editor.open@post"})}),!1),this},close(){return this.triggerEvent({name:"editor.close@pre"},(()=>{this.hide(),this.active=!1,this.done(),this.clear(),this.triggerEvent({name:"editor.close@post"})}),!1),this},destroy(){return this.triggerEvent({name:"editor.destroy@pre"},(()=>{this.hide(),this.done(),this.instances.forEach((e=>e.delete())),_e(this.container).remove()}),!1),!0},freeze(){return this.triggerEvent({name:"editor.freeze@pre"},(()=>{this.frozen=!0,this.refresh(),this.triggerEvent({name:"editor.freeze@post"})}),!1),this},unfreeze(){return this.frozen=!1,this.refresh(),this},done(){return this.conceptModel&&this.conceptModel.done(),this.projectionModel&&this.projectionModel.done(),this},highlight(e){return O(e)?(function(e){O(e)&&e.classList.add(Be)}(e),this.decoratedElements.add(e),this):this},unhighlight(e){return O(e)?(Je(e),this.decoratedElements.delete(e),this):(this.decoratedElements.forEach((e=>Je(e))),this.decoratedElements.clear(),this)},createWindow(){let e=U({class:["editor-window"],tabindex:0});this.body.append(e)},unloadConceptModel(){return this.hasConceptModel&&(this.conceptModel.done(),this.conceptModel=null,this.refresh()),this},loadConceptModel(e,t){let i=e.concept||e;return Array.isArray(i)?l(i)?(this.notify("The concept model is empty",Ye.ERROR),!1):(this.unloadConceptModel(),this.clear(),this.conceptModel=gi.createModel(i,this).init(t),g(this.conceptModel),this.hasProjectionModel&&this.projectionModel.done(),this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)})),this.refresh(),this):(this.notify("Invalid concept model",Ye.ERROR),!1)},unloadProjectionModel(){return this.hasProjectionModel&&(this.projectionModel.done(),this.projectionModel=null,this.refresh()),this},loadProjectionModel(e,t){let i=e.projection||e;return Array.isArray(i)?l(i)?(this.notify("The projection model is empty",Ye.ERROR),!1):(this.unloadProjectionModel(),this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,g(this.projectionModel)&&(this.projectionModel=cn(i,this).init(t)),this.projectionModel.setSchema(i),g(this.projectionModel),this.instances.forEach((e=>{e.projection=this.projectionModel.createProjection(e.concept).init(),e.render()})),this.refresh(),this):(this.notify("Invalid projection model",Ye.ERROR),!1)},load(e,t,i){let s=new FileReader;if("model"===t)s.onload=e=>{const t=JSON.parse(s.result);if(Array.isArray(t))this.loadConceptModel(t);else{const{concept:e,values:i=[],editor:s}=t;this.loadConceptModel(e,i),s&&this.setConfig(s)}},s.readAsText(e);else if("projection"===t)s.onload=e=>{const t=JSON.parse(s.result);if(Array.isArray(t))this.loadProjectionModel(t);else{const{projection:e,views:i=[]}=t;this.loadProjectionModel(e,i)}},s.readAsText(e);else{if("resource"!==t)return this.notify(`File type '${t}' is not handled`,Ye.WARNING),!1;this.addResource(e,i)}return!0},unload(){return this.unloadConceptModel(),this.unloadProjectionModel(),this.clear(),this},clear(){return this.triggerEvent({name:"editor.clear@pre"},(()=>{this.instances.forEach((e=>e.delete())),this.instances.clear(),this.resources.clear(),this.models.clear(),this.states.forEach((e=>e.element.remove())),this.states=[],this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,this.refresh(),this.triggerEvent({name:"editor.clear@post"})}),!1),this},design(e,t){if(g(e))return!1;let i=Object.create(Sn,{id:{value:this.id},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},element:{value:e},editor:{value:this}});const s=Object.assign({minimize:!0,close:!0},t);return i.init(s),this.designSection.append(i.render())},update(e,t,i){this.triggerEvent({name:e})},render(e){const t=D();if(this.home.isRendered||t.append(this.home.render()),this.style.isRendered||t.append(this.style.render()),this.header.isRendered||t.append(this.header.render()),O(this.navigationSection)||(this.navigationSection=F({class:["model-navigation-section"]}),this.viewSection=z({class:["model-view-section"]}),this.navigationSection.append(this.viewSection),t.append(this.navigationSection)),!O(this.body)){this.body=U({class:["editor-body"],tabindex:0});let e=U({class:["editor-body-main"],tabindex:0});this.instanceSection=F({class:["model-concept-section"]}),e.append(this.instanceSection),this.body.append(e),t.append(this.body)}return O(this.timeline)||(this.timeline=U({class:["editor-timeline"]}),this.stateList=G({class:["bare-list","model-state-list"]}),this.timeline.append(this.stateList),t.append(this.timeline)),this.logs.isRendered||t.append(this.logs.render()),this.breadcrumb.isRendered||this.navigationSection.append(this.breadcrumb.render()),O(this.valueSection)||(this.valueSection=U({class:["model-value-window"]}),this.valueList=G({class:["bare-list","model-value-list"]}),this.valueSection.append(this.valueList),this.navigationSection.append(this.valueSection)),this.status.isRendered||t.append(this.status.render()),O(this.input)||(this.input=se({type:"file",class:["hidden"],accept:".json,.jsoncp"}),t.append(this.input)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),O(e)&&e.append(this.container),this.refresh(),this.container},refresh(e=!1){return this.frozen&&!e||(this.hasConceptModel?this.container.classList.remove("no-concept-model"):this.container.classList.add("no-concept-model"),this.hasProjectionModel?this.container.classList.remove("no-projection-model"):this.container.classList.add("no-projection-model"),this.hasValues?We(this.valueWindow):qe(this.valueWindow),this.header.refresh(),this.breadcrumb.refresh(),this.home.refresh(),this.style.refresh(),this.logs.refresh(),this.status.refresh(),this.instanceSection.dataset.view=this.status.view,["grid","row"].includes(this.status.view)?qe(this.viewSection):["tab"].includes(this.status.view)&&We(this.viewSection),l(this.states)?qe(this.timeline):(We(this.timeline),this.states.forEach((e=>{this.conceptModel.hasConcept(e.concept.id)?this.hasActiveConcept&&this.activeConcept===e.concept?e.element.classList.add("active"):e.element.classList.remove("active"):this.removeState(e.id)})))),this},updateActiveElement(e){return this.activeElement&&this.activeElement===e||(this.triggerEvent({name:"editor.element@active:updated"}),this.activeElement=e),this},updateActiveConcept(e){return this.hasActiveConcept&&this.activeConcept===e||(this.activeConcept=e,this.triggerEvent({name:"editor.concept@active:updated"}),this.refresh()),this},updateActiveProjection(e){if(this.activeProjection&&this.activeProjection===e)return this;let t=Ee(".active-parent",this.body);for(let e=0;e<t.length;e++)t[e].classList.remove("active-parent");this.activeProjection=e;let i=this.activeProjection.parent;for(;i;)i.getContainer().classList.add("active-parent"),i=i.parent;return this.triggerEvent({name:"editor.projection@active:updated"}),this.refresh(),this},updateActiveInstance(e){if(this.activeInstance){if(this.activeInstance===e)return this;this.activeInstance,this.activeInstance.container.classList.remove("active")}return this.activeInstance=e,this.activeInstance.container.classList.add("active"),this.triggerEvent({name:"editor.instance@active:updated"}),this.refresh(),this},getHandlers(e){return a(this.handlers.get(e),[])},triggerEvent(e,t,i=!0){const{name:s,options:n,args:r}=e,a=this.getHandlers(s),l=h(t);let o=!1;return a.forEach((e=>{let s=e.call(this,r,n);!1!==s?i&&l&&t.call(this,s):o=!0})),!o&&(!i&&l&&t.call(this),!0)},registerHandler(e,t){return this.hasHanlder(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),!0},unregisterHandler(e,t){if(!this.hasHanlder(e))return!1;let i=this.getHandlers(e);for(let e=0;e<i.length;e++)if(i[e]===t)return i.splice(e,1),!0;return!1},hasHanlder(e){return this.handlers.has(e)},bindEvents(){var e=null,t=null,i=null;const s={open:e=>{const{context:t}=e.dataset;t?this[t].open():this.open()},close:e=>{const{context:t,id:i,type:s}=e.dataset;t?this[t].close():this.close()},collapse:e=>{const{rel:t,target:i}=e.dataset;if("parent"===t){let t=je(e,(e=>e.dataset.name===i));if(O(t)){const{alias:i=""}=t.dataset;t.classList.toggle("collapsed");let s=t.classList.contains("collapsed");e.dataset.state=s?"ON":"OFF",e.title=s?`Expand ${i.toLowerCase()}`:`Collapse ${i.toLowerCase()}`}}},delete:e=>{const{target:t}=e.dataset;if("parent"===t){let t=e.parentElement;_e(t),t.remove()}},"delete:value":e=>{const{id:t}=e.dataset;this.conceptModel.removeValue(t),this.header._valueSelector.update()},"delete:resource":e=>{const{id:t}=e.dataset;this.removeResource(t)},"change-view":e=>{const{value:t}=e.dataset;this.status.changeView(t)},"add-group":e=>{this.status.addGroup()},style:e=>{this.style.toggle()},home:e=>{this.home.toggle()},logs:e=>{this.logs.toggle()},export:e=>{this.export()},"export--copy":e=>{this.export(!0)},"create-instance":e=>{const{concept:t}=e.dataset;let i=this.createConcept(t);this.createInstance(i)},"create-instance:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t),s=this.createConcept(i.name);s.initValue(i),this.createInstance(s)},"copy:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t);this.copy(i)},"load-model":e=>{let i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t="model",this.input.dispatchEvent(i)},save:e=>{this.save()},undo:e=>{this.undo()},"unload-model":e=>{this.unloadConceptModel()},"reload-model":e=>{const{schema:t,values:i}=this.conceptModel;this.loadConceptModel(t,i)},"download-model":e=>{const{schema:t,values:i}=this.conceptModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({concept:t},`${s}_model`)},"load-projection":e=>{let i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t="projection",this.input.dispatchEvent(i)},"unload-projection":e=>{this.unloadProjectionModel()},"reload-projection":e=>{const{schema:t,views:i}=this.projectionModel;this.loadProjectionModel(t,i)},"download-projection":e=>{const{schema:t,views:i}=this.projectionModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({projection:t},`${s}_projection`)}},n={[Ge.up_arrow]:"up",[Ge.right_arrow]:"right",[Ge.down_arrow]:"down",[Ge.left_arrow]:"left"};this.container.addEventListener("click",(e=>{var t=Ke(e.target);const{action:i,context:n,id:r}=t.dataset;if("instance"===n)return void this.getInstance(r).actionHandler(i);this.activeElement&&this.activeElement.clickHandler(t);const a=s[i];h(a)?(a(t),t.blur()):i&&this.triggerEvent({name:i})}),!0),this.input.addEventListener("change",(e=>{let s=this.input.files[0];this.load(s,t,i),t=null,this.input.value=""})),this.body.addEventListener("copy",(e=>{if(!Qe(e.target)){let t=this.activeConcept.copy(!1);this.copy(t,!0),e.preventDefault()}})),this.body.addEventListener("paste",(e=>{if(g(e.clipboardData))return void e.preventDefault();if(Qe(e.target))return;let t=e.clipboardData.getData("text");t=JSON.parse(t),this.paste(this.activeConcept,t),e.preventDefault()})),this.body.addEventListener("keydown",(t=>{const{target:i}=t,{nature:s}=i.dataset;var r=!1;switch(t.key){case Ge.backspace:this.activeElement&&e!==Ge.ctrl&&!0===this.activeElement.backspaceHandler(i)&&t.preventDefault();break;case Ge.ctrl:case Ge.shift:t.preventDefault(),r=!0;break;case Ge.delete:this.activeElement&&e!==Ge.ctrl&&!Qe(i)&&this.activeElement.deleteHandler(i)&&t.preventDefault();break;case Ge.spacebar:this.activeElement&&e!==Ge.ctrl&&this.activeElement.spaceHandler(i)&&t.preventDefault();break;case Ge.alt:t.preventDefault();break;case Ge.enter:this.activeElement?!0===this.activeElement.enterHandler(i)&&t.preventDefault():"concept-container"===s?this.activeInstance.projection.focus():"editable"===s?i.blur():"BUTTON"===i.tagName?(i.click(),t.preventDefault()):t.preventDefault();break;case Ge.escape:this.activeElement&&(!0===this.activeElement.escapeHandler(i)?t.preventDefault():je(i,(e=>0===e.tabIndex)).focus());break;case Ge.insert:this.activeElement&&t.preventDefault();break;case Ge.up_arrow:case Ge.right_arrow:case Ge.down_arrow:case Ge.left_arrow:if(this.activeElement&&![Ge.ctrl,Ge.shift,Ge.alt].includes(e))!0===this.activeElement.arrowHandler(n[t.key],i)&&t.preventDefault();else if("concept-container"===s&&![Ge.ctrl,Ge.shift,Ge.alt].includes(e)){let e=rt(i,n[t.key],this.instanceSection);if(!O(e))return!1;e.focus()}break;case"s":e===Ge.ctrl&&(this.activeConcept.copy(),this.header.valueCount++,this.refresh(),t.preventDefault());break;case"c":if(e===Ge.ctrl){let e=new ClipboardEvent("copy");this.body.dispatchEvent(e)}break;case"v":if(e===Ge.ctrl){let e=new ClipboardEvent("paste");this.body.dispatchEvent(e)}break;case"e":e===Ge.ctrl&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{type:"projection",close:"DELETE-PROJECTION"}),t.preventDefault());break;case"f":break;case"z":e===Ge.ctrl&&(Qe(i)||(this.undo(),t.preventDefault()))}r&&(e=t.key)}),!1),this.body.addEventListener("keyup",(t=>{var i=t.target;const{nature:s}=i.dataset;switch(t.key){case Ge.spacebar:this.activeElement&&e===Ge.ctrl&&this.activeElement._spaceHandler(i);break;case Ge.delete:this.activeElement&&e===Ge.ctrl&&this.activeElement.delete(i);break;case Ge.alt:break;case Ge.up_arrow:case Ge.down_arrow:case Ge.right_arrow:case Ge.left_arrow:if(this.activeElement&&e===Ge.ctrl)!0===this.activeElement._arrowHandler(n[t.key],i)&&t.preventDefault();else if("concept-container"===s&&e===Ge.ctrl){let s=rt(i,n[t.key],this.instanceSection);if(!O(s))return!1;this.swapInstance(i,s,!0),i.focus(),e=Ge.ctrl}}e===t.key&&(e=-1)}),!1),this.body.addEventListener("focusin",(t=>{const{target:i}=t,s=this.resolveElement(i);if(e=-1,s?(this.activeElement&&this.activeElement!==s&&(this.activeElement.focusOut(),this.activeElement=null),this.updateActiveElement(s),this.activeElement.focusIn(i)):(this.activeElement&&this.activeElement.focusOut(i),this.activeElement=null),this.activeElement){let e=this.activeElement.projection;this.updateActiveProjection(e),this.updateActiveConcept(e.concept)}else this.activeConcept=null,this.activeProjection=null;this.refresh()})),this.registerHandler("export",(()=>this.export())),this.registerHandler("value.changed",(()=>this.refresh())),this.registerHandler("value.added",(()=>this.refresh())),this.registerHandler("value.removed",(()=>this.refresh())),this.registerHandler("open-style",(()=>console.log("hello"))),this.registerHandler("load-resource",(e=>{let s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t="resource",i=e[0],this.input.dispatchEvent(s)}))}},Dn="editor";function Bn(e){const t=ht(e),i=(e=>O(e)&&E(e.dataset,"gentleman"))(t)?[t]:Ee("[data-gentleman]",t),s=[];return i.forEach((e=>{let t=a(e.dataset.gentleman,Dn);switch(t){case Dn:s.push(Fn(e));break;default:console.warn(`Gentleman does not support this environment ${t}`)}})),s}function Fn(e){let t=ht(e);return O(e)||(t=U({tabindex:-1})),t.classList.add("gentleman-editor"),t.dataset.gentleman=Dn,Object.create($n,{object:{value:"environment"},type:{value:Dn},name:{value:"gentleman editor"},container:{value:t}})}return t})()}));