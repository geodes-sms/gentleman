/*! For license information please see gentleman.core.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Gentleman=e():t.Gentleman=e()}(self,(function(){return(()=>{var t={78:(t,e,i)=>{var n,r;!function(){var s={version:"3.5.17"},a=[].slice,o=function(t){return a.call(t)},l=this.document;function h(t){return t&&(t.ownerDocument||t.document||t).documentElement}function c(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}if(l)try{o(l.documentElement.childNodes)[0].nodeType}catch(t){o=function(t){for(var e=t.length,i=new Array(e);e--;)i[e]=t[e];return i}}if(Date.now||(Date.now=function(){return+new Date}),l)try{l.createElement("DIV").style.setProperty("opacity",0,"")}catch(t){var u=this.Element.prototype,d=u.setAttribute,p=u.setAttributeNS,f=this.CSSStyleDeclaration.prototype,m=f.setProperty;u.setAttribute=function(t,e){d.call(this,t,e+"")},u.setAttributeNS=function(t,e,i){p.call(this,t,e,i+"")},f.setProperty=function(t,e,i){m.call(this,t,e+"",i)}}function g(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function v(t){return null===t?NaN:+t}function b(t){return!isNaN(t)}function y(t){return{left:function(e,i,n,r){for(arguments.length<3&&(n=0),arguments.length<4&&(r=e.length);n<r;){var s=n+r>>>1;t(e[s],i)<0?n=s+1:r=s}return n},right:function(e,i,n,r){for(arguments.length<3&&(n=0),arguments.length<4&&(r=e.length);n<r;){var s=n+r>>>1;t(e[s],i)>0?r=s:n=s+1}return n}}}s.ascending=g,s.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},s.min=function(t,e){var i,n,r=-1,s=t.length;if(1===arguments.length){for(;++r<s;)if(null!=(n=t[r])&&n>=n){i=n;break}for(;++r<s;)null!=(n=t[r])&&i>n&&(i=n)}else{for(;++r<s;)if(null!=(n=e.call(t,t[r],r))&&n>=n){i=n;break}for(;++r<s;)null!=(n=e.call(t,t[r],r))&&i>n&&(i=n)}return i},s.max=function(t,e){var i,n,r=-1,s=t.length;if(1===arguments.length){for(;++r<s;)if(null!=(n=t[r])&&n>=n){i=n;break}for(;++r<s;)null!=(n=t[r])&&n>i&&(i=n)}else{for(;++r<s;)if(null!=(n=e.call(t,t[r],r))&&n>=n){i=n;break}for(;++r<s;)null!=(n=e.call(t,t[r],r))&&n>i&&(i=n)}return i},s.extent=function(t,e){var i,n,r,s=-1,a=t.length;if(1===arguments.length){for(;++s<a;)if(null!=(n=t[s])&&n>=n){i=r=n;break}for(;++s<a;)null!=(n=t[s])&&(i>n&&(i=n),r<n&&(r=n))}else{for(;++s<a;)if(null!=(n=e.call(t,t[s],s))&&n>=n){i=r=n;break}for(;++s<a;)null!=(n=e.call(t,t[s],s))&&(i>n&&(i=n),r<n&&(r=n))}return[i,r]},s.sum=function(t,e){var i,n=0,r=t.length,s=-1;if(1===arguments.length)for(;++s<r;)b(i=+t[s])&&(n+=i);else for(;++s<r;)b(i=+e.call(t,t[s],s))&&(n+=i);return n},s.mean=function(t,e){var i,n=0,r=t.length,s=-1,a=r;if(1===arguments.length)for(;++s<r;)b(i=v(t[s]))?n+=i:--a;else for(;++s<r;)b(i=v(e.call(t,t[s],s)))?n+=i:--a;if(a)return n/a},s.quantile=function(t,e){var i=(t.length-1)*e+1,n=Math.floor(i),r=+t[n-1],s=i-n;return s?r+s*(t[n]-r):r},s.median=function(t,e){var i,n=[],r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)b(i=v(t[a]))&&n.push(i);else for(;++a<r;)b(i=v(e.call(t,t[a],a)))&&n.push(i);if(n.length)return s.quantile(n.sort(g),.5)},s.variance=function(t,e){var i,n,r=t.length,s=0,a=0,o=-1,l=0;if(1===arguments.length)for(;++o<r;)b(i=v(t[o]))&&(a+=(n=i-s)*(i-(s+=n/++l)));else for(;++o<r;)b(i=v(e.call(t,t[o],o)))&&(a+=(n=i-s)*(i-(s+=n/++l)));if(l>1)return a/(l-1)},s.deviation=function(){var t=s.variance.apply(this,arguments);return t?Math.sqrt(t):t};var w=y(g);function x(t){return t.length}s.bisectLeft=w.left,s.bisect=s.bisectRight=w.right,s.bisector=function(t){return y(1===t.length?function(e,i){return g(t(e),i)}:t)},s.shuffle=function(t,e,i){(s=arguments.length)<3&&(i=t.length,s<2&&(e=0));for(var n,r,s=i-e;s;)r=Math.random()*s--|0,n=t[s+e],t[s+e]=t[r+e],t[r+e]=n;return t},s.permute=function(t,e){for(var i=e.length,n=new Array(i);i--;)n[i]=t[e[i]];return n},s.pairs=function(t){for(var e=0,i=t.length-1,n=t[0],r=new Array(i<0?0:i);e<i;)r[e]=[n,n=t[++e]];return r},s.transpose=function(t){if(!(r=t.length))return[];for(var e=-1,i=s.min(t,x),n=new Array(i);++e<i;)for(var r,a=-1,o=n[e]=new Array(r);++a<r;)o[a]=t[a][e];return n},s.zip=function(){return s.transpose(arguments)},s.keys=function(t){var e=[];for(var i in t)e.push(i);return e},s.values=function(t){var e=[];for(var i in t)e.push(t[i]);return e},s.entries=function(t){var e=[];for(var i in t)e.push({key:i,value:t[i]});return e},s.merge=function(t){for(var e,i,n,r=t.length,s=-1,a=0;++s<r;)a+=t[s].length;for(i=new Array(a);--r>=0;)for(e=(n=t[r]).length;--e>=0;)i[--a]=n[e];return i};var E=Math.abs;function A(t){for(var e=1;t*e%1;)e*=10;return e}function N(t,e){for(var i in e)Object.defineProperty(t.prototype,i,{value:e[i],enumerable:!1})}function O(){this._=Object.create(null)}function M(t){return"__proto__"==(t+="")||"\0"===t[0]?"\0"+t:t}function j(t){return"\0"===(t+="")[0]?t.slice(1):t}function C(t){return M(t)in this._}function L(t){return(t=M(t))in this._&&delete this._[t]}function S(){var t=[];for(var e in this._)t.push(j(e));return t}function k(){var t=0;for(var e in this._)++t;return t}function T(){for(var t in this._)return!1;return!0}function U(){this._=Object.create(null)}function I(t){return t}function _(t,e,i){return function(){var n=i.apply(e,arguments);return n===e?t:n}}function H(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var i=0,n=D.length;i<n;++i){var r=D[i]+e;if(r in t)return r}}s.range=function(t,e,i){if(arguments.length<3&&(i=1,arguments.length<2&&(e=t,t=0)),(e-t)/i==1/0)throw new Error("infinite range");var n,r=[],s=A(E(i)),a=-1;if(t*=s,e*=s,(i*=s)<0)for(;(n=t+i*++a)>e;)r.push(n/s);else for(;(n=t+i*++a)<e;)r.push(n/s);return r},s.map=function(t,e){var i=new O;if(t instanceof O)t.forEach((function(t,e){i.set(t,e)}));else if(Array.isArray(t)){var n,r=-1,s=t.length;if(1===arguments.length)for(;++r<s;)i.set(r,t[r]);else for(;++r<s;)i.set(e.call(t,n=t[r],r),n)}else for(var a in t)i.set(a,t[a]);return i},N(O,{has:C,get:function(t){return this._[M(t)]},set:function(t,e){return this._[M(t)]=e},remove:L,keys:S,values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:j(e),value:this._[e]});return t},size:k,empty:T,forEach:function(t){for(var e in this._)t.call(this,j(e),this._[e])}}),s.nest=function(){var t,e,i={},n=[],r=[];function a(r,s,o){if(o>=n.length)return e?e.call(i,s):t?s.sort(t):s;for(var l,h,c,u,d=-1,p=s.length,f=n[o++],m=new O;++d<p;)(u=m.get(l=f(h=s[d])))?u.push(h):m.set(l,[h]);return r?(h=r(),c=function(t,e){h.set(t,a(r,e,o))}):(h={},c=function(t,e){h[t]=a(r,e,o)}),m.forEach(c),h}function o(t,e){if(e>=n.length)return t;var i=[],s=r[e++];return t.forEach((function(t,n){i.push({key:t,values:o(n,e)})})),s?i.sort((function(t,e){return s(t.key,e.key)})):i}return i.map=function(t,e){return a(e,t,0)},i.entries=function(t){return o(a(s.map,t,0),0)},i.key=function(t){return n.push(t),i},i.sortKeys=function(t){return r[n.length-1]=t,i},i.sortValues=function(e){return t=e,i},i.rollup=function(t){return e=t,i},i},s.set=function(t){var e=new U;if(t)for(var i=0,n=t.length;i<n;++i)e.add(t[i]);return e},N(U,{has:C,add:function(t){return this._[M(t+="")]=!0,t},remove:L,values:S,size:k,empty:T,forEach:function(t){for(var e in this._)t.call(this,j(e))}}),s.behavior={},s.rebind=function(t,e){for(var i,n=1,r=arguments.length;++n<r;)t[i=arguments[n]]=_(t,e,e[i]);return t};var D=["webkit","ms","moz","Moz","o","O"];function P(){}function V(){}function B(t){var e=[],i=new O;function n(){for(var i,n=e,r=-1,s=n.length;++r<s;)(i=n[r].on)&&i.apply(this,arguments);return t}return n.on=function(n,r){var s,a=i.get(n);return arguments.length<2?a&&a.on:(a&&(a.on=null,e=e.slice(0,s=e.indexOf(a)).concat(e.slice(s+1)),i.remove(n)),r&&e.push(i.set(n,{on:r})),t)},n}function R(){s.event.preventDefault()}function z(){for(var t,e=s.event;t=e.sourceEvent;)e=t;return e}function $(t){for(var e=new V,i=0,n=arguments.length;++i<n;)e[arguments[i]]=B(e);return e.of=function(i,n){return function(r){try{var a=r.sourceEvent=s.event;r.target=t,s.event=r,e[r.type].apply(i,n)}finally{s.event=a}}},e}s.dispatch=function(){for(var t=new V,e=-1,i=arguments.length;++e<i;)t[arguments[e]]=B(t);return t},V.prototype.on=function(t,e){var i=t.indexOf("."),n="";if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t)return arguments.length<2?this[t].on(n):this[t].on(n,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(n,null);return this}},s.event=null,s.requote=function(t){return t.replace(F,"\\$&")};var F=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,q={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)t[i]=e[i]};function W(t){return q(t,G),t}var X=function(t,e){return e.querySelector(t)},Y=function(t,e){return e.querySelectorAll(t)},Z=function(t,e){var i=t.matches||t[H(t,"matchesSelector")];return(Z=function(t,e){return i.call(t,e)})(t,e)};"function"==typeof Sizzle&&(X=function(t,e){return Sizzle(t,e)[0]||null},Y=Sizzle,Z=Sizzle.matchesSelector),s.selection=function(){return s.select(l.documentElement)};var G=s.selection.prototype=[];function J(t){return"function"==typeof t?t:function(){return X(t,this)}}function K(t){return"function"==typeof t?t:function(){return Y(t,this)}}G.select=function(t){var e,i,n,r,s=[];t=J(t);for(var a=-1,o=this.length;++a<o;){s.push(e=[]),e.parentNode=(n=this[a]).parentNode;for(var l=-1,h=n.length;++l<h;)(r=n[l])?(e.push(i=t.call(r,r.__data__,l,a)),i&&"__data__"in r&&(i.__data__=r.__data__)):e.push(null)}return W(s)},G.selectAll=function(t){var e,i,n=[];t=K(t);for(var r=-1,s=this.length;++r<s;)for(var a=this[r],l=-1,h=a.length;++l<h;)(i=a[l])&&(n.push(e=o(t.call(i,i.__data__,l,r))),e.parentNode=i);return W(n)};var Q="http://www.w3.org/1999/xhtml",tt={svg:"http://www.w3.org/2000/svg",xhtml:Q,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function et(t,e){return t=s.ns.qualify(t),null==e?t.local?function(){this.removeAttributeNS(t.space,t.local)}:function(){this.removeAttribute(t)}:"function"==typeof e?t.local?function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}:function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}:t.local?function(){this.setAttributeNS(t.space,t.local,e)}:function(){this.setAttribute(t,e)}}function it(t){return t.trim().replace(/\s+/g," ")}function nt(t){return new RegExp("(?:^|\\s+)"+s.requote(t)+"(?:\\s+|$)","g")}function rt(t){return(t+"").trim().split(/^|\s+/)}function st(t,e){var i=(t=rt(t).map(at)).length;return"function"==typeof e?function(){for(var n=-1,r=e.apply(this,arguments);++n<i;)t[n](this,r)}:function(){for(var n=-1;++n<i;)t[n](this,e)}}function at(t){var e=nt(t);return function(i,n){if(r=i.classList)return n?r.add(t):r.remove(t);var r=i.getAttribute("class")||"";n?(e.lastIndex=0,e.test(r)||i.setAttribute("class",it(r+" "+t))):i.setAttribute("class",it(r.replace(e," ")))}}function ot(t,e,i){return null==e?function(){this.style.removeProperty(t)}:"function"==typeof e?function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,i)}:function(){this.style.setProperty(t,e,i)}}function lt(t,e){return null==e?function(){delete this[t]}:"function"==typeof e?function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}:function(){this[t]=e}}function ht(t){return"function"==typeof t?t:(t=s.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){var e=this.ownerDocument,i=this.namespaceURI;return i===Q&&e.documentElement.namespaceURI===Q?e.createElement(t):e.createElementNS(i,t)}}function ct(){var t=this.parentNode;t&&t.removeChild(this)}function ut(t){return{__data__:t}}function dt(t){return function(){return Z(this,t)}}function pt(t){return arguments.length||(t=g),function(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}}function ft(t,e){for(var i=0,n=t.length;i<n;i++)for(var r,s=t[i],a=0,o=s.length;a<o;a++)(r=s[a])&&e(r,a,i);return t}function mt(t){return q(t,gt),t}s.ns={prefix:tt,qualify:function(t){var e=t.indexOf(":"),i=t;return e>=0&&"xmlns"!==(i=t.slice(0,e))&&(t=t.slice(e+1)),tt.hasOwnProperty(i)?{space:tt[i],local:t}:t}},G.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var i=this.node();return(t=s.ns.qualify(t)).local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}for(e in t)this.each(et(e,t[e]));return this}return this.each(et(t,e))},G.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var i=this.node(),n=(t=rt(t)).length,r=-1;if(e=i.classList){for(;++r<n;)if(!e.contains(t[r]))return!1}else for(e=i.getAttribute("class");++r<n;)if(!nt(t[r]).test(e))return!1;return!0}for(e in t)this.each(st(e,t[e]));return this}return this.each(st(t,e))},G.style=function(t,e,i){var n=arguments.length;if(n<3){if("string"!=typeof t){for(i in n<2&&(e=""),t)this.each(ot(i,t[i],e));return this}if(n<2){var r=this.node();return c(r).getComputedStyle(r,null).getPropertyValue(t)}i=""}return this.each(ot(t,e,i))},G.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(lt(e,t[e]));return this}return this.each(lt(t,e))},G.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},G.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},G.append=function(t){return t=ht(t),this.select((function(){return this.appendChild(t.apply(this,arguments))}))},G.insert=function(t,e){return t=ht(t),e=J(e),this.select((function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)}))},G.remove=function(){return this.each(ct)},G.data=function(t,e){var i,n,r=-1,s=this.length;if(!arguments.length){for(t=new Array(s=(i=this[0]).length);++r<s;)(n=i[r])&&(t[r]=n.__data__);return t}function a(t,i){var n,r,s,a=t.length,c=i.length,u=Math.min(a,c),d=new Array(c),p=new Array(c),f=new Array(a);if(e){var m,g=new O,v=new Array(a);for(n=-1;++n<a;)(r=t[n])&&(g.has(m=e.call(r,r.__data__,n))?f[n]=r:g.set(m,r),v[n]=m);for(n=-1;++n<c;)(r=g.get(m=e.call(i,s=i[n],n)))?!0!==r&&(d[n]=r,r.__data__=s):p[n]=ut(s),g.set(m,!0);for(n=-1;++n<a;)n in v&&!0!==g.get(v[n])&&(f[n]=t[n])}else{for(n=-1;++n<u;)r=t[n],s=i[n],r?(r.__data__=s,d[n]=r):p[n]=ut(s);for(;n<c;++n)p[n]=ut(i[n]);for(;n<a;++n)f[n]=t[n]}p.update=d,p.parentNode=d.parentNode=f.parentNode=t.parentNode,o.push(p),l.push(d),h.push(f)}var o=mt([]),l=W([]),h=W([]);if("function"==typeof t)for(;++r<s;)a(i=this[r],t.call(i,i.parentNode.__data__,r));else for(;++r<s;)a(i=this[r],t);return l.enter=function(){return o},l.exit=function(){return h},l},G.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},G.filter=function(t){var e,i,n,r=[];"function"!=typeof t&&(t=dt(t));for(var s=0,a=this.length;s<a;s++){r.push(e=[]),e.parentNode=(i=this[s]).parentNode;for(var o=0,l=i.length;o<l;o++)(n=i[o])&&t.call(n,n.__data__,o,s)&&e.push(n)}return W(r)},G.order=function(){for(var t=-1,e=this.length;++t<e;)for(var i,n=this[t],r=n.length-1,s=n[r];--r>=0;)(i=n[r])&&(s&&s!==i.nextSibling&&s.parentNode.insertBefore(i,s),s=i);return this},G.sort=function(t){t=pt.apply(this,arguments);for(var e=-1,i=this.length;++e<i;)this[e].sort(t);return this.order()},G.each=function(t){return ft(this,(function(e,i,n){t.call(e,e.__data__,i,n)}))},G.call=function(t){var e=o(arguments);return t.apply(e[0]=this,e),this},G.empty=function(){return!this.node()},G.node=function(){for(var t=0,e=this.length;t<e;t++)for(var i=this[t],n=0,r=i.length;n<r;n++){var s=i[n];if(s)return s}return null},G.size=function(){var t=0;return ft(this,(function(){++t})),t};var gt=[];function vt(t){var e,i;return function(n,r,s){var a,o=t[s].update,l=o.length;for(s!=i&&(i=s,e=0),r>=e&&(e=r+1);!(a=o[e])&&++e<l;);return a}}function bt(t,e,i){var n="__on"+t,r=t.indexOf("."),a=wt;r>0&&(t=t.slice(0,r));var l=yt.get(t);function h(){var e=this[n];e&&(this.removeEventListener(t,e,e.$),delete this[n])}return l&&(t=l,a=xt),r?e?function(){var r=a(e,o(arguments));h.call(this),this.addEventListener(t,this[n]=r,r.$=i),r._=e}:h:e?P:function(){var e,i=new RegExp("^__on([^.]+)"+s.requote(t)+"$");for(var n in this)if(e=n.match(i)){var r=this[n];this.removeEventListener(e[1],r,r.$),delete this[n]}}}s.selection.enter=mt,s.selection.enter.prototype=gt,gt.append=G.append,gt.empty=G.empty,gt.node=G.node,gt.call=G.call,gt.size=G.size,gt.select=function(t){for(var e,i,n,r,s,a=[],o=-1,l=this.length;++o<l;){n=(r=this[o]).update,a.push(e=[]),e.parentNode=r.parentNode;for(var h=-1,c=r.length;++h<c;)(s=r[h])?(e.push(n[h]=i=t.call(r.parentNode,s.__data__,h,o)),i.__data__=s.__data__):e.push(null)}return W(a)},gt.insert=function(t,e){return arguments.length<2&&(e=vt(this)),G.insert.call(this,t,e)},s.select=function(t){var e;return"string"==typeof t?(e=[X(t,l)]).parentNode=l.documentElement:(e=[t]).parentNode=h(t),W([e])},s.selectAll=function(t){var e;return"string"==typeof t?(e=o(Y(t,l))).parentNode=l.documentElement:(e=o(t)).parentNode=null,W([e])},G.on=function(t,e,i){var n=arguments.length;if(n<3){if("string"!=typeof t){for(i in n<2&&(e=!1),t)this.each(bt(i,t[i],e));return this}if(n<2)return(n=this.node()["__on"+t])&&n._;i=!1}return this.each(bt(t,e,i))};var yt=s.map({mouseenter:"mouseover",mouseleave:"mouseout"});function wt(t,e){return function(i){var n=s.event;s.event=i,e[0]=this.__data__;try{t.apply(this,e)}finally{s.event=n}}}function xt(t,e){var i=wt(t,e);return function(t){var e=this,n=t.relatedTarget;n&&(n===e||8&n.compareDocumentPosition(e))||i.call(e,t)}}l&&yt.forEach((function(t){"on"+t in l&&yt.remove(t)}));var Et,At=0;function Nt(t){var e=".dragsuppress-"+ ++At,i="click"+e,n=s.select(c(t)).on("touchmove"+e,R).on("dragstart"+e,R).on("selectstart"+e,R);if(null==Et&&(Et=!("onselectstart"in t)&&H(t.style,"userSelect")),Et){var r=h(t).style,a=r[Et];r[Et]="none"}return function(t){if(n.on(e,null),Et&&(r[Et]=a),t){var s=function(){n.on(i,null)};n.on(i,(function(){R(),s()}),!0),setTimeout(s,0)}}}s.mouse=function(t){return Mt(t,z())};var Ot=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function Mt(t,e){e.changedTouches&&(e=e.changedTouches[0]);var i=t.ownerSVGElement||t;if(i.createSVGPoint){var n=i.createSVGPoint();if(Ot<0){var r=c(t);if(r.scrollX||r.scrollY){var a=(i=s.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM();Ot=!(a.f||a.e),i.remove()}}return Ot?(n.x=e.pageX,n.y=e.pageY):(n.x=e.clientX,n.y=e.clientY),[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}function jt(){return s.event.changedTouches[0].identifier}s.touch=function(t,e,i){if(arguments.length<3&&(i=e,e=z().changedTouches),e)for(var n,r=0,s=e.length;r<s;++r)if((n=e[r]).identifier===i)return Mt(t,n)},s.behavior.drag=function(){var t=$(r,"drag","dragstart","dragend"),e=null,i=a(P,s.mouse,c,"mousemove","mouseup"),n=a(jt,s.touch,I,"touchmove","touchend");function r(){this.on("mousedown.drag",i).on("touchstart.drag",n)}function a(i,n,r,a,o){return function(){var l,h=this,c=s.event.target.correspondingElement||s.event.target,u=h.parentNode,d=t.of(h,arguments),p=0,f=i(),m=".drag"+(null==f?"":"-"+f),g=s.select(r(c)).on(a+m,y).on(o+m,w),v=Nt(c),b=n(u,f);function y(){var t,e,i=n(u,f);i&&(t=i[0]-b[0],e=i[1]-b[1],p|=t|e,b=i,d({type:"drag",x:i[0]+l[0],y:i[1]+l[1],dx:t,dy:e}))}function w(){n(u,f)&&(g.on(a+m,null).on(o+m,null),v(p),d({type:"dragend"}))}l=e?[(l=e.apply(h,arguments)).x-b[0],l.y-b[1]]:[0,0],d({type:"dragstart"})}}return r.origin=function(t){return arguments.length?(e=t,r):e},s.rebind(r,t,"on")},s.touches=function(t,e){return arguments.length<2&&(e=z().touches),e?o(e).map((function(e){var i=Mt(t,e);return i.identifier=e.identifier,i})):[]};var Ct=1e-6,Lt=Ct*Ct,St=Math.PI,kt=2*St,Tt=kt-Ct,Ut=St/2,It=St/180,_t=180/St;function Ht(t){return t>0?1:t<0?-1:0}function Dt(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(e[1]-t[1])*(i[0]-t[0])}function Pt(t){return t>1?0:t<-1?St:Math.acos(t)}function Vt(t){return t>1?Ut:t<-1?-Ut:Math.asin(t)}function Bt(t){return((t=Math.exp(t))+1/t)/2}function Rt(t){return(t=Math.sin(t/2))*t}var zt=Math.SQRT2;s.interpolateZoom=function(t,e){var i,n,r=t[0],s=t[1],a=t[2],o=e[0],l=e[1],h=e[2],c=o-r,u=l-s,d=c*c+u*u;if(d<Lt)n=Math.log(h/a)/zt,i=function(t){return[r+t*c,s+t*u,a*Math.exp(zt*t*n)]};else{var p=Math.sqrt(d),f=(h*h-a*a+4*d)/(2*a*2*p),m=(h*h-a*a-4*d)/(2*h*2*p),g=Math.log(Math.sqrt(f*f+1)-f),v=Math.log(Math.sqrt(m*m+1)-m);n=(v-g)/zt,i=function(t){var e,i=t*n,o=Bt(g),l=a/(2*p)*(o*(e=zt*i+g,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(g));return[r+l*c,s+l*u,a*o/Bt(zt*i+g)]}}return i.duration=1e3*n,i},s.behavior.zoom=function(){var t,e,i,n,r,a,o,h,u,d={x:0,y:0,k:1},p=[960,500],f=qt,m=250,g=0,v="mousedown.zoom",b="mousemove.zoom",y="mouseup.zoom",w="touchstart.zoom",x=$(E,"zoomstart","zoom","zoomend");function E(t){t.on(v,k).on(Ft+".zoom",U).on("dblclick.zoom",I).on(w,T)}function A(t){return[(t[0]-d.x)/d.k,(t[1]-d.y)/d.k]}function N(t){d.k=Math.max(f[0],Math.min(f[1],t))}function O(t,e){e=function(t){return[t[0]*d.k+d.x,t[1]*d.k+d.y]}(e),d.x+=t[0]-e[0],d.y+=t[1]-e[1]}function M(t,i,n,r){t.__chart__={x:d.x,y:d.y,k:d.k},N(Math.pow(2,r)),O(e=i,n),t=s.select(t),m>0&&(t=t.transition().duration(m)),t.call(E.event)}function j(){o&&o.domain(a.range().map((function(t){return(t-d.x)/d.k})).map(a.invert)),u&&u.domain(h.range().map((function(t){return(t-d.y)/d.k})).map(h.invert))}function C(t){g++||t({type:"zoomstart"})}function L(t){j(),t({type:"zoom",scale:d.k,translate:[d.x,d.y]})}function S(t){--g||(t({type:"zoomend"}),e=null)}function k(){var t=this,e=x.of(t,arguments),i=0,n=s.select(c(t)).on(b,o).on(y,l),r=A(s.mouse(t)),a=Nt(t);function o(){i=1,O(s.mouse(t),r),L(e)}function l(){n.on(b,null).on(y,null),a(i),S(e)}_o.call(t),C(e)}function T(){var t,e=this,i=x.of(e,arguments),n={},a=0,o=".zoom-"+s.event.changedTouches[0].identifier,l="touchmove"+o,h="touchend"+o,c=[],u=s.select(e),p=Nt(e);function f(){var i=s.touches(e);return t=d.k,i.forEach((function(t){t.identifier in n&&(n[t.identifier]=A(t))})),i}function m(){var t=s.event.target;s.select(t).on(l,g).on(h,b),c.push(t);for(var i=s.event.changedTouches,o=0,u=i.length;o<u;++o)n[i[o].identifier]=null;var p=f(),m=Date.now();if(1===p.length){if(m-r<500){var v=p[0];M(e,v,n[v.identifier],Math.floor(Math.log(d.k)/Math.LN2)+1),R()}r=m}else if(p.length>1){v=p[0];var y=p[1],w=v[0]-y[0],x=v[1]-y[1];a=w*w+x*x}}function g(){var o,l,h,c,u=s.touches(e);_o.call(e);for(var d=0,p=u.length;d<p;++d,c=null)if(h=u[d],c=n[h.identifier]){if(l)break;o=h,l=c}if(c){var f=(f=h[0]-o[0])*f+(f=h[1]-o[1])*f,m=a&&Math.sqrt(f/a);o=[(o[0]+h[0])/2,(o[1]+h[1])/2],l=[(l[0]+c[0])/2,(l[1]+c[1])/2],N(m*t)}r=null,O(o,l),L(i)}function b(){if(s.event.touches.length){for(var t=s.event.changedTouches,e=0,r=t.length;e<r;++e)delete n[t[e].identifier];for(var a in n)return void f()}s.selectAll(c).on(o,null),u.on(v,k).on(w,T),p(),S(i)}m(),C(i),u.on(v,null).on(w,m)}function U(){var r=x.of(this,arguments);n?clearTimeout(n):(_o.call(this),t=A(e=i||s.mouse(this)),C(r)),n=setTimeout((function(){n=null,S(r)}),50),R(),N(Math.pow(2,.002*$t())*d.k),O(e,t),L(r)}function I(){var t=s.mouse(this),e=Math.log(d.k)/Math.LN2;M(this,t,A(t),s.event.shiftKey?Math.ceil(e)-1:Math.floor(e)+1)}return Ft||(Ft="onwheel"in l?($t=function(){return-s.event.deltaY*(s.event.deltaMode?120:1)},"wheel"):"onmousewheel"in l?($t=function(){return s.event.wheelDelta},"mousewheel"):($t=function(){return-s.event.detail},"MozMousePixelScroll")),E.event=function(t){t.each((function(){var t=x.of(this,arguments),i=d;Po?s.select(this).transition().each("start.zoom",(function(){d=this.__chart__||{x:0,y:0,k:1},C(t)})).tween("zoom:zoom",(function(){var n=p[0],r=p[1],a=e?e[0]:n/2,o=e?e[1]:r/2,l=s.interpolateZoom([(a-d.x)/d.k,(o-d.y)/d.k,n/d.k],[(a-i.x)/i.k,(o-i.y)/i.k,n/i.k]);return function(e){var i=l(e),r=n/i[2];this.__chart__=d={x:a-i[0]*r,y:o-i[1]*r,k:r},L(t)}})).each("interrupt.zoom",(function(){S(t)})).each("end.zoom",(function(){S(t)})):(this.__chart__=d,C(t),L(t),S(t))}))},E.translate=function(t){return arguments.length?(d={x:+t[0],y:+t[1],k:d.k},j(),E):[d.x,d.y]},E.scale=function(t){return arguments.length?(d={x:d.x,y:d.y,k:null},N(+t),j(),E):d.k},E.scaleExtent=function(t){return arguments.length?(f=null==t?qt:[+t[0],+t[1]],E):f},E.center=function(t){return arguments.length?(i=t&&[+t[0],+t[1]],E):i},E.size=function(t){return arguments.length?(p=t&&[+t[0],+t[1]],E):p},E.duration=function(t){return arguments.length?(m=+t,E):m},E.x=function(t){return arguments.length?(o=t,a=t.copy(),d={x:0,y:0,k:1},E):o},E.y=function(t){return arguments.length?(u=t,h=t.copy(),d={x:0,y:0,k:1},E):u},s.rebind(E,x,"on")};var $t,Ft,qt=[0,1/0];function Wt(){}function Xt(t,e,i){return this instanceof Xt?(this.h=+t,this.s=+e,void(this.l=+i)):arguments.length<2?t instanceof Xt?new Xt(t.h,t.s,t.l):fe(""+t,me,Xt):new Xt(t,e,i)}s.color=Wt,Wt.prototype.toString=function(){return this.rgb()+""},s.hsl=Xt;var Yt=Xt.prototype=new Wt;function Zt(t,e,i){var n,r;function s(t){return Math.round(255*function(t){return t>360?t-=360:t<0&&(t+=360),t<60?n+(r-n)*t/60:t<180?r:t<240?n+(r-n)*(240-t)/60:n}(t))}return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)||e<0?0:e>1?1:e,n=2*(i=i<0?0:i>1?1:i)-(r=i<=.5?i*(1+e):i+e-i*e),new he(s(t+120),s(t),s(t-120))}function Gt(t,e,i){return this instanceof Gt?(this.h=+t,this.c=+e,void(this.l=+i)):arguments.length<2?t instanceof Gt?new Gt(t.h,t.c,t.l):se(t instanceof Qt?t.l:(t=ge((t=s.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new Gt(t,e,i)}Yt.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new Xt(this.h,this.s,this.l/t)},Yt.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new Xt(this.h,this.s,t*this.l)},Yt.rgb=function(){return Zt(this.h,this.s,this.l)},s.hcl=Gt;var Jt=Gt.prototype=new Wt;function Kt(t,e,i){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new Qt(i,Math.cos(t*=It)*e,Math.sin(t)*e)}function Qt(t,e,i){return this instanceof Qt?(this.l=+t,this.a=+e,void(this.b=+i)):arguments.length<2?t instanceof Qt?new Qt(t.l,t.a,t.b):t instanceof Gt?Kt(t.h,t.c,t.l):ge((t=he(t)).r,t.g,t.b):new Qt(t,e,i)}Jt.brighter=function(t){return new Gt(this.h,this.c,Math.min(100,this.l+te*(arguments.length?t:1)))},Jt.darker=function(t){return new Gt(this.h,this.c,Math.max(0,this.l-te*(arguments.length?t:1)))},Jt.rgb=function(){return Kt(this.h,this.c,this.l).rgb()},s.lab=Qt;var te=18,ee=.95047,ie=1.08883,ne=Qt.prototype=new Wt;function re(t,e,i){var n=(t+16)/116,r=n+e/500,s=n-i/200;return new he(le(3.2404542*(r=ae(r)*ee)-1.5371385*(n=1*ae(n))-.4985314*(s=ae(s)*ie)),le(-.969266*r+1.8760108*n+.041556*s),le(.0556434*r-.2040259*n+1.0572252*s))}function se(t,e,i){return t>0?new Gt(Math.atan2(i,e)*_t,Math.sqrt(e*e+i*i),t):new Gt(NaN,NaN,t)}function ae(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function oe(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function le(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function he(t,e,i){return this instanceof he?(this.r=~~t,this.g=~~e,void(this.b=~~i)):arguments.length<2?t instanceof he?new he(t.r,t.g,t.b):fe(""+t,he,Zt):new he(t,e,i)}function ce(t){return new he(t>>16,t>>8&255,255&t)}function ue(t){return ce(t)+""}ne.brighter=function(t){return new Qt(Math.min(100,this.l+te*(arguments.length?t:1)),this.a,this.b)},ne.darker=function(t){return new Qt(Math.max(0,this.l-te*(arguments.length?t:1)),this.a,this.b)},ne.rgb=function(){return re(this.l,this.a,this.b)},s.rgb=he;var de=he.prototype=new Wt;function pe(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function fe(t,e,i){var n,r,s,a=0,o=0,l=0;if(n=/([a-z]+)\((.*)\)/.exec(t=t.toLowerCase()))switch(r=n[2].split(","),n[1]){case"hsl":return i(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return e(be(r[0]),be(r[1]),be(r[2]))}return(s=ye.get(t))?e(s.r,s.g,s.b):(null==t||"#"!==t.charAt(0)||isNaN(s=parseInt(t.slice(1),16))||(4===t.length?(a=(3840&s)>>4,a|=a>>4,o=240&s,o|=o>>4,l=15&s,l|=l<<4):7===t.length&&(a=(16711680&s)>>16,o=(65280&s)>>8,l=255&s)),e(a,o,l))}function me(t,e,i){var n,r,s=Math.min(t/=255,e/=255,i/=255),a=Math.max(t,e,i),o=a-s,l=(a+s)/2;return o?(r=l<.5?o/(a+s):o/(2-a-s),n=t==a?(e-i)/o+(e<i?6:0):e==a?(i-t)/o+2:(t-e)/o+4,n*=60):(n=NaN,r=l>0&&l<1?0:n),new Xt(n,r,l)}function ge(t,e,i){var n=oe((.4124564*(t=ve(t))+.3575761*(e=ve(e))+.1804375*(i=ve(i)))/ee),r=oe((.2126729*t+.7151522*e+.072175*i)/1);return Qt(116*r-16,500*(n-r),200*(r-oe((.0193339*t+.119192*e+.9503041*i)/ie)))}function ve(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function be(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}de.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,i=this.g,n=this.b,r=30;return e||i||n?(e&&e<r&&(e=r),i&&i<r&&(i=r),n&&n<r&&(n=r),new he(Math.min(255,e/t),Math.min(255,i/t),Math.min(255,n/t))):new he(r,r,r)},de.darker=function(t){return new he((t=Math.pow(.7,arguments.length?t:1))*this.r,t*this.g,t*this.b)},de.hsl=function(){return me(this.r,this.g,this.b)},de.toString=function(){return"#"+pe(this.r)+pe(this.g)+pe(this.b)};var ye=s.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function we(t){return"function"==typeof t?t:function(){return t}}function xe(t){return function(e,i,n){return 2===arguments.length&&"function"==typeof i&&(n=i,i=null),Ee(e,i,t,n)}}function Ee(t,e,i,n){var r={},a=s.dispatch("beforesend","progress","load","error"),l={},h=new XMLHttpRequest,c=null;function u(){var t,e=h.status;if(!e&&function(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}(h)||e>=200&&e<300||304===e){try{t=i.call(r,h)}catch(t){return void a.error.call(r,t)}a.load.call(r,t)}else a.error.call(r,h)}return this.XDomainRequest&&!("withCredentials"in h)&&/^(http(s)?:)?\/\//.test(t)&&(h=new XDomainRequest),"onload"in h?h.onload=h.onerror=u:h.onreadystatechange=function(){h.readyState>3&&u()},h.onprogress=function(t){var e=s.event;s.event=t;try{a.progress.call(r,h)}finally{s.event=e}},r.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?l[t]:(null==e?delete l[t]:l[t]=e+"",r)},r.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",r):e},r.responseType=function(t){return arguments.length?(c=t,r):c},r.response=function(t){return i=t,r},["get","post"].forEach((function(t){r[t]=function(){return r.send.apply(r,[t].concat(o(arguments)))}})),r.send=function(i,n,s){if(2===arguments.length&&"function"==typeof n&&(s=n,n=null),h.open(i,t,!0),null==e||"accept"in l||(l.accept=e+",*/*"),h.setRequestHeader)for(var o in l)h.setRequestHeader(o,l[o]);return null!=e&&h.overrideMimeType&&h.overrideMimeType(e),null!=c&&(h.responseType=c),null!=s&&r.on("error",s).on("load",(function(t){s(null,t)})),a.beforesend.call(r,h),h.send(null==n?null:n),r},r.abort=function(){return h.abort(),r},s.rebind(r,a,"on"),null==n?r:r.get(function(t){return 1===t.length?function(e,i){t(null==e?i:null)}:t}(n))}ye.forEach((function(t,e){ye.set(t,ce(e))})),s.functor=we,s.xhr=xe(I),s.dsv=function(t,e){var i=new RegExp('["'+t+"\n]"),n=t.charCodeAt(0);function r(t,i,n){arguments.length<3&&(n=i,i=null);var r=Ee(t,e,null==i?s:a(i),n);return r.row=function(t){return arguments.length?r.response(null==(i=t)?s:a(t)):i},r}function s(t){return r.parse(t.responseText)}function a(t){return function(e){return r.parse(e.responseText,t)}}function o(e){return e.map(l).join(t)}function l(t){return i.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}return r.parse=function(t,e){var i;return r.parseRows(t,(function(t,n){if(i)return i(t,n-1);var r=new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+"]"})).join(",")+"}");i=e?function(t,i){return e(r(t),i)}:r}))},r.parseRows=function(t,e){var i,r,s={},a={},o=[],l=t.length,h=0,c=0;function u(){if(h>=l)return a;if(r)return r=!1,s;var e=h;if(34===t.charCodeAt(e)){for(var i=e;i++<l;)if(34===t.charCodeAt(i)){if(34!==t.charCodeAt(i+1))break;++i}return h=i+2,13===(o=t.charCodeAt(i+1))?(r=!0,10===t.charCodeAt(i+2)&&++h):10===o&&(r=!0),t.slice(e+1,i).replace(/""/g,'"')}for(;h<l;){var o,c=1;if(10===(o=t.charCodeAt(h++)))r=!0;else if(13===o)r=!0,10===t.charCodeAt(h)&&(++h,++c);else if(o!==n)continue;return t.slice(e,h-c)}return t.slice(e)}for(;(i=u())!==a;){for(var d=[];i!==s&&i!==a;)d.push(i),i=u();e&&null==(d=e(d,c++))||o.push(d)}return o},r.format=function(e){if(Array.isArray(e[0]))return r.formatRows(e);var i=new U,n=[];return e.forEach((function(t){for(var e in t)i.has(e)||n.push(i.add(e))})),[n.map(l).join(t)].concat(e.map((function(e){return n.map((function(t){return l(e[t])})).join(t)}))).join("\n")},r.formatRows=function(t){return t.map(o).join("\n")},r},s.csv=s.dsv(",","text/csv"),s.tsv=s.dsv("\t","text/tab-separated-values");var Ae,Ne,Oe,Me,je=this[H(this,"requestAnimationFrame")]||function(t){setTimeout(t,17)};function Ce(t,e,i){var n=arguments.length;n<2&&(e=0),n<3&&(i=Date.now());var r=i+e,s={c:t,t:r,n:null};return Ne?Ne.n=s:Ae=s,Ne=s,Oe||(Me=clearTimeout(Me),Oe=1,je(Le)),s}function Le(){var t=Se(),e=ke()-t;e>24?(isFinite(e)&&(clearTimeout(Me),Me=setTimeout(Le,e)),Oe=0):(Oe=1,je(Le))}function Se(){for(var t=Date.now(),e=Ae;e;)t>=e.t&&e.c(t-e.t)&&(e.c=null),e=e.n;return t}function ke(){for(var t,e=Ae,i=1/0;e;)e.c?(e.t<i&&(i=e.t),e=(t=e).n):e=t?t.n=e.n:Ae=e.n;return Ne=t,i}function Te(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}s.timer=function(){Ce.apply(this,arguments)},s.timer.flush=function(){Se(),ke()},s.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var Ue=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map((function(t,e){var i=Math.pow(10,3*E(8-e));return{scale:e>8?function(t){return t/i}:function(t){return t*i},symbol:t}}));function Ie(t){var e=t.decimal,i=t.thousands,n=t.grouping,r=t.currency,a=n&&i?function(t,e){for(var r=t.length,s=[],a=0,o=n[0],l=0;r>0&&o>0&&(l+o+1>e&&(o=Math.max(1,e-l)),s.push(t.substring(r-=o,r+o)),!((l+=o+1)>e));)o=n[a=(a+1)%n.length];return s.reverse().join(i)}:I;return function(t){var i=_e.exec(t),n=i[1]||" ",o=i[2]||">",l=i[3]||"-",h=i[4]||"",c=i[5],u=+i[6],d=i[7],p=i[8],f=i[9],m=1,g="",v="",b=!1,y=!0;switch(p&&(p=+p.substring(1)),(c||"0"===n&&"="===o)&&(c=n="0",o="="),f){case"n":d=!0,f="g";break;case"%":m=100,v="%",f="f";break;case"p":m=100,v="%",f="r";break;case"b":case"o":case"x":case"X":"#"===h&&(g="0"+f.toLowerCase());case"c":y=!1;case"d":b=!0,p=0;break;case"s":m=-1,f="r"}"$"===h&&(g=r[0],v=r[1]),"r"!=f||p||(f="g"),null!=p&&("g"==f?p=Math.max(1,Math.min(21,p)):"e"!=f&&"f"!=f||(p=Math.max(0,Math.min(20,p)))),f=He.get(f)||De;var w=c&&d;return function(t){var i=v;if(b&&t%1)return"";var r=t<0||0===t&&1/t<0?(t=-t,"-"):"-"===l?"":l;if(m<0){var h=s.formatPrefix(t,p);t=h.scale(t),i=h.symbol+v}else t*=m;var x,E,A=(t=f(t,p)).lastIndexOf(".");if(A<0){var N=y?t.lastIndexOf("e"):-1;N<0?(x=t,E=""):(x=t.substring(0,N),E=t.substring(N))}else x=t.substring(0,A),E=e+t.substring(A+1);!c&&d&&(x=a(x,1/0));var O=g.length+x.length+E.length+(w?0:r.length),M=O<u?new Array(O=u-O+1).join(n):"";return w&&(x=a(M+x,M.length?u-E.length:1/0)),r+=g,t=x+E,("<"===o?r+t+M:">"===o?M+r+t:"^"===o?M.substring(0,O>>=1)+r+t+M.substring(O):r+(w?t:M+t))+i}}}s.formatPrefix=function(t,e){var i=0;return(t=+t)&&(t<0&&(t*=-1),e&&(t=s.round(t,Te(t,e))),i=1+Math.floor(1e-12+Math.log(t)/Math.LN10),i=Math.max(-24,Math.min(24,3*Math.floor((i-1)/3)))),Ue[8+i/3]};var _e=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,He=s.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=s.round(t,Te(t,e))).toFixed(Math.max(0,Math.min(20,Te(t*(1+1e-15),e))))}});function De(t){return t+""}var Pe=s.time={},Ve=Date;function Be(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}Be.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Re.setUTCDate.apply(this._,arguments)},setDay:function(){Re.setUTCDay.apply(this._,arguments)},setFullYear:function(){Re.setUTCFullYear.apply(this._,arguments)},setHours:function(){Re.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Re.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Re.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Re.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Re.setUTCSeconds.apply(this._,arguments)},setTime:function(){Re.setTime.apply(this._,arguments)}};var Re=Date.prototype;function ze(t,e,i){function n(e){var i=t(e),n=s(i,1);return e-i<n-e?i:n}function r(i){return e(i=t(new Ve(i-1)),1),i}function s(t,i){return e(t=new Ve(+t),i),t}function a(t,n,s){var a=r(t),o=[];if(s>1)for(;a<n;)i(a)%s||o.push(new Date(+a)),e(a,1);else for(;a<n;)o.push(new Date(+a)),e(a,1);return o}t.floor=t,t.round=n,t.ceil=r,t.offset=s,t.range=a;var o=t.utc=$e(t);return o.floor=o,o.round=$e(n),o.ceil=$e(r),o.offset=$e(s),o.range=function(t,e,i){try{Ve=Be;var n=new Be;return n._=t,a(n,e,i)}finally{Ve=Date}},t}function $e(t){return function(e,i){try{Ve=Be;var n=new Be;return n._=e,t(n,i)._}finally{Ve=Date}}}function Fe(t){var e=t.dateTime,i=t.date,n=t.time,r=t.periods,a=t.days,o=t.shortDays,l=t.months,h=t.shortMonths;function c(t){var e=t.length;function i(i){for(var n,r,s,a=[],o=-1,l=0;++o<e;)37===t.charCodeAt(o)&&(a.push(t.slice(l,o)),null!=(r=qe[n=t.charAt(++o)])&&(n=t.charAt(++o)),(s=x[n])&&(n=s(i,null==r?"e"===n?" ":"0":r)),a.push(n),l=o+1);return a.push(t.slice(l,o)),a.join("")}return i.parse=function(e){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(u(i,t,e,0)!=e.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var n=null!=i.Z&&Ve!==Be,r=new(n?Be:Ve);return"j"in i?r.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),r.setFullYear(i.y,0,1),r.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(r.getDay()+5)%7:i.w+7*i.U-(r.getDay()+6)%7)):r.setFullYear(i.y,i.m,i.d),r.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),n?r._:r},i.toString=function(){return t},i}function u(t,e,i,n){for(var r,s,a,o=0,l=e.length,h=i.length;o<l;){if(n>=h)return-1;if(37===(r=e.charCodeAt(o++))){if(a=e.charAt(o++),!(s=E[a in qe?e.charAt(o++):a])||(n=s(t,i,n))<0)return-1}else if(r!=i.charCodeAt(n++))return-1}return n}c.utc=function(t){var e=c(t);function i(t){try{var i=new(Ve=Be);return i._=t,e(i)}finally{Ve=Date}}return i.parse=function(t){try{Ve=Be;var i=e.parse(t);return i&&i._}finally{Ve=Date}},i.toString=e.toString,i},c.multi=c.utc.multi=di;var d=s.map(),p=Ze(a),f=Ge(a),m=Ze(o),g=Ge(o),v=Ze(l),b=Ge(l),y=Ze(h),w=Ge(h);r.forEach((function(t,e){d.set(t.toLowerCase(),e)}));var x={a:function(t){return o[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return h[t.getMonth()]},B:function(t){return l[t.getMonth()]},c:c(e),d:function(t,e){return Ye(t.getDate(),e,2)},e:function(t,e){return Ye(t.getDate(),e,2)},H:function(t,e){return Ye(t.getHours(),e,2)},I:function(t,e){return Ye(t.getHours()%12||12,e,2)},j:function(t,e){return Ye(1+Pe.dayOfYear(t),e,3)},L:function(t,e){return Ye(t.getMilliseconds(),e,3)},m:function(t,e){return Ye(t.getMonth()+1,e,2)},M:function(t,e){return Ye(t.getMinutes(),e,2)},p:function(t){return r[+(t.getHours()>=12)]},S:function(t,e){return Ye(t.getSeconds(),e,2)},U:function(t,e){return Ye(Pe.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Ye(Pe.mondayOfYear(t),e,2)},x:c(i),X:c(n),y:function(t,e){return Ye(t.getFullYear()%100,e,2)},Y:function(t,e){return Ye(t.getFullYear()%1e4,e,4)},Z:ci,"%":function(){return"%"}},E={a:function(t,e,i){m.lastIndex=0;var n=m.exec(e.slice(i));return n?(t.w=g.get(n[0].toLowerCase()),i+n[0].length):-1},A:function(t,e,i){p.lastIndex=0;var n=p.exec(e.slice(i));return n?(t.w=f.get(n[0].toLowerCase()),i+n[0].length):-1},b:function(t,e,i){y.lastIndex=0;var n=y.exec(e.slice(i));return n?(t.m=w.get(n[0].toLowerCase()),i+n[0].length):-1},B:function(t,e,i){v.lastIndex=0;var n=v.exec(e.slice(i));return n?(t.m=b.get(n[0].toLowerCase()),i+n[0].length):-1},c:function(t,e,i){return u(t,x.c.toString(),e,i)},d:ri,e:ri,H:ai,I:ai,j:si,L:hi,m:ni,M:oi,p:function(t,e,i){var n=d.get(e.slice(i,i+=2).toLowerCase());return null==n?-1:(t.p=n,i)},S:li,U:Ke,w:Je,W:Qe,x:function(t,e,i){return u(t,x.x.toString(),e,i)},X:function(t,e,i){return u(t,x.X.toString(),e,i)},y:ei,Y:ti,Z:ii,"%":ui};return c}Pe.year=ze((function(t){return(t=Pe.day(t)).setMonth(0,1),t}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t){return t.getFullYear()})),Pe.years=Pe.year.range,Pe.years.utc=Pe.year.utc.range,Pe.day=ze((function(t){var e=new Ve(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t){return t.getDate()-1})),Pe.days=Pe.day.range,Pe.days.utc=Pe.day.utc.range,Pe.dayOfYear=function(t){var e=Pe.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach((function(t,e){e=7-e;var i=Pe[t]=ze((function(t){return(t=Pe.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t}),(function(t,e){t.setDate(t.getDate()+7*Math.floor(e))}),(function(t){var i=Pe.year(t).getDay();return Math.floor((Pe.dayOfYear(t)+(i+e)%7)/7)-(i!==e)}));Pe[t+"s"]=i.range,Pe[t+"s"].utc=i.utc.range,Pe[t+"OfYear"]=function(t){var i=Pe.year(t).getDay();return Math.floor((Pe.dayOfYear(t)+(i+e)%7)/7)}})),Pe.week=Pe.sunday,Pe.weeks=Pe.sunday.range,Pe.weeks.utc=Pe.sunday.utc.range,Pe.weekOfYear=Pe.sundayOfYear;var qe={"-":"",_:" ",0:"0"},We=/^\s*\d+/,Xe=/^%/;function Ye(t,e,i){var n=t<0?"-":"",r=(n?-t:t)+"",s=r.length;return n+(s<i?new Array(i-s+1).join(e)+r:r)}function Ze(t){return new RegExp("^(?:"+t.map(s.requote).join("|")+")","i")}function Ge(t){for(var e=new O,i=-1,n=t.length;++i<n;)e.set(t[i].toLowerCase(),i);return e}function Je(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+1));return n?(t.w=+n[0],i+n[0].length):-1}function Ke(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i));return n?(t.U=+n[0],i+n[0].length):-1}function Qe(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i));return n?(t.W=+n[0],i+n[0].length):-1}function ti(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+4));return n?(t.y=+n[0],i+n[0].length):-1}function ei(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+2));return n?(t.y=function(t){return t+(t>68?1900:2e3)}(+n[0]),i+n[0].length):-1}function ii(t,e,i){return/^[+-]\d{4}$/.test(e=e.slice(i,i+5))?(t.Z=-e,i+5):-1}function ni(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+2));return n?(t.m=n[0]-1,i+n[0].length):-1}function ri(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+2));return n?(t.d=+n[0],i+n[0].length):-1}function si(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+3));return n?(t.j=+n[0],i+n[0].length):-1}function ai(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+2));return n?(t.H=+n[0],i+n[0].length):-1}function oi(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+2));return n?(t.M=+n[0],i+n[0].length):-1}function li(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+2));return n?(t.S=+n[0],i+n[0].length):-1}function hi(t,e,i){We.lastIndex=0;var n=We.exec(e.slice(i,i+3));return n?(t.L=+n[0],i+n[0].length):-1}function ci(t){var e=t.getTimezoneOffset(),i=e>0?"-":"+",n=E(e)/60|0,r=E(e)%60;return i+Ye(n,"0",2)+Ye(r,"0",2)}function ui(t,e,i){Xe.lastIndex=0;var n=Xe.exec(e.slice(i,i+1));return n?i+n[0].length:-1}function di(t){for(var e=t.length,i=-1;++i<e;)t[i][0]=this(t[i][0]);return function(e){for(var i=0,n=t[i];!n[1](e);)n=t[++i];return n[0](e)}}s.locale=function(t){return{numberFormat:Ie(t),timeFormat:Fe(t)}};var pi=s.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function fi(){}s.format=pi.numberFormat,s.geo={},fi.prototype={s:0,t:0,add:function(t){gi(t,this.t,mi),gi(mi.s,this.s,this),this.s?this.t+=mi.t:this.s=mi.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var mi=new fi;function gi(t,e,i){var n=i.s=t+e,r=n-t,s=n-r;i.t=t-s+(e-r)}function vi(t,e){t&&yi.hasOwnProperty(t.type)&&yi[t.type](t,e)}s.geo.stream=function(t,e){t&&bi.hasOwnProperty(t.type)?bi[t.type](t,e):vi(t,e)};var bi={Feature:function(t,e){vi(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,r=i.length;++n<r;)vi(i[n].geometry,e)}},yi={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){wi(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)wi(i[n],e,0)},Polygon:function(t,e){xi(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)xi(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,r=i.length;++n<r;)vi(i[n],e)}};function wi(t,e,i){var n,r=-1,s=t.length-i;for(e.lineStart();++r<s;)n=t[r],e.point(n[0],n[1],n[2]);e.lineEnd()}function xi(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)wi(t[i],e,1);e.polygonEnd()}s.geo.area=function(t){return Ei=0,s.geo.stream(t,_i),Ei};var Ei,Ai,Ni,Oi,Mi,ji,Ci,Li,Si,ki,Ti,Ui,Ii=new fi,_i={sphere:function(){Ei+=4*St},point:P,lineStart:P,lineEnd:P,polygonStart:function(){Ii.reset(),_i.lineStart=Hi},polygonEnd:function(){var t=2*Ii;Ei+=t<0?4*St+t:t,_i.lineStart=_i.lineEnd=_i.point=P}};function Hi(){var t,e,i,n,r;function s(t,e){e=e*It/2+St/4;var s=(t*=It)-i,a=s>=0?1:-1,o=a*s,l=Math.cos(e),h=Math.sin(e),c=r*h,u=n*l+c*Math.cos(o),d=c*a*Math.sin(o);Ii.add(Math.atan2(d,u)),i=t,n=l,r=h}_i.point=function(a,o){_i.point=s,i=(t=a)*It,n=Math.cos(o=(e=o)*It/2+St/4),r=Math.sin(o)},_i.lineEnd=function(){s(t,e)}}function Di(t){var e=t[0],i=t[1],n=Math.cos(i);return[n*Math.cos(e),n*Math.sin(e),Math.sin(i)]}function Pi(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Vi(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Bi(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Ri(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function zi(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function $i(t){return[Math.atan2(t[1],t[0]),Vt(t[2])]}function Fi(t,e){return E(t[0]-e[0])<Ct&&E(t[1]-e[1])<Ct}s.geo.bounds=function(){var t,e,i,n,r,a,o,l,h,c,u,d={point:p,lineStart:m,lineEnd:g,polygonStart:function(){d.point=v,d.lineStart=b,d.lineEnd=y,h=0,_i.polygonStart()},polygonEnd:function(){_i.polygonEnd(),d.point=p,d.lineStart=m,d.lineEnd=g,Ii<0?(t=-(i=180),e=-(n=90)):h>Ct?n=90:h<-Ct&&(e=-90),u[0]=t,u[1]=i}};function p(r,s){c.push(u=[t=r,i=r]),s<e&&(e=s),s>n&&(n=s)}function f(s,a){var o=Di([s*It,a*It]);if(l){var h=Vi(l,o),c=Vi([h[1],-h[0],0],h);zi(c),c=$i(c);var u=s-r,d=u>0?1:-1,f=c[0]*_t*d,m=E(u)>180;if(m^(d*r<f&&f<d*s))(g=c[1]*_t)>n&&(n=g);else if(m^(d*r<(f=(f+360)%360-180)&&f<d*s)){var g;(g=-c[1]*_t)<e&&(e=g)}else a<e&&(e=a),a>n&&(n=a);m?s<r?w(t,s)>w(t,i)&&(i=s):w(s,i)>w(t,i)&&(t=s):i>=t?(s<t&&(t=s),s>i&&(i=s)):s>r?w(t,s)>w(t,i)&&(i=s):w(s,i)>w(t,i)&&(t=s)}else p(s,a);l=o,r=s}function m(){d.point=f}function g(){u[0]=t,u[1]=i,d.point=p,l=null}function v(t,e){if(l){var i=t-r;h+=E(i)>180?i+(i>0?360:-360):i}else a=t,o=e;_i.point(t,e),f(t,e)}function b(){_i.lineStart()}function y(){v(a,o),_i.lineEnd(),E(h)>Ct&&(t=-(i=180)),u[0]=t,u[1]=i,l=null}function w(t,e){return(e-=t)<0?e+360:e}function x(t,e){return t[0]-e[0]}function A(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}return function(r){if(n=i=-(t=e=1/0),c=[],s.geo.stream(r,d),h=c.length){c.sort(x);for(var a=1,o=[m=c[0]];a<h;++a)A((p=c[a])[0],m)||A(p[1],m)?(w(m[0],p[1])>w(m[0],m[1])&&(m[1]=p[1]),w(p[0],m[1])>w(m[0],m[1])&&(m[0]=p[0])):o.push(m=p);for(var l,h,p,f=-1/0,m=(a=0,o[h=o.length-1]);a<=h;m=p,++a)p=o[a],(l=w(m[1],p[0]))>f&&(f=l,t=p[0],i=m[1])}return c=u=null,t===1/0||e===1/0?[[NaN,NaN],[NaN,NaN]]:[[t,e],[i,n]]}}(),s.geo.centroid=function(t){Ai=Ni=Oi=Mi=ji=Ci=Li=Si=ki=Ti=Ui=0,s.geo.stream(t,qi);var e=ki,i=Ti,n=Ui,r=e*e+i*i+n*n;return r<Lt&&(e=Ci,i=Li,n=Si,Ni<Ct&&(e=Oi,i=Mi,n=ji),(r=e*e+i*i+n*n)<Lt)?[NaN,NaN]:[Math.atan2(i,e)*_t,Vt(n/Math.sqrt(r))*_t]};var qi={sphere:P,point:Wi,lineStart:Yi,lineEnd:Zi,polygonStart:function(){qi.lineStart=Gi},polygonEnd:function(){qi.lineStart=Yi}};function Wi(t,e){t*=It;var i=Math.cos(e*=It);Xi(i*Math.cos(t),i*Math.sin(t),Math.sin(e))}function Xi(t,e,i){++Ai,Oi+=(t-Oi)/Ai,Mi+=(e-Mi)/Ai,ji+=(i-ji)/Ai}function Yi(){var t,e,i;function n(n,r){n*=It;var s=Math.cos(r*=It),a=s*Math.cos(n),o=s*Math.sin(n),l=Math.sin(r),h=Math.atan2(Math.sqrt((h=e*l-i*o)*h+(h=i*a-t*l)*h+(h=t*o-e*a)*h),t*a+e*o+i*l);Ni+=h,Ci+=h*(t+(t=a)),Li+=h*(e+(e=o)),Si+=h*(i+(i=l)),Xi(t,e,i)}qi.point=function(r,s){r*=It;var a=Math.cos(s*=It);t=a*Math.cos(r),e=a*Math.sin(r),i=Math.sin(s),qi.point=n,Xi(t,e,i)}}function Zi(){qi.point=Wi}function Gi(){var t,e,i,n,r;function s(t,e){t*=It;var s=Math.cos(e*=It),a=s*Math.cos(t),o=s*Math.sin(t),l=Math.sin(e),h=n*l-r*o,c=r*a-i*l,u=i*o-n*a,d=Math.sqrt(h*h+c*c+u*u),p=i*a+n*o+r*l,f=d&&-Pt(p)/d,m=Math.atan2(d,p);ki+=f*h,Ti+=f*c,Ui+=f*u,Ni+=m,Ci+=m*(i+(i=a)),Li+=m*(n+(n=o)),Si+=m*(r+(r=l)),Xi(i,n,r)}qi.point=function(a,o){t=a,e=o,qi.point=s,a*=It;var l=Math.cos(o*=It);i=l*Math.cos(a),n=l*Math.sin(a),r=Math.sin(o),Xi(i,n,r)},qi.lineEnd=function(){s(t,e),qi.lineEnd=Zi,qi.point=Wi}}function Ji(t,e){function i(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(i.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),i}function Ki(){return!0}function Qi(t,e,i,n,r){var s=[],a=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,i=t[0],n=t[e];if(Fi(i,n)){r.lineStart();for(var o=0;o<e;++o)r.point((i=t[o])[0],i[1]);r.lineEnd()}else{var l=new en(i,t,null,!0),h=new en(i,null,l,!1);l.o=h,s.push(l),a.push(h),l=new en(n,t,null,!1),h=new en(n,null,l,!0),l.o=h,s.push(l),a.push(h)}}})),a.sort(e),tn(s),tn(a),s.length){for(var o=0,l=i,h=a.length;o<h;++o)a[o].e=l=!l;for(var c,u,d=s[0];;){for(var p=d,f=!0;p.v;)if((p=p.n)===d)return;c=p.z,r.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(o=0,h=c.length;o<h;++o)r.point((u=c[o])[0],u[1]);else n(p.x,p.n.x,1,r);p=p.n}else{if(f)for(o=(c=p.p.z).length-1;o>=0;--o)r.point((u=c[o])[0],u[1]);else n(p.x,p.p.x,-1,r);p=p.p}c=(p=p.o).z,f=!f}while(!p.v);r.lineEnd()}}}function tn(t){if(e=t.length){for(var e,i,n=0,r=t[0];++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function en(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function nn(t,e,i,n){return function(r,a){var o,l=e(a),h=r.invert(n[0],n[1]),c={point:u,lineStart:p,lineEnd:f,polygonStart:function(){c.point=w,c.lineStart=x,c.lineEnd=E,o=[],m=[]},polygonEnd:function(){c.point=u,c.lineStart=p,c.lineEnd=f,o=s.merge(o);var t=function(t,e){var i=t[0],n=t[1],r=[Math.sin(i),-Math.cos(i),0],s=0,a=0;Ii.reset();for(var o=0,l=e.length;o<l;++o){var h=e[o],c=h.length;if(c)for(var u=h[0],d=u[0],p=u[1]/2+St/4,f=Math.sin(p),m=Math.cos(p),g=1;;){g===c&&(g=0);var v=(t=h[g])[0],b=t[1]/2+St/4,y=Math.sin(b),w=Math.cos(b),x=v-d,E=x>=0?1:-1,A=E*x,N=A>St,O=f*y;if(Ii.add(Math.atan2(O*E*Math.sin(A),m*w+O*Math.cos(A))),s+=N?x+E*kt:x,N^d>=i^v>=i){var M=Vi(Di(u),Di(t));zi(M);var j=Vi(r,M);zi(j);var C=(N^x>=0?-1:1)*Vt(j[2]);(n>C||n===C&&(M[0]||M[1]))&&(a+=N^x>=0?1:-1)}if(!g++)break;d=v,f=y,m=w,u=t}}return(s<-Ct||s<Ct&&Ii<-Ct)^1&a}(h,m);o.length?(y||(a.polygonStart(),y=!0),Qi(o,an,t,i,a)):t&&(y||(a.polygonStart(),y=!0),a.lineStart(),i(null,null,1,a),a.lineEnd()),y&&(a.polygonEnd(),y=!1),o=m=null},sphere:function(){a.polygonStart(),a.lineStart(),i(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function u(e,i){var n=r(e,i);t(e=n[0],i=n[1])&&a.point(e,i)}function d(t,e){var i=r(t,e);l.point(i[0],i[1])}function p(){c.point=d,l.lineStart()}function f(){c.point=u,l.lineEnd()}var m,g,v=sn(),b=e(v),y=!1;function w(t,e){g.push([t,e]);var i=r(t,e);b.point(i[0],i[1])}function x(){b.lineStart(),g=[]}function E(){w(g[0][0],g[0][1]),b.lineEnd();var t,e=b.clean(),i=v.buffer(),n=i.length;if(g.pop(),m.push(g),g=null,n)if(1&e){var r,s=-1;if((n=(t=i[0]).length-1)>0){for(y||(a.polygonStart(),y=!0),a.lineStart();++s<n;)a.point((r=t[s])[0],r[1]);a.lineEnd()}}else n>1&&2&e&&i.push(i.pop().concat(i.shift())),o.push(i.filter(rn))}return c}}function rn(t){return t.length>1}function sn(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,i){t.push([e,i])},lineEnd:P,buffer:function(){var i=e;return e=[],t=null,i},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function an(t,e){return((t=t.x)[0]<0?t[1]-Ut-Ct:Ut-t[1])-((e=e.x)[0]<0?e[1]-Ut-Ct:Ut-e[1])}var on=nn(Ki,(function(t){var e,i=NaN,n=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(s,a){var o=s>0?St:-St,l=E(s-i);E(l-St)<Ct?(t.point(i,n=(n+a)/2>0?Ut:-Ut),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(o,n),t.point(s,n),e=0):r!==o&&l>=St&&(E(i-r)<Ct&&(i-=r*Ct),E(s-o)<Ct&&(s-=o*Ct),n=function(t,e,i,n){var r,s,a=Math.sin(t-i);return E(a)>Ct?Math.atan((Math.sin(e)*(s=Math.cos(n))*Math.sin(i)-Math.sin(n)*(r=Math.cos(e))*Math.sin(t))/(r*s*a)):(e+n)/2}(i,n,s,a),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(o,n),e=0),t.point(i=s,n=a),r=o},lineEnd:function(){t.lineEnd(),i=n=NaN},clean:function(){return 2-e}}}),(function(t,e,i,n){var r;if(null==t)r=i*Ut,n.point(-St,r),n.point(0,r),n.point(St,r),n.point(St,0),n.point(St,-r),n.point(0,-r),n.point(-St,-r),n.point(-St,0),n.point(-St,r);else if(E(t[0]-e[0])>Ct){var s=t[0]<e[0]?St:-St;r=i*s/2,n.point(-s,r),n.point(0,r),n.point(s,r)}else n.point(e[0],e[1])}),[-St,-St/2]);function ln(t){var e=Math.cos(t),i=e>0,n=E(e)>Ct;return nn(r,(function(t){var e,o,l,h,c;return{lineStart:function(){h=l=!1,c=1},point:function(u,d){var p,f=[u,d],m=r(u,d),g=i?m?0:a(u,d):m?a(u+(u<0?St:-St),d):0;if(!e&&(h=l=m)&&t.lineStart(),m!==l&&(p=s(e,f),(Fi(e,p)||Fi(f,p))&&(f[0]+=Ct,f[1]+=Ct,m=r(f[0],f[1]))),m!==l)c=0,m?(t.lineStart(),p=s(f,e),t.point(p[0],p[1])):(p=s(e,f),t.point(p[0],p[1]),t.lineEnd()),e=p;else if(n&&e&&i^m){var v;g&o||!(v=s(f,e,!0))||(c=0,i?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1])))}!m||e&&Fi(e,f)||t.point(f[0],f[1]),e=f,l=m,o=g},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return c|(h&&l)<<1}}}),qn(t,6*It),i?[0,-t]:[-St,t-St]);function r(t,i){return Math.cos(t)*Math.cos(i)>e}function s(t,i,n){var r=[1,0,0],s=Vi(Di(t),Di(i)),a=Pi(s,s),o=s[0],l=a-o*o;if(!l)return!n&&t;var h=e*a/l,c=-e*o/l,u=Vi(r,s),d=Ri(r,h);Bi(d,Ri(s,c));var p=u,f=Pi(d,p),m=Pi(p,p),g=f*f-m*(Pi(d,d)-1);if(!(g<0)){var v=Math.sqrt(g),b=Ri(p,(-f-v)/m);if(Bi(b,d),b=$i(b),!n)return b;var y,w=t[0],x=i[0],A=t[1],N=i[1];x<w&&(y=w,w=x,x=y);var O=x-w,M=E(O-St)<Ct;if(!M&&N<A&&(y=A,A=N,N=y),M||O<Ct?M?A+N>0^b[1]<(E(b[0]-w)<Ct?A:N):A<=b[1]&&b[1]<=N:O>St^(w<=b[0]&&b[0]<=x)){var j=Ri(p,(-f+v)/m);return Bi(j,d),[b,$i(j)]}}}function a(e,n){var r=i?t:St-t,s=0;return e<-r?s|=1:e>r&&(s|=2),n<-r?s|=4:n>r&&(s|=8),s}}function hn(t,e,i,n){return function(r){var s,a=r.a,o=r.b,l=a.x,h=a.y,c=0,u=1,d=o.x-l,p=o.y-h;if(s=t-l,d||!(s>0)){if(s/=d,d<0){if(s<c)return;s<u&&(u=s)}else if(d>0){if(s>u)return;s>c&&(c=s)}if(s=i-l,d||!(s<0)){if(s/=d,d<0){if(s>u)return;s>c&&(c=s)}else if(d>0){if(s<c)return;s<u&&(u=s)}if(s=e-h,p||!(s>0)){if(s/=p,p<0){if(s<c)return;s<u&&(u=s)}else if(p>0){if(s>u)return;s>c&&(c=s)}if(s=n-h,p||!(s<0)){if(s/=p,p<0){if(s>u)return;s>c&&(c=s)}else if(p>0){if(s<c)return;s<u&&(u=s)}return c>0&&(r.a={x:l+c*d,y:h+c*p}),u<1&&(r.b={x:l+u*d,y:h+u*p}),r}}}}}}var cn=1e9;function un(t,e,i,n){return function(l){var h,c,u,d,p,f,m,g,v,b,y,w=l,x=sn(),E=hn(t,e,i,n),A={point:M,lineStart:function(){A.point=j,c&&c.push(u=[]),b=!0,v=!1,m=g=NaN},lineEnd:function(){h&&(j(d,p),f&&v&&x.rejoin(),h.push(x.buffer())),A.point=M,v&&l.lineEnd()},polygonStart:function(){l=x,h=[],c=[],y=!0},polygonEnd:function(){l=w,h=s.merge(h);var e=function(t){for(var e=0,i=c.length,n=t[1],r=0;r<i;++r)for(var s,a=1,o=c[r],l=o.length,h=o[0];a<l;++a)s=o[a],h[1]<=n?s[1]>n&&Dt(h,s,t)>0&&++e:s[1]<=n&&Dt(h,s,t)<0&&--e,h=s;return 0!==e}([t,n]),i=y&&e,r=h.length;(i||r)&&(l.polygonStart(),i&&(l.lineStart(),N(null,null,1,l),l.lineEnd()),r&&Qi(h,a,e,N,l),l.polygonEnd()),h=c=u=null}};function N(s,a,l,h){var c=0,u=0;if(null==s||(c=r(s,l))!==(u=r(a,l))||o(s,a)<0^l>0)do{h.point(0===c||3===c?t:i,c>1?n:e)}while((c=(c+l+4)%4)!==u);else h.point(a[0],a[1])}function O(r,s){return t<=r&&r<=i&&e<=s&&s<=n}function M(t,e){O(t,e)&&l.point(t,e)}function j(t,e){var i=O(t=Math.max(-1e9,Math.min(cn,t)),e=Math.max(-1e9,Math.min(cn,e)));if(c&&u.push([t,e]),b)d=t,p=e,f=i,b=!1,i&&(l.lineStart(),l.point(t,e));else if(i&&v)l.point(t,e);else{var n={a:{x:m,y:g},b:{x:t,y:e}};E(n)?(v||(l.lineStart(),l.point(n.a.x,n.a.y)),l.point(n.b.x,n.b.y),i||l.lineEnd(),y=!1):i&&(l.lineStart(),l.point(t,e),y=!1)}m=t,g=e,v=i}return A};function r(n,r){return E(n[0]-t)<Ct?r>0?0:3:E(n[0]-i)<Ct?r>0?2:1:E(n[1]-e)<Ct?r>0?1:0:r>0?3:2}function a(t,e){return o(t.x,e.x)}function o(t,e){var i=r(t,1),n=r(e,1);return i!==n?i-n:0===i?e[1]-t[1]:1===i?t[0]-e[0]:2===i?t[1]-e[1]:e[0]-t[0]}}function dn(t){var e=0,i=St/3,n=Dn(t),r=n(e,i);return r.parallels=function(t){return arguments.length?n(e=t[0]*St/180,i=t[1]*St/180):[e/St*180,i/St*180]},r}function pn(t,e){var i=Math.sin(t),n=(i+Math.sin(e))/2,r=1+i*(2*n-i),s=Math.sqrt(r)/n;function a(t,e){var i=Math.sqrt(r-2*n*Math.sin(e))/n;return[i*Math.sin(t*=n),s-i*Math.cos(t)]}return a.invert=function(t,e){var i=s-e;return[Math.atan2(t,i)/n,Vt((r-(t*t+i*i)*n*n)/(2*n))]},a}s.geo.clipExtent=function(){var t,e,i,n,r,s,a={stream:function(t){return r&&(r.valid=!1),(r=s(t)).valid=!0,r},extent:function(o){return arguments.length?(s=un(t=+o[0][0],e=+o[0][1],i=+o[1][0],n=+o[1][1]),r&&(r.valid=!1,r=null),a):[[t,e],[i,n]]}};return a.extent([[0,0],[960,500]])},(s.geo.conicEqualArea=function(){return dn(pn)}).raw=pn,s.geo.albers=function(){return s.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},s.geo.albersUsa=function(){var t,e,i,n,r=s.geo.albers(),a=s.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o=s.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,i){t=[e,i]}};function h(r){var s=r[0],a=r[1];return t=null,e(s,a),t||(i(s,a),t)||n(s,a),t}return h.invert=function(t){var e=r.scale(),i=r.translate(),n=(t[0]-i[0])/e,s=(t[1]-i[1])/e;return(s>=.12&&s<.234&&n>=-.425&&n<-.214?a:s>=.166&&s<.234&&n>=-.214&&n<-.115?o:r).invert(t)},h.stream=function(t){var e=r.stream(t),i=a.stream(t),n=o.stream(t);return{point:function(t,r){e.point(t,r),i.point(t,r),n.point(t,r)},sphere:function(){e.sphere(),i.sphere(),n.sphere()},lineStart:function(){e.lineStart(),i.lineStart(),n.lineStart()},lineEnd:function(){e.lineEnd(),i.lineEnd(),n.lineEnd()},polygonStart:function(){e.polygonStart(),i.polygonStart(),n.polygonStart()},polygonEnd:function(){e.polygonEnd(),i.polygonEnd(),n.polygonEnd()}}},h.precision=function(t){return arguments.length?(r.precision(t),a.precision(t),o.precision(t),h):r.precision()},h.scale=function(t){return arguments.length?(r.scale(t),a.scale(.35*t),o.scale(t),h.translate(r.translate())):r.scale()},h.translate=function(t){if(!arguments.length)return r.translate();var s=r.scale(),c=+t[0],u=+t[1];return e=r.translate(t).clipExtent([[c-.455*s,u-.238*s],[c+.455*s,u+.238*s]]).stream(l).point,i=a.translate([c-.307*s,u+.201*s]).clipExtent([[c-.425*s+Ct,u+.12*s+Ct],[c-.214*s-Ct,u+.234*s-Ct]]).stream(l).point,n=o.translate([c-.205*s,u+.212*s]).clipExtent([[c-.214*s+Ct,u+.166*s+Ct],[c-.115*s-Ct,u+.234*s-Ct]]).stream(l).point,h},h.scale(1070)};var fn,mn,gn,vn,bn,yn,wn={point:P,lineStart:P,lineEnd:P,polygonStart:function(){mn=0,wn.lineStart=xn},polygonEnd:function(){wn.lineStart=wn.lineEnd=wn.point=P,fn+=E(mn/2)}};function xn(){var t,e,i,n;function r(t,e){mn+=n*t-i*e,i=t,n=e}wn.point=function(s,a){wn.point=r,t=i=s,e=n=a},wn.lineEnd=function(){r(t,e)}}var En={point:function(t,e){t<gn&&(gn=t),t>bn&&(bn=t),e<vn&&(vn=e),e>yn&&(yn=e)},lineStart:P,lineEnd:P,polygonStart:P,polygonEnd:P};function An(){var t=Nn(4.5),e=[],i={point:n,lineStart:function(){i.point=r},lineEnd:a,polygonStart:function(){i.lineEnd=o},polygonEnd:function(){i.lineEnd=a,i.point=n},pointRadius:function(e){return t=Nn(e),i},result:function(){if(e.length){var t=e.join("");return e=[],t}}};function n(i,n){e.push("M",i,",",n,t)}function r(t,n){e.push("M",t,",",n),i.point=s}function s(t,i){e.push("L",t,",",i)}function a(){i.point=n}function o(){e.push("Z")}return i}function Nn(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}var On,Mn={point:jn,lineStart:Cn,lineEnd:Ln,polygonStart:function(){Mn.lineStart=Sn},polygonEnd:function(){Mn.point=jn,Mn.lineStart=Cn,Mn.lineEnd=Ln}};function jn(t,e){Oi+=t,Mi+=e,++ji}function Cn(){var t,e;function i(i,n){var r=i-t,s=n-e,a=Math.sqrt(r*r+s*s);Ci+=a*(t+i)/2,Li+=a*(e+n)/2,Si+=a,jn(t=i,e=n)}Mn.point=function(n,r){Mn.point=i,jn(t=n,e=r)}}function Ln(){Mn.point=jn}function Sn(){var t,e,i,n;function r(t,e){var r=t-i,s=e-n,a=Math.sqrt(r*r+s*s);Ci+=a*(i+t)/2,Li+=a*(n+e)/2,Si+=a,ki+=(a=n*t-i*e)*(i+t),Ti+=a*(n+e),Ui+=3*a,jn(i=t,n=e)}Mn.point=function(s,a){Mn.point=r,jn(t=i=s,e=n=a)},Mn.lineEnd=function(){r(t,e)}}function kn(t){var e=4.5,i={point:n,lineStart:function(){i.point=r},lineEnd:a,polygonStart:function(){i.lineEnd=o},polygonEnd:function(){i.lineEnd=a,i.point=n},pointRadius:function(t){return e=t,i},result:P};function n(i,n){t.moveTo(i+e,n),t.arc(i,n,e,0,kt)}function r(e,n){t.moveTo(e,n),i.point=s}function s(e,i){t.lineTo(e,i)}function a(){i.point=n}function o(){t.closePath()}return i}function Tn(t){var e=.5,i=Math.cos(30*It),n=16;function r(t){return(n?a:s)(t)}function s(e){return _n(e,(function(i,n){i=t(i,n),e.point(i[0],i[1])}))}function a(e){var i,r,s,a,l,h,c,u,d,p,f,m,g={point:v,lineStart:b,lineEnd:w,polygonStart:function(){e.polygonStart(),g.lineStart=x},polygonEnd:function(){e.polygonEnd(),g.lineStart=b}};function v(i,n){i=t(i,n),e.point(i[0],i[1])}function b(){u=NaN,g.point=y,e.lineStart()}function y(i,r){var s=Di([i,r]),a=t(i,r);o(u,d,c,p,f,m,u=a[0],d=a[1],c=i,p=s[0],f=s[1],m=s[2],n,e),e.point(u,d)}function w(){g.point=v,e.lineEnd()}function x(){b(),g.point=E,g.lineEnd=A}function E(t,e){y(i=t,e),r=u,s=d,a=p,l=f,h=m,g.point=y}function A(){o(u,d,c,p,f,m,r,s,i,a,l,h,n,e),g.lineEnd=w,w()}return g}function o(n,r,s,a,l,h,c,u,d,p,f,m,g,v){var b=c-n,y=u-r,w=b*b+y*y;if(w>4*e&&g--){var x=a+p,A=l+f,N=h+m,O=Math.sqrt(x*x+A*A+N*N),M=Math.asin(N/=O),j=E(E(N)-1)<Ct||E(s-d)<Ct?(s+d)/2:Math.atan2(A,x),C=t(j,M),L=C[0],S=C[1],k=L-n,T=S-r,U=y*k-b*T;(U*U/w>e||E((b*k+y*T)/w-.5)>.3||a*p+l*f+h*m<i)&&(o(n,r,s,a,l,h,L,S,j,x/=O,A/=O,N,g,v),v.point(L,S),o(L,S,j,x,A,N,c,u,d,p,f,m,g,v))}}return r.precision=function(t){return arguments.length?(n=(e=t*t)>0&&16,r):Math.sqrt(e)},r}function Un(t){var e=Tn((function(e,i){return t([e*_t,i*_t])}));return function(t){return Pn(e(t))}}function In(t){this.stream=t}function _n(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function Hn(t){return Dn((function(){return t}))()}function Dn(t){var e,i,n,r,a,o,l=Tn((function(t,i){return[(t=e(t,i))[0]*h+r,a-t[1]*h]})),h=150,c=480,u=250,d=0,p=0,f=0,m=0,g=0,v=on,b=I,y=null,w=null;function x(t){return[(t=n(t[0]*It,t[1]*It))[0]*h+r,a-t[1]*h]}function E(t){return(t=n.invert((t[0]-r)/h,(a-t[1])/h))&&[t[0]*_t,t[1]*_t]}function A(){n=Ji(i=Rn(f,m,g),e);var t=e(d,p);return r=c-t[0]*h,a=u+t[1]*h,N()}function N(){return o&&(o.valid=!1,o=null),x}return x.stream=function(t){return o&&(o.valid=!1),(o=Pn(v(i,l(b(t))))).valid=!0,o},x.clipAngle=function(t){return arguments.length?(v=null==t?(y=t,on):ln((y=+t)*It),N()):y},x.clipExtent=function(t){return arguments.length?(w=t,b=t?un(t[0][0],t[0][1],t[1][0],t[1][1]):I,N()):w},x.scale=function(t){return arguments.length?(h=+t,A()):h},x.translate=function(t){return arguments.length?(c=+t[0],u=+t[1],A()):[c,u]},x.center=function(t){return arguments.length?(d=t[0]%360*It,p=t[1]%360*It,A()):[d*_t,p*_t]},x.rotate=function(t){return arguments.length?(f=t[0]%360*It,m=t[1]%360*It,g=t.length>2?t[2]%360*It:0,A()):[f*_t,m*_t,g*_t]},s.rebind(x,l,"precision"),function(){return e=t.apply(this,arguments),x.invert=e.invert&&E,A()}}function Pn(t){return _n(t,(function(e,i){t.point(e*It,i*It)}))}function Vn(t,e){return[t,e]}function Bn(t,e){return[t>St?t-kt:t<-St?t+kt:t,e]}function Rn(t,e,i){return t?e||i?Ji($n(t),Fn(e,i)):$n(t):e||i?Fn(e,i):Bn}function zn(t){return function(e,i){return[(e+=t)>St?e-kt:e<-St?e+kt:e,i]}}function $n(t){var e=zn(t);return e.invert=zn(-t),e}function Fn(t,e){var i=Math.cos(t),n=Math.sin(t),r=Math.cos(e),s=Math.sin(e);function a(t,e){var a=Math.cos(e),o=Math.cos(t)*a,l=Math.sin(t)*a,h=Math.sin(e),c=h*i+o*n;return[Math.atan2(l*r-c*s,o*i-h*n),Vt(c*r+l*s)]}return a.invert=function(t,e){var a=Math.cos(e),o=Math.cos(t)*a,l=Math.sin(t)*a,h=Math.sin(e),c=h*r-l*s;return[Math.atan2(l*r+h*s,o*i+c*n),Vt(c*i-o*n)]},a}function qn(t,e){var i=Math.cos(t),n=Math.sin(t);return function(r,s,a,o){var l=a*e;null!=r?(r=Wn(i,r),s=Wn(i,s),(a>0?r<s:r>s)&&(r+=a*kt)):(r=t+a*kt,s=t-.5*l);for(var h,c=r;a>0?c>s:c<s;c-=l)o.point((h=$i([i,-n*Math.cos(c),-n*Math.sin(c)]))[0],h[1])}}function Wn(t,e){var i=Di(e);i[0]-=t,zi(i);var n=Pt(-i[1]);return((-i[2]<0?-n:n)+2*Math.PI-Ct)%(2*Math.PI)}function Xn(t,e,i){var n=s.range(t,e-Ct,i).concat(e);return function(t){return n.map((function(e){return[t,e]}))}}function Yn(t,e,i){var n=s.range(t,e-Ct,i).concat(e);return function(t){return n.map((function(e){return[e,t]}))}}function Zn(t){return t.source}function Gn(t){return t.target}s.geo.path=function(){var t,e,i,n,r,a=4.5;function o(t){return t&&("function"==typeof a&&n.pointRadius(+a.apply(this,arguments)),r&&r.valid||(r=i(n)),s.geo.stream(t,r)),n.result()}function l(){return r=null,o}return o.area=function(t){return fn=0,s.geo.stream(t,i(wn)),fn},o.centroid=function(t){return Oi=Mi=ji=Ci=Li=Si=ki=Ti=Ui=0,s.geo.stream(t,i(Mn)),Ui?[ki/Ui,Ti/Ui]:Si?[Ci/Si,Li/Si]:ji?[Oi/ji,Mi/ji]:[NaN,NaN]},o.bounds=function(t){return bn=yn=-(gn=vn=1/0),s.geo.stream(t,i(En)),[[gn,vn],[bn,yn]]},o.projection=function(e){return arguments.length?(i=(t=e)?e.stream||Un(e):I,l()):t},o.context=function(t){return arguments.length?(n=null==(e=t)?new An:new kn(t),"function"!=typeof a&&n.pointRadius(a),l()):e},o.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(n.pointRadius(+t),+t),o):a},o.projection(s.geo.albersUsa()).context(null)},s.geo.transform=function(t){return{stream:function(e){var i=new In(e);for(var n in t)i[n]=t[n];return i}}},In.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},s.geo.projection=Hn,s.geo.projectionMutator=Dn,(s.geo.equirectangular=function(){return Hn(Vn)}).raw=Vn.invert=Vn,s.geo.rotation=function(t){function e(e){return(e=t(e[0]*It,e[1]*It))[0]*=_t,e[1]*=_t,e}return t=Rn(t[0]%360*It,t[1]*It,t.length>2?t[2]*It:0),e.invert=function(e){return(e=t.invert(e[0]*It,e[1]*It))[0]*=_t,e[1]*=_t,e},e},Bn.invert=Vn,s.geo.circle=function(){var t,e,i=[0,0],n=6;function r(){var t="function"==typeof i?i.apply(this,arguments):i,n=Rn(-t[0]*It,-t[1]*It,0).invert,r=[];return e(null,null,1,{point:function(t,e){r.push(t=n(t,e)),t[0]*=_t,t[1]*=_t}}),{type:"Polygon",coordinates:[r]}}return r.origin=function(t){return arguments.length?(i=t,r):i},r.angle=function(i){return arguments.length?(e=qn((t=+i)*It,n*It),r):t},r.precision=function(i){return arguments.length?(e=qn(t*It,(n=+i)*It),r):n},r.angle(90)},s.geo.distance=function(t,e){var i,n=(e[0]-t[0])*It,r=t[1]*It,s=e[1]*It,a=Math.sin(n),o=Math.cos(n),l=Math.sin(r),h=Math.cos(r),c=Math.sin(s),u=Math.cos(s);return Math.atan2(Math.sqrt((i=u*a)*i+(i=h*c-l*u*o)*i),l*c+h*u*o)},s.geo.graticule=function(){var t,e,i,n,r,a,o,l,h,c,u,d,p=10,f=p,m=90,g=360,v=2.5;function b(){return{type:"MultiLineString",coordinates:y()}}function y(){return s.range(Math.ceil(n/m)*m,i,m).map(u).concat(s.range(Math.ceil(l/g)*g,o,g).map(d)).concat(s.range(Math.ceil(e/p)*p,t,p).filter((function(t){return E(t%m)>Ct})).map(h)).concat(s.range(Math.ceil(a/f)*f,r,f).filter((function(t){return E(t%g)>Ct})).map(c))}return b.lines=function(){return y().map((function(t){return{type:"LineString",coordinates:t}}))},b.outline=function(){return{type:"Polygon",coordinates:[u(n).concat(d(o).slice(1),u(i).reverse().slice(1),d(l).reverse().slice(1))]}},b.extent=function(t){return arguments.length?b.majorExtent(t).minorExtent(t):b.minorExtent()},b.majorExtent=function(t){return arguments.length?(n=+t[0][0],i=+t[1][0],l=+t[0][1],o=+t[1][1],n>i&&(t=n,n=i,i=t),l>o&&(t=l,l=o,o=t),b.precision(v)):[[n,l],[i,o]]},b.minorExtent=function(i){return arguments.length?(e=+i[0][0],t=+i[1][0],a=+i[0][1],r=+i[1][1],e>t&&(i=e,e=t,t=i),a>r&&(i=a,a=r,r=i),b.precision(v)):[[e,a],[t,r]]},b.step=function(t){return arguments.length?b.majorStep(t).minorStep(t):b.minorStep()},b.majorStep=function(t){return arguments.length?(m=+t[0],g=+t[1],b):[m,g]},b.minorStep=function(t){return arguments.length?(p=+t[0],f=+t[1],b):[p,f]},b.precision=function(s){return arguments.length?(v=+s,h=Xn(a,r,90),c=Yn(e,t,v),u=Xn(l,o,90),d=Yn(n,i,v),b):v},b.majorExtent([[-180,-90+Ct],[180,90-Ct]]).minorExtent([[-180,-80-Ct],[180,80+Ct]])},s.geo.greatArc=function(){var t,e,i=Zn,n=Gn;function r(){return{type:"LineString",coordinates:[t||i.apply(this,arguments),e||n.apply(this,arguments)]}}return r.distance=function(){return s.geo.distance(t||i.apply(this,arguments),e||n.apply(this,arguments))},r.source=function(e){return arguments.length?(i=e,t="function"==typeof e?null:e,r):i},r.target=function(t){return arguments.length?(n=t,e="function"==typeof t?null:t,r):n},r.precision=function(){return arguments.length?r:0},r},s.geo.interpolate=function(t,e){return function(t,e,i,n){var r=Math.cos(e),s=Math.sin(e),a=Math.cos(n),o=Math.sin(n),l=r*Math.cos(t),h=r*Math.sin(t),c=a*Math.cos(i),u=a*Math.sin(i),d=2*Math.asin(Math.sqrt(Rt(n-e)+r*a*Rt(i-t))),p=1/Math.sin(d),f=d?function(t){var e=Math.sin(t*=d)*p,i=Math.sin(d-t)*p,n=i*l+e*c,r=i*h+e*u,a=i*s+e*o;return[Math.atan2(r,n)*_t,Math.atan2(a,Math.sqrt(n*n+r*r))*_t]}:function(){return[t*_t,e*_t]};return f.distance=d,f}(t[0]*It,t[1]*It,e[0]*It,e[1]*It)},s.geo.length=function(t){return On=0,s.geo.stream(t,Jn),On};var Jn={sphere:P,point:P,lineStart:function(){var t,e,i;function n(n,r){var s=Math.sin(r*=It),a=Math.cos(r),o=E((n*=It)-t),l=Math.cos(o);On+=Math.atan2(Math.sqrt((o=a*Math.sin(o))*o+(o=i*s-e*a*l)*o),e*s+i*a*l),t=n,e=s,i=a}Jn.point=function(r,s){t=r*It,e=Math.sin(s*=It),i=Math.cos(s),Jn.point=n},Jn.lineEnd=function(){Jn.point=Jn.lineEnd=P}},lineEnd:P,polygonStart:P,polygonEnd:P};function Kn(t,e){function i(e,i){var n=Math.cos(e),r=Math.cos(i),s=t(n*r);return[s*r*Math.sin(e),s*Math.sin(i)]}return i.invert=function(t,i){var n=Math.sqrt(t*t+i*i),r=e(n),s=Math.sin(r),a=Math.cos(r);return[Math.atan2(t*s,n*a),Math.asin(n&&i*s/n)]},i}var Qn=Kn((function(t){return Math.sqrt(2/(1+t))}),(function(t){return 2*Math.asin(t/2)}));(s.geo.azimuthalEqualArea=function(){return Hn(Qn)}).raw=Qn;var tr=Kn((function(t){var e=Math.acos(t);return e&&e/Math.sin(e)}),I);function er(t,e){var i=Math.cos(t),n=function(t){return Math.tan(St/4+t/2)},r=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(n(e)/n(t)),s=i*Math.pow(n(t),r)/r;if(!r)return rr;function a(t,e){s>0?e<-Ut+Ct&&(e=-Ut+Ct):e>Ut-Ct&&(e=Ut-Ct);var i=s/Math.pow(n(e),r);return[i*Math.sin(r*t),s-i*Math.cos(r*t)]}return a.invert=function(t,e){var i=s-e,n=Ht(r)*Math.sqrt(t*t+i*i);return[Math.atan2(t,i)/r,2*Math.atan(Math.pow(s/n,1/r))-Ut]},a}function ir(t,e){var i=Math.cos(t),n=t===e?Math.sin(t):(i-Math.cos(e))/(e-t),r=i/n+t;if(E(n)<Ct)return Vn;function s(t,e){var i=r-e;return[i*Math.sin(n*t),r-i*Math.cos(n*t)]}return s.invert=function(t,e){var i=r-e;return[Math.atan2(t,i)/n,r-Ht(n)*Math.sqrt(t*t+i*i)]},s}(s.geo.azimuthalEquidistant=function(){return Hn(tr)}).raw=tr,(s.geo.conicConformal=function(){return dn(er)}).raw=er,(s.geo.conicEquidistant=function(){return dn(ir)}).raw=ir;var nr=Kn((function(t){return 1/t}),Math.atan);function rr(t,e){return[t,Math.log(Math.tan(St/4+e/2))]}function sr(t){var e,i=Hn(t),n=i.scale,r=i.translate,s=i.clipExtent;return i.scale=function(){var t=n.apply(i,arguments);return t===i?e?i.clipExtent(null):i:t},i.translate=function(){var t=r.apply(i,arguments);return t===i?e?i.clipExtent(null):i:t},i.clipExtent=function(t){var a=s.apply(i,arguments);if(a===i){if(e=null==t){var o=St*n(),l=r();s([[l[0]-o,l[1]-o],[l[0]+o,l[1]+o]])}}else e&&(a=null);return a},i.clipExtent(null)}(s.geo.gnomonic=function(){return Hn(nr)}).raw=nr,rr.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Ut]},(s.geo.mercator=function(){return sr(rr)}).raw=rr;var ar=Kn((function(){return 1}),Math.asin);(s.geo.orthographic=function(){return Hn(ar)}).raw=ar;var or=Kn((function(t){return 1/(1+t)}),(function(t){return 2*Math.atan(t)}));function lr(t,e){return[Math.log(Math.tan(St/4+e/2)),-t]}function hr(t){return t[0]}function cr(t){return t[1]}function ur(t){for(var e=t.length,i=[0,1],n=2,r=2;r<e;r++){for(;n>1&&Dt(t[i[n-2]],t[i[n-1]],t[r])<=0;)--n;i[n++]=r}return i.slice(0,n)}function dr(t,e){return t[0]-e[0]||t[1]-e[1]}(s.geo.stereographic=function(){return Hn(or)}).raw=or,lr.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Ut]},(s.geo.transverseMercator=function(){var t=sr(lr),e=t.center,i=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return t?i([t[0],t[1],t.length>2?t[2]+90:90]):[(t=i())[0],t[1],t[2]-90]},i([0,0,90])}).raw=lr,s.geom={},s.geom.hull=function(t){var e=hr,i=cr;if(arguments.length)return n(t);function n(t){if(t.length<3)return[];var n,r=we(e),s=we(i),a=t.length,o=[],l=[];for(n=0;n<a;n++)o.push([+r.call(this,t[n],n),+s.call(this,t[n],n),n]);for(o.sort(dr),n=0;n<a;n++)l.push([o[n][0],-o[n][1]]);var h=ur(o),c=ur(l),u=c[0]===h[0],d=c[c.length-1]===h[h.length-1],p=[];for(n=h.length-1;n>=0;--n)p.push(t[o[h[n]][2]]);for(n=+u;n<c.length-d;++n)p.push(t[o[c[n]][2]]);return p}return n.x=function(t){return arguments.length?(e=t,n):e},n.y=function(t){return arguments.length?(i=t,n):i},n},s.geom.polygon=function(t){return q(t,pr),t};var pr=s.geom.polygon.prototype=[];function fr(t,e,i){return(i[0]-e[0])*(t[1]-e[1])<(i[1]-e[1])*(t[0]-e[0])}function mr(t,e,i,n){var r=t[0],s=i[0],a=e[0]-r,o=n[0]-s,l=t[1],h=i[1],c=e[1]-l,u=n[1]-h,d=(o*(l-h)-u*(r-s))/(u*a-o*c);return[r+d*a,l+d*c]}function gr(t){var e=t[0],i=t[t.length-1];return!(e[0]-i[0]||e[1]-i[1])}pr.area=function(){for(var t,e=-1,i=this.length,n=this[i-1],r=0;++e<i;)t=n,n=this[e],r+=t[1]*n[0]-t[0]*n[1];return.5*r},pr.centroid=function(t){var e,i,n=-1,r=this.length,s=0,a=0,o=this[r-1];for(arguments.length||(t=-1/(6*this.area()));++n<r;)e=o,o=this[n],i=e[0]*o[1]-o[0]*e[1],s+=(e[0]+o[0])*i,a+=(e[1]+o[1])*i;return[s*t,a*t]},pr.clip=function(t){for(var e,i,n,r,s,a,o=gr(t),l=-1,h=this.length-gr(this),c=this[h-1];++l<h;){for(e=t.slice(),t.length=0,r=this[l],s=e[(n=e.length-o)-1],i=-1;++i<n;)fr(a=e[i],c,r)?(fr(s,c,r)||t.push(mr(s,a,c,r)),t.push(a)):fr(s,c,r)&&t.push(mr(s,a,c,r)),s=a;o&&t.push(t[0]),c=r}return t};var vr,br,yr,wr,xr,Er=[],Ar=[];function Nr(){zr(this),this.edge=this.site=this.circle=null}function Or(t){var e=Er.pop()||new Nr;return e.site=t,e}function Mr(t){_r(t),yr.remove(t),Er.push(t),zr(t)}function jr(t){var e=t.circle,i=e.x,n=e.cy,r={x:i,y:n},s=t.P,a=t.N,o=[t];Mr(t);for(var l=s;l.circle&&E(i-l.circle.x)<Ct&&E(n-l.circle.cy)<Ct;)s=l.P,o.unshift(l),Mr(l),l=s;o.unshift(l),_r(l);for(var h=a;h.circle&&E(i-h.circle.x)<Ct&&E(n-h.circle.cy)<Ct;)a=h.N,o.push(h),Mr(h),h=a;o.push(h),_r(h);var c,u=o.length;for(c=1;c<u;++c)h=o[c],l=o[c-1],Vr(h.edge,l.site,h.site,r);l=o[0],(h=o[u-1]).edge=Pr(l.site,h.site,null,r),Ir(l),Ir(h)}function Cr(t){for(var e,i,n,r,s=t.x,a=t.y,o=yr._;o;)if((n=Lr(o,a)-s)>Ct)o=o.L;else{if(!((r=s-Sr(o,a))>Ct)){n>-Ct?(e=o.P,i=o):r>-Ct?(e=o,i=o.N):e=i=o;break}if(!o.R){e=o;break}o=o.R}var l=Or(t);if(yr.insert(e,l),e||i){if(e===i)return _r(e),i=Or(e.site),yr.insert(l,i),l.edge=i.edge=Pr(e.site,l.site),Ir(e),void Ir(i);if(i){_r(e),_r(i);var h=e.site,c=h.x,u=h.y,d=t.x-c,p=t.y-u,f=i.site,m=f.x-c,g=f.y-u,v=2*(d*g-p*m),b=d*d+p*p,y=m*m+g*g,w={x:(g*b-p*y)/v+c,y:(d*y-m*b)/v+u};Vr(i.edge,h,f,w),l.edge=Pr(h,t,null,w),i.edge=Pr(t,f,null,w),Ir(e),Ir(i)}else l.edge=Pr(e.site,l.site)}}function Lr(t,e){var i=t.site,n=i.x,r=i.y,s=r-e;if(!s)return n;var a=t.P;if(!a)return-1/0;var o=(i=a.site).x,l=i.y,h=l-e;if(!h)return o;var c=o-n,u=1/s-1/h,d=c/h;return u?(-d+Math.sqrt(d*d-2*u*(c*c/(-2*h)-l+h/2+r-s/2)))/u+n:(n+o)/2}function Sr(t,e){var i=t.N;if(i)return Lr(i,e);var n=t.site;return n.y===e?n.x:1/0}function kr(t){this.site=t,this.edges=[]}function Tr(t,e){return e.angle-t.angle}function Ur(){zr(this),this.x=this.y=this.arc=this.site=this.cy=null}function Ir(t){var e=t.P,i=t.N;if(e&&i){var n=e.site,r=t.site,s=i.site;if(n!==s){var a=r.x,o=r.y,l=n.x-a,h=n.y-o,c=s.x-a,u=2*(l*(g=s.y-o)-h*c);if(!(u>=-Lt)){var d=l*l+h*h,p=c*c+g*g,f=(g*d-h*p)/u,m=(l*p-c*d)/u,g=m+o,v=Ar.pop()||new Ur;v.arc=t,v.site=r,v.x=f+a,v.y=g+Math.sqrt(f*f+m*m),v.cy=g,t.circle=v;for(var b=null,y=xr._;y;)if(v.y<y.y||v.y===y.y&&v.x<=y.x){if(!y.L){b=y.P;break}y=y.L}else{if(!y.R){b=y;break}y=y.R}xr.insert(b,v),b||(wr=v)}}}}function _r(t){var e=t.circle;e&&(e.P||(wr=e.N),xr.remove(e),Ar.push(e),zr(e),t.circle=null)}function Hr(t,e){var i=t.b;if(i)return!0;var n,r,s=t.a,a=e[0][0],o=e[1][0],l=e[0][1],h=e[1][1],c=t.l,u=t.r,d=c.x,p=c.y,f=u.x,m=u.y,g=(d+f)/2,v=(p+m)/2;if(m===p){if(g<a||g>=o)return;if(d>f){if(s){if(s.y>=h)return}else s={x:g,y:l};i={x:g,y:h}}else{if(s){if(s.y<l)return}else s={x:g,y:h};i={x:g,y:l}}}else if(r=v-(n=(d-f)/(m-p))*g,n<-1||n>1)if(d>f){if(s){if(s.y>=h)return}else s={x:(l-r)/n,y:l};i={x:(h-r)/n,y:h}}else{if(s){if(s.y<l)return}else s={x:(h-r)/n,y:h};i={x:(l-r)/n,y:l}}else if(p<m){if(s){if(s.x>=o)return}else s={x:a,y:n*a+r};i={x:o,y:n*o+r}}else{if(s){if(s.x<a)return}else s={x:o,y:n*o+r};i={x:a,y:n*a+r}}return t.a=s,t.b=i,!0}function Dr(t,e){this.l=t,this.r=e,this.a=this.b=null}function Pr(t,e,i,n){var r=new Dr(t,e);return vr.push(r),i&&Vr(r,t,e,i),n&&Vr(r,e,t,n),br[t.i].edges.push(new Br(r,t,e)),br[e.i].edges.push(new Br(r,e,t)),r}function Vr(t,e,i,n){t.a||t.b?t.l===i?t.b=n:t.a=n:(t.a=n,t.l=e,t.r=i)}function Br(t,e,i){var n=t.a,r=t.b;this.edge=t,this.site=e,this.angle=i?Math.atan2(i.y-e.y,i.x-e.x):t.l===e?Math.atan2(r.x-n.x,n.y-r.y):Math.atan2(n.x-r.x,r.y-n.y)}function Rr(){this._=null}function zr(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function $r(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function Fr(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function qr(t){for(;t.L;)t=t.L;return t}function Wr(t,e){var i,n,r,s=t.sort(Xr).pop();for(vr=[],br=new Array(t.length),yr=new Rr,xr=new Rr;;)if(r=wr,s&&(!r||s.y<r.y||s.y===r.y&&s.x<r.x))s.x===i&&s.y===n||(br[s.i]=new kr(s),Cr(s),i=s.x,n=s.y),s=t.pop();else{if(!r)break;jr(r.arc)}e&&(function(t){for(var e,i=vr,n=hn(t[0][0],t[0][1],t[1][0],t[1][1]),r=i.length;r--;)(!Hr(e=i[r],t)||!n(e)||E(e.a.x-e.b.x)<Ct&&E(e.a.y-e.b.y)<Ct)&&(e.a=e.b=null,i.splice(r,1))}(e),function(t){for(var e,i,n,r,s,a,o,l,h,c,u=t[0][0],d=t[1][0],p=t[0][1],f=t[1][1],m=br,g=m.length;g--;)if((s=m[g])&&s.prepare())for(l=(o=s.edges).length,a=0;a<l;)n=(c=o[a].end()).x,r=c.y,e=(h=o[++a%l].start()).x,i=h.y,(E(n-e)>Ct||E(r-i)>Ct)&&(o.splice(a,0,new Br((v=s.site,b=c,y=E(n-u)<Ct&&f-r>Ct?{x:u,y:E(e-u)<Ct?i:f}:E(r-f)<Ct&&d-n>Ct?{x:E(i-f)<Ct?e:d,y:f}:E(n-d)<Ct&&r-p>Ct?{x:d,y:E(e-d)<Ct?i:p}:E(r-p)<Ct&&n-u>Ct?{x:E(i-p)<Ct?e:u,y:p}:null,w=void 0,(w=new Dr(v,null)).a=b,w.b=y,vr.push(w),w),s.site,null)),++l);var v,b,y,w}(e));var a={cells:br,edges:vr};return yr=xr=vr=br=null,a}function Xr(t,e){return e.y-t.y||e.x-t.x}kr.prototype.prepare=function(){for(var t,e=this.edges,i=e.length;i--;)(t=e[i].edge).b&&t.a||e.splice(i,1);return e.sort(Tr),e.length},Br.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Rr.prototype={insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=qr(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)i===(n=i.U).L?(r=n.R)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&($r(this,i),i=(t=i).U),i.C=!1,n.C=!0,Fr(this,n)):(r=n.L)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(Fr(this,i),i=(t=i).U),i.C=!1,n.C=!0,$r(this,n)),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,i,n,r=t.U,s=t.L,a=t.R;if(i=s?a?qr(a):s:a,r?r.L===t?r.L=i:r.R=i:this._=i,s&&a?(n=i.C,i.C=t.C,i.L=s,s.U=i,i!==a?(r=i.U,i.U=t.U,t=i.R,r.L=t,i.R=a,a.U=i):(i.U=r,r=i,t=i.R)):(n=t.C,t=i),t&&(t.U=r),!n)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===r.L){if((e=r.R).C&&(e.C=!1,r.C=!0,$r(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,Fr(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,$r(this,r),t=this._;break}}else if((e=r.L).C&&(e.C=!1,r.C=!0,Fr(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,$r(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,Fr(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}},s.geom.voronoi=function(t){var e=hr,i=cr,n=e,r=i,s=Yr;if(t)return a(t);function a(t){var e=new Array(t.length),i=s[0][0],n=s[0][1],r=s[1][0],a=s[1][1];return Wr(o(t),s).cells.forEach((function(s,o){var l=s.edges,h=s.site;(e[o]=l.length?l.map((function(t){var e=t.start();return[e.x,e.y]})):h.x>=i&&h.x<=r&&h.y>=n&&h.y<=a?[[i,a],[r,a],[r,n],[i,n]]:[]).point=t[o]})),e}function o(t){return t.map((function(t,e){return{x:Math.round(n(t,e)/Ct)*Ct,y:Math.round(r(t,e)/Ct)*Ct,i:e}}))}return a.links=function(t){return Wr(o(t)).edges.filter((function(t){return t.l&&t.r})).map((function(e){return{source:t[e.l.i],target:t[e.r.i]}}))},a.triangles=function(t){var e=[];return Wr(o(t)).cells.forEach((function(i,n){for(var r,s,a,o,l=i.site,h=i.edges.sort(Tr),c=-1,u=h.length,d=h[u-1].edge,p=d.l===l?d.r:d.l;++c<u;)r=p,p=(d=h[c].edge).l===l?d.r:d.l,n<r.i&&n<p.i&&(a=r,o=p,((s=l).x-o.x)*(a.y-s.y)-(s.x-a.x)*(o.y-s.y)<0)&&e.push([t[n],t[r.i],t[p.i]])})),e},a.x=function(t){return arguments.length?(n=we(e=t),a):e},a.y=function(t){return arguments.length?(r=we(i=t),a):i},a.clipExtent=function(t){return arguments.length?(s=null==t?Yr:t,a):s===Yr?null:s},a.size=function(t){return arguments.length?a.clipExtent(t&&[[0,0],t]):s===Yr?null:s&&s[1]},a};var Yr=[[-1e6,-1e6],[1e6,1e6]];function Zr(t){return t.x}function Gr(t){return t.y}function Jr(t,e,i,n,r,s){if(!t(e,i,n,r,s)){var a=.5*(i+r),o=.5*(n+s),l=e.nodes;l[0]&&Jr(t,l[0],i,n,a,o),l[1]&&Jr(t,l[1],a,n,r,o),l[2]&&Jr(t,l[2],i,o,a,s),l[3]&&Jr(t,l[3],a,o,r,s)}}function Kr(t,e,i,n,r,s,a){var o,l=1/0;return function t(h,c,u,d,p){if(!(c>s||u>a||d<n||p<r)){if(f=h.point){var f,m=e-h.x,g=i-h.y,v=m*m+g*g;if(v<l){var b=Math.sqrt(l=v);n=e-b,r=i-b,s=e+b,a=i+b,o=f}}for(var y=h.nodes,w=.5*(c+d),x=.5*(u+p),E=(i>=x)<<1|e>=w,A=E+4;E<A;++E)if(h=y[3&E])switch(3&E){case 0:t(h,c,u,w,x);break;case 1:t(h,w,u,d,x);break;case 2:t(h,c,x,w,p);break;case 3:t(h,w,x,d,p)}}}(t,n,r,s,a),o}function Qr(t,e){t=s.rgb(t),e=s.rgb(e);var i=t.r,n=t.g,r=t.b,a=e.r-i,o=e.g-n,l=e.b-r;return function(t){return"#"+pe(Math.round(i+a*t))+pe(Math.round(n+o*t))+pe(Math.round(r+l*t))}}function ts(t,e){var i,n={},r={};for(i in t)i in e?n[i]=ss(t[i],e[i]):r[i]=t[i];for(i in e)i in t||(r[i]=e[i]);return function(t){for(i in n)r[i]=n[i](t);return r}}function es(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function is(t,e){var i,n,r,s=ns.lastIndex=rs.lastIndex=0,a=-1,o=[],l=[];for(t+="",e+="";(i=ns.exec(t))&&(n=rs.exec(e));)(r=n.index)>s&&(r=e.slice(s,r),o[a]?o[a]+=r:o[++a]=r),(i=i[0])===(n=n[0])?o[a]?o[a]+=n:o[++a]=n:(o[++a]=null,l.push({i:a,x:es(i,n)})),s=rs.lastIndex;return s<e.length&&(r=e.slice(s),o[a]?o[a]+=r:o[++a]=r),o.length<2?l[0]?(e=l[0].x,function(t){return e(t)+""}):function(){return e}:(e=l.length,function(t){for(var i,n=0;n<e;++n)o[(i=l[n]).i]=i.x(t);return o.join("")})}s.geom.delaunay=function(t){return s.geom.voronoi().triangles(t)},s.geom.quadtree=function(t,e,i,n,r){var s,a=hr,o=cr;if(s=arguments.length)return a=Zr,o=Gr,3===s&&(r=i,n=e,i=e=0),l(t);function l(t){var l,h,c,u,d,p,f,m,g,v=we(a),b=we(o);if(null!=e)p=e,f=i,m=n,g=r;else if(m=g=-(p=f=1/0),h=[],c=[],d=t.length,s)for(u=0;u<d;++u)(l=t[u]).x<p&&(p=l.x),l.y<f&&(f=l.y),l.x>m&&(m=l.x),l.y>g&&(g=l.y),h.push(l.x),c.push(l.y);else for(u=0;u<d;++u){var y=+v(l=t[u],u),w=+b(l,u);y<p&&(p=y),w<f&&(f=w),y>m&&(m=y),w>g&&(g=w),h.push(y),c.push(w)}var x=m-p,A=g-f;function N(t,e,i,n,r,s,a,o){if(!isNaN(i)&&!isNaN(n))if(t.leaf){var l=t.x,h=t.y;if(null!=l)if(E(l-i)+E(h-n)<.01)O(t,e,i,n,r,s,a,o);else{var c=t.point;t.x=t.y=t.point=null,O(t,c,l,h,r,s,a,o),O(t,e,i,n,r,s,a,o)}else t.x=i,t.y=n,t.point=e}else O(t,e,i,n,r,s,a,o)}function O(t,e,i,n,r,s,a,o){var l=.5*(r+a),h=.5*(s+o),c=i>=l,u=n>=h,d=u<<1|c;t.leaf=!1,c?r=l:a=l,u?s=h:o=h,N(t=t.nodes[d]||(t.nodes[d]={leaf:!0,nodes:[],point:null,x:null,y:null}),e,i,n,r,s,a,o)}x>A?g=f+x:m=p+A;var M={leaf:!0,nodes:[],point:null,x:null,y:null,add:function(t){N(M,t,+v(t,++u),+b(t,u),p,f,m,g)},visit:function(t){Jr(t,M,p,f,m,g)},find:function(t){return Kr(M,t[0],t[1],p,f,m,g)}};if(u=-1,null==e){for(;++u<d;)N(M,t[u],h[u],c[u],p,f,m,g);--u}else t.forEach(M.add);return h=c=t=l=null,M}return l.x=function(t){return arguments.length?(a=t,l):a},l.y=function(t){return arguments.length?(o=t,l):o},l.extent=function(t){return arguments.length?(null==t?e=i=n=r=null:(e=+t[0][0],i=+t[0][1],n=+t[1][0],r=+t[1][1]),l):null==e?null:[[e,i],[n,r]]},l.size=function(t){return arguments.length?(null==t?e=i=n=r=null:(e=i=0,n=+t[0],r=+t[1]),l):null==e?null:[n-e,r-i]},l},s.interpolateRgb=Qr,s.interpolateObject=ts,s.interpolateNumber=es,s.interpolateString=is;var ns=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,rs=new RegExp(ns.source,"g");function ss(t,e){for(var i,n=s.interpolators.length;--n>=0&&!(i=s.interpolators[n](t,e)););return i}function as(t,e){var i,n=[],r=[],s=t.length,a=e.length,o=Math.min(t.length,e.length);for(i=0;i<o;++i)n.push(ss(t[i],e[i]));for(;i<s;++i)r[i]=t[i];for(;i<a;++i)r[i]=e[i];return function(t){for(i=0;i<o;++i)r[i]=n[i](t);return r}}s.interpolate=ss,s.interpolators=[function(t,e){var i=typeof e;return("string"===i?ye.has(e.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(e)?Qr:is:e instanceof Wt?Qr:Array.isArray(e)?as:"object"===i&&isNaN(e)?ts:es)(t,e)}],s.interpolateArray=as;var os=function(){return I},ls=s.map({linear:os,poly:function(t){return function(e){return Math.pow(e,t)}},quad:function(){return ps},cubic:function(){return fs},sin:function(){return gs},exp:function(){return vs},circle:function(){return bs},elastic:function(t,e){var i;return arguments.length<2&&(e=.45),arguments.length?i=e/kt*Math.asin(1/t):(t=1,i=e/4),function(n){return 1+t*Math.pow(2,-10*n)*Math.sin((n-i)*kt/e)}},back:function(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}},bounce:function(){return ys}}),hs=s.map({in:I,out:us,"in-out":ds,"out-in":function(t){return ds(us(t))}});function cs(t){return function(e){return e<=0?0:e>=1?1:t(e)}}function us(t){return function(e){return 1-t(1-e)}}function ds(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function ps(t){return t*t}function fs(t){return t*t*t}function ms(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function gs(t){return 1-Math.cos(t*Ut)}function vs(t){return Math.pow(2,10*(t-1))}function bs(t){return 1-Math.sqrt(1-t*t)}function ys(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function ws(t,e){return e-=t,function(i){return Math.round(t+e*i)}}function xs(t){var e,i,n,r=[t.a,t.b],s=[t.c,t.d],a=As(r),o=Es(r,s),l=As(((e=s)[0]+=(n=-o)*(i=r)[0],e[1]+=n*i[1],e))||0;r[0]*s[1]<s[0]*r[1]&&(r[0]*=-1,r[1]*=-1,a*=-1,o*=-1),this.rotate=(a?Math.atan2(r[1],r[0]):Math.atan2(-s[0],s[1]))*_t,this.translate=[t.e,t.f],this.scale=[a,l],this.skew=l?Math.atan2(o,l)*_t:0}function Es(t,e){return t[0]*e[0]+t[1]*e[1]}function As(t){var e=Math.sqrt(Es(t,t));return e&&(t[0]/=e,t[1]/=e),e}s.ease=function(t){var e=t.indexOf("-"),i=e>=0?t.slice(0,e):t,n=e>=0?t.slice(e+1):"in";return i=ls.get(i)||os,cs((n=hs.get(n)||I)(i.apply(null,a.call(arguments,1))))},s.interpolateHcl=function(t,e){t=s.hcl(t),e=s.hcl(e);var i=t.h,n=t.c,r=t.l,a=e.h-i,o=e.c-n,l=e.l-r;return isNaN(o)&&(o=0,n=isNaN(n)?e.c:n),isNaN(a)?(a=0,i=isNaN(i)?e.h:i):a>180?a-=360:a<-180&&(a+=360),function(t){return Kt(i+a*t,n+o*t,r+l*t)+""}},s.interpolateHsl=function(t,e){t=s.hsl(t),e=s.hsl(e);var i=t.h,n=t.s,r=t.l,a=e.h-i,o=e.s-n,l=e.l-r;return isNaN(o)&&(o=0,n=isNaN(n)?e.s:n),isNaN(a)?(a=0,i=isNaN(i)?e.h:i):a>180?a-=360:a<-180&&(a+=360),function(t){return Zt(i+a*t,n+o*t,r+l*t)+""}},s.interpolateLab=function(t,e){t=s.lab(t),e=s.lab(e);var i=t.l,n=t.a,r=t.b,a=e.l-i,o=e.a-n,l=e.b-r;return function(t){return re(i+a*t,n+o*t,r+l*t)+""}},s.interpolateRound=ws,s.transform=function(t){var e=l.createElementNS(s.ns.prefix.svg,"g");return(s.transform=function(t){if(null!=t){e.setAttribute("transform",t);var i=e.transform.baseVal.consolidate()}return new xs(i?i.matrix:Ns)})(t)},xs.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var Ns={a:1,b:0,c:0,d:1,e:0,f:0};function Os(t){return t.length?t.pop()+",":""}function Ms(t,e){var i=[],n=[];return t=s.transform(t),e=s.transform(e),function(t,e,i,n){if(t[0]!==e[0]||t[1]!==e[1]){var r=i.push("translate(",null,",",null,")");n.push({i:r-4,x:es(t[0],e[0])},{i:r-2,x:es(t[1],e[1])})}else(e[0]||e[1])&&i.push("translate("+e+")")}(t.translate,e.translate,i,n),function(t,e,i,n){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),n.push({i:i.push(Os(i)+"rotate(",null,")")-2,x:es(t,e)})):e&&i.push(Os(i)+"rotate("+e+")")}(t.rotate,e.rotate,i,n),function(t,e,i,n){t!==e?n.push({i:i.push(Os(i)+"skewX(",null,")")-2,x:es(t,e)}):e&&i.push(Os(i)+"skewX("+e+")")}(t.skew,e.skew,i,n),function(t,e,i,n){if(t[0]!==e[0]||t[1]!==e[1]){var r=i.push(Os(i)+"scale(",null,",",null,")");n.push({i:r-4,x:es(t[0],e[0])},{i:r-2,x:es(t[1],e[1])})}else 1===e[0]&&1===e[1]||i.push(Os(i)+"scale("+e+")")}(t.scale,e.scale,i,n),t=e=null,function(t){for(var e,r=-1,s=n.length;++r<s;)i[(e=n[r]).i]=e.x(t);return i.join("")}}function js(t,e){return e=(e-=t=+t)||1/e,function(i){return(i-t)/e}}function Cs(t,e){return e=(e-=t=+t)||1/e,function(i){return Math.max(0,Math.min(1,(i-t)/e))}}function Ls(t){for(var e=t.source,i=t.target,n=function(t,e){if(t===e)return t;for(var i=Ss(t),n=Ss(e),r=i.pop(),s=n.pop(),a=null;r===s;)a=r,r=i.pop(),s=n.pop();return a}(e,i),r=[e];e!==n;)e=e.parent,r.push(e);for(var s=r.length;i!==n;)r.splice(s,0,i),i=i.parent;return r}function Ss(t){for(var e=[],i=t.parent;null!=i;)e.push(t),t=i,i=i.parent;return e.push(t),e}function ks(t){t.fixed|=2}function Ts(t){t.fixed&=-7}function Us(t){t.fixed|=4,t.px=t.x,t.py=t.y}function Is(t){t.fixed&=-5}function _s(t,e,i){var n=0,r=0;if(t.charge=0,!t.leaf)for(var s,a=t.nodes,o=a.length,l=-1;++l<o;)null!=(s=a[l])&&(_s(s,e,i),t.charge+=s.charge,n+=s.charge*s.cx,r+=s.charge*s.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var h=e*i[t.point.index];t.charge+=t.pointCharge=h,n+=h*t.point.x,r+=h*t.point.y}t.cx=n/t.charge,t.cy=r/t.charge}s.interpolateTransform=Ms,s.layout={},s.layout.bundle=function(){return function(t){for(var e=[],i=-1,n=t.length;++i<n;)e.push(Ls(t[i]));return e}},s.layout.chord=function(){var t,e,i,n,r,a,o,l={},h=0;function c(){var l,c,d,p,f,m={},g=[],v=s.range(n),b=[];for(t=[],e=[],l=0,p=-1;++p<n;){for(c=0,f=-1;++f<n;)c+=i[p][f];g.push(c),b.push(s.range(n)),l+=c}for(r&&v.sort((function(t,e){return r(g[t],g[e])})),a&&b.forEach((function(t,e){t.sort((function(t,n){return a(i[e][t],i[e][n])}))})),l=(kt-h*n)/l,c=0,p=-1;++p<n;){for(d=c,f=-1;++f<n;){var y=v[p],w=b[y][f],x=i[y][w],E=c,A=c+=x*l;m[y+"-"+w]={index:y,subindex:w,startAngle:E,endAngle:A,value:x}}e[y]={index:y,startAngle:d,endAngle:c,value:g[y]},c+=h}for(p=-1;++p<n;)for(f=p-1;++f<n;){var N=m[p+"-"+f],O=m[f+"-"+p];(N.value||O.value)&&t.push(N.value<O.value?{source:O,target:N}:{source:N,target:O})}o&&u()}function u(){t.sort((function(t,e){return o((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)}))}return l.matrix=function(r){return arguments.length?(n=(i=r)&&i.length,t=e=null,l):i},l.padding=function(i){return arguments.length?(h=i,t=e=null,l):h},l.sortGroups=function(i){return arguments.length?(r=i,t=e=null,l):r},l.sortSubgroups=function(e){return arguments.length?(a=e,t=null,l):a},l.sortChords=function(e){return arguments.length?(o=e,t&&u(),l):o},l.chords=function(){return t||c(),t},l.groups=function(){return e||c(),e},l},s.layout.force=function(){var t,e,i,n,r,a,o={},l=s.dispatch("start","tick","end"),h=[1,1],c=.9,u=Hs,d=Ds,p=-30,f=Ps,m=.1,g=.64,v=[],b=[];function y(t){return function(e,i,n,r){if(e.point!==t){var s=e.cx-t.x,a=e.cy-t.y,o=r-i,l=s*s+a*a;if(o*o/g<l){if(l<f){var h=e.charge/l;t.px-=s*h,t.py-=a*h}return!0}e.point&&l&&l<f&&(h=e.pointCharge/l,t.px-=s*h,t.py-=a*h)}return!e.charge}}function w(t){t.px=s.event.x,t.py=s.event.y,o.resume()}return o.tick=function(){if((i*=.99)<.005)return t=null,l.end({type:"end",alpha:i=0}),!0;var e,o,u,d,f,g,w,x,E,A=v.length,N=b.length;for(o=0;o<N;++o)d=(u=b[o]).source,(g=(x=(f=u.target).x-d.x)*x+(E=f.y-d.y)*E)&&(x*=g=i*r[o]*((g=Math.sqrt(g))-n[o])/g,E*=g,f.x-=x*(w=d.weight+f.weight?d.weight/(d.weight+f.weight):.5),f.y-=E*w,d.x+=x*(w=1-w),d.y+=E*w);if((w=i*m)&&(x=h[0]/2,E=h[1]/2,o=-1,w))for(;++o<A;)(u=v[o]).x+=(x-u.x)*w,u.y+=(E-u.y)*w;if(p)for(_s(e=s.geom.quadtree(v),i,a),o=-1;++o<A;)(u=v[o]).fixed||e.visit(y(u));for(o=-1;++o<A;)(u=v[o]).fixed?(u.x=u.px,u.y=u.py):(u.x-=(u.px-(u.px=u.x))*c,u.y-=(u.py-(u.py=u.y))*c);l.tick({type:"tick",alpha:i})},o.nodes=function(t){return arguments.length?(v=t,o):v},o.links=function(t){return arguments.length?(b=t,o):b},o.size=function(t){return arguments.length?(h=t,o):h},o.linkDistance=function(t){return arguments.length?(u="function"==typeof t?t:+t,o):u},o.distance=o.linkDistance,o.linkStrength=function(t){return arguments.length?(d="function"==typeof t?t:+t,o):d},o.friction=function(t){return arguments.length?(c=+t,o):c},o.charge=function(t){return arguments.length?(p="function"==typeof t?t:+t,o):p},o.chargeDistance=function(t){return arguments.length?(f=t*t,o):Math.sqrt(f)},o.gravity=function(t){return arguments.length?(m=+t,o):m},o.theta=function(t){return arguments.length?(g=t*t,o):Math.sqrt(g)},o.alpha=function(e){return arguments.length?(e=+e,i?e>0?i=e:(t.c=null,t.t=NaN,t=null,l.end({type:"end",alpha:i=0})):e>0&&(l.start({type:"start",alpha:i=e}),t=Ce(o.tick)),o):i},o.start=function(){var t,e,i,s=v.length,l=b.length,c=h[0],f=h[1];for(t=0;t<s;++t)(i=v[t]).index=t,i.weight=0;for(t=0;t<l;++t)"number"==typeof(i=b[t]).source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(t=0;t<s;++t)i=v[t],isNaN(i.x)&&(i.x=m("x",c)),isNaN(i.y)&&(i.y=m("y",f)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(n=[],"function"==typeof u)for(t=0;t<l;++t)n[t]=+u.call(this,b[t],t);else for(t=0;t<l;++t)n[t]=u;if(r=[],"function"==typeof d)for(t=0;t<l;++t)r[t]=+d.call(this,b[t],t);else for(t=0;t<l;++t)r[t]=d;if(a=[],"function"==typeof p)for(t=0;t<s;++t)a[t]=+p.call(this,v[t],t);else for(t=0;t<s;++t)a[t]=p;function m(i,n){if(!e){for(e=new Array(s),h=0;h<s;++h)e[h]=[];for(h=0;h<l;++h){var r=b[h];e[r.source.index].push(r.target),e[r.target.index].push(r.source)}}for(var a,o=e[t],h=-1,c=o.length;++h<c;)if(!isNaN(a=o[h][i]))return a;return Math.random()*n}return o.resume()},o.resume=function(){return o.alpha(.1)},o.stop=function(){return o.alpha(0)},o.drag=function(){if(e||(e=s.behavior.drag().origin(I).on("dragstart.force",ks).on("drag.force",w).on("dragend.force",Ts)),!arguments.length)return e;this.on("mouseover.force",Us).on("mouseout.force",Is).call(e)},s.rebind(o,l,"on")};var Hs=20,Ds=1,Ps=1/0;function Vs(t,e){return s.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=qs,t}function Bs(t,e){for(var i=[t];null!=(t=i.pop());)if(e(t),(r=t.children)&&(n=r.length))for(var n,r;--n>=0;)i.push(r[n])}function Rs(t,e){for(var i=[t],n=[];null!=(t=i.pop());)if(n.push(t),(s=t.children)&&(r=s.length))for(var r,s,a=-1;++a<r;)i.push(s[a]);for(;null!=(t=n.pop());)e(t)}function zs(t){return t.children}function $s(t){return t.value}function Fs(t,e){return e.value-t.value}function qs(t){return s.merge(t.map((function(t){return(t.children||[]).map((function(e){return{source:t,target:e}}))})))}s.layout.hierarchy=function(){var t=Fs,e=zs,i=$s;function n(r){var s,a=[r],o=[];for(r.depth=0;null!=(s=a.pop());)if(o.push(s),(h=e.call(n,s,s.depth))&&(l=h.length)){for(var l,h,c;--l>=0;)a.push(c=h[l]),c.parent=s,c.depth=s.depth+1;i&&(s.value=0),s.children=h}else i&&(s.value=+i.call(n,s,s.depth)||0),delete s.children;return Rs(r,(function(e){var n,r;t&&(n=e.children)&&n.sort(t),i&&(r=e.parent)&&(r.value+=e.value)})),o}return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(i=t,n):i},n.revalue=function(t){return i&&(Bs(t,(function(t){t.children&&(t.value=0)})),Rs(t,(function(t){var e;t.children||(t.value=+i.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)}))),t},n},s.layout.partition=function(){var t=s.layout.hierarchy(),e=[1,1];function i(t,e,n,r){var s=t.children;if(t.x=e,t.y=t.depth*r,t.dx=n,t.dy=r,s&&(a=s.length)){var a,o,l,h=-1;for(n=t.value?n/t.value:0;++h<a;)i(o=s[h],e,l=o.value*n,r),e+=l}}function n(t){var e=t.children,i=0;if(e&&(r=e.length))for(var r,s=-1;++s<r;)i=Math.max(i,n(e[s]));return 1+i}function r(r,s){var a=t.call(this,r,s);return i(a[0],0,e[0],e[1]/n(a[0])),a}return r.size=function(t){return arguments.length?(e=t,r):e},Vs(r,t)},s.layout.pie=function(){var t=Number,e=Ws,i=0,n=kt,r=0;function a(o){var l,h=o.length,c=o.map((function(e,i){return+t.call(a,e,i)})),u=+("function"==typeof i?i.apply(this,arguments):i),d=("function"==typeof n?n.apply(this,arguments):n)-u,p=Math.min(Math.abs(d)/h,+("function"==typeof r?r.apply(this,arguments):r)),f=p*(d<0?-1:1),m=s.sum(c),g=m?(d-h*f)/m:0,v=s.range(h),b=[];return null!=e&&v.sort(e===Ws?function(t,e){return c[e]-c[t]}:function(t,i){return e(o[t],o[i])}),v.forEach((function(t){b[t]={data:o[t],value:l=c[t],startAngle:u,endAngle:u+=l*g+f,padAngle:p}})),b}return a.value=function(e){return arguments.length?(t=e,a):t},a.sort=function(t){return arguments.length?(e=t,a):e},a.startAngle=function(t){return arguments.length?(i=t,a):i},a.endAngle=function(t){return arguments.length?(n=t,a):n},a.padAngle=function(t){return arguments.length?(r=t,a):r},a};var Ws={};function Xs(t){return t.x}function Ys(t){return t.y}function Zs(t,e,i){t.y0=e,t.y=i}s.layout.stack=function(){var t=I,e=Ks,i=Qs,n=Zs,r=Xs,a=Ys;function o(l,h){if(!(p=l.length))return l;var c=l.map((function(e,i){return t.call(o,e,i)})),u=c.map((function(t){return t.map((function(t,e){return[r.call(o,t,e),a.call(o,t,e)]}))})),d=e.call(o,u,h);c=s.permute(c,d),u=s.permute(u,d);var p,f,m,g,v=i.call(o,u,h),b=c[0].length;for(m=0;m<b;++m)for(n.call(o,c[0][m],g=v[m],u[0][m][1]),f=1;f<p;++f)n.call(o,c[f][m],g+=u[f-1][m][1],u[f][m][1]);return l}return o.values=function(e){return arguments.length?(t=e,o):t},o.order=function(t){return arguments.length?(e="function"==typeof t?t:Gs.get(t)||Ks,o):e},o.offset=function(t){return arguments.length?(i="function"==typeof t?t:Js.get(t)||Qs,o):i},o.x=function(t){return arguments.length?(r=t,o):r},o.y=function(t){return arguments.length?(a=t,o):a},o.out=function(t){return arguments.length?(n=t,o):n},o};var Gs=s.map({"inside-out":function(t){var e,i,n=t.length,r=t.map(ta),a=t.map(ea),o=s.range(n).sort((function(t,e){return r[t]-r[e]})),l=0,h=0,c=[],u=[];for(e=0;e<n;++e)i=o[e],l<h?(l+=a[i],c.push(i)):(h+=a[i],u.push(i));return u.reverse().concat(c)},reverse:function(t){return s.range(t.length).reverse()},default:Ks}),Js=s.map({silhouette:function(t){var e,i,n,r=t.length,s=t[0].length,a=[],o=0,l=[];for(i=0;i<s;++i){for(e=0,n=0;e<r;e++)n+=t[e][i][1];n>o&&(o=n),a.push(n)}for(i=0;i<s;++i)l[i]=(o-a[i])/2;return l},wiggle:function(t){var e,i,n,r,s,a,o,l,h,c=t.length,u=t[0],d=u.length,p=[];for(p[0]=l=h=0,i=1;i<d;++i){for(e=0,r=0;e<c;++e)r+=t[e][i][1];for(e=0,s=0,o=u[i][0]-u[i-1][0];e<c;++e){for(n=0,a=(t[e][i][1]-t[e][i-1][1])/(2*o);n<e;++n)a+=(t[n][i][1]-t[n][i-1][1])/o;s+=a*t[e][i][1]}p[i]=l-=r?s/r*o:0,l<h&&(h=l)}for(i=0;i<d;++i)p[i]-=h;return p},expand:function(t){var e,i,n,r=t.length,s=t[0].length,a=1/r,o=[];for(i=0;i<s;++i){for(e=0,n=0;e<r;e++)n+=t[e][i][1];if(n)for(e=0;e<r;e++)t[e][i][1]/=n;else for(e=0;e<r;e++)t[e][i][1]=a}for(i=0;i<s;++i)o[i]=0;return o},zero:Qs});function Ks(t){return s.range(t.length)}function Qs(t){for(var e=-1,i=t[0].length,n=[];++e<i;)n[e]=0;return n}function ta(t){for(var e,i=1,n=0,r=t[0][1],s=t.length;i<s;++i)(e=t[i][1])>r&&(n=i,r=e);return n}function ea(t){return t.reduce(ia,0)}function ia(t,e){return t+e[1]}function na(t,e){return ra(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function ra(t,e){for(var i=-1,n=+t[0],r=(t[1]-n)/e,s=[];++i<=e;)s[i]=r*i+n;return s}function sa(t){return[s.min(t),s.max(t)]}function aa(t,e){return t.value-e.value}function oa(t,e){var i=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=i,i._pack_prev=e}function la(t,e){t._pack_next=e,e._pack_prev=t}function ha(t,e){var i=e.x-t.x,n=e.y-t.y,r=t.r+e.r;return.999*r*r>i*i+n*n}function ca(t){if((e=t.children)&&(l=e.length)){var e,i,n,r,s,a,o,l,h=1/0,c=-1/0,u=1/0,d=-1/0;if(e.forEach(ua),(i=e[0]).x=-i.r,i.y=0,y(i),l>1&&((n=e[1]).x=n.r,n.y=0,y(n),l>2))for(fa(i,n,r=e[2]),y(r),oa(i,r),i._pack_prev=r,oa(r,n),n=i._pack_next,s=3;s<l;s++){fa(i,n,r=e[s]);var p=0,f=1,m=1;for(a=n._pack_next;a!==n;a=a._pack_next,f++)if(ha(a,r)){p=1;break}if(1==p)for(o=i._pack_prev;o!==a._pack_prev&&!ha(o,r);o=o._pack_prev,m++);p?(f<m||f==m&&n.r<i.r?la(i,n=a):la(i=o,n),s--):(oa(i,r),n=r,y(r))}var g=(h+c)/2,v=(u+d)/2,b=0;for(s=0;s<l;s++)(r=e[s]).x-=g,r.y-=v,b=Math.max(b,r.r+Math.sqrt(r.x*r.x+r.y*r.y));t.r=b,e.forEach(da)}function y(t){h=Math.min(t.x-t.r,h),c=Math.max(t.x+t.r,c),u=Math.min(t.y-t.r,u),d=Math.max(t.y+t.r,d)}}function ua(t){t._pack_next=t._pack_prev=t}function da(t){delete t._pack_next,delete t._pack_prev}function pa(t,e,i,n){var r=t.children;if(t.x=e+=n*t.x,t.y=i+=n*t.y,t.r*=n,r)for(var s=-1,a=r.length;++s<a;)pa(r[s],e,i,n)}function fa(t,e,i){var n=t.r+i.r,r=e.x-t.x,s=e.y-t.y;if(n&&(r||s)){var a=e.r+i.r,o=r*r+s*s,l=.5+((n*=n)-(a*=a))/(2*o),h=Math.sqrt(Math.max(0,2*a*(n+o)-(n-=o)*n-a*a))/(2*o);i.x=t.x+l*r+h*s,i.y=t.y+l*s-h*r}else i.x=t.x+n,i.y=t.y}function ma(t,e){return t.parent==e.parent?1:2}function ga(t){var e=t.children;return e.length?e[0]:t.t}function va(t){var e,i=t.children;return(e=i.length)?i[e-1]:t.t}function ba(t,e,i){var n=i/(e.i-t.i);e.c-=n,e.s+=i,t.c+=n,e.z+=i,e.m+=i}function ya(t,e,i){return t.a.parent===e.parent?t.a:i}function wa(t){var e=t.children;return e&&e.length?wa(e[0]):t}function xa(t){var e,i=t.children;return i&&(e=i.length)?xa(i[e-1]):t}function Ea(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Aa(t,e){var i=t.x+e[3],n=t.y+e[0],r=t.dx-e[1]-e[3],s=t.dy-e[0]-e[2];return r<0&&(i+=r/2,r=0),s<0&&(n+=s/2,s=0),{x:i,y:n,dx:r,dy:s}}function Na(t){var e=t[0],i=t[t.length-1];return e<i?[e,i]:[i,e]}function Oa(t){return t.rangeExtent?t.rangeExtent():Na(t.range())}function Ma(t,e,i,n){var r=i(t[0],t[1]),s=n(e[0],e[1]);return function(t){return s(r(t))}}function ja(t,e){var i,n=0,r=t.length-1,s=t[n],a=t[r];return a<s&&(i=n,n=r,r=i,i=s,s=a,a=i),t[n]=e.floor(s),t[r]=e.ceil(a),t}function Ca(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:La}s.layout.histogram=function(){var t=!0,e=Number,i=sa,n=na;function r(r,a){for(var o,l,h=[],c=r.map(e,this),u=i.call(this,c,a),d=n.call(this,u,c,a),p=(a=-1,c.length),f=d.length-1,m=t?1:1/p;++a<f;)(o=h[a]=[]).dx=d[a+1]-(o.x=d[a]),o.y=0;if(f>0)for(a=-1;++a<p;)(l=c[a])>=u[0]&&l<=u[1]&&((o=h[s.bisect(d,l,1,f)-1]).y+=m,o.push(r[a]));return h}return r.value=function(t){return arguments.length?(e=t,r):e},r.range=function(t){return arguments.length?(i=we(t),r):i},r.bins=function(t){return arguments.length?(n="number"==typeof t?function(e){return ra(e,t)}:we(t),r):n},r.frequency=function(e){return arguments.length?(t=!!e,r):t},r},s.layout.pack=function(){var t,e=s.layout.hierarchy().sort(aa),i=0,n=[1,1];function r(r,s){var a=e.call(this,r,s),o=a[0],l=n[0],h=n[1],c=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(o.x=o.y=0,Rs(o,(function(t){t.r=+c(t.value)})),Rs(o,ca),i){var u=i*(t?1:Math.max(2*o.r/l,2*o.r/h))/2;Rs(o,(function(t){t.r+=u})),Rs(o,ca),Rs(o,(function(t){t.r-=u}))}return pa(o,l/2,h/2,t?1:1/Math.max(2*o.r/l,2*o.r/h)),a}return r.size=function(t){return arguments.length?(n=t,r):n},r.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,r):t},r.padding=function(t){return arguments.length?(i=+t,r):i},Vs(r,e)},s.layout.tree=function(){var t=s.layout.hierarchy().sort(null).value(null),e=ma,i=[1,1],n=null;function r(r,s){var h=t.call(this,r,s),c=h[0],u=function(t){for(var e,i={A:null,children:[t]},n=[i];null!=(e=n.pop());)for(var r,s=e.children,a=0,o=s.length;a<o;++a)n.push((s[a]=r={_:s[a],parent:e,children:(r=s[a].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:a}).a=r);return i.children[0]}(c);if(Rs(u,a),u.parent.m=-u.z,Bs(u,o),n)Bs(c,l);else{var d=c,p=c,f=c;Bs(c,(function(t){t.x<d.x&&(d=t),t.x>p.x&&(p=t),t.depth>f.depth&&(f=t)}));var m=e(d,p)/2-d.x,g=i[0]/(p.x+e(p,d)/2+m),v=i[1]/(f.depth||1);Bs(c,(function(t){t.x=(t.x+m)*g,t.y=t.depth*v}))}return h}function a(t){var i=t.children,n=t.parent.children,r=t.i?n[t.i-1]:null;if(i.length){!function(t){for(var e,i=0,n=0,r=t.children,s=r.length;--s>=0;)(e=r[s]).z+=i,e.m+=i,i+=e.s+(n+=e.c)}(t);var s=(i[0].z+i[i.length-1].z)/2;r?(t.z=r.z+e(t._,r._),t.m=t.z-s):t.z=s}else r&&(t.z=r.z+e(t._,r._));t.parent.A=function(t,i,n){if(i){for(var r,s=t,a=t,o=i,l=s.parent.children[0],h=s.m,c=a.m,u=o.m,d=l.m;o=va(o),s=ga(s),o&&s;)l=ga(l),(a=va(a)).a=t,(r=o.z+u-s.z-h+e(o._,s._))>0&&(ba(ya(o,t,n),t,r),h+=r,c+=r),u+=o.m,h+=s.m,d+=l.m,c+=a.m;o&&!va(a)&&(a.t=o,a.m+=u-c),s&&!ga(l)&&(l.t=s,l.m+=h-d,n=t)}return n}(t,r,t.parent.A||n[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function l(t){t.x*=i[0],t.y=t.depth*i[1]}return r.separation=function(t){return arguments.length?(e=t,r):e},r.size=function(t){return arguments.length?(n=null==(i=t)?l:null,r):n?null:i},r.nodeSize=function(t){return arguments.length?(n=null==(i=t)?null:l,r):n?i:null},Vs(r,t)},s.layout.cluster=function(){var t=s.layout.hierarchy().sort(null).value(null),e=ma,i=[1,1],n=!1;function r(r,a){var o,l=t.call(this,r,a),h=l[0],c=0;Rs(h,(function(t){var i=t.children;i&&i.length?(t.x=function(t){return t.reduce((function(t,e){return t+e.x}),0)/t.length}(i),t.y=function(t){return 1+s.max(t,(function(t){return t.y}))}(i)):(t.x=o?c+=e(t,o):0,t.y=0,o=t)}));var u=wa(h),d=xa(h),p=u.x-e(u,d)/2,f=d.x+e(d,u)/2;return Rs(h,n?function(t){t.x=(t.x-h.x)*i[0],t.y=(h.y-t.y)*i[1]}:function(t){t.x=(t.x-p)/(f-p)*i[0],t.y=(1-(h.y?t.y/h.y:1))*i[1]}),l}return r.separation=function(t){return arguments.length?(e=t,r):e},r.size=function(t){return arguments.length?(n=null==(i=t),r):n?null:i},r.nodeSize=function(t){return arguments.length?(n=null!=(i=t),r):n?i:null},Vs(r,t)},s.layout.treemap=function(){var t,e=s.layout.hierarchy(),i=Math.round,n=[1,1],r=null,a=Ea,o=!1,l="squarify",h=.5*(1+Math.sqrt(5));function c(t,e){for(var i,n,r=-1,s=t.length;++r<s;)n=(i=t[r]).value*(e<0?0:e),i.area=isNaN(n)||n<=0?0:n}function u(t){var e=t.children;if(e&&e.length){var i,n,r,s=a(t),o=[],h=e.slice(),d=1/0,m="slice"===l?s.dx:"dice"===l?s.dy:"slice-dice"===l?1&t.depth?s.dy:s.dx:Math.min(s.dx,s.dy);for(c(h,s.dx*s.dy/t.value),o.area=0;(r=h.length)>0;)o.push(i=h[r-1]),o.area+=i.area,"squarify"!==l||(n=p(o,m))<=d?(h.pop(),d=n):(o.area-=o.pop().area,f(o,m,s,!1),m=Math.min(s.dx,s.dy),o.length=o.area=0,d=1/0);o.length&&(f(o,m,s,!0),o.length=o.area=0),e.forEach(u)}}function d(t){var e=t.children;if(e&&e.length){var i,n=a(t),r=e.slice(),s=[];for(c(r,n.dx*n.dy/t.value),s.area=0;i=r.pop();)s.push(i),s.area+=i.area,null!=i.z&&(f(s,i.z?n.dx:n.dy,n,!r.length),s.length=s.area=0);e.forEach(d)}}function p(t,e){for(var i,n=t.area,r=0,s=1/0,a=-1,o=t.length;++a<o;)(i=t[a].area)&&(i<s&&(s=i),i>r&&(r=i));return e*=e,(n*=n)?Math.max(e*r*h/n,n/(e*s*h)):1/0}function f(t,e,n,r){var s,a=-1,o=t.length,l=n.x,h=n.y,c=e?i(t.area/e):0;if(e==n.dx){for((r||c>n.dy)&&(c=n.dy);++a<o;)(s=t[a]).x=l,s.y=h,s.dy=c,l+=s.dx=Math.min(n.x+n.dx-l,c?i(s.area/c):0);s.z=!0,s.dx+=n.x+n.dx-l,n.y+=c,n.dy-=c}else{for((r||c>n.dx)&&(c=n.dx);++a<o;)(s=t[a]).x=l,s.y=h,s.dx=c,h+=s.dy=Math.min(n.y+n.dy-h,c?i(s.area/c):0);s.z=!1,s.dy+=n.y+n.dy-h,n.x+=c,n.dx-=c}}function m(i){var r=t||e(i),s=r[0];return s.x=s.y=0,s.value?(s.dx=n[0],s.dy=n[1]):s.dx=s.dy=0,t&&e.revalue(s),c([s],s.dx*s.dy/s.value),(t?d:u)(s),o&&(t=r),r}return m.size=function(t){return arguments.length?(n=t,m):n},m.padding=function(t){if(!arguments.length)return r;function e(e){var i=t.call(m,e,e.depth);return null==i?Ea(e):Aa(e,"number"==typeof i?[i,i,i,i]:i)}function i(e){return Aa(e,t)}var n;return a=null==(r=t)?Ea:"function"==(n=typeof t)?e:"number"===n?(t=[t,t,t,t],i):i,m},m.round=function(t){return arguments.length?(i=t?Math.round:Number,m):i!=Number},m.sticky=function(e){return arguments.length?(o=e,t=null,m):o},m.ratio=function(t){return arguments.length?(h=t,m):h},m.mode=function(t){return arguments.length?(l=t+"",m):l},Vs(m,e)},s.random={normal:function(t,e){var i=arguments.length;return i<2&&(e=1),i<1&&(t=0),function(){var i,n,r;do{r=(i=2*Math.random()-1)*i+(n=2*Math.random()-1)*n}while(!r||r>1);return t+e*i*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var t=s.random.normal.apply(s,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=s.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,i=0;i<t;i++)e+=Math.random();return e}}},s.scale={};var La={floor:I,ceil:I};function Sa(t,e,i,n){var r=[],a=[],o=0,l=Math.min(t.length,e.length)-1;for(t[l]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<=l;)r.push(i(t[o-1],t[o])),a.push(n(e[o-1],e[o]));return function(e){var i=s.bisect(t,e,1,l)-1;return a[i](r[i](e))}}function ka(t,e,i,n){var r,s;function a(){var a=Math.min(t.length,e.length)>2?Sa:Ma,l=n?Cs:js;return r=a(t,e,l,i),s=a(e,t,l,ss),o}function o(t){return r(t)}return o.invert=function(t){return s(t)},o.domain=function(e){return arguments.length?(t=e.map(Number),a()):t},o.range=function(t){return arguments.length?(e=t,a()):e},o.rangeRound=function(t){return o.range(t).interpolate(ws)},o.clamp=function(t){return arguments.length?(n=t,a()):n},o.interpolate=function(t){return arguments.length?(i=t,a()):i},o.ticks=function(e){return _a(t,e)},o.tickFormat=function(e,i){return Ha(t,e,i)},o.nice=function(e){return Ua(t,e),a()},o.copy=function(){return ka(t,e,i,n)},a()}function Ta(t,e){return s.rebind(t,e,"range","rangeRound","interpolate","clamp")}function Ua(t,e){return ja(t,Ca(Ia(t,e)[2])),ja(t,Ca(Ia(t,e)[2])),t}function Ia(t,e){null==e&&(e=10);var i=Na(t),n=i[1]-i[0],r=Math.pow(10,Math.floor(Math.log(n/e)/Math.LN10)),s=e/n*r;return s<=.15?r*=10:s<=.35?r*=5:s<=.75&&(r*=2),i[0]=Math.ceil(i[0]/r)*r,i[1]=Math.floor(i[1]/r)*r+.5*r,i[2]=r,i}function _a(t,e){return s.range.apply(s,Ia(t,e))}function Ha(t,e,i){var n=Ia(t,e);if(i){var r=_e.exec(i);if(r.shift(),"s"===r[8]){var a=s.formatPrefix(Math.max(E(n[0]),E(n[1])));return r[7]||(r[7]="."+Pa(a.scale(n[2]))),r[8]="f",i=s.format(r.join("")),function(t){return i(a.scale(t))+a.symbol}}r[7]||(r[7]="."+function(t,e){var i=Pa(e[2]);return t in Da?Math.abs(i-Pa(Math.max(E(e[0]),E(e[1]))))+ +("e"!==t):i-2*("%"===t)}(r[8],n)),i=r.join("")}else i=",."+Pa(n[2])+"f";return s.format(i)}s.scale.linear=function(){return ka([0,1],[0,1],ss,!1)};var Da={s:1,g:1,p:1,r:1,e:1};function Pa(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function Va(t,e,i,n){function r(t){return(i?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function a(t){return i?Math.pow(e,t):-Math.pow(e,-t)}function o(e){return t(r(e))}return o.invert=function(e){return a(t.invert(e))},o.domain=function(e){return arguments.length?(i=e[0]>=0,t.domain((n=e.map(Number)).map(r)),o):n},o.base=function(i){return arguments.length?(e=+i,t.domain(n.map(r)),o):e},o.nice=function(){var e=ja(n.map(r),i?Math:Ra);return t.domain(e),n=e.map(a),o},o.ticks=function(){var t=Na(n),s=[],o=t[0],l=t[1],h=Math.floor(r(o)),c=Math.ceil(r(l)),u=e%1?2:e;if(isFinite(c-h)){if(i){for(;h<c;h++)for(var d=1;d<u;d++)s.push(a(h)*d);s.push(a(h))}else for(s.push(a(h));h++<c;)for(d=u-1;d>0;d--)s.push(a(h)*d);for(h=0;s[h]<o;h++);for(c=s.length;s[c-1]>l;c--);s=s.slice(h,c)}return s},o.tickFormat=function(t,i){if(!arguments.length)return Ba;arguments.length<2?i=Ba:"function"!=typeof i&&(i=s.format(i));var n=Math.max(1,e*t/o.ticks().length);return function(t){var s=t/a(Math.round(r(t)));return s*e<e-.5&&(s*=e),s<=n?i(t):""}},o.copy=function(){return Va(t.copy(),e,i,n)},Ta(o,t)}s.scale.log=function(){return Va(s.scale.linear().domain([0,1]),10,!0,[1,10])};var Ba=s.format(".0e"),Ra={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};function za(t,e,i){var n=$a(e),r=$a(1/e);function s(e){return t(n(e))}return s.invert=function(e){return r(t.invert(e))},s.domain=function(e){return arguments.length?(t.domain((i=e.map(Number)).map(n)),s):i},s.ticks=function(t){return _a(i,t)},s.tickFormat=function(t,e){return Ha(i,t,e)},s.nice=function(t){return s.domain(Ua(i,t))},s.exponent=function(a){return arguments.length?(n=$a(e=a),r=$a(1/e),t.domain(i.map(n)),s):e},s.copy=function(){return za(t.copy(),e,i)},Ta(s,t)}function $a(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Fa(t,e){var i,n,r;function a(r){return n[((i.get(r)||("range"===e.t?i.set(r,t.push(r)):NaN))-1)%n.length]}function o(e,i){return s.range(t.length).map((function(t){return e+i*t}))}return a.domain=function(n){if(!arguments.length)return t;t=[],i=new O;for(var r,s=-1,o=n.length;++s<o;)i.has(r=n[s])||i.set(r,t.push(r));return a[e.t].apply(a,e.a)},a.range=function(t){return arguments.length?(n=t,r=0,e={t:"range",a:arguments},a):n},a.rangePoints=function(i,s){arguments.length<2&&(s=0);var l=i[0],h=i[1],c=t.length<2?(l=(l+h)/2,0):(h-l)/(t.length-1+s);return n=o(l+c*s/2,c),r=0,e={t:"rangePoints",a:arguments},a},a.rangeRoundPoints=function(i,s){arguments.length<2&&(s=0);var l=i[0],h=i[1],c=t.length<2?(l=h=Math.round((l+h)/2),0):(h-l)/(t.length-1+s)|0;return n=o(l+Math.round(c*s/2+(h-l-(t.length-1+s)*c)/2),c),r=0,e={t:"rangeRoundPoints",a:arguments},a},a.rangeBands=function(i,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var h=i[1]<i[0],c=i[h-0],u=i[1-h],d=(u-c)/(t.length-s+2*l);return n=o(c+d*l,d),h&&n.reverse(),r=d*(1-s),e={t:"rangeBands",a:arguments},a},a.rangeRoundBands=function(i,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var h=i[1]<i[0],c=i[h-0],u=i[1-h],d=Math.floor((u-c)/(t.length-s+2*l));return n=o(c+Math.round((u-c-(t.length-s)*d)/2),d),h&&n.reverse(),r=Math.round(d*(1-s)),e={t:"rangeRoundBands",a:arguments},a},a.rangeBand=function(){return r},a.rangeExtent=function(){return Na(e.a[0])},a.copy=function(){return Fa(t,e)},a.domain(t)}s.scale.pow=function(){return za(s.scale.linear(),1,[0,1])},s.scale.sqrt=function(){return s.scale.pow().exponent(.5)},s.scale.ordinal=function(){return Fa([],{t:"range",a:[[]]})},s.scale.category10=function(){return s.scale.ordinal().range(qa)},s.scale.category20=function(){return s.scale.ordinal().range(Wa)},s.scale.category20b=function(){return s.scale.ordinal().range(Xa)},s.scale.category20c=function(){return s.scale.ordinal().range(Ya)};var qa=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(ue),Wa=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(ue),Xa=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(ue),Ya=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(ue);function Za(t,e){var i;function n(){var n=0,a=e.length;for(i=[];++n<a;)i[n-1]=s.quantile(t,n/a);return r}function r(t){if(!isNaN(t=+t))return e[s.bisect(i,t)]}return r.domain=function(e){return arguments.length?(t=e.map(v).filter(b).sort(g),n()):t},r.range=function(t){return arguments.length?(e=t,n()):e},r.quantiles=function(){return i},r.invertExtent=function(n){return(n=e.indexOf(n))<0?[NaN,NaN]:[n>0?i[n-1]:t[0],n<i.length?i[n]:t[t.length-1]]},r.copy=function(){return Za(t,e)},n()}function Ga(t,e,i){var n,r;function s(e){return i[Math.max(0,Math.min(r,Math.floor(n*(e-t))))]}function a(){return n=i.length/(e-t),r=i.length-1,s}return s.domain=function(i){return arguments.length?(t=+i[0],e=+i[i.length-1],a()):[t,e]},s.range=function(t){return arguments.length?(i=t,a()):i},s.invertExtent=function(e){return[e=(e=i.indexOf(e))<0?NaN:e/n+t,e+1/n]},s.copy=function(){return Ga(t,e,i)},a()}function Ja(t,e){function i(i){if(i<=i)return e[s.bisect(t,i)]}return i.domain=function(e){return arguments.length?(t=e,i):t},i.range=function(t){return arguments.length?(e=t,i):e},i.invertExtent=function(i){return i=e.indexOf(i),[t[i-1],t[i]]},i.copy=function(){return Ja(t,e)},i}function Ka(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(i){return arguments.length?(t=i.map(e),e):t},e.ticks=function(e){return _a(t,e)},e.tickFormat=function(e,i){return Ha(t,e,i)},e.copy=function(){return Ka(t)},e}function Qa(){return 0}s.scale.quantile=function(){return Za([],[])},s.scale.quantize=function(){return Ga(0,1,[0,1])},s.scale.threshold=function(){return Ja([.5],[0,1])},s.scale.identity=function(){return Ka([0,1])},s.svg={},s.svg.arc=function(){var t=eo,e=io,i=Qa,n=to,r=no,s=ro,a=so;function o(){var o=Math.max(0,+t.apply(this,arguments)),h=Math.max(0,+e.apply(this,arguments)),c=r.apply(this,arguments)-Ut,u=s.apply(this,arguments)-Ut,d=Math.abs(u-c),p=c>u?0:1;if(h<o&&(f=h,h=o,o=f),d>=Tt)return l(h,p)+(o?l(o,1-p):"")+"Z";var f,m,g,v,b,y,w,x,E,A,N,O,M=0,j=0,C=[];if((v=(+a.apply(this,arguments)||0)/2)&&(g=n===to?Math.sqrt(o*o+h*h):+n.apply(this,arguments),p||(j*=-1),h&&(j=Vt(g/h*Math.sin(v))),o&&(M=Vt(g/o*Math.sin(v)))),h){b=h*Math.cos(c+j),y=h*Math.sin(c+j),w=h*Math.cos(u-j),x=h*Math.sin(u-j);var L=Math.abs(u-c-2*j)<=St?0:1;if(j&&ao(b,y,w,x)===p^L){var S=(c+u)/2;b=h*Math.cos(S),y=h*Math.sin(S),w=x=null}}else b=y=0;if(o){E=o*Math.cos(u-M),A=o*Math.sin(u-M),N=o*Math.cos(c+M),O=o*Math.sin(c+M);var k=Math.abs(c-u+2*M)<=St?0:1;if(M&&ao(E,A,N,O)===1-p^k){var T=(c+u)/2;E=o*Math.cos(T),A=o*Math.sin(T),N=O=null}}else E=A=0;if(d>Ct&&(f=Math.min(Math.abs(h-o)/2,+i.apply(this,arguments)))>.001){m=o<h^p?0:1;var U=f,I=f;if(d<St){var _=null==N?[E,A]:null==w?[b,y]:mr([b,y],[N,O],[w,x],[E,A]),H=b-_[0],D=y-_[1],P=w-_[0],V=x-_[1],B=1/Math.sin(Math.acos((H*P+D*V)/(Math.sqrt(H*H+D*D)*Math.sqrt(P*P+V*V)))/2),R=Math.sqrt(_[0]*_[0]+_[1]*_[1]);I=Math.min(f,(o-R)/(B-1)),U=Math.min(f,(h-R)/(B+1))}if(null!=w){var z=oo(null==N?[E,A]:[N,O],[b,y],h,U,p),$=oo([w,x],[E,A],h,U,p);f===U?C.push("M",z[0],"A",U,",",U," 0 0,",m," ",z[1],"A",h,",",h," 0 ",1-p^ao(z[1][0],z[1][1],$[1][0],$[1][1]),",",p," ",$[1],"A",U,",",U," 0 0,",m," ",$[0]):C.push("M",z[0],"A",U,",",U," 0 1,",m," ",$[0])}else C.push("M",b,",",y);if(null!=N){var F=oo([b,y],[N,O],o,-I,p),q=oo([E,A],null==w?[b,y]:[w,x],o,-I,p);f===I?C.push("L",q[0],"A",I,",",I," 0 0,",m," ",q[1],"A",o,",",o," 0 ",p^ao(q[1][0],q[1][1],F[1][0],F[1][1]),",",1-p," ",F[1],"A",I,",",I," 0 0,",m," ",F[0]):C.push("L",q[0],"A",I,",",I," 0 0,",m," ",F[0])}else C.push("L",E,",",A)}else C.push("M",b,",",y),null!=w&&C.push("A",h,",",h," 0 ",L,",",p," ",w,",",x),C.push("L",E,",",A),null!=N&&C.push("A",o,",",o," 0 ",k,",",1-p," ",N,",",O);return C.push("Z"),C.join("")}function l(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}return o.innerRadius=function(e){return arguments.length?(t=we(e),o):t},o.outerRadius=function(t){return arguments.length?(e=we(t),o):e},o.cornerRadius=function(t){return arguments.length?(i=we(t),o):i},o.padRadius=function(t){return arguments.length?(n=t==to?to:we(t),o):n},o.startAngle=function(t){return arguments.length?(r=we(t),o):r},o.endAngle=function(t){return arguments.length?(s=we(t),o):s},o.padAngle=function(t){return arguments.length?(a=we(t),o):a},o.centroid=function(){var i=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,n=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2-Ut;return[Math.cos(n)*i,Math.sin(n)*i]},o};var to="auto";function eo(t){return t.innerRadius}function io(t){return t.outerRadius}function no(t){return t.startAngle}function ro(t){return t.endAngle}function so(t){return t&&t.padAngle}function ao(t,e,i,n){return(t-i)*e-(e-n)*t>0?0:1}function oo(t,e,i,n,r){var s=t[0]-e[0],a=t[1]-e[1],o=(r?n:-n)/Math.sqrt(s*s+a*a),l=o*a,h=-o*s,c=t[0]+l,u=t[1]+h,d=e[0]+l,p=e[1]+h,f=(c+d)/2,m=(u+p)/2,g=d-c,v=p-u,b=g*g+v*v,y=i-n,w=c*p-d*u,x=(v<0?-1:1)*Math.sqrt(Math.max(0,y*y*b-w*w)),E=(w*v-g*x)/b,A=(-w*g-v*x)/b,N=(w*v+g*x)/b,O=(-w*g+v*x)/b,M=E-f,j=A-m,C=N-f,L=O-m;return M*M+j*j>C*C+L*L&&(E=N,A=O),[[E-l,A-h],[E*i/y,A*i/y]]}function lo(t){var e=hr,i=cr,n=Ki,r=co,s=r.key,a=.7;function o(s){var o,l=[],h=[],c=-1,u=s.length,d=we(e),p=we(i);function f(){l.push("M",r(t(h),a))}for(;++c<u;)n.call(this,o=s[c],c)?h.push([+d.call(this,o,c),+p.call(this,o,c)]):h.length&&(f(),h=[]);return h.length&&f(),l.length?l.join(""):null}return o.x=function(t){return arguments.length?(e=t,o):e},o.y=function(t){return arguments.length?(i=t,o):i},o.defined=function(t){return arguments.length?(n=t,o):n},o.interpolate=function(t){return arguments.length?(s="function"==typeof t?r=t:(r=ho.get(t)||co).key,o):s},o.tension=function(t){return arguments.length?(a=t,o):a},o}s.svg.line=function(){return lo(I)};var ho=s.map({linear:co,"linear-closed":uo,step:function(t){for(var e=0,i=t.length,n=t[0],r=[n[0],",",n[1]];++e<i;)r.push("H",(n[0]+(n=t[e])[0])/2,"V",n[1]);return i>1&&r.push("H",n[0]),r.join("")},"step-before":po,"step-after":fo,basis:vo,"basis-open":function(t){if(t.length<4)return co(t);for(var e,i=[],n=-1,r=t.length,s=[0],a=[0];++n<3;)e=t[n],s.push(e[0]),a.push(e[1]);for(i.push(bo(xo,s)+","+bo(xo,a)),--n;++n<r;)e=t[n],s.shift(),s.push(e[0]),a.shift(),a.push(e[1]),Eo(i,s,a);return i.join("")},"basis-closed":function(t){for(var e,i,n=-1,r=t.length,s=r+4,a=[],o=[];++n<4;)i=t[n%r],a.push(i[0]),o.push(i[1]);for(e=[bo(xo,a),",",bo(xo,o)],--n;++n<s;)i=t[n%r],a.shift(),a.push(i[0]),o.shift(),o.push(i[1]),Eo(e,a,o);return e.join("")},bundle:function(t,e){var i=t.length-1;if(i)for(var n,r,s=t[0][0],a=t[0][1],o=t[i][0]-s,l=t[i][1]-a,h=-1;++h<=i;)r=h/i,(n=t[h])[0]=e*n[0]+(1-e)*(s+r*o),n[1]=e*n[1]+(1-e)*(a+r*l);return vo(t)},cardinal:function(t,e){return t.length<3?co(t):t[0]+mo(t,go(t,e))},"cardinal-open":function(t,e){return t.length<4?co(t):t[1]+mo(t.slice(1,-1),go(t,e))},"cardinal-closed":function(t,e){return t.length<3?uo(t):t[0]+mo((t.push(t[0]),t),go([t[t.length-2]].concat(t,[t[1]]),e))},monotone:function(t){return t.length<3?co(t):t[0]+mo(t,function(t){for(var e,i,n,r,s=[],a=function(t){for(var e=0,i=t.length-1,n=[],r=t[0],s=t[1],a=n[0]=Ao(r,s);++e<i;)n[e]=(a+(a=Ao(r=s,s=t[e+1])))/2;return n[e]=a,n}(t),o=-1,l=t.length-1;++o<l;)e=Ao(t[o],t[o+1]),E(e)<Ct?a[o]=a[o+1]=0:(r=(i=a[o]/e)*i+(n=a[o+1]/e)*n)>9&&(r=3*e/Math.sqrt(r),a[o]=r*i,a[o+1]=r*n);for(o=-1;++o<=l;)r=(t[Math.min(l,o+1)][0]-t[Math.max(0,o-1)][0])/(6*(1+a[o]*a[o])),s.push([r||0,a[o]*r||0]);return s}(t))}});function co(t){return t.length>1?t.join("L"):t+"Z"}function uo(t){return t.join("L")+"Z"}function po(t){for(var e=0,i=t.length,n=t[0],r=[n[0],",",n[1]];++e<i;)r.push("V",(n=t[e])[1],"H",n[0]);return r.join("")}function fo(t){for(var e=0,i=t.length,n=t[0],r=[n[0],",",n[1]];++e<i;)r.push("H",(n=t[e])[0],"V",n[1]);return r.join("")}function mo(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return co(t);var i=t.length!=e.length,n="",r=t[0],s=t[1],a=e[0],o=a,l=1;if(i&&(n+="Q"+(s[0]-2*a[0]/3)+","+(s[1]-2*a[1]/3)+","+s[0]+","+s[1],r=t[1],l=2),e.length>1){o=e[1],s=t[l],l++,n+="C"+(r[0]+a[0])+","+(r[1]+a[1])+","+(s[0]-o[0])+","+(s[1]-o[1])+","+s[0]+","+s[1];for(var h=2;h<e.length;h++,l++)s=t[l],o=e[h],n+="S"+(s[0]-o[0])+","+(s[1]-o[1])+","+s[0]+","+s[1]}if(i){var c=t[l];n+="Q"+(s[0]+2*o[0]/3)+","+(s[1]+2*o[1]/3)+","+c[0]+","+c[1]}return n}function go(t,e){for(var i,n=[],r=(1-e)/2,s=t[0],a=t[1],o=1,l=t.length;++o<l;)i=s,s=a,a=t[o],n.push([r*(a[0]-i[0]),r*(a[1]-i[1])]);return n}function vo(t){if(t.length<3)return co(t);var e=1,i=t.length,n=t[0],r=n[0],s=n[1],a=[r,r,r,(n=t[1])[0]],o=[s,s,s,n[1]],l=[r,",",s,"L",bo(xo,a),",",bo(xo,o)];for(t.push(t[i-1]);++e<=i;)n=t[e],a.shift(),a.push(n[0]),o.shift(),o.push(n[1]),Eo(l,a,o);return t.pop(),l.push("L",n),l.join("")}function bo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}ho.forEach((function(t,e){e.key=t,e.closed=/-closed$/.test(t)}));var yo=[0,2/3,1/3,0],wo=[0,1/3,2/3,0],xo=[0,1/6,2/3,1/6];function Eo(t,e,i){t.push("C",bo(yo,e),",",bo(yo,i),",",bo(wo,e),",",bo(wo,i),",",bo(xo,e),",",bo(xo,i))}function Ao(t,e){return(e[1]-t[1])/(e[0]-t[0])}function No(t){for(var e,i,n,r=-1,s=t.length;++r<s;)i=(e=t[r])[0],n=e[1]-Ut,e[0]=i*Math.cos(n),e[1]=i*Math.sin(n);return t}function Oo(t){var e=hr,i=hr,n=0,r=cr,s=Ki,a=co,o=a.key,l=a,h="L",c=.7;function u(o){var u,d,p,f=[],m=[],g=[],v=-1,b=o.length,y=we(e),w=we(n),x=e===i?function(){return d}:we(i),E=n===r?function(){return p}:we(r);function A(){f.push("M",a(t(g),c),h,l(t(m.reverse()),c),"Z")}for(;++v<b;)s.call(this,u=o[v],v)?(m.push([d=+y.call(this,u,v),p=+w.call(this,u,v)]),g.push([+x.call(this,u,v),+E.call(this,u,v)])):m.length&&(A(),m=[],g=[]);return m.length&&A(),f.length?f.join(""):null}return u.x=function(t){return arguments.length?(e=i=t,u):i},u.x0=function(t){return arguments.length?(e=t,u):e},u.x1=function(t){return arguments.length?(i=t,u):i},u.y=function(t){return arguments.length?(n=r=t,u):r},u.y0=function(t){return arguments.length?(n=t,u):n},u.y1=function(t){return arguments.length?(r=t,u):r},u.defined=function(t){return arguments.length?(s=t,u):s},u.interpolate=function(t){return arguments.length?(o="function"==typeof t?a=t:(a=ho.get(t)||co).key,l=a.reverse||a,h=a.closed?"M":"L",u):o},u.tension=function(t){return arguments.length?(c=t,u):c},u}function Mo(t){return t.radius}function jo(t){return[t.x,t.y]}function Co(t){return function(){var e=t.apply(this,arguments),i=e[0],n=e[1]-Ut;return[i*Math.cos(n),i*Math.sin(n)]}}function Lo(){return 64}function So(){return"circle"}function ko(t){var e=Math.sqrt(t/St);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}s.svg.line.radial=function(){var t=lo(No);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},po.reverse=fo,fo.reverse=po,s.svg.area=function(){return Oo(I)},s.svg.area.radial=function(){var t=Oo(No);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},s.svg.chord=function(){var t=Zn,e=Gn,i=Mo,n=no,r=ro;function s(i,n){var r,s,h=a(this,t,i,n),c=a(this,e,i,n);return"M"+h.p0+o(h.r,h.p1,h.a1-h.a0)+(s=c,((r=h).a0==s.a0&&r.a1==s.a1?l(h.r,h.p1,h.r,h.p0):l(h.r,h.p1,c.r,c.p0)+o(c.r,c.p1,c.a1-c.a0)+l(c.r,c.p1,h.r,h.p0))+"Z")}function a(t,e,s,a){var o=e.call(t,s,a),l=i.call(t,o,a),h=n.call(t,o,a)-Ut,c=r.call(t,o,a)-Ut;return{r:l,a0:h,a1:c,p0:[l*Math.cos(h),l*Math.sin(h)],p1:[l*Math.cos(c),l*Math.sin(c)]}}function o(t,e,i){return"A"+t+","+t+" 0 "+ +(i>St)+",1 "+e}function l(t,e,i,n){return"Q 0,0 "+n}return s.radius=function(t){return arguments.length?(i=we(t),s):i},s.source=function(e){return arguments.length?(t=we(e),s):t},s.target=function(t){return arguments.length?(e=we(t),s):e},s.startAngle=function(t){return arguments.length?(n=we(t),s):n},s.endAngle=function(t){return arguments.length?(r=we(t),s):r},s},s.svg.diagonal=function(){var t=Zn,e=Gn,i=jo;function n(n,r){var s=t.call(this,n,r),a=e.call(this,n,r),o=(s.y+a.y)/2,l=[s,{x:s.x,y:o},{x:a.x,y:o},a];return"M"+(l=l.map(i))[0]+"C"+l[1]+" "+l[2]+" "+l[3]}return n.source=function(e){return arguments.length?(t=we(e),n):t},n.target=function(t){return arguments.length?(e=we(t),n):e},n.projection=function(t){return arguments.length?(i=t,n):i},n},s.svg.diagonal.radial=function(){var t=s.svg.diagonal(),e=jo,i=t.projection;return t.projection=function(t){return arguments.length?i(Co(e=t)):e},t},s.svg.symbol=function(){var t=So,e=Lo;function i(i,n){return(To.get(t.call(this,i,n))||ko)(e.call(this,i,n))}return i.type=function(e){return arguments.length?(t=we(e),i):t},i.size=function(t){return arguments.length?(e=we(t),i):e},i};var To=s.map({circle:ko,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Io)),i=e*Io;return"M0,"+-e+"L"+i+",0 0,"+e+" "+-i+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Uo),i=e*Uo/2;return"M0,"+i+"L"+e+","+-i+" "+-e+","+-i+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Uo),i=e*Uo/2;return"M0,"+-i+"L"+e+","+i+" "+-e+","+i+"Z"}});s.svg.symbolTypes=To.keys();var Uo=Math.sqrt(3),Io=Math.tan(30*It);G.transition=function(t){for(var e,i,n=Po||++Ro,r=Fo(t),s=[],a=Vo||{time:Date.now(),ease:ms,delay:0,duration:250},o=-1,l=this.length;++o<l;){s.push(e=[]);for(var h=this[o],c=-1,u=h.length;++c<u;)(i=h[c])&&qo(i,c,r,n,a),e.push(i)}return Do(s,r,n)},G.interrupt=function(t){return this.each(null==t?_o:Ho(Fo(t)))};var _o=Ho(Fo());function Ho(t){return function(){var e,i,n;(e=this[t])&&(n=e[i=e.active])&&(n.timer.c=null,n.timer.t=NaN,--e.count?delete e[i]:delete this[t],e.active+=.5,n.event&&n.event.interrupt.call(this,this.__data__,n.index))}}function Do(t,e,i){return q(t,Bo),t.namespace=e,t.id=i,t}var Po,Vo,Bo=[],Ro=0;function zo(t,e,i,n){var r=t.id,s=t.namespace;return ft(t,"function"==typeof i?function(t,a,o){t[s][r].tween.set(e,n(i.call(t,t.__data__,a,o)))}:(i=n(i),function(t){t[s][r].tween.set(e,i)}))}function $o(t){return null==t&&(t=""),function(){this.textContent=t}}function Fo(t){return null==t?"__transition__":"__transition_"+t+"__"}function qo(t,e,i,n,r){var s,a,o,l,h,c=t[i]||(t[i]={active:0,count:0}),u=c[n];function d(i){var r=c.active,d=c[r];for(var f in d&&(d.timer.c=null,d.timer.t=NaN,--c.count,delete c[r],d.event&&d.event.interrupt.call(t,t.__data__,d.index)),c)if(+f<n){var m=c[f];m.timer.c=null,m.timer.t=NaN,--c.count,delete c[f]}a.c=p,Ce((function(){return a.c&&p(i||1)&&(a.c=null,a.t=NaN),1}),0,s),c.active=n,u.event&&u.event.start.call(t,t.__data__,e),h=[],u.tween.forEach((function(i,n){(n=n.call(t,t.__data__,e))&&h.push(n)})),l=u.ease,o=u.duration}function p(r){for(var s=r/o,a=l(s),d=h.length;d>0;)h[--d].call(t,a);if(s>=1)return u.event&&u.event.end.call(t,t.__data__,e),--c.count?delete c[n]:delete t[i],1}u||(s=r.time,a=Ce((function(t){var e=u.delay;if(a.t=e+s,e<=t)return d(t-e);a.c=d}),0,s),u=c[n]={tween:new O,time:s,timer:a,delay:r.delay,duration:r.duration,ease:r.ease,index:e},r=null,++c.count)}Bo.call=G.call,Bo.empty=G.empty,Bo.node=G.node,Bo.size=G.size,s.transition=function(t,e){return t&&t.transition?Po?t.transition(e):t:s.selection().transition(t)},s.transition.prototype=Bo,Bo.select=function(t){var e,i,n,r=this.id,s=this.namespace,a=[];t=J(t);for(var o=-1,l=this.length;++o<l;){a.push(e=[]);for(var h=this[o],c=-1,u=h.length;++c<u;)(n=h[c])&&(i=t.call(n,n.__data__,c,o))?("__data__"in n&&(i.__data__=n.__data__),qo(i,c,s,r,n[s][r]),e.push(i)):e.push(null)}return Do(a,s,r)},Bo.selectAll=function(t){var e,i,n,r,s,a=this.id,o=this.namespace,l=[];t=K(t);for(var h=-1,c=this.length;++h<c;)for(var u=this[h],d=-1,p=u.length;++d<p;)if(n=u[d]){s=n[o][a],i=t.call(n,n.__data__,d,h),l.push(e=[]);for(var f=-1,m=i.length;++f<m;)(r=i[f])&&qo(r,f,o,a,s),e.push(r)}return Do(l,o,a)},Bo.filter=function(t){var e,i,n=[];"function"!=typeof t&&(t=dt(t));for(var r=0,s=this.length;r<s;r++){n.push(e=[]);for(var a,o=0,l=(a=this[r]).length;o<l;o++)(i=a[o])&&t.call(i,i.__data__,o,r)&&e.push(i)}return Do(n,this.namespace,this.id)},Bo.tween=function(t,e){var i=this.id,n=this.namespace;return arguments.length<2?this.node()[n][i].tween.get(t):ft(this,null==e?function(e){e[n][i].tween.remove(t)}:function(r){r[n][i].tween.set(t,e)})},Bo.attr=function(t,e){if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var i="transform"==t?Ms:ss,n=s.ns.qualify(t);function r(){this.removeAttribute(n)}function a(){this.removeAttributeNS(n.space,n.local)}function o(t){return null==t?r:(t+="",function(){var e,r=this.getAttribute(n);return r!==t&&(e=i(r,t),function(t){this.setAttribute(n,e(t))})})}function l(t){return null==t?a:(t+="",function(){var e,r=this.getAttributeNS(n.space,n.local);return r!==t&&(e=i(r,t),function(t){this.setAttributeNS(n.space,n.local,e(t))})})}return zo(this,"attr."+t,e,n.local?l:o)},Bo.attrTween=function(t,e){var i=s.ns.qualify(t);return this.tween("attr."+t,i.local?function(t,n){var r=e.call(this,t,n,this.getAttributeNS(i.space,i.local));return r&&function(t){this.setAttributeNS(i.space,i.local,r(t))}}:function(t,n){var r=e.call(this,t,n,this.getAttribute(i));return r&&function(t){this.setAttribute(i,r(t))}})},Bo.style=function(t,e,i){var n=arguments.length;if(n<3){if("string"!=typeof t){for(i in n<2&&(e=""),t)this.style(i,t[i],e);return this}i=""}function r(){this.style.removeProperty(t)}function s(e){return null==e?r:(e+="",function(){var n,r=c(this).getComputedStyle(this,null).getPropertyValue(t);return r!==e&&(n=ss(r,e),function(e){this.style.setProperty(t,n(e),i)})})}return zo(this,"style."+t,e,s)},Bo.styleTween=function(t,e,i){function n(n,r){var s=e.call(this,n,r,c(this).getComputedStyle(this,null).getPropertyValue(t));return s&&function(e){this.style.setProperty(t,s(e),i)}}return arguments.length<3&&(i=""),this.tween("style."+t,n)},Bo.text=function(t){return zo(this,"text",t,$o)},Bo.remove=function(){var t=this.namespace;return this.each("end.transition",(function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)}))},Bo.ease=function(t){var e=this.id,i=this.namespace;return arguments.length<1?this.node()[i][e].ease:("function"!=typeof t&&(t=s.ease.apply(s,arguments)),ft(this,(function(n){n[i][e].ease=t})))},Bo.delay=function(t){var e=this.id,i=this.namespace;return arguments.length<1?this.node()[i][e].delay:ft(this,"function"==typeof t?function(n,r,s){n[i][e].delay=+t.call(n,n.__data__,r,s)}:(t=+t,function(n){n[i][e].delay=t}))},Bo.duration=function(t){var e=this.id,i=this.namespace;return arguments.length<1?this.node()[i][e].duration:ft(this,"function"==typeof t?function(n,r,s){n[i][e].duration=Math.max(1,t.call(n,n.__data__,r,s))}:(t=Math.max(1,t),function(n){n[i][e].duration=t}))},Bo.each=function(t,e){var i=this.id,n=this.namespace;if(arguments.length<2){var r=Vo,a=Po;try{Po=i,ft(this,(function(e,r,s){Vo=e[n][i],t.call(e,e.__data__,r,s)}))}finally{Vo=r,Po=a}}else ft(this,(function(r){var a=r[n][i];(a.event||(a.event=s.dispatch("start","end","interrupt"))).on(t,e)}));return this},Bo.transition=function(){for(var t,e,i,n=this.id,r=++Ro,s=this.namespace,a=[],o=0,l=this.length;o<l;o++){a.push(t=[]);for(var h,c=0,u=(h=this[o]).length;c<u;c++)(e=h[c])&&qo(e,c,s,r,{time:(i=e[s][n]).time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration}),t.push(e)}return Do(a,s,r)},s.svg.axis=function(){var t,e=s.scale.linear(),i=Wo,n=6,r=6,a=3,l=[10],h=null;function c(o){o.each((function(){var o,c=s.select(this),u=this.__chart__||e,d=this.__chart__=e.copy(),p=null==h?d.ticks?d.ticks.apply(d,l):d.domain():h,f=null==t?d.tickFormat?d.tickFormat.apply(d,l):I:t,m=c.selectAll(".tick").data(p,d),g=m.enter().insert("g",".domain").attr("class","tick").style("opacity",Ct),v=s.transition(m.exit()).style("opacity",Ct).remove(),b=s.transition(m.order()).style("opacity",1),y=Math.max(n,0)+a,w=Oa(d),x=c.selectAll(".domain").data([0]),E=(x.enter().append("path").attr("class","domain"),s.transition(x));g.append("line"),g.append("text");var A,N,O,M,j=g.select("line"),C=b.select("line"),L=m.select("text").text(f),S=g.select("text"),k=b.select("text"),T="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(o=Yo,A="x",O="y",N="x2",M="y2",L.attr("dy",T<0?"0em":".71em").style("text-anchor","middle"),E.attr("d","M"+w[0]+","+T*r+"V0H"+w[1]+"V"+T*r)):(o=Zo,A="y",O="x",N="y2",M="x2",L.attr("dy",".32em").style("text-anchor",T<0?"end":"start"),E.attr("d","M"+T*r+","+w[0]+"H0V"+w[1]+"H"+T*r)),j.attr(M,T*n),S.attr(O,T*y),C.attr(N,0).attr(M,T*n),k.attr(A,0).attr(O,T*y),d.rangeBand){var U=d,_=U.rangeBand()/2;u=d=function(t){return U(t)+_}}else u.rangeBand?u=d:v.call(o,d,u);g.call(o,u,d),b.call(o,d,d)}))}return c.scale=function(t){return arguments.length?(e=t,c):e},c.orient=function(t){return arguments.length?(i=t in Xo?t+"":Wo,c):i},c.ticks=function(){return arguments.length?(l=o(arguments),c):l},c.tickValues=function(t){return arguments.length?(h=t,c):h},c.tickFormat=function(e){return arguments.length?(t=e,c):t},c.tickSize=function(t){var e=arguments.length;return e?(n=+t,r=+arguments[e-1],c):n},c.innerTickSize=function(t){return arguments.length?(n=+t,c):n},c.outerTickSize=function(t){return arguments.length?(r=+t,c):r},c.tickPadding=function(t){return arguments.length?(a=+t,c):a},c.tickSubdivide=function(){return arguments.length&&c},c};var Wo="bottom",Xo={top:1,right:1,bottom:1,left:1};function Yo(t,e,i){t.attr("transform",(function(t){var n=e(t);return"translate("+(isFinite(n)?n:i(t))+",0)"}))}function Zo(t,e,i){t.attr("transform",(function(t){var n=e(t);return"translate(0,"+(isFinite(n)?n:i(t))+")"}))}s.svg.brush=function(){var t,e,i=$(d,"brushstart","brush","brushend"),n=null,r=null,a=[0,0],o=[0,0],l=!0,h=!0,u=Jo[0];function d(t){t.each((function(){var t=s.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",g).on("touchstart.brush",g),e=t.selectAll(".background").data([0]);e.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var i=t.selectAll(".resize").data(u,I);i.exit().remove(),i.enter().append("g").attr("class",(function(t){return"resize "+t})).style("cursor",(function(t){return Go[t]})).append("rect").attr("x",(function(t){return/[ew]$/.test(t)?-3:null})).attr("y",(function(t){return/^[ns]/.test(t)?-3:null})).attr("width",6).attr("height",6).style("visibility","hidden"),i.style("display",d.empty()?"none":null);var a,o=s.transition(t),l=s.transition(e);n&&(a=Oa(n),l.attr("x",a[0]).attr("width",a[1]-a[0]),f(o)),r&&(a=Oa(r),l.attr("y",a[0]).attr("height",a[1]-a[0]),m(o)),p(o)}))}function p(t){t.selectAll(".resize").attr("transform",(function(t){return"translate("+a[+/e$/.test(t)]+","+o[+/^s/.test(t)]+")"}))}function f(t){t.select(".extent").attr("x",a[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",a[1]-a[0])}function m(t){t.select(".extent").attr("y",o[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",o[1]-o[0])}function g(){var u,g,v=this,b=s.select(s.event.target),y=i.of(v,arguments),w=s.select(v),x=b.datum(),E=!/^(n|s)$/.test(x)&&n,A=!/^(e|w)$/.test(x)&&r,N=b.classed("extent"),O=Nt(v),M=s.mouse(v),j=s.select(c(v)).on("keydown.brush",S).on("keyup.brush",k);if(s.event.changedTouches?j.on("touchmove.brush",T).on("touchend.brush",I):j.on("mousemove.brush",T).on("mouseup.brush",I),w.interrupt().selectAll("*").interrupt(),N)M[0]=a[0]-M[0],M[1]=o[0]-M[1];else if(x){var C=+/w$/.test(x),L=+/^n/.test(x);g=[a[1-C]-M[0],o[1-L]-M[1]],M[0]=a[C],M[1]=o[L]}else s.event.altKey&&(u=M.slice());function S(){32==s.event.keyCode&&(N||(u=null,M[0]-=a[1],M[1]-=o[1],N=2),R())}function k(){32==s.event.keyCode&&2==N&&(M[0]+=a[1],M[1]+=o[1],N=0,R())}function T(){var t=s.mouse(v),e=!1;g&&(t[0]+=g[0],t[1]+=g[1]),N||(s.event.altKey?(u||(u=[(a[0]+a[1])/2,(o[0]+o[1])/2]),M[0]=a[+(t[0]<u[0])],M[1]=o[+(t[1]<u[1])]):u=null),E&&U(t,n,0)&&(f(w),e=!0),A&&U(t,r,1)&&(m(w),e=!0),e&&(p(w),y({type:"brush",mode:N?"move":"resize"}))}function U(i,n,r){var s,c,d=Oa(n),p=d[0],f=d[1],m=M[r],g=r?o:a,v=g[1]-g[0];if(N&&(p-=m,f-=v+m),s=(r?h:l)?Math.max(p,Math.min(f,i[r])):i[r],N?c=(s+=m)+v:(u&&(m=Math.max(p,Math.min(f,2*u[r]-s))),m<s?(c=s,s=m):c=m),g[0]!=s||g[1]!=c)return r?e=null:t=null,g[0]=s,g[1]=c,!0}function I(){T(),w.style("pointer-events","all").selectAll(".resize").style("display",d.empty()?"none":null),s.select("body").style("cursor",null),j.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),O(),y({type:"brushend"})}w.style("pointer-events","none").selectAll(".resize").style("display",null),s.select("body").style("cursor",b.style("cursor")),y({type:"brushstart"}),T()}return d.event=function(n){n.each((function(){var n=i.of(this,arguments),r={x:a,y:o,i:t,j:e},l=this.__chart__||r;this.__chart__=r,Po?s.select(this).transition().each("start.brush",(function(){t=l.i,e=l.j,a=l.x,o=l.y,n({type:"brushstart"})})).tween("brush:brush",(function(){var i=as(a,r.x),s=as(o,r.y);return t=e=null,function(t){a=r.x=i(t),o=r.y=s(t),n({type:"brush",mode:"resize"})}})).each("end.brush",(function(){t=r.i,e=r.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})})):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))}))},d.x=function(t){return arguments.length?(u=Jo[!(n=t)<<1|!r],d):n},d.y=function(t){return arguments.length?(u=Jo[!n<<1|!(r=t)],d):r},d.clamp=function(t){return arguments.length?(n&&r?(l=!!t[0],h=!!t[1]):n?l=!!t:r&&(h=!!t),d):n&&r?[l,h]:n?l:r?h:null},d.extent=function(i){var s,l,h,c,u;return arguments.length?(n&&(s=i[0],l=i[1],r&&(s=s[0],l=l[0]),t=[s,l],n.invert&&(s=n(s),l=n(l)),l<s&&(u=s,s=l,l=u),s==a[0]&&l==a[1]||(a=[s,l])),r&&(h=i[0],c=i[1],n&&(h=h[1],c=c[1]),e=[h,c],r.invert&&(h=r(h),c=r(c)),c<h&&(u=h,h=c,c=u),h==o[0]&&c==o[1]||(o=[h,c])),d):(n&&(t?(s=t[0],l=t[1]):(s=a[0],l=a[1],n.invert&&(s=n.invert(s),l=n.invert(l)),l<s&&(u=s,s=l,l=u))),r&&(e?(h=e[0],c=e[1]):(h=o[0],c=o[1],r.invert&&(h=r.invert(h),c=r.invert(c)),c<h&&(u=h,h=c,c=u))),n&&r?[[s,h],[l,c]]:n?[s,l]:r&&[h,c])},d.clear=function(){return d.empty()||(a=[0,0],o=[0,0],t=e=null),d},d.empty=function(){return!!n&&a[0]==a[1]||!!r&&o[0]==o[1]},s.rebind(d,i,"on")};var Go={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Jo=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Ko=Pe.format=pi.timeFormat,Qo=Ko.utc,tl=Qo("%Y-%m-%dT%H:%M:%S.%LZ");function el(t){return t.toISOString()}function il(t,e,i){function n(e){return t(e)}function r(t,i){var n=(t[1]-t[0])/i,r=s.bisect(rl,n);return r==rl.length?[e.year,Ia(t.map((function(t){return t/31536e6})),i)[2]]:r?e[n/rl[r-1]<rl[r]/n?r-1:r]:[ol,Ia(t,i)[2]]}return n.invert=function(e){return nl(t.invert(e))},n.domain=function(e){return arguments.length?(t.domain(e),n):t.domain().map(nl)},n.nice=function(t,e){var i=n.domain(),s=Na(i),a=null==t?r(s,10):"number"==typeof t&&r(s,t);function o(i){return!isNaN(i)&&!t.range(i,nl(+i+1),e).length}return a&&(t=a[0],e=a[1]),n.domain(ja(i,e>1?{floor:function(e){for(;o(e=t.floor(e));)e=nl(e-1);return e},ceil:function(e){for(;o(e=t.ceil(e));)e=nl(+e+1);return e}}:t))},n.ticks=function(t,e){var i=Na(n.domain()),s=null==t?r(i,10):"number"==typeof t?r(i,t):!t.range&&[{range:t},e];return s&&(t=s[0],e=s[1]),t.range(i[0],nl(+i[1]+1),e<1?1:e)},n.tickFormat=function(){return i},n.copy=function(){return il(t.copy(),e,i)},Ta(n,t)}function nl(t){return new Date(t)}Ko.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?el:tl,el.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},el.toString=tl.toString,Pe.second=ze((function(t){return new Ve(1e3*Math.floor(t/1e3))}),(function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))}),(function(t){return t.getSeconds()})),Pe.seconds=Pe.second.range,Pe.seconds.utc=Pe.second.utc.range,Pe.minute=ze((function(t){return new Ve(6e4*Math.floor(t/6e4))}),(function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))}),(function(t){return t.getMinutes()})),Pe.minutes=Pe.minute.range,Pe.minutes.utc=Pe.minute.utc.range,Pe.hour=ze((function(t){var e=t.getTimezoneOffset()/60;return new Ve(36e5*(Math.floor(t/36e5-e)+e))}),(function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))}),(function(t){return t.getHours()})),Pe.hours=Pe.hour.range,Pe.hours.utc=Pe.hour.utc.range,Pe.month=ze((function(t){return(t=Pe.day(t)).setDate(1),t}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t){return t.getMonth()})),Pe.months=Pe.month.range,Pe.months.utc=Pe.month.utc.range;var rl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],sl=[[Pe.second,1],[Pe.second,5],[Pe.second,15],[Pe.second,30],[Pe.minute,1],[Pe.minute,5],[Pe.minute,15],[Pe.minute,30],[Pe.hour,1],[Pe.hour,3],[Pe.hour,6],[Pe.hour,12],[Pe.day,1],[Pe.day,2],[Pe.week,1],[Pe.month,1],[Pe.month,3],[Pe.year,1]],al=Ko.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",Ki]]),ol={range:function(t,e,i){return s.range(Math.ceil(t/i)*i,+e,i).map(nl)},floor:I,ceil:I};sl.year=Pe.year,Pe.scale=function(){return il(s.scale.linear(),sl,al)};var ll=sl.map((function(t){return[t[0].utc,t[1]]})),hl=Qo.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",Ki]]);function cl(t){return JSON.parse(t.responseText)}function ul(t){var e=l.createRange();return e.selectNode(l.body),e.createContextualFragment(t.responseText)}ll.year=Pe.year.utc,Pe.scale.utc=function(){return il(s.scale.linear(),ll,hl)},s.text=xe((function(t){return t.responseText})),s.json=function(t,e){return Ee(t,"application/json",cl,e)},s.html=function(t,e){return Ee(t,"text/html",ul,e)},s.xml=xe((function(t){return t.responseXML})),this.d3=s,void 0===(r="function"==typeof(n=s)?n.call(e,i,e,t):n)||(t.exports=r)}()},835:(t,e,i)=>{"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function o(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function c(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?w(t)?e:t:x(t)?e:t}function u(t){return g(t)&&0===t.length}function d(t){return t instanceof Date||"object"===n(t)&&"[object Date]"===Object.prototype.toString.call(t)}function p(t){return"string"==typeof t||t instanceof String}function f(t){return"function"==typeof t}function m(t){return!x(t)&&"object"===n(t)}function g(t){return!x(t)&&"function"==typeof t[Symbol.iterator]}function v(t){return g(t)&&!p(t)}function b(t){return null===t}function y(t){return!t||p(t)&&(0===t.length||/^\s*$/.test(t))}function w(t){return void 0===t}function x(t){return b(t)||w(t)}function E(t,e,i){if(!Array.isArray(t)||!Number.isInteger(e))throw new TypeError("Bad argument");return t.splice(e,0,i),t.length}function A(t){if(!Array.isArray(t))throw new TypeError("Bad argument");if(!u(t))return t[t.length-1]}function N(t){if(!Array.isArray(t))throw new TypeError("Bad argument");return t[0]}i.r(e),i.d(e,{Accordion:()=>Nn,Collapsible:()=>An,DELETE:()=>S,GET:()=>j,POST:()=>C,PUT:()=>L,Selector:()=>en,SelectorFactory:()=>nn,Switch:()=>dn,addAttributes:()=>It,addPath:()=>at,all:()=>Q,appendChildren:()=>Lt,assert:()=>J,boolToInt:()=>Z,camelCase:()=>W,capitalize:()=>z,capitalizeFirstLetter:()=>$,changeSelectValue:()=>_t,cloneObject:()=>R,cloneTemplate:()=>Ei,compareTime:()=>T,copytoClipboard:()=>Si,createAbbreviation:()=>De,createAnchor:()=>ge,createArea:()=>ve,createArticle:()=>Wt,createAside:()=>Zt,createAudio:()=>we,createB:()=>Pe,createBase:()=>be,createBlockQuotation:()=>le,createButton:()=>si,createCaption:()=>oi,createCite:()=>ze,createCode:()=>Fe,createDataList:()=>ei,createDeletedPart:()=>Ie,createDescriptionDetails:()=>me,createDescriptionList:()=>pe,createDescriptionTerm:()=>fe,createDiv:()=>ie,createDocFragment:()=>Vt,createEmbed:()=>re,createEmphasis:()=>Le,createFieldset:()=>Qe,createFigure:()=>Oe,createFigureCaption:()=>Me,createFooter:()=>Ft,createForm:()=>qe,createH1:()=>Gt,createH2:()=>Jt,createH3:()=>Kt,createH4:()=>Qt,createH5:()=>te,createH6:()=>ee,createHeader:()=>$t,createI:()=>Ve,createImage:()=>ye,createInput:()=>We,createInsertedPart:()=>_e,createLabel:()=>Ye,createLegend:()=>ti,createLineBreak:()=>se,createLink:()=>Rt,createListItem:()=>de,createMain:()=>qt,createMark:()=>Se,createMeter:()=>ii,createNav:()=>Yt,createObject:()=>ne,createOption:()=>Ge,createOptionGroup:()=>Ke,createOrderedList:()=>ue,createOutput:()=>ri,createParagraph:()=>oe,createPicture:()=>Ne,createProgress:()=>ni,createQuote:()=>He,createS:()=>Be,createSample:()=>ke,createSection:()=>Xt,createSelect:()=>Ze,createSource:()=>Ee,createSpan:()=>je,createStrong:()=>Ce,createSubscript:()=>Te,createSuperscript:()=>Ue,createTable:()=>ai,createTableBody:()=>ci,createTableCell:()=>gi,createTableColumn:()=>di,createTableColumnGroup:()=>pi,createTableFooter:()=>ui,createTableHeader:()=>hi,createTableHeaderCell:()=>mi,createTableRow:()=>fi,createTemplate:()=>zt,createTextArea:()=>Xe,createTextNode:()=>Bt,createThematicBreak:()=>ae,createTime:()=>$e,createTrack:()=>Ae,createU:()=>Re,createUnorderedList:()=>ce,createVideo:()=>xe,fetchWithTimeout:()=>k,findAncestor:()=>Mi,findByPath:()=>ct,first:()=>N,floatingLabel:()=>Ui,formatCase:()=>q,formatDate:()=>I,getDir:()=>ot,getDirTarget:()=>lt,getElement:()=>yi,getElements:()=>wi,getNextElementSibling:()=>Oi,getPreviousElementSibling:()=>Ni,getRootUrl:()=>Mn,getTemplate:()=>xi,getUrlParams:()=>jn,hasOwn:()=>V,htmlToElement:()=>Et,htmlToElements:()=>At,inputCounter:()=>Ii,insert:()=>E,insertAfterElement:()=>jt,insertBeforeElement:()=>Mt,isCollection:()=>v,isDate:()=>d,isDerivedOf:()=>B,isDocumentFragment:()=>wt,isElement:()=>gt,isEmpty:()=>u,isFunction:()=>f,isHTMLCollection:()=>yt,isHTMLElement:()=>vt,isInElement:()=>Ot,isInViewport:()=>Nt,isIterable:()=>g,isNode:()=>ft,isNodeList:()=>mt,isNull:()=>b,isNullOrUndefined:()=>x,isNullOrWhitespace:()=>y,isObject:()=>m,isString:()=>p,isUndefined:()=>w,last:()=>A,lone:()=>it,no:()=>et,one:()=>tt,pascalCase:()=>X,preprendChild:()=>Ct,queryBuilder:()=>Cn,random:()=>rt,removeAccents:()=>Y,removeChildren:()=>Li,resolveDate:()=>U,shortDate:()=>_,shortDateTime:()=>H,some:()=>K,toBoolean:()=>G,valOrDefault:()=>c,windowHeight:()=>dt,windowWidth:()=>ut});var O={OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,UnsupportedMediaType:415,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavaible:503,GatewayTimeout:504},M=function(t,e,i,n,r,s){var a=new XMLHttpRequest;return a.onreadystatechange=function(){var t;if(4===a.readyState){var e=function(t,e){return{status:t,message:e}}(a.status,a.responseText);i(a.status)?t=n:(t=r,a.status>=200&&a.status<300&&f(s)&&(t=s)),f(t)&&t(e)}},a.open(t,e,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a};function j(t,e,i,n){var r=(n=c(n,{})).successPred,s=f(r)?r:function(t){return t===O.OK};M("GET",t,s,e,i,n.pass).send()}function C(t,e,i,n,r){var s=(r=c(r,{})).successPred,a=f(s)?s:function(t){return[O.OK,O.Created].includes(t)};M("POST",t,a,i,n,r.pass).send(e)}function L(t,e,i,n,r){var s=(r=c(r,{})).successPred,a=f(s)?s:function(t){return[O.OK,O.NoContent].includes(t)};M("PUT",t,a,i,n,r.pass).send(e)}function S(t,e,i,n,r){var s=(r=c(r,{})).successPred,a=f(s)?s:function(t){return[O.OK,O.Accepted,O.NoContent].includes(t)};M("DELETE",t,a,i,n,r.pass).send(e)}function k(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,n=new AbortController,r=a(a({},e),{},{signal:n.signal});return setTimeout((function(){n.abort()}),i),fetch(t,r).then((function(t){if(!t.ok)throw new Error("".concat(t.status,": ").concat(t.statusText));return t})).catch((function(t){if("AbortError"===t.name)throw new Error("Response timed out");throw new Error(t.message)}))}function T(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";if(x(t)||x(e)||!t.includes(i)||!e.includes(i))return null;var n=t.split(i),r=e.split(i);if(+n[0]>+r[0])return 1;if(+n[0]<+r[0])return-1;if(+n[1]>+r[1])return 1;if(+n[1]<+r[1])return-1;if(n.length==r.length&&3==n.length){if(+n[2]>+r[2])return 1;if(+n[2]<+r[2])return-1}return 0}function U(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(x(t))return new Date;if(d(t))return t;var i=new Date(t),n=i.getTime();return Number.isNaN(n)?new Date:e?new Date(n+6e4*i.getTimezoneOffset()):i}function I(t,e){var i=t.getDate(),n=t.getMonth()+1,r=t.getFullYear().toString(),s=t.getHours(),a=t.getMinutes(),o=t.getSeconds(),l=function(t){return t<10?"0".concat(t):t};return e.replace("yyyy",r).replace("yy",r.slice(-2)).replace("mm",l(n)).replace("m",n).replace("dd",l(i)).replace("d",i).replace("hh",l(s)).replace("h",s).replace("MM",l(a)).replace("M",a).replace("ss",l(o)).replace("s",o)}function _(t){return I(U(t),"yyyy-mm-dd")}function H(t){return I(U(t,!1),"yyyy-mm-dd hh:MM")}var D=Object.prototype.hasOwnProperty,P=Object.prototype.isPrototypeOf,V=function(t,e){return D.call(t,e)},B=function(t,e){return Object.getPrototypeOf(t)!==e&&P.call(e,t)};function R(t){if(x(t)||!m(t))return t;var e=t.constructor();for(var i in t)V(t,i)&&(t.isActiveClone=null,e[i]=R(t[i]),delete t.isActiveClone);return e}function z(t){return y(t)?t:t.toLowerCase().replace(/\b\w/g,(function(t){return t.toUpperCase()}))}function $(t){return y(t)?t:t.charAt(0).toUpperCase()+t.slice(1)}var F={camel:function(t){return W(t)},pascal:function(t){return X(t)},upper:function(t){return t.toUpperCase()},lower:function(t){return t.toLowerCase()}};function q(t,e){return y(t)?t:V(F,e)?F[e](t):t}function W(t){if(y(t))return t;var e=X(t);return e.charAt(0).toLowerCase()+e.slice(1)}function X(t){return y(t)?t:z(t.replace(/[_-]+/g," ").replace(/\s+/g," ").trim()).replace(/\s+/g,"")}function Y(t){return String.prototype.normalize?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):t.replace(/[àâäæ]/gi,"a").replace(/[ç]/gi,"c").replace(/[éèê]/gi,"e").replace(/[îï]/gi,"i").replace(/[ôœ]/gi,"o").replace(/[ùûü]/gi,"u")}function Z(t){return t?1:0}function G(t){var e=c(t,!1);return p(e)&&"true"===e.toLowerCase()||Number.isInteger(e)&&1===e||!0===e}var J=function(t,e,i,n){if(!Array.isArray(t)||!f(e))throw new TypeError("Bad argument");var r=nt(t,e);if(Q([i,n],Number.isInteger)){if(n<i)throw new Error("Bad argument: max must be greater than min");return r>=i&&r<=n}return Number.isInteger(i)?r>=i:Number.isInteger(n)?r<=n:r>0},K=function(t,e){if(!Array.isArray(t)||!f(e))throw new TypeError("Bad argument");for(var i=0;i<t.length;i++){var n=t[i];if(e.apply(void 0,o(Array.isArray(n)?n:[n])))return!0}return!1},Q=function(t,e){if(!Array.isArray(t)||!f(e))throw new TypeError("Bad argument");for(var i=0;i<t.length;i++){var n=t[i];if(!e.apply(void 0,o(Array.isArray(n)?n:[n])))return!1}return!0},tt=function(t,e){if(!Array.isArray(t)||!f(e))throw new TypeError("Bad argument");return 1===nt(t,e)},et=function(t,e){if(!Array.isArray(t)||!f(e))throw new TypeError("Bad argument");return 0===nt(t,e)},it=function(t,e){if(!Array.isArray(t)||!f(e))throw new TypeError("Bad argument");return nt(t,e)<=1};function nt(t,e){for(var i=0,n=0;n<t.length;n++){var r=t[n];e.apply(void 0,o(Array.isArray(r)?r:[r]))&&i++}return i}function rt(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Number.isInteger(t))throw new TypeError("Bad argument");if(Number.isInteger(e)||(e=t,t=0),e<t)throw new Error("Bad argument: max must be greater than min");return t+Math.floor((i?st():Math.random())*(e-t+1))}function st(){return window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295}function at(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return y(t)?e:"".concat(t).concat(i).concat(e)}function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return t.substring(0,t.lastIndexOf(e))}function lt(t,e){return t.substring(0,t.lastIndexOf(e)-1)}function ht(t,e,i){var n=+e[0].match(/\d+/g);return t[i][n]}function ct(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",n=/\[\d+\]/g,r=R(t),s=function(t,e,i){var n=t.match(e),s=t.substring(0,t.indexOf("["));return i(r,n,s)},a=e.split(i),o=0,l=a.length;o<l;o++){var h=a[o];if(x(r=n.test(h)?s(h,n,ht):r[h]))return}return r}var ut=function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},dt=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},pt=function(t){return!x(t)&&t.nodeType===Node.ELEMENT_NODE},ft=function(t){return t instanceof Node},mt=function(t){return t instanceof NodeList},gt=function(t){return pt(t)&&t instanceof Element},vt=function(t,e){return!!(pt(t)&&t instanceof HTMLElement)&&(!g(e)||(i=t,n=Array.isArray(e)?e:[e],r=function(t){return i instanceof t},s=function(t){return i.tagName===t.toUpperCase()},a=function(t){return Array.isArray(t)?t.includes(i.type):i.type===t},n.some((function(t){if(!g(t))return!1;var e=t,i=null;if(Array.isArray(t)){var n=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,r=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,s=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}return i}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2);e=n[0],i=n[1]}e=e.toLowerCase();var o="HTML".concat(V(bt,e)?bt[e]:X(e),"Element");return!(!r(window[o])&&!s(e))&&(!(v(i)&&!u(i))||a(i))}))));var i,n,r,s,a},bt={a:"Anchor",br:"BR",dl:"DList",datalist:"DataList",fieldset:"FieldSet",frameset:"FrameSet",hr:"HR",h1:"Heading",h2:"Heading",h3:"Heading",h4:"Heading",h5:"Heading",h6:"Heading",li:"LI",ol:"OList",optgroup:"OptGroup",p:"Paragraph",q:"Quote",blockquote:"Quote",caption:"TableCaption",td:"TableCell",th:"TableCell",col:"TableCol",tr:"TableRow",tbody:"TableSection",thead:"TableSection",tfoot:"TableSection",textarea:"TextArea",ul:"UList"},yt=function(t){return t instanceof HTMLCollection},wt=function(t){return function(t){return!x(t)&&t.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(t)&&t instanceof DocumentFragment};function xt(t,e){if(!p(e))return null;var i=document.createElement("template");return i.innerHTML=e.trim(),i.content[t]}var Et=xt.bind(null,"firstChild"),At=xt.bind(null,"childNodes");function Nt(t){if(!vt(t))throw new Error("The given element is not a valid HTML Element");var e=t.getBoundingClientRect(),i=e.top,n=e.right,r=e.bottom,s=e.left;return i>=0&&s>=0&&r<=dt()&&n<=ut()}function Ot(t,e){if(!Q([t,e],vt))throw new Error("The given element is not a valid HTML Element");var i=t.getBoundingClientRect(),n=i.top,r=i.right,s=i.bottom,a=i.left,o=e.getBoundingClientRect(),l=o.top,h=o.right,c=o.bottom,u=o.left;return Q([[l,n],[u,a],[r,h],[s,c]],(function(t,e){return t<=e}))}function Mt(t,e){if(!Q([t,e],gt))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return t.insertAdjacentElement("beforebegin",e),t}function jt(t,e){if(!Q([t,e],gt))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return t.insertAdjacentElement("afterend",e),t}function Ct(t,e){if(!Q([t,e],gt))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return t.insertAdjacentElement("afterbegin",e),t}function Lt(t,e){if(!ft(t))throw new TypeError("Bad argument: The given `parent` is not a valid Node");if(!yt(e)&&!v(e))throw new TypeError("Bad argument: The given `children` is not a valid HTMLCollection/HTMLElement array");var i=wt(t)?t:document.createDocumentFragment();return Array.from(e).forEach((function(t){var e;x(t)||i.appendChild(ft(t)?t:(e=t.toString(),document.createTextNode(e.toString())))})),t!==i&&t.appendChild(i),t}function St(t,e,i){t[e]=i}function kt(t,e,i){t.setAttribute(e,i)}var Tt="accesskey,autocapitalize,class,dataset,editable,draggable,hidden,id,inputmode,lang,html,style,tabindex,text,title",Ut={accesskey:[St,"accessKey"],autocapitalize:[St,"autocapitalize"],class:[function(t,e){var i;if(!vt(t))throw new Error("Bad argument: The passed `element` argument is not a valid HTML Element");return(i=t.classList).add.apply(i,o(Array.isArray(e)?e:[e])),t}],dataset:[function(t,e,i){Object.assign(t[e],i)},"dataset"],draggable:[St,"draggable"],editable:[St,"contentEditable"],hidden:[St,"hidden"],id:[St,"id"],inputmode:[St,"inputMode"],lang:[St,"lang"],html:[St,"innerHTML"],style:[St,"style"],tabindex:[St,"tabIndex"],text:[St,"textContent"],title:[St,"title"],data:[St,"data"],cite:[St,"cite"],download:[St,"download"],ping:[St,"ping"],target:[St,"target"],coords:[St,"coords"],shape:[St,"shape"],autoplay:[St,"autoplay"],buffered:[St,"buffered"],controls:[St,"controls"],loop:[St,"loop"],muted:[St,"muted"],playsinline:[kt,"playsinline"],poster:[St,"poster"],preload:[St,"preload"],crossorigin:[St,"crossOrigin"],decoding:[St,"decoding"],height:[St,"height"],ismap:[St,"isMap"],loading:[St,"loading"],srcset:[St,"srcset"],width:[St,"width"],alt:[St,"alt"],as:[St,"as"],media:[St,"media"],rel:[St,"rel"],src:[St,"src"],sizes:[St,"sizes"],reversed:[St,"reversed"],start:[St,"start"],accept:[St,"accept"],"accept-charset":[St,"acceptCharset"],action:[St,"action"],autocomplete:[St,"autocomplete"],autofocus:[St,"autofocus"],capture:[St,"capture"],checked:[St,"checked"],cols:[St,"cols"],disabled:[St,"disabled"],dirname:[St,"dirName"],enctype:[St,"enctype"],for:[St,"for"],form:[St,"form"],formaction:[St,"formAction"],formenctype:[St,"formEnctype"],formmethod:[St,"formMethod"],formnovalidate:[St,"formNoValidate"],formtarget:[St,"formTarget"],high:[St,"high"],label:[St,"label"],list:[St,"list"],low:[St,"low"],max:[St,"max"],maxlength:[St,"maxLength"],method:[St,"method"],min:[St,"min"],minlength:[St,"minLength"],multiple:[St,"multiple"],name:[St,"name"],novalidate:[St,"noValidate"],optimum:[St,"optimum"],pattern:[St,"pattern"],placeholder:[St,"placeholder"],readonly:[St,"readOnly"],required:[St,"required"],rows:[St,"rows"],selected:[St,"selected"],size:[St,"size"],spellcheck:[kt,"spellcheck"],step:[St,"step"],wrap:[St,"wrap"],default:[St,"default"],kind:[St,"kind"],srclang:[St,"srclang"],abbr:[St,"abbr"],colspan:[St,"colSpan"],span:[St,"span"],rowspan:[St,"rowSpan"],scope:[St,"scope"],href:[St,"href"],hreflang:[St,"hreflang"],datetime:[St,"dateTime"],type:[St,"type"],value:[St,"value"],usemap:[St,"useMap"]};function It(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!vt(t))throw new Error("Bad argument: The given element argument is not a valid HTML Element");if(!m(e))return t;for(var n=function(t){return Tt.includes(t)||i.includes(t)},r=0,s=Object.keys(e);r<s.length;r++){var a=s[r];if(n(a)){var l=e[a],h=Ut[a].slice(0),c=h.shift();c.apply(void 0,[t].concat(o(h),[l]))}}return t}function _t(t,e){if(!vt(t,"select"))throw new Error("Bad argument: The given select argument is not a valid HTML Select element");if(x(e))throw new Error("The given value parameter is a null or undefined");for(var i=t.options,n=0;n<i.length;n++){var r=i[n];if(r.value===e.toString())return r.selected=!0,!0}return!1}function Ht(t,e,i){var n=document.createElement(t);return vt(n)?(m(i)&&It(n,i,c(e,"")),n):null}function Dt(t,e,i,n){var r=Ht(t,e,i);return vt(r)?(x(n)||vi(r,n),r):null}function Pt(t,e,i,n,r){var s=Ht(t,e,n);return vt(s)?(x(r)||vi(s,r,i),s):null}function Vt(t){var e=document.createDocumentFragment();return x(t)||vi(e,t),e}var Bt=function(t){return document.createTextNode(t)},Rt=Ht.bind(null,"link","as,crossorigin,disabled,href,hreflang,media,rel,sizes,type"),zt=Dt.bind(null,"template",""),$t=Dt.bind(null,"header",""),Ft=Dt.bind(null,"footer",""),qt=Dt.bind(null,"main",""),Wt=Dt.bind(null,"article",""),Xt=Dt.bind(null,"section",""),Yt=Dt.bind(null,"nav",""),Zt=Dt.bind(null,"aside",""),Gt=Dt.bind(null,"h1",""),Jt=Dt.bind(null,"h2",""),Kt=Dt.bind(null,"h3",""),Qt=Dt.bind(null,"h4",""),te=Dt.bind(null,"h5",""),ee=Dt.bind(null,"h6",""),ie=Dt.bind(null,"div",""),ne=Dt.bind(null,"object","data,height,name,type,usemap,width"),re=Ht.bind(null,"embed","height,src,type,width"),se=Ht.bind(null,"br",""),ae=Ht.bind(null,"hr",""),oe=Dt.bind(null,"p",""),le=Dt.bind(null,"blockquote","cite"),he=function(t){return vt(t,"li")?t:de(null,t)},ce=Pt.bind(null,"ul","",he),ue=Pt.bind(null,"ol","reversed,start,type",he),de=Dt.bind(null,"li","value"),pe=Dt.bind(null,"dl",""),fe=Dt.bind(null,"dt",""),me=Dt.bind(null,"dd",""),ge=Dt.bind(null,"a","download,href,hreflang,ping,rel,target,type"),ve=Ht.bind(null,"area","alt,coords,download,href,hreflang,media,ping,rel,shape,target"),be=Ht.bind(null,"base","href,target"),ye=Ht.bind(null,"img","alt,crossorigin,decoding,height,ismap,loading,sizes,src,srcset,usemap,width"),we=Dt.bind(null,"audio","autoplay,controls,crossorigin,loop,muted,preload,src"),xe=Dt.bind(null,"video","autoplay,controls,crossorigin,height,loop,muted,playsinline,poster,preload,src,width"),Ee=Ht.bind(null,"source","media,sizes,src,srcset,type"),Ae=Ht.bind(null,"track","default,kind,label,src,srclang"),Ne=Dt.bind(null,"picture",""),Oe=Dt.bind(null,"figure",""),Me=Dt.bind(null,"figcaption",""),je=Dt.bind(null,"span",""),Ce=Dt.bind(null,"strong",""),Le=Dt.bind(null,"em",""),Se=Dt.bind(null,"mark",""),ke=Dt.bind(null,"samp",""),Te=Dt.bind(null,"sub",""),Ue=Dt.bind(null,"sup",""),Ie=Dt.bind(null,"del","cite,datetime"),_e=Dt.bind(null,"ins","cite,datetime"),He=Dt.bind(null,"q","cite"),De=Dt.bind(null,"abbr",""),Pe=Dt.bind(null,"b",""),Ve=Dt.bind(null,"i",""),Be=Dt.bind(null,"s",""),Re=Dt.bind(null,"u",""),ze=Dt.bind(null,"cite",""),$e=Dt.bind(null,"time","datetime"),Fe=Dt.bind(null,"code",""),qe=Dt.bind(null,"form","accept-charset,action,autocomplete,enctype,method,name,novalidate,rel,target"),We=Ht.bind(null,"input","accept,alt,autocomplete,autofocus,capture,checked,dirname,disabled,height,max,maxlength,minlength,min,multiple,name,pattern,placeholder,readonly,required,size,src,step,type,value,width"),Xe=Dt.bind(null,"textarea","autocomplete,autofocus,cols,disabled,maxlength,minlength,name,placeholder,readonly,required,rows,spellcheck,value,wrap"),Ye=Dt.bind(null,"label","for"),Ze=Pt.bind(null,"select","autocomplete,autofocus,disabled,multiple,name,required,size",(function(t){return vt(t,["option","optgroup"])?t:Array.isArray(t)?Ke(null,t):Ge(null,t)})),Ge=Dt.bind(null,"option","disabled,label,selected,value"),Je=function(t){return vt(t,"option")?t:Ge(null,t)},Ke=Pt.bind(null,"optgroup","disabled,label",Je),Qe=Dt.bind(null,"fieldset","disabled,name"),ti=Dt.bind(null,"legend",""),ei=Pt.bind(null,"datalist","",Je),ii=Dt.bind(null,"meter","high,low,max,min,optimum,value"),ni=Dt.bind(null,"progress","max,value"),ri=Dt.bind(null,"output","name,value"),si=Dt.bind(null,"button","autofocus,disabled,formaction,formenctype,formmethod,formnovalidate,formtarget,name,type,value"),ai=Dt.bind(null,"table",""),oi=Dt.bind(null,"caption",""),li=function(t){return vt(t,"tr")?t:fi(null,t)},hi=Pt.bind(null,"thead","",li),ci=Pt.bind(null,"tbody","",li),ui=Pt.bind(null,"tfoot","",li),di=Ht.bind(null,"col","span"),pi=Pt.bind(null,"colgroup","span",(function(t){return vt(t,"col")?t:null})),fi=Pt.bind(null,"tr","",(function(t){return vt(t,["th","td"])?t:gi(null,t)})),mi=Dt.bind(null,"th","abbr,colspan,rowspan,scope"),gi=Dt.bind(null,"td","colspan,rowspan");function vi(t,e,i){var n=Array.isArray(e)?e:[e];return f(i)&&(n=n.map((function(t){return i(t)}))),Lt(t,n),t}var bi=function(t){return/^\.[a-zA-Z0-9_-]+$/.test(t)};function yi(t,e){var i=c(e,document);return y(t)?null:wt(i)?i.querySelector(t):function(t){return/^#[a-zA-Z0-9_-]+$/.test(t)}(t)?document.getElementById(t.substring(1)):bi(t)?i.getElementsByClassName(t.substring(1))[0]:i.querySelector(t)}function wi(t,e){var i=c(e,document);return y(t)?null:wt(i)?i.querySelectorAll(t):bi(t)?i.getElementsByClassName(t.substring(1)):i.querySelectorAll(t)}function xi(t,e){return"content"in document.createElement("template")?yi(t,e):null}function Ei(t,e){return t?document.importNode(t.content,c(e,!0)):t}function Ai(t,e,i){if(!vt(e))return null;var n=e[t];if(f(i))for(;gt(n)&&!i(n);)n=n[t];return n}var Ni=Ai.bind(null,"previousElementSibling"),Oi=Ai.bind(null,"nextElementSibling");function Mi(t,e,i){if(!gt(t))throw new TypeError("Bad argument: The given target parameter is not a valid HTML Element");if(!f(e))throw new TypeError("Bad argument: The given pred parameter is not a valid Function");var n=t.parentElement;return i>0?Ci(n,e,i-1):ji(n,e)}function ji(t,e){return x(t)?null:e(t)?t:ji(t.parentElement,e)}function Ci(t,e,i){return x(t)||0===i?null:e(t)?t:Ci(t.parentElement,e,i-1)}function Li(t,e){if(!ft(t))throw new TypeError("Bad argument: The given `node` is not a valid Node");return f(e)?(Array.from(t.childNodes).forEach((function(i){e(i)&&t.removeChild(i)})),t):function(t){for(;t.hasChildNodes();)t.removeChild(t.lastChild);return t}(t)}function Si(t){if(x(t))return!1;var e=Xe({value:vt(t)?t.textContent:t.toString(),readonly:!0});return!!vt(e)&&(document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),!0)}var ki=function(t){return t.classList.add("down")},Ti=function(t){return t.classList.remove("down")};function Ui(t){for(var e=wi(".form-label",t),i=0;i<e.length;i++){var n=e[i];if("placeholder"==n.dataset.type&&!y(n.htmlFor)){var r=yi("#".concat(n.htmlFor));vt(r)?y(r.placeholder)?(s(r,n),u(r.value)&&ki(n)):console.warn('%c@zenkai%c #FloatingLabel>%cfloatingLabel:%c Input "'.concat(n.htmlFor,'" contains a placeholder'),"text-decoration: underline","","font-weight: bold;","font-weight: normal;"):console.error('%c@zenkai%c #FloatingLabel>%cfloatingLabel:%c Missing input for label "'.concat(n.htmlFor,'"'),"text-decoration: underline","","font-weight: bold;","font-weight: normal;")}}function s(t,e){y(t.placeholder)&&(t.addEventListener("focus",(function(i){t.placeholder="",Ti(e),e.parentElement.classList.add("focused")})),t.addEventListener("blur",(function(t){u(this.value)&&ki(e),e.parentElement.classList.remove("focused")})),t.addEventListener("input",(function(i){document.activeElement!=t&&(u(this.value)?ki(e):Ti(e))})))}return e}function Ii(t){for(var e=wi("[data-counter]",t),i=0;i<e.length;i++){var n=e[i],r=n.dataset.counter,s=yi("#".concat(r));vt(s)?(n.dataset.counterMax=s.maxLength,n.dataset.counterVal=s.value.length,a(s,n)):console.error("%c@zenkai%c #InputCounter>%cinputCounter:%c Failed to add counter ".concat(r,". Input (referenced) was not found."),"text-decoration: underline","","font-weight: bold;","font-weight: normal;")}function a(t,e){t.addEventListener("input",(function(i){e.dataset.counterVal=t.value.length}))}return e}var _i=function(t){return t.dataset.type},Hi=function(t){return t.dataset.state},Di=function(t,e){return t.dataset.state=e},Pi=function(t,e){return Di(t,c(e,"checked"))},Vi=function(t,e){return Di(t,c(e,"unchecked"))};function Bi(t,e,i){if(vt(t))return e(t)?[t]:wi(i,t);if(p(t)&&!u(t)){var n=yi(t);return x(n)?null:Bi(n)}return x(t)?wi(i):null}function Ri(t,e){return y(e.htmlFor)?yi("input[type='".concat(c(t,"text"),"']"),e):yi("#".concat(e.htmlFor))}var zi="on",$i={init:function(t){return Object.assign(this,t),this.isChecked()&&Pi(this.container,zi),this},container:null,index:null,get value(){return this.container.dataset.value},isChecked:function(){return Hi(this.container)===zi},setChecked:function(t){return!x(t)&&(t?Pi(this.container,zi):Vi(this.container,"off"),!0)}},Fi={name:"selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(t){return this.items.includes(t)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=t,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var t=this.container.dataset.value,e=null,i=0;i<this.items.length;i++){var n=this.items[i];n.isChecked()&&this.setSelectedItem(n),n.value===t&&(e=n)}return b(this.selectedItem)&&!b(e)&&this.setSelectedItem(e),this.bindEvents(),this},bindEvents:function(){var t=this;this.container.addEventListener("click",(function(e){var i=e.target;if(V(i.dataset,"selector")){var n=!1;if(f(t.beforeChange)&&(n=!1===t.beforeChange(t,e)),!n){var r=t.items.find((function(t){return t.index===+c(i.dataset.selectorIndex,-1)}));x(r)||(t.setSelectedItem(r),f(t.afterChange)&&t.afterChange(t,e))}}}))}},qi={init:function(t){return Object.assign(this,t),this.isChecked()&&Pi(this.container,"on"),this},container:null,input:null,index:null,get value(){return this.input.value},isChecked:function(){return this.input.checked},setChecked:function(t){return!x(t)&&(t?(this.input.checked=!0,Pi(this.container,"on")):(this.input.checked=!1,Vi(this.container,"off")),!0)}},Wi={name:"form-selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(t){return this.items.includes(t)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=t,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var t=this.container.dataset.value,e=null,i=0;i<this.items.length;i++){var n=this.items[i];n.isChecked()&&this.setSelectedItem(n),n.value===t&&(e=n)}return b(this.selectedItem)&&!b(e)&&this.setSelectedItem(e),this.bindEvents(),this},bindEvents:function(){var t=this;this.container.addEventListener("change",(function(e){var i=e.target,n=!1;if(f(t.beforeChange)&&(n=!1===t.beforeChange(t,e)),n)return i.checked=!1,void t.items[t.selectedIndex].setChecked(!0);var r=t.items.find((function(t){return t.index===+c(i.dataset.selectorIndex,-1)}));x(r)||(t.setSelectedItem(r),f(t.afterChange)&&t.afterChange(t,e))}))}},Xi="BAD_CONTAINER",Yi=function(t){return'[data-type="'.concat(t.name,'"]')},Zi={BaseSelector:Yi(Fi),FormSelector:Yi(Wi)},Gi={create:function(t,e){if(!vt(t))return Xi;var i=wi("[data-selector]",t);if(!mt(i))return Xi;var n=null,r=null,s=_i(t);switch(s){case"selector":r=Ji(i,s,!1),n=Object.create(Fi);break;case"form-selector":r=Ji(i,s,!0),n=Object.create(Wi)}return Object.assign(n,e,{container:t,items:r,querySelector:Yi(n)}),n}};function Ji(t,e,i){for(var n=[],r={selector:function(){return Object.create($i)},"form-selector":function(){return Object.create(qi)}},s=0;s<t.length;s++){var a=t[s];a.dataset.selectorIndex=s;var o={container:a,index:s};if(i){var l=Ri("radio",a);if(!vt(l))return"BAD_INPUT";l.dataset.selectorIndex=s,Object.assign(o,{input:l})}var h=r[e]().init(o);n.push(h)}return n}var Ki={BAD_CONTAINER:new Error("Missing container: A selector requires a container"),BAD_INPUT:new Error("Missing input: FormSelector requires an input in the container")},Qi=function(t){return RegExp("selector|form-selector").test(t.dataset.type)},tn=[Zi.BaseSelector,Zi.FormSelector].join(",");function en(t,e){var i=Bi(t,Qi,tn),n=c(e,{});if(x(i))return null;for(var r=[],s=0;s<i.length;s++){var a=Gi.create(i[s],n);if(V(Ki,a))throw Ki[a];a.init(),r.push(a)}return r}var nn=Gi,rn={BAD_CONTAINER:new Error("Missing container: A switch requires a container"),BAD_INPUT:new Error("Missing input: FormSwitch requires an input in the container")},sn="on",an=function(t){return'[data-type="'.concat(t.name,'"]')},on=function(t){return RegExp("switch|form-switch").test(t.dataset.type)},ln=function(t,e){if(!vt(t))return"BAD_CONTAINER";var i=null,n=null;switch(_i(t)){case"switch":i=Object.create(hn);break;case"form-switch":if(n=Ri("checkbox",t),!vt(n))return"BAD_INPUT";e.input=n,i=Object.create(cn)}return Object.assign(i,e,{container:t,querySelector:an(i)}),i},hn={name:"switch",container:null,beforeChange:null,afterChange:null,get value(){return this.container.dataset.value},isChecked:function(){return Hi(this.container)===sn},setChecked:function(t){return!x(t)&&(t?Pi(this.container,sn):Vi(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(t){return Object.assign(this,t),this.isChecked()&&Pi(this.container,sn),this.bindEvents(),this},bindEvents:function(){var t=this;this.container.addEventListener("click",(function(e){var i=!1;f(t.beforeChange)&&(i=!1===t.beforeChange(t,e)),i||(t.toggle(),f(t.afterChange)&&t.afterChange(t,e))}))}},cn={name:"form-switch",container:null,input:null,beforeChange:null,afterChange:null,get value(){return this.input.value},isChecked:function(){return Hi(this.container)===sn},setChecked:function(t){return!x(t)&&(this.input.checked=t,t?Pi(this.container,sn):Vi(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(t){return Object.assign(this,t),this.input.checked&&this.setChecked(!0),this.bindEvents(),this},bindEvents:function(){var t=this;this.input.addEventListener("change",(function(e){var i=!1;f(t.beforeChange)&&(i=!1===t.beforeChange(t,e)),i?t.input.checked=!t.input.checked:(t.toggle(),f(t.afterChange)&&t.afterChange(t,e))}))}},un=[an(hn),an(cn)].join(",");function dn(t,e){var i=Bi(t,on,un),n=c(e,{});if(x(i))return null;for(var r=[],s=0;s<i.length;s++){var a=ln(i[s],n);if(V(rn,a))throw rn[a];a.init(),r.push(a)}return r}function pn(t){t.style.display="block"}function fn(t){t.style.display="none"}var mn={BAD_CONTAINER_COLLAPSIBLE:"BAD_CONTAINER_COLLAPSIBLE",BAD_CONTAINER_ACCORDION:"BAD_CONTAINER_ACCORDION"},gn={BAD_CONTAINER_COLLAPSIBLE:new Error("Missing container: A collapsible requires a container"),BAD_CONTAINER_ACCORDION:new Error("Missing container: An accordion requires a container")},vn="expanded",bn="collapsed",yn=function(t){return"collapsible"in t.dataset},wn=function(t){return"accordion"===t.dataset.boost},xn={create:function(t,e){if(!vt(t))return mn.BAD_CONTAINER_COLLAPSIBLE;var i=Object.create(this);return Object.assign(i,e,{container:t}),i},name:"collapsible",container:null,header:null,content:null,beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null,getState:function(){return this.container.dataset[this.name]},setState:function(t){this.container.dataset[this.name]=t},isCollapsed:function(){return this.getState()===bn},isExpanded:function(){return this.getState()===vn},isClosed:!1,isInitialized:!1,open:function(){if(this.isInitialized&&!this.isClosed)return this;var t=!1;return f(this.beforeOpen)&&(t=!1===this.beforeOpen(this)),t||(this.toggle(pn,vn,"add"),f(this.afterOpen)&&this.afterOpen(this),this.isClosed=!1),this},close:function(){if(this.isInitialized&&this.isClosed)return this;var t=!1;return f(this.beforeClose)&&(t=!1===this.beforeClose(this)),t||(this.toggle(fn,bn,"remove"),f(this.afterClose)&&this.afterClose(this),this.isClosed=!0),this},toggle:function(t,e,i){t(this.content),this.setState(e),this.container.classList[i]("expanded")},init:function(t){return Object.assign(this,t),this.header=yi("[data-".concat(this.name,"-header]"),this.container),this.content=yi("[data-".concat(this.name,"-content]"),this.container),this.isCollapsed()?this.close():this.isExpanded()&&(this.isClosed=!0,this.open()),this.bindEvents(),this.isInitialized=!0,this},bindEvents:function(){var t=this,e=this.container,i=this.header;i.addEventListener("click",(function(n){var r=Mi(n.target,(function(e){return t.name in e.dataset}));e===r&&(t.isCollapsed()?t.open():i.parentNode===e&&t.close())}))}},En={create:function(t,e){if(!vt(t))return mn.BAD_CONTAINER_ACCORDION;var i=Object.create(this);return Object.assign(i,e,{container:t}),i},container:null,sections:null,selectedSection:null,beforeChange:null,afterChange:null,init:function(){var t=this;this.sections=[];for(var e=wi("[data-accordion]",this.container),i=0;i<e.length;i++){var n=e[i],r=xn.create(n,{name:"accordion",index:i,afterOpen:function(e){f(t.beforeChange)&&t.beforeChange(e),t.sections.filter((function(t){return t.index!==e.index})).forEach((function(t){return t.close()})),f(t.afterChange)&&t.afterChange(e),t.selectedSection=e}});if(V(mn,r))return r;this.sections.push(r),r.init()}return this}};function An(t,e){var i=Bi(t,yn,"[data-collapsible]"),n=c(e,{});if(x(i))return null;for(var r=[],s=0;s<i.length;s++){var a=xn.create(i[s],n);if(V(gn,a))throw gn[a];a.init(),r.push(a)}return r}function Nn(t,e){var i=Bi(t,wn,"[data-boost=accordion]"),n=c(e,{});if(x(i))return null;for(var r=[],s=0;s<i.length;s++){var a=En.create(i[s],n);if(V(gn,a))throw gn[a];a.init(),r.push(a)}return r}var On=encodeURIComponent;function Mn(t){return t.toString().replace(/^(.*\/\/[^/?#]*).*$/,"$1")}function jn(t,e){var i=decodeURIComponent(window.location.search);if(y(i))return null;var n={};if("URLSearchParams"in window){var r,s=new URLSearchParams(i.substring(1)),a=function(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=l(t))){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){o=!0,s=t},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw s}}}}(s.entries());try{for(a.s();!(r=a.n()).done;){var o=r.value;n[o[0]]=o[1]}}catch(t){a.e(t)}finally{a.f()}return t?s.get(t):n}return i.substring(1).split("&").forEach((function(t){var e=t.split("=",2);n[e[0]]=e[1]})),t?c(n[t],e):n}function Cn(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];return Object.keys(t).forEach((function(n){e&&y(t[n])||i.push("".concat(On(n),"=").concat(On(t[n])))})),i.join("&")}},185:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AnchorHandler:()=>r});var n=i(835);const r={models:null,init(){this.models=new Map},create(t,e){return(0,n.isNullOrUndefined)(this.models)&&this.init(),(0,n.isNullOrUndefined)(this.models.get(e.id))?this.createModel(e.id,e.rtag,t):this.register(e.id,e.rtag,t),this.models.get(e.id)},createModel(t,e,i){const n=i.projection.environment.getActiveReceiver(e);let r=[];for(let e=0;e<n.items.length;e++)if(n.items[e].render.contains(i.container))return r.push({id:i.id,pId:n.items[e].render.dataset.id,holder:n.items[e].render,elem:i}),void this.models.set(t,{items:r,index:0})},register(t,e,i){let n=this.models.get(t);const r=i.projection.environment.getActiveReceiver(e);for(let t=0;t<r.items.length;t++)if(r.items[t].render.contains(i.container)){n.items.push({id:i.id,pId:r.items[t].render.dataset.id,holder:r.items[t].render,elem:i});break}for(let t=0;t<n.index;t++)i.nextAnchor(!1)},nextAnchor(t,e){let i=this.models.get(t);for(let t=0;t<i.items.length;t++){let n=i.items[t];n.id!==e&&n.elem.nextAnchor(!1)}i.index++},findSource(t,e){const i=this.models.get(t).items,r={};let s,a;for(s=0;s<i.length;s++){const t=i[s].elem,o=t.items;if(!(0,n.isNullOrUndefined)(o))for(a=0;a<o.length;a++)if(o[a].render.contains(e)){r.x=Number(o[a].render.getAttribute("x"))+Number(i[s].holder.getAttribute("x"))+Number((t.container||t.element).getAttribute("x")),r.y=Number(o[a].render.getAttribute("y"))+Number(i[s].holder.getAttribute("y"))+Number((t.container||t.element).getAttribute("y")),r.calc={projItems:{x:Number(o[a].render.getAttribute("x")),y:Number(o[a].render.getAttribute("y"))},holder:i[s].holder,proj:t};break}if(!(0,n.isNullOrUndefined)(r.x))break}let o=i[s].elem.anchors.indexes;const l=Number(i[s].elem.items[a].render.getAttribute("x")),h=Number(i[s].elem.items[a].render.getAttribute("y"));for(let t=0;t<o.length;t++)if(o[t].x===l&&o[t].y===h)return r.index=t,r},unregister(t,e){let i=this.models.get(t).listeners;for(let t=0;t<i.length;t++)if(i[t]===e)return void i.splice(t,1)},createSubModel(t,e){let i=this.models.get(t);(0,n.isNullOrUndefined)(i.subModels)&&(i.subModels=[]),i.subModels.push({elem:e,size:1})},registerSubModel(t,e,i){let r,s=this.models.get(t);for(let t=0;t<s.subModels.length;t++)s.subModels[t].elem===e&&(r=s.subModels[t]);(0,n.isNullOrUndefined)(r.start)&&(r.start=this.estimateStart(s,r.elem));const a=s.items;let o;for(let t=0;t<a.length;t++){const e=a[t].elem,r=e.items;if(!(0,n.isNullOrUndefined)(e.items)){for(let t=0;t<r.length;t++)if(r[t].render.contains(i.container||i.element)){o={},o.j=t,o.index=r[t].index;break}if(!(0,n.isNullOrUndefined)(o)){o.i=t;break}}}if(o.index>r.start+r.size){const t=a[o.i].elem.moveElemToAnchor(r.start+r.size,o.j);a.forEach((e=>{e.elem.increaseAnchors(r.start+r.size,o.index,t,s.forbiden)}))}else if(o.index<r.start+r.size){const t=a[o.i].elem.moveElemToAnchor(r.start+r.size-1,o.j);a.forEach((e=>{e.elem.decreaseAnchors(o.index,r.start+r.size,t,s.forbiden)})),r.start--}r.elem.increaseSize(),r.size++,(0,n.isNullOrUndefined)(s.listeners)||s.listeners.forEach((t=>{t.updateValue()}))},estimateStart(t,e){const i=t.items;for(let t=0;t<i.length;t++){const n=i[t].elem.items;for(let t=0;t<n.length;t++)if(n[t].render.contains(e.container))return t}},findTarget(t,e,i){const n=this.models.get(t).items;for(let t=0;t<n.length;t++){const r=n[t].elem,s=n[t].holder,a=r.anchors.indexes;if(s.dataset.concept===e)return{x:a[i].x+Number(s.getAttribute("x"))+Number((r.container||r.element).getAttribute("x")),y:a[i].y+Number(s.getAttribute("y"))+Number((r.container||r.element).getAttribute("y")),calc:{projItems:a[i],holder:s,proj:r}}}},estimatePositionCondamn(t,e){const i=this.models.get(t),r=i.items;for(let t=0;t<r.length;t++){const s=r[t].elem,a=s.items;if(!(0,n.isNullOrUndefined)(a))for(let o=0;o<a.length;o++)if(a[o].render.contains(e.container))return(0,n.isNullOrUndefined)(this.condamn)&&(i.condamn=[],i.forbiden=[]),i.condamn.push({index:o,elem:e}),i.forbiden.push(o),i.subModels.forEach((t=>{t.elem.container===e.container&&(t.start=a[o].index)})),{x:Number(a[o].render.getAttribute("x"))+Number(r[t].holder.getAttribute("x"))+Number((s.container||s.element).getAttribute("x")),y:Number(a[o].render.getAttribute("y"))+Number(r[t].holder.getAttribute("y"))+Number((s.container||s.element).getAttribute("y")),anchors:s.anchors.next}}},estimatePosition(t){const{projItems:e,holder:i,proj:n}=t;return{x:e.x+Number(i.getAttribute("x"))+Number((n.container||n.element).getAttribute("x")),y:e.y+Number(i.getAttribute("y"))+Number((n.container||n.element).getAttribute("y"))}},registerListener(t,e){let i=this.models.get(t);(0,n.isNullOrUndefined)(i.listeners)&&(i.listeners=[]),i.listeners.push(e)},deleteItem(t,e,i){const r=this.models.get(t);if(r.items.forEach((t=>{t.id!==e&&t.elem.removeAnchor(i)})),!(0,n.isNullOrUndefined)(r.condamn)){for(let t=0;t<r.subModels.length;t++)r.subModels[t].start<i&&r.subModels[t].start+r.subModels[t].size>i&&(r.subModels[t].size--,r.subModels[t].elem.decreaseSize());for(let t=0;t<r.condamn.length;t++){if(r.condamn[t].index>i){r.condamn[t].index--,r.condamn[t].elem.decreaseAnchor();for(let t=0;t<r.subModels.length;t++)r.subModels[t].elem===r.elem&&r.subModels[t].start--}r.condamn[t].index===i&&(r.condamn.splice(t,1),t--)}for(let t=0;t<r.forbiden.length;t++)r.forbiden[t]===i&&(r.forbiden.splice(t,1),t--)}r.index--,(0,n.isNullOrUndefined)(r.listeners)||r.listeners.forEach((t=>{t.updateValue()}))}}},127:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Simulation:()=>n});const n={notifyDimObservers(){isNullOrUndefined(this.observers)||this.observers.forEach((t=>{t.analyseContentDim()}))}}},241:(t,e,i)=>{"use strict";function n(t){let e=0;if(j(t))return t.selectionStart;if(0!==window.getSelection().rangeCount){const i=window.getSelection().getRangeAt(0),n=i.cloneRange();n.selectNodeContents(t),n.setEnd(i.endContainer,i.endOffset),e=n.toString().length}return e}i.d(e,{D3:()=>N,n_:()=>A,sr:()=>w,hi:()=>E,k$:()=>x,_b:()=>z,wo:()=>b,p$:()=>$,jn:()=>y,GV:()=>V,qO:()=>n,As:()=>_,NI:()=>O,EE:()=>D,GF:()=>P,Sd:()=>H,sB:()=>I,Cp:()=>u,CH:()=>f,xj:()=>M,u7:()=>j,QE:()=>C,n2:()=>R,a2:()=>L,fP:()=>B,Ys:()=>g,lL:()=>p,$Z:()=>c,ZN:()=>d,HW:()=>m,hF:()=>v});var r=i(835);const s="hidden",a="collapsed",o="highlighted",l="shake",h="selected";function c(t){return(0,r.isHTMLElement)(t)?(t.classList.remove(s),t):t}function u(t){return(0,r.isHTMLElement)(t)?(t.classList.add(s),t):t}function d(t){return(0,r.isHTMLElement)(t)?(t.classList.toggle(s),t):t}function p(t){t.classList.contains(l)||(t.classList.add(l),setTimeout((()=>{t.classList.remove(l)}),1e3))}function f(t){return(0,r.isHTMLElement)(t)?(t.classList.add(o),t):t}function m(t){return(0,r.isHTMLElement)(t)?(t.classList.remove(o),t):t}function g(t){return(0,r.isHTMLElement)(t)?(t.classList.add(h),t):t}function v(t){return(0,r.isHTMLElement)(t)?(t.classList.remove(h),t):t}function b(t){return(0,r.isHTMLElement)(t)&&t.classList.add(a),t}function y(t){return(0,r.isHTMLElement)(t)&&t.classList.remove(a),t}const w={backspace:"Backspace",tab:"Tab",enter:"Enter",ctrl:"Control",shift:"Shift",alt:"Alt",escape:"Escape",spacebar:" ",page_up:"PageUp",page_down:"PageDown",insert:"Insert",end:"End",home:"Home",left_arrow:"ArrowLeft",up_arrow:"ArrowUp",right_arrow:"ArrowRight",down_arrow:"ArrowDown",delete:"Delete",period:"."},x={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},E={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},A={AAC:{type:"audio/aac",extension:"aac"},BIN:{type:"application/octet-stream",extension:"bin"},JPEG:{type:"image/jpeg",extension:"jpeg"},JSON:{type:"application/json",extension:"json"},JSONCP:{type:"application/json",extension:"jsoncp"},MP3:{type:"audio/mpeg",extension:"mp3"},PDF:{type:"application/pdf",extension:"pdf"},SVG:{type:"image/svg+xml",extension:"svg"},TEXT:{type:"text/plain",extension:"txt"},XML:{type:"text/xml",extension:"xml"},ZIP:{type:"application/zip",extension:"zip"}},N={"audio/aac":"aac","application/octet-stream":"bin","image/jpeg":"jpeg","application/json":"json","audio/mpeg":"mp3","application/pdf":"pdf","image/svg+xml":"svg","text/plain":"txt","text/xml":"xml","application/zip":"zip"};function O(t){const e=t=>!(0,r.hasOwn)(t.dataset,"ignore");return e(t)?t:(0,r.findAncestor)(t,e,10)}function M(t){if(!r.isHTMLElement)throw new TypeError("Bad parameter");return t.hidden||"none"===window.getComputedStyle(t).display}const j=t=>(0,r.isHTMLElement)(t,["input","textarea"]),C=t=>j(t)||"true"===t.contentEditable,L=t=>+t.substring(0,t.indexOf("px")),S={top:t=>t.marginTop,right:t=>t.marginRight,bottom:t=>t.marginBottom,left:t=>t.marginLeft},k={top:t=>t.paddingTop,right:t=>t.paddingRight,bottom:t=>t.paddingBottom,left:t=>t.paddingLeft},T={top:t=>t.borderTopWidth,right:t=>t.borderRightWidth,bottom:t=>t.borderBottomWidth,left:t=>t.borderLeftWidth};function U(t,e,i){const n=window.getComputedStyle(t),r=window.getComputedStyle(e),s=S[i](n),a=k[i](r),o=T[i](r);return l=t.getBoundingClientRect()[i]+L(s),h=e.getBoundingClientRect()[i]-L(a)-L(o),Math.abs(l-h)<2;var l,h}function I(t){for(let e=0;e<t.children.length;e++){const i=t.children[e];if(!M(i))return i}return null}function _(t,e,i,n){return"up"===e?function(t,e,i=!0){const n=e.children,{top:r,left:s}=t.getBoundingClientRect();if(i&&U(t,e,"top"))return null;let a=null,o=99999,l=99999;for(let e=0;e<n.length;e++){const i=n[e];if(M(i)||i.classList.contains("badge")||i===t)continue;const{bottom:h,left:c}=i.getBoundingClientRect();let u=Math.abs(r-h),d=Math.abs(s-c);r>=h-1&&(u<o||u===o&&d<l)&&(a=i,o=u,l=d)}return a}(t,i,n):"down"===e?function(t,e,i=!0){const n=e.children,{bottom:r,left:s}=t.getBoundingClientRect();if(i&&U(t,e,"bottom"))return null;let a=null,o=99999,l=99999;for(let e=0;e<n.length;e++){const i=n[e];if(M(i)||i.classList.contains("badge")||i===t)continue;const{top:h,left:c}=i.getBoundingClientRect();let u=Math.abs(r-h),d=Math.abs(s-c);r<=h+1&&(u<o||u===o&&d<l)&&(a=i,o=u,l=d)}return a}(t,i,n):"left"===e?function(t,e,i=!0){const n=e.children,{top:r,left:s}=t.getBoundingClientRect();if(i&&U(t,e,"left"))return null;let a=null,o=99999,l=99999;for(let e=0;e<n.length;e++){const i=n[e];if(M(i)||i.classList.contains("badge")||i===t)continue;const{top:h,right:c}=i.getBoundingClientRect();let u=Math.abs(r-h),d=Math.abs(s-c);s>=c-1&&(d<l||d===l&&u<o)&&(a=i,o=u,l=d)}return a}(t,i,n):"right"===e?function(t,e,i=!0){const n=e.children,{top:r,right:s}=t.getBoundingClientRect();if(i&&U(t,e,"right"))return null;let a=null,o=99999,l=99999;for(let e=0;e<n.length;e++){const i=n[e];if(M(i)||i.classList.contains("badge")||i===t)continue;const{top:h,left:c}=i.getBoundingClientRect();let u=Math.abs(r-h),d=Math.abs(s-c);s<=c+1&&(d<l||d===l&&u<o)&&(a=i,o=u,l=d)}return a}(t,i,n):(console.error("unknown direction",e),null)}function H(t,e){const i=t.children,{top:n,left:s}=t.getBoundingClientRect();if(0===i.length)return null;const a=(0,r.isFunction)(e);let o=null,l=99999,h=99999;for(let t=0;t<i.length;t++){const r=i[t];if(a&&!e(r))continue;if(M(r)||r.classList.contains("badge"))continue;const{top:c,left:u}=r.getBoundingClientRect();let d=Math.abs(n-c),p=Math.abs(s-u);n<=c+1&&(d<l||d===l&&p<h)&&(o=r,l=d,h=p)}return o}function D(t,e){const i=t.children,{top:n,left:s}=t.getBoundingClientRect();if(0===i.length)return null;const a=(0,r.isFunction)(e);let o=null,l=99999,h=99999;for(let t=0;t<i.length;t++){const r=i[t];if(a&&!e(r))continue;if(M(r)||r.classList.contains("badge"))continue;const{top:c,left:u}=r.getBoundingClientRect();let d=Math.abs(n-c),p=Math.abs(s-u);s<=u+1&&(p<h||p===h&&d<l)&&(o=r,l=d,h=p)}return o}function P(t,e){const i=t.children,{top:n,right:s}=t.getBoundingClientRect();if(0===i.length)return null;const a=(0,r.isFunction)(e);let o=null,l=99999,h=99999;for(let t=0;t<i.length;t++){const r=i[t];if(a&&!e(r))continue;if(M(r)||r.classList.contains("badge"))continue;const{top:c,right:u}=r.getBoundingClientRect();let d=Math.abs(n-c),p=Math.abs(s-u);s>=u-1&&(p<h||p===h&&d<l)&&(o=r,l=d,h=p)}return o}function V(t,e){const i=t.children,{bottom:n,left:s}=t.getBoundingClientRect();if(0===i.length)return null;const a=(0,r.isFunction)(e);let o=null,l=99999,h=99999;for(let t=0;t<i.length;t++){const r=i[t];if(a&&!e(r))continue;if(M(r)||r.classList.contains("badge"))continue;const{bottom:c,left:u}=r.getBoundingClientRect();let d=Math.abs(n-c),p=Math.abs(s-u);n>=c-1&&(d<l||d===l&&p<h)&&(o=r,l=d,h=p)}return o}function B(t){return(0,r.isHTMLElement)(t)?t:(0,r.isString)(t)&&!(0,r.isNullOrWhitespace)(t)?(0,r.getElement)(t):null}function R(t,e={}){const i=B(t);if(!(0,r.isHTMLElement)(i))return null;const n=Object.assign({horizontal:!0,vertical:!0,minWidth:60,minHeight:60},e),s=function(){let t=(0,r.createDiv)({class:["resizers"]});return["horizontal","vertical"].forEach((e=>{t.append((0,r.createDiv)({class:["resizer",`${e}`],dataset:{dir:e}}))})),t}();i.prepend(s),n.horizontal&&n.vertical?i.dataset.resizable="both":n.horizontal?i.dataset.resizable="horizontal":n.vertical&&(i.dataset.resizable="vertical");const{minWidth:a,minHeight:o}=getComputedStyle(i),l=(0,r.valOrDefault)(L(a),n.minWidth),h=(0,r.valOrDefault)(L(o),n.minHeight);let c=0,u=null;function d(t){const{dir:e}=u.dataset,{width:n,height:r}=getComputedStyle(i);let s="horizontal"===e?t.pageX:t.pageY;if("horizontal"===e){const t=L(n)+(s-c);t>l&&(i.style.width=`${t}px`)}else if("vertical"===e){const t=L(r)+(s-c);t>h&&(i.style.height=`${t}px`)}c=s}for(let t=0;t<s.childElementCount;t++){const e=s.children[t];e.addEventListener("mousedown",(function(t){t.preventDefault(),u=e;const{dir:i}=u.dataset;c="horizontal"===i?t.pageX:t.pageY,document.body.addEventListener("mousemove",d),document.body.addEventListener("mouseup",(()=>{document.body.removeEventListener("mousemove",d)}))}))}return i}const z=t=>(0,r.createStrong)({class:["text-bf"]},t).outerHTML,$=t=>JSON.parse(JSON.stringify(t));i(914)},914:(t,e,i)=>{"use strict";i.d(e,{h:()=>n});const n=function(){var t={},e=[];for(let t=0;t<256;t++)e[t]=t<16?"0"+t.toString(16):t.toString(16);return t.generate=function(){var t=4294967296*Math.random()>>>0,i=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0,r=4294967296*Math.random()>>>0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]},t}()}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{activateEditor:()=>qa,createEditor:()=>Wa});var t=n(835),e=n(241);const s={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,t.isNullOrUndefined)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,e.Cp)(this.placeholder),(0,e.$Z)(this.conceptList)):(this.container.classList.add("empty"),(0,e.$Z)(this.placeholder),(0,e.Cp)(this.conceptList)),this.hasSelection||(0,e.Cp)(this.infoView),this},render(){return this.container=(0,t.createDiv)({class:["editor-config"]}),this.mainView=(0,t.createDiv)({class:["editor-config-main"]}),this.infoView=(0,t.createDiv)({class:["editor-config-info"]}),this.conceptList=(0,t.createUnorderedList)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,t.createParagraph)({class:["editor-config-placeholder"],html:`${(0,e._b)("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,t.removeChildren)(this.conceptList),(0,t.removeChildren)(this.infoView),this.cache.clear(),this.refresh()},selectItem(e){if(!this.cache.has(e))return null;let i=this.cache.get(e);return(0,t.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.refresh(),e},show(){return(0,e.$Z)(this.container),this.visible=!0,this},hide(){return(0,e.Cp)(this.container),this.visible=!1,this},showInfo(i){let n=a(this.editor.conceptModel.getCompleteModelConcept(i),(0,t.getTemplate)("#concept-schema"));(0,t.removeChildren)(this.infoView).append(n),(0,e.$Z)(this.infoView)},addItem(e){let i=(0,t.createSpan)({class:["loaded-element-name","fit-content"]},e.name),n=(0,t.createListItem)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:e.name,status:"active"}}),r=(0,t.createButton)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:e.name}});n.append(i,r),this.conceptList.append(n),this.cache.set(e.name,n),this.refresh()},bindEvents(){}};function a(e,i){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad argument: The 'schema' is missing");if(!(0,t.isHTMLElement)(i))throw new TypeError("Bad argument: The given 'template' is not a valid HTML Element");const n=(0,t.cloneTemplate)(i);return(0,t.getElements)("[data-if]",n).forEach(((i,n)=>{let r=i.dataset.if;(0,t.hasOwn)(e,r)||i.remove()})),(0,t.getElements)("[data-name]",n).forEach(((t,i)=>{let n=t.dataset.name;t.textContent=e[n]})),(0,t.getElements)("[data-attr]",n).forEach(((t,i)=>{let n=t.dataset.attr,[r,s]=n.split(":"),a=(t=>t.startsWith("$")?e[t.substring(1)]:t)(s);delete t.dataset.attr,t.dataset[r]=a})),(0,t.getElements)("[data-bind]",n).forEach(((i,n)=>{let r=i.dataset.bind;if(!(0,t.hasOwn)(e,r))return;let s=(0,t.getElement)("[data-item]",i),o=s.dataset.item,l=(0,t.getTemplate)(`#${o}`);e[r].forEach((t=>{s.append(a(t,l))}))})),n}const o={PRIMITIVE:"E",CONCRETE:"C",PROTOTYPE:"P",DERIVATIVE:"D"},l={file:null,title:null,status:null,container:null,mainView:null,infoView:null,files:null,btnLoad:null,btnLoadConcept:null,btnLoadProjection:null,btnUnload:null,btnDownload:null,btnEdit:null,selection:null,concepts:null,selectedConcept:null,attributes:null,filter:null,init(){return this.concepts=new Map,this.attributes=new Map,this.filter=Object.create(u,{editor:{value:this.editor},settings:{value:this}}).init([{label:"Concrete",nature:"concrete"},{label:"Prototype",nature:"prototype"},{label:"Derivative",nature:"derivative"}]),this},get hasFile(){return this.concepts.size>0},get hasSelection(){return!(0,t.isNullOrUndefined)(this.selection)},getFile(){return this.file},setFile(t){this.file=t,this.refresh()},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,e.$Z)(this.files)):(this.container.classList.add("empty"),(0,e.Cp)(this.files)),this.btnUnload.disabled=!this.hasFile,this.editor.isReady?((0,e.Cp)(this.placeholder),this.placeholder.classList.remove("error")):this.hasFile?(this.editor.hasConceptModel||(this.placeholder.innerHTML=`${(0,e._b)("Missing projections")}`),this.editor.hasProjectionModel||(this.placeholder.innerHTML=`${(0,e._b)("Missing projections")}`),this.placeholder.classList.add("error"),(0,e.$Z)(this.placeholder)):(this.placeholder.innerHTML=`Add your ${(0,e._b)("concepts")} and ${(0,e._b)("projections")} or load a previously saved ${(0,e._b)("model")}`,this.placeholder.classList.remove("error")),this.hasSelection?(0,e.$Z)(this.infoView):(0,e.Cp)(this.infoView),this},reload(){this.editor.hasConceptModel?(this.editor.conceptModel.schema.forEach((e=>{let i=(0,t.createListItem)({class:["editor-file-concept"],dataset:{name:e.name,nature:e.nature,root:(0,t.valOrDefault)(e.root,"false")}},e.name);if(e.root){let e=(0,t.createI)({class:["editor-file-concept-root"],title:"root concept"});i.append(e)}this.concepts.set(e.name,i),this.files.append(i)})),this.refresh()):this.clear()},render(){this.container=(0,t.createDiv)({class:["editor-file"]});let i=(0,t.createDiv)({class:["editor-file-actionbar"]});this.btnOpen=(0,t.createButton)({class:["btn","editor-file__browse-button"],title:"Open a model",dataset:{action:"load"}},"Open"),this.btnLoad=h("load","Browse","Load file in editor");let n=(0,t.createDiv)({class:["editor-file-modactions"]});return this.btnLoadConcept=h("load-concept","Concept","Load some concepts into the editor"),this.btnLoadProjection=h("load-projection","Projection","Load some projections into the editor"),this.btnUnload=(0,t.createButton)({class:["btn","editor-file-actionbar__button","editor-file-actionbar__btn-remove"],title:"Remove all files",dataset:{action:"unload"}}),n.append(this.btnLoadConcept,this.btnLoadProjection,this.btnUnload),i.append(n),this.mainView=(0,t.createDiv)({class:["editor-file-mainview"]}),this.files=(0,t.createUnorderedList)({class:["bare-list","editor-file__list"]}),this.infoView=(0,t.createDiv)({class:["detail-area","editor-file-detail"]}),this.placeholder=(0,t.createParagraph)({class:["editor-file-placeholder"],html:`Add your ${(0,e._b)("concepts")}, ${(0,e._b)("projections")} and all other ${(0,e._b)("resources")}`}),this.mainView.append(this.filter.render(),this.files,this.infoView),this.container.append(i,this.mainView),this.bindEvents(),this.refresh(),this.container},clear(){(0,t.removeChildren)(this.files)},show(){return(0,e.$Z)(this.container),this.visible=!0,this},hide(){return(0,e.Cp)(this.container),this.visible=!1,this},selectItem(e){let i=this.concepts.get(e);(0,t.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.displayInfo(e),this.refresh()},displayConcept(e){if((0,t.isNullOrUndefined)(e))return;let i=this.editor.conceptModel.getConceptSchema(e);if((0,t.isNullOrUndefined)(i))return;this.selection=e;const{name:n,nature:r,attributes:s}=i;let a=(0,t.createDiv)({class:["app-model-concept"]}),l=(0,t.createDiv)({class:["app-model-concept-header"]}),h=(0,t.createUnorderedList)({class:["bare-list","app-model-concept-menu"]}),u=(0,t.createListItem)({class:["app-model-concept-menu-item","selected"],dataset:{action:"nav-structure"}},"Structure"),d=(0,t.createListItem)({class:["app-model-concept-menu-item"],dataset:{action:"nav-projections"}},"Projections");h.append(u,d);let p=(0,t.createI)({class:["app-model-concept-nature"],dataset:{name:r}},o[r.toUpperCase()]),f=(0,t.createSpan)({class:["app-model-concept-name"]},n);l.append(p,f);let m=(0,t.createDiv)({class:["app-model-concept-body"]}),g=(0,t.createUnorderedList)({class:["bare-list","app-model-concept-attributes"]}),v=(0,t.createUnorderedList)({class:["bare-list","app-model-concept-projections","hidden"]});Array.isArray(s)&&s.forEach((e=>{let i=(0,t.createListItem)({class:["app-model-concept-attribute"],dataset:{name:e.name,type:"attribute"}}),n=(0,t.createDiv)({class:["app-model__attribute-header"]}),r=(0,t.createSpan)({class:["app-model__attribute-name"]},e.name);if(e.required){let e=(0,t.createI)({class:["app-model__attribute-required"]},(0,t.createSpan)({class:["help"]},"required"));n.append(e)}n.append(r);let s=(0,t.createDiv)({class:["app-model__attribute-target"]},c(e.target)),a=(0,t.createDiv)({class:["app-model__attribute-info"]},[n,s]);i.append(a),this.attributes.set(e.name,i),g.append(i)})),m.append(g,v),a.append(l,m),(0,t.removeChildren)(this.infoView),this.infoView.append(a),this.selectedConcept=i,this.selectedConceptAttrs=g,this.selectedConceptProjs=v,this.refresh()},showStructure(){(0,e.$Z)(this.selectedConceptAttrs),(0,e.Cp)(this.selectedConceptProjs)},showProjections(){(0,e.Cp)(this.selectedConceptAttrs),(0,e.$Z)(this.selectedConceptProjs)},selectAttribute(e){return!(0,t.isNullOrUndefined)(e)&&(this.selectedAttribute!==e&&(this.selectedAttribute&&this.attributes.get(this.selectedAttribute).classList.remove("selected"),!!this.attributes.has(e)&&(this.selectedAttribute=e,this.attributes.get(e).classList.add("selected"),this.displayAttribute(e),this.refresh(),!0)))},displayAttribute(t){this.refresh()},bindEvents(){this.editor.registerHandler("editor.load-concept@post",(t=>{this.reload()})),this.editor.registerHandler("editor.unload-concept@post",(t=>{this.reload()})),this.editor.registerHandler("editor.unload-projection@post",(t=>{this.reload()})),this.container.addEventListener("dragenter",(t=>{this.container.classList.add("highlight"),t.preventDefault(),t.stopPropagation()}),!1),this.container.addEventListener("dragleave",(t=>{this.container.classList.remove("highlight"),t.preventDefault(),t.stopPropagation()}),!1),this.container.addEventListener("dragover",(t=>{this.container.classList.add("highlight"),t.preventDefault(),t.stopPropagation()}),!1),this.container.addEventListener("drop",(t=>{this.container.classList.remove("highlight");let e=t.dataTransfer.files[0];if(!e.name.endsWith(".json"))return void this.notify("This file is not supported. Please use a .json file");let i=new FileReader;i.onload=t=>{this.editor.load(i.result,this.type)},i.readAsText(e),t.preventDefault(),t.stopPropagation()}),!1),this.container.addEventListener("click",(t=>{const{target:e}=t,{type:i,action:n,name:r}=e.dataset;"nav-structure"===n?this.showStructure():"nav-projections"===n&&this.showProjections(),this.displayConcept(r),"attribute"===i?this.selectAttribute(r):"concept"===i&&this.parent.selectConcept(r)}))}};function h(e,i,n){return(0,t.createButton)({class:["btn","editor-file__browse-button"],title:n,dataset:{action:e},html:`\n            <span class="editor-home__btn-browse-icon" data-ignore="all">+</span> \n            <span class="editor-home__btn-browse-text" data-ignore="all">${i}</span>\n        `})}function c(e){const i=(0,t.createDocFragment)();if((0,t.isNullOrUndefined)(e))return i;const{name:n,accept:r}=e;let s=(0,t.createSpan)({class:["target-name"],dataset:{type:"concept",name:n}},n);if(i.append(s),r){let e=(0,t.createDiv)({class:["target-accept"]});Array.isArray(r)?(e.append(...r.map((t=>c(t)))),e.classList.add("array")):e.append(c(r)),i.append(e)}return i}const u={container:null,values:null,filters:null,concepts:null,init(e){this.values=(0,t.valOrDefault)(e,[]);let i=1;return this.values.forEach((t=>{t.id=i++})),this.filters=new Map,this},refresh(){this.filters.forEach(((t,e)=>{t.checked?t.parentElement.classList.add("checked"):t.parentElement.classList.remove("checked")}))},render(){return(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:"concept-filter"})),this.search=(0,t.createInput)({class:["concept-filter-search"]}),this.values.forEach((e=>{let i=(0,t.createInput)({class:["cf-option-checkbox"],type:"checkbox",checked:!0,value:e.id}),n=(0,t.createSpan)({class:["cf-option-text"]},e.label),r=(0,t.createLabel)({class:"concept-filter-option"},[i,n]);this.filters.set(e,i),this.container.append(r)})),this.bindEvents(),this.refresh(),this.container},filterConcepts(){this.settings.concepts.forEach(((i,n)=>{const{nature:r,root:s}=i.dataset;this.filters.forEach(((n,a)=>{a.nature===r&&(n.checked?(0,e.$Z)(i):(0,e.Cp)(i)),a.root===(0,t.toBoolean)(s)&&(n.checked?(0,e.$Z)(i):(0,e.Cp)(i))}))})),this.refresh()},bindEvents(){this.container.addEventListener("change",(t=>{const{target:e}=t;this.filterConcepts()}))}},p={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,t.isNullOrUndefined)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),(0,e.Cp)(this.placeholder),(0,e.$Z)(this.conceptList)):(this.container.classList.add("empty"),(0,e.$Z)(this.placeholder),(0,e.Cp)(this.conceptList)),this.hasSelection||(0,e.Cp)(this.infoView),this},render(){return this.container=(0,t.createDiv)({class:["editor-config"]}),this.mainView=(0,t.createDiv)({class:["editor-config-main"]}),this.infoView=(0,t.createDiv)({class:["editor-config-info"]}),this.conceptList=(0,t.createUnorderedList)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,t.createParagraph)({class:["editor-config-placeholder"],html:`${(0,e._b)("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,t.removeChildren)(this.conceptList),(0,t.removeChildren)(this.infoView),this.cache.clear(),this.refresh()},selectItem(e){if(!this.cache.has(e))return null;let i=this.cache.get(e);return(0,t.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=i,this.selection.classList.add("selected"),this.refresh(),e},show(){return(0,e.$Z)(this.container),this.visible=!0,this},hide(){return(0,e.Cp)(this.container),this.visible=!1,this},addItem(e){let i=(0,t.createSpan)({class:["loaded-element-name","fit-content"]},e.name),n=(0,t.createListItem)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:e.name,status:"active"}}),r=(0,t.createButton)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:e.name}});n.append(i,r),this.conceptList.append(n),this.cache.set(e.name,n),this.refresh()},bindEvents(){}},f={menu:null,schema:null,isOpen:!1,visible:!0,btnStart:null,settings:null,init(t){return t&&(this.schema=t),this},get isRendered(){return(0,t.isHTMLElement)(this.container)},clear(){return(0,t.removeChildren)(this.container),this},update(){},render(){const e=(0,t.createDocFragment)();if(!(0,t.isHTMLElement)(this.container)){this.container=(0,t.createDiv)({class:["editor-home"]});let e=(0,t.createImage)({class:["editor-logo"],src:"https://gentlemancp.org/assets/images/logo_gentleman_200.png"}),i=(0,t.createH2)({class:["editor-title"]},"Settings"),n=(0,t.createDiv)({class:["editor-home-header"]},[e,i]);this.container.append(n)}return(0,t.isHTMLElement)(this.menu)||(this.menu=Object.create(m,{editor:{value:this.editor}}).init(),e.append(this.menu.render())),(0,t.isHTMLElement)(this.btnStart)||(this.btnStart=(0,t.createButton)({class:["btn","editor-home-section--model__button","editor-home-section__button--start"],dataset:{action:"close",context:"home"}},"Done!"),e.append(this.btnStart)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){const{hasConceptModel:t,hasProjectionModel:e}=this.editor;return this.btnStart.disabled=!(t&&e),this},actionHandler(t,e){const{concept:i}=e.dataset;"open-concept"===t&&(this.menu.config.selectItem(i),this.menu.config.showInfo(i))},bindEvents(){this.editor.registerHandler("concept-model.updated",(()=>{this.menu.config.clear(),this.editor.hasConceptModel&&this.editor.conceptModel.schema.filter((t=>t.root)).forEach((t=>{this.menu.config.addItem(t)}))}))}},m={container:null,tabsElement:null,tabs:null,currentTab:null,activeTab:null,fileIO:null,config:null,dataSettings:null,buildSettings:null,init(){return this.tabs=new Map,this.tabs.set("file","File"),this.tabs.set("config","Config"),this.currentTab="file",this},refresh(){},render(){return this.container=(0,t.createSection)({class:["editor-home-menu"]}),this.tabsElement=(0,t.createUnorderedList)({class:["bare-list","editor-home-menu-tabs"]}),this.tabs.forEach(((e,i)=>{let n=(0,t.createListItem)({class:["editor-home-menu-tab"],dataset:{name:i}},e);this.tabs.set(i,n),this.tabsElement.append(n)})),this.window=(0,t.createDiv)({class:["editor-home-menu-section"]}),this.fileIO=g.call(this),this.config=v.call(this),this.dataSettings=b.call(this),this.window.append(this.fileIO.render()),this.window.append(this.config.render()),this.window.append(this.dataSettings.render()),this.selectTab(this.currentTab),this.container.append(this.tabsElement,this.window),this.bindEvents(),this.container},selectTab(i){(0,t.isNullOrUndefined)(i)||this.activeTab&&this.currentTab===i||("file"===i?(this.fileIO.show(),this.config.hide(),this.dataSettings.hide()):"config"===i&&(this.config.show(),this.fileIO.hide(),this.dataSettings.hide()),this.activeTab&&(0,e.hF)(this.activeTab),this.currentTab=i,this.activeTab=this.tabs.get(this.currentTab),(0,e.Ys)(this.activeTab))},bindEvents(){this.tabsElement.addEventListener("click",(t=>{const{target:e}=t,{name:i}=e.dataset;this.selectTab(i)}))}};function g(t){const e=Object.create(l,{editor:{value:this.editor}});return e.init(),e}function v(){const t=Object.create(s,{editor:{value:this.editor}});return t.init(),t}function b(){const t=Object.create(p,{editor:{value:this.editor}});return t.init(),t}function y(e,i){const{name:n,object:r,id:s}=i,a=(0,t.createListItem)({class:["selector-concept",`selector-concept--${e}`],title:i.getName(),dataset:{concept:s,object:r}});var o=(0,t.createSpan)({class:["selector-concept-content"]},i.getName());a.append(o),"ancestor"===e&&o.classList.add("fit-content");const l=(0,t.createI)({class:["selector-concept-status"]});if(i.hasError){l.classList.add("error");let e=(0,t.createUnorderedList)({class:["bare-list","selector-concept-status__errors"]});i.errors.forEach((i=>{let n=(0,t.createListItem)({class:["selector-concept-status__error"]},i);n.style.minWidth=`${Math.min(.5*i.length,30)}em`,e.append(n)})),l.append(e),a.classList.add("error")}else l.classList.add("valid"),a.classList.add("valid");return a.append(l),a.addEventListener("mouseenter",(e=>{let i=(0,t.getElement)(`.projection[data-concept="${s}"]`,this.editor.body);i&&this.editor.highlight(i)})),a.addEventListener("mouseleave",(t=>{this.editor.unhighlight()})),a.addEventListener("click",(e=>{let i=(0,t.getElement)(`.projection[data-concept="${s}"]`,this.editor.body);i&&i.focus()})),a}const w={container:null,title:null,conceptList:null,header:null,body:null,get isRendered(){return(0,t.isHTMLElement)(this.container)},init(t={}){return this.schema=t,this},update(){},refresh(){const{activeInstance:e,activeConcept:i,hasActiveInstance:n,hasActiveConcept:r}=this.editor;if(!n||!r)return(0,t.removeChildren)(this.conceptList),this;const s=e.concept,a=(0,t.createDocFragment)();let o=y.call(this,"root",s);if(a.append(o),s===i&&o.classList.add("selector-concept--active"),s===i)return(0,t.removeChildren)(this.conceptList).append(a),this;if(!i.hasParent())return(0,t.removeChildren)(this.conceptList).append(a),this;let l=i.getParent(),h=[];for(;l&&l!==s;)h.unshift(l),l=l.getParent();return h.forEach((t=>{a.append(y.call(this,"ancestor",t))})),o=y.call(this,"active",i),a.append(o),(0,t.removeChildren)(this.conceptList).append(a),this},render(){const e=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["editor-breadcrumb"]})),(0,t.isHTMLElement)(this.notification)||(this.notification=(0,t.createDiv)({class:["notification","breadcrumb-notification"]}),e.append(this.notification));const i=(0,t.createSpan)({class:["breadcrumb-title","hidden"],dataset:{ignore:"all"}},"Breadcrumb");return e.append(i),(0,t.isHTMLElement)(this.conceptList)||(this.conceptList=(0,t.createUnorderedList)({class:["bare-list","selector-concepts"]}),e.append(this.conceptList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.update(),this.refresh(),this.container},bindEvents(){}},x={schema:null,isOpen:!1,visible:!0,btnStart:null,logList:null,init(t){return t&&(this.schema=t),this},get isRendered(){return(0,t.isHTMLElement)(this.container)},add(i,n,r=e.hi.NORMAL){if(!Array.isArray(i))return;let s=(0,t.createUnorderedList)({class:["bare-list","log-item-messages"]});i.forEach((e=>s.append((0,t.createListItem)({class:["log-item-message"]},e))));let a=(0,t.createListItem)({class:["log-item",`log-item--${r}`]}),o=(0,t.createButton)({class:["btn","btn-delete"],dataset:{action:"delete",target:"parent"}},"✖"),l=(0,t.createSpan)({class:["log-item__name"],dataset:{action:"delete",target:"parent"}},`${(0,t.valOrDefault)(n,"Log")} (${(0,t.shortDateTime)(Date.now())})`);return a.append(o,l,s),this.logList.append(a),this.refresh(),this},clear(){return(0,t.removeChildren)(this.logList),this},update(){},render(){const e=(0,t.createDocFragment)();return(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["editor-log"]})),(0,t.isHTMLElement)(this.logList)||(this.logList=(0,t.createUnorderedList)({class:["bare-list","log-list"]}),e.append(this.logList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this.logList.hasChildNodes()?this.show():this.hide(),this},bindEvents(){}},E={modelstatus:null,editorstatus:null,notification:null,views:null,view:"grid",viewContainer:null,viewList:null,viewItem:null,activeViewItem:null,groupList:null,groupItem:null,activeGroupItem:null,visible:!0,container:null,get isRendered(){return(0,t.isHTMLElement)(this.container)},init(){return this.views=new Map,this},show(){return(0,e.$Z)(this.container),this.visible=!0,this},hide(){return(0,e.Cp)(this.container),this.visible=!1,this},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},updateActiveView(){"tab"===this.view&&(this.editor.instances.forEach((t=>{t!==this.editor.activeInstance&&(t.view.classList.remove("active"),t.hide())})),this.editor.activeInstance.view.classList.add("active"),this.editor.activeInstance.show()),this.editor.refresh()},addView(e){if((0,t.isNullOrUndefined)(e))return!1;let i=e.title.textContent,n=(0,t.createI)({class:["ico","ico-delete"]},"✖"),r=(0,t.createButton)({class:["btn","btn-close"]},n),s=(0,t.createDiv)({class:[`editor-view-${this.view}list-item__content`,"fit-content"]},i),a=(0,t.createListItem)({class:[`editor-view-${this.view}list-item`],title:e.title.textContent},[s,r]);e.view=a,a.addEventListener("click",(i=>{if(function(e){const i=t=>t===a||t===r;return i(e)?e:(0,t.findAncestor)(e,(t=>i(t)),5)}(i.target)===r){let t=a.previousSibling||a.nextSibling;e.delete(),null===this.editor.activeInstance&&t&&t.click()}else this.editor.updateActiveInstance(e)})),this.tabView.append(a)},changeView(i){if(i===this.view)return this;this.view=i,(0,e.hF)(this.viewItem),this.viewItem=this.views.get(this.view),(0,e.Ys)(this.viewItem),(0,t.removeChildren)(this.editor.viewSection),"tab"===i?(this.tabView=(0,t.createUnorderedList)({class:["bare-list","editor-view-tablist"]}),(0,t.removeChildren)(this.tabView),this.editor.instances.forEach((t=>{t.expand(),this.addView(t)})),this.editor.viewSection.append(this.tabView)):"grid"===i&&this.editor.instances.forEach((t=>{t.show()})),this.updateActiveView()},addGroup(){(0,t.createListItem)({class:["editor-footer-group"]})},notify(e,i=4500){let n=e;const r="open";if(this.notification.classList.contains(r))return!1;this.notification.appendChild(n),setTimeout((()=>{this.notification.classList.add(r),this.container.classList.add("menu--notifying")}),50),setTimeout((()=>{this.notification.classList.remove(r),this.container.classList.remove("menu--notifying"),setTimeout((()=>{(0,t.removeChildren)(this.notification)}),500)}),i)},refresh(){const{conceptModel:e}=this.editor;if(this.editor.isReady){if(e.hasError){this.modelstatusBadge.classList.add("error"),this.modelstatusBadge.classList.remove("valid"),this.container.classList.add("error");let t=e.concepts.filter((t=>t.hasError)).length;this.modelstatusInfo.textContent=`${t} ${function(t,e,i){if(1===i)return t;let n="s".split("|");return 1===n.length?t+n[0]:t.substring(0,t.lastIndexOf(n[0]))+n[1]}("error",0,t)}`}else this.modelstatusBadge.classList.add("valid"),this.modelstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,t.removeChildren)(this.modelstatusInfo),this.editor.logs.clear();if(this.editor.hasError){this.editorstatusBadge.classList.add("error"),this.editorstatusBadge.classList.remove("valid"),this.container.classList.add("error");let t=this.editor.errors.length;this.editorstatusInfo.textContent=`${t}`}else this.editorstatusBadge.classList.add("valid"),this.editorstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,t.removeChildren)(this.editorstatusInfo),this.editor.logs.clear()}},render(){const e=(0,t.createDocFragment)();if((0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["editor-statusbar"]})),(0,t.isHTMLElement)(this.badgeContainer)||(this.badgeContainer=(0,t.createDiv)({class:["editor-statusbar-badge-container"]}),e.appendChild(this.badgeContainer)),(0,t.isHTMLElement)(this.modelstatus)||(this.modelstatus=(0,t.createDiv)({class:["editor-statusbar-model"]}),this.modelstatusBadge=(0,t.createI)({class:["editor-statusbar-model-badge"]}),this.modelstatusInfo=(0,t.createDiv)({class:["editor-statusbar-model-info"]}),this.modelstatus.append(this.modelstatusBadge,this.modelstatusInfo),this.badgeContainer.appendChild(this.modelstatus)),(0,t.isHTMLElement)(this.editorstatus)||(this.editorstatus=(0,t.createDiv)({class:["editor-statusbar-global"]}),this.editorstatusBadge=(0,t.createI)({class:["editor-statusbar-global-badge"]}),this.editorstatusInfo=(0,t.createDiv)({class:["editor-statusbar-global-info"]}),this.editorstatus.append(this.editorstatusBadge,this.editorstatusInfo),this.badgeContainer.appendChild(this.editorstatus)),(0,t.isHTMLElement)(this.viewContainer)||(this.viewContainer=(0,t.createDiv)({class:["editor-statusbar-viewer-container"]}),e.appendChild(this.viewContainer)),!(0,t.isHTMLElement)(this.btnGroup)){let e=(0,t.createI)({class:["ico","ico-plus","btn-content"],title:"Add a group",dataset:{ignore:"all"}},"+");this.btnGroup=(0,t.createButton)({class:["editor-statusbar-viewer__button-add"],dataset:{action:"add-group"}},e)}return(0,t.isHTMLElement)(this.groupContainer)||(this.groupContainer=(0,t.createDiv)({class:["editor-footer-group"]})),(0,t.isHTMLElement)(this.viewList)||(this.viewList=(0,t.createUnorderedList)({class:["bare-list","editor-statusbar-viewers"]}),this.viewContainer.appendChild(this.viewList)),["grid","tab"].forEach((e=>{let i=(0,t.createListItem)({class:["editor-statusbar-viewer"],dataset:{type:"viewer",action:"change-view",value:e}},e);this.views.set(e,i),this.viewList.append(i)})),this.viewItem=this.views.get(this.view),this.viewItem.classList.add("selected"),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},bindEvents(){function i(e,i){let n=(0,t.createEmphasis)({class:["link","error-message__link"]},e);const r=`.projection[data-concept="${i}"]`;return n.addEventListener("mouseenter",(e=>{let i=(0,t.getElement)(r,this.editor.body);i&&this.editor.highlight(i)})),n.addEventListener("mouseleave",(t=>{this.editor.unhighlight()})),n.addEventListener("click",(e=>{let i=this.editor.resolveElement((0,t.getElement)(r,this.editor.body));i&&i.focus()})),n}this.modelstatus.addEventListener("click",(n=>{if(!this.editor.conceptModel.hasError)return;let r=[];this.editor.conceptModel.concepts.forEach((e=>{e.hasError&&r.push(...e.errors.map((n=>{let r=i.call(this,e.getName(),e.id);return(0,t.createSpan)({class:["error-message"]},[r,`: ${n}`])})))})),this.editor.logs.clear(),this.editor.logs.add(r,"Validation error",e.hi.ERROR)})),this.editorstatus.addEventListener("click",(i=>{if(!this.editor.hasError)return;let n=[];n.push(...this.editor.errors.map((e=>(0,t.createSpan)({class:["error-message"]},[`${e.message}`])))),this.editor.logs.clear(),this.editor.logs.add(n,"Validation error",e.hi.ERROR)})),this.editor.registerHandler("editor.instance@active:updated",(()=>{this.updateActiveView()}))}},A={container:null,list:null,editor:null,dataList:null,fetch:null,init(t){return this.fetch=t,this},render(){const e=(0,t.createDocFragment)();return(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["container","container--editor-selectors"]})),(0,t.isHTMLElement)(this.list)||(this.list=(0,t.createUnorderedList)({class:["bare-list","editor-selectors","font-ui"]}),e.append(this.list)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this},update(){this.dataList=this.fetch(),(0,t.removeChildren)(this.list);let e=(0,t.valOrDefault)(this.editor.getConfig("concept"),{});return this.dataList.forEach((i=>{const{concept:n,accept:r}=i;let s=(0,t.createH4)({class:["title","editor-selector__title"]},`${a=i.name,(0,t.hasOwn)(e,a)?e[a].name:a}`);var a;n&&s.append((0,t.createSpan)({class:["editor-selector__title-concept"]},(n.name||n.prototype).replace(" ","-").toLowerCase())),r&&s.append((0,t.createSpan)({class:["editor-selector__title-accept"]},r.name)),(0,t.createButton)({class:["btn","editor-selector__header-button","editor-selector__header-button--info"],title:`View ${i.name||i.type} info`,dataset:{action:"collapse",rel:"parent",target:"selector"}},"i");let o=(0,t.createHeader)({class:["title","editor-selector__header"],title:`Expand/Collapse ${this.type}`},[s]),l=N[this.type],h=(0,t.createDiv)({class:["editor-selector__action-bar"]},l.call(this,i)),c=(0,t.createListItem)({class:["editor-selector","collapsed","font-ui"],tabindex:0,dataset:{type:this.type,alias:`${i.name||i.type}`,name:"selector",projection:i.id}},[o,h]);this.list.append(c)})),this.refresh(),this},show(){return(0,e.$Z)(this.container),this},hide(){return(0,e.Cp)(this.container),this},bindEvents(){}},N={projection:function(e){const i=(0,t.createDocFragment)();let n=(0,t.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"edit:projection",id:e.id}},"Edit");return i.append(n),i},value:function(e){const i=(0,t.createDocFragment)();let n=(0,t.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"create-instance:value",id:e.id}},(0,t.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),r=(0,t.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"copy:value",id:e.id}},(0,t.createI)({class:["ico","ico-copy","btn-content"],dataset:{ignore:"all"}})),s=(0,t.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:value",id:e.id}},(0,t.createI)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return i.append(s,r,n),i},concept:function(e){const i=(0,t.createDocFragment)();let n=this.editor.projectionModel.hasProjectionSchema(e),r=(0,t.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],disabled:!n,title:`Create an instance of "${e.name}"`,dataset:{action:"create-instance",concept:e.name}},(0,t.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+"));return n||(r.title=`The concept ${e.name} has no projection`),i.append(r),i},resource:function(e){const{name:i,type:n,required:r}=e,s=(0,t.createDocFragment)();let a=(0,t.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--add"],dataset:{action:"load-resource",id:i}},(0,t.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),o=(0,t.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:resource",id:i}},(0,t.createI)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return this.editor.getResource(i)?s.append(o):s.append(a),s}},O={editor:null,valueCount:0,fileCount:0,container:null,title:null,visible:!0,tabs:null,tabConcept:null,tabValue:null,tabProjection:null,tabResource:null,tabConceptNotification:null,tabValueNotification:null,tabProjectionNotification:null,tabResourceNotification:null,activeTab:null,activeTabValue:null,menu:null,header:null,body:null,btnHome:null,btnSave:null,btnClose:null,get isRendered(){return(0,t.isHTMLElement)(this.container)},init(t){return t&&(this.editor=t),this._conceptSelector=function(t,e,i){return Object.create(A,{object:{value:"selector"},model:{value:void 0},type:{value:"concept"},editor:{value:e}})}(0,this.editor).init((()=>this.editor.isReady?this.editor.conceptModel.getSchema("concrete").filter((t=>t.root)):[])),this},render(){const e=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["editor-header"],dataset:{name:"editor-header",alias:"header"}})),(0,t.isHTMLElement)(this.title)||(this.title=(0,t.createSpan)({class:["editor-header-title"]},"Gentleman")),(0,t.isHTMLElement)(this.menu)||(this.menu=(0,t.createDiv)({class:["editor-header-left"]},[this.title]));let i=(0,t.valOrDefault)(this.editor.getConfig("toolbar"),[]),n=(0,t.createDiv)({class:["editor-toolbar"]},i.map((e=>(0,t.createButton)({class:(0,t.valOrDefault)(e.class,[]),dataset:{name:e.name,action:e.action}},e.content))));return(0,t.isHTMLElement)(this.btnHome)||(this.btnHome=(0,t.createButton)({class:["btn","editor-toolbar__button","editor-toolbar__button--home"],title:"Toggle menu",dataset:{action:"home"}}),n.append(this.btnHome)),(0,t.isHTMLElement)(this.header)||(this.header=(0,t.createDiv)({class:["editor-header-menu"]},[this.menu,n]),e.append(this.header)),(0,t.isHTMLElement)(this.body)||(this.body=(0,t.createDiv)({class:["editor-header-main"]}),e.append(this.body)),(0,t.isHTMLElement)(this._conceptSelector.container)||this.body.append(this._conceptSelector.render()),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){let i=(0,t.valOrDefault)(this.editor.getConfig("settings"),!0),n=(0,t.valOrDefault)(this.editor.getConfig("header"),!0);return this.editor.hasConceptModel?(this._conceptSelector.update(),(0,e.$Z)(this.body)):(0,e.Cp)(this.body),!1===i&&(0,e.Cp)(this.btnHome),!1===n&&(0,e.Cp)(this.body),this},show(i){if(!(0,t.isHTMLElement)(this[i]))return(0,e.$Z)(this.container),this.visible=!0,this;(0,e.$Z)(this[i])},hide(i){if(!(0,t.isHTMLElement)(this[i]))return(0,e.Cp)(this.container),this.visible=!1,this;(0,e.Cp)(this[i])},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},bindEvents(){}};var M=0;const j={createInstance(i,n,r){if((0,t.isNullOrUndefined)(i))return this.notify("The concept is not valid",e.k$.ERROR),!1;let s="concept"===i.type?i:this.createConcept(i),a=n;(0,t.isNullOrUndefined)(a)&&this.hasProjectionModel&&(a=this.createProjection(s).init());let o=Object.create(C,{id:{value:"instance"+M++},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},concept:{value:s,writable:!0},projection:{value:a,writable:!0},editor:{value:this}});const l=Object.assign({type:"concept",resize:!0,maximize:!0,close:"DELETE-CONCEPT"},r);return o.init(l),this.addInstance(o),o},getInstance(t){return this.instances.get(t)},addInstance(t){return t.isRendered||this.instanceSection.append(t.render()),this.instances.set(t.id,t),"tab"===this.status.view&&this.status.addView(t),t.concept.notify("displayed",t.projection.element.id),this.updateActiveInstance(t),this.refresh(),this},removeInstance(e){let i=this.getInstance(e);return!(0,t.isNullOrUndefined)(i)&&(i===this.activeInstance&&(this.activeInstance=null),i.view&&(0,t.removeChildren)(i.view).remove(),this.instances.delete(e),this.refresh(),!0)},moveInstance(t,e){return this.instanceSection.children[e].before(t),this},swapInstance(t,e){let i=Array.from(this.instanceSection.children);const n=i.indexOf(t),r=i.indexOf(e);return this.moveInstance(e,n),this.moveInstance(t,r),this}},C={window:null,container:null,title:null,visible:!0,menu:null,header:null,body:null,btnMaximize:null,btnClose:null,size:1,fullscreen:!1,collapsed:!1,schema:null,ctype:null,get isRendered(){return(0,t.isHTMLElement)(this.container)},init(e={}){return this.ctype=(0,t.valOrDefault)(e.type,"concept"),this.schema=e,this},setTitle(e){return!(0,t.isNullOrWhitespace)(e)&&(this.title.textContent=e,!0)},collapse(){return(0,e.wo)(this.container),this.collapsed=!0,this.fullscreen=!1,this.size="normal",this.refresh(),this},expand(){return(0,e.jn)(this.container),this.collapsed=!1,this.refresh(),this},changeSize(t){this.size=t,"fullscreen"===t?(this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height")):this.fullscreen=!1,this.refresh()},full(){this.size="fullscreen",this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height"),this.refresh()},show(){return(0,e.$Z)(this.container),this.visible=!0,this},hide(){return(0,e.Cp)(this.container),this.visible=!1,this},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},refresh(){return this.container.dataset.size=`${this.size}`,(0,t.isNullOrUndefined)(this.projection)&&(this.body.textContent="No projection found"),Array.from(this.editor.instances).some((t=>t.fullscreen))?this.editor.instanceSection.classList.add("fullscreen"):this.editor.instanceSection.classList.remove("fullscreen"),this},render(){const i=(0,t.createDocFragment)(),{name:n}=this.concept,r=n.toLowerCase();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["editor-concept",`editor-concept--${this.ctype}`],tabindex:0,dataset:{nature:"concept-container",type:this.ctype,size:1}})),(0,t.isHTMLElement)(this.header)||(this.header=(0,t.createHeader)({title:"concept"===this.schema.type?`Instance of "${r}"`:`Linked instance of "${r}"`,class:["editor-concept-header"]}),i.append(this.header)),(0,t.isHTMLElement)(this.btnClose)||(this.btnClose=(0,t.createButton)({class:["btn","editor-concept-toolbar__btn-delete"],title:`Delete the instance "${r}"`,dataset:{action:"close",context:this.type,id:this.id}}),"projection"===this.schema.type&&(this.btnClose.title=`Close the linked instance "${r}"`)),(0,t.isHTMLElement)(this.btnMaximize)||(this.btnMaximize=(0,t.createButton)({class:["btn","editor-concept-toolbar__btn-maximize"],title:`Maximize ${n.toLowerCase()}`,dataset:{action:"maximize",context:this.type,id:this.id}})),this.title=(0,t.createH3)({class:["title","editor-concept-title","fit-content"],dataset:{nature:"editable",id:this.id}},(0,t.valOrDefault)(this.schema.title,n));let s=(0,t.createDiv)({class:["editor-concept-toolbar"]},[this.btnMaximize,this.btnClose]);return(0,t.removeChildren)(this.header).append(this.title,s),this.body&&this.body.remove(),this.projection?this.body=this.projection.render():this.body=(0,t.createParagraph)(),i.append(this.body),i.hasChildNodes()&&(this.container.appendChild(i),this.bindEvents()),(0,e.n2)(this.container),this.refresh(),this.container},clear(){},actionHandler(t){switch(t){case"collapse":this.collapsed?this.expand():this.collapse();break;case"maximize":this.fullscreen?this.changeSize("normal"):this.changeSize("fullscreen");break;case"close":this.delete()}},delete(){switch(this.schema.close){case"DELETE-CONCEPT":if(!this.concept.delete(!0))return this.editor.notify("The concept could not be deleted",e.k$.ERROR),this;break;case"DELETE-PROJECTION":if(this.projection&&!this.projection.delete())return this.notify("The projection could not be deleted",e.k$.ERROR),this}(0,t.removeChildren)(this.container).remove(),this.editor.removeInstance(this.id),this.window&&this.window.removeInstance(this)},bindEvents(){this.container.addEventListener("focusin",(t=>{this.editor.updateActiveInstance(this)}))}};var L=0;const S={createWindow(t){let e=Object.create(k,{id:{value:"window"+L++},object:{value:"environment"},name:{value:"editor-window"},type:{value:"window"},editor:{value:this}});return e.refname=t,e.init(),this.addWindow(e),e},getWindow(t){return this.windows.get(t)},findWindow(t){return Array.from(this.windows.values()).find((e=>e.refname===t))},addWindow(t){return t.isRendered||this.body.append(t.render()),this.windows.set(t.id,t),"tab"===this.status.view&&this.status.addView(t),this.refresh(),this},removeWindow(e){let i=this.getWindow(e);return!(0,t.isNullOrUndefined)(i)&&(i===this.activeWindow&&(this.activeWindow=null),i.view&&(0,t.removeChildren)(i.view).remove(),this.windows.delete(e),this.refresh(),!0)},moveWindow(t,e){return this.body.children[e].before(t),this},swapWindow(t,e){let i=Array.from(this.body.children);const n=i.indexOf(t),r=i.indexOf(e);return this.moveWindow(e,n),this.moveWindow(t,r),this}},k={container:null,title:null,visible:!0,instances:null,menu:null,header:null,body:null,btnClose:null,maxInstance:1,get isRendered(){return(0,t.isHTMLElement)(this.container)},init(e={}){return this.ctype=(0,t.valOrDefault)(e.type,"concept"),this.schema=e,this.instances=new Set,this},isEmpty(){return 0===this.instances.size},show(){return(0,e.$Z)(this.container),this.visible=!0,this},hide(){return(0,e.Cp)(this.container),this.visible=!1,this},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},close(){(0,t.removeChildren)(this.container).remove(),this.editor.removeWindow(this.id)},refresh(){return this.isEmpty()?this.hide():this.show(),this},render(){const e=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["editor-window"],tabindex:-1})),(0,t.isHTMLElement)(this.header)||(this.header=(0,t.createHeader)({class:["editor-window-header"]}),e.append(this.header)),(0,t.isHTMLElement)(this.title)||(this.title=(0,t.createH3)({class:["title","editor-window-title","fit-content"]})),(0,t.isHTMLElement)(this.btnClose)||(this.btnClose=(0,t.createButton)({class:["btn","editor-window-header__btn-delete"],title:"Close the window",dataset:{action:"close",context:this.type,id:this.id}}));let i=(0,t.createDiv)({class:["editor-window-toolbar"]},[this.btnClose]);return(0,t.removeChildren)(this.header).append(this.title,i),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},getInstance(e){return(0,t.isNullOrUndefined)(e)?null:Array.from(this.instances).find((t=>t.id===e))},addInstance(e){if(!(0,t.isNullOrUndefined)(e)&&!this.instances.has(e))return this.instances.add(e),e.window=this,this.container.append(e.container),this.refresh(),!0},removeInstance(e){if(!(0,t.isNullOrUndefined)(e)&&this.instances.has(e))return this.instances.delete(e),this.refresh(),!0},actionHandler(t){switch(t){case"close":this.close()}},bindEvents(){}},T={schema:null,isOpen:!1,visible:!0,btnClose:null,btnExport:null,outputName:null,selector:null,init(t){return t&&(this.schema=t),this},get isRendered(){return(0,t.isHTMLElement)(this.container)},clear(){return(0,t.removeChildren)(this.logList),this},update(){},render(){const e=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["editor-exporter","hidden"]})),(0,t.isHTMLElement)(this.btnClose)||(this.btnClose=(0,t.createButton)({title:"Close window",class:["btn","btn-collapse"]}),e.append(this.btnClose));let i=(0,t.createH4)({class:["editor-exporter-title"]},"Export model");if(e.append(i),(0,t.isNullOrUndefined)(this.selector)){let i=(0,t.createParagraph)({class:["editor-exporter__instruction"]},"Select the export format");this.selector=(n=["JSON","XML"],Object.create(U).init(n)),e.append(i,this.selector.render()),this.selector.select("JSON")}var n;if(!(0,t.isHTMLElement)(this.outputName)){let i=(0,t.createLabel)({class:["editor-exporter-file__label"]}),n=(0,t.createLabel)({class:["editor-exporter-file__label-value"]},"File");this.outputName=(0,t.createInput)({placeholder:"File name",class:["editor-exporter-file__input"]}),i.append(n,this.outputName),e.append(i)}return(0,t.isHTMLElement)(this.btnExport)||(this.btnExport=(0,t.createButton)({class:["btn","btn-export"]},"Export"),e.append(this.btnExport)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this},execute(){switch(this.selector.getValue()){case"JSON":this.toJSON(this.outputName.value);break;case"XML":this.toXML(this.outputName.value)}},toXML(){const{conceptModel:t}=this.editor,e=t.toXML();this.editor.download(e,`${this.outputName.value}.xml`,"XML")},toJSON(){const{conceptModel:t,projectionModel:e}=this.editor,i=JSON.stringify({type:"model",concept:t.schema,projection:e.schema,values:t.export()});this.editor.download(i,`${this.outputName.value}.json`,"JSON")},isValid(){return!(0,t.isNullOrWhitespace)(this.outputName.value)},bindEvents(){this.btnClose.addEventListener("click",(t=>{this.close()})),this.btnExport.addEventListener("click",(t=>{if(!this.isValid())return(0,e.lL)(this.btnExport),void this.editor.notify("Enter the file name",e.k$.ERROR,3e3);this.execute()}))}},U={container:null,values:null,selectors:null,selected:null,value:null,init(e){return this.values=(0,t.valOrDefault)(e,[]),this.selectors=new Map,this},getValue(){return this.value},refresh(){(0,t.isNullOrUndefined)(this.value)?this.container.classList.add("empty"):this.container.classList.remove("empty")},render(){let e=!1;return(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createUnorderedList)({class:["bare-list","export-selector"]}),e=!0),this.values.forEach((t=>{let e=this.createItem(t);this.container.append(e)})),e&&this.bindEvents(),this.container},select(e){if((0,t.isNullOrUndefined)(e))return;if(!this.selectors.has(e))return;let i=this.selectors.get(e);this.setSelectedItem(i),this.value=e,this.refresh()},createItem(e){let i=(0,t.createListItem)({class:["export-selector-item"],dataset:{value:e}}),n=(0,t.createLabel)({class:["export-selector-item__label"]}),r=(0,t.createInput)({type:"radio",name:"export-choice",value:e,class:["export-selector-item__input"]});return n.append(r,e),i.append(n),this.addItem(e,i),i},addItem(t,e){return this.selectors.set(t,e),this.refresh(),this},getItem(t){return this.selectors.get(t)},setSelectedItem(i){return!(!(0,t.isHTMLElement)(i)||i.parentElement!==this.container)&&(this.selected!==i?(this.selected&&(0,e.hF)(this.selected),this.selected=i,(0,e.Ys)(this.selected),!0):void 0)},bindEvents(){this.container.addEventListener("change",(e=>{const{target:i}=e;(0,t.isNullOrUndefined)(i.value)||this.select(i.value)}))}},I={container:null,isOpen:!1,visible:!0,show(){return(0,e.$Z)(this.container),this.visible=!0,this},hide(){return(0,e.Cp)(this.container),this.visible=!1,this},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this.editor.refresh(),this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this.editor.refresh(),this}};function _(){return Object.create(O,{object:{value:"environment"},name:{value:"editor-header"},editor:{value:this}})}function H(){return Object.create(w,{object:{value:"environment"},name:{value:"editor-breadcrumb"},type:{value:"breadcrumb"},editor:{value:this}})}function D(){return Object.assign(Object.create(I,{object:{value:"environment"},name:{value:"editor-home"},type:{value:"home"},editor:{value:this}}),f)}function P(){return Object.create(E,{object:{value:"environment"},name:{value:"editor-status"},type:{value:"status"},editor:{value:this}})}function V(){return Object.assign(Object.create(I,{object:{value:"environment"},name:{value:"editor-log"},type:{value:"log"},editor:{value:this}}),x)}function B(){return Object.assign(Object.create(I,{object:{value:"environment"},name:{value:"editor-exporter"},type:{value:"exporter"},editor:{value:this}}),T)}const R={getHandlers(e){return(0,t.valOrDefault)(this.handlers.get(e),[])},triggerEvent(e,i,n=!0){const{name:r,options:s,args:a}=e,o=this.getHandlers(r),l=(0,t.isFunction)(i);let h=!1;return o.forEach((t=>{let e=t.call(this,a,s);!1!==e?n&&l&&i.call(this,e):h=!0})),!h&&(!n&&l&&i.call(this),!0)},registerHandler(t,e){return this.hasHanlder(t)||this.handlers.set(t,[]),this.handlers.get(t).push(e),!0},unregisterHandler(t,e){if(!this.hasHanlder(t))return!1;let i=this.getHandlers(t);for(let t=0;t<i.length;t++)if(i[t]===e)return i.splice(t,1),!0;return!1},hasHanlder(t){return this.handlers.has(t)},registerReceiver(e,i){(0,t.isNullOrUndefined)(this.activeReceiver[i])&&(this.activeReceiver[i]=e),(0,t.isNullOrUndefined)(this.receivers[i])&&(this.receivers[i]={root:e,projections:[]},e.isRoot=!0),this.receivers[i].projections.push(e)},saturationRevolved(t,e){let i,n=this.receivers[e].projections;for(let e=0;e<n.length;e++)t.id===n[e].id&&(i=e);if(i>=n.length)return void this.setActiveReceiver(t,e);let r=n[i+1].transmitFirst();t.acceptAnchor(r)},getActiveReceiver(t){return this.activeReceiver[t]},setActiveReceiver(t,e){this.activeReceiver[e]=t},getRootReceiver(t){return this.receivers[t].root},findReceiverInstance(e,i){let n=this.receivers[i].projections;for(let i=0;i<n.length;i++){let r=n[i].instances.get(e);if((0,t.isHTMLElement)(r))return{container:n[i],instance:r}}alert("Not Found")}};var z=n(914);const $={create(t,e){const i=Object.create(this);return i.concept=t,i.schema=e,i},model:null,schema:null,source:null,id:null,value:null,object:"structure",init(t){throw new Error("This function has not been implemented")}};Object.defineProperty($,"model",{get(){return this.concept.model}}),Object.defineProperty($,"name",{get(){return this.schema.name}}),Object.defineProperty($,"required",{get(){return(0,t.valOrDefault)(this.schema.required,!0)}});const F={object:"attribute",target:null,init(e){return this.target=this.model.createConcept(this.schema.target,{value:(0,t.valOrDefault)(e,this.schema.value),parent:this.concept,ref:this}),this},getValue(){return this.target.getValue()},hasValue(){return this.target.hasValue()},setValue(t){this.target.setValue(t)},getTarget(){return this.target},copy(){return this.target.hasValue()?this.target.copy(!1):null},clone(){return this.target.hasValue()?this.target.clone():null},export(){return this.target.hasValue()?{id:this.target.id,name:this.target.name}:null},toString(){return{[`attribute.${this.name}`]:this.target.toString()}},toXML(){return this.target.hasValue()?this.target.toXML():""}},q=Object.assign(Object.create($),F),W={attributes:null,attributes_created:null,initAttribute(){return this.attributes=[],this.attributes_created=new Set,this.attributes_updated=new Set,this.attributes_deleted=new Set,Array.isArray(this.attributeSchema)&&this.attributeSchema.filter((e=>(0,t.valOrDefault)(e.required,!0))).forEach((t=>this.createAttribute(t.name))),this},getAttributes(){return this.attributes},getAttribute(e){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad argument");return this.getAttributeByName(e)},getAttributeSchema(e){if((0,t.isNullOrWhitespace)(e))throw new TypeError("Bad argument");if(!this.hasAttribute(e))throw new Error(`Attribute '${e}' does not exist`);return(0,t.cloneObject)(this.attributeSchema.find((t=>t.name===e)))},getAttributeByName(e){if((0,t.isNullOrWhitespace)(e))throw new TypeError("Bad argument");var i=this.attributes.find((t=>t.name===e));return(0,t.isNullOrUndefined)(i)&&(i=this.createAttribute(e)),i},createAttribute(t,e){if(!this.hasAttribute(t))throw new Error(`Attribute not found: The concept '${this.name}' does not contain an attribute named '${t}'`);if(this.isAttributeCreated(t)){let i=this.getAttributeByName(t);if(e){let t=this.model.getValue(e);i.target.initValue(t)}return i}const i=this.getAttributeSchema(t);let n=this.model.getValue(e);var r=q.create(this,i).init(n);return this.addAttribute(r),r},addAttribute(e){if((0,t.isNullOrUndefined)(e)||"attribute"!==e.object)throw new Error("Bad argument: 'attribute' must be an attribute object");return this.attributes.push(e),this.attributes_created.add(e.name),this.notify("attribute.added",e),this},hasAttributes(){return!(0,t.isEmpty)(this.attributeSchema)||!(0,t.isEmpty)(this.attributes)},hasAttribute(t){return-1!==this.attributeSchema.findIndex((e=>e.name===t))},isAttributeRequired(e){const i=this.getAttributeSchema(e);return(0,t.valOrDefault)(i.required,!0)},isAttributeCreated(t){return this.attributes_created.has(t)},listAttributes(){const t=[];return this.attributeSchema.forEach((e=>{t.push({type:"attribute",name:e.name,target:e.target,accept:e.accept,required:this.isAttributeRequired(name),created:this.isAttributeCreated(name)})})),t},removeAttribute(t){if(this.isAttributeRequired(t))return{message:`The attribute '${t}' is required.`,success:!1};var e=this.attributes.findIndex((e=>e.name===t));if(-1===e)return{message:`The attribute '${t}' was not found.`,success:!1};var i=this.attributes.splice(e,1)[0];return this.attributes_created.delete(t),this.notify("attribute.removed",i),{message:`The attribute '${t}' was successfully removed.`,success:!0}}},X={listeners:null,initObserver(){return this.listeners=[],this},register(t){return this.listeners.includes(t)||this.listeners.push(t),!0},unregister(t){var e=this.listeners.indexOf(t);return-1!==e&&(this.listeners.splice(e,1),!0)},unregisterAll(){this.listeners=[]},notify(t,e){this.listeners.forEach((i=>{i.update(t,e,this)}))}},Y={model:null,schema:null,source:null,id:null,name:null,ref:null,actions:null,operations:null,accept:null,parent:null,references:null,errors:null,value:null,values:null,action:null,shadows:null,watchers:null,kind:"concept",init(e={}){return this.accept=e.accept,this.parent=e.parent,this.ref=e.ref,this.properties=(0,t.valOrDefault)(this.schema.properties,[]),Array.isArray(e.properties)&&this.properties.push(...e.properties),this.default=(0,t.valOrDefault)(this.schema.default,null),this.values=(0,t.valOrDefault)(e.values,(0,t.valOrDefault)(this.schema.values,[])),this.src=(0,t.valOrDefault)(this.schema.src,[]),this.constraint=this.schema.constraint,this.watchers=new Map,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},isRoot(){return(0,t.isNullOrUndefined)(this.parent)},initValue(){throw new Error("This function has not been implemented")},getName(){return this.ref&&"attribute"===this.ref.object?this.ref.name:this.name},getCandidates(){return this.values.forEach((e=>{(0,t.isObject)(e)&&(e.type="value")})),this.values},getStructure(){return[...this.listAttributes()]},getProperty(e,i){if("refname"===e){if((0,t.isNullOrUndefined)(this.ref))return;return this.ref.name}if("name"===e)return this.name;if("value"===e)return this.value;if(!this.hasProperty(e))return;let n=this.properties.find((t=>t.name===e));const{type:r,value:s}=n;return"string"===r?Z.call(this,s):"number"===r?+s:"boolean"===r?(0,t.toBoolean)(s):s},hasProperty(e){return!!["refname","name","value"].includes(e)||-1!==(0,t.valOrDefault)(this.schema.properties,[]).findIndex((t=>t.name===e))},getConstraint(t){if(this.hasConstraint(t))return this.constraint[t]},hasConstraint(e){return!(0,t.isNullOrUndefined)(this.constraint)&&(!!(0,t.isNullOrUndefined)(e)||(0,t.hasOwn)(this.constraint,e))},hasParent(){return!this.isRoot()},getParent(e){if(this.isRoot())return null;if((0,t.isNullOrWhitespace)(e))return this.parent;const i=this.parent;return i.name===e?i:i.getParent(e)},getParentWith(e){if(this.isRoot())return null;if((0,t.isNullOrWhitespace)(e))return this.parent;const i=this.parent;return i.hasPrototype(e)?i:i.getParentWith(e)},getPrototype(){return(0,t.isNullOrUndefined)(this.prototype)?null:this.prototype},hasPrototype(e){if((0,t.isNullOrUndefined)(this.schema.prototype))return!1;if((0,t.isNullOrUndefined)(e))return!0;let i=this.model.getConceptSchema(this.schema.prototype);for(;!(0,t.isNullOrUndefined)(i);){if(i.name===e)return!0;i=this.model.getConceptSchema(i.prototype)}return!1},getAncestor(t){const e=[];for(var i=this.getParent(t);i;)e.push(i),i=i.getParent(t);return e},getChildren(e){const i=[];return(0,t.isNullOrUndefined)(e)?this.getAttributes().forEach((t=>{i.push(t.target)})):this.getAttributes().forEach((t=>{t.target.name===e?i.push(t.target):i.push(...t.target.getChildren(e))})),i},getDescendant(t){const e=[];return this.getChildren(t).forEach((i=>{e.push(i),e.push(...i.getDescendant(t))})),e},propagate(t,e,i){this.watchers.has(t)&&this.signal(t,e,i),this.hasParent()&&this.getParent().propagate(t,e,i)},watch(t,e){this.watchers.has(t)||this.watchers.set(t,[]),this.watchers.get(t).push(e)},signal(t,e,i){this.watchers.has(t)&&this.watchers.get(t).forEach((t=>t(e,i)))},unwatch(e,i){if((0,t.isNullOrUndefined)(e)||!this.watchers.has(e))return!1;if(!(0,t.isFunction)(i))return this.watchers.delete(e),!0;let n=this.watchers.get(e).findIndex((t=>t===i));return-1!==n&&(this.watchers.splice(n,1),!0)},done(){this.unregisterAll(),this.watchers.clear()},delete(t=!1){if(!t){const{object:t}=this.ref;let e={success:!0};if("concept"===t?e=this.getParent().removeValue(this):"attribute"===t&&(e=this.getParent().removeAttribute(this.ref.name)),!e.success)return e}this.getChildren().forEach((t=>{t&&t.delete(!0)}));try{this.notify("delete"),this.model.removeConcept(this.id),this.notify("delete")}catch(t){return console.error(this),{message:"Concept not found",success:!1}}return{message:`The concept '${this.name}' was successfully deleted.`,success:!0}},copy(t=!0){const e={name:this.name,nature:this.nature};var i=[];return this.getAttributes().forEach((t=>{i.push({name:t.name,value:t.copy(!1)})})),e.attributes=i,t&&this.model.addValue(e),e},clone(){const t={id:this.id,name:this.name};var e=[];return this.getAttributes().forEach((t=>{e.push({name:t.name,value:t.clone()})})),t.attributes=e,t},export(){const t={id:this.id,root:this.isRoot(),name:this.name};var e=[];return this.getAttributes().forEach((t=>{e.push({name:t.name,value:t.export()})})),t.force=this.force,t.attributes=e,t},toString(){var t={};return this.attributes.forEach((e=>{Object.assign(t,e.toString())})),t},toXML(){let t=this.getName().replace(" ","-");return`<${t} id="${this.id}">`+this.attributes.map((t=>t.toXML())).join("")+`</${t}>`},toXMI(){let t=this.getName().replace(" ","-");return`<${t} id="${this.id}">`+this.attributes.map((t=>t.toXML())).join("")+`</${t}>`}};function Z(e){if((0,t.isString)(e))return e;const{type:i}=e;switch(i){case"concat":return J.call(this,e.concat)}}function G(t,e){const{type:i}=t;return"string"===i?Z.call(this,t.value):"property"===i?this.getProperty(t.name):e||t}function J(t,e=""){if(!Array.isArray(t))throw new TypeError("Terms need to be an array");return t.length<2?G.call(this,t[0]):t.map((t=>G.call(this,t))).join(e)}const K=Object.assign(Y,X,W);Object.defineProperty(K,"attributeSchema",{get(){return this.schema.attributes}}),Object.defineProperty(K,"_prototype",{get(){return this.schema.prototype}}),Object.defineProperty(K,"hasError",{get(){return this.errors&&!(0,t.isEmpty)(this.errors)}});const Q={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.default=(0,t.valOrDefault)(this.schema.default,!0),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if((0,t.isNullOrUndefined)(e))return this.value=this.default,this;if((0,t.isObject)(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return!(0,t.isNullOrUndefined)(this.value)},getValue(){return this.value},setValue(e){let i=(0,t.isObject)(e)?e.value:e;return 200!==this.validate(i)?{success:!1,message:"Validation failed: The value could not be updated."}:(this.value=(0,t.toBoolean)(i),this.notify("value.changed",i),{success:!0,message:"The value has been successfully updated."})},restore(t){const{value:e}=t;this.setValue(e)},update:(t,e)=>!0,getCandidates:()=>[!0,!1],getChildren:t=>[],validate(e){return this.errors=[],(0,t.isString)(e)&&["true","false"].includes(e.toLowerCase())||Number.isInteger(e)&&[1,0].includes(e)||[!0,!1].includes(e)?200:400},copy(t=!0){if(!this.hasValue())return null;const e={name:this.name,nature:this.nature,value:this.getValue()};return t&&this.model.addValue(e),e},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let t=this.getName();return`<${t} id="${this.id}">`+this.getValue()+`</${t}>`}},tt=Object.assign(Object.create(K),Q);function et(t,e){switch(t){case 400:return{success:!1,message:"The value is not a number."};case 401:return{success:!1,message:`Valid values: ${e}`};case 403:return{success:!1,message:`Maximum allowed: ${e.value}.`};case 402:return{success:!1,message:`Minimum allowed: ${e.value}.`};case 404:return{success:!1,message:`Value allowed: ${e.value}.`}}}const it={nature:"primitive",initValue(e){if((0,t.isNullOrUndefined)(e))return this.value=this.default,this;if((0,t.isObject)(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return"number"==typeof this.value&&!isNaN(this.value)},getValue(){return this.hasValue()?+this.value:null},setValue(e){let i=(0,t.isObject)(e)?e.value:e;const{code:n,ctx:r}=this.validate(i);return this.value!==i&&(this.value=(0,t.isNullOrWhitespace)(i)?null:+i,this.notify("value.changed",i),this.propagate("value.changed",i,this)),200!==n?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},restore(t){const{value:e}=t;this.setValue(e)},getCandidates(){return this.values.forEach((e=>{(0,t.isObject)(e)&&(e.type="value")})),this.values},getChildren:t=>[],update:(t,e)=>!0,validate(e){if(this.errors=[],isNaN(e)){let t=400;return this.errors.push(et.call(this,t).message),{code:t}}if(!this.hasConstraint())return{code:200};if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("range"===i){const{min:n,max:r}=t[i];if(n&&+e<n.value){let t=402;return this.errors.push(et.call(this,t,n).message),{code:t,ctx:n}}if(r&&+e>r.value){let t=403;return this.errors.push(et.call(this,t,r).message),{code:t,ctx:r}}}else if("fixed"===i){const{value:n}=t[i];if(e!==n){let e=404;return this.errors.push(et.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("values")){let i=this.getConstraint("values").map((t=>nt.call(this,t))).flat(),n=!1;for(let r=0;!n&&r<i.length;r++){const s=i[r];n=(0,t.isObject)(s)?s.value===e:s===e}if(!n){let t=401;return this.errors.push(et.call(this,t,i).message),{code:t,ctx:i}}}return{code:200}},copy(t=!0){if(!this.hasValue())return null;const e={name:this.name,nature:this.nature,value:this.getValue()};return t&&this.model.addValue(e),e},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let t=this.getName();return`<${t} id="${this.id}">`+this.getValue()+`</${t}>`}};function nt(t){if("reference"===t.type){let t=[];return this.model.isPrototype("model concept")&&(t=this.model.getConceptsByPrototype("model concept")),t.map((t=>t.getChildren(this.name))).flat().map((t=>t.value))}return t}const rt=Object.assign(Object.create(K),it),st={nature:"primitive",reference:null,path:null,init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.path=this.schema.path,this.values=(0,t.valOrDefault)(this.schema.values,[]),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){return(0,t.isNullOrUndefined)(e)||this.setValue(e.value),this},restore(t){const{value:e}=t;this.setValue(e)},hasValue(){return!(0,t.isNullOrWhitespace)(this.value)},getValue(e=!1){return(0,t.isNullOrUndefined)(this.value)?null:e?this.reference:this.value},removeValue(){return this.reference&&this.reference.unregister(this),this.reference=null,this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getReference(){return(0,t.isNullOrUndefined)(this.reference)?null:this.reference},setValue(e,i=!0){let n=(0,t.isObject)(e)?e.id:e;return 200!==this.validate(n)?{success:!1,message:"Validation failed: The value could not be updated."}:(0,t.isNullOrUndefined)(n)||this.value===n?{success:!0,message:"The value has been ignored."}:(this.reference&&this.reference.unregister(this),this.value=n,this.reference=this.model.getConcept(n),(0,t.isNullOrUndefined)(this.reference)&&i?setTimeout((()=>this.setValue(e,!1)),20):(this.reference.register(this),this.notify("value.changed",this.reference)),{success:!0,message:"The value has been successfully updated."})},getCandidates(){if((0,t.isNullOrUndefined)(this.accept))throw new Error("Bad reference: 'accept' property is not defined");var e=at.call(this,this.accept);return this.path&&ot(this,this.path).map((t=>({type:this.accept.type,value:t}))),e},getChildren(e){return(0,t.isNullOrUndefined)(this.reference)||e&&this.reference.name!==e?[]:[this.reference]},delete(t=!1){if(!t){const{object:t}=this.ref;let e={success:!0};if("concept"===t?e=this.getParent().removeValue(this):"attribute"===t&&(e=this.getParent().removeAttribute(this.ref.name)),!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(t,e){switch(t){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference);break;case"value.changed":this.setValue(this.value)}return!0},validate(e){return this.errors=[],(0,t.isNullOrUndefined)(e)||this.model.hasConcept(e)?200:(this.errors.push("This element is not valid"),401)},copy(t=!0){if(!this.hasValue())return null;const e={name:this.name,nature:this.nature,value:this.getValue()};return t&&this.model.addValue(e),e},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){var t=[];return this.value.forEach((e=>{t.push(e.toString())})),t},toXML(){let t=this.getName();return`<${t} id="${this.id}">`+this.getValue()+`</${t}>`}};function at(t){const{name:e,scope:i,rel:n}=t;return"parent"===n?this.getParent(i).getChildren(e):"children"===n?this.getChildren(e):this.model.isPrototype(e)?this.model.getConceptsByPrototype(e):this.model.getConcepts(e)}function ot(e,i){if((0,t.isNullOrUndefined)(i))return e;const{target:n,value:r,rel:s}=i;var a=[];return"parent"===s?a.push(e.getParentWith(n)):"children"===s?a.push(...e.getChildren(n)):"property"===s&&a.push(e.getProperty(n)),a.map((t=>ot(t,r))).flat()}const lt=Object.assign({},K,st),ht={SUCCESS:200,INVALID_VALUE:401,MIN_CARDINALITY_ERROR:402,MAX_CARDINALITY_ERROR:403,FIX_CARDINALITY_ERROR:404};function ct(t,e){switch(t){case ht.INVALID_VALUE:return{success:!1,message:`Valid values: ${e}`};case ht.MAX_CARDINALITY_ERROR:return{success:!1,message:`Maximum cardinality: ${this.value.length}/${e.value}.`};case ht.MIN_CARDINALITY_ERROR:return{success:!1,message:`Minimum cardinality: ${this.value.length}/${e.value}.`};case ht.FIX_CARDINALITY_ERROR:return{success:!1,message:`Fixed cardinality: ${e.value}.`};case ht.PATTERN_ERROR:return{success:!1,message:"The value is not valid."}}}const ut={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.ordered=(0,t.valOrDefault)(this.schema.ordered,!0),this.constraint=this.schema.constraint,this.watchers=new Map,this.value=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){this.removeAllElement();let i=dt.call(this);if((0,t.isNullOrUndefined)(e)){let t=i;for(let e=0;e<t;e++)this.createElement();return this}const{id:n="",name:r,value:s}=e;n.length>10&&(this.id=n);for(let t=0;t<s.length;t++)this.createElement(s[t]);let a=i-s.length;for(let t=0;t<a;t++)this.createElement();return this},hasValue(){return!(0,t.isEmpty)(this.value)},getValue(t=!1){const e=this.value.map((t=>this.model.getConcept(t)));return t?e.map((t=>t.getValue())):e},removeValue(t){return this.hasValue()?(this.removeElement(t),{success:!0,message:"The value has been successfully updated."}):{success:!0,message:"The value has been successfully updated."}},isValidElement(e){const{name:i,accept:n}=this.accept;return this.model.isPrototype(i)?(0,t.isNullOrUndefined)(n)?this.model.hasPrototype(e.name,i):Array.isArray(n)?n.some((t=>t.name===e.name)):n.name===e.name:this.accept.name===e.name},setValue(t){let e=t.value||t;if(Array.isArray(e)){this.removeAllElement();for(let t=0;t<e.length;t++)this.createElement(e[t])}else this.isValidElement(e)&&this.createElement(e)},restore(t){const{value:e}=t;e.forEach(((t,e)=>{this.value.includes(t.id)||this.createElement(t)}))},getElements(){return this.value.map((t=>this.model.getConcept(t)))},getElement(e){var i=this.value.find((t=>t===e));if(!(0,t.isNullOrUndefined)(i))return this.model.getConcept(i)},getElementAt(t){if(!(t<0||t>=this.value.length))return this.model.getConcept(this.value[t])},getFirstElement(){return this.getElementAt(0)},getLastElement(){return this.getElementAt(this.count-1)},addElement(e){return!(0,t.isNullOrUndefined)(e)&&(this.value.push(e.id),e.index=this.value.length-1,e.parent=this,e.ref=this,this.validate(),this.notify("value.added",e),this.propagate("value.changed",e,this),!0)},addElementAt(e,i=0){return(0,t.isNullOrUndefined)(e)&&(e=this.createElement()),this.value.splice(i,0,e.id),this.validate(),this.notify("value.added",e),this.propagate("value.changed",e,this),this},swapElement(t,e){if(!this.ordered)return this;let i=this.value[t];this.value[t]=this.value[e],this.value[e]=i;let n=this.getElementAt(t);n.index=+t;let r=this.getElementAt(e);return r.index=+e,this.notify("value.swapped",[n,r]),this},removeElement(e){let i=(0,t.valOrDefault)(e.index,this.value.indexOf(e.id));return-1!==i&&this.removeElementAt(i)},removeElementAt(e){let i=this.getElementAt(e);if((0,t.isNullOrUndefined)(i))return{message:`The element at index '${e}' was not found.`,success:!1};i.delete(!0),this.value.splice(e,1);const n=this.getValue();for(let t=e;t<n.length;t++)n[t].index=t;return this.validate(),this.notify("value.removed",i),this.propagate("value.changed",i,this),{message:`The element '${i.name}' was successfully removed.`,success:!0}},removeAllElement(){return this.value.forEach((t=>{this.model.removeConcept(t)})),this.value=[],this.notify("value.changed",this.value),this.propagate("value.changed",this.value,this),this},createElement(t){const e={value:this.model.getValue(t),parent:this,ref:this},i=this.model.createConcept(this.accept,e);return this.addElement(i),i},getProperty(e,i){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e||"cardinality"===e)return this.value.length;let n=this.properties.find((t=>t.name===e));if((0,t.isNullOrUndefined)(n))return;const{type:r,value:s}=n;return"string"===r?s:"number"===r?+s:"boolean"===r?(0,t.toBoolean)(s):s},hasProperty(t){return!!["refname","name","value","length","cardinality"].includes(t)||-1!==this.properties.findIndex((e=>e.name===t))},getCandidates(){return pt.call(this,this.accept)},getChildren(e){if(!this.hasValue())return[];const i=this.getElements();return(0,t.isNullOrUndefined)(e)?i:i.filter((t=>t.name===e))},validate(){if(this.errors=[],!this.hasConstraint())return{code:ht.SUCCESS};if(this.hasConstraint("cardinality")){let t=this.getConstraint("cardinality");const{type:e}=t;if("range"===e){const{min:i,max:n}=t[e];if(i&&this.value.length<i.value){let t=ht.MIN_CARDINALITY_ERROR;return this.errors.push(ct.call(this,t,i).message),{code:t,ctx:i}}if(n&&this.value.length>n.value){let t=ht.MAX_CARDINALITY_ERROR;return this.errors.push(ct.call(this,t,n).message),{code:t,ctx:n}}}else if("fixed"===e){const{value:i}=t[e];if(this.value.length!==i){let i=ht.FIX_CARDINALITY_ERROR;return this.errors.push(ct.call(this,i,t[e]).message),{code:i,ctx:t[e]}}}}return{code:ht.SUCCESS}},copy(t=!0){if(!this.hasValue())return null;const e={name:this.name,nature:this.nature,value:this.getValue().map((t=>t.copy(!1)))};return t&&this.model.addValue(e),e},clone(){return{id:this.id,name:this.name,value:this.getValue().map((t=>t.clone()))}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.value}},toString(){return this.getValue().map((t=>t.toString()))},toXML(){let t=this.getName();return`<${t} id="${this.id}">`+this.getValue().map((t=>t.toXML())).join("")+`</${t}>`}};function dt(){if(!this.hasConstraint("cardinality"))return 0;const t=this.getConstraint("cardinality"),{type:e}=t;if("range"===e){const{min:i}=t[e];return i.value}if("fixed"===e){const{value:i}=t[e];return i}return 0}function pt(t){return this.model.getConceptSchema(t)}const ft=Object.assign(Object.create(K),ut);Object.defineProperty(ft,"count",{get(){return this.value.length}}),Object.defineProperty(ft,"canAddValue",{get:()=>!0});const mt=200,gt=405;function vt(t,e){switch(t){case 401:return{success:!1,message:`Valid values: ${e}`};case 403:return{success:!1,message:`Maximum length: ${e.value}.`};case 402:return{success:!1,message:`Minimum length: ${e.value}.`};case 404:return{success:!1,message:`Fixed length: ${e.value}.`};case gt:return{success:!1,message:"The value is not valid."};case 406:return{success:!1,message:"The value is already used."}}}const bt={nature:"primitive",initValue(e){if((0,t.isNullOrUndefined)(e))return this.value=this.default,this;if((0,t.isObject)(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},restore(t){const{value:e}=t;this.setValue(e)},hasValue(){return!(0,t.isNullOrWhitespace)(this.value)},getValue(){return this.value},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},setValue(e){let i=(0,t.isObject)(e)?e.value:e;var{code:n,ctx:r}=this.validate(i);return this.value!==i&&(this.value=i,this.notify("value.changed",i),this.propagate("value.changed",i,this)),n!==mt?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},getProperty(e,i){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e)return this.value.length;let n=this.properties.find((t=>t.name===e));if((0,t.isNullOrUndefined)(n))return;const{type:r,value:s}=n;return"string"===r?s:"number"===r?+s:"boolean"===r?(0,t.toBoolean)(s):s},hasProperty(t){return!!["refname","name","value","length"].includes(t)||-1!==this.properties.findIndex((e=>e.name===t))},getCandidates(){let i=(0,t.valOrDefault)(this.getConstraint("values"),[]);return(0,t.isEmpty)(i)?[...this.src.map((i=>{if("reference"===i.type){const{source:n,target:r}=i;let s=this.model.environment.getModel(n.name||n);if((0,t.isNullOrUndefined)(s))return null;let a=s.concept||s;if(!Array.isArray(a))return null;if(a.forEach((i=>{const n=function(i,n){var r=n;const s=[],a=n=>{let r=i.find((t=>t.name===n));if(!(0,t.isNullOrUndefined)(r))return(0,e.p$)(r)};for(;!(0,t.isNullOrUndefined)(r);){const e=(0,t.valOrDefault)(a(r),{});o=e.attributes,Array.isArray(o)&&o.forEach((e=>{const i=s.find((t=>t.name===e.name));(0,t.isNullOrUndefined)(i)?s.push(e):e.required&&(i.required=e.required)})),r=e.prototype}var o;return{attributes:s}}(a,i.prototype);i.attributes.push(...n.attributes)})),(0,t.isNullOrUndefined)(r.rel))return a.map((t=>t[r.value]));let o=wt.call(this,r,a);return(0,t.isNullOrUndefined)(o)?[]:o}if("concept"===i.type){const{concept:t,value:e}=i;let n=this.model.getConceptsByPrototype(t.prototype);return"attribute"===e.type?n.map((t=>t.getAttribute(e.name).getValue())):[]}return i}))].flat().filter((e=>!(0,t.isNullOrUndefined)(e))):i.map((t=>yt.call(this,t))).flat().filter((e=>!(0,t.isNullOrWhitespace)(e)))},getChildren:t=>[],update:(t,e)=>!0,validate(e){if(this.errors=[],(0,t.isNullOrWhitespace)(e))return{code:mt};if(!this.hasConstraint())return{code:mt};if(this.hasConstraint("length")){let t=this.getConstraint("length");const{type:i}=t;if("range"===i){const{min:n,max:r}=t[i];if(n&&e.length<n.value){let t=402;return this.errors.push(vt.call(this,t,n).message),{code:t,ctx:n}}if(r&&e.length>r.value){let t=403;return this.errors.push(vt.call(this,t,r).message),{code:t,ctx:r}}}else if("fixed"===i){const{value:n}=t[i];if(e.length!==n){let e=404;return this.errors.push(vt.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("pattern"===i){const{value:i,insensitive:n=!0,global:r=!0}=t.pattern;let s="";if(n&&(s+="g"),r&&(s+="i"),!new RegExp(i,s).test(e)){let e=gt;return this.errors.push(vt.call(this,e,t.pattern).message),{code:e,ctx:t.pattern}}}else if(i==="match".startsWith){const{start:n,end:r}=t[i];if(n&&!e.startsWith<n.value){let e=gt;return this.errors.push(vt.call(this,e,t.match).message),{code:e,ctx:t.match}}if(r&&e.length>r.value){let e=gt;return this.errors.push(vt.call(this,e,t.match).message),{code:e,ctx:t.match}}}else if("unique"===i){const{rel:i="parent",prototype:n}=t.unique;let r=this.getParent(),s=[];if(n?(r.hasPrototype()||(s=[]),s=this.model.getConceptsByPrototype(r._prototype)):s=this.model.getConcepts(r.name),s.some((t=>t!==r&&Et(t,this.ref.name)===e))){let e=406;return this.errors.push(vt.call(this,e,t.unique).message),{code:e,ctx:t.unique}}}}if(this.hasConstraint("values")){let i=this.getConstraint("values").map((t=>yt.call(this,t))).flat(),n=!1;for(let r=0;!n&&r<i.length;r++){const s=i[r];n=(0,t.isObject)(s)?s.value===e:s===e}if(!n){let t=401;return this.errors.push(vt.call(this,t,i).message),{code:t,ctx:i}}}return{code:mt}},copy(t=!0){if(!this.hasValue())return null;const e={name:this.name,nature:this.nature,value:this.getValue()};return t&&this.model.addValue(e),e},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let t=this.getName();return`<${t} id="${this.id}">`+this.getValue()+`</${t}>`}};function yt(t){if("reference"===t.type){let t=[];return this.model.isPrototype("model concept")&&(t=this.model.getConceptsByPrototype("model concept")),t.map((t=>t.getChildren(this.name))).flat().map((t=>t.value))}if("meta-reference"===t.type){let t=[];return this.model.isPrototype("model concept")&&(t=this.model.getConceptsByPrototype("model concept")),t.map((t=>t.getChildren(this.name))).flat().map((t=>t.value))}return t}function wt(e,i){const{name:n,rel:r,scope:s,value:a}=e;let o=null;if("parent"===r){let e=this.getParent(n);if((0,t.isNullOrUndefined)(a))return e;if("reference"===a.type)return wt.call(e,a);if("attribute"===a.type)return e.getAttributeByName(a.name).getValue()}if("children"===r){let e=this.getChildren(n);if((0,t.isNullOrUndefined)(a))return e;if("reference"===a.type)return e.map((t=>wt.call(t,a)));if("attribute"===a.type)return e.filter((t=>Nt(t,a.name)&&At(t,a.name))).map((t=>Et(t,a.name)))}if(e.source){const{type:t,value:i}=e.source;o="reference"===t?wt.call(this,e.source):i}if((0,t.isNullOrUndefined)(o))return i.map((t=>t[n].map((t=>t[a]))));if((0,t.isIterable)(o)&&(0,t.isEmpty)(o))return[];let l=i.find((t=>Array.isArray(o)?o.includes(t.name):t.name===o));return(0,t.isNullOrUndefined)(l)||!(0,t.hasOwn)(l,n)?[]:l[n].map((t=>t[a]))}const xt=(t,e)=>t.getAttributeByName(e).target,Et=(t,e)=>xt(t,e).getValue(),At=(t,e)=>xt(t,e).hasValue(),Nt=(t,e)=>t.isAttributeCreated(e),Ot=Object.assign(Object.create(K),bt),Mt={nature:"concrete",initValue(e){if((0,t.isNullOrUndefined)(e))return!1;const{id:i="",attributes:n=[]}=e;return i.length>10&&(this.id=i),n.forEach((t=>{const{name:e,id:i,value:n}=t;this.createAttribute(e,n)})),!0},restore(t){const{attributes:e}=t;e.forEach((t=>{const{name:e,id:i,value:n}=t;this.isAttributeCreated(e)||this.createAttribute(e,n)}))},hasValue:()=>!0,getValue(){return{name:this.name,attributes:this.getAttributes().map((t=>({name:t.name,value:t.copy(!1)})))}},setValue(t){const{attributes:e=[]}=t;return e.forEach((t=>{const{name:e,id:i,value:n}=t;this.hasAttribute(e)&&this.createAttribute(e,n)})),!0}},jt=Object.assign(Object.create(K),Mt),Ct=200;function Lt(t){switch(t){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const St={name:"prototype",nature:"prototype",initValue(e){if((0,t.isNullOrUndefined)(e)){if(this.default){let t=this.createConcept(this.default);this.setValue(t)}return this}const{id:i="",value:n}=e;i.length>10&&(this.id=i);let r=null;return n?(r=this.createConcept(n.name,n),this.setValue(r)):e.name&&e.attributes&&(r=this.createConcept(e.name,e),this.setValue(r)),this},getValue(e=!1){return(0,t.isNullOrUndefined)(this.value)?null:e?this.target:this.value},getTarget(){return this.target},restore(e){const{value:i}=e;if((0,t.isNullOrUndefined)(i))return;let n=this.createConcept(i.name,i);this.setValue(n)},setValue(e){let i=e.name||e;if(this.validate(i)!==Ct)return{success:!1,message:"Validation failed: The value could not be updated."};let n=e;if(e&&"concept"===e.object&&(0,t.hasOwn)(e,"id")||(n=e.attributes?this.createConcept(i,e):this.createConcept(i)),this.target){let t=this.target.copy(!1);this.target.delete(!0),n.setValue(t)}return this.target=n,this.value=i,this.notify("value.changed",this.getCandidates().find((t=>t.name===this.value))),this.propagate("value.changed",i,this),{success:!0,message:"The value has been successfully updated."}},removeValue(){return(0,t.isNullOrUndefined)(this.value)||(this.value=null,this.notify("value.changed",this.value)),{success:!0,message:"The value has been successfully updated."}},hasValue(){return!(0,t.isNullOrUndefined)(this.value)},getCandidates(){return this.candidates||(this.candidates=kt.call(this,this.schema.accept).map((t=>({type:"meta-concept",name:t.name,concept:Object.create(Tt,{object:{value:"meta-concept"},type:{value:"meta-concept"},name:{value:t.name},model:{value:this.model},schema:{value:t}})})))),this.candidates},getChildren(e){if(!this.hasValue())return[];const i=[];return((0,t.isNullOrUndefined)(e)||this.target.name===e)&&i.push(this.target),i},createConcept(t,e){let i=this.model.getValue(e);const n={parent:this,ref:this};i&&(n.value=i);const r=this.model.createConcept(t,n);return r.prototype=this,r},validate(e){if((0,t.isNullOrWhitespace)(e))return Ct;if((0,t.isEmpty)(this.values))return Ct;var i=!1;for(let n=0;!i&&n<this.values.length;n++){const r=this.values[n];i=(0,t.isObject)(r)?r.value===e:r===e}if(!i){let t=401;return this.errors.push(Lt.call(this,t).message),t}return Ct},copy(t=!0){if(!this.hasValue())return null;const e={name:this.name,nature:this.nature,value:this.target.copy(!1)};return t&&this.model.addValue(e),e},clone(){let t=null;return this.hasValue()&&(t=this.target.clone()),{id:this.id,name:this.name,value:t}},export(){let t=null;return this.hasValue()&&(t={id:this.target.id,name:this.target.name}),{id:this.id,name:this.name,root:this.isRoot(),value:t}},toXML(){if(!this.hasValue())return"";let t=this.getName();return`<${t} id="${this.id}">`+this.target.attributes.map((t=>t.toXML())).join("")+`</${t}>`}};function kt(e){const i=this.model.getConcreteConcepts(this.name);return(0,t.isNullOrUndefined)(e)?i:Array.isArray(e)?i.filter((t=>e.some((e=>e.name===t.name)))):i.filter((t=>e===t.name))}const Tt={getProperty(e,i){if("refname"===e)return this.name;if("name"===e)return this.name;let n=this.properties.find((t=>t.name===e));if((0,t.isNullOrUndefined)(n))return;const{type:r,value:s}=n;return"string"===r?s:"number"===r?+s:"boolean"===r?(0,t.toBoolean)(s):s},hasPrototype(e){if((0,t.isNullOrUndefined)(this.schema.prototype))return!1;let i=this.model.getConceptSchema(this.schema.prototype);for(;!(0,t.isNullOrUndefined)(i);){if(i.name===e)return!0;i=this.model.getConceptSchema(i.prototype)}return!1}},Ut=Object.assign({},K,St);function It(t){switch(t){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const _t={name:"meta",reference:null,initValue(e){return(0,t.isNullOrUndefined)(e)||this.setValue(e.value),this},hasValue(){return!(0,t.isNullOrWhitespace)(this.value)},getValue(){return(0,t.isNullOrUndefined)(this.value)?null:this.value},getProperty(e){const i=this.schema[e];if((0,t.isObject)(i)){const t=[];for(const e in i){const n=i[e];t.push(Object.assign({},{name:e},n))}return t}return i},setValue(e){var i=this.validate(e);return 200!==i?{success:!1,message:"Validation failed: The value could not be updated.",errors:[It(i).message]}:(0,t.isNullOrUndefined)(e)||this.value===e?void 0:(this.reference&&this.reference.unregister(this),this.reference=this.model.getConcept(e),this.reference.register(this),this.value=e,this.notify("value.changed",this.reference),{success:!0,message:"The value has been successfully updated."})},getChildren:t=>[],delete(t=!1){if(!t){let t=this.getParent().remove(this);if(!t.success)return t}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(t,e){switch(t){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(e){return(0,t.isNullOrWhitespace)(e)||(0,t.isEmpty)(this.values),200},export(){return{id:this.id,name:this.name,value:this.value}},toString(){var t=[];return this.value.forEach((e=>{t.push(e.toString())})),t}},Ht=Object.assign({},K,_t);function Dt(t,e){return{object:{value:"concept"},type:{value:"concept"},model:{value:t},name:{value:e.name},base:{value:e.base},schema:{value:e,writable:!0}}}const Pt={boolean:(t,e)=>Object.create(tt,Dt(t,e)),number:(t,e)=>Object.create(rt,Dt(t,e)),reference:(t,e)=>Object.create(lt,Dt(t,e)),set:(t,e)=>Object.create(ft,Dt(t,e)),string:(t,e)=>Object.create(Ot,Dt(t,e)),meta:(t,e)=>Object.create(Ht,Dt(t,e))},Vt={primitive:(t,e)=>Pt[e.name](t,e),prototype:(t,e)=>Object.create(Ut,Dt(t,e)),concrete:(t,e)=>Object.create(jt,Dt(t,e)),derivative:(t,e)=>Pt[e.base](t,e)},Bt={createConcept(e,i,n){const{name:r,nature:s}=i,a=Vt[s];if((0,t.isNullOrUndefined)(a))throw new Error(`Missing handler: The '${r}' concept could not be handled`);const o=a(e,i);if((0,t.isNullOrUndefined)(o))throw new Error(`Bad request: The '${r}' concept could not be created`);return o.init(n),(0,t.isNullOrUndefined)(o.id)&&(o.id=z.h.generate()),o}};var Rt=0;const zt={concepts:null,values:null,listeners:null,get hasError(){return this.concepts.some((t=>t.hasError))},init(t){return this.concepts=[],this.values=[],this.listeners=[],Array.isArray(t)&&(this.values=t,t.filter((t=>t.root)).forEach((t=>{this.createConcept({name:t.name},{value:t})})),this.values=t.filter((t=>t.id.startsWith("value")))),this},initValue(t){return Array.isArray(t)&&(this.values=t,t.filter((t=>t.root)).forEach((t=>{this.createConcept({name:t.name},{value:t})})),this.values=t.filter((t=>t.id.startsWith("value")))),this},done(){return this.concepts.forEach((t=>{t.done()})),this.concepts=[],!0},createConcept(e,i){const n=this.getCompleteModelConcept(e);if((0,t.isNullOrUndefined)(n))throw new Error(`Concept not found: ${e}`);var r=Bt.createConcept(this,n,i);return this.addConcept(r),r},getConcepts(e){if((0,t.isIterable)(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.concepts.filter((e=>t(e)))}return this.concepts.slice()},getRootConcepts(){return this.concepts.filter((t=>t.isRoot()))},getConceptsByPrototype(t){return this.concepts.filter((e=>e.hasPrototype(t)))},getConcept(e){if(!(0,t.isString)(e)||(0,t.isEmpty)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");return this.concepts.find((t=>t.id===e))},addConcept(e){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad request: The 'concept' argument must be a Concept");return this.concepts.push(e),e.register(this.environment),this},removeConcept(e){if(!(0,t.isObject)(e)&&!(0,t.isString)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var i=this.concepts.findIndex((t=>t.id===e));return-1===i?null:this.concepts.splice(i,1)[0]},hasConcept(e){if(!(0,t.isObject)(e)&&!(0,t.isString)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");if((0,t.isEmpty)(this.concepts))return!1;let i=e.id||e;return e.name,this.concepts.some((t=>t.id===i))},getValues(e){if((0,t.isIterable)(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.values.filter((e=>t(e)))}return this.values.slice()},getValue(e){return(0,t.isNullOrUndefined)(e)?null:(0,t.hasOwn)(e,"value")||(0,t.hasOwn)(e,"attributes")?e:(0,t.hasOwn)(e,"id")?this.values.find((t=>t.id===e.id)):this.values.find((t=>t.id===e))},addValue(e){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad request: The 'value' argument must be a Value");return this.values.some((t=>{return n=e,(i=t).name===n.name&&(i.value?i.value===n.value:JSON.stringify(i.attributes)===JSON.stringify(n.attributes));var i,n}))||(e.id="value"+Rt++,this.values.push(e),this.notify("value.added",e)),this},removeValue(e){if(!(0,t.isObject)(e)&&!(0,t.isString)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var i=this.values.findIndex((t=>t.id===e));if(-1===i)return null;let n=this.values.splice(i,1)[0];return this.notify("value.removed",n),n},register(t){return this.listeners.includes(t)||this.listeners.push(t),!0},unregister(t){let e=this.listeners.indexOf(t);return-1!==e&&(this.listeners.splice(e,1),!0)},unregisterAll(){this.listeners=[]},notify(t,e){this.listeners.forEach((i=>{i.update(t,e)}))},isConcept(e){return!!(0,t.isString)(e)&&-1!==this.schema.findIndex((t=>t.name===e))},isConcrete(e){if(!(0,t.isString)(e))return!1;const i=this.schema.find((t=>t.name===e));return!(0,t.isNullOrUndefined)(i)&&"concrete"===i.nature},isPrototype(e){if(!(0,t.isString)(e))return!1;const i=this.schema.find((t=>t.name===e));return!(0,t.isNullOrUndefined)(i)&&"prototype"===i.nature},hasPrototype(e,i){if(!this.isConcept(e))return!1;let n=this.getConceptSchema(e);for(;!(0,t.isNullOrUndefined)(n);){if(n.prototype===i)return!0;n=this.model.getConceptSchema(n.prototype)}return!1},addConceptSchema(t){let e=t.concept||t;return this.schema.push(...e),this.environment.update("concept-model.updated"),!0},getSchema(e){if((0,t.isIterable)(e)){const t=Array.isArray(e)?t=>e.includes(t.nature):t=>t.nature===e;return this.schema.filter((e=>t(e)))}return this.schema.slice()},getConceptSchema(i){const n=qt(this.schema,i);if(!(0,t.isNullOrUndefined)(n))return(0,e.p$)(n)},getCompleteModelConcept(e){let i=e;(0,t.isString)(e)&&(i={name:e});const n=this.getConceptSchema(i.name);if((0,t.isNullOrUndefined)(n))return;Object.assign(n,i),(0,t.hasOwn)(n,"attributes")||(n.attributes=[]);const r=$t.call(this,n.prototype);return n.attributes.push(...r.attributes),n},getConcreteConcepts(e){const i=i=>{for(var n=i.prototype;!(0,t.isNullOrUndefined)(n);){if(n===e)return!0;n=(0,t.valOrDefault)(qt(this.schema,n),{}).prototype}return!1},n=this.schema.filter((t=>"concrete"===t.nature));return e?n.filter((t=>i(t))):n},getDerivedConcepts(e){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad argument");return this.schema.filter((t=>t.base===e))},export(){const t=[];return this.getConcepts().forEach((e=>{t.push(e.export())})),t.push(...this.getValues()),t},toString(){return JSON.stringify({[this.root.name]:this.root.toString()})},toXML(){return"<model:gentleman>"+this.getRootConcepts().map((t=>t.toXML())).join("")+"</model:gentleman>"},toXMI(){return'\n            <?xml version="1.0" encoding="ISO-8859-1"?>\n            <xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gent="geodes.sms.gentleman">\n                <gent:Model name="MindMap">\n        '+this.getRootConcepts().map((t=>t.toXMI())).join("")+"\n                </gent:Model>\n            </xmi:XMI>\n        "}};function $t(e){var i=e;const n=[];for(;!(0,t.isNullOrUndefined)(i);){const e=(0,t.valOrDefault)(this.getConceptSchema(i),{});r=e.attributes,Array.isArray(r)&&r.forEach((e=>{const i=n.find((t=>t.name===e.name));(0,t.isNullOrUndefined)(i)?n.push(e):e.required&&(i.required=e.required)})),i=e.prototype}var r;return{attributes:n}}const Ft=[{name:"string",nature:"primitive"},{name:"number",nature:"primitive"},{name:"boolean",nature:"primitive"},{name:"reference",nature:"primitive"},{name:"set",nature:"primitive"}];function qt(e,i){let n=e.find((t=>t.name===i));return(0,t.isNullOrUndefined)(n)&&(n=Ft.find((t=>t.name===i))),n}const Wt=[],Xt={createModel(e,i){var n=Object.create(zt,{schema:{value:(0,t.valOrDefault)(e,[])},environment:{value:i}});return Wt.push(n),n}};function Yt(e){const{type:i}=e;let n=this.concept||this.source;return"property"===i?(0,t.valOrDefault)(n.getProperty(e.name),""):"param"===i?this.getParam(e.name):e}const Zt={css:function(e,i){return(0,t.isIterable)(i)?(te(e,i),e):e},ref:function(e,i){return(0,t.isIterable)(i)?(i.forEach((i=>{const{style:n={}}=(0,t.valOrDefault)(this.model.getStyleSchema(i),{});n.gss?Jt.call(this,e,n):Kt.call(this,e,n)})),e):e},gss:Kt,text:Qt,box:re,html:function(e,i){return(0,t.isIterable)(i)?(i.forEach((i=>{let n=`style${(0,t.capitalizeFirstLetter)(i.name)}`;e.dataset[n]=Yt.call(this,i.value),"property"===i.value.type&&this.registerHandler("value.changed",(t=>{e.dataset[n]=Yt.call(this,i.value)}))})),e):e}},Gt={text:Qt,box:re};function Jt(e,i){if(!(0,t.isObject)(i))return e;for(const n in i){const r=i[n];let s=Zt[n];(0,t.isFunction)(s)&&s.call(this,e,r)}return e}function Kt(e,i){if(!(0,t.isObject)(i))return e;for(const n in i){const r=i[n];let s=Gt[n];(0,t.isFunction)(s)&&s.call(this,e,r)}return e}function Qt(t,e){for(const i in e){const n=e[i];if(!1!==n)switch(i){case"bold":t.style.fontWeight=ie(n);break;case"italic":t.style.fontStyle="italic";break;case"underline":t.style.textDecoration="underline";break;case"strikethrough":t.style.textDecoration="line-through";break;case"color":t.style.color=ee(n);break;case"font":t.style.fontFamily=n.toString();break;case"size":t.style.fontSize=ne(n);break;case"transform":t.style.textTransform=n}}return t}function te(e,i){if(Array.isArray(i))e.classList.add(...i);else{let n=i.replace(/\s+/g," ").trim();(0,t.isNullOrWhitespace)(e.className)?e.className=n:te(e,n.split(" "))}return e}function ee(e){if((0,t.isNullOrUndefined)(e))return"";const{type:i,value:n}=e;switch(i){case"rgb":return(0,t.isObject)(n)?`rgb(${n.red}, ${n.green}, ${n.blue})`:n;case"rgba":return(0,t.isObject)(n)?`rgba(${n.red}, ${n.green}, ${n.blue}, ${n.opacity/100})`:n;case"name":case"hexadecimal":return n;default:return n||e}}function ie(e){if((0,t.isNullOrUndefined)(e))return"";const{type:i,value:n}=e;return Number.isInteger(e)?`${e}`:"bold"}function ne(e){if((0,t.isNullOrUndefined)(e))return"";const{value:i,unit:n}=e;return(0,t.isNullOrUndefined)(i)?"":`${i}${n}`}function re(t,e){for(const i in e){const n=e[i];if(!1!==n)switch(i){case"inner":se.call(this,t,n,"padding");break;case"outer":se.call(this,t,n,"margin");break;case"border":le.call(this,t,n);break;case"corner":he.call(this,t,n);break;case"background":ae.call(this,t,n);break;case"width":t.style.width=ne.call(this,n);break;case"height":t.style.height=ne.call(this,n);break;case"opacity":t.style.opacity=n/100;break;case"shadow":oe.call(this,t,n,"shadow")}}return t}function se(e,i,n){if(!(0,t.isNullOrUndefined)(i))for(const t in i){const r=i[t];switch(t){case"all":e.style[`${[n]}`]=ne.call(this,r);break;case"top":e.style[`${[n]}Top`]=ne.call(this,r);break;case"right":e.style[`${[n]}Right`]=ne.call(this,r);break;case"bottom":e.style[`${[n]}Bottom`]=ne.call(this,r);break;case"left":e.style[`${[n]}Left`]=ne.call(this,r)}}}function ae(e,i){if((0,t.isNullOrUndefined)(i))return;const{color:n,image:r}=i;n&&(e.style.backgroundColor=ee.call(this,n)),r&&(e.style.backgroundImage=`url(${r})`)}function oe(e,i){if((0,t.isNullOrUndefined)(i))return null;const{offsetX:n,offsetY:r,blur:s,spread:a,inset:o=!1,color:l}=i;if((0,t.isNullOrUndefined)(n)||(0,t.isNullOrUndefined)(r))return null;let h=ne.call(this,n),c=ne.call(this,r),u=ne.call(this,s),d=ne.call(this,a),p=ee.call(this,l);e.style.boxShadow=o?`inset ${h} ${c} ${u} ${d} ${p}`.trim():`${h} ${c} ${u} ${d} ${p}`.trim()}function le(e,i){if(!(0,t.isNullOrUndefined)(i))for(const n in i){const r=i[n];switch(n){case"all":e.style.borderStyle=(0,t.valOrDefault)(r.type,"solid"),e.style.borderWidth=ne.call(this,r.width),e.style.borderColor=ee.call(this,r.color);break;case"top":e.style.borderTopStyle=(0,t.valOrDefault)(r.type,"solid"),e.style.borderTopWidth=ne.call(this,r.width),e.style.borderTopColor=ee.call(this,r.color);break;case"right":e.style.borderRightStyle=(0,t.valOrDefault)(r.type,"solid"),e.style.borderRightWidth=ne.call(this,r.width),e.style.borderRightColor=ee.call(this,r.color);break;case"bottom":e.style.borderBottomStyle=(0,t.valOrDefault)(r.type,"solid"),e.style.borderBottomWidth=ne.call(this,r.width),e.style.borderBottomColor=ee.call(this,r.color);break;case"left":e.style.borderLeftStyle=(0,t.valOrDefault)(r.type,"solid"),e.style.borderLeftWidth=ne.call(this,r.width),e.style.borderLeftColor=ee.call(this,r.color)}}}function he(e,i){if((0,t.isNullOrUndefined)(i))return null;for(const t in i){const n=i[t];switch(t){case"all":e.style.borderRadius=ne.call(this,n);break;case"top-left":e.style.borderTopLeftRadius=ne.call(this,n);break;case"top-right":e.style.borderTopRightRadius=ne.call(this,n);break;case"bottom-right":e.style.borderBottomRightRadius=ne.call(this,n);break;case"bottom-left":e.style.borderBottomLeftRadius=ne.call(this,n)}}}const ce={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,children:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasError(){return this.source.hasError},get hasAttached(){return!(0,t.isEmpty)(this.attached)},attach(t,e){this.attached.push(t)},detach(t){this.attached.slice(this.attached.indexOf(t),1)},getAttached(e){return(0,t.isFunction)(e)?this.attached.filter((t=>e(t))):this.attached},show(){return(0,e.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,e.Cp)(this.element),this.visible=!1,this},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},focus(t){return this.element.contentEditable=!1,this.element.focus(),this.focused=!0,this},getContainer(){return this.element},notify(t,i,n){(0,e.lL)(this.element),this.environment.notify(t,i)},append(e){if(!(0,t.isHTMLElement)(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.append(e),this},_focusIn:t=>!1,enable(){return this.disabled=!1,this},disable(){return this.disabled=!0,this},clear:()=>!0,delete(){var i=this.source.delete();i.success?(this.clear(),(0,t.removeChildren)(this.element),this.element.remove()):(this.environment.notify(i.message),(0,e.lL)(this.element))},spaceHandler(t){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(t){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(t){return console.warn(`ESCAPE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},enterHandler(t){this.focusOut()},deleteHandler(i){if(this.projection.element!==this)return(0,e.lL)(i),!1;if(!this.projection.optional)return(0,e.lL)(this.element),!1;let n=(0,t.findAncestor)(i,(t=>0===t.tabIndex)),r=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),r),this.source.delete();let s=this.environment.resolveElement(n);return(0,t.isNullOrUndefined)(s)||s.focus(),!1},backspaceHandler(t){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(t,e){return console.warn(`ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_arrowHandler(t,e){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(t){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(t){this.toolbar&&this.toolbar.remove()},shiftHandler(t,e){return console.warn(`SHIFT_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1}},ue=Object.assign(ce);function de(e){if(!(0,t.isHTMLElement)(e))return!1;const{nature:i,id:n}=e.dataset;return"field-component"===i&&n===this.id}const pe={init(){return this.elements=new Map,this},render(){const e=(0,t.createDocFragment)(),{content:i="Add",items:n}=this.schema;(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:["field","add-button"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Jt.call(this.projection,this.element,this.schema.style));let r=(0,t.createButton)({class:["field-action","field--list__add"],tabindex:0,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});return(0,t.isNullOrUndefined)(n)||(this.item=n),r.append(i),e.appendChild(r),e.hasChildNodes()&&this.element.append(e),this.bindEvent(),this.element},focusIn(){},clickHandler(e){const i=(e=>de.call(this,e)?e:(0,t.findAncestor)(e,(t=>de.call(this,t)),5))(e);if((0,t.isNullOrUndefined)(i))return;const{action:n,index:r,name:s}=i.dataset;"add"===n?(this.parent.prio=this.element,this.createElement()):"remove"===n&&this.delete(i.parentElement),this.parent.prio=this.element},createElement(){this.source.createElement()},addItem(t){return this.parent.addItem(t,this),this},removeItem(t){this.parent.removeItem(t)},refresh(){this.element&&this.source.getValue().forEach((t=>{this.addItem(t)}))},focusOut(){},bindEvent(){this.projection.registerHandler("value.added",(t=>{this.addItem(t)})),this.projection.registerHandler("value.removed",(t=>{this.removeItem(t)}))}},fe=Object.assign(Object.create(ue),pe);function me(e,i){if(!Array.isArray(i))return!1;e.currentState=null;for(let n=0;n<i.length;n++){const r=i[n],{rule:s,result:a}=r;if((0,t.isNullOrUndefined)(s))return a;let o=!1,l=ge[s.type];if((0,t.isFunction)(l)&&(o=l.call(this,s[s.type])),o)return e.currentState=n,a}return null}const ge={ref:function(e){const{rule:i={}}=(0,t.valOrDefault)(this.model.getRuleSchema(e),{});let n=ge[i.type];return!!(0,t.isFunction)(n)&&n.call(this,i[i.type])},eq:function(t){if(!Array.isArray(t))throw new TypeError("Terms need to be an array");if(t.length<2)return null;return ve.call(this,t[0])==ve.call(this,t[1])},ne:function(t){if(!Array.isArray(t))throw new TypeError("Terms need to be an array");if(t.length<2)return null;return ve.call(this,t[0])!=ve.call(this,t[1])},lt:function(t){if(!Array.isArray(t))throw new TypeError("Terms need to be an array");if(t.length<2)return null;return ve.call(this,t[0])<ve.call(this,t[1])},le:function(t){if(!Array.isArray(t))throw new TypeError("Terms need to be an array");if(t.length<2)return null;return ve.call(this,t[0])<=ve.call(this,t[1])},gt:function(t){if(!Array.isArray(t))throw new TypeError("Terms need to be an array");if(t.length<2)return null;return ve.call(this,t[0])>ve.call(this,t[1])},ge:function(t){if(!Array.isArray(t))throw new TypeError("Terms need to be an array");if(t.length<2)return null;return ve.call(this,t[0])>=ve.call(this,t[1])},and:function(t){return be.call(this,t[0])&&be.call(this,t[1])},or:function(t){return be.call(this,t[0])||be.call(this,t[1])},not:function(t){return!be.call(this,t[0])},no:function(e){let i=ve.call(this,e);return(0,t.isIterable)(i)?(0,t.isEmpty)(i):(0,t.isNullOrUndefined)(i)}};function ve(e,i){if(e&&"property"===e.type){const{name:i}=e;let n=`get${(0,t.pascalCase)(i)}`;return this[n]?this[n]():this[i]}if(e&&"param"===e.type){const{name:t}=e;return this.projection.getParam(t)}if((0,t.isObject)(e)){let i=`get${(0,t.pascalCase)(e.prop)}`;return this[i]?this[i]():this[e.prop]}return i||e}function be(e){let i=ge[e.type];return(0,t.isFunction)(i)?i.call(this,e[e.type]):(0,t.toBoolean)(ve.call(this,e))}function ye(e){const{type:i}=e;return"property"===i?(this.hasProperty=!0,(0,t.valOrDefault)(this.source.getProperty(e.name),"")):"param"===i?this.projection.getParam(e.name):"html"===i?(0,t.htmlToElement)(e.html):"raw"===i?(0,t.htmlToElement)(e.raw):e}const we={input:null,label:null,value:"",state:null,init(){const{focusable:t=!0}=this.schema;return this.focusable=t,this.children=[],this},refresh(){if((0,t.valOrDefault)(me.call(this,this.schema,this.schema.state),this.schema),this.schema.state){let e=this.schema.state[this.getValue().toString()];if(e&&e.content){const{style:i,content:n,value:r}=e;let s=(0,t.createDocFragment)();n.forEach((t=>{s.append(us.call(this,t))})),(0,t.removeChildren)(this.label).append(s),Jt.call(this.projection,this.label,i)}}this.input.checked?this.element.dataset.state="on":this.element.dataset.state="off",this.hasError?(this.element.classList.add("error"),this.input.classList.add("error")):(this.element.classList.remove("error"),this.input.classList.remove("error"))},render(){const i=(0,t.createDocFragment)(),{checkbox:n}=this.schema;var r;if((0,t.isHTMLElement)(this.element)||(this.element=(r=this.id,(0,t.createDiv)({id:r,class:["field","field--binary"],tabindex:-1,dataset:{nature:"field",view:"binary",id:r}})),this.readonly&&this.element.classList.add("readonly"),Jt.call(this.projection,this.element,this.schema.style)),!(0,t.isHTMLElement)(this.input)){if(this.input=function(e){return(0,t.createInput)({id:`checkbox${e}`,type:"checkbox",class:["field--binary__input"],tabindex:0,dataset:{nature:"field-component",view:"binary",id:e}})}(this.id),this.input.checked=this.source.getValue(),this.value=this.input.checked,this.readonly&&(this.input.classList.add("readonly"),this.input.disabled=!0),n){const{style:t}=n;Jt.call(this.projection,this.input,t)}else(0,e.Cp)(this.input);i.append(this.input)}if(!(0,t.isHTMLElement)(this.label)){if(this.label=(0,t.createLabel)({class:["field--checkbox__label"],for:this.input.id,tabindex:0,dataset:{nature:"field-component",view:"binary",id:this.id}}),this.label.htmlFor=this.input.id,n&&n.label){const{content:e}=n.label;if(Array.isArray(e))e.forEach((e=>{let i=ye.call(this,e),n=(0,t.createSpan)({class:["field--checkbox__label-content"],dataset:{ignore:"all"}},i);Jt.call(this.projection,n,e.style),this.label.append(n)}));else{let t=ye.call(this,e);this.label.append(t)}Jt.call(this.projection,this.label,n.label.style)}i.append(this.label)}return i.hasChildNodes()&&(this.element.append(i),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.value=this.input.checked,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.hasChanges()&&this.setValue(this.input.checked),this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.choice&&(0,e.Cp)(this.choice),this.input.blur(),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!==this.input.checked},hasValue(){return this.input.checked},getValue(){return this.input.checked},setValue(t,e=!1){var i;(i=e?this.source.setValue(t):{success:!0}).success||this.environment.notify(i.message,"error"),this.input.checked=t,this.value=t,this.refresh()},getCandidates(){return this.source.getCandidates()},enable(){this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1},disable(){this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0},escapeHandler(i){let n=!0;if(this.messageElement&&!(0,e.xj)(this.messageElement)&&((0,e.Cp)(this.messageElement),n=!1),n){let e=(0,t.findAncestor)(i,(t=>0===t.tabIndex));return this.environment.resolveElement(e).focus(e),!0}},backspaceHandler(t){return this.arrowHandler("left",t)},enterHandler(t){this.setValue(!this.input.checked,!0)},arrowHandler(t,e){return!!this.parent&&this.parent.arrowHandler(t,this.element)},bindEvents(){this.element.addEventListener("change",(t=>{this.setValue(this.getValue(),!0)})),this.projection.registerHandler("value.changed",(t=>{this.setValue(t)}))}},xe=Object.assign(Object.create(ue),we);function Ee(e){const i=t=>t.parentElement===this.choices;return i(e)?e:(0,t.findAncestor)(e,i,5)}function Ae(t){const{type:e}=t.dataset;return e}function Ne(t){const{type:e,value:i}=t.dataset;return"concept"===e?this.values.find((t=>t.id===i)).id:"meta-concept"===e?this.values.find((t=>t.name===i)).name:"value"===e?i:"placeholder"===e?null:i}const Oe=(t,e)=>"concept"===t.type?Oe(t.id,e):"concept"===e.type?Oe(t,e.id):"meta-concept"===t.type?Oe(t.name,e):"meta-concept"===e.type?Oe(t,e.name):t===e,Me={value:null,placeholder:null,expanded:null,values:null,choices:null,input:null,items:null,selection:null,selectList:null,selectListValue:null,icoToggle:null,init(e={}){Object.assign(this.schema,e);const{focusable:i=!0,placeholder:n=!1,expanded:r=!0}=this.schema;return this.items=new Map,this.focusable=i,this.expanded=r,this.placeholder=n,this.children=[],(0,t.hasOwn)(this.schema,"choice")||(this.schema.choice={}),(0,t.hasOwn)(this.schema.choice,"option")||(this.schema.choice.option={}),this},hasChanges(){return this.value!=this.source.getValue()},reset(){this.source.removeValue()},hasValue(){return!(0,t.isNullOrUndefined)(this.value)},getValue(){return this.selection},setValue(i,n=!1){var r=null;if(n)return(r=this.source.setValue(i)).success||this.environment.notify(r.message,e.k$.ERROR),!0;(0,t.isNullOrUndefined)(i)?(this.selection&&this.selection.classList.remove("selected"),this.expanded||(0,t.removeChildren)(this.selectListValue),this.selection=null):this.setChoice(i),(0,t.isNullOrUndefined)(i)?this.value=null:"concept"===i.type?this.value=i.id:"meta-concept"===i.type?this.value=i.name:this.value=i;const{template:s={}}=this.schema.choice.option;if(this.selection&&!this.expanded&&i)if((0,t.removeChildren)(this.selectListValue),"meta-concept"===i.type){let e=this.model.getProjectionSchema(i.concept,(0,t.valOrDefault)(s.tag))[0],n=e.type,r={type:n,[n]:e.content||e.projection},a=us.call(this,r,i.concept,{focusable:!1,meta:i.name});this.selectListValue.append(a)}else if("concept"===i.type){let t=this.model.createProjection(i,s.tag).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,this.selectListValue.append(t.render())}else this.selectListValue.append(i.toString());this.refresh()},refresh(){return this.hasValue()?(this.element.classList.remove("empty"),this.element.dataset.value=this.value.name||this.value):(this.element.classList.add("empty"),this.element.dataset.value="",!this.expanded&&this.placeholder&&(0,t.removeChildren)(this.selectListValue).append(this.placeholder)),this.input&&(this.element.dataset.input=this.input.value),this.element.classList.remove("querying"),this.hasError?(this.element.classList.add("error"),this.input&&this.input.classList.add("error")):(this.element.classList.remove("error"),this.input&&this.input.classList.remove("error")),this},render(){const e=(0,t.createDocFragment)(),{choice:i,input:n,style:r}=this.schema;if((0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:["field","field--choice"],tabindex:-1,dataset:{nature:"field",view:"choice",input:"",id:this.id}})),!(0,t.isHTMLElement)(this.input)&&n){const{placeholder:i="",type:r,style:s}=n;let a=os.call(this,i);this.input=(0,t.createInput)({class:["field--choice__input"],type:(0,t.valOrDefault)(r,"text"),placeholder:a,title:a,dataset:{nature:"field-component",view:this.type,id:this.id}}),Jt.call(this,this.input,s),e.append(this.input)}if(!(0,t.isHTMLElement)(this.choices)){const{style:n}=i;this.choices=(0,t.createUnorderedList)({class:["bare-list","field--choice__choices"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),Jt.call(this,this.choices,n),e.append(this.choices)}if(!this.expanded){let i=(0,t.createDiv)({class:["field--choice__select-wrapper"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}});this.selectListValue=(0,t.createDiv)({class:["field--choice__select-value"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),this.icoToggle=(0,t.createI)({class:["field--choice__select-icon"],dataset:{nature:"field-component",view:"choice",id:this.id}}),i.append(this.selectListValue,this.icoToggle),this.selectList=(0,t.createDiv)({class:["field--choice__select-list","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.input&&this.selectList.append(this.input),this.selectList.append(this.choices),e.append(i),e.append(this.selectList)}if(Jt.call(this,this.element,r),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),(0,t.removeChildren)(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let i=(0,t.createListItem)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(i),Jt.call(this,i,e)}return this.values=this.source.getCandidates(),this.values.forEach((t=>{this.choices.append(this.createChoiceOption(t))})),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},focus(t){if(this.expanded)if(this.choices.hasChildNodes()){let t=(0,e.sB)(this.choices);t&&t.focus()}else this.input&&!(0,e.xj)(this.input)?this.input.focus():this.selection&&this.selection.focus();else this.input&&!(0,e.xj)(this.input)?this.input.focus():this.selectListValue.focus();return this.element.classList.add("active"),this},navigate(i,n,r){let s=null;if("up"===i?s=(0,e.GV)(this.element):"down"===i?s=(0,e.Sd)(this.element):"left"===i?s=(0,e.GF)(this.element):"right"===i&&(s=(0,e.EE)(this.element)),(0,t.isNullOrUndefined)(s))return!1;s.focus()},focusIn(){this.focused=!0,this.element.classList.add("active");const i=(0,t.createDocFragment)();return this.source.getCandidates().filter((t=>!this.values.some((e=>Oe(e,t))))).forEach((t=>{i.append(this.createChoiceOption(t)),this.values.push(t)})),this.choices.append(i),this.expanded||((0,e.$Z)(this.selectList),this.selectList.dataset.state="open"),this},focusOut(){if(this.readonly)return;this.input&&(0,t.isNullOrWhitespace)(this.input.value)&&(this.input.value=""),this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.input&&this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("querying");const{children:i}=this.choices;for(let t=0;t<i.length;t++){const n=i[t];(0,e.$Z)(n),n.hidden=!1}return this.expanded||((0,e.Cp)(this.selectList),this.selectList.dataset.state="close"),this.focused=!1,this},showChoices(){const{children:t}=this.choices;for(let i=0;i<t.length;i++){const n=t[i];(0,e.$Z)(n),n.hidden=!1}},enable(){return this.input&&(this.input.disabled=!1,this.input.tabIndex=0),this.disabled=!1,this},disable(){return this.input&&(this.input.disabled=!0,this.input.tabIndex=-1),this.disabled=!0,this},filterChoice(i){const{children:n}=this.choices;if(this.element.dataset.input=i.trim(),(0,t.isNullOrWhitespace)(i)){for(let t=0;t<n.length;t++){const i=n[t];(0,e.$Z)(i),i.hidden=!1}return}this.element.classList.add("querying");let r=i.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let t=0;t<n.length;t++){const i=n[t];let s=i.textContent.toLowerCase(),a=s.replace(/[_-]+/g," ").replace(/\s+/g,"").trim();r.some((t=>s.includes(t)||a.includes(t)))?((0,e.$Z)(i),i.hidden=!1):((0,e.Cp)(i),i.hidden=!0)}return!0},createChoiceOption(e){const{template:i={},style:n}=this.schema.choice.option,r=(0,t.isObject)(e),s=(0,t.createListItem)({class:["field--choice__choice"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:r?"concept":"value",value:r?e.id:e}});if(Jt.call(this,s,n),this.items.set(e.id,s),"meta-concept"===e.type){let n=this.model.getProjectionSchema(e.concept,(0,t.valOrDefault)(i.tag))[0],r=n.type,a={type:r,[r]:n.content||n.projection},o=us.call(this,a,e.concept,{focusable:!1,meta:e.name});s.dataset.type="meta-concept",s.dataset.value=e.name,s.append(o)}else if(r){if(!this.model.hasProjectionSchema(e,i.tag))return s;let t=this.model.createProjection(e,i.tag).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,s.append(t.render())}else s.append(e.toString());return s},setChoice(t){const{children:i}=this.choices;let n=!1;for(let r=0;r<i.length;r++){const s=i[r];let a=Ne.call(this,s);a&&Oe(a,t)?(s.classList.add("selected"),s.dataset.selected="selected",this.selection=s,(0,e.$Z)(s),n=!0):(s.classList.remove("selected"),delete s.dataset.selected)}return this},delete(){if(this.hasValue())this.reset();else{let i=this.source.delete();i.success?(this.clear(),(0,t.removeChildren)(this.element),this.element.remove()):(this.environment.notify(i.message),(0,e.lL)(this.element))}},_spaceHandler(i){let n=this.source.getCandidates();if((0,t.isEmpty)(n))return void this.notify("No candidates found.",e.k$.INFO);const r=(0,t.createDocFragment)();if(n.forEach((t=>{r.append(this.createChoiceOption(t))})),(0,t.removeChildren)(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let i=(0,t.createListItem)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(i),Jt.call(this,i,e)}this.choices.append(r),this.filterChoice(this.input.value),(0,e.$Z)(this.choices),this.element.classList.add("querying")},escapeHandler(i){let n=!0;if(this.messageElement&&!(0,e.xj)(this.messageElement)&&((0,e.Cp)(this.messageElement),n=!1),!this.expanded&&"open"===this.selectList.dataset.state)return(0,e.Cp)(this.selectList),this.selectList.dataset.state="close",!0;if(n){let e=(0,t.findAncestor)(i,(t=>0===t.tabIndex));return this.environment.resolveElement(e).focus(e),!0}this.focus()},enterHandler(i){const n=Ee.call(this,i);(0,t.isHTMLElement)(n)&&this.selection!==n&&("placeholder"===Ae(n)?this.source.removeValue():this.setValue(Ne.call(this,n),!0),this.expanded||((0,e.Cp)(this.selectList),this.selectList.dataset.state="close",this.focus()))},backspaceHandler(t){Ee.call(this,t)&&this.input&&this.input.focus()},clickHandler(i){const n=Ee.call(this,i);(0,t.isHTMLElement)(n)&&this.selection!==n?("placeholder"===Ae(n)?this.source.removeValue():this.setValue(Ne.call(this,n),!0),this.expanded||((0,e.Cp)(this.selectList),this.selectList.dataset.state="close")):i===this.selectListValue&&((0,e.$Z)(this.selectList),this.selectList.dataset.state="open")},arrowHandler(i,n){if(!(0,t.isHTMLElement)(n))return!1;const{parentElement:r}=n,s=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);if(!this.expanded&&n===this.selectListValue)return this.arrowHandler(i,this.selectListValue.parentElement);let a=Ee.call(this,n);if(a){let n=(0,e.As)(a,i,this.choices,!1);return(0,t.isHTMLElement)(n)?(n.focus(),!0):this.arrowHandler(i,this.choices)}if(this.expanded&&r!==this.element)return s();let o=(0,e.As)(n,i,r,!1);return(0,t.isHTMLElement)(o)?(o===this.selectList&&(o=this.input||this.choices),o===this.choices&&this.choices.hasChildNodes()&&("up"===i?o=(0,e.GV)(this.choices):"down"===i?o=(0,e.Sd)(this.choices):"left"===i?o=(0,e.GF)(this.choices):"right"===i&&(o=(0,e.EE)(this.choices))),o.focus(),!0):s()},bindEvents(){(0,t.isHTMLElement)(this.input)&&this.element.addEventListener("input",(t=>{this.filterChoice(this.input.value)})),this.projection.registerHandler("value.changed",((t,e)=>{this.setValue(t)}))}},je=Object.assign(Object.create(ue),Me),Ce={init(){return this},render(){const e=(0,t.createDocFragment)(),{content:i,markers:n,marker:r,self:s}=this.schema;var a=new DOMParser;return(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"dynamic",id:this.id}})),(0,t.isHTMLElement)(this.content)||(this.content=a.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),(0,t.isNullOrUndefined)(this.place)&&(this.place=this.content.querySelector("[data-"+r+"]")),(0,t.isNullOrUndefined)(this.markers)&&(this.markers=new Map,this.content.querySelectorAll("[data-"+r+"]").forEach((e=>{let i=e.getAttribute("data-"+r);(0,t.isNullOrUndefined)(this.markers.get(i))?this.markers.set(i,[e]):this.markers.set(i,this.markers.get(i).concat([e]))}))),(0,t.isNullOrUndefined)(this.aliases)&&(this.aliases=new Map,n.forEach((e=>{let i=[];e.aliases.forEach((e=>{let n=this.markers.get(e.mv);const r=[];n.forEach((i=>{const n={};n.target=i;let s=[];e.props.forEach((e=>{const n={};n.property=e.props,n.value=e.value,(0,t.isNullOrUndefined)(i.style)||(0,t.isNullOrUndefined)(i.style[e.props])?n.default=i[e.props]:n.default=i.style[e.props],s.push(n)})),n.impacts=s,r.push(n)})),i.push(r)})),this.aliases.set(e.mv,i)}))),(0,t.isNullOrUndefined)(this.self)&&!(0,t.isEmpty)(s)&&(this.self=[],s.forEach((e=>{const i={};i.property=e,(0,t.isNullOrUndefined)(this.place.style[e])?i.default=this.place[e]:i.default=this.place.style[e],this.self.push(i)}))),e.hasChildNodes()&&this.element.appendChild(e),this.update=this.refresh,this.clear=this.clean,this},refresh(e){let i=this.aliases.get(e.toString());(0,t.isNullOrUndefined)(i)||i.forEach((e=>{e.forEach((e=>{e.impacts.forEach((i=>{(0,t.isNullOrUndefined)(e.target[i.property])?e.target.style[i.property]=i.value:e.target[i.property]=i.value}))}))})),(0,t.isNullOrUndefined)(this.self)||this.self.forEach((i=>{(0,t.isNullOrUndefined)(this.place.style[i.property])?this.place[i.property]=e:this.place.style[i.property]=e}))},clean(e){let i=this.aliases.get(e);(0,t.isNullOrUndefined)(i)||i.forEach((e=>{e.forEach((e=>{e.impacts.forEach((i=>{(0,t.isNullOrUndefined)(e.target.style[i.property])?e.target[i.property]=i.default:e.target.style[i.property]=i.default}))}))})),(0,t.isNullOrUndefined)(this.self)||this.self.forEach((e=>{(0,t.isNullOrUndefined)(this.place.style[e.property])?this.place[e.property]=e.default:this.place.style[e.property]=e.default}))}},Le=Object.assign(Object.create(ue),Ce),Se={content:"",init(){return this},render(){const e=(0,t.createDocFragment)(),{content:i,marker:n,tag:r}=this.schema;var s=new DOMParser;return(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"interactive",id:this.id}})),(0,t.isHTMLElement)(this.content)||(this.content=s.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),(0,t.isNullOrUndefined)(this.place)&&(this.place=this.content.querySelector("[data-"+n+"]")),(0,t.isHTMLElement)(this.field)||(0,t.isNullOrUndefined)(r)||(this.field=us.call(this,{type:"external",tag:r},null,this.args)),e.hasChildNodes()&&this.element.appendChild(e),this.initValue=this.update,this.bindEvents(),this.element},createForeign(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i=this.place.getBBox(),n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x",i.x),n.setAttribute("y",i.y),n.setAttribute("width",i.width),n.setAttribute("height",i.height),n.style.fill="red",e.setAttribute("width",i.width),e.setAttribute("height",i.height),t.setAttribute("width",i.width),t.setAttribute("height",i.height),t.append(e),e.append(this.field),this.place.replaceWith(t),t.setAttribute("x",120),t.setAttribute("y",50);let r=this.field.getBoundingClientRect();e.setAttribute("width",r.width),e.setAttribute("height",r.height),t.setAttribute("viewBox","0 0 "+r.width+" "+r.height)},selfUpdate(){let e;(0,t.isNullOrUndefined)(this.aliases)||(e=this.aliases.get(this.value)),(0,t.isNullOrUndefined)(e)||e.forEach((e=>{e.forEach((e=>{e.impacts.forEach((i=>{(0,t.isNullOrUndefined)(e.target[i.property])?e.target.style[i.property]=i.value:e.target[i.property]=i.value}))}))})),(0,t.isNullOrUndefined)(this.self)||this.self.forEach((e=>{(0,t.isNullOrUndefined)(this.place.style[e.property])?this.place[e.property]=this.value:this.place.style[e.property]=this.value}))},clear(){let e;(0,t.isNullOrUndefined)(this.aliases)||(e=this.aliases.get(this.value)),(0,t.isNullOrUndefined)(e)||e.forEach((e=>{e.forEach((e=>{e.impacts.forEach((i=>{(0,t.isNullOrUndefined)(e.target.style[i.property])?e.target[i.property]=i.default:e.target.style[i.property]=i.default}))}))})),(0,t.isNullOrUndefined)(this.self)||this.self.forEach((e=>{(0,t.isNullOrUndefined)(this.place.style[e.property])?this.place[e.property]=e.default:this.place.style[e.property]=e.default}))},updateStatics(){if(!(0,t.isNullOrUndefined)(this.sd)){let e=this.sd.get(this.value);(0,t.isNullOrUndefined)(e)||this.content.appendChild(e.content)}},clearStatics(){if(!(0,t.isNullOrUndefined)(this.sd)){let e=this.sd.get(this.value);(0,t.isNullOrUndefined)(e)||e.content.parentNode.removeChild(e.content)}},updateDynamics(e){(0,t.isNullOrUndefined)(this.dd)||this.dd.forEach((t=>{t.update(e)}))},clearDynamics(e){(0,t.isNullOrUndefined)(this.dd)||this.dd.forEach((t=>{t.clear(e)}))},update(e){(0,t.isNullOrUndefined)(this.value)||(this.clearStatics(),this.clearDynamics(this.value),this.clear()),""===e?this.value=this.attributeName:(0,t.isNullOrUndefined)(this.property)?this.value=e:this.value=this.translateProperty(e),this.selfUpdate(),this.updateDynamics(this.value),this.updateStatics()},bindEvents(){this.place.addEventListener("click",(e=>{(0,t.isNullOrUndefined)(this.foreign)?this.createForeign():(this.place.replaceWith(this.foreign),this.field.focus())}))},getContent(){return(0,t.isHTMLElement)(this.content)||(this.content=parser.parseFromString(content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.content},arrowHandler(t,e){return this.parent.arrowHandler(t,this)},focus(){this.focusIn()},focusIn(){this.place.replaceWith(this.foreign),this.field.focus()},focusOut(){this.foreign.replaceWith(this.place),""===this.field.value?this.update(this.attributeName):this.update(this.field.value)}},ke=Object.assign(Object.create(ue),Se),Te={content:[{type:"static",static:{type:"text",content:"+",focusable:!1}}]};function Ue(e){if(!(0,t.isHTMLElement)(e))return!1;const{nature:i,id:n}=e.dataset;return"field-component"===i&&n===this.id}function Ie(e){const i=t=>t.parentElement===this.list;return i(e)?e:(0,t.findAncestor)(e,i,3)}const _e={list:null,items:null,elements:null,selection:null,content:null,init(e){const{focusable:i=!0}=this.schema;return this.items=new Map,this.elements=new Map,this.children=[],this.focusable=i,(0,t.hasOwn)(this.schema,"list")||(this.schema.list={item:{}}),this},hasChanges:()=>!1,hasValue(){return this.items.size>0},getValue(){return this.list.children},setValue(e,i=!1){i&&this.source.setValue(e),this.list&&((0,t.removeChildren)(this.list),e.forEach((t=>{var e=this.createItem(t);this.list.append(e)}))),this.refresh()},clear(){this.items.clear(),this.list&&(0,t.removeChildren)(this.list)},focus(i){if(this.hasValue()&&this.list)this.list.firstElementChild.focus();else{let i=(0,e.Sd)(this.element,(t=>t!==this.list));if(!(0,t.isHTMLElement)(i))return this;i.focus()}return this},navigate(i,n,r){let s=null;if("up"===i?s=(0,e.GV)(this.element,(t=>t!==this.notification&&t.hasChildNodes())):"down"===i?s=(0,e.Sd)(this.element,(t=>t!==this.notification&&t.hasChildNodes())):"left"===i?s=(0,e.GF)(this.element,(t=>t!==this.notification&&t.hasChildNodes())):"right"===i&&(s=(0,e.EE)(this.element,(t=>t!==this.notification&&t.hasChildNodes()))),!(0,t.isHTMLElement)(s))return!1;let a=this.environment.resolveElement(s);return!(0,t.isNullOrUndefined)(a)&&(a.focus(),!0)},focusIn(t){this.focused=!0,this.element.classList.add("active");const{component:e}=t.dataset},focusOut(){if(!this.readonly)return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},createElement(){return this.source.createElement()},getItem(e){return(0,t.isNullOrUndefined)(e)?null:(0,t.hasOwn)(e,"id")?this.items.get(e.id):this.items.get(e)},getItemIndex:e=>(0,t.isHTMLElement)(e)?e.dataset.index:null,createItem(t){const{template:e={},style:i}=this.schema.list.item;if(!this.model.hasProjectionSchema(t,e.tag))return"";let n=this.model.createProjection(t,e.tag);n.optional=!0,n.collapsible=!0,n.parent=this.projection;let r=n.init(e.options).render();return r.dataset.index=t.index,n.element.parent=this,n.registerHandler("view.changed",(t=>{Jt.call(this.projection,t,i)})),Jt.call(this.projection,r,i),this.items.set(t.id,r),r},addItem(e){if(!(0,t.isHTMLElement)(this.list))return;const i=this.createItem(e);e.index?this.list.children[e.index-1].after(i):this.list.append(i),this.refresh()},removeItem(e){this.hasList&&!(0,t.isNullOrUndefined)(e)&&(this.items.delete(e.id),this.items.forEach(((t,e)=>{let i=this.source.getElement(e);i&&(t.dataset.index=i.index)})),this.refresh())},moveItem(t,e,i=!1){return this.list.children[e].before(t),t.dataset.index=e,i&&this.source.swapElement(+this.getItemIndex(t),+e),this},swapItem(t,e,i=!1){const n=this.getItemIndex(t),r=this.getItemIndex(e);return this.moveItem(e,n),this.moveItem(t,r),i&&this.source.swapElement(+n,+r),this},delete(t){if(t===this.element)return this.environment.save(this.source.getParent()),void this.source.remove();const{index:i}=t.dataset;var n=this.source.removeElementAt(+i);if(n.success)if(this.hasValue()){let t=+i<this.list.childElementCount?+i:this.list.childElementCount-1;this.list.children[t].focus()}else this.focus();else this.environment.notify(`This element cannot be deleted: ${n.message}`),(0,e.lL)(t)},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.list&&this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list&&this.list.classList.add("empty")),this.elements.forEach(((e,i)=>{if(!Array.isArray(i.state))return;const{currentState:n}=i,r=me.call(this,i,i.state);if(n===i.currentState)return;let s=i.content;r&&(s=r.content);let a=(0,t.createDocFragment)();s.forEach((t=>{let e=us.call(this,t,null,{focusable:!1});a.append(e)})),(0,t.removeChildren)(e).append(a)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},render(){const e=(0,t.createDocFragment)(),{list:i,style:n,action:r={}}=this.schema;if((0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Jt.call(this.projection,this.element,this.schema.style)),i&&!(0,t.isHTMLElement)(this.list)){const{style:n}=i;this.list=(0,t.createDiv)({class:["field--list__list"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.source.hasValue()||this.list.classList.add("empty"),i.currentState=null,this.elements.set(i,this.list),Jt.call(this.projection,this.list,n),e.append(this.list)}let s=(0,t.valOrDefault)(r.add,Te);if(s){const{position:i="after",content:n,help:r,style:a}=s;let o=(0,t.createButton)({class:["field-action","field--list__add"],tabindex:0,title:r,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});n.forEach((t=>{let e=us.call(this,t,null,{focusable:!1});o.append(e)})),s.currentState=null,this.elements.set(s,o),Jt.call(this.projection,o,a),"before"===i&&this.list?this.list.before(o):e.append(o)}return this.list&&this.source.getValue().forEach((t=>{var e=this.createItem(t);this.list.append(e)})),Jt.call(this.projection,this.element,n),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},_spaceHandler(t){this.notify(`Add or remove ${this.source.accept.name}`)},spaceHandler(e){return!!(0,t.isHTMLElement)(e)&&e.parentElement===this.list&&(this.createElement(),!0)},deleteHandler(t){return!(!Ue.call(this,t)||t.parentElement!==this.list||(this.delete(t),0))},escapeHandler(i){let n=!0;if(this.messageElement&&!(0,e.xj)(this.messageElement)&&((0,e.Cp)(this.messageElement),n=!1),n){let e=(0,t.findAncestor)(i,(t=>0===t.tabIndex));return this.environment.resolveElement(e).focus(e),!0}return this.focus(),!1},enterHandler(e){const i=(e=>Ue.call(this,e)?e:(0,t.findAncestor)(e,(t=>Ue.call(this,t)),5))(e);if((0,t.isNullOrUndefined)(i))return this.focus(),!1;const{action:n,index:r,component:s}=i.dataset;return"add"===n?(this.createElement(),!0):"remove"===n&&(this.delete(i.parentElement),!0)},backspaceHandler:t=>!1,clickHandler(e){const i=(e=>Ue.call(this,e)?e:(0,t.findAncestor)(e,(t=>Ue.call(this,t)),5))(e);if((0,t.isNullOrUndefined)(i))return;const{action:n,index:r,name:s}=i.dataset;"add"===n?this.createElement():"remove"===n&&this.delete(i.parentElement)},_arrowHandler(i,n){if(!(0,t.isHTMLElement)(n))return!1;let r=Ie.call(this,n);if(r){let n=(0,e.As)(r,i,this.list);return!!(0,t.isHTMLElement)(n)&&(this.swapItem(r,n,!0),r.focus(),!0)}return!1},arrowHandler(i,n){if(!(0,t.isHTMLElement)(n))return!1;const{parentElement:r}=n,s=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);if(r===this.list){let r=(0,e.As)(n,i,this.list);return(0,t.isHTMLElement)(r)?(this.environment.resolveElement(r).focus(),!0):this.arrowHandler(i,this.list)}if(r!==this.element)return s();let a=(0,e.As)(n,i,this.element);if(!(0,t.isHTMLElement)(a))return s();if(a===this.notification)return this.arrowHandler(i,a);if(a===this.list){if(!this.list.hasChildNodes())return s();"up"===i?a=(0,e.GV)(this.list):"down"===i?a=(0,e.Sd)(this.list):"left"===i?a=(0,e.GF)(this.list):"right"===i&&(a=(0,e.EE)(this.list))}return a.focus(),!0},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.projection.listen&&!(0,t.isNullOrUndefined)(this.environment.activeReceiver)?this.environment.activeReceiver.addItem(e,this,this.schema.list.item.template.tag):this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.projection.listen&&!(0,t.isNullOrUndefined)(this.environment.activeReceiver)?this.environment.activeReceiver.removeItem(e):this.removeItem(e)})),this.projection.registerHandler("value.changed",(t=>{this.clear(),this.list&&this.source.getValue().forEach((t=>{let e=this.createItem(t);this.list.append(e)}))})),this.projection.registerHandler("value.swapped",(t=>{const[e,i]=t;let n=this.getItem(e),r=this.getItem(i),s=+this.getItemIndex(n);this.getItemIndex(r),s!==e.index&&this.swapItem(n,r)}))}},He=Object.assign(Object.create(ue),_e);Object.defineProperty(He,"size",{get(){return this.items.size}}),Object.defineProperty(He,"hasList",{get(){return(0,t.isHTMLElement)(this.list)}});const De={init(){return this},render(){const e=(0,t.createDocFragment)(),{content:i,mv:n}=this.schema;var r=new DOMParser;return(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"static",id:this.id}})),(0,t.isHTMLElement)(this.content)||(this.content=r.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),(0,t.isNullOrUndefined)(this.mv)&&(this.mv=n),e.hasChildNodes()&&this.element.appendChild(e),this}},Pe=Object.assign(Object.create(ue),De);var Ve=0;const Be={content:{type:"static",static:{type:"text",content:"Add"}}},Re={content:{type:"static",static:{type:"text",content:"Remove"}}},ze={table:null,header:null,body:null,footer:null,elements:null,contentElements:null,content:null,init(){const{content:t=[],template:e,focusable:i=!0}=this.schema;return this.elements=new Map,this.focusable=i,this.content=t,this.contentElements=new Map,this.template=this.model.getProjectionSchema(this.source.accept,e.tag)[0].projection,this},render(){const{content:e,action:i={}}=this.schema,{disposition:n}=this.template,r=(0,t.createDocFragment)();if(!Array.isArray(e))throw new Error("Empty content for listfield");if((0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({class:["field","field--table"],id:this.id,tabindex:-1,dataset:{nature:"field",view:"table",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),Jt.call(this.projection,this.element,this.schema.style)),e.forEach((e=>{if("table"===e.type){let i=(0,t.valOrDefault)(e.table,{});const{style:n,header:s,body:a={},footer:o}=i;if(this.table=(0,t.createTable)({class:["field--table__table"],tabindex:0,dataset:{nature:"field-component",view:"table",id:this.id}}),s){const{style:e}=s;this.header=(0,t.createTableHeader)({class:["field--table-header"],dataset:{nature:"field-component",view:"table",id:this.id}}),Jt.call(this.projection,this.header,e),this.table.append(this.header)}if(a){const{style:e}=a;this.body=(0,t.createTableBody)({class:["field--table-body"],dataset:{nature:"field-component",view:"table",id:this.id}}),Jt.call(this.projection,this.body,e),this.table.append(this.body)}if(o){const{style:e}=o;this.footer=(0,t.createTableFooter)({class:["field--table-footer"],dataset:{nature:"field-component",view:"table",id:this.id}}),Jt.call(this.projection,this.footer,e),this.table.append(this.footer)}i.currentState=null,this.contentElements.set(i,this.table),Jt.call(this.projection,this.table,n),r.append(this.table)}else if("action"===e.type){let i=(0,t.valOrDefault)(e,Be);const{content:n,style:s}=i;let a=us.call(this,n,null),o=(0,t.createButton)({class:["field-action","field--table__add"],tabindex:0,dataset:{nature:"field-component",view:"table",component:"action",id:this.id,action:"add"}},[a]);i.currentState=null,this.contentElements.set(i,o),Jt.call(this.projection,o,s),r.append(o)}else{let t=us.call(this,e);this.contentElements.set(e,t),r.append(t)}})),this.header){let e=(0,t.createTableRow)({class:["field--table-header-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id}});n.forEach((i=>{const{header:n}=i,{style:r,content:s}=n;var a=us.call(this,s),o=(0,t.createTableHeaderCell)({class:["field--table-header-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);Jt.call(this.projection,o,r),e.append(o)}));let i=(0,t.createTableCell)({class:["field--table-header-cell","field--table-header-cell--action"]},"Action");e.append(i),this.header.append(e)}return this.source.hasValue()&&this.source.getValue().forEach((t=>{this.addRow(t)})),r.hasChildNodes()&&(this.element.append(r),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,hasValue(){return this.body.rows.length>0},getValue(){return this.body.rows},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.table.classList.remove("empty")):(this.element.classList.add("empty"),this.table.classList.add("empty")),this.contentElements.forEach(((e,i)=>{if(!Array.isArray(i.state))return;const{currentState:n}=i,r=me.call(this,i,i.state);if(n===i.currentState)return;let s=null;s=r?us.call(this,r.content,null):us.call(this,i.content,null),(0,t.removeChildren)(e).append(s)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},createElement(){return this.source.createElement()},addRow(e){const{action:i={},before:n={},after:r={}}=this.schema,{disposition:s}=this.template,a=(0,t.valOrDefault)(e.index,this.table.rows.length),o="row"+Ve++,l=(0,t.createTableRow)({class:["field--table-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id,index:a,elementId:o}});this.elements.set(o,l),s.forEach((i=>{const{body:n}=i,{style:r,content:s}=n;var a=us.call(this,s,e),o=(0,t.createTableCell)({class:["field--table-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);Jt.call(this.projection,o,r),l.append(o)}));var h=(0,t.createTableCell)({class:["field--table__cell-action"]}),{content:c,style:u}=(0,t.valOrDefault)(i.remove,Re),d=us.call(this,c),p=(0,t.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",rowId:o}},d),f=(0,t.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-up",rowId:o}},"Move up"),m=(0,t.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-down",rowId:o}},"Move down");Jt.call(this.projection,p,u),h.append(p,f,m),l.append(h),this.body.append(l),this.refresh()},removeRow(e){var i=this.body.rows.item(e.index);if(!(0,t.isHTMLElement)(i))throw new Error("Table error: Row not found");(0,t.removeChildren)(i),i.remove();for(let t=e.index;t<this.body.rows.length;t++){const e=this.body.rows.item(t),{index:i}=e.dataset;e.dataset.index=+i-1}this.refresh()},removeElement(t){return this.source.removeElement(t)},delete(t){if(t===this.element||t===this.table)return void this.source.delete();const{index:i}=t.dataset;this.source.removeElementAt(+i)||(this.environment.notify("This element cannot be deleted"),(0,e.lL)(t))},bindEvents(){this.element.addEventListener("click",(e=>{const{target:i}=e,n=function(e){const i="field-component";return e.dataset.nature===i?e:(0,t.findAncestor)(e,(t=>t.dataset.nature===i))}(i);if(!(0,t.isHTMLElement)(n))return;const{id:r,action:s}=n.dataset;if(r===this.id)if("add"===s)this.createElement();else if("remove"===s){const{rowId:t}=n.dataset;let e=this.elements.get(t);this.delete(e)}else if("move-up"===s){const{rowId:t}=n.dataset;let e=this.elements.get(t),i=e.previousElementSibling;i&&i.before(e)}else if("move-down"===s){const{rowId:t}=n.dataset;let e=this.elements.get(t),i=e.nextElementSibling;i&&i.after(e)}}),!0),this.projection.registerHandler("value.added",(t=>{this.addRow(t)})),this.projection.registerHandler("value.removed",(t=>{this.removeRow(t)})),this.projection.registerHandler("value.changed",(e=>{(0,t.removeChildren)(this.body),this.source.getValue().forEach((t=>{this.addRow(t)}))}))}},$e=Object.assign(Object.create(ue),ze),Fe=e=>(0,t.isHTMLElement)(e,["input","textarea"]),qe="error";function We(){return(0,t.isHTMLElement)(this.choice)||(this.choice=(0,t.createUnorderedList)({class:["bare-list","field--textbox__choices"],dataset:{nature:"field-component",view:"text",component:"choice",id:this.id}}),this.append(this.choice)),this.choice}function Xe(e){return(0,t.createListItem)({class:["field--textbox__choice"],tabindex:0,dataset:{nature:"field-component",view:"text",component:"choice-item",value:e,id:this.id}},e)}function Ye(e){return e.parentElement===this.choice?e:(0,t.findAncestor)(e,(t=>t.parentElement===this.choice),3)}function Ze(e){const{placeholder:i="",type:n}=e;let r="";return r=this._placeholder?(0,t.valOrDefault)(os.call(this,this._placeholder),""):(0,t.valOrDefault)(os.call(this,i),""),this.readonly||this.resizable?(0,t.createSpan)({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:r,dataset:{placeholder:r,nature:"field-component",view:this.type,id:this.id}}):this.multiline?(0,t.createTextArea)({class:["field--textbox__input"],placeholder:r,title:r,dataset:{nature:"field-component",view:this.type,id:this.id}}):(0,t.createInput)({class:["field--textbox__input"],type:(0,t.valOrDefault)(n,"text"),placeholder:r,title:r,dataset:{nature:"field-component",view:this.type,id:this.id}})}const Ge={input:null,choice:null,value:"",placeholder:null,multiline:!1,resizable:!1,content:null,hasOwnSource:!1,init(e={}){Object.assign(this.schema,e);const{multiline:i=!1,placeholder:n="",resizable:r=!1,focusable:s=!0,source:a}=this.schema;if(this.multiline=i,this.focusable=s,this.resizable=r,this.children=[],this._placeholder=n,a){const t=this.projection.concept.getAttribute(a).getTarget();t.register(this),this.source=t,this.hasOwnSource=!0}return(0,t.hasOwn)(this.schema,"choice")||(this.schema.choice={}),this},focus(t){return this.input.focus(),this},focusIn(){return this.focused=!0,this.value=this.getValue(),this.element.classList.add("active"),this.element.classList.add("focus"),this},focusOut(){return this.hasChanges()&&this.setValue(this.getValue(),!0),(0,t.isNullOrWhitespace)(this.getValue())&&(this.input.textContent=""),this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.choice&&(0,e.Cp)(this.choice),this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("focus"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!=this.getValue()},hasValue(){return!(0,t.isEmpty)(this.getValue())},getValue(){return Fe(this.input)?this.input.value:this.input.textContent},setValue(t,i=!1){var n;(n=i?this.source.setValue(t):{success:!0}).success||((0,e.lL)(this.element),this.environment.notify(n.message,"error")),this.setInputValue(t),this.value=t,this.refresh()},setInputValue(t){Fe(this.input)?this.input.value=t:this.input.textContent=t},getCandidates(){let t=this.source.getCandidates();return Array.isArray(t)?t:[]},enable(){return this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1,this.element.classList.add("disabled"),this},disable(){return this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0,this.element.classList.remove("disabled"),this},refresh(){me.call(this,this.schema,this.schema.state),this.hasValue()?this.element.classList.remove("empty"):this.element.classList.add("empty"),this.element.dataset.value=this.value,this.hasError?(this.element.classList.add(qe),this.input.classList.add(qe)):(this.element.classList.remove(qe),this.input.classList.remove(qe)),this.choice&&this.filterChoice(this.getValue())},render(){const e=(0,t.createDocFragment)(),{container:i,input:n={},style:r}=this.schema;if((0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:["field","text-field","field--textbox"],dataset:{nature:"field",view:"text",id:this.id,disabled:this.disabled,readonly:this.readonly,value:""}}),this.readonly&&this.element.classList.add("readonly"),this.disabled&&this.element.classList.add("disabled"),Jt.call(this.projection,this.element,this.schema.style)),i){const{content:t=[],style:n}=i;t.forEach((t=>{if("input"===t.type){const{style:i}=t.input;this.input=Ze.call(this,t.input),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Jt.call(this.projection,this.input,i),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}else{let i=us.call(this,t,null,{focusable:!1});e.append(i)}})),Jt.call(this.projection,this.element,n)}else{if(!(0,t.isHTMLElement)(this.input)){const{style:t}=n;this.input=Ze.call(this,n),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Jt.call(this,this.input,t),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}Jt.call(this.projection,this.element,r)}return e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},filterChoice(i){const{children:n}=this.choice;if((0,t.isNullOrWhitespace)(i)){for(let t=0;t<n.length;t++){const i=n[t];(0,e.$Z)(i),i.hidden=!1}return!0}let r=i.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let t=0;t<n.length;t++){const i=n[t],{value:s}=i.dataset;r.some((t=>s.toLowerCase().includes(t)))?((0,e.$Z)(i),i.hidden=!1):((0,e.Cp)(i),i.hidden=!0)}return!0},selectChoice(i){if(!(0,t.isHTMLElement)(i))return;const n=function(t){return t.dataset.value}(i);return this.setValue(n,!0),this.input.focus(),(0,e.Cp)(this.choice),this},update(t,e,i){"delete"!==t?"value.changed"===t&&this.setValue(e):this.delete()},_spaceHandler(i){const n=new Set(this.getCandidates());if(0===n.size)this.notify("Enter any text.",e.k$.INFO);else{We.call(this);const i=(0,t.createDocFragment)();n.forEach((t=>i.append(Xe.call(this,t)))),(0,t.removeChildren)(this.choice).append(i),this.filterChoice(this.getValue()),(0,e.$Z)(this.choice)}},escapeHandler(i){let n=!0;if(this.messageElement&&!(0,e.xj)(this.messageElement)&&((0,e.Cp)(this.messageElement),n=!1),this.choice&&!(0,e.xj)(this.choice)&&((0,e.Cp)(this.choice),n=!1),n){let e=(0,t.findAncestor)(i,(t=>0===t.tabIndex)),n=this.environment.resolveElement(e);return n&&n.focus(e),!1}return this.input.focus(),!0},enterHandler(t){const e=Ye.call(this,t);return e?this.selectChoice(e):this.multiline||(t===this.input?this.setValue(this.getValue(),!0):this.focus()),!0},backspaceHandler(t){Ye.call(this,t)&&this.input.focus()},clickHandler(e){const i=Ye.call(this,e);(0,t.isHTMLElement)(i)&&this.selectChoice(i)},arrowHandler(i,n){if(!(0,t.isHTMLElement)(n))return!1;const{parentElement:r}=n,s=()=>!!this.parent&&this.parent.arrowHandler(i,this.element);let a=Ye.call(this,n);if((0,t.isHTMLElement)(a)){let n=(0,e.As)(a,i,this.choice);return(0,t.isHTMLElement)(n)?(n.focus(),!0):this.arrowHandler(i,this.choice)}if(r!==this.element)return s();let o=null;if("right"===i){if(n===this.input&&!(this.getValue().length<(0,e.qO)(this.input)+1))return!1;o=(0,e.As)(n,i,this.element,!1)}else if("left"===i){if(n===this.input&&0!==(0,e.qO)(this.input))return!1;o=(0,e.As)(n,i,this.element,!1)}else o=(0,e.As)(n,i,this.element,!1);return(0,t.isHTMLElement)(o)&&o.dataset.id===this.id?("up"===i?o=(0,e.GV)(this.choice):"down"===i?o=(0,e.Sd)(this.choice):"left"===i?o=(0,e.GF)(this.choice):"right"===i&&(o=(0,e.EE)(this.choice)),o.focus(),!0):s()},bindEvents(){this.element.addEventListener("input",(t=>{this.hasError&&this.source.setValue(this.getValue(),!0),this.refresh()})),this.hasOwnSource||this.projection.registerHandler("value.changed",(t=>{this.setValue(t)}))}},Je=Object.assign(Object.create(ue),Ge);var Ke=n(185);const Qe={init(){const{arrowStyle:e=null,path:i,attach:n={}}=this.schema;return(0,t.isNullOrUndefined)(e)?this.arrowStyle={}:this.arrowStyle=e,i&&(this.meet=i.meet),n&&(this.attach=n.type),this},render(){const{reference:e,decorator:i=!1}=this.schema;if((0,t.isHTMLElement)(this.element)||(this.element=document.createElementNS("http://www.w3.org/2000/svg","path"),this.element.style.fill="transparent",this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="arrow",this.element.dataset.id=this.id),(0,t.isNullOrUndefined)(this.reference))switch(e.type){case"multiple":this.reference=this.source.getAttributeByName(e.listen).target,this.multiple=!0;break;case"duo":this.from=this.source.getAttributeByName(e.from).target,this.to=this.source.getAttributeByName(e.to).target,this.multiple=!1}return this.computeStyle(),this.bindEvent(),this.element},getStyle(){},signal(){(0,t.isNullOrUndefined)(this.valSource)||(0,t.isNullOrUndefined)(this.valTarget)||this.projection.parent.accept(this.valSource,this.valTarget,this)},computeStyle(){const{stroke:e="black",dasharray:i=null,width:n=1,linecap:r="butt",end:s=!1,start:a=!1}=this.arrowStyle;this.element.style.stroke=e,(0,t.isNullOrUndefined)(i)||(this.element.style["stroke-dasharray"]=i),this.element.style["stroke-width"]=(0,t.valOrDefault)(n,5),this.element.style["stroke-linecap"]=r,s&&this.createMarkerEnd()},createMarkerEnd(){(0,t.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.end=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.end.id="marker"+this.id,this.end.setAttribute("refY",5),this.end.setAttribute("refX",10),this.end.setAttribute("markerUnit","strokeWidth"),this.end.setAttribute("markerWidth",10),this.end.setAttribute("markerHeight",10),this.end.setAttribute("orient","auto"),this.end.classList.add("end");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.end.appendChild(e),this.definitions.appendChild(this.end),this.path.setAttribute("marker-end","url(#"+this.end.id+")")},createMarkerStart(){(0,t.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.start=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.start.id="marker"+this.id,this.start.setAttribute("refY",5),this.start.setAttribute("refX",1),this.start.setAttribute("markerUnit","strokeWidth"),this.start.setAttribute("markerWidth",10),this.start.setAttribute("markerHeight",10),this.start.setAttribute("orient","auto"),this.start.classList.add("start");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.start.appendChild(e),this.definitions.appendChild(this.end),this.element.setAttribute("marker-start","url(#"+this.end.id+")")},setValues(){(0,t.isNullOrUndefined)(this.source.getAttributeByName("target").target.value)||(this.valTarget=this.source.getAttributeByName("target").target.value),(0,t.isNullOrUndefined)(this.source.getAttributeByName("source").target.value)||(this.valSource=this.source.getAttributeByName("source").target.value)},refresh(){this.setValues(),this.updateRegister(),this.signal()},deleteRef(t,e){this.valTarget!==t.id&&this.valSource!==t.id||this.projection.parent.removeArrow(this,e)},setLine(t,e){this.element.setAttribute("d","M "+t.x+", "+t.y+"L "+e.x+", "+e.y)},setPath(t){this.element.setAttribute("d",t)},updateRegister(){for(let t=0;t<this.registered.length;t++)this.registered[t]={name:this.registered[t].name,value:this.source.getAttributeByName(this.registered[t].name).target.value}},register(e){(0,t.isNullOrUndefined)(this.getAttribute)&&(this.registered.push({name:e,value:this.source.getAttributeByName(e).target.value}),this.source.getAttributeByName(e).target.register(this.projection),this.projection.registerHandler("value.added",(t=>{this.refresh()})))},get(t){for(let e=0;e<this.registered.length;e++)if(this.registered[e].name===t)return this.registered[e].value},registerValue(e){(0,t.isNullOrUndefined)(this.registered)&&(this.registered=[]),e.register(this),this.registered.push({concept:e,currentVal:e.value})},update(t,e){switch(t){case"value.changed":this.updatePath(e)}},updatePath(){this.lineUpdate(),this.parent.container.append(this.element)},updatePathDuo(){switch(this.attach){case"anchor":this.anchorAttach()}},anchorAttach(){this.occupied&&Ke.AnchorHandler.freeOccupation(this),this.occupant&&this.occupant.removeAnchor(this);let t=this.parent.container.querySelector('[data-concept="'+this.valueF+'"]'),e=this.parent.container.querySelector('[data-concept="'+this.valueT+'"]'),i=Ke.AnchorHandler.findCommonIndex(t.dataset.id,e.dataset.id,this.occupant,this),n=Ke.AnchorHandler.getAnchorAt(t.dataset.id,i),r=Ke.AnchorHandler.getAnchorAt(e.dataset.id,i),s=t.getBoundingClientRect(),a=this.parent.container.createSVGPoint();a.x=s.x+n.x,a.y=s.y+n.y;let o=a.matrixTransform(this.parent.container.getScreenCTM().inverse());s=e.getBoundingClientRect(),a.x=s.x+r.x,a.y=s.y+r.y;let l=a.matrixTransform(this.parent.container.getScreenCTM().inverse());this.setPath("M "+o.x+" "+o.y+" L "+l.x+" "+l.y),this.parent.container.append(this.element),this.occupant&&this.occupant.accept(this,o,l,i),Ke.AnchorHandler.registerOccupation(this,i,t.dataset.id,e.dataset.id),this.occupied=!0},forceAnchor(t){let e=this.parent.container.querySelector('[data-concept="'+this.valueF+'"]'),i=this.parent.container.querySelector('[data-concept="'+this.valueT+'"]'),n=Ke.AnchorHandler.getAnchorAt(e.dataset.id,t),r=Ke.AnchorHandler.getAnchorAt(i.dataset.id,t),s=e.getBoundingClientRect(),a=this.parent.container.createSVGPoint();a.x=s.x+n.x,a.y=s.y+n.y;let o=a.matrixTransform(this.parent.container.getScreenCTM().inverse());s=i.getBoundingClientRect(),a.x=s.x+r.x,a.y=s.y+r.y;let l=a.matrixTransform(this.parent.container.getScreenCTM().inverse());return this.setPath("M "+o.x+" "+o.y+" L "+l.x+" "+l.y),this.parent.container.append(this.element),this.occupant&&this.occupant.accept(this,o,l,t),Ke.AnchorHandler.registerOccupation(this,t,e.dataset.id,i.dataset.id),this.occupied=!0,{e:this,from:e.dataset.id,to:i.dataset.id,index:t}},lineUpdate(){let t=this.targetInformations();switch(this.meet){case"minY":let e=t[0].y,i=t[0];for(let n=1;n<t.length;n++){let r=t[n].y;r<e&&(e=r,i=t[n])}this.computeLineMin(t,t[0],i)}},computeLineMin(e,i,n,r){let s=i.x,a=n.x,o=i.y,l=(o-n.y)/(s-a),h=o-l*s;(0,t.isNullOrUndefined)(r)||(h-=r);for(let t=0;t<e.length;t++){let r=l*e[t].x+h;if(r>e[t].y)return this.computeLineMin(e,i,n,r-e[t].y)}let c="M "+(s-.5)+" "+(a*l+h)+" L "+(e[e.length-1].x+.5)+" "+(a*l+h);this.setPath(c),(0,t.isNullOrUndefined)(this.subPath)&&(this.subPath=[]),(0,t.isEmpty)(this.subPath)||(this.subPath.forEach((t=>{t.remove()})),this.subPath=[]);let u=a*l+h;for(let t=0;t<e.length;t++)if(e[t].y>u){let i=document.createElementNS("http://www.w3.org/2000/svg","line");i.classList.add("subPath"),this.subPath.push(i),i.setAttribute("x1",e[t].x),i.setAttribute("x2",e[t].x),i.setAttribute("y1",e[t].y),i.setAttribute("y2",u),this.parent.container.append(i),i.style["stroke-width"]=.75,i.setAttribute("stroke","black")}},targetInformations(){let e=[],i=!1;return this.registered.forEach((n=>{let r=n.concept.value;if((0,t.isNullOrUndefined)(r))return void(i=!0);let s=this.parent.container.querySelector('[data-concept="'+r+'"]'),a=this.projection.resolveElement(s),o=this.parent.container.createSVGPoint(),l=s.getBoundingClientRect();o.x=l.x,o.y=l.y;let h=o.matrixTransform(this.parent.container.getScreenCTM().inverse());(0,t.isNullOrUndefined)(a.schema.arrowAnchor)||(h.x+=a.schema.arrowAnchor.x,h.y+=a.schema.arrowAnchor.y),e.push({x:h.x,y:h.y})})),!i&&e},duoUpdate(){this.valueF=this.from.value,this.valueT=this.to.value,(0,t.isNullOrUndefined)(this.valueF)||(0,t.isNullOrUndefined)(this.valueT)||this.updatePathDuo()},updatePosition(t){let e=this.projection.resolveElement(this.projection.parent.findItem(t.id).render),i=this.projection.resolveElement(this.projection.parent.findAncestor(this.bind.container).render),n=i.findAnchorIndex(this.bind.container),r=e.findAnchor(n),s=i.findAnchor(n);const a=Number(i.container.getAttribute("x"))+s.x,o=Number(i.container.getAttribute("y"))+s.y,l=Number(e.container.getAttribute("x"))+r.x,h=Number(e.container.getAttribute("y"))+r.y;this.element.setAttribute("d","M "+a+" "+o+" L "+l+" "+h),this.projection.parent.container.append(this.element)},bindProj(t){this.bind=t;const e=this.schema.reference.target;this.objectiv=this.source.getAttributeByName(e).target,this.objectiv.register(this.projection),this.projection.registerHandler("value.changed",(t=>{this.updatePosition(t)}))},bindEvent(){switch(this.schema.reference.type){case"duo":this.from.register(this.projection),this.to.register(this.projection),this.projection.registerHandler("value.changed",(t=>{this.duoUpdate()}));break;case"multiple":this.reference.register(this.projection),this.projection.registerHandler("value.added",(t=>{this.registerValue(t)}))}}},ti=Object.assign(Object.create(ue),Qe),ei={init(e){if(!(0,t.isNullOrUndefined)(e)){const{focusable:t=!1}=e;this.focusable=t}return this},render(){const{placeholder:e,style:i,readonly:n,breakDown:r=!1,linebreak:s=!1}=this.schema;return(0,t.isNullOrUndefined)(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","text"),this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="svg",this.element.style["dominant-baseline"]="hanging",this.element.dataset.id=this.id,this.element.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")),this.source.hasValue()?this.content=this.source.getValue().toString():this.content=e,r&&(this.breakDown=r),this.breakDown?this.element.textContent=this.content.substring(0,r):this.element.textContent=this.content,s&&(this.linebreak=s),this.caps=!1,this.readonly=n,this.bindEvents(),this.style(),this.element},registerDimensionsObserver(e){(0,t.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(e)},setActiveChar(t,e,i){let{target:n,end:r=!1}=this.findChar(e,i);this.index=n,this.end=r,this.char=r?this.element.getEndPositionOfChar(n):this.element.getStartPositionOfChar(n),this.createCursor(),this.switchOn(),this.addListeners()},style(){const{font:t,size:e,anchor:i="left",weight:n,baseline:r}=this.schema.style;this.element.setAttribute("text-anchor",i),this.element.setAttribute("font-family",t),this.element.setAttribute("font-size",e),this.element.style["dominant-baseline"]=r,n&&this.element.setAttribute("font-weight",n),this.baseline=r,this.size=e},setValue(){"number"===this.source.name?this.source.setValue(Number(this.content)):this.source.setValue(this.content),this.parent.updateSize()},addListeners(){this.element.addEventListener("keydown",(t=>{let e=t.keyCode;if(27===e)return""===this.content&&(this.content=this.schema.placeholder,this.element.textContent=this.content),this.setValue(this.content),void this.switchOff();if(t.stopPropagation(),e!==this.lastKey||!this.repeat){switch(e){case 8:0===this.index&&this.end&&""!==this.content&&(this.content="",this.element.textContent=""),this.index>0&&(this.end?(this.content=this.content.slice(0,this.index),this.element.textContent=this.content):(this.content=this.content.slice(0,this.index-1)+this.content.slice(this.index),this.element.textContent=this.content),this.index--);break;case 46:this.index<this.content.length-1&&!this.end&&(this.content=this.content.slice(0,this.index)+this.content.slice(this.index+1),this.element.textContent=this.content),this.index!==this.content.length-1||this.end||(this.content=this.content.slice(0,this.index),this.element.textContent=this.content,this.end=!0,this.index--),0===this.index&&1===this.content.length&&(this.content="",this.element.textContent=this.content);break;case 20:this.caps=!this.caps;break;case 32:t.preventDefault(),this.end?(this.content+=" ",this.element.textContent=this.content):(this.content=this.content.slice(0,this.index)+" "+this.content.slice(this.index),this.element.textContent=this.content),this.index++}"number"!==this.source.name&&(e>=65&&e<=90||e>=48&&e<=57||e>=90&&e<=105)&&(this.caps?this.end?this.content=this.content+String.fromCharCode(t.keyCode):this.content=this.content.slice(0,this.index)+String.fromCharCode(t.keyCode)+this.content.slice(this.index):this.end?this.content=this.content+String.fromCharCode(t.keyCode).toLowerCase():this.content=this.content.slice(0,this.index)+String.fromCharCode(t.keyCode).toLowerCase()+this.content.slice(this.index),this.element.textContent=this.content,this.index++),"number"===this.source.name&&(e>=48&&e<=57||e>=96&&e<=105)&&(e>=96&&e<=105&&(e-=48),this.end?this.content=this.content+String.fromCharCode(e):this.content=this.content.slice(0,this.index)+String.fromCharCode(e)+this.content.slice(this.index),this.element.textContent=this.content,this.index++),this.lastKey=t.keyCode,this.repeat=!0,setTimeout((()=>{this.repeat=!1}),50),this.updateCursor(),this.setValue(this.content)}}))},switchOn(){this.on=!0,this.element.parentNode.append(this.cursor),(0,t.isNullOrUndefined)(this.interval)||clearInterval(this.interval),this.interval=setInterval((()=>{this.on?(this.cursor.remove(),this.on=!1):(this.element.parentNode.append(this.cursor),this.on=!0)}),1e3)},switchOff(){this.on=!1,(0,t.isNullOrUndefined)(this.cursor)||this.cursor.remove(),clearInterval(this.interval)},createCursor(){(0,t.isNullOrUndefined)(this.cursor)||this.cursor.remove();let e=this.element.getBBox();switch(t.isNullOrUndefined&&(this.cursor=document.createElementNS("http://www.w3.org/2000/svg","rect")),this.cursor.setAttribute("x",this.char.x),this.baseline){case"middle":case"auto":this.cursor.setAttribute("y",Number(this.element.getAttribute("y"))-e.height/2);break;case"hanging":this.cursor.setAttribute("y",this.element.getAttribute("y"))}this.cursor.setAttribute("width",1),this.cursor.setAttribute("height",e.height)},updateCursor(){if(""!==this.content){if(this.end)return this.char=this.element.getEndPositionOfChar(this.content.length-1),void this.cursor.setAttribute("x",this.char.x);this.char=this.element.getStartPositionOfChar(this.index),this.cursor.setAttribute("x",this.char.x)}else this.cursor.setAttribute("x",Number(this.element.getAttribute("x")))},findChar(t,e){let i=0,n=this.element.getStartPositionOfChar(0),r=n.x,s=this.element.getBoundingClientRect().x,a=(t-s)*(t-s);for(let e=1;e<this.element.getNumberOfChars();e++){let n=t-(s-r+this.element.getStartPositionOfChar(e).x);if(!(a>n*n))return{target:e,end:!1};a=n*n,i=e}n=this.element.getEndPositionOfChar(this.element.getNumberOfChars()-1);let o=t-(s-r+n.x);return o*o<a?{target:this.element.getNumberOfChars()-1,end:!0}:{target:this.element.getNumberOfChars()-1,end:!1}},findCharRelative(t){let e,i=0,n=this.element.getStartPositionOfChar(0),r=t.x-n.x,s=t.y-n.y,a=Math.sqrt(r*r+s*s),o=a;for(e=1;e<this.element.getNumberOfChars();e++){if(n=this.element.getStartPositionOfChar(e),r=t.x-n.x,s=t.y-n.y,a=Math.sqrt(r*r+s*s),!(a<o))return{target:i,start:!0};o=a,i=e}return n=this.element.getEndPositionOfChar(e-1),r=t.x-n.x,s=t.y-n.y,a=Math.sqrt(r*r+s*s),a<o?{target:e-1,start:!1,end:!0}:{target:i,start:!0}},focusIn(){},focusOut(){this.readonly||(this.switchOff(),this.setValue(this.content))},bindEvents(){this.readonly||this.element.addEventListener("click",(t=>{this.setActiveChar(t.target,t.clientX,t.clientY)})),this.projection.registerHandler("value.changed",(t=>{this.content=t.toString(),this.breakDown&&t.length>this.breakDown?this.element.textContent=this.content.substring(0,this.breakDown):this.element.textContent=this.content}))}},ii=Object.assign(Object.create(ue),ei),ni={createHolder(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return e.append(i),i.append(t),e},analysePos(t,e){let i=e.coordinates;const n={};switch(n.type=i.type,n.render=t,i.type){case"delegate":n.await=!1;break;default:n.anchor=i.anchor,n.x=i.x,n.y=i.y,n.await=!0}return n},positionElement(t,e){switch(t.anchor){case"middle":return e.setAttribute("x",t.x-Number(e.getAttribute("width"))/2),void e.setAttribute("y",t.y);case"right":return e.setAttribute("x",t.x-Number(e.getAttribute("width"))),void e.setAttribute("y",t.y);case"center":return e.setAttribute("x",t.x-Number(e.getAttribute("width"))/2),void e.setAttribute("y",t.x-Number(e.getAttribute("height"))/2);default:e.setAttribute("x",t.x),e.setAttribute("y",t.y)}},analyseDim(t,e){let i=e.dimension;const n={};switch(n.type=i.type,n.item=t,i.type){case"fixed":n.value=i.value,n.holder=this.createHolder(t),n.await=!0;break;case"absolute":n.width=i.width,n.height=i.height,n.holder=this.createHolder(t),n.await=!0;break;case"ratio":n.ratio=i.ratio,n.holder=this.createHolder(t),n.await=!0;break;case"pure":n.await=!1}return n},setDimensions(t){switch(t.type){case"fixed":this.adaptFixed(t.item,t.value);break;case"absolute":this.adaptAbsolute(t.item,t.width,t.height);break;case"ratio":this.adaptRatio(t.item,t.ratio)}},adaptFixed(t,e){let i=t.parentNode,n=i.parentNode,r=t.getBoundingClientRect();i.setAttribute("width",r.width),i.setAttribute("height",r.height),n.setAttribute("width",e),n.setAttribute("height",e*r.height/r.width),n.setAttribute("viewBox","0 0 "+r.width+" "+r.height)},adaptAbsolute(t,e,i){let n=t.parentNode,r=n.parentNode;n.setAttribute("width",e),n.setAttribute("height",i),r.setAttribute("width",e),r.setAttribute("height",i)},adaptRatio(t,e){let i=Number(t.getAttribute("width")),n=Number(t.getAttribute("height")),r=t.parentNode,s=r.parentNode;r.setAttribute("width",i),r.setAttribute("height",n),s.setAttribute("width",i*e),s.setAttribute("height",n*e),s.setAttribute("viewBox","0 0 "+i+" "+n)}},{createDocFragment:ri,isNullOrUndefined:si,createI:ai,createArticle:oi,findAncestor:li,removeChildren:hi,windowWidth:ci,isObject:ui,valOrDefault:di}=n(835);function pi(t){const{type:e,value:i}=t.dataset;return"concept"===e?this.candidates.find((t=>t.id===i)).id:"meta-concept"===e?this.candidates.find((t=>t.name===i)).name:"value"===e?i:"placeholder"===e?null:i}const fi={init(){return this.width=0,this.height=0,this.items=new Map,this},render(){const{selection:t,dimensions:e,openSelection:i}=this.schema;if(si(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-choice",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),e?(this.element.setAttribute("width",e.width),this.element.setAttribute("height",e.height)):this.element.style.overflow="visible",this.candidates=this.source.getCandidates(),si(this.selection)&&(this.createSelection(t),this.element.append(this.selection)),i&&si(this.openSelection)){const t=new DOMParser;this.openSelection=t.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.element.append(this.openSelection),this.openSelection.addEventListener("click",(()=>{if(this.open)return this.selection.remove(),void(this.open=!1);this.element.append(this.selection),this.open=!0}))}return this.open=!0,this.bindEvents(),this.element},setValue(t){this.source.setValue(t)},createSelection(t){const{item:e,breakPoint:i=!1,direction:n,close:r}=t;this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg");let s=0;this.candidates.forEach((t=>{const r=ui(t),{dimension:a,tag:o}=e;let{holder:l,foreign:h}=this.createChoiceContainer(a);if(this.items.set(t.id,l),"meta-concept"===t.type){let e=this.model.getProjectionSchema(t.concept,di(o))[0],i=e.type,n={type:i,[i]:e.content||e.projection},r=us.call(this,n,t.concept,{focusable:!1,meta:t.name});l.dataset.type="meta-concept",l.dataset.value=t.name,r.style.position="fixed",h.append(r)}else if(r){if(!this.model.hasProjectionSchema(t,o))return container;let e=this.model.createProjection(t,o).init({focusable:!1});e.readonly=!0,e.focusable=!1,e.parent=this.projection,h.append(e.render()),h.childNodes[0].style.position="fixed",l.dataset.type="concept",l.dataset.value=t.id}else h.append(t.toString());switch(n){case"horizontal":i?(l.setAttribute("y",~~(s/i)*a.height),l.setAttribute("x",s%i*a.width),this.width=i*a.width,this.height=(1+~~(s/i))*a.height):(l.setAttribute("x",s*a.width),this.width=(s+1)*a.width,this.height=a.height);break;case"vertical":i?(l.setAttribute("x",~~(s/i)*a.width),l.setAttribute("y",s%i*a.height)):l.setAttribute("y",s*a.height)}this.bindEvent(l),this.selection.append(l),l.style.border="dotted black",s++}))},registerDimensionsObserver(t){si(this.observers)&&(this.observers=[]),this.observers.push(t)},notifyDimObservers(){si(this.observers)||this.observers.forEach((t=>{t.analyseContentDim()}))},bindEvent(t){t.addEventListener("click",(()=>{this.setValue(pi.call(this,t)),this.schema.selection.close&&(this.open=!1,this.selection.remove(),this.width=0,this.height=0,this.notifyDimObservers())}))},bindEvents(){this.projection.registerHandler("displayed",(()=>{this.displayed||(this.displayed=!0,this.items.forEach(((t,e)=>{const i=t.childNodes[0].childNodes[0];this.projection.resolveElement(i).projection.update("displayed")})))})),this.projection.registerHandler("value.changed",(()=>{this.schema.selection.close&&(this.open=!1,this.selection.remove(),this.width=0,this.height=0,this.notifyDimObservers())}))},createChoiceContainer(t){const{width:e,height:i}=t;let n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return n.setAttribute("width",e),n.setAttribute("height",i),r.setAttribute("width",e),r.setAttribute("height",i),n.append(r),{holder:n,foreign:r}},focusIn(){},focusOut(){}},mi=Object.assign(Object.create(ue),fi),{createDocFragment:gi,isNullOrUndefined:vi,createI:bi,createArticle:yi,findAncestor:wi,removeChildren:xi,windowWidth:Ei,isObject:Ai,valOrDefault:Ni}=n(835);function Oi(t){const{type:e,value:i}=t.dataset;return"concept"===e?this.candidates.find((t=>t.id===i)).id:"meta-concept"===e?this.candidates.find((t=>t.name===i)).name:"value"===e?i:"placeholder"===e?null:i}const Mi={init(){return this.width=0,this.height=0,this.items=new Map,this},render(){const{selection:t,dimensions:e,open:i,overflow:n=!1}=this.schema;if(vi(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-placeholder",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),n&&(this.element.style.overflow="visible"),e&&(this.element.setAttribute("width",e.width),this.element.setAttribute("height",e.height)),vi(this.openBack)){const{render:t,coordinates:e,dimensions:n}=i;this.openBack=us.call(this,Object.assign(t,{action:{type:"OPEN",target:this}})),this.openBack.setAttribute("x",Ni(e.x,0)),this.openBack.setAttribute("y",Ni(e.y,0))}return this.candidates=this.source.getCandidates(),vi(this.selection)&&(this.createSelection(t),this.element.append(this.selection)),vi(this.source.value)?this.opened=!0:(this.opened=!1,this.element.append(this.openBack)),this.element},clickHandler(t){},setValue(t){this.source.setValue(t),this.element.append(this.openBack),this.opened=!1},open(){this.opened=!0,this.element.append(this.selection),this.openBack.remove(),this.source.removeValue()},createSelection(t){const{item:e,breakPoint:i=!1,direction:n,close:r}=t;this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.candidates.forEach((t=>{const i=Ai(t),{tag:n}=e;if("meta-concept"===t.type){let e=this.model.getProjectionSchema(t.concept,Ni(n))[0],i=e.type,r={type:i,[i]:e.content||e.projection},s=us.call(this,r,t.concept,{focusable:!1,meta:t.name});s.dataset.type="meta-concept",s.dataset.value=t.name;const a=this.projection.resolveElement(s).schema.coordinates;s.setAttribute("x",a.x),s.setAttribute("y",a.y),this.bindEvent(s),this.selection.append(s),this.items.set(t.id,s)}else if(i){if(!this.model.hasProjectionSchema(t,n))return container;let e=this.model.createProjection(t,n).init({focusable:!1});e.readonly=!0,e.focusable=!1,e.parent=this.projection;let i=e.render();const r=e.element.schema.coordinates;i.setAttribute("x",r.x),i.setAttribute("y",r.y),this.bindEvent(i),this.selection.append(i),this.items.set(t.id,i)}}))},focusIn(){this.opened||this.element.append(this.openBack)},focusOut(){this.opened||this.openBack.remove()},registerDimensionsObserver(t){vi(this.observers)&&(this.observers=[]),this.observers.push(t)},notifyDimObservers(){vi(this.observers)||this.observers.forEach((t=>{t.analyseContentDim()}))},bindEvent(t){t.addEventListener("click",(()=>{const e=Oi.call(this,t);this.setValue(e),this.selection.remove(),this.element.append(this.openBack)}))}},ji=Object.assign(Object.create(ue),Mi),{isNull:Ci,isNullOrUndefined:Li}=n(835),Si={init(){return this},render(){const{order:t,dimensions:e=!1}=this.schema;if(Li(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-switch",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),e&&(this.element.setAttribute("width",e.width),this.element.setAttribute("height",e.height)),Li(this.index)&&(this.index=0),this.order=t,this.source.hasValue())for(let t=0;t<this.order.length;t++)if(this.order[t]===this.source.value){this.index=t;break}return this.bindEvents(),this.element},clickHandler(){this.index=(this.index+1)%this.order.length,this.source.setValue(this.order[this.index])},registerDimensionsObserver(t){},focusIn(){},focusOut(){},bindEvents(){}},ki=Object.assign(Object.create(ue),Si),Ti={binary:(t,e,i)=>Object.create(xe,{object:{value:"field"},name:{value:"binary-field"},type:{value:"binary"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),choice:(t,e,i)=>Object.create(je,{object:{value:"field"},name:{value:"choice-field"},type:{value:"choice"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),list:(t,e,i)=>Object.create(He,{object:{value:"field"},name:{value:"list-field"},type:{value:"list"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),table:(t,e,i)=>Object.create($e,{object:{value:"field"},name:{value:"table-field"},type:{value:"table"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),text:(t,e,i)=>Object.create(Je,{object:{value:"field"},name:{value:"text-field"},type:{value:"text"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),interactive:(t,e,i)=>Object.create(ke,{object:{value:"field"},name:{value:"interactive-field"},type:{value:"interactive"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),static:(t,e,i)=>Object.create(Pe,{object:{value:"field"},name:{value:"static-field"},type:{value:"static"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),dynamic:(t,e,i)=>Object.create(Le,{object:{value:"field"},name:{value:"dynamic-field"},type:{value:"dynamic"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),add:(t,e,i)=>Object.create(fe,{object:{value:"field"},name:{value:"add-field"},type:{value:"add"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),arrow:(t,e,i)=>Object.create(ti,{object:{value:"field"},name:{value:"arrow"},type:{value:"arrow"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),svg:(t,e,i)=>Object.create(ii,{object:{value:"field"},name:{value:"svg"},type:{value:"svg"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),"svg-choice":(t,e,i)=>Object.create(mi,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),"svg-placeholder":(t,e,i)=>Object.create(ji,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}}),"svg-switch":(t,e,i)=>Object.create(ki,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:Ii()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept}})};var Ui=0;const Ii=()=>"field"+Ui++,_i={createField(e,i,n){const{type:r}=i,s=Ti[r];if((0,t.isNullOrUndefined)(s))throw new Error(`Missing handler: The '${r}' field could not be handled`);var a=s(e,i,n);if((0,t.isNullOrUndefined)(a))throw new Error(`Bad request: The '${r}' field could not be created`);return a.errors=[],a.readonly=(0,t.valOrDefault)(i.readonly,!1),(0,t.isNullOrUndefined)(a.id)&&(a.id=Ii()),a}},Hi={init(){throw new Error("This function has not been implemented")},element:null,children:null,statusElement:null,attached:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasAttached(){return!(0,t.isEmpty)(this.attached)},attach(t,e){this.attached.push(t)},detach(t){this.attached.slice(this.attached.indexOf(t),1)},getAttached(e){return(0,t.isFunction)(e)?this.attached.filter((t=>e(t))):this.attached},show(){return(0,e.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,e.Cp)(this.element),this.visible=!1,this},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},focus(){return this.element.focus(),this.focused=!0,this.active=!0,this},_focusIn:t=>!1,navigate(t,e,i){return this.focusable?(this.element.focus(),!0):this.parent.arrowHandler(t,this.element)},clear:()=>!0,delete(){this.environment.notify("This element cannot be removed",e.k$.WARNING,1500),(0,e.lL)(this.element)},spaceHandler(t){return this.arrowHandler("right",t)},_spaceHandler(t){return this.environment.notify("Nothing do here.",e.k$.NORMAL,1500),!1},escapeHandler(e){let i=(0,t.findAncestor)(e,(t=>0===t.tabIndex));return this.projection.resolveElement(i).focus(i),!0},enterHandler(t){this.element.click()},deleteHandler(t){return this.environment.notify("This element cannot be removed",e.k$.WARNING,1500),(0,e.lL)(this.element),!1},backspaceHandler(t){return this.arrowHandler("left",t)},arrowHandler(t,e){return!!this.parent&&this.parent.arrowHandler(t,e)},clickHandler:t=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler:t=>(console.warn("CONTROL NOT IMPLEMENTED"),!1)},Di=Object.assign(Hi),Pi={init(){return this.children=[],this},render(){const e=(0,t.createDocFragment)(),{help:i,style:n,content:r}=this.schema;return(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createAudio)({class:["static","audio-static"],src:r,dataset:{nature:"static",static:"audio",id:this.id,ignore:"all"}})),(0,t.isNullOrUndefined)(i)||(this.element.title=i),Jt.call(this.projection,this.element,n),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},bindEvents(){}},Vi=Object.assign(Object.create(Di),Pi);function Bi(e,i){let n=e.param.find((t=>t.name===i));if((0,t.isNullOrUndefined)(n))return;const{type:r="string",value:s}=n;let a=(0,t.valOrDefault)(s,n.default);return(0,t.isNullOrUndefined)(a)?null:"string"===r?a.toString():"number"===r?+a:void 0}function Ri(e){if((0,t.isNullOrUndefined)(e))return"";const{type:i}=e;return"property"===i?(this.hasProperty=!0,(0,t.valOrDefault)(this.source.getProperty(e.name),"")):"param"===i?Bi.call(this,this.schema.template,e.name):"raw"===i?(0,t.htmlToElement)(e.raw):e}function zi(e){return(0,t.isNullOrWhitespace)(e)?"":e.startsWith("http://")||e.startsWith("https://")?new URL(e).href:zi(`https://${e}`)}const $i={url:null,alt:null,width:null,height:null,init(){const{url:t,width:e,height:i,alt:n}=this.schema;return this.width=e,this.height=i,this.alt=n,this},render(){let e=!1;const{help:i,style:n,url:r}=this.schema;return this.url=zi(Ri.call(this,r)),(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createImage)({class:["static","image-static"],src:this.url,alt:this.alt,dataset:{nature:"static",static:"image",id:this.id,ignore:"all"}}),e=!0),(0,t.isNullOrUndefined)(this.width)||isNaN(this.width)||(this.element.width=this.width),(0,t.isNullOrUndefined)(this.height)||isNaN(this.height)||(this.element.height=this.height),(0,t.isNullOrUndefined)(i)||(this.element.title=i),Jt.call(this.projection,this.element,n),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return(0,t.isNullOrWhitespace)(this.url)?this.element.classList.add("empty"):this.element.classList.remove("empty"),this},update(){const{url:t}=this.schema;return this.url=zi(Ri.call(this,t)),this.element.src=this.url,this.refresh(),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(t=>{this.update()})),this.projection.registerHandler("value.added",(t=>{this.update()})),this.projection.registerHandler("value.removed",(t=>{this.update()})))}},Fi=Object.assign(Object.create(Di),$i),qi={email:t=>`mailto:${t}`,phone:t=>`tel:${t}`,link:t=>`${t}`,url:t=>`${t}`};function Wi(e,i){let n=e.param.find((t=>t.name===i));if((0,t.isNullOrUndefined)(n))return;const{type:r="string",value:s}=n;let a=(0,t.valOrDefault)(s,n.default);return(0,t.isNullOrUndefined)(a)?null:"string"===r?a.toString():"number"===r?+a:void 0}function Xi(e){if((0,t.isNullOrUndefined)(e))return"";const{type:i}=e;return"property"===i?(this.hasProperty=!0,(0,t.valOrDefault)(this.source.getProperty(e.name),"")):"param"===i?Wi.call(this,this.schema.template,e.name):"raw"===i?(0,t.htmlToElement)(e.raw):e}const Yi={url:null,urlType:null,href:null,hrefHandler:null,content:null,init(){const{content:e=[],urlType:i="link"}=this.schema;if(this.content=e,this.urlType=i,this.children=[],this.hrefHandler=qi[this.urlType],!(0,t.isFunction)(this.hrefHandler))throw new TypeError("type not handled");return this},render(){let e=!1;const i=(0,t.createDocFragment)(),{help:n,style:r,url:s}=this.schema;return this.href=this.hrefHandler(Xi.call(this,s)),(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createAnchor)({class:["static","link"],href:this.href,dataset:{nature:"static",static:"link",id:this.id,ignore:"all"}}),"link"===this.urlType&&(this.element.target="_blank"),e=!0),this.content.forEach((t=>{let e=us.call(this,t,this.projection.concept,{focusable:!1});i.append(e)})),(0,t.isNullOrUndefined)(n)||(this.element.title=n),Jt.call(this.projection,this.element,r),i.hasChildNodes()&&this.element.append(i),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},update(){const{url:e}=this.schema;return this.element.href=this.hrefHandler(Xi.call(this,e)),(0,t.removeChildren)(this.element),this.content.forEach((t=>{this.element.append(us.call(this,t,this.projection.concept,{focusable:!1}))})),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(t=>{this.update()})),this.projection.registerHandler("value.added",(t=>{this.update()})),this.projection.registerHandler("value.removed",(t=>{this.update()})))}},Zi=Object.assign(Object.create(Di),Yi);function Gi(e,i){let n=e.param.find((t=>t.name===i));if((0,t.isNullOrUndefined)(n))return;const{type:r="string",value:s}=n;let a=(0,t.valOrDefault)(s,n.default);return(0,t.isNullOrUndefined)(a)?null:"string"===r?a.toString():"number"===r?+a:void 0}function Ji(e){if((0,t.isNullOrUndefined)(e))return"";const{type:i}=e;return"property"===i?(this.hasProperty=!0,(0,t.valOrDefault)(this.source.getProperty(e.name),"")):"param"===i?Gi.call(this,this.schema.template,e.name):"html"===i?(0,t.htmlToElement)(e.html):"raw"===i?(0,t.htmlToElement)(e.raw):e}const Ki={editable:null,focusable:null,hasProperty:!1,asHTML:!1,init(t={}){Object.assign(this.schema,t);const{content:e,editable:i=!1,focusable:n=!1}=this.schema;return this.children=[],this._content=e,this.editable=i,this.focusable=n,this},render(){let e=!1;const{content:i,help:n,style:r}=this.schema;if(!(0,t.isHTMLElement)(this.element)){if(this.element=(0,t.createSpan)({class:["text","static","text-static"],editable:this.editable,dataset:{nature:"static",view:"text",static:"text",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0),Array.isArray(i))i.forEach((e=>{let i=Ji.call(this,e),n=(0,t.createSpan)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",content:i,id:this.id,ignore:"all"}},i);Jt.call(this.projection,n,e.style),this.element.append(n)}));else{let t=Ji.call(this,i);this.element.append(t),this.element.content=t}e=!0}return(0,t.isNullOrUndefined)(n)||(this.element.title=n),Jt.call(this.projection,this.element,r),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},getLength(){return this.element.textContent.length},backspaceHandler(t){return this.arrowHandler("left",t)},arrowHandler(t,i){if(!this.editable&&this.parent)return this.parent.arrowHandler(t,i);if("right"===t){if(this.getLength()<(0,e.qO)(this.element)+1&&this.parent)return this.parent.arrowHandler(t,i)}else if("left"===t){if(0===(0,e.qO)(this.element)&&this.parent)return this.parent.arrowHandler(t,i)}else if(this.parent)return this.parent.arrowHandler(t,i);return!1},escapeHandler(e){let i=(0,t.findAncestor)(e,(t=>0===t.tabIndex));this.projection.resolveElement(i).focus(i)},update(){const{content:e}=this.schema;return(0,t.removeChildren)(this.element),Array.isArray(e)?e.forEach((e=>{this.element.append((0,t.createSpan)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",id:this.id,ignore:"all"}},Ji.call(this,e)))})):this.element.append(Ji.call(this,e)),this},refresh(){return this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(t=>{this.update()})),this.projection.registerHandler("value.added",(t=>{this.update()})),this.projection.registerHandler("value.removed",(t=>{this.update()})))}},Qi=Object.assign(Object.create(Di),Ki),tn={contentType:null,editable:null,focusable:null,init(t={}){Object.assign(this.schema,t);const{focusable:e=!0}=this.schema;return this.children=[],this.focusable=e,this},render(){const e=(0,t.createDocFragment)(),{help:i,style:n,content:r}=this.schema;return(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createButton)({class:["btn","static"],dataset:{nature:"static",view:"plink",static:"plink",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),r.forEach((t=>{let i=us.call(this,t,this.projection.concept,{focusable:!1});e.append(i)})),(0,t.isNullOrUndefined)(i)||(this.element.title=i),Jt.call(this.projection,this.element,n),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(t,e){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(t,e)},escapeHandler(e){let i=(0,t.findAncestor)(e,(t=>0===t.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(t){const e=this.projection.schema.findIndex((t=>t.tags.includes(this.schema.tag)));return this.projection.changeView(e),!1},clickHandler(t){let e=this.projection.findView(this.schema.tag);return-1===e||this.projection.changeView(e),!1},refresh(){return this},bindEvents(){}},en=Object.assign(Object.create(Di),tn),nn={template:null,selector:null,content:null,init(){return this.selector=this.schema.selector,this.template=(0,t.getTemplate)(this.selector),this},render(){const{style:e,content:i}=this.schema;return(0,t.isNode)(this.element)||(this.element=(0,t.cloneTemplate)(this.template)),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},rn=Object.assign(Object.create(Di),nn);function sn(e,i){let n=e.param.find((t=>t.name===i));if((0,t.isNullOrUndefined)(n))return;const{type:r="string",value:s}=n;let a=(0,t.valOrDefault)(s,n.default);return(0,t.isNullOrUndefined)(a)?null:"string"===r?a.toString():"number"===r?+a:void 0}const an={contentType:null,editable:null,focusable:null,disabled:null,init(t={}){Object.assign(this.schema,t);const{focusable:e=!0,disabled:i=!1}=this.schema;return this.children=[],this.focusable=e,this.disabled=i,this},render(){const e=(0,t.createDocFragment)(),{help:i,style:n,content:r}=this.schema;return(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createButton)({class:["btn","static"],dataset:{nature:"static",view:"button",static:"button",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),r.forEach((t=>{let i=us.call(this,t,this.projection.concept,{template:this.schema.template,focusable:!1});e.append(i)})),(0,t.isNullOrUndefined)(i)||(this.element.title=i),Jt.call(this.projection,this.element,n),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(t,e){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(t,e)},escapeHandler(e){let i=(0,t.findAncestor)(e,(t=>0===t.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(t){const e=this.projection.schema.findIndex((t=>t.tags.includes(this.schema.tag)));return this.projection.changeView(e),!1},clickHandler(e){let i=this.source;if(this.schema.bind&&(i=this.source.getValue(!0)),this.schema.action){const{type:e,value:n,target:r}=this.schema.action;if((0,t.isObject)(n))for(const t in n){const e=n[t];"param"===e.type&&(n[t]=sn.call(this,this.schema.template,e.name))}switch(e){case"CREATE":(0,t.isNullOrUndefined)(r)?i.createElement():"attribute"===r.type&&i.getAttribute(r.name).target.createElement({value:n});break;case"SELECT":if((0,t.isNullOrUndefined)(r)&&i.createElement(),(0,t.isObject)(n))for(const t in n){const e=n[t];"param"===e.type&&(n[t]=sn.call(this,this.schema.template,e.name))}"attribute"===r.type&&i.getAttribute(r.name).target.setValue((0,t.valOrDefault)(n.name,n)),"bind"===r.type&&i.setValue((0,t.valOrDefault)(n.name,n));break;case"CREATES":if((0,t.isNullOrUndefined)(r)&&i.createElement(),(0,t.isObject)(n))for(const t in n){const e=n[t];"param"===e.type&&(n[t]=sn.call(this,this.schema.template,e.name))}"attribute"===r.type&&i.getAttribute(r.name).target.createElement().getAttribute(r.attribute).target.setValue((0,t.valOrDefault)(n.name,n));break;case"SIDE":let e=this.environment.createProjection(i,r),s=this.environment.findWindow("side-instance");(0,t.isNullOrUndefined)(s)&&(s=this.environment.createWindow("side-instance"),s.container.classList.add("model-projection-sideview")),s.instances.size>0&&Array.from(s.instances)[0].delete();let a=this.environment.createInstance(i,e,{type:"projection",close:"DELETE-PROJECTION"});s.addInstance(a)}return!1}return this.environment.triggerEvent({name:this.schema.trigger,args:[i]}),!1},refresh(){return this},bindEvents(){}},on=Object.assign(Object.create(Di),an),ln={editable:null,focusable:null,init(t={}){Object.assign(this.schema,t);const{focusable:e=!0}=this.schema;return this.focusable=e,this},render(){(0,t.createDocFragment)();const{help:e,style:i,content:n,external:r=!0,tag:s}=this.schema,a=new DOMParser;return(0,t.isHTMLElement)(this.element)||(this.element=a.parseFromString(n.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.element.classList.add(["btn","static"]),this.element.dataset.nature="static",this.element.dataset.view="svg-alt",this.element.dataset.id=this.id,this.element.dataset.ignore="all",this.focusable&&(this.element.tabIndex=0)),(0,t.isNullOrUndefined)(e)||(this.element.title=e),this.refresh(),this.bindEvents(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&((0,e.Cp)(this.messageElement),(0,t.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(t,e){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(t,e)},escapeHandler(e){let i=(0,t.findAncestor)(e,(t=>0===t.tabIndex));this.environment.resolveElement(i).focus(i)},enterHandler(t){const e=this.projection.schema.findIndex((t=>t.tags.includes(this.schema.tag)));return this.projection.changeView(e),!1},clickHandler(t){},refresh(){return this},bindEvents(){this.element.addEventListener("click",(()=>{let e=this.source,i=this.environment.createProjection(e,this.schema.tag),n=this.environment.findWindow("side-instance");(0,t.isNullOrUndefined)(n)&&(n=this.environment.createWindow("side-instance"),n.container.classList.add("model-projection-sideview")),n.instances.size>0&&Array.from(n.instances)[0].delete();let r=this.environment.createInstance(e,i,{type:"projection",close:"DELETE-PROJECTION"});n.addInstance(r)}))}},hn=Object.assign(Object.create(Di),ln),cn={CREATE:function(t,e){this.source.createElement(e)},CREATES:function(e,i){this.source.createElement().setValue((0,t.valOrDefault)(i.name,i))},DELETE:un,EXTRACT:function(t,e){let i=this.projection.environment.actions.get("extract-instance")("graphical").getAttribute("shape").target.getAttribute("elements").target.createElement();i.setValue(this.source.name),dn.call(this,i.getValue(!0)),pn.call(this,i.getValue(!0)),un.call(this)},SIDE:function(e,i){let n=this.environment.createProjection(this.source,e),r=this.environment.findWindow("side-instance");(0,t.isNullOrUndefined)(r)&&(r=this.environment.createWindow("side-instance"),r.container.classList.add("model-projection-sideview")),r.instances.size>0&&Array.from(r.instances)[0].delete();let s=this.environment.createInstance(this.source,n,{type:"projection",close:"DELETE-PROJECTION"});r.addInstance(s)},OPEN:function(e){(0,t.isNullOrUndefined)(this.target)&&(this.target=e),this.target.open()},"CREATE-TREE":function(e,i){let n=this.container;for(;(0,t.isNullOrUndefined)(n.getAttribute("data-tree"))&&n.getAttribute("data-tree")!==e;)n=n.parentNode;let r=this.source.createElement();this.environment.getActiveReceiver(e).accept(r,n,(0,t.valOrDefault)(i,"main"))}};function un(t,e){"prototype"!==this.source.parent.schema.nature?this.source.delete():this.source.parent.delete()}function dn(t){switch(this.source.name){case"circle":t.getAttributeByName("cx").target.setValue(this.source.getAttributeByName("cx").target.value),t.getAttributeByName("cy").target.setValue(this.source.getAttributeByName("cy").target.value),t.getAttributeByName("r").target.setValue(this.source.getAttributeByName("r").target.value);break;case"ellipse":t.getAttributeByName("cx").target.setValue(this.source.getAttributeByName("cx").target.value),t.getAttributeByName("cy").target.setValue(this.source.getAttributeByName("cy").target.value),t.getAttributeByName("rx").target.setValue(this.source.getAttributeByName("rx").target.value),t.getAttributeByName("ry").target.setValue(this.source.getAttributeByName("ry").target.value);break;case"rectangle":t.getAttributeByName("x").target.setValue(this.source.getAttributeByName("x").target.value),t.getAttributeByName("y").target.setValue(this.source.getAttributeByName("y").target.value),t.getAttributeByName("width").target.setValue(this.source.getAttributeByName("width").target.value),t.getAttributeByName("height").target.setValue(this.source.getAttributeByName("height").target.value);break;case"polygon":t.getAttributeByName("points").target.setValue(this.source.getAttributeByName("points").target.value);break;case"path":t.getAttributeByName("d").target.setValue(this.source.getAttributeByName("d").target.value)}}function pn(t){const e=t.getAttributeByName("style").target,i=this.source.getAttributeByName("style").target;e.getAttributeByName("fill").target.setValue(i.getAttributeByName("fill").target.value),e.getAttributeByName("stroke").target.setValue(i.getAttributeByName("stroke").target.value),e.getAttributeByName("s-width").target.setValue(i.getAttributeByName("s-width").target.value),e.getAttributeByName("s-dash").target.setValue(i.getAttributeByName("s-dash").target.value),e.getAttributeByName("rx").target.setValue(i.getAttributeByName("rx").target.value),e.getAttributeByName("ry").target.setValue(i.getAttributeByName("ry").target.value)}const fn={init(){return this},render(){const{action:e,content:i}=this.schema;if((0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="static",this.container.dataset.algorithm="button",this.container.dataset.id=this.id),i&&(0,t.isNullOrUndefined)(this.content)&&this.createContent(i),this.schema.dimensions){const{width:t,height:e}=this.schema.dimensions;this.container.setAttribute("width",t),this.container.setAttribute("height",e)}return this.container.style.width="fit-content",this.container},createContent(t){const e=new DOMParser;this.content=e.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.content)},focusIn(){},focusOut(){},clickHandler(){const{type:t,target:e,value:i}=this.schema.action;cn[t].call(this,e,i)}},mn=Object.assign({},Object.create(Di),fn),gn={init(){return this},render(){const e=new DOMParser,{content:i}=this.schema;return(0,t.isNullOrUndefined)(this.element)&&(this.element=e.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.element},focusIn(){},focusOut(){},clickHandler(t){}},vn=Object.assign(Object.create(Di),gn),bn={init(){return this},render(){new DOMParser;const{content:e,style:i}=this.schema;return(0,t.isNullOrUndefined)(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","text"),this.element.textContent=e),this.style(),this.element},style(){const{font:t,size:e,anchor:i="left",weight:n,baseline:r}=this.schema.style;this.element.setAttribute("text-anchor",i),this.element.setAttribute("font-family",t),this.element.setAttribute("font-size",e),this.element.style["dominant-baseline"]=r,n&&this.element.setAttribute("font-weight",n)},focusIn(){},focusOut(){},clickHandler(t){}},yn=Object.assign(Object.create(Di),bn);var wn=0;const xn=()=>"static"+wn++,En={audio:(t,e,i)=>Object.create(Vi,{object:{value:"static"},name:{value:"audio-static"},type:{value:"audio"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),plink:(t,e,i)=>Object.create(en,{object:{value:"static"},name:{value:"plink-static"},type:{value:"plink"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),image:(t,e,i)=>Object.create(Fi,{object:{value:"static"},name:{value:"image-static"},type:{value:"image"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),link:(t,e,i)=>Object.create(Zi,{object:{value:"field"},name:{value:"link-static"},type:{value:"link"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),text:(t,e,i)=>Object.create(Qi,{object:{value:"static"},name:{value:"text-static"},type:{value:"text"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),html:(t,e,i)=>Object.create(rn,{object:{value:"static"},name:{value:"html-static"},type:{value:"html"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),button:(t,e,i)=>Object.create(on,{object:{value:"static"},name:{value:"button-static"},type:{value:"button"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),"svg-alt":(t,e,i)=>Object.create(hn,{object:{value:"static"},name:{value:"svg-static"},type:{value:"svgAlt"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),"svg-button":(t,e,i)=>Object.create(mn,{object:{value:"static"},name:{value:"svg-button"},type:{value:"svgButton"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),svg:(t,e,i)=>Object.create(vn,{object:{value:"static"},name:{value:"svg-static"},type:{value:"svg"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}}),"svg-text":(t,e,i)=>Object.create(yn,{object:{value:"static"},name:{value:"svgText-static"},type:{value:"svgText"},id:{value:xn()},model:{value:t},schema:{value:e},projection:{value:i}})},An={createStatic(e,i,n){const{type:r}=i,s=En[r];if((0,t.isNullOrUndefined)(s))throw new Error(`Missing handler: The '${r}' static could not be handled`);var a=s(e,i,n);if((0,t.isNullOrUndefined)(a))throw new Error(`Bad request: The '${r}' static could not be created`);return(0,t.isNullOrUndefined)(a.id)&&(a.id=xn()),a}},Nn={focusable:null,readonly:!1,visible:!1,editable:!1,active:!1,container:null,elements:null,children:null,editing:!1,getStyle(){return this.schema.style},setStyle(t){return this.schema.style=t,Jt.call(this.projection,this.container,t),this.refresh(),!0},getContainer(){return this.container},isRoot(){return(0,t.isNullOrUndefined)(this.parent)},getField(t){return this.projection.getField(t)},getStatic(t){return this.projection.getStatic(t)},getLayout(t){return this.environment.getLayout(t)},show(){return(0,e.$Z)(this.element),this.visible=!0,this.active=!0,this},hide(){return(0,e.Cp)(this.element),this.visible=!1,this},toggle(){return(0,e.ZN)(this.container),this.visible=!this.visible,this},_focusIn:t=>!1,spaceHandler(e){return e===this.container&&!(0,t.isNullOrUndefined)(this.parent)&&this.parent.spaceHandler(this.container)},_spaceHandler(t){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){if(this.isRoot())return!1;let i=(0,t.findAncestor)(e,(t=>0===t.tabIndex)),n=this.environment.resolveElement(i);return!(0,t.isNullOrUndefined)(n)&&(n.focus(i),!0)},enterHandler(e){let i=(0,t.getElement)('[tabindex]:not([tabindex="-1"])',this.container),n=this.environment.resolveElement(i);return!(0,t.isNullOrUndefined)(n)&&(n.focus(),!0)},delete(){var t=this.source.delete();t.success||this.environment.notify(t.message)},deleteHandler(i){if(this.projection.element!==this)return!1;if(!this.projection.optional)return(0,e.lL)(this.container),!1;let n=(0,t.findAncestor)(i,(t=>0===t.tabIndex)),r=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),r),this.source.delete();let s=this.environment.resolveElement(n);return(0,t.isNullOrUndefined)(s)||s.focus(),!1},backspaceHandler(t){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(i,n){if(n===this.container)return!(0,t.isNullOrUndefined)(this.parent)&&this.parent.arrowHandler(i,this.container);let r=(0,e.As)(n,i,this.container);if(!(0,t.isHTMLElement)(r))return!(0,t.isNullOrUndefined)(this.parent)&&"layout"===this.parent.object&&this.parent.arrowHandler(i,this.container);let s=this.environment.resolveElement(r);return s&&((0,t.isFunction)(s.navigate)?s.navigate(i):s.focus()),!0},shiftHandler(t,i){if("up"===t){let t=(0,e.a2)(window.getComputedStyle(this.container).marginTop);this.container.style.marginTop=`${t+1}px`}return!0},_arrowHandler(t,e){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(t){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},updateSize:()=>!1,controlHandler(t){this.toolbar&&this.toolbar.remove()}},On={ROW:"row",COLUMN:"column"},Mn={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},jn={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"};var Cn=0;function Ln(t,e,i){return Object.create(kn,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:"layout"+Cn++},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}})}const Sn={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(t={}){const{editable:e=!0,focusable:i=!1}=this.schema,{orientation:n=On.ROW,wrappable:r=!0,alignItems:s,justifyContent:a}=this.schema.layout;return this.orientation=n,this.wrappable=r,this.alignItems=s,this.justifyContent=a,this.focusable=i,this.editable=e,this.elements=[],this.children=[],this.args=t,Object.assign(this,t),this},getOrientation(){return this.orientation},setOrientation(e){(0,t.hasOwn)(On,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=(0,t.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let i=(0,t.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{label:e,content:i,style:n,help:r}=this.schema,s=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),r&&(this.container.title=r);for(let t=0;t<i.length;t++){let e=us.call(this,i[t],null,this.args),n=this.environment.resolveElement(e);n&&(n.parent=this),this.elements.push(e),s.append(e)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Jt.call(this.projection,this.container,n),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=jn[this.justifyContent],this.container.style.alignItems=Mn[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,t.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,t.isNullOrUndefined)(e))return!1;let i=this.environment.resolveElement(e);i&&i.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(t=>{const{target:e}=t,{prop:i}=e.dataset;"orientation"===i&&this.setOrientation(e.value)})),this.projection.registerHandler("view.changed",((t,e)=>{e&&e.parent===this.projection&&(t.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(t=>{this.collapsed?this.expand():this.collapse()}))}},kn=Object.assign({},Nn,Sn),Tn={circle:function(t){let e=this.content[0].element.getBBox(),i=e.x,n=e.y,r=e.x+e.width,s=e.y+e.height;this.content.forEach((t=>{e=t.element.getBBox(),i=Math.min(e.x,i),n=Math.min(e.y,n),r=Math.max(e.x+e.width,r),s=Math.max(e.y+e.height,s)}));let a={x:Number(t.getAttribute("cx")),y:Number(t.getAttribute("cy")),r:Number(t.getAttribute("r"))},o=Math.sqrt(Math.pow(i-a.x,2)+Math.pow(n-a.y,2)),l=Math.sqrt(Math.pow(r-a.x,2)+Math.pow(n-a.y,2)),h=Math.sqrt(Math.pow(r-a.x,2)+Math.pow(s-a.y,2)),c=Math.sqrt(Math.pow(i-a.x,2)+Math.pow(s-a.y,2)),u=Math.max(o,l,h,c);u>a.r-10&&Un.call(this,u,a.r,t)}};function Un(e,i,n){let r=Number(n.getAttribute("stroke-width"));(0,t.isNullOrUndefined)(this.containerView)&&(this.containerView={x:0,y:0,w:2*(i+(0,t.valOrDefault)(r,0)),h:2*(i+(0,t.valOrDefault)(r,0)),radius:i,defaultRadius:i});let s=Math.max(i,e)-Math.min(i,e)+5;this.containerView.x-=s,this.containerView.y-=s,this.containerView.radius+=s,this.containerView.h=2*(this.containerView.radius+r),this.containerView.w=2*(this.containerView.radius+r),this.container.setAttribute("viewBox",this.containerView.x+" "+this.containerView.y+" "+this.containerView.w+" "+this.containerView.h),this.container.setAttribute("width",this.containerView.w),this.container.setAttribute("height",this.containerView.h),this.width=this.containerView.w,this.height=this.containerView.h,n.setAttribute("r",this.containerView.radius)}const In={clickHandler(t){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},getContainer(){return this.container},getWidth(){return this.width},getHeight(){return this.height},setViewBox(t){this.container.setAttribute("viewBox",t),this.notifyObsevers()},setWidth(t){this.width=t,this.container.setAttribute("width",t),this.notifyObsevers()},setWidth(t){this.height=t,this.container.setAttribute("height",t),this.notifyObsevers()},notifyDimObservers(){(0,t.isNullOrUndefined)(this.observers)||this.observers.forEach((t=>{t.analyseContentDim()}))},registerDimensionsObserver(e){(0,t.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(e)},setInteraction(e){(0,t.isNullOrUndefined)(this.items)||((0,t.isNullOrUndefined)(this.warnings)&&(this.warnings=[]),this.warnings.push(e),this.items.forEach((t=>{this.projection.resolveElement(t.render).warn(e)})))},checkAugment(e,i){if(!(0,t.isNullOrUndefined)(this.background))if(e.x+Number(i.getAttribute("x"))>Number(this.background.getAttribute("x"))+Number(this.background.getAttribute("width"))||e.y+Number(i.getAttribute("y"))>Number(this.background.getAttribute("y"))+Number(this.background.getAttribute("height"))){let t=this.background.querySelector("[data-augment]");const n=Number(t.getAttribute("y")),r=e.y+Number(i.getAttribute("y"));t.setAttribute("height",r-n)}else if(e.y+Number(i.getAttribute("y"))<Number(this.background.getAttribute("y"))+Number(this.background.getAttribute("height"))){let t=this.background.querySelector("[data-augment]");const n=Number(t.getAttribute("y")),r=e.y+Number(i.getAttribute("y"));t.setAttribute("height",r-n)}},createDelete(){const{type:e}=this.schema.rmv;switch(e){case"bind":this.deleteMap=new Map;let e=0;this.schema.rmv.bind.forEach((t=>{e++;const{alias:i,focus:n,coordinates:r,content:s}=t;let a=(new DOMParser).parseFromString(s.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement;a.dataset.nature="static",a.dataset.algorithm="button",a.setAttribute("x",r.x),a.setAttribute("y",r.y),a.addEventListener("click",(()=>{this.source.delete()})),this.deleteMap.set(i,a)})),this.projection.registerHandler("value.changed",(e=>{(0,t.isNullOrUndefined)(this.deleteElem)||this.deleteElem.remove(),this.deleteMap.get("default").remove();const i=e.name||e;let n=this.deleteMap.get(i);if(!n.dataset.focusable||this.focused)return(0,t.isNullOrUndefined)(n)?(this.container.append(this.deleteMap.get("default")),void(this.deleteElem=this.deleteMap.get("default"))):(this.container.append(n),void(this.deleteElem=n));this.deleteElem=n})),this.source.hasValue()?(this.container.append(this.deleteMap.get(this.source.value)),this.deleteElem=this.deleteMap.get(this.source.value)):(this.container.append(this.deleteMap.get("default")),this.deleteElem=this.deleteMap.get("default"));break;default:const{focus:i,coordinates:n,dimensions:r,render:s}=this.schema.rmv;let a=us.call(this,s);a.setAttribute("x",n.x),a.setAttribute("y",n.y),this.container.append(a),a.addEventListener("click",(()=>{this.source.delete()})),i&&(this.rmv=a)}},findItem(t){for(let e=0;e<this.items.length;e++)if(this.items[e].render.dataset.concept===t)return this.items[e]},findAncestor(t){for(let e=0;e<this.items.length;e++)if(this.items[e].render.contains(t))return this.items[e]},findAnchorIndex(t){for(let e=0;e<this.items.length;e++)if(this.items[e].render===t)return this.items[e].index},findAnchorIndex(t){return this.anchors.indexes[t]},updateSize(){if(this.wrapped)return void this.updateSizeWrap();if(this.fixed)return;let e=this.container.querySelector("[data-adapter]");Tn[e.tagName].call(this,e),(0,t.isNullOrUndefined)(this.parent)||this.parent.updateSize()},updateSizeWrap(){if((0,t.isEmpty)(this.content))return this.width=0,this.height=0,this.container.setAttribute("width",0),void this.container.setAttribute("width",0);let e=this.content[0],i=this.getBox(e),n=i.x,r=i.y,s=i.x+i.width,a=i.y+i.height;for(let t=0;t<this.content.length;t++)i=this.getBox(this.content[t]),n=Math.min(n,i.x),r=Math.min(r,i.y),s=Math.min(s,i.x+i.width),a=Math.min(a,i.y+i.height);this.containerView={x:n,y:r,w:s-n,h:a-r},this.container.setAttribute("viewBox",this.containerView.x+" "+this.containerView.y+" "+this.containerView.w+" "+this.containerView.h),this.container.setAttribute("width",this.containerView.w),this.container.setAttribute("height",this.containerView.h),this.width=this.containerView.w,this.height=this.containerView.h,(0,t.isNullOrUndefined)(this.parent)||this.parent.updateSize()},getBox(e){let i=e.container||e.element;return i.getBBox(),(0,t.isNullOrUndefined)(e.width)?i.getBBox():{width:e.width,height:e.height,x:(0,t.valOrDefault)(Number(i.getAttribute("x")),0),y:(0,t.valOrDefault)(Number(i.getAttribute("y")),0)}}},_n={init(){const{dimensions:e={}}=this.schema;return this.ratio=.4,this.width=(0,t.valOrDefault)(e.width,500),this.height=(0,t.valOrDefault)(e.height,500),this.buttons=[],this.dummies=[],this.transLink=[],this.transLinkId=[],this.arrowInventory=[],this.linkInventory=new Map,this},render(){const{dimensions:e,style:i}=this.schema,n=(0,t.createDocFragment)();return(0,t.isNullOrUndefined)(this.instances)&&(this.instances=new Map),(0,t.isNullOrUndefined)(this.holders)&&(this.holders=new Map),(0,t.isHTMLElement)(this.container)||(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="force",this.container.dataset.id=this.id,this.container.tabindex=1,this.container.id=this.id),e&&(this.container.setAttribute("width",e.width),this.container.setAttribute("height",e.height)),this.focusable=!0,(0,t.isHTMLElement)(this.ids)||(this.ids=[]),n.hasChildNodes()&&this.container.append(n),i&&(this.container.style=i),(0,t.isNullOrUndefined)(this.content)&&(this.content=[]),this.bindEvents(),this.container},setUpForce(){const{intensity:t,linkval:e}=this.schema.force;this.force=d3.layout.force().size([this.width,this.height]).nodes([]).links([]).linkDistance(e).charge(t).on("tick",this.ticked.bind(this));var i=d3.select("#"+this.id);this.nodes=this.force.nodes(),this.node=i.selectAll("svg"),this.links=this.force.links(),this.link=i.selectAll(".link"+this.id),this.force.start()},restart(){let e=d3.select("#"+this.id);this.node=e.selectAll(".node"+this.id).data(this.nodes),(0,t.isNullOrUndefined)(this.links)||(0,t.isEmpty)(this.links)||(this.link=e.selectAll(".link"+this.id).data(this.links)),console.log(this.nodes),this.force.start()},addItem(e){if((0,t.isNullOrUndefined)(this.force)&&this.setUpForce(this.width,this.height,this.intensity,this.direction),"prototype"===e.schema.nature)if(e.hasValue())for(let t=0;t<this.nodes.length;t++)this.nodes[t].concept===e.id&&(this.nodes[t].meta=this.nodes[t].concept,this.nodes[t].concept=e.getValue(!0).id);else e.register(this.projection),this.projection.registerHandler("value.changed",(t=>{if(e.hasValue())for(let t=0;t<this.nodes.length;t++)this.nodes[t].concept===e.id&&(this.nodes[t].meta=this.nodes[t].concept,this.nodes[t].concept=e.getValue(!0).id)}));let i=this.createItem(e,this.schema.tag);i.classList.add("node"+this.id),this.container.append(i);let n=this.projection.resolveElement(i);if(n.projection.update("displayed"),n.registerDimensionsObserver(this),this.content.push(n),"prototype"===e.schema.nature)if(e.force)e.force.index=this.nodes.length,e.force.id=n.id,this.nodes.push(e.force),e.force=this.nodes[this.nodes.length-1];else{const t={nbLink:0,points:[],width:n.width,height:n.height,id:n.id,concept:e.id};this.nodes.push(t),e.force=t}else if(e.force)e.force.index=this.nodes.length,e.force.id=n.id,this.nodes.push(e.force),e.force=this.nodes[this.nodes.length-1];else{const t={nbLink:0,points:[],width:n.width,height:n.height,id:n.id,concept:e.id,shape:this.computeShape(i)};this.nodes.push(t),e.force=t}this.restart()},checkForContent(t,e){const i=this.findIndex(t),n=this.findIndex(e);return i>=0&&n>=0},addArrow(e,i,n){if((0,t.isNullOrUndefined)(this.force)&&this.setUpForce(),(0,t.isNullOrUndefined)(this.links)&&(this.links=this.force.links()),this.containsArrow(e,i,n))return;this.containsTransArrow(e,i,n),this.force.stop();const r=i.id||i,s=n.id||n,a=this.findIndex(r),o=this.findIndex(s);if(a<0||o<0){let t=this.environment.getReceivers(this.projection.rtag);for(let r=0;r<t.length;r++)if(t[r].checkForContent(i,n))return e.projection.parent=t[r],void t[r].addArrow(e,i,n);return this.environment.getRootReceiver(this.projection.rtag).addTransLink(e,i,n),void this.restart()}let l=this.linkInventory.get(a+","+o);(0,t.isNullOrUndefined)(l)?(this.linkInventory.set(a+","+o,{length:1}),this.links.push({source:a,target:o,id:e.id,indexL:1})):(l.length++,this.links.push({source:a,target:o,id:e.id,indexL:l.length})),e.path.classList.add("link"+this.id),this.container.append(e.path),e.definitions&&this.container.append(e.definitions),this.addDummy(e,e.decorator,this.links.length-1),this.restart()},addDummy(e,i,n){if((0,t.isNullOrUndefined)(i)){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("node"+this.id),t.classList.add("dummy"),this.container.append(t),this.nodes.push({dummy:!0,ref:n,fixed:!0,width:10,height:10})}else{this.container.append(i),i.classList.add("node"+this.id),i.classList.add("dummy");const t=i.getBBox();this.nodes.push({dummy:!0,ref:n,fixed:!0,width:t.width,height:t.height})}},addTransLink(e,i,n){e.projection.parent=this,(0,t.isNullOrUndefined)(this.transLinks)&&(this.transLinks=[]),this.transLinks.push({id:e.id,from:i.id||i,to:n.id||n,arrow:e}),this.container.append(e.path),e.definitions&&this.container.append(e.definitions),this.restart()},containsTransArrow(e,i,n){if(!(0,t.isNullOrUndefined)(this.transLinks))for(let t=0;t<this.transLinks.length;t++)if(this.transLinks[t].id===e.id)return void this.transLinks.splice(t,1)},containsArrow(e,i,n){for(let r=0;r<this.links.length;r++)if(this.links[r].id===e.id){const s=i.id||i,a=n.id||n,o=this.findIndex(s),l=this.findIndex(a);if(o<0||l<0)this.removeArrow(e,r),this.addTransLink(e,i,n);else{let e=this.links[r].source.index,i=this.links[r].target.index;if(!(0,t.isNullOrUndefined)(this.linkInventory.get(e+","+i))){let t=this.linkInventory.get(e+","+i);t.length--,t.length<=0&&this.linkInventory.delete(e+","+i)}this.links[r].source=o,this.links[r].target=l,(0,t.isNullOrUndefined)(this.linkInventory.get(o+","+l))?this.linkInventory.set(o+","+l,{length:1}):this.linkInventory.get(o+","+l).length++}return this.restart(),!0}return!1},removeArrow(e,i=-1,n,r){if((0,t.isNullOrUndefined)(this.links))return;let s=0;if(i>=0){if(!(0,t.isNullOrUndefined)(this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index))){let t=this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index);t.length--,0===t.length&&this.linkInventory.delete(this.links[i].source.index+","+this.links[i].target.index)}return this.links.splice(i,1),e.decorator&&(s=this.removeDummy(i),e.decorator.remove()),e.path.remove(),this.restart(),s}for(let i=0;i<this.links.length;i++)if(this.links[i].id===e.id){if(!(0,t.isNullOrUndefined)(this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index))){let t=this.linkInventory.get(this.links[i].source.index+","+this.links[i].target.index);t.length--,0===t.length&&this.linkInventory.delete(this.links[i].source.index+","+this.links[i].target.index)}return e.decorator&&(s=this.removeDummy(i),e.decorator.remove()),this.links.splice(i,1),e.path.remove(),void this.restart()}},findIndex(t){for(let e=0;e<this.nodes.length;e++)if(this.nodes[e].concept===t)return e;return-1},createItem(t,e){const i=this.schema.item;let n=this.model.createProjection(t,i);n.optional=!0;let r=n.init().render();return n.element.parent=this,this.instances.set(n.element.source.id,r),r},removeItem(e){let i;for(this.force.stop(),i=0;i<this.nodes.length&&this.nodes[i].meta!==e.id&&this.nodes[i].concept!==e.id;i++);if((0,t.isNullOrUndefined)(this.links)||(0,t.isEmpty)(this.links))return this.nodes.splice(i,1),void this.restart();for(let e=0;e<this.links.length;e++){let n;if(this.links[e].source.index===i||this.links[e].target.index===i){let t=this.projection.model.getArrow(this.links[e].id);n=this.removeArrow(t,e,null,i),e--}(0,t.isNullOrUndefined)(this.links[e])||(this.links[e].source.index>i&&this.links[e].source.index--,this.links[e].target.index>i&&this.links[e].target.index--)}this.nodes.splice(i,1),this.restart()},removeDummy(t){for(let e=0;e<this.nodes.length;e++)this.nodes[e].ref===t&&(this.nodes.splice(e,1),e--),this.nodes[e].ref>t&&this.nodes[e].ref--},ticked(){let e=!0;for(;e&&!(0,t.isEmpty)(this.nodes);)this.nodes.forEach((t=>{this.nodes.forEach((i=>{e=this.collide(t,i)}))}));let i=this.links,n=this.container,r=this.linkInventory;const s=this.width,a=this.height;(0,t.isNullOrUndefined)(this.link)||(0,t.isEmpty)(this.links)||this.link.attr("d",(function(t){if(t.source===t.target)return;const e=Hn.computeBorder(t.source,t.target),i=Hn.computeBorder(t.target,t.source);let n=i.x-e.x,s=i.y-e.y,a=Math.sqrt(n*n+s*s);t.dr=a,t.s=e,t.t=i;let o=r.get(t.source.index+","+t.target.index);return o.length>1&&(a/=1+1/o.length*(t.indexL-1)),"M"+i.x+","+i.y+"A"+a+","+a+" 0 0 1,"+e.x+","+e.y+"A"+a+","+a+" 0 0 0,"+i.x+","+i.y})),this.node.attr("x",(function(e){if(!(0,t.isNullOrUndefined)(e.ref)){let s=i[e.ref].dr,a=r.get(i[e.ref].source.index+","+i[e.ref].target.index);a.length>1&&(s/=1+1/a.length*(i[e.ref].indexL-1));let o=Hn.getEllipseCenter(s,i[e.ref].s,i[e.ref].t,n),l=Hn.getPerpendicularLine(i[e.ref].s,i[e.ref].t),h=Hn.getPointConstructedEllipse(l,s,s,o),c=Hn.getCloserBorder(h,i[e.ref].t);return e.fx=c.x,(0,t.isNullOrUndefined)(e.width)?c.x:(e.fx=c.x-e.width/2,c.x-e.width/2)}return(e.x=Math.max(e.width/2,Math.min(s-e.width/2,e.x)))-e.width/2})).attr("y",(function(e){if(!(0,t.isNullOrUndefined)(e.ref)){let s=i[e.ref].dr,a=r.get(i[e.ref].source.index+","+i[e.ref].target.index);a.length>1&&(s/=1+1/a.length*(i[e.ref].indexL-1));let o=Hn.getEllipseCenter(s,i[e.ref].s,i[e.ref].t,n),l=Hn.getPerpendicularLine(i[e.ref].s,i[e.ref].t),h=Hn.getPointConstructedEllipse(l,s,s,o),c=Hn.getCloserBorder(h,i[e.ref].t);return e.fy=c.y,(0,t.isNullOrUndefined)(e.height)?c.y:c.y-e.height/2}return(e.y=Math.max(e.height/2,Math.min(a-e.height/2,e.y)))-e.height/2}))},analyseContentDim(){this.content.forEach((t=>{for(let e=0;e<this.nodes.length;e++)if(this.nodes[e].id===t.id){this.nodes[e].width=t.width,this.nodes[e].height=t.height,this.nodes[e].shape=this.computeShape(t.container||t.element);break}})),this.force.start()},computeRelativeShape(e,i){const n=i.querySelector("[data-shape]");if((0,t.isUndefined)(n))return;const r=e.getBoundingClientRect(),s=n.getBoundingClientRect(),a=i.getBoundingClientRect(),o=Number(e.getAttribute("width")),l=Number(e.getAttribute("height")),h={};h.width=o*s.width/r.width,h.height=l*s.height/r.height;const c=e.createSVGPoint();c.x=s.x,c.y=s.y;const u=c.matrixTransform(e.getScreenCTM().inverse());h.x=u.x,h.y=u.y;const d={};d.width=o*a.width/r.width,d.height=l*a.height/r.height;const p=e.createSVGPoint();p.x=s.x,p.y=s.y;const f=p.matrixTransform(e.getScreenCTM().inverse());let m;switch(d.x=f.x,d.y=f.y,n.tagName){case"circle":return{type:"circle",r:h.width/2};case"ellipse":return m=Number(n.getAttribute("width"))/s.width,a.width,m=Number(n.getAttribute("height"))/s.height,a.height,{type:"ellipse",rx:h.width/2,ry:h.height/2};default:m=Number(n.getAttribute("width"))/s.width;const t=a.width*m;return m=Number(n.getAttribute("height"))/s.height,{type:"rect",w:t,h:a.height*m}}},computeShape(e){const i=e.querySelector("[data-shape]");if(console.log("ComputingShape"),console.log(i),(0,t.isNullOrUndefined)(i))return;const n=i.getBBox(),r=e.getBoundingClientRect();let s;switch(console.log(n),console.log(r),i.tagName){case"circle":return s=Number(i.getAttribute("r"))/(n.width/2),{type:"circle",r:r.width*s/2};case"ellipse":s=Number(i.getAttribute("width"))/n.width;const t=r.width*s;return s=Number(i.getAttribute("height"))/n.height,{type:"ellipse",rx:t,ry:r.height*s};case"polygon":let e=i.getAttribute("data-points").split(" "),a=[];for(let t=0;t<e.length;t++)a.push({x:Number(e[t].split(",")[0])/n.width,y:Number(e[t].split(",")[1])/n.height});return{type:"polygon",points:a};case"rect":return{type:"rect",w:n.width,h:n.height,yOff:n.y,xOff:n.x};default:s=Number(i.getAttribute("width"))/n.width;const o=r.width*s;return s=Number(i.getAttribute("height"))/n.height,{type:"rect",w:o,h:r.height*s}}},collide(e,i){let n=!1;const r=this.width,s=this.height;if(!(0,t.isNullOrUndefined)(e.ref)&&!(0,t.isNullOrUndefined)(i.ref))return n;if(!(0,t.isNullOrUndefined)(e.ref)){if(e.fx<i.x&&e.fy<i.y&&e.fx+e.width/2>i.x-i.width/2&&e.fy+e.height>i.x-i.height/2){let t=e.fx+e.width/2-(i.x-i.width/2),n=1.1*(e.fy+e.height/2-(i.y-i.height/2));switch(Math.min(t,n)){case t:i.x+=t;break;case n:i.y+=n}}else if(e.fx>i.x&&e.fy<i.y&&i.x+i.width/2>e.fx-e.width/2&&e.fy+e.height/2>i.y-i.height/2){let t=i.x+i.width/2-(e.fx-e.width/2),n=1.1*(e.fy+e.height/2-(i.y-i.height/2));switch(Math.min(t,n)){case t:i.x-=t;break;case n:i.y+=n}}else if(e.fx>i.x&&e.fy>i.y&&i.x+i.width/2>e.fx-e.width/2&&i.y+i.height/2>e.fy-e.height){let t=i.x+i.width/2-(e.fx-e.width/2),n=1.1*(i.y+i.height/2-(e.fy-e.height/2));switch(Math.min(t,n)){case t:i.x-=t;break;case n:i.y-=n}}else if(e.fx<i.x&&e.fy>i.y&&e.fx+e.width/2>i.x-i.width/2&&e.fy-e.height<i.y+i.height/2){let t=e.x+e.width-(i.x-i.width/2),n=1.1*(i.y+i.height/2-(e.y-e.height/2));switch(Math.min(t,n)){case t:i.x+=t;break;case n:i.y-=n}}return n}if(!(0,t.isNullOrUndefined)(i.ref)){if(e.x<i.fx&&e.y<i.fy&&e.x+e.width/2>i.fx-i.width/2&&e.y+e.height/2>i.fx-i.height/2){let t=e.x+e.width/2-(i.fx-i.width/2),n=1.1*(e.y+e.height/2-(i.fy-i.height/2));switch(Math.min(t,n)){case t:e.x-=t;break;case n:e.y-=n}}else if(e.x>i.fx&&e.y<i.fy&&i.fx+i.width/2>e.x-e.width/2&&e.y+e.height/2>i.fy-i.height/2){let t=i.fx+i.width/2-(e.x-e.width/2),n=1.1*(e.y+e.height/2-(i.fy-i.height/2));switch(Math.min(t,n)){case t:e.x+=t;break;case n:e.y-=n}}else if(e.x>i.fx&&e.y>i.fy&&i.fx+i.width/2>e.x-e.width/2&&i.fy+i.height/2>e.y-e.height/2){let t=i.fx+i.width/2-(e.x-e.width/2),n=1.1*(i.fy+i.height/2-(e.y-e.height/2));switch(Math.min(t,n)){case t:e.x+=t;break;case n:e.y+=n}}else if(e.x<i.fx&&e.y>i.fy&&e.x+e.width/2>i.fx-i.width/2&&e.y-e.height/2<i.fy+i.height/2){let t=e.x+e.width/2-(i.fx-i.width/2),n=1.1*(i.fy+i.height/2-(e.y-e.height/2));switch(Math.min(t,n)){case t:e.x-=t;break;case n:e.y+=n}}return n}if(i&&i!==e)if(e.x<=i.x&&e.y<=i.y&&e.x+e.width/2>=i.x-i.width/2&&e.y+e.height/2>=i.y-i.height/2){let t=e.x+e.width/2-(i.x-i.width/2),n=1.1*(e.y+e.height/2-(i.y-i.height/2));switch(Math.min(t,n)){case t:if(e.x-t/2<0){i.x+=t;break}if(i.x+t/2>r){e.x-=t;break}e.x-=t/2,i.x+=t/2;break;case n:if(e.y-n/2<0){i.x+=n;break}if(i.y+n/2>s){e.x-=n;break}e.y-=n/2,i.y+=n/2}}else if(e.x>i.x&&e.y<i.y&&i.x+i.width/2>e.x-e.width/2&&e.y+e.height/2>i.y-i.height/2){let t=i.x+i.width/2-(e.x-e.width/2),n=1.1*(e.y+e.height/2-(i.y-i.height/2));switch(Math.min(t,n)){case t:if(e.x+t/2>r){i.x-=t;break}if(i.x-t/2<0){e.x+=t;break}e.x+=t/2,i.x-=t/2;break;case n:if(e.y-n/2<0){i.x+=n;break}if(i.y+n/2>s){e.x-=n;break}e.y-=n/2,i.y+=n/2}}else if(e.x>i.x&&e.y>i.y&&i.x+i.width/2>e.x-e.width/2&&i.y+i.height/2>e.y-e.height/2){let t=i.x+i.width/2-(e.x-e.width/2),n=1.1*(i.y+i.height/2-(e.y-e.height/2));switch(Math.min(t,n)){case t:if(e.x+t/2>r){i.x-=t;break}if(i.x-t/2<0){e.x+=t;break}e.x+=t/2,i.x-=t/2;break;case n:if(e.y+n/2>s){i.y-=n;break}if(i.y-n/2<0){e.y+=n;break}e.y+=n/2,i.y-=n/2}}else if(e.x<i.x&&e.y>i.y&&e.x+e.width/2>i.x-i.width/2&&e.y-e.height/2<i.y+i.height/2){let t=e.x+e.width/2-(i.x-i.width/2),n=1.1*(i.y+i.height/2-(e.y-e.height/2));switch(Math.min(t,n)){case t:if(e.x-t/2<0){i.x+=t;break}if(i.x+t/2>r){e.x-=t;break}e.x-=t/2,i.x+=t/2;break;case n:if(e.y+n/2>s){i.y-=n;break}if(i.y-n/2<0){e.y+=n;break}e.y+=n/2,i.y-=n/2}}return n},focus(){return this.container.focus(),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this.container.focus(),this},focusOut(){return this.focused=!1,this.container.classList.remove("active"),this.container.classList.remove("focus"),this},updateSize(){for(let t=0;t<this.nodes.length;t++)if(!this.nodes[t].dummy){let e=this.instances.get(this.nodes[t].meta||this.nodes[t].concept);console.log("UpdatingSize Here?"),console.log(e),console.log(this.instances),console.log(this.nodes[t]),console.log(t),console.log(this.nodes);let i=this.projection.resolveElement(e);this.nodes[t].width=i.width,this.nodes[t].height=i.height,this.nodes[t].shape=this.computeShape(e)}this.restart()},bindEvents(){this.projection.registerHandler("value.added",(t=>{this.addItem(t)})),this.projection.registerHandler("value.removed",(t=>{this.removeItem(t)})),this.projection.registerHandler("displayed",(()=>{(0,t.isEmpty)(this.source.value)||this.source.values.forEach((t=>{this.addItem(t),"prototype"===value.schema.nature&&(this.nodes[this.nodes.length-1].meta=this.nodes[i].concept,this.nodes[this.nodes.length-1].concept=value.getValue(!0).id)}))}))}},Hn={getPointEllipse(t,e,i){const n=i.rx/2,r=i.ry/2,s=t.x,a=t.y,o=this.getDeq(t,e);let l=r*r+n*n*o.a*o.a,h=2*n*n*o.a*o.b-2*s*r*r-2*a*o.a*n*n,c=h*h-4*l*(s*s*r*r+n*n*a*a+n*n*o.b*o.b-2*a*n*n*o.b-n*n*r*r);if(c>=0){let t=(-h-Math.sqrt(c))/(2*l),e=t*o.a+o.b,i=(-h+Math.sqrt(c))/(2*l);return{x1:{x:t,y:e},x2:{x:i,y:i*o.a+o.b}}}},getPointConstructedEllipse(t,e,i,n){const r=e,s=i,a=n.x,o=n.y;let l=s*s+r*r*t.a*t.a,h=2*r*r*t.a*t.b-2*a*s*s-2*o*t.a*r*r,c=h*h-4*l*(a*a*s*s+r*r*o*o+r*r*t.b*t.b-2*o*r*r*t.b-r*r*s*s);if(c>=0){let e=(-h-Math.sqrt(c))/(2*l),i=e*t.a+t.b,n=(-h+Math.sqrt(c))/(2*l);return[{x:e,y:i},{x:n,y:n*t.a+t.b}]}},getEllipseCenter(t,e,i,n){let r=(e.x-i.x)/2,s=(e.y-i.y)/2,a=-Math.sqrt((t*t*(t*t)-t*t*(s*s)-t*t*(r*r))/(t*t*(s*s)+t*t*r*r)),o=a*(-t*r/t);return{x:a*(t*s/t)+(e.x+i.x)/2,y:o+(e.y+i.y)/2}},getPerpendicularLine(t,e){let i=(t.x+e.x)/2,n=(t.y+e.y)/2,r=-1/Hn.getDeq(t,e).a;return{a:r,b:n-r*i}},getSelfPointEllipse(t){let e={x:t.x-t.ellipse.rx/2,y:t.y},i={x:t.x+t.ellipse.rx/2,y:t.y},n={x:t.x,y:t.y-t.ellipse.ry/2},r={x:t.x,y:t.y-t.ellipse.ry/2},s=0,a=0,o=0,l=0;switch(t.points.forEach((t=>{s+=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),a+=Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)),o+=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)),l+=Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y))})),Math.max(s,a,o,l)){case o:return{x:n.x,y:n.y,direction:"top"};case a:return{x:i.x,y:i.y,direction:"right"};case l:return{x:r.x,y:r.y,direction:"bot"};default:return{x:e.x,y:e.y,direction:"left"}}},getPointPolygon(t,e,i){let n=[];i.points.forEach((e=>{n.push({x:e.x*t.width+t.x-t.width/2,y:e.y*t.height+t.y-t.height/2})}));let r=n[0].x-e.x,s=n[0].y-e.y,a=Math.sqrt(r*r+s*s),o=a,l=0;for(let t=1;t<n.length;t++)r=n[t].x-e.x,s=n[t].y-e.y,a=Math.sqrt(r*r+s*s),a<o&&(o=a,l=t);return n[l]},getDeq(t,e){let i=(e.y-t.y)/(e.x-t.x);return{a:i,b:t.y-i*t.x}},getCloserBorder(t,e){let i=Math.sqrt((t[0].x-e.x)*(t[0].x-e.x)+(t[0].y-e.y)*(t[0].y-e.y));return Math.sqrt((t[1].x-e.x)*(t[1].x-e.x)+(t[1].y-e.y)*(t[1].y-e.y))<i?t[1]:t[0]},getPointRect(t,e,i){let n=t.x-t.width/2+i.xOff,r=t.y-t.height/2+i.yOff,s=r,a=t.x-t.width/2+i.xOff+i.w,o=t.y-t.height/2+i.yOff+i.h;console.log(t),console.log(e),console.log(n,r,a,s,o);let l=Hn.getDeq({x:t.x,y:t.y},{x:e.x,y:e.y}),h=Hn.getDeq({x:n,y:r},{x:a,y:s}),c=Hn.getLineIntersection(l,h);return c&&c.x>n&&c.x<a?[c,{x:(o-l.b)/l.a,y:o}]:[{x:a,y:l.a*a+l.b},{x:n,y:l.a*n+l.b}]},getLineIntersection(t,e){if(t.a===e.a)return!1;let i=t.a-e.a,n=e.b-t.b;return{x:n/i,y:t.a*(n/i)+t.b}},getPointCircle(t,e,i){let n=Hn.getDeq({x:t.x,y:t.y},{x:e.x,y:e.y}),r=n.a*n.a+1,s=2*n.a*n.b-2*n.a*t.y-2*t.x,a=s*s-4*r*(n.b*n.b-n.b*t.y*2+t.y*t.y+t.x*t.x-i.r*i.r);if(a>0){let t=(-s+Math.sqrt(a))/(2*r),e=(-s-Math.sqrt(a))/(2*r);return[{x:t,y:n.a*t+n.b},{x:e,y:n.a*e+n.b}]}},computeBorder(t,e){let i={},n={};switch(t.shape.type){case"rect":return i=Hn.getPointRect(t,e,t.shape),n=Hn.getCloserBorder(i,e),n;case"circle":return i=Hn.getPointCircle(t,e,t.shape),n=Hn.getCloserBorder(i,e),n;case"ellipse":return i=Hn.getPointEllipse(t,e,t.shape),n=Hn.getCloserBorder(i,e),n;case"polygon":return i=Hn.getPointPolygon(t,e,t.shape),i}}},Dn=Object.assign({},In,_n),Pn={init(){const{dimensions:t}=this.schema;return this.dimensions=t,this},render(){(0,t.createDocFragment)();const{dimensions:e,saturation:i,overflow:n=!1,create:r,add:s,style:a}=this.schema;if(this.focusable=!0,(0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),e&&(this.container.setAttribute("width",e.width),this.container.setAttribute("height",e.height)),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="pattern",this.container.dataset.id=this.id,this.container.dataset.click="container",this.container.tabIndex=0),n&&(this.container.style.overflow="visible"),i&&(this.saturation=i.value,this.satTarget=i.target,(0,t.isNullOrUndefined)(i.satParams)||(this.satParams=i.satParams),(0,t.isNullOrUndefined)(i.acceptTarget)||(this.acceptTarget=i.acceptTarget)),(0,t.isNullOrUndefined)(this.anchors)&&this.setUpAnchors(),s&&(0,t.isNullOrUndefined)(this.add)){const{coordinates:t=!1,render:e}=s;this.add=us.call(this,e),t?(this.add.setAttribute("x",t.x),this.add.setAttribute("y",t.y)):(this.add.setAttribute("x",this.anchors.current.x),this.add.setAttribute("y",this.anchors.current.y)),this.container.append(this.add),this.add.style.overflow="visible",this.add.addEventListener("click",(()=>{}))}return this.displayed=!1,a&&(this.container.style=a),this.bindEvents(),r&&this.source.createElement(),a&&(this.container.style=a),this.container},checkDim(t,e,i){e+20+Number(i.getAttribute("y"))>Number(this.items[0].render.getAttribute("height"))&&this.items.forEach((t=>{this.projection.resolveElement(t.render).augment()}))},checkSpeDim(t,e,i){for(;e+20+Number(i.getAttribute("y"))>Number(this.items[this.items.length-1].render.getAttribute("height"));)this.projection.resolveElement(this.items[this.items.length-1].render).augment()},createItem(t){const{tag:e}=this.schema.pattern;let i=this.model.createProjection(t,e);return i.optional=!0,i.parent=this.projection,{render:i.init().render(),projection:i}},addItem(e){if(this.saturation&&((0,t.isNullOrUndefined)(this.count)&&(this.count=0),this.count>=this.saturation))return this.environment.getActiveReceiver(this.satTarget).source.createElement(),void this.saturate(e);let{render:i,projection:n}=this.createItem(e);(0,t.isNullOrUndefined)(this.dimSchema)&&(this.dimSchema=new Map),this.dimSchema.set(i.dataset.id,ni.analyseDim(i,this.schema.pattern)),this.container.append(i);let r=this.anchors.current;(0,t.isNullOrUndefined)(this.items)&&(this.items=[]),this.items.push({render:i,position:r,index:this.anchorIndex,id:e.id}),this.displayed?(ni.setDimensions(this.dimSchema.get(i.dataset.id)),n.update("displayed",i.dataset.id)):((0,t.isNullOrUndefined)(this.waiting)&&(this.waiting=[]),this.waiting.push({render:i,projection:n})),(0,t.isNullOrUndefined)(this.anchors)&&this.setUpAnchors(),ni.positionElement(r,i),this.nextAnchor(!0),this.count++,this.warnings&&this.warnings.forEach((t=>{n.warn(t)}))},placeAdd(){this.add.setAttribute("x",this.anchors.current.x),this.add.setAttribute("y",this.anchors.current.y)},setUpAnchors(){const{first:t,next:e}=this.schema.pattern;this.anchors={},this.anchors.current=t,this.anchors.next=e,this.anchors.indexes=[t],this.anchorIndex=0},saturate(t){let e=this.environment.projectionModel.createProjection(this.projection.concept,this.projection.tag).init();e.render(),this.environment.getActiveReceiver("solo").accept(e.element.container,this.satParams.dimension,this.satParams.coordinates),e.element.addItem(t),this.full=!0,this.saturated=!0},accept(t,e=!1){const{render:i,params:n}=t;if(e){let t=this.projection.resolveElement(i);return t.parent=this,void(t.definitions&&this.container.append(t.definitions))}this.container.append(i)},acceptAnchor(t){this.container.append(t);let e=this.anchors.current;this.items.push({render:t,anchor:e,index:this.anchorIndex,id:t.id}),ni.positionElement(e,t),this.nextAnchor(!0),this.count++,this.count>=this.saturation&&(this.full=!0)},nextAnchor(e=!1){let{x:i,y:n}=this.anchors.current,r=this.anchors.next.x,s=this.anchors.next.y;this.anchors.current={x:i+r,y:n+s},e&&this.anchorModel&&Ke.AnchorHandler.nextAnchor(this.schema.handler.id,this.id),(0,t.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),this.anchors.indexes.push({x:i+r,y:n+s}),this.anchorIndex++,(0,t.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container)},createHolder(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return i.append(t),e.append(i),e},adapt(t,e){let i,n=t.parentNode.parentNode,r=t.parentNode;switch(e.type){case"fixed":n.setAttribute("width",e.value),r.setAttribute("width",e.value),i=t.getBoundingClientRect(),r.setAttribute("height",i.height),r.setAttribute("width",i.width),n.setAttribute("height",i.height*e.value/i.width),n.setAttribute("viewBox","0 0 "+i.width+" "+i.height)}},transmitFirst(){const{render:t,position:e,index:i,id:n}=this.items[0];return this.removeItem({id:n}),t},removeItem(e){let i,n;for(n=0;n<this.items.length;n++)if(this.items[n].id===e.id){const{position:t}=this.items[n];i=t;break}if(n>=this.items.length||(0,t.isNullOrUndefined)(this.items[n]))return;const r=this.items[n].index;for(this.items.splice(n,1),n>this.items.length&&n--;n<this.items.length;){let t=this.items[n].position;this.items[n].position=i,this.items[n].render.setAttribute("x",i.x),this.items[n].render.setAttribute("y",i.y),this.items[n].index--,i=t,n++}this.anchors.indexes.splice(this.anchors.indexes.length-1,1),this.anchors.current=this.anchors.indexes[this.anchors.indexes.length-1],(0,t.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),(0,t.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container),this.anchorModel&&Ke.AnchorHandler.deleteItem(this.schema.handler.id,this.id,r),(0,t.isNullOrUndefined)(this.count)||(this.count--,this.full&&(this.full=!1,this.environment.saturationRevolved(this,this.projection.rtag),this.saturated=!0),this.count)},removeAnchor(e){if(!(0,t.isNullOrUndefined)(this.items))for(let t=0;t<this.items.length;t++)this.items[t].index>e&&(this.items[t].position.x-=this.anchors.next.x,this.items[t].position.y-=this.anchors.next.y,this.items[t].render.setAttribute("x",this.items[t].position.x),this.items[t].render.setAttribute("y",this.items[t].position.y),this.items[t].index--);this.anchors.indexes.splice(this.anchors.indexes.length-1,1),this.anchors.current=this.anchors.indexes[this.anchors.indexes.length-1],(0,t.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),(0,t.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container)},moveElemToAnchor(e,i){this.anchors.indexes.length<=e+1&&(this.nextAnchor(!0),(0,t.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd());let n=this.anchors.indexes[e];this.items[i].position=n,this.items[i].index=e;let r=this.items[i].render;return r.setAttribute("x",n.x),r.setAttribute("y",n.y),r},increaseAnchors(e,i,n,r){i>this.anchors.indexes.length&&this.nextAnchor(!0),(0,t.isNullOrUndefined)(this.items)||this.items.forEach((t=>{t.render!==n&&t.index>=e&&t.index<=i&&(t.index++,r.includes(t.index)?this.projection.resolveElement(t.render).increaseAnchor():(t.position=this.anchors.indexes[t.index],t.render.setAttribute("x",t.position.x),t.render.setAttribute("y",t.position.y)))}))},decreaseAnchors(e,i,n,r){(0,t.isNullOrUndefined)(this.items)||this.items.forEach((t=>{t.render!==n&&t.index>=e&&t.index<=i&&(t.index--,r.includes(t.index)?this.projection.resolveElement(t.render).decreaseAnchor():(t.position=this.anchors.indexes[t.index],t.render.setAttribute("x",t.position.x),t.render.setAttribute("y",t.position.y)))}))},clickHandler(t){},focusIn(){return this.add&&this.container.append(this.add),this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.hide&&this.add&&this.add.remove(),this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.projection.registerHandler("displayed",(e=>{this.displayed||(this.displayed=!0,(0,t.isNullOrUndefined)(this.waiting)||this.waiting.forEach((t=>{let{render:e,projection:i}=t;ni.setDimensions(this.dimSchema.get(e.dataset.id)),i.update("displayed")}))),this.schema.handler&&(this.anchorModel=Ke.AnchorHandler.create(this,this.schema.handler))})),this.projection.registerHandler("value.added",(t=>{this.full?this.saturated||this.saturate():this.addItem(t)})),this.projection.registerHandler("value.removed",(t=>{this.removeItem(t)}))}},Vn=Object.assign({},In,Pn),{isHTMLElement:Bn,createDiv:Rn,isNullOrUndefined:zn,createDocFragment:$n,isEmpty:Fn,isNull:qn,valOrDefault:Wn,isUndefined:Xn}=n(835),Yn={init(){return this},render(){const{content:t=[],coordinates:e=!1,overflow:i=!1,background:n,data:r=!1,reference:s=!1,dimensions:a=!1,style:o,rmv:l=!1,anchor:h=!1}=this.schema,c=$n(),u=new DOMParser;if(zn(this.container)){if(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),n&&(this.background=u.parseFromString(n.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.background.childNodes.forEach((t=>{this.container.append(t)})),this.container.setAttribute("width",this.background.getAttribute("width")),this.container.setAttribute("height",this.background.getAttribute("height")),this.width=Number(this.background.getAttribute("width")),this.height=Number(this.background.getAttribute("height"))),a&&"wrap"!==a.type){const{width:t,height:e,viewBox:i=!1}=a;this.container.setAttribute("width",t),this.container.setAttribute("height",e),this.width=a.width,this.height=a.height,this.fixed=!0,i&&this.container.setAttribute("viewBox",i.minX+" "+i.minY+" "+i.width+" "+i.height),this.fixed=!0}if("wrap"!==a.type||n||(this.wrapped=!0,this.projection.registerHandler("displayed",(()=>{this.updateSizeWrap()}))),i&&(this.container.style.overflow="visible"),n||a||(this.container.style.overflow="visible"),e){const{x:t,y:i}=e;this.container.setAttribute("x",t),this.container.setAttribute("y",i)}this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="decoration",this.container.dataset.id=this.id,this.container.id=this.id,s&&(this.container.dataset.reference=!0)}return r&&this.container.setAttribute("data-shape",r),h&&(this.attachPoint=h),zn(this.content)&&!Fn(t)&&(this.waiting=[],this.positioning=[],this.itemsPos=new Map,this.itemsDim=new Map,this.content=[],t.forEach((t=>{let e=us.call(this,t.render),i=ni.analyseDim(e,t);this.itemsDim.set(e.dataset.id,i);let n=this.projection.resolveElement(e);zn(n)?this.waitingRendered=!0:(n.source.register(this.projection),this.content.push(n)),i.await&&this.waiting.push(e.dataset.id);let r=ni.analysePos(e,t);this.itemsPos.set(e.dataset.id,r),r.await&&this.positioning.push(r),zn(i.holder)?this.container.append(i.item):this.container.append(i.holder)}))),c.hasChildNodes()&&this.container.append(c),o&&(this.container.style=o),this.displayed=!1,this.bindEvents(),this.container},focus(t){this.container.focus()},focusIn(){return!zn(this.deleteElem)&&this.deleteElem.dataset.focusable&&this.container.append(this.deleteElem),zn(this.focusedElement)||this.focusedElement.forEach((t=>{this.container.append(t)})),zn(this.content)||this.content.forEach((t=>{t.focusIn()})),this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this.rmv&&this.container.append(this.rmv),this},focusOut(){return!zn(this.deleteElem)&&this.deleteElem.dataset.focusable&&this.deleteElem.remove(),zn(this.focusedElement)||this.focusedElement.forEach((t=>{t.remove()})),zn(this.content)||this.content.forEach((t=>{t.focusOut()})),this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this.rmv&&this.rmv.remove(),this},notify(t){this.updateContentDim(t.id)},augment(){let t=this.container.querySelector("[data-augment]");t.setAttribute("height",Number(t.getAttribute("height"))+30),zn(this.container.getAttribute("height"))||this.container.setAttribute("height",Number(this.container.getAttribute("height"))+30),qn(this.background)||this.background.setAttribute("height",Number(this.background.getAttribute("height"))+30)},updateContentDim(t){let e=this.itemsDim.get(t),i=this.itemsPos.get(t);"ratio"===e.type&&(ni.adaptRatio(e.item,e.ratio),ni.positionElement(i,e.holder))},accept(t,e,i){let n=ni.analyseDim(t,{dimension:e}),r=ni.analysePos(t,{coordinates:i});zn(this.itemsDim)&&(this.itemsDim=new Map),this.itemsDim.set(t.dataset.id,n),zn(this.itemsPos)&&(this.itemsPos=new Map),this.itemsPos.set(t.dataset.id,r),this.displayed?(ni.setDimensions(n),zn(n.holder)?ni.positionElement(r,t):ni.positionElement(r,n.holder)):(zn(this.content)&&(this.content=[],this.waiting=[],this.positioning=[]),this.content.push(this.projection.resolveElement(t)),n.await&&this.waiting.push(t.dataset.id),r.await&&this.positioning.push(r)),zn(n.holder)?this.container.append(n.item):this.container.append(n.holder)},analyseContentDim(){if(this.fixed)return;let t=0;if(0===this.content.length)return;for(;t<this.content.length&&zn(this.content[t]);)t++;if(t>this.content.length)return;let e=this.itemsDim.get(this.content[t].id);if("pure"===e.type){let e,i,n,r;zn(this.content[t].container)?(e=Number(this.content[t].element.getAttribute("x")),i=Number(this.content[t].element.getAttribute("y")),n=Number(this.content[t].width),r=Number(this.content[t].height)):(e=Number(this.content[t].container.getAttribute("x")),i=Number(this.content[t].container.getAttribute("y")),n=Number(this.content[t].width),r=Number(this.content[t].height)),this.width=e+n,this.height=i+r}for(let i=t+1;i<this.content.length;i++)if(!zn(this.content[i])&&(e=this.itemsDim.get(this.content[i].id),"pure"===e.type)){let t,e,n,r;zn(this.content[i].container)?(t=Number(this.content[i].element.getAttribute("x")),e=Number(this.content[i].element.getAttribute("y")),n=Number(this.content[i].width),r=Number(this.content[i].height)):(t=Number(this.content[i].container.getAttribute("x")),e=Number(this.content[i].container.getAttribute("y")),n=Number(this.content[i].width),r=Number(this.content[i].height)),(zn(this.width)||this.width<t+n)&&(this.width=t+n),(zn(this.height)||this.height<e+r)&&(this.height=e+r)}this.notifyDimObservers()},clickHandler(t){if(this.container.contains(t)){for(;t!==this.container&&zn(t.dataset.nature);)t=t.parentNode;t!==this.container&&this.projection.resolveElement(t).clickHandler(t)}return!1},bindEvents(){this.projection.registerHandler("displayed",(t=>{this.displayed||(this.displayed=!0,zn(this.waiting)||this.waiting.forEach((t=>{ni.setDimensions(this.itemsDim.get(t))})),zn(this.positioning)||this.positioning.forEach((t=>{let e=this.itemsDim.get(t.render.dataset.id);e.holder?ni.positionElement(t,e.holder):ni.positionElement(t,t.render)})),zn(this.content)||this.content.forEach((t=>{zn(t)||t.projection.update("displayed",t.id)})),zn(this.width)&&this.analyseContentDim(),zn(this.parent)||this.parent.updateSize())})),this.waitingRendered&&this.projection.registerHandler("binding",(t=>{this.content.push(this.projection.resolveElement(t))}))}},Zn=Object.assign({},In,Yn),Gn={init(){return this},render(){const{interaction:e,algorithm:i}=this.schema,n=(0,t.createDocFragment)();if((0,t.isNullOrUndefined)(this.container)&&(this.container=(0,t.createDiv)({id:this.id,class:["algorithm","algorithm--holder"],tabindex:-1,dataset:{nature:"algorithm",view:"holder",id:this.id}})),(0,t.isNullOrUndefined)(this.interactionArea)&&(this.interactionArea=us.call(this,e),n.append(this.interactionArea)),(0,t.isNullOrUndefined)(this.svgArea)){let t=this.source.getAttributeByName(i.name).target,e=this.environment.projectionModel.createProjection(t,i.tag);this.svgArea=e.init().render(),n.append(this.svgArea)}return n.hasChildNodes()&&this.container.append(n),this.container}},Jn=Object.assign({},In,Gn),{createDocFragment:Kn,isNullOrUndefined:Qn,isEmpty:tr,isNull:er}=n(835),{AnchorHandler:ir}=n(185),nr={init(){return this},render(){const{dimensions:t,overflow:e=!1,contains:i,reserve:n,model:r,style:s,offset:a,zindex:o,content:l=[]}=this.schema;if(Qn(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="anchor",this.container.dataset.id=this.id),e&&(this.container.style.overflow="visible"),t){const{width:e,height:i}=t;this.container.setAttribute("width",e),this.container.setAttribute("height",i)}return!tr(l)&&Qn(this.items)&&(this.items=[],l.forEach((t=>{const{coordinates:e,render:i,dimension:n}=t;let r=us.call(this,i);r.setAttribute("x",e.x),r.setAttribute("y",e.y),this.container.append(r),this.items.push(r)}))),r&&(ir.createSubModel(r,this),this.anchorModel=r),this.bindEvents(),s&&this.createStyleMimic(s),this.container},focusIn(){},focusOut(){},increaseSize(){const t=Number(this.container.getAttribute("height"));this.container.setAttribute("height",t+this.anchors.y),this.mimic.setAttribute("height",t+this.anchors.y)},decreaseSize(){const t=Number(this.container.getAttribute("height"));this.container.setAttribute("height",t-this.anchors.y),this.mimic.setAttribute("height",t-this.anchors.y)},increaseAnchor(){const t=Number(this.container.getAttribute("y"));this.container.setAttribute("y",t+this.anchors.y)},decreaseAnchor(){const t=Number(this.container.getAttribute("y"));this.container.setAttribute("y",t-this.anchors.y)},createStyleMimic(t){this.mimic=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.mimic.setAttribute("width",this.container.getAttribute("width")),this.mimic.setAttribute("height",this.container.getAttribute("height")),this.mimic.style=t,this.container.prepend(this.mimic)},checkCover(){let t,e;for(let i=0;i<this.covering.length;i++)Qn(t)?(t=Math.min(this.covering[i].from.x,this.covering[i].to.x),e=Math.max(this.covering[i].from.x,this.covering[i].to.x)):(t>Math.min(this.covering[i].from.x,this.covering[i].to.x)&&(t=Math.min(this.covering[i].from.x,this.covering[i].to.x)),e<Math.max(this.covering[i].from.x,this.covering[i].to.x)&&(e=Math.max(this.covering[i].from.x,this.covering[i].to.x)));const i=Number(this.container.getAttribute("x"));i<t?(this.container.setAttribute("width",e-t+2*this.schema.offset.x+(t-i)),this.mimic.setAttribute("width",e-t+2*this.schema.offset.x+(t-i))):(this.container.setAttribute("width",e-t+2*this.schema.offset.x),this.mimic.setAttribute("width",e-t+2*this.schema.offset.x))},bindEvents(){this.projection.registerHandler("displayed",(()=>{let t=ir.estimatePositionCondamn(this.anchorModel,this);const{offset:e=!1}=this.schema;e&&(this.container.setAttribute("x",t.x-e.x),this.container.setAttribute("y",t.y-e.y)),this.anchors=t.anchors,this.rtag=this.environment.getActiveReceiver(this.schema.rtag),this.rtag.container.prepend(this.container)})),this.projection.registerHandler("accept",(t=>{ir.registerSubModel(this.anchorModel,this,t)})),this.projection.registerHandler("cover",(t=>{Qn(this.rtag)&&(this.rtag=this.findActiveReceiver(this.schema.rtag));const e=ir.estimatePosition(t.calcS),i=ir.estimatePosition(t.calcT);Qn(this.covering)&&(this.covering=[]),this.setCovering(t,e,i),this.checkCover()}))},setCovering(t,e,i){for(let n=0;n<this.covering.length;n++)if(this.covering[n].item===t)return this.covering[n].from=e,void(this.covering[n].to=i);this.covering.push({item:t,from:e,to:i})}},rr=Object.assign({},In,nr),sr={init(){return this},render(){const{button:e,view:i}=this.schema;if((0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="decoration",this.container.dataset.id=this.id),(0,t.isNullOrUndefined)(this.button)){const t=new DOMParser,{content:i,coordinates:n}=e;this.button=t.parseFromString(parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.button.setAttribute("x",n.x),this.button.setAttribute("y",n.y),this.container.append(e)}return this.bindEvents(),this.container},bindEvents(){}},ar=Object.assign({},In,sr),{isHTMLElement:or,createDiv:lr,isNullOrUndefined:hr,createDocFragment:cr,isEmpty:ur,isNull:dr,valOrDefault:pr}=n(835),fr={init(){return this},render(){const{content:t,dimensions:e}=this.schema;return hr(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","text"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="add",this.container.dataset.id=this.id,this.container.setAttribute("font-size",12),this.container.style["dominant-baseline"]="hanging"),this.container.textContent=t,this.container},focusIn(){},focusOut(){},clickHandler(){this.source.createElement()},bindEvents(){this.container.addEventListener("click",(()=>{this.source.createElement()}))}},mr=Object.assign({},In,fr),gr={init(){return this},render(){const{action:e,content:i,background:n}=this.schema;if((0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="button",this.container.dataset.id=this.id),i&&(0,t.isNullOrUndefined)(this.content)&&this.createContent(i),n){const t=new DOMParser;this.background=t.parseFromString(n.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.background)}return this.container},createContent(t){switch(t.type){case"text":this.content=document.createElementNS("http://www.w3.org/2000/svg","text");const{placeholder:e,font:i,size:n,anchor:r}=t.text;this.content.setAttribute("font-family",i),this.content.setAttribute("font-size",n),this.content.setAttribute("text-anchor",r),this.content.style["dominant-baseline"]="hanging",this.content.textContent=e,this.container.append(this.content)}},focusIn(){},focusOut(){}},vr=Object.assign({},In,gr),br={init(){const{width:t,height:e}=this.schema.dimensions,{depth:i}=this.schema;return this.width=t,this.height=e,this.intensity=i,this},render(){const{tag:e,duration:i,orientation:n}=this.schema;if((0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="tree",this.container.dataset.id=this.id,this.container.tabindex=1,this.container.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,t.isNullOrUndefined)(this.linkSpace)&&(this.linkSpace=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.append(this.linkSpace),this.linkSpace.classList.add("linkSpace")),(0,t.isNullOrUndefined)(this.nodeSpace)&&(this.nodeSpace=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.append(this.nodeSpace),this.nodeSpace.classList.add("nodeSpace")),this.rootTag=e,this.duration=i,this.orientation=n,(0,t.isNullOrUndefined)(this.tree))switch(this.orientation){case"vertical":this.tree=d3.layout.tree().size([this.width,this.height]);break;default:this.tree=d3.layout.tree().size([this.height,this.width])}return this.createRoot(),this.setData(),this.bindEvents(),this.container},accept(e,i,n){let r=this.findData(i.getAttribute("data-concept")),s=this.model.createProjection(e,n).init();s.optional=!0;let a=s.render();e.register(this.projection);let o=this.createHolder();o.append(a),o.setAttribute("id",a.getAttribute("data-concept")),a.setAttribute("data-tree",this.schema.treeId),a.classList.add("node"),this.nodeSpace.append(o),s.element.source.notify("displayed"),(0,t.isNullOrUndefined)(r.children)&&(r.children=[]);let l=a.getBBox();r.children.push({proj:o,id:a.getAttribute("data-concept"),offW:l.width/2,offH:l.height/2,children:[]}),(0,t.isNullOrUndefined)(this.treeIndex)&&(this.treeIndex=new Map),this.treeIndex.set(a.getAttribute("data-concept"),o),this.update()},findData(t){let e=this.data[0];return this.findDataAt(t,e)},findDataAt(e,i){if(i.id===e)return i;if((0,t.isNullOrUndefined)(i.children)||(0,t.isEmpty)(i.children))return!1;for(let t=0;t<i.children.length;t++){let n=this.findDataAt(e,i.children[t]);if(n)return n}return!1},createRoot(){this.rootProj=this.model.createProjection(this.source,this.rootTag).init(),this.rootProj.parent=this.projection;let t=this.rootProj.render();t.setAttribute("data-tree",this.schema.treeId),this.root=t;let e=this.createHolder();switch(this.projMap=new Map,this.projMap.set(t,{group:e,index:0}),e.setAttribute("id",t.getAttribute("data-concept")),this.orientation){case"horizontal":e.setAttribute("x",0),e.setAttribute("y",this.height/2-this.rootProj.element.height/2);break;case"vertical":e.setAttribute("y",0),e.setAttribute("x",this.width/2-this.rootProj.element.width/2)}e.append(t),this.nodeSpace.appendChild(e)},createHolder(){let t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.classList.add("node"),t},setData(){this.data=[{name:"root",index:0,id:this.root.getAttribute("data-concept"),children:[]}]},update(){switch((0,t.isNullOrUndefined)(this.svg)&&(this.svg=d3.select("#"+this.id)),this.orientation){case"vertical":this.updateVertical();break;default:this.updateHorizontal()}},arrange(){let e=this.data[0],i=1;if((0,t.isNullOrUndefined)(e.children))return 0;for(let t=0;t<e.children.length;t++)i=this.arrangeChildren(e.children[t],i);return i>3?1:0},arrangeChildren(e,i){let n=this.treeIndex.get(e.id);if(n.setAttribute("example",i),this.nodeSpace.children.length>i?this.nodeSpace.insertBefore(n,this.nodeSpace.children[i]):this.nodeSpace.append(n),(0,t.isNullOrUndefined)(e.children))return i+1;let r=i+1;for(let t=0;t<e.children.length;t++)r=this.arrangeChildren(e.children[t],r),r++;return r},updateVertical(){var t=d3.svg.diagonal().projection((function(t){return[t.y,t.x]}));let e=this.data[0];e.x0=this.width/2,e.y0=50;let i=this.tree.nodes(e),n=this.tree.links(i);const r=this.intensity,s=this.duration;i.forEach((function(t){t.y=t.depth*r+50}));var a=this.svg.select("g.node").data(i),o=this.svg.select("path.link").data(n);a.enter().append("g").attr("class","node").attr("data-content",(function(t){return t.id})).attr("data-moved",(function(t){return"true"})).attr("transform",(function(t){return"translate("+e.x0+", "+e.y0+")"})),this.arrange(),a.transition().duration(s).attr("transform",(function(t){return"translate("+t.x+", "+t.y+")"})),a.exit().transition().attr("transform",(function(t){return"translate("+e.x+", "+e.y+")"})).remove(),i.forEach((function(t){t.x0=t.x,t.y0=t.y})),(o=svg.selectAll("path.link").data(n)).enter().insert("path","g").attr("class","link").attr("fill",a).attr("stroke",black).attr("stroke-width",2).attr("d",(function(e){var i={x:source.x0,y:source.y0};return t({source:i,target:i})})),o.transition().duration(s).attr("d",t),o.exit().transition().duration(s).attr("d",(function(e){var i={x:source.x,y:source.y};return t({source:i,target:i})})).remove()},updateHorizontal(){var t=d3.svg.diagonal().projection((function(t){return[t.y,t.x]}));let e=this.data[0];e.x0=this.width/2,e.y0=50;let i=this.tree.nodes(e),n=this.tree.links(i);const r=this.intensity,s=this.duration;i.forEach((function(t){t.y=t.depth*r+2*e.offW})),this.arrange();var a=this.svg.select("g.nodeSpace").selectAll("g.node").data(i);a.enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+(e.y0-e.offW)+", "+(e.x0-e.offH)+")"})),a.transition().duration(s).attr("transform",(function(t){return"translate("+(t.y-t.offW)+", "+(t.x-t.offH)+")"})),a.exit().transition().attr("transform",(function(t){return"translate("+(e.y-e.offW)+", "+(e.x-e.offH)+")"})).remove(),i.forEach((function(t){t.x0=t.x,t.y0=t.y}));var o=this.svg.select("g.linkSpace").selectAll("path.link").data(n);o.enter().insert("path","g").attr("class","link").attr("fill","none").attr("stroke","black").attr("stroke-width",2).attr("d",(function(i){var n={x:e.x0,y:e.y0};return t({source:n,target:n})})),o.transition().duration(s).attr("d",t),o.exit().transition().duration(s).attr("d",(function(i){var n={x:e.x,y:e.y};return t({source:n,target:n})})).remove()},removeNode(t,e){if(!e.children)return!1;for(let i=0;i<e.children.length;i++){if(e.children[i].id===t)return e.children.splice(i,1),0===e.children.length&&(e.children=null),!0;if(deleteItem(t,e.children[i]))return!0}return!1},bindEvents(){this.projection.registerHandler("displayed",(()=>{if(!this.displayed){this.displayed=!0,this.rootProj.element.source.notify("displayed");let t=this.rootProj.element.container.getBBox();this.data[0].offW=t.width/2,this.data[0].offH=t.height/2,this.update()}})),this.projection.registerHandler("delete",((t,e)=>{this.removeNode(e.id,this.data[0]),this.treeIndex.delete(e.id),this.update()}))}},yr=Object.assign(Object.create(In),br);var wr=0;const xr=()=>"algo"+wr++,Er={force:(t,e,i)=>Object.create(Dn,{object:{value:"algorithm"},name:{value:"force-algorithm"},type:{value:"force"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(t,e,i)=>Object.create(Vn,{object:{value:"algorithm"},name:{value:"pattern-algorithm"},type:{value:"pattern"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),decoration:(t,e,i)=>Object.create(Zn,{object:{value:"algorithm"},name:{value:"decoration-algorithm"},type:{value:"decoration"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(t,e,i)=>Object.create(Jn,{object:{value:"algorithm"},name:{value:"holder-algorithm"},type:{value:"holder"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),anchor:(t,e,i)=>Object.create(rr,{object:{value:"algorithm"},name:{value:"anchor-algorithm"},type:{value:"anchor"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),"alt-view":(t,e,i)=>Object.create(ar,{object:{value:"algorithm"},name:{value:"alt-view"},type:{value:"alt-view"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),add:(t,e,i)=>Object.create(mr,{object:{value:"algorithm"},name:{value:"add"},type:{value:"add"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),button:(t,e,i)=>Object.create(vr,{object:{value:"algorithm"},name:{value:"svg-button"},type:{value:"button"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),tree:(t,e,i)=>Object.create(yr,{object:{value:"algorithm"},name:{value:"tree-layout"},type:{value:"tree"},id:{value:xr()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}})},Ar={createAlgo(e,i,n){const{type:r}=i,s=Er[r];if((0,t.isNullOrUndefined)(s))throw new TypeError(`Missing handler: The '${r}' algo could not be handled`);const a=s(e,i,n);if((0,t.isNullOrUndefined)(a))throw new Error(`Bad request: The '${r}' algo could not be created`);return a.createAlgo=this.createAlgo,(0,t.isNullOrUndefined)(a.id)&&(a.id=xr()),a}};var Nr=n(127),Or=n(78);const Mr={init(){return this.width=700,this.height=700,this},render(){(0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",350),this.container.setAttribute("height",350),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.simulationArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.simulationArea.setAttribute("width",350),this.simulationArea.setAttribute("height",350),this.simulationArea.setAttribute("viewBox","0 0 700 700"),this.simulationArea.setAttribute("preserveAspectRatio","xMidYMid meet"),this.simulationArea.id=this.id,this.settingArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.settingArea.setAttribute("x",0),this.settingArea.setAttribute("y",0),this.container.append(this.settingArea),this.container.append(this.simulationArea)),(0,t.isNullOrUndefined)(this.circleRadiusTxt)&&(this.circleRadiusTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.circleRadiusTxt.textContent="Radius:",this.circleRadiusTxt.setAttribute("x",5),this.circleRadiusTxt.setAttribute("y",30),this.circleRadiusTxt.setAttribute("font-size",8),this.circleRadiusTxt.setAttribute("font-weight",500),this.circleRadiusTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.circleRadiusTxt)),(0,t.isNullOrUndefined)(this.radiusTxt)&&(this.radiusTxt=us.call(this,{type:"attribute",name:"radius",tag:"simulation"}),this.radiusTxt.setAttribute("x",37),this.radiusTxt.setAttribute("y",30),this.settingArea.append(this.radiusTxt)),(0,t.isNullOrUndefined)(this.widthTxt)&&(this.widthTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.widthTxt.textContent="Width:",this.widthTxt.setAttribute("x",5),this.widthTxt.setAttribute("y",40),this.widthTxt.setAttribute("font-size",8),this.widthTxt.setAttribute("font-weight",500),this.widthTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.widthTxt)),(0,t.isNullOrUndefined)(this.wTxt)&&(this.wTxt=us.call(this,{type:"attribute",name:"width",tag:"simulation"}),this.wTxt.setAttribute("x",37),this.wTxt.setAttribute("y",40),this.settingArea.append(this.wTxt)),(0,t.isNullOrUndefined)(this.heightTxt)&&(this.heightTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.heightTxt.textContent="Height",this.heightTxt.setAttribute("x",5),this.heightTxt.setAttribute("y",50),this.heightTxt.setAttribute("font-size",8),this.heightTxt.setAttribute("font-weight",500),this.heightTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.heightTxt)),(0,t.isNullOrUndefined)(this.hTxt)&&(this.hTxt=us.call(this,{type:"attribute",name:"height",tag:"simulation"}),this.hTxt.setAttribute("x",37),this.hTxt.setAttribute("y",50),this.settingArea.append(this.hTxt)),this.button=document.createElementNS("http://www.w3.org/2000/svg","text"),this.button.textContent="Simulate",this.settingArea.append(this.button),this.button.addEventListener("click",(()=>{this.setUpForce()})),this.button.setAttribute("x",5),this.button.setAttribute("y",12),this.button.setAttribute("font-size",12),this.button.setAttribute("font-weight",500),this.button.setAttribute("font-family","Segoe UI");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.classList.add("linkSimulation"),e.id="linkSimulation"+this.id,e.setAttribute("stroke","black"),this.simulationArea.append(e),this.svgNode=[];for(let t=0;t<3;t++){let t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.style.fill="red",t.style.stroke="black",t.setAttribute("r",50),t.classList.add("nodeSimulation"),t.classList.add("hidden"),this.svgNode.push(t),this.simulationArea.append(t)}let i=document.createElementNS("http://www.w3.org/2000/svg","circle");return i.classList.add("nodeSimulation"),i.classList.add("hidden"),this.svgNode.push(i),this.simulationArea.append(i),this.bindEvents(),this.intensity=Number(this.intensityAttr.value),this.linkVal=Number(this.linkDistAttr.value),this.container},branch(){this.setUpForce()},setUpForce(){if((0,t.isNullOrUndefined)(this.force)){this.svgNode.forEach((t=>{t.classList.remove("hidden")})),this.source.getAttributeByName("intensity").target.value;const t=Number(this.source.getAttributeByName("linkVal").target.value);this.force=Or.layout.force().size([this.width,this.height]).nodes([]).links([{source:0,target:1}]).linkDistance(t).charge(-500).on("tick",this.tick.bind(this));var e=Or.select("#"+this.id);this.nodes=this.force.nodes(),this.nodes.push({x:25,y:25}),this.nodes.push({x:325,y:25}),this.nodes.push({x:175,y:75}),this.nodes.push({ref:!0}),this.node=e.selectAll("circle").data(this.nodes),this.links=this.force.links(),this.link=e.selectAll("path").data(this.links)}this.force.start()},clickHandler(){},tick(){let t=this.nodes;this.node.attr("cx",(function(e){if(e.ref){jr.getMediatrice(t[0],t[1]);let e={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2};return t[0].x,t[1].x,t[0].x,t[1].x,t[0].y,t[1].y,t[0].y,t[1].y,e.x}return e.x})).attr("cy",(function(e){if(e.ref){jr.getMediatrice(t[0],t[1]);let e={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2};return t[0].x,t[1].x,t[0].x,t[1].x,t[0].y,t[1].y,t[0].y,t[1].y,e.y}return e.y})),this.link.attr("d",(function(t){return"M"+t.target.x+","+t.target.y+"A1,1 0 0 1,"+t.source.x+","+t.source.y+"A1,1 0 0 0,"+t.target.x+","+t.target.y}))},updateClean(){this.height=this.heightAttr.value,this.width=this.widthAttr.value,this.height>0&&this.width>0&&this.simulationArea.setAttribute("viewBox","0 0 "+this.width+" "+this.height);for(let t=0;t<3;t++)this.radius.value>0&&this.svgNode[t].setAttribute("r",this.radius.value)},focusIn(){},focusOut(){},updateParams(){if((0,t.isNullOrUndefined)(this.force))this.updateClean();else{this.force.stop(),this.intensity=Math.min(-1*Number(this.intensityAttr.value),-1*Number(this.intensityAttr.value)),this.linkVal=Number(this.linkDistAttr.value);for(let t=0;t<3;t++)this.radius.value>0&&this.svgNode[t].setAttribute("r",this.radius.value);this.height=this.heightAttr.value,this.width=this.widthAttr.value,this.height>0&&this.width>0&&(this.simulationArea.setAttribute("viewBox","0 0 "+this.width+" "+this.height),this.force.size([this.width,this.height])),this.force.linkDistance(this.linkVal).charge(this.intensity),this.force.start()}},bindEvents(){this.intensityAttr=this.source.getAttributeByName("intensity").target,this.linkDistAttr=this.source.getAttributeByName("linkVal").target,this.widthAttr=this.source.getAttributeByName("width").target,this.heightAttr=this.source.getAttributeByName("height").target,this.radius=this.source.getAttributeByName("radius").target,this.intensityAttr.register(this.projection),this.linkDistAttr.register(this.projection),this.widthAttr.register(this.projection),this.heightAttr.register(this.projection),this.radius.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateParams()}))}},jr={getMediatrice(t,e){let i=(t.x+e.x)/2,n=(t.y+e.y)/2,r=(e.y-t.y)/(e.x-t.x);return{k:-1/r,h:n+-1/r*i}},findPoint(t,e,i){let n=1-t.k*t.k,r=2*e.y*t.k-2-2*t.k*t.h,s=r*r-4*n*(e.x*e.x-e.y*e.y-t.h*t.h+2*e.y*t.h-i);if(s>0)return(-r-Math.sqrt(s))/(2*n)}},Cr=Object.assign(Object.create(Nr.Simulation),Mr),Lr={init(){return this.width=350,this.height=100,this},focusIn(){},focusOut(){},render(){return(0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",300),this.container.setAttribute("height",50),this.container.setAttribute("x",100),this.container.setAttribute("y",0),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.schema.wider?this.path.setAttribute("d","M 0 25 L 275 25"):this.path.setAttribute("d","M 0 25 L 200 25"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="arrow",this.container.dataset.id=this.id,this.container.id=this.id,this.path.id="path"+this.id,this.container.append(this.path)),this.markerStart=us.call(this,{type:"attribute",name:"start",placeholder:!1,tag:"simulation-start"}),this.markerEnd=us.call(this,{type:"attribute",name:"end",placeholder:!1,tag:"simulation-end"}),this.container.append(this.markerStart),this.container.append(this.markerEnd),this.bindEvents(),this.container},applyStyle(){this.stroke.hasValue()&&this.path.setAttribute("stroke",this.stroke.value),this.width.hasValue()&&this.path.setAttribute("stroke-width",this.width.value),this.dasharray.hasValue()&&this.path.setAttribute("stroke-dasharray",this.dasharray.value),this.linecap.hasValue()&&this.path.setAttribute("stroke-linecap",this.linecap.value)},bindEvents(){this.stroke=this.source.getAttributeByName("stroke").target,this.stroke.register(this.projection),this.path.setAttribute("stroke","black"),this.width=this.source.getAttributeByName("width").target,this.width.register(this.projection),this.width.hasValue()&&this.path.setAttribute("stroke-width",this.width.value),this.dasharray=this.source.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.dasharray.hasValue()&&this.path.setAttribute("stroke-dasharray",this.dasharray.value),this.linecap=this.source.getAttributeByName("linecap").target,this.linecap.register(this.projection),this.linecap.hasValue()&&this.path.setAttribute("stroke-linecap",this.linecap.value),this.projection.registerHandler("value.changed",(()=>{this.applyStyle()}))}},Sr=Object.assign(Object.create(Nr.Simulation),Lr),kr={init(){return this.width=350,this.height=100,this},render(){return(0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",200),this.container.setAttribute("height",200),this.container.setAttribute("viewBox","0 0 50 50"),this.text=document.createElementNS("http://www.w3.org/2000/svg","text"),this.text.setAttribute("x",25),this.text.setAttribute("y",25),this.text.textContent="Element",this.heightTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.heightTxt.setAttribute("x",2),this.heightTxt.setAttribute("y",45),this.heightTxt.setAttribute("font-size",2),this.heightTxt.textContent="dimensions: 50x50",this.xyText=document.createElementNS("http://www.w3.org/2000/svg","text"),this.xyText.setAttribute("x",2),this.xyText.setAttribute("y",47),this.xyText.setAttribute("font-size",2),this.xyText.textContent="x,y: 25, 25",this.container.append(this.text),this.container.append(this.widthTxt),this.container.append(this.heightTxt),this.container.append(this.xyText),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="text",this.container.dataset.id=this.id,this.container.style="border:solid rgb(135, 161, 255); border-radius:10%;",this.container.id=this.id),this.bindEvents(),this.container},applyStyle(){this.font.hasValue()&&this.text.setAttribute("font-family",this.font.value),this.size.hasValue()&&this.text.setAttribute("font-size",this.size.value),this.anchor.hasValue()&&this.text.setAttribute("text-anchor",this.anchor.value),this.weight.hasValue()&&this.text.setAttribute("font-weight",this.weight.value),this.baseline.hasValue()&&(this.text.style["dominant-baseline"]=this.baseline.value)},bindEvents(){this.font=this.source.getAttributeByName("font").target,this.font.register(this.projection),this.text.setAttribute("font-family","Verdana"),this.size=this.source.getAttributeByName("size").target,this.size.register(this.projection),this.size.hasValue()&&this.text.setAttribute("font-size",this.size.value),this.weight=this.source.getAttributeByName("weight").target,this.weight.register(this.projection),this.weight.hasValue()&&this.text.setAttribute("font-weight",this.weight.value),this.anchor=this.source.getAttributeByName("anchor").target,this.anchor.register(this.projection),this.anchor.hasValue()&&this.text.setAttribute("text-anchor",this.anchor.value),this.baseline=this.source.getAttributeByName("baseline").target,this.baseline.register(this.projection),this.baseline.hasValue()&&this.text.setAttribute("dominant-baseline",this.anchor.value),this.projection.registerHandler("value.changed",(()=>{this.applyStyle()}))}},Tr=Object.assign(Object.create(Nr.Simulation),kr),Ur={init(){return this.width=400,this.height=200,this},render(){return(0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",200),this.container.setAttribute("height",200),this.container.setAttribute("viewBox","0 0 400 400"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.simulation="selection",this.container.dataset.id=this.id,this.container.style="border:solid rgb(135, 161, 255); border-radius:10%;",this.container.id=this.id),this.bindEvents(),this.setUpSimulation(),this.container},bindEvents(){this.nbItem=this.source.getAttributeByName("nbItem").target,this.orientation=this.source.getAttributeByName("orientation").target,this.break=this.source.getAttributeByName("break").target,this.itemW=this.source.getAttributeByName("dimensions").target.getAttributeByName("width").target,this.itemH=this.source.getAttributeByName("dimensions").target.getAttributeByName("height").target,this.nbItem.register(this.projection),this.orientation.register(this.projection),this.break.register(this.projection),this.itemW.register(this.projection),this.itemH.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.setUpSimulation()}))},setUpSimulation(){this.baseLetter=65,(0,t.isNullOrUndefined)(this.selection)||this.selection.remove(),this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg");for(let t=0;t<this.nbItem.value;t++){let e=this.createItem();this.place(e,t),this.baseLetter++}this.center(),this.container.append(this.selection)},focusIn(){},focusOut(){},place(e,i){const n=(0,t.valOrDefault)(this.itemW.value,50),r=(0,t.valOrDefault)(this.itemH.value,50),s=this.break.value;switch(this.orientation.value){case"horizontal":s>0?(e.setAttribute("x",i%s*n),e.setAttribute("y",~~(i/s)*r)):e.setAttribute("x",i*n);break;case"vertical":s>0?(e.setAttribute("x",~~(i/s)*r),e.setAttribute("y",i%s*n)):e.setAttribute("y",i*r)}},createItem(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");const i=(0,t.valOrDefault)(this.itemW.value,50),n=(0,t.valOrDefault)(this.itemH.value,50);this.break.value,e.setAttribute("width",i),e.setAttribute("height",n);let r=document.createElementNS("http://www.w3.org/2000/svg","text");return r.textContent=String.fromCharCode(this.baseLetter),r.setAttribute("x",i/2),r.setAttribute("y",n/2),r.setAttribute("text-anchor","middle"),r.setAttribute("font-size",n/2),r.setAttribute("font-family","Segoe UI"),r.setAttribute("font-weight",500),e.append(r),this.selection.append(e),e},center(){const e=this.orientation.value,i=this.break.value,n=(0,t.valOrDefault)(this.itemW.value,50),r=(0,t.valOrDefault)(this.itemH.value,50),s=this.nbItem.value;switch(e){case"horizontal":i>0&&s>i?(this.selection.setAttribute("x",200-i*n/2),this.selection.setAttribute("y",200-Math.ceil(s/i)*r/2)):(this.selection.setAttribute("x",200-s*n/2),this.selection.setAttribute("y",200-r/2));break;case"vertical":i>0&&s>i?(this.selection.setAttribute("y",200-i*r/2),this.selection.setAttribute("x",200-Math.ceil(s/i)*n/2)):(this.selection.setAttribute("y",200-s*r/2),this.selection.setAttribute("x",200-n/2))}}},Ir=Object.assign(Object.create(Nr.Simulation),Ur),_r={init(){return this},focusIn(){},focusOut(){},render(){return(0,t.isNullOrUndefined)(this.def)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.def=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.marker=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.marker.setAttribute("orient","auto"),this.marker.setAttribute("markerUnit","strokeWidth"),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="marker",this.container.dataset.id=this.id,this.def.append(this.marker),this.marker.append(this.path),this.container.append(this.def)),this.bindEvents(),this.container},focus(){},updateParams(){(0,t.isNullOrUndefined)(this.idAttr.value)||(this.marker.setAttribute("id",this.idAttr.value),this.user=this.container.parentNode.getElementById("path"+this.container.parentNode.id),this.user.setAttribute("marker-"+(this.schema.start?"start":"end"),"url(#"+this.idAttr.value+")")),(0,t.isNullOrUndefined)(this.minX.value)||(0,t.isNullOrUndefined)(this.minY.value)||(0,t.isNullOrUndefined)(this.width.value)||(0,t.isNullOrUndefined)(this.height.value)||this.marker.setAttribute("viewBox",this.minX.value+" "+this.minY.value+" "+this.width.value+" "+this.height.value),(0,t.isNullOrUndefined)(this.refX.value)||this.marker.setAttribute("refX",this.refX.value),(0,t.isNullOrUndefined)(this.refY.value)||this.marker.setAttribute("refY",this.refY.value),(0,t.isNullOrUndefined)(this.markerWidth.value)||this.marker.setAttribute("markerWidth",this.markerWidth.value),(0,t.isNullOrUndefined)(this.markerHeight.value)||this.marker.setAttribute("markerHeight",this.markerHeight.value),(0,t.isNullOrUndefined)(this.d.value)||this.path.setAttribute("d",this.d.value)},bindEvents(){this.idAttr=this.source.getAttributeByName("id").target,this.idAttr.register(this.projection),this.minX=this.source.getAttributeByName("minX").target,this.minX.register(this.projection),this.minY=this.source.getAttributeByName("minY").target,this.minY.register(this.projection),this.width=this.source.getAttributeByName("width").target,this.width.register(this.projection),this.height=this.source.getAttributeByName("height").target,this.height.register(this.projection),this.refX=this.source.getAttributeByName("refX").target,this.refX.register(this.projection),this.refY=this.source.getAttributeByName("refY").target,this.refY.register(this.projection),this.markerWidth=this.source.getAttributeByName("markerWidth").target,this.markerWidth.register(this.projection),this.markerHeight=this.source.getAttributeByName("markerHeight").target,this.markerHeight.register(this.projection),this.d=this.source.getAttributeByName("d").target,this.d.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateParams()}))}},Hr=Object.assign(Object.create(Nr.Simulation),_r),Dr={init(){return this.width=350,this.height=350,this},render(){return(0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="content",this.container.dataset.id=this.id,this.container.setAttribute("width",300),this.container.setAttribute("height",300),this.holder=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.append(this.holder)),this.bindEvent(),this.container},focusIn(){},focusOut(){},scale(){const t=this.content.width.baseVal.value,e=this.content.height.baseVal.value;let i=Math.max(t,e)/100;this.holder.setAttribute("viewBox","0 0 "+t+" "+e),this.holder.setAttribute("width",t/i),this.holder.setAttribute("height",e/i),this.holder.setAttribute("x",100),this.holder.setAttribute("y",100)},bindEvent(){const e=new DOMParser;this.projection.registerHandler("value.changed",(i=>{(0,t.isNullOrUndefined)(this.content)||this.content.remove(),this.content=e.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.holder.append(this.content),this.scale()})),this.source.hasValue()&&(this.content=e.parseFromString(this.source.value.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.holder.append(this.content),this.scale())}},Pr=Object.assign(Object.create(Nr.Simulation),Dr),Vr={init(){return this.width=350,this.height=350,this},render(){return(0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",400),this.container.setAttribute("height",400),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="pattern",this.container.dataset.id=this.id),(0,t.isNullOrUndefined)(this.visualization)&&(this.visualization=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.visualization.setAttribute("viewBox","0 0 400 400"),this.visualization.setAttribute("width",400),this.visualization.setAttribute("height",400),this.visualization.setAttribute("preserveAspectRatio","xMidYMid meet"),this.container.append(this.visualization)),(0,t.isNullOrUndefined)(this.interaction)&&(this.interaction=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.interaction.setAttribute("viewBox","0 0 400 400"),this.interaction.setAttribute("width",400),this.interaction.setAttribute("height",400),this.container.append(this.interaction)),(0,t.isNullOrUndefined)(this.firstX)&&(this.firstX=this.source.getAttributeByName("first").target.getAttributeByName("x").target,this.firstY=this.source.getAttributeByName("first").target.getAttributeByName("y").target),(0,t.isNullOrUndefined)(this.nextX)&&(this.nextX=this.source.getAttributeByName("next").target.getAttributeByName("x").target,this.nextY=this.source.getAttributeByName("next").target.getAttributeByName("y").target),(0,t.isNullOrUndefined)(this.itemWidth)&&(this.itemWidth=this.source.getAttributeByName("itemWidth").target,this.itemWidthTextual=us.call(this,{type:"attribute",name:"itemWidth",tag:"simulation-large"}),this.itemWidthTextual.setAttribute("x",57),this.itemWidthTextual.setAttribute("y",30),this.itemWidthStatic=us.call(this,{kind:"static",type:"svg-text",content:"ItemWidth:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.itemWidthStatic.setAttribute("x",56),this.itemWidthStatic.setAttribute("y",30),this.interaction.append(this.itemWidthTextual),this.interaction.append(this.itemWidthStatic)),(0,t.isNullOrUndefined)(this.widthTextual)&&(this.widthAttr=this.source.getAttributeByName("width").target,this.widthTextual=us.call(this,{type:"attribute",name:"width",tag:"simulation-large"}),this.widthTextual.setAttribute("x",34),this.widthTextual.setAttribute("y",45),this.widthStatic=us.call(this,{kind:"static",type:"svg-text",content:"Width:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.widthStatic.setAttribute("x",33),this.widthStatic.setAttribute("y",45),this.interaction.append(this.widthTextual),this.interaction.append(this.widthStatic)),(0,t.isNullOrUndefined)(this.heightTextual)&&(this.heightAttr=this.source.getAttributeByName("height").target,this.heightTextual=us.call(this,{type:"attribute",name:"height",tag:"simulation-large"}),this.heightTextual.setAttribute("x",38),this.heightTextual.setAttribute("y",60),this.heightStatic=us.call(this,{kind:"static",type:"svg-text",content:"Height:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.heightStatic.setAttribute("x",37),this.heightStatic.setAttribute("y",60),this.interaction.append(this.heightTextual),this.interaction.append(this.heightStatic)),(0,t.isNullOrUndefined)(this.nbItem)&&(this.nbItem=this.source.getAttributeByName("nbItem").target,this.nbItemText=us.call(this,{type:"attribute",name:"nbItem",tag:"simulation-large"}),this.nbItemStatic=us.call(this,{kind:"static",type:"svg-text",content:"nbItem:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.nbItemText.setAttribute("x",26),this.nbItemText.setAttribute("y",15),this.nbItemStatic.setAttribute("x",25),this.nbItemStatic.setAttribute("y",15),this.interaction.append(this.nbItemStatic),this.interaction.append(this.nbItemText),this.setUpItems()),this.bindEvents(),this.container},setUpItems(){let t=this.nbItem.value;this.items=[];for(let e=0;e<t;e++){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width",this.itemWidth.value),t.setAttribute("height",this.itemWidth.value),t.setAttribute("fill","white"),t.setAttribute("stroke","#738CFF"),t.setAttribute("stroke-width",5),t.setAttribute("x",e*this.nextX.value+this.firstX.value),t.setAttribute("y",e*this.nextY.value+this.firstY.value),this.visualization.append(t),this.items.push(t)}},updateContainer(){(0,t.isNullOrUndefined)(this.widthAttr.value)||(0,t.isNullOrUndefined)(this.heightAttr.value)||this.visualization.setAttribute("viewBox","0 0 "+this.widthAttr.value+" "+this.heightAttr.value)},updateItems(){let e=this.nbItem.value;if(!(0,t.isNullOrUndefined)(e)){if(this.items.length>e){for(let t=e;t<this.items.length;t++)this.items[t].remove();this.items.splice(e,this.items.length-e)}if(this.items.length<e)for(let t=this.items.length;t<e;t++){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("fill","white"),t.setAttribute("stroke","#738CFF"),t.setAttribute("stroke-width",5),this.visualization.append(t),this.items.push(t)}for(let e=0;e<this.items.length;e++)this.items[e].setAttribute("width",(0,t.valOrDefault)(this.itemWidth.value,50)),this.items[e].setAttribute("height",(0,t.valOrDefault)(this.itemWidth.value,50)),this.items[e].setAttribute("x",e*this.nextX.value+this.firstX.value),this.items[e].setAttribute("y",e*this.nextY.value+this.firstY.value)}},bindEvents(){this.nbItem.register(this.projection),this.firstX.register(this.projection),this.firstY.register(this.projection),this.nextX.register(this.projection),this.nextY.register(this.projection),this.itemWidth.register(this.projection),this.widthAttr.register(this.projection),this.heightAttr.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateContainer(),this.updateItems()}))}},Br=Object.assign(Object.create(Nr.Simulation),Vr),Rr={init(){return this.width=460,this.height=220,this},render(){if((0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,t.isNullOrUndefined)(this.nodes)){this.nodes=[];for(let t=0;t<3;t++){let t=us.call(this,{kind:"static",type:"svg",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" width="10" height="10" version="1"><circle r="5" cx="5" cy="5"></circle></svg>'});this.container.append(t),this.nodes.push(t)}this.nodes[0].setAttribute("x",50),this.nodes[0].setAttribute("y",110),this.nodes[1].setAttribute("x",225),this.nodes[1].setAttribute("y",35),this.nodes[2].setAttribute("x",400),this.nodes[2].setAttribute("y",190)}return(0,t.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("stroke","black"),this.path.setAttribute("fill","transparent"),this.container.append(this.path)),this.sp=us.call(this,{type:"attribute",name:"sub-paths",tag:"simulation"}),this.container.append(this.sp),this.subPaths=this.projection.resolveElement(this.sp),this.bindEvents(),this.bindStyle(),this.bindSubPath(),this.bindSubStyle(),this.setPath(),this.container},setPath(){let t=this.meet.value;switch(t){case"free":this.path.setAttribute("d","M 55 115 L 230 40 L 405 195");break;case"minX":this.path.setAttribute("d","M 55 40 L 55 195");break;case"maxX":this.path.setAttribute("d","M 405 40 L 405 195");break;case"minY":this.path.setAttribute("d","M 55 40 L 405 40");break;case"maxY":this.path.setAttribute("d","M 55 195 L 405 195")}this.style(),this.subPaths.setPath(t,{x:0,y:0})},bindEvents(){this.meet=this.source.getAttributeByName("meet").target,this.meet.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.setPath()}))},style(){this.path.setAttribute("stroke",this.stroke.value),this.path.setAttribute("stroke-width",this.width.value),this.path.setAttribute("stroke-linecap",this.linecap.value),(0,t.isNullOrUndefined)(this.dasharray.value)||(this.path.style["stroke-dasharray"]=this.dasharray.value)},bindStyle(){const t=this.source.getAttributeByName("arrow-style").target;this.dasharray=t.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.stroke=t.getAttributeByName("stroke").target.getAttributeByName("value").target,this.stroke.register(this.projection),this.width=t.getAttributeByName("width").target,this.width.register(this.projection),this.linecap=t.getAttributeByName("linecap").target,this.linecap.register(this.projection)},bindSubPath(){},bindSubStyle(){}},zr=Object.assign(Object.create(Nr.Simulation),Rr),$r={init(){return this.width=460,this.height=220,this},render(){if((0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,t.isNullOrUndefined)(this.paths)){this.paths=[];for(let t=0;t<3;t++){let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("stroke","black"),t.setAttribute("fill","transparent"),this.container.append(t),this.paths.push(t)}}return this.bindEvents(),this.bindStyle(),this.container},setPath(e,i){if((0,t.isNullOrUndefined)(e)||(this.meet=e),(0,t.isNullOrUndefined)(i)||(this.offset=i),"free"===this.meet)return this.paths[0].remove(),this.paths[1].remove(),this.paths[2].remove(),void this.style();switch(this.container.append(this.paths[0]),this.container.append(this.paths[1]),this.container.append(this.paths[2]),this.meet){case"minX":this.paths[0].setAttribute("d","M "+(55+this.offset.x)+" 110 L 60 110"),this.paths[1].setAttribute("d","M "+(55+this.offset.x)+" 40 L 230 40"),this.paths[2].setAttribute("d","M "+(55+this.offset.x)+" 195 L 405 195");break;case"maxX":this.paths[0].setAttribute("d","M "+(405+this.offset.x)+" 110 L 60 110"),this.paths[1].setAttribute("d","M "+(405+this.offset.x)+" 35 L 230 110"),this.paths[2].setAttribute("d","M "+(405+this.offset.x)+" 190 L 405 190");break;case"minY":this.paths[0].setAttribute("d","M 110 "+(35+this.offset.y)+" 110 L 60 110"),this.paths[1].setAttribute("d","M 35 "+(35+this.offset.y)+" 35 L 230 110"),this.paths[2].setAttribute("d","M 190 "+(35+this.offset.y)+" 190 L 405 190");break;case"maxY":this.paths[0].setAttribute("d","M 110 "+(190+this.offset.y)+" 110 L 60 110"),this.paths[1].setAttribute("d","M 35 "+(190+this.offset.y)+" 35 L 230 110"),this.paths[2].setAttribute("d","M 190 "+(190+this.offset.y)+" 190 L 405 190")}this.style()},bindEvents(){this.projection.registerHandler("value.changed",(()=>{this.setPath()}))},style(){for(let e=0;e<3;e++)this.paths[e].setAttribute("stroke",this.stroke.value),this.paths[e].setAttribute("stroke-width",this.width.value),this.paths[e].setAttribute("stroke-linecap",this.linecap.value),(0,t.isNullOrUndefined)(this.dasharray.value)||(this.path.style["stroke-dasharray"]=this.dasharray.value)},bindStyle(){const t=this.source.getAttributeByName("arrow-style").target;this.dasharray=t.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.stroke=t.getAttributeByName("stroke").target.getAttributeByName("value").target,this.stroke.register(this.projection),this.width=t.getAttributeByName("width").target,this.width.register(this.projection),this.linecap=t.getAttributeByName("linecap").target,this.linecap.register(this.projection)}},Fr=Object.assign(Object.create(Nr.Simulation),$r),{isNullOrUndefined:qr,valOrDefault:Wr}=n(835),Xr={init(){return this},render(){return qr(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="anchor",this.container.dataset.id=this.id),qr(this.path)&&(this.path=us.call(this,{type:"attribute",name:"arrow-style",tag:"simulation-wider"}),this.container.append(this.path),this.path.setAttribute("x",25),this.path.setAttribute("y",0)),this.bindEvents(),this.container},bindEvents(){this.offSetX=this.source.getAttributeByName("offSet").target.getAttributeByName("x").target,this.offSetX.register(this.projection),this.offSetY=this.source.getAttributeByName("offSet").target.getAttributeByName("y").target,this.offSetY.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.path.setAttribute("x",25+Wr(this.offSetX.value,0)),this.path.setAttribute("y",Wr(this.offSetY.value,0))}))}},Yr=Object.assign(Object.create(Nr.Simulation),Xr),{isNullOrUndefined:Zr,valOrDefault:Gr,isEmpty:Jr}=n(835),Kr={init(){return this},render(){return Zr(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="anchor",this.container.dataset.id=this.id,this.container.setAttribute("width",250),this.container.setAttribute("height",250),this.middle={x:125,y:125},this.container.setAttribute("preserveAspectRatio","xMidYMid meet"),this.container.style="border: 2px solid black"),Zr(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.style.stroke="black",this.path.style["stroke-width"]=3,this.container.append(this.path),this.path.setAttribute("fill","transparent")),Zr(this.center)&&(this.center=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.center.setAttribute("cx",125),this.center.setAttribute("cy",125),this.center.setAttribute("fill","white"),this.center.setAttribute("stroke","#738CFF"),this.center.setAttribute("stroke-width",3),this.center.setAttribute("r",5),this.container.append(this.center)),this.bindEvents(),this.container},registerPoint(t){Zr(this.d)&&(this.d=[]),this.d.push(t),t.getAttributeByName("x").target.register(this.projection),t.getAttributeByName("y").target.register(this.projection)},drawPath(){(Zr(this.d)||Jr(this.d))&&this.path.setAttribute("d","");let t=this.middle.x,e=this.middle.y;this.minX=this.middle.x,this.minY=this.middle.y,this.maxX=this.middle.x,this.maxY=this.middle.y;let i="M "+t+" "+e;for(let n=0;n<this.d.length;n++){let r=this.d[n].getAttributeByName("x").target,s=this.d[n].getAttributeByName("y").target;t+=Gr(r,0),e+=Gr(s,0),i+=" L "+t+" "+e,this.minX>t&&(this.minX=t),this.maxX<t&&(this.maxX=t),this.minY>e&&(this.minY=e),this.maxY<e&&(this.maxY=e)}this.path.setAttribute("d",i),this.setDimensions()},setDimensions(){let t=Math.min(this.minX-5,0),e=Math.min(this.minY-5,0),i=Math.max(this.maxX+5-Math.min(this.minX-5,0),250),n=Math.max(this.maxY+5-Math.min(this.minY-5,0),250);this.container.setAttribute("viewBox",t+" "+e+" "+i+" "+n)},unregisterPoint(t){if(!Zr(this.d))for(let e=0;e<this.d.length;e++)if(d.id===t.id)return void this.d.splice(e,0)},bindEvents(){this.projection.registerHandler("value.added",(t=>{this.registerPoint(t)})),this.projection.registerHandler("value.removed",(t=>{this.unregisterPoint(t)})),this.projection.registerHandler("value.changed",(()=>{this.drawPath()}))}},Qr=Object.assign(Object.create(Nr.Simulation),Kr),{Simulation:ts}=n(127),es={init(){return this.depth=(0,t.valOrDefault)(20,this.source.getAttributeByName("depth").target.value),this.width=(0,t.valOrDefault)(400,this.source.getAttributeByName("width").target.value),this.height=(0,t.valOrDefault)(400,this.source.getAttributeByName("height").target.value),this},render(){if((0,t.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="tree",this.container.dataset.id=this.id,this.container.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,t.isNullOrUndefined)(this.nodeSpace)&&(this.nodeSpace=document.createElementNS("http://www.w3.org/2000/svg","g"),this.nodeSpace.classList.add("nodeSpace"),this.container.append(this.nodeSpace)),(0,t.isNullOrUndefined)(this.linkSpace)&&(this.linkSpace=document.createElementNS("http://www.w3.org/2000/svg","g"),this.linkSpace.classList.add("linkSpace"),this.container.prepend(this.linkSpace)),(0,t.isNullOrUndefined)(this.data)&&(this.data=[{id:0,children:[{id:1,children:[{id:2},{id:3}]},{id:4,children:[{id:5}]}]}]),(0,t.isNullOrUndefined)(this.tree))switch(this.orientation){case"vertical":this.tree=d3.layout.tree().size([this.width,this.height]);break;default:this.tree=d3.layout.tree().size([this.height,this.width])}return this.bindEvents(),this.container},update(){switch(this.svg=d3.select("#"+this.id),this.direction.value){case"horizontal":this.updateHorizontal();break;case"vertical":this.updateVertical()}},updateHorizontal(){var t=d3.svg.diagonal().projection((function(t){return[t.y,t.x]}));let e=this.data[0];e.x0=this.width/2,e.y0=50;let i=this.tree.nodes(e),n=this.tree.links(i);const r=this.depth.value;i.forEach((function(t){t.y=t.depth*r+40}));var s=this.svg.select("g.nodeSpace").selectAll("g.node").data(i);s.enter().append("g").attr("class","node").attr("transform",(function(t){return"translate("+e.y0+", "+e.x0+")"})).append("circle").attr("fill","red").attr("r",12.5),s.transition().duration(500).attr("transform",(function(t){return"translate("+t.y+", "+t.x+")"})),s.exit().transition().attr("transform",(function(t){return"translate("+e.y+", "+e.x+")"})).remove(),i.forEach((function(t){t.x0=t.x,t.y0=t.y}));var a=this.svg.select("g.linkSpace").selectAll("path.link").data(n);a.enter().insert("path","g").attr("class","link").attr("fill","none").attr("stroke","black").attr("stroke-width",2).attr("d",(function(i){var n={x:e.x0,y:e.y0};return t({source:n,target:n})})),a.transition().duration(500).attr("d",t),a.exit().transition().duration(500).attr("d",(function(i){var n={x:e.x,y:e.y};return t({source:n,target:n})})).remove()},bindEvents(){this.depth=this.source.getAttributeByName("depth").target,this.depth.register(this.projection),this.direction=this.source.getAttributeByName("direction").target,this.direction.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.update()})),this.projection.registerHandler("displayed",(()=>{this.update()}))}},is=Object.assign(Object.create(ts),es);var ns=0;const rs=()=>"algo"+ns++,ss={force:(t,e,i)=>Object.create(Cr,{object:{value:"simulation"},name:{value:"force-simulation"},type:{value:"force"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),arrow:(t,e,i)=>Object.create(Sr,{object:{value:"simulation"},name:{value:"arrow-simulation"},type:{value:"arrow"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),text:(t,e,i)=>Object.create(Tr,{object:{value:"simulation"},name:{value:"text-simulation"},type:{value:"text"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),selection:(t,e,i)=>Object.create(Ir,{object:{value:"simulation"},name:{value:"selection-simulation"},type:{value:"selection"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),marker:(t,e,i)=>Object.create(Hr,{object:{value:"simulation"},name:{value:"marker-simulation"},type:{value:"marker"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),content:(t,e,i)=>Object.create(Pr,{object:{value:"simulation"},name:{value:"content-simulation"},type:{value:"content"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(t,e,i)=>Object.create(Br,{object:{value:"simulation"},name:{value:"pattern-simulation"},type:{value:"pattern"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),multi:(t,e,i)=>Object.create(zr,{object:{value:"simulation"},name:{value:"multi-simulation"},type:{value:"multi"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),"sub-path":(t,e,i)=>Object.create(Fr,{object:{value:"simulation"},name:{value:"subPath-simulation"},type:{value:"subPath"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),anchor:(t,e,i)=>Object.create(Yr,{object:{value:"simulation"},name:{value:"anchor-simulation"},type:{value:"anchor"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),set:(t,e,i)=>Object.create(Qr,{object:{value:"simulation"},name:{value:"set-simulation"},type:{value:"set"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),tree:(t,e,i)=>Object.create(is,{object:{value:"simulation"},name:{value:"tree-simulation"},type:{value:"tree"},id:{value:rs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}})},as={createSimulation(e,i,n){const{type:r}=i,s=ss[r];if((0,t.isNullOrUndefined)(s))throw new TypeError(`Missing handler: The '${r}' simulation could not be handled`);const a=s(e,i,n);if((0,t.isNullOrUndefined)(a))throw new Error(`Bad request: The '${r}' simulation could not be created`);return a.createSimulation=this.createSimulation,(0,t.isNullOrUndefined)(a.id)&&(a.id=rs()),a}};function os(t){return"property"===t.type?this.projection.concept.getProperty(t.name):t}function ls(i,n,r){const{tag:s,placeholder:a={},style:o,options:l,listen:h}=n;if(!r.hasAttribute(i)){let n=`Attribute '${i}' does not exist in the concept '${r.name}'`;return this.environment.notify(n,e.k$.ERROR),this.environment.addError({source:"projection",code:"attribute_not_found",message:n}),(0,t.createI)({hidden:!0},i)}(0,t.valOrDefault)(n.required,r.isAttributeRequired(i))&&!r.isAttributeCreated(i)&&r.createAttribute(i);const c={name:i,get created(){return r.isAttributeCreated(i)},schema:n,placeholder:(0,t.createI)({class:["projection-element"],hidden:!0},i),parent:this,projection:this.projection,element:null};if(this.projection.attributes.push(c),!c.created){const{content:e}=a;return c.placeholder=e?us.call(this,e,r,{focusable:!0}):(0,t.createI)({class:["projection-element","projection-element--placeholder"],tabindex:0,dataset:{object:"attribute",id:i}},`Add ${i}`),c.placeholder.addEventListener("click",(t=>{r.createAttribute(i),this.projection.resolveElement(c.element).focus()})),c.placeholder}{const{target:e,schema:n}=r.getAttributeByName(i);let a=this.projection.model.createProjection(e,s).init(l);if(h&&(a.listen=!0),a.parent=this.projection,a._style=o,c.element=a.render(),(0,t.isNullOrUndefined)(c.element))return(0,t.createI)({hidden:!0},i);a.element.parent=this}return c.element}function hs(e,i){const{value:n,placement:r}=e,{target:s,description:a}=i.getAttributeByName(n);let o=this.projection.model.createProjection(s,r.tag).init();o.parent=this.projection,o.render(),(0,t.isNullOrUndefined)(s.value)||o.element.initValue(s.value),o.element.parent=this;let l=n[0].toUpperCase()+n.substring(1);return o.element.attributeName=l,o.element}function cs(t,e){let i=this.projection.model.createProjection(e,t).init();return i.parent=this.projection,i.render(),i.element.parent=this,i.element.container}function us(e,i,n={}){if(e.kind)return ds.call(this,e,i,n);const r=(0,t.valOrDefault)(i,this.projection.concept);if("container"===e.type){let t=Ln(this.model,e,this.projection);return t.source=r,t.parent=this,t.init(n),this.model.registerLayout(t),t.render()}if("layout"===e.type){let t=Bs.createLayout(this.model,e.layout,this.projection);return t.source=r,t.parent=this,t.init(n),this.model.registerLayout(t),t.render()}if("field"===e.type){let t=_i.createField(this.model,e.field,this.projection);return t.parent=this,t.init(n),this.model.registerField(t),t.render()}if("static"===e.type){let t=An.createStatic(this.model,e.static,this.projection);return t.source=r,t.parent=this,t.init(n),this.model.registerStatic(t),t.render()}if("algorithm"===e.type){let t=Ar.createAlgo(this.model,e.algorithm,this.projection);return t.init(),this.model.registerAlgorithm(t),t.render()}if("simulation"===e.type){let t=as.createSimulation(this.model,e.simulation,this.projection);return t.init(),this.model.registerSimulation(t),t.render()}if("dynamic"===e.type)return us.call(this,e.dynamic,i,n);if("attribute"===e.type)return ls.call(this,e.name,e,r);if("svg-attribute"===e.type)return hs.call(this,e,r);if("external"===e.type)return cs.call(this,e.tag,r);if("g-fragment"===e.type){let t=e.name,i=this.model.getGFragmentSchema(t.toLowerCase());return(new DOMParser).parseFromString(i.content.content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement}if("template"===e.type){let r=e.name;"param"===r.type&&(r=this.projection.getParam(r.name));let s=this.model.getTemplateSchema(r);s.param&&(e.param&&s.param.forEach((t=>{Object.assign(t,e.param.find((e=>e.name===t.name)))})),this.projection.addParam(s.param));const a=(0,t.createDocFragment)();let o,l=Object.assign({template:s},n),h=!1;return s.content.forEach((t=>{a.append(us.call(this,t,i,l))})),h?o:a}if("projection"===e.type){const{tag:i,style:n,src:s,required:a=!1}=e;if(s&&"attribute"===s.type)return ls.call(this,s.name,e,r);const o={schema:e,placeholder:(0,t.createI)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return o.update=function(e,s,a){if(o.element&&(o.element.remove(),o.element=null),r.hasValue()){let e=r.getValue(!0),s=this.projection.model.createProjection(e,i).init();s.placeholder=o.placeholder,s.parent=this.projection,o.element=s.render(),o.placeholder&&o.placeholder.after(o.element),(0,t.isHTMLElement)(o.element)&&Jt.call(this.projection,o.element,n),s.element.parent=this.projection.element,this.projection.update("binding",s.element.container||s.element.element),s.update("displayed")}},r.register(o),o.update(),o.element||o.placeholder}if("property"===e.type){const{name:t}=e;return this.projection.concept.getProperty(t)}if("html"===e.type){const{html:i}=e;return(0,t.htmlToElement)(i)}if("raw"===e.type){const{raw:t}=e;return t}if("state"===e.type){let t={},r=me.call(this,t,e.state);return us.call(this,r.content,i,n)}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}function ds(e,i,n={}){const r=(0,t.valOrDefault)(i,this.projection.concept),{kind:s}=e;if("container"===s){let t=Ln(this.model,e,this.projection);return t.source=r,t.parent=this,t.init(n),this.model.registerLayout(t),t.render()}if("layout"===s){let t=Bs.createLayout(this.model,e,this.projection);return t.source=r,t.parent=this,t.init(n),this.model.registerLayout(t),t.render()}if("field"===s){let t=_i.createField(this.model,e,this.projection);return t.parent=this,t.init(n),this.model.registerField(t),t.render()}if("static"===s){let t=An.createStatic(this.model,e,this.projection);return t.source=r,t.parent=this,t.init(n),this.model.registerStatic(t),t.render()}if("attribute"===s||"dynamic"===s)return ls.call(this,e.name,e,r);if("template"===s){let r=e.name;"param"===r.type&&(r=this.projection.getParam(r.name));let s=this.model.getTemplateSchema(r);s.param&&(e.param&&s.param.forEach((t=>{Object.assign(t,e.param.find((e=>e.name===t.name)))})),this.projection.addParam(s.param));const a=(0,t.createDocFragment)();return s.content.forEach((t=>{a.append(us.call(this,t,i,n))})),a}if("projection"===s){const{tag:i,style:n,required:s=!1}=e,a={schema:e,placeholder:(0,t.createI)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return a.update=function(e,s,o){if(a.element&&(a.element.remove(),a.element=null),r.hasValue()){let e=r.getValue(!0),s=this.projection.model.createProjection(e,i).init();s.placeholder=a.placeholder,s.parent=this.projection,a.element=s.render(),a.placeholder&&a.placeholder.after(a.element),(0,t.isHTMLElement)(a.element)&&Jt.call(this.projection,a.element,n),s.element.parent=this.projection.element}},r.register(a),a.update(),a.element||a.placeholder}if("property"===s){const{name:t}=e;return this.projection.concept.getProperty(t)}if("html"===s){const{html:i}=e;return(0,t.htmlToElement)(i)}if("raw"===s){const{raw:t}=e;return t}if("state"===s){let t={},r=me.call(this,t,e.state);return us.call(this,r.content,i,n)}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}const ps={HORIZONTAL:"horizontal",VERTICAL:"vertical"},fs=[{concept:{name:"stack-layout"},type:"layout",tags:[],projection:{type:"stack",orientation:"vertical",disposition:[{type:"attribute",name:"orientation"}]}}],ms={orientation:null,args:null,init(t={}){const{orientation:e=ps.HORIZONTAL,editable:i=!0,focusable:n=!1}=this.schema;return this.orientation=e,this.focusable=n,this.editable=i,this.elements=[],this.children=[],this.args=t,Object.assign(this,t),this},getOrientation(){return this.orientation},setOrientation(t){this.orientation=t,this.refresh()},render(){const{disposition:e,style:i,help:n}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const r=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["layout-container","stack-layout"],title:n,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let t=0;t<e.length;t++){let i=us.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),r.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Jt.call(this.projection,this.container,i),r.hasChildNodes()&&(this.container.append(r),this.bindEvents()),this.container.style.display="flex",this.container.style.flexWrap="nowrap",this.refresh(),this.container},design(){return{concept:[{name:"stack-layout",nature:"concrete",attributes:[{name:"orientation",target:{name:"string",default:this.orientation,constraint:{values:["horizontal","vertical"]}}}]}],projection:fs,handlers:{orientation:(t,e)=>{this.setOrientation(e)}}}},refresh(){return this.orientation===ps.VERTICAL?this.container.style.flexDirection="column":this.orientation===ps.HORIZONTAL&&(this.container.style.flexDirection="row"),this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,t.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,t.isNullOrUndefined)(e))return!1;let i=this.environment.resolveElement(e);i&&i.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(t=>{const{target:e}=t,{prop:i}=e.dataset;"orientation"===i&&this.setOrientation(e.value)})),this.projection.registerHandler("view.changed",((t,e)=>{e&&e.parent===this.projection&&(t.parent=this)}))}},gs=Object.assign({},Nn,ms),vs={args:null,init(t={}){const{editable:e=!0,focusable:i=!1}=this.schema;return this.focusable=i,this.editable=e,this.elements=[],this.children=[],this.args=t,Object.assign(this,t),this},render(){const{disposition:e,style:i,help:n}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const r=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["layout-container"],title:n,dataset:{nature:"layout",layout:"wrap",id:this.id}}));for(let t=0;t<e.length;t++){let i=us.call(this,e[t],this.source,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),r.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Jt.call(this.projection,this.container,i),r.hasChildNodes()&&(this.container.append(r),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="inline-flex",this.container.style.alignItems="baseline",this.refresh(),this.container},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,t.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,t.isNullOrUndefined)(e))return!1;let i=this.environment.resolveElement(e);i&&i.focus(e)}},bindEvents(){this.projection.registerHandler("view.changed",((t,e)=>{e&&e.parent===this.projection&&(t.parent=this)}))}},bs=Object.assign({},Nn,vs),ys={elements:null,edit:!1,btnEdit:!1,btnCollapse:!1,menu:!1,collapsed:!1,init(t={}){const{editable:e=!0,collapsible:i=!1,focusable:n=!1}=this.schema;return this.focusable=n,this.collapsible=i,this.editable=e,this.elements=[],this.children=[],Object.assign(this,t),this},collapse(e){if(!this.collapsed)return this.collapseContainer=(0,t.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e){if(!this.collapsed)return;let i=(0,t.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!0,this.refresh(),this},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},render(){const{disposition:e,style:i,help:n}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const r=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"table"}})),this.focusable?this.container.tabIndex=-1:this.container.dataset.ignore="all";for(let i=0;i<e.length;i++){let n=e[i],s=(0,t.createDiv)({class:["table-row"]});s.style.display="table-row";for(let e=0;e<n.length;e++){const i=n[e];let r=(0,t.createDiv)({class:["table-cell"]},us.call(this,i.content));r.style.display="table-cell",Jt.call(this.projection,r,i.style),s.append(r)}r.append(s)}return Jt.call(this.projection,this.container,i),r.hasChildNodes()&&(this.container.append(r),this.bindEvents()),this.container.style.display="table",this.refresh(),this.container},bindEvents(){this.projection.registerHandler("view.changed",((t,e)=>{e&&e.parent===this.projection&&(t.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(t=>{this.collapsed?this.expand():this.collapse()}))}},ws=Object.assign({},Nn,ys),xs={ROW:"row",COLUMN:"column"},Es={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},As={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"},Ns={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(t={}){const{orientation:e=xs.ROW,wrappable:i=!0,alignItems:n,justifyContent:r,editable:s=!0,focusable:a=!1}=this.schema;return this.orientation=e,this.wrappable=i,this.alignItems=n,this.justifyContent=r,this.focusable=a,this.editable=s,this.elements=[],this.children=[],this.args=t,Object.assign(this,t),this},getOrientation(){return this.orientation},setOrientation(e){(0,t.hasOwn)(xs,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=(0,t.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let i=(0,t.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(i),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:e,style:i,help:n}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const r=(0,t.createDocFragment)();(0,t.isHTMLElement)(this.container)||(this.container=(0,t.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),n&&(this.container.title=n);for(let t=0;t<e.length;t++){let i=us.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),r.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",Jt.call(this.projection,this.container,i),r.hasChildNodes()&&(this.container.append(r),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=As[this.justifyContent],this.container.style.alignItems=Es[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,t.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,t.isNullOrUndefined)(e))return!1;let i=this.environment.resolveElement(e);i&&i.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(t=>{const{target:e}=t,{prop:i}=e.dataset;"orientation"===i&&this.setOrientation(e.value)})),this.projection.registerHandler("view.changed",((t,e)=>{e&&e.parent===this.projection&&(t.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(t=>{this.collapsed?this.expand():this.collapse()}))}},Os=Object.assign({},Nn,Ns),Ms={content:"",init(){return this},render(){const e=(0,t.createDocFragment)(),{content:i,attributes:n=[],link:r,dimensions:s={}}=this.schema;var a=new DOMParser;return(0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,class:[],dataset:{nature:"layout",view:"svg",id:this.id}})),this.element.setAttribute("tabIndex",0),this.focusable=!0,!(0,t.isHTMLElement)(this.content)&&i?(this.content=a.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)):(0,t.isHTMLElement)(this.content)||(this.content=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.appendChild(this.content)),(0,t.isEmpty)(n)||n.forEach((t=>{let e=us.call(this,t.attribute);this.environment.resolveElement(e),t.marker?this.content.querySelector("[data-"+t.marker+"]").append(e):this.content.append(e)})),s.type&&(this.dimensions=s),e.hasChildNodes()&&this.element.appendChild(e),this.element},getWidth(){return Number(this.content.getAttribute("width"))},getHeight(){return Number(this.content.getAttribute("height"))},registerDimObsever(e){(0,t.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(e)},attributeHandler(t,e){switch(t.type){case"interactive":this.content.querySelector("[data-"+e+"]").append(t.content);break;case"text-svg":case"choice":break;default:let i=this.content.querySelector("[data-"+e+"]");t.element.append(t.element);let n=this.createHolder(t.element);i.append(n),this.adapt(t.element,t.ratio)}},createHolder(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreign");i.append(t),e.append(i)},adapt(e,i){let n=e.getBoundingClientRect();e.parentNode.setAttribute("width",n.width),e.parentNode.setAttribute("height",n.height);let r=e.parentNode.parentNode;if(!(0,t.isNullOrUndefined)(i)){let t=this.content.width.baseVal.value;this.content.height.baseVal.value,r.setAttribute("width",t*i),r.setAttribute("height",t*i)}},_attributeHandler(e){let i=[];return e.forEach((e=>{switch(e.placement.type){case"in-place":let n=this.content.querySelector("[data-"+e.placement.marker+"]");e.type="svg-attribute";let r=us.call(this,e,null,this.args);(0,t.isNullOrUndefined)(e.property)||(r.property=propertyHandler(e.property)),i.push(r),n.appendChild(r.content);break;case"link-place":let{type:s,sd:a=[],dd:o=[]}=e.placement;(0,t.isNullOrUndefined)(this.linkAttr)&&(this.linkAttr=[]);let l={};l.name=e.value,l.field=this.informations.get(e.value),"list"===l.field.type?l.value=l.field.items:l.value=l.field.value,(0,t.isNullOrUndefined)(e.property)||(l.property=propertyHandler(e.property)),(0,t.isEmpty)(a)||(l.sd=new Map,a.forEach((t=>{t.type="template";const e={};var i=us.call(this,t,null,this.args);e.render=i,e.parent=this.content.querySelector("[data-"+t.marker+"]"),l.sd.set(i.mv,e)}))),!(0,t.isNullOrUndefined)(this.dd)||(0,t.isEmpty)(o)||(0,t.isNullOrUndefined)(o)||(l.dd=[],o.forEach((e=>{e.type="template";var i=us.call(this,e,null,this.args);l.dd.push(i),i.property=l.property;var n=this.content.querySelector("[data-"+e.marker+"]");(0,t.isNullOrUndefined)(n)?"before"===this.content.getAttribute("data-"+e.marker)?this.content.prepend(i.content):this.content.appendChild(i.content):"before"===n.getAttribute("data-"+e.marker)?n.prepend(i.content):n.appendChild(i.content)}))),this.linkAttr.push(l)}})),i},update(){(0,t.isNullOrUndefined)(this.linkAttr)||this.linkAttr.forEach((e=>{this.clearStatics(e.sd,e.value),(0,t.isNullOrUndefined)(e.property)?this.clearDynamics(e.dd,e.value):this.clearDynamics(e.dd,this.translateProperty(e.value,e.property)),"list"===e.field.type?e.value=e.field.items:e.value=e.field.value,(0,t.isNullOrUndefined)(e.property)?this.updateDynamics(e.dd,e.value):this.updateDynamics(e.dd,this.translateProperty(e.value,e.property)),this.updateStatics(e.sd,e.value)})),(0,t.isNullOrUndefined)(this.deciders)||(0,t.isEmpty)(this.deciders)||this.deciders.forEach((t=>{t.update(t.field.value)}))},clearDynamics(e,i){(0,t.isNullOrUndefined)(e)||e.forEach((t=>{t.clear(i)}))},updateDynamics(e,i){(0,t.isNullOrUndefined)(e)||e.forEach((t=>{t.update(i)}))},clearStatics(e,i){if(!(0,t.isNullOrUndefined)(e)){let n=e.get(i);(0,t.isNullOrUndefined)(n)||n.parent.removeChild(n.render.content)}},updateStatics(e,i){if(!(0,t.isNullOrUndefined)(e)){let n=e.get(i);(0,t.isNullOrUndefined)(n)||n.parent.appendChild(n.render.content)}},focus(){return this.element.focus(),this.focused=!0,(0,t.isNullOrUndefined)(this.deciders)||this.deciders.forEach((t=>{t.focusOut()})),this},focusIn(){return this.focus(),this},focusOut(){return this.focused=!1,this},arrowHandler(e,i){if(i===this.element)return!(0,t.isNullOrUndefined)(this.parent)&&this.parent.arrowHandler(e,this.element);let n=getClosestSVG(i.foreign,e,this,!1);return!(0,t.isNullOrUndefined)(n)&&(i.focusOut(),n.focus(),!0)},enterHandler(t){this.index=0,this.deciders[0].focusIn()},escapeHandler(e){if(e!==this.element)return this.focus();let i=(0,t.findAncestor)(e,(t=>0===t.tabIndex)),n=this.environment.resolveElement(i);return n&&n.focus(i),!1},getDimensions(){switch(this.dimensions.type){case"absolute":return{height:this.dimensions.height,width:this.dimensions.width}}},setIndex(t){let e=0;this.deciders.forEach((i=>{i.id!==t.id?e++:this.index=e}))}},js=Object.assign(Object.create(Nn),Ms);function Cs(e){const{placeholder:i="",type:n}=e;let r=os.call(this,i);return this.readonly||this.resizable?(0,t.createSpan)({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:r,dataset:{placeholder:r,nature:"field-component",view:this.type,id:this.id}}):this.multiline?(0,t.createTextArea)({class:["field--textbox__input"],placeholder:r,title:r,dataset:{nature:"field-component",view:this.type,id:this.id}}):(0,t.createInput)({class:["field--textbox__input"],type:(0,t.valOrDefault)(n,"text"),placeholder:r,title:r,dataset:{nature:"field-component",view:this.type,id:this.id}})}const Ls={init(){return this},render(){const e=(0,t.createDocFragment)(),{current:i={},root:n}=this.schema;this.isRoot=n;var r=new DOMParser;if((0,t.isHTMLElement)(this.element)||(this.element=(0,t.createDiv)({id:this.id,dataset:{nature:"layout",view:"visualizer",id:this.id}})),!(0,t.isHTMLElement)(this.content)&&(this.svg=this.source.value,!(0,t.isNullOrUndefined)(this.svg))){if(this.content=r.parseFromString(this.svg.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,"svg"!==this.content.tagName){let t=r.parseFromString('<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"/>',"image/svg+xml").documentElement;t.appendChild(this.content),this.content=t}e.appendChild(this.content)}if(!(0,t.isHTMLElement)(this.input)){const{placeholder:t="",type:n,style:r}=i;this.input=Cs.call(this,i),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",Jt.call(this,this.input,r),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}if(n&&(0,t.isNullOrUndefined)(this.buttons)){this.buttons=[];const t={type:"static",static:{type:"button",trigger:"make interactive",content:[{type:"static",static:{type:"text",content:"Interactive",focusable:!0}}]}};this.mkeInteractive=us.call(this,t,null,this.args);let i=this.environment.resolveElement(this.mkeInteractive);i.parent=this,i.visualizer=this,this.buttons.push(i),e.append(this.mkeInteractive);const n={type:"static",static:{type:"button",trigger:"make dynamic",content:[{type:"static",static:{type:"text",content:"Dynamic",focusable:!0}}]}};this.mkeDynamic=us.call(this,n,null,this.args),i=this.environment.resolveElement(this.mkeDynamic),i.visualizer=this,i.parent=this,this.buttons.push(i),e.append(this.mkeDynamic);const r={type:"static",static:{type:"button",trigger:"make static",content:[{type:"static",static:{type:"text",content:"Static",focusable:!0}}]}};this.mkeStatic=us.call(this,r,null,this.args),i=this.environment.resolveElement(this.mkeStatic),i.visualizer=this,i.parent=this,this.buttons.push(i),e.append(this.mkeStatic)}return e.hasChildNodes()&&this.element.appendChild(e),this.bindEvent(),this.element},focusIn(t){return this.input.focus()},focusOut(){},createProj(){let t=this.current;"tspan"===t.tagName.toLowerCase()&&(t=t.parentNode);let e=new XMLSerializer;return this.cleanInput(),this.updateInput(e.serializeToString(this.content)),'<g xmlns="http://www.w3.org/2000/svg">'+e.serializeToString(t)+"</g>"},cleanInput(){this.input.value="",this.current.parentNode.removeChild(this.current)},updateInput(t){this.source.setValue(t)},bindEvent(){this.content.addEventListener("click",(t=>{var e=new XMLSerializer;let i=t.target;"tspan"===i.tagName.toLowerCase()&&(i=i.parentNode);var n=e.serializeToString(i);this.input.value=n,this.current=i})),this.input.addEventListener("keydown",(e=>{if(""!==this.input.value&&!(0,t.isNullOrUndefined)(this.current)&&"Enter"===e.key){var i=(new DOMParser).parseFromString(this.input.value.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement;this.current!==this.content?this.current.replaceWith(i):this.content=i,this.current=i;var n=new XMLSerializer;this.isRoot?this.updateInput(n.serializeToString(this.content)):this.updateInput(n.serializeToString(this.content.childNodes[0]))}}))}},Ss=Object.assign(Object.create(Nn),Ls),{createDocFragment:ks,isNullOrUndefined:Ts,isEmpty:Us,isHTMLElement:Is}=n(835),_s={init(){const{coordinates:t=null,dimensions:e=null}=this.schema;return this.coordinates=t,this.dimensions=e,this},render(){const{content:t}=this.schema,e=ks();return Ts(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("layout-container"),this.container.dataset.nature="layout",this.container.dataset.layout="holder",this.container.dataset.id=this.id),Ts(this.foreign)&&(this.foreign=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),e.append(this.foreign)),Ts(this.content)&&!Us(t)&&(this.content=new Map,t.forEach((t=>{switch(t.type){case"projection":let e=this.projection.model.createProjection(this.projection.concept.getValue(!0),t.tag).init().render(),i=this.projection.resolveElement(e);this.element=e,this.foreign.append(e),this.content.set(t.correspondance,{render:e,projection:i});break;case"attribute":this.container.append(us.call(this,t))}}))),e.hasChildNodes()&&this.container.append(e),this.bindEvents(),this.container},registerRelative(t){switch(this.apply=t.apply,this.relative=!0,t.listen.type){case"duo":this.from=this.source.getValue(!0).getAttributeByName(t.listen.from).target,this.from.register(this.projection),this.to=this.source.getValue(!0).getAttributeByName(t.listen.to).target,this.to.register(this.projection),this.rtag=this.environment.getActiveReceiver(t.rtag)}},adapt(){},getDimensions(){return{width:this.dimensions.width,height:this.dimensions.height}},placeItem(t){switch(this.coordinates.type){case"delegate":this.container.setAttribute("x",t.schema.coordinates.x),this.container.setAttribute("y",t.schema.coordinates.y)}},setDimensions(){if(this.relative){let t=this.rtag.container.querySelector('[data-concept="'+this.from.value+'"]'),e=this.rtag.container.querySelector('[data-concept="'+this.to.value+'"]'),i=this.rtag.container.createSVGPoint(),n=t.getBoundingClientRect();i.x=n.x,i.y=n.y;let r=i.matrixTransform(this.rtag.container.getScreenCTM().inverse());n=e.getBoundingClientRect(),i.x=n.x,i.y=n.y;let s=i.matrixTransform(this.rtag.container.getScreenCTM().inverse()),a=r.x-s.x,o=r.y-s.y,l=Math.sqrt(a*a+o+o);this.width=l,this.container.setAttribute("width",this.width),this.container.setAttribute("height",30),this.foreign.setAttribute("width",this.width),this.foreign.setAttribute("height",30),this.container.setAttribute("x",r.x),this.container.setAttribute("y",r.y),this.projection.resolveElement(this.element).setDimensions(this.width)}else this.adapt(),this.parent.notify(this.container)},setHolder(t,e){this.container.setAttribute("width",t),Ts(e)?this.container.setAttribute("height",t*this.height/this.width):this.container.setAttribute("height",e)},bindEvents(){this.projection.registerHandler("value.changed",(t=>{})),this.projection.registerHandler("displayed",(t=>{let{render:e,projection:i}=this.content.get(this.source.value);this.element=e,this.foreign.append(this.element),this.setDimensions(),this.coordinates&&this.placeItem(i)}))}},Hs=Object.assign(Object.create(Nn),_s);var Ds=0;const Ps=()=>"layout"+Ds++,Vs={stack:(t,e,i)=>Object.create(gs,{object:{value:"layout"},name:{value:"stack-layout"},type:{value:"stack"},id:{value:Ps()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),wrap:(t,e,i)=>Object.create(bs,{object:{value:"layout"},name:{value:"wrap-layout"},type:{value:"wrap"},id:{value:Ps()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),table:(t,e,i)=>Object.create(ws,{object:{value:"layout"},name:{value:"table-layout"},type:{value:"table"},id:{value:Ps()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),flex:(t,e,i)=>Object.create(Os,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:Ps()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),svg:(t,e,i)=>Object.create(js,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:Ps()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),visualizer:(t,e,i)=>Object.create(Ss,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:Ps()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(t,e,i)=>Object.create(Hs,{object:{value:"layout"},name:{value:"holder-layout"},type:{value:"holder"},id:{value:Ps()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}})},Bs={createLayout(e,i,n){const{type:r}=i,s=Vs[r];if((0,t.isNullOrUndefined)(s))throw new TypeError(`Missing handler: The '${r}' layout could not be handled`);const a=s(e,i,n);if((0,t.isNullOrUndefined)(a))throw new Error(`Bad request: The '${r}' layout could not be created`);return a.createLayout=this.createLayout,(0,t.isNullOrUndefined)(a.id)&&(a.id=Ps()),a}},Rs={stylePath(e){const{stroke:i="black",dasharray:n=null,width:r=1,linecap:s="butt",end:a=!1,start:o=!1}=e;this.path.style.stroke=i,(0,t.isNullOrUndefined)(n)||(this.path.style["stroke-dasharray"]=n),this.path.style["stroke-width"]=(0,t.valOrDefault)(r,5),this.path.style["stroke-linecap"]=s,a&&this.createMarkerEnd()},styleSubPath(e,i){const{stroke:n="black",dasharray:r=null,width:s=1,linecap:a="butt",end:o=!1,start:l=!1}=e;i.style.stroke=n,(0,t.isNullOrUndefined)(r)||(i.style["stroke-dasharray"]=r),i.style["stroke-width"]=(0,t.valOrDefault)(s,5),i.style["stroke-linecap"]=a},createMarkerEnd(){(0,t.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.end=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.end.id="marker"+this.id,this.end.setAttribute("refY",5),this.end.setAttribute("refX",10),this.end.setAttribute("markerUnit","strokeWidth"),this.end.setAttribute("markerWidth",10),this.end.setAttribute("markerHeight",10),this.end.setAttribute("orient","auto"),this.end.classList.add("end");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.end.appendChild(e),this.definitions.appendChild(this.end),this.path.setAttribute("marker-end","url(#"+this.end.id+")")},setPath(t){this.path.setAttribute("d",t)}},zs={init(){return this},render(){const{aiming:e,model:i,move:n,decorator:r=!1,style:s}=this.schema;return(0,t.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="anchor",this.path.dataset.id=this.id),(0,t.isNullOrUndefined)(this.aiming)&&(this.aiming=this.source.getAttributeByName(e.name).target),(0,t.isNullOrUndefined)(this.anchorModel)&&(this.anchorModel=i,Ke.AnchorHandler.registerListener(i,this)),n&&(this.movingPiece=this.source.getAttributeByName(n.name).target,this.movingPiece.register(this)),r&&(0,t.isNullOrUndefined)(this.decorator)&&this.createDecorator(r),this.bind=this.projection.bind,this.bindEvents(),this.stylePath(s),this.path},update(){if(!(0,t.isNullOrUndefined)(this.movingPiece)&&this.movingPiece.hasValue()){let e=this.movingPiece.getValue();(0,t.isString)(e)&&(e=this.movingPiece.getValue(!0)),e.notify("accept",this.bind),(0,t.isNullOrUndefined)(this.path.parenNode)||e.notify("cover",this)}},deleteFromView(){Ke.AnchorHandler.unregister(this.anchorModel,this),this.movingPiece=null,this.path.remove(),this.decorator.remove()},createDecorator(t){this.decorator=us.call(this,t.render)},updateValue(){if(!this.aiming.hasValue())return this.path.remove(),this.decorator.remove(),void this.definitions.remove();let e=this.aiming.value.id||this.aiming.value,i=Ke.AnchorHandler.findSource(this.anchorModel,this.bind.element||this.bind.container),n=Ke.AnchorHandler.findTarget(this.anchorModel,e,i.index);if(this.schema.offset&&(i.x+=this.schema.offset.x,i.y+=this.schema.offset.y,n.x+=this.schema.offset.x,n.y+=this.schema.offset.y),this.decorator){const{origin:t,x:e,y:r}=this.schema.decorator.coordinates;switch(t){case"source":this.decorator.setAttribute("x",i.x+e),this.decorator.setAttribute("y",i.y+r),this.projection.parent.container.append(this.decorator);break;case"target":this.decorator.setAttribute("x",n.x+e),this.decorator.setAttribute("y",n.y+r),this.projection.parent.container.append(this.decorator);break;case"minX":i.x<n.x?(this.decorator.setAttribute("x",i.x+e),this.decorator.setAttribute("y",i.y+r)):(this.decorator.setAttribute("x",n.x+e),this.decorator.setAttribute("y",n.y+r)),this.projection.parent.container.append(this.decorator);break;case"minY":i.y<n.y?(this.decorator.setAttribute("x",i.x+e),this.decorator.setAttribute("y",i.y+r)):(this.decorator.setAttribute("x",n.x+e),this.decorator.setAttribute("y",n.y+r)),this.projection.parent.container.append(this.decorator);break;case"maxX":i.x>n.x?(this.decorator.setAttribute("x",i.x+e),this.decorator.setAttribute("y",i.y+r)):(this.decorator.setAttribute("x",n.x+e),this.decorator.setAttribute("y",n.y+r)),this.projection.parent.container.append(this.decorator);break;case"maxY":i.y>n.y?(this.decorator.setAttribute("x",i.x+e),this.decorator.setAttribute("y",i.y+r)):(this.decorator.setAttribute("x",n.x+e),this.decorator.setAttribute("y",n.y+r)),this.projection.parent.container.append(this.decorator)}}if(i.x===n.x&&i.y===n.y?this.setSelfPath(i):this.setPath("M "+i.x+" "+i.y+" L "+n.x+" "+n.y),this.definitions&&this.projection.parent.container.append(this.definitions),this.projection.parent.container.prepend(this.path),this.decorator&&this.environment.resolveElement(this.decorator).projection.update("displayed"),this.calcS=i.calc,this.calcT=n.calc,this.movingPiece&&this.movingPiece.hasValue()){let e=this.movingPiece.value;(0,t.isString)(e)&&(e=this.movingPiece.getValue(!0)),e.notify("cover",this)}},setSelfPath(t){const e=this.schema.self.points;let i={x:t.x,y:t.y},n="M "+t.x+" "+t.y+" ";for(let t=0;t<e.length;t++){const{x:r,y:s}=e[t];n+=" L "+(i.x+r)+" "+(i.y+s)+" ",i.x+=r,i.y+=s}this.path.setAttribute("d",n),this.path.setAttribute("fill","transparent")},bindEvents(){this.aiming.register(this.projection),this.projection.registerHandler("value.changed",(t=>{this.updateValue(t)}))}},$s=Object.assign({},Rs,zs),Fs={init(){return this},render(){const{style:e,from:i,to:n,decorator:r}=this.schema;return(0,t.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="force",this.path.dataset.id=this.id),(0,t.isNullOrUndefined)(this.from)&&this.registerAttribute(i,!0),(0,t.isNullOrUndefined)(this.to)&&this.registerAttribute(n),e&&this.stylePath(e),r&&(0,t.isNullOrUndefined)(this.decorator)&&(this.decorator=us.call(this,r)),this.bindEvents(),this.path},registerAttribute(t,e=!1){const{name:i}=t;e?this.from=this.source.getAttributeByName(i).target:this.to=this.source.getAttributeByName(i).target},updateValue(){this.fromVal=this.from.value,this.toVal=this.to.value,(0,t.isNullOrUndefined)(this.fromVal)||(0,t.isNullOrUndefined)(this.toVal)?(0,t.isNullOrUndefined)(this.path.parentNode)||this.projection.parent.removeArrow(this,-1,this.decorator):this.projection.parent.addArrow(this,this.fromVal,this.toVal,this.decorator)},setPath(t){this.path.setAttribute("d",t)},bindEvents(){this.from.register(this.projection),this.to.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateValue()}))}},qs=Object.assign({},Rs,Fs),Ws={minY:function(t){let e=t[0].y,i=t[0].x,n=t[0].x;for(let r=0;r<t.length;r++){const{x:s,y:a}=t[r];s<i&&(i=s),s>n&&(n=s),a<e&&(e=a)}this.setPath("M "+i+" "+e+" L "+n+" "+e),this.drawSupPath(t,e,!1)}},Xs={init(){return this.subPath=[],this.targets=[],this.elements=[],this},render(){const{style:e}=this.schema;return(0,t.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="multi",this.path.dataset.id=this.id),this.bindEvents(),this.stylePath(e),this.path},addTarget(t){this.targets=[],this.elements.forEach((t=>{t.hasValue()&&this.targets.push(t.getValue())})),this.targets.length>1&&(this.drawPath(),this.projection.parent.container.append(this.path),this.subPath.forEach((t=>{this.projection.parent.container.append(t)})))},drawSupPath(e,i,n){(0,t.isEmpty)(this.subPath)||(this.subPath.forEach((t=>{t.remove()})),this.subPath=[]),e.forEach((t=>{if(t.y===i&&!n)return;if(t.x===i&&n)return;let e=document.createElementNS("http://www.w3.org/2000/svg","path");this.path.classList.add("arrow-subpath"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="multi",this.path.dataset.id=this.id,n||e.setAttribute("d","M "+t.x+" "+i+" L "+t.x+" "+t.y),this.styleSubPath(this.schema.subpath.style,e),this.subPath.push(e)}))},drawPath(){const e=this.projection.parent.container;let i=[];for(let n=0;n<this.targets.length;n++){const r=this.targets[n];let s=e.querySelector("[data-concept='"+r+"']"),a=this.projection.resolveElement(s);if((0,t.isNullOrUndefined)(s))return;i.push({item:s,proj:a})}let n=[];for(let r=0;r<i.length;r++){let s=i[r].item.getBoundingClientRect();const a=e.createSVGPoint();a.x=s.x,a.y=s.y;const o=a.matrixTransform(e.getScreenCTM().inverse());(0,t.isNullOrUndefined)(i[r].proj.attachPoint)?n.push({x:o.x,y:o.y}):n.push({x:o.x+i[r].proj.attachPoint.x,y:o.y+i[r].proj.attachPoint.y})}Ws[this.schema.meet].call(this,n)},removeTarget(e){(0,t.isNullOrUndefined)(this.targets)},registerElem(e){(0,t.isNullOrUndefined)(this.elements)&&(this.elements=[]),this.elements.push(e),e.register(this.projection)},unregisterElem(e){for(let t=0;t<this.elements.length;t++)if(this.elements[t]===e){this.elements[t].unregister(this.projection),this.elements.splice(t,1);break}this.elements.length>1?this.addTarget():(this.path.remove(),(0,t.isEmpty)(this.subPath)||this.subPath.forEach((t=>{t.remove()})))},deletePaths(){this.path.remove(),(0,t.isEmpty)(this.subPath)||this.subPath.forEach((t=>{t.remove()}))},bindEvents(){this.projection.registerHandler("value.added",(t=>{this.registerElem(t)})),this.projection.registerHandler("value.removed",(t=>{this.unregisterElem(t)})),this.projection.registerHandler("value.changed",(t=>{this.addTarget(t)}))}},Ys=Object.assign({},Rs,Xs);var Zs=0;const Gs=()=>"algo"+Zs++,Js={force:(t,e,i)=>Object.create(qs,{object:{value:"arrow"},name:{value:"force-arrow"},type:{value:"force"},id:{value:Gs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),anchor:(t,e,i)=>Object.create($s,{object:{value:"arrow"},name:{value:"anchor-arrow"},type:{value:"anchor"},id:{value:Gs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),multi:(t,e,i)=>Object.create(Ys,{object:{value:"arrow"},name:{value:"multi-arrow"},type:{value:"multi"},id:{value:Gs()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}})},Ks={createArrow(e,i,n){const{type:r}=i,s=Js[r];if((0,t.isNullOrUndefined)(s))throw new TypeError(`Missing handler: The '${r}' arrow could not be handled`);const a=s(e,i,n);if((0,t.isNullOrUndefined)(a))throw new Error(`Bad request: The '${r}' arrow could not be created`);return a.createArrow=this.createArrow,(0,t.isNullOrUndefined)(a.id)&&(a.id=Gs()),a}},Qs={},{isNullOrUndefined:ta,valOrDefault:ea}=n(835),ia={init(){return this},render(){const{content:t}=this.schema;return ta(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="canas",this.container.dataset.id=this.id),ta(t)||t.forEach((t=>{this.container.append(us.call(this,t))})),this.w=this.source.getAttributeByName("width").target,this.h=this.source.getAttributeByName("height").target,this.minX=this.source.getAttributeByName("minX").target,this.minY=this.source.getAttributeByName("minY").target,this.windowW=this.source.getAttributeByName("windowW").target,this.windowH=this.source.getAttributeByName("windowH").target,this.container.style.border="solid #87a1ff",this.refresh(),this.bindEvents(),this.container},refresh(){this.container.setAttribute("width",this.w.value),this.container.setAttribute("height",this.h.value);const t=ea(this.windowW.value,this.w.value),e=ea(this.windowH.value,this.h.value);this.container.setAttribute("viewBox",this.minX.value+" "+this.minY.value+" "+t+" "+e)},update(){this.refresh()},bindEvents(){this.w.register(this),this.h.register(this),this.minX.register(this),this.minY.register(this),this.windowW.register(this),this.windowH.register(this),this.container.addEventListener("click",(t=>{const e=t.target,{concept:i=null,nature:n=null,shape:r=null}=e.dataset;ta(n)||"shape"!==n||"canvas"===r||this.source.getAttributeByName("current").setValue(i)}))},focusIn(){},focusOut(){},clickHandler(t){}},na=Object.assign(Object.create(Qs),ia),{isNullOrUndefined:ra,isEmpty:sa}=n(835),aa={init(){return this.items=[],this},render(){const{add:t}=this.schema;return ra(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="group",this.container.dataset.id=this.id),t&&(this.addButton=us.call(this,{kind:"static",type:"svg-button",action:{type:"CREATE"},content:'<svg style="overflow:visible" xmlns="http://www.w3.org/2000/svg" version="1.0"><text style="dominant-baseline:hanging;" font-family="Segoe UI" font-size="16">+</text></svg>'}),this.container.append(this.addButton)),sa(this.source)||this.reconstruct(),this.bindEvents(),this.container},reconstruct(){let t=this.source.value;for(let e=0;e<t.length;e++){let i=this.projection.environment.conceptModel.getConcept(t[e]).getValue(!0),n=this.model.createProjection(i,"shape");n.parent=this.projection;let r=n.init().render();this.items.push({concept:n.concept,projection:r,centered:!0}),n.concept.register(this.projection),this.container.append(r),this.blur()}},createItem(t){let e=this.model.createProjection(t,"shape");e.parent=this.projection;let i=e.init().render();return this.items.push({concept:e.concept,projection:i,centered:!1}),e.concept.register(this.projection),this.blur(),i},addItem(t){let e=this.createItem(t);this.container.append(e)},removeItem(t){for(let e=0;e<this.items.length;e++)if(this.items[e].concept.id===t.id)return this.items[e].projection.remove(),ra(this.items[e].container)||this.items[e].container.remove(),void this.items.splice(e,1)},update(){for(let t=0;t<this.items.length;t++)this.items[t].centered||this.center(this.items[t]),this.items[t].centered=!0},center(t){const e=t.concept.getValue(!0),i=this.getWindow();switch(e.name){case"circle":e.getAttributeByName("cx").setValue((i.minX+i.vW)/2),e.getAttributeByName("cy").setValue((i.minY+i.vH)/2),e.getAttributeByName("r").setValue(20*i.vW/i.width);break;case"rectangle":const t=40*i.vW/i.width,n=30*i.vH/i.height;e.getAttributeByName("x").setValue((i.minX+i.vW)/2-t/2),e.getAttributeByName("y").setValue((i.minY+i.vH)/2-n/2),e.getAttributeByName("width").setValue(t),e.getAttributeByName("height").setValue(n);break;case"ellipse":const r=40*i.vW/(2*i.width),s=30*i.vH/(2*i.height);e.getAttributeByName("cx").setValue((i.minX+i.vW)/2),e.getAttributeByName("cy").setValue((i.minY+i.vH)/2),e.getAttributeByName("rx").setValue(r),e.getAttributeByName("ry").setValue(s);break;case"polygon":const a=40*i.vW/(2*i.width),o=30*i.vH/(2*i.height),l=(i.minX+i.vW)/2,h=(i.minY+i.vH)/2,c={x:l-a/4,y:h-o/2},u={x:l+a/4,y:h-o/2},d={x:l+a/2,y:h-o/4},p={x:l+a/2,y:h+o/4},f={x:l+a/4,y:h+o/2},m={x:l-a/4,y:h+o/2},g={x:l-a/2,y:h+o/4},v={x:l-a/2,y:h-o/4};e.getAttributeByName("points").setValue(c.x+" "+c.y+", "+u.x+" "+u.y+", "+d.x+" "+d.y+", "+p.x+" "+p.y+", "+f.x+" "+f.y+", "+m.x+" "+m.y+", "+g.x+" "+g.y+", "+v.x+" "+v.y);break;case"path":const b=40*i.vW/(2*i.width),y=(i.vH,i.height,(i.minX+i.vW)/2),w=(i.minY+i.vH)/2;e.getAttributeByName("d").setValue("M "+(y-b/2)+" "+w+" L "+(y+b/2)+" "+w)}let n=this.model.createProjection(e,"shape");n.parent=this.projection;let r=n.init().render();this.container.append(r),t.container=r},focusIn(){},focusOut(){},blur(){},getWindow(){const t=this.container.parentNode,e=t.viewBox.baseVal;return{width:Number(t.getAttribute("width")),height:Number(t.getAttribute("height")),vW:e.width,vH:e.height,minX:e.x,minY:e.y}},bindEvents(){this.projection.registerHandler("value.added",(t=>{this.addItem(t)})),this.projection.registerHandler("value.changed",(t=>{this.update()})),this.projection.registerHandler("value.removed",(t=>{this.removeItem(t)}))}},oa=Object.assign(Object.create(Qs),aa),{isNullOrUndefined:la}=n(835),ha={init(){return this},render(){return la(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="circle",this.element.dataset.id=this.id),this.cx=this.source.getAttributeByName("cx").target,this.cy=this.source.getAttributeByName("cy").target,this.r=this.source.getAttributeByName("r").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("cx",this.cx.value),this.element.setAttribute("cy",this.cy.value),this.element.setAttribute("r",this.r.value)},bindEvents(){this.cx.register(this),this.cy.register(this),this.r.register(this),this.element.addEventListener("click",(()=>{this.source.notify("current.updated",this.source)}))},bindStyle(){const t=this.source.getAttributeByName("style").target;this.fill=t.getAttributeByName("fill").target,this.stroke=t.getAttributeByName("stroke").target,this.width=t.getAttributeByName("s-width").target,this.dash=t.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},update(t){this.refresh(),la(this.fill.value)||this.element.setAttribute("fill",this.fill.value),la(this.stroke.value)||this.element.setAttribute("stroke",this.stroke.value),la(this.width.value)||(this.element.style["stroke-width"]=this.width.value),la(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},focusIn(){},focusOut(){}},ca=Object.assign(Object.create(Qs),ha),{isNullOrUndefined:ua}=n(835),da={init(){return this},render(){return ua(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="group",this.container.dataset.id=this.id),this.bindEvents(),this.container.style.overflow="visible",this.container},bindEvents(){this.projection.registerHandler("value.changed",(t=>{let e=this.model.createProjection(this.source.getValue(!0),"shape");e.parent=this.projection;let i=e.init().render();this.container.append(i)}))}},pa=Object.assign(Object.create(Qs),da),{isNullOrUndefined:fa}=n(835),ma={init(){return this},render(){return fa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="circle",this.element.dataset.id=this.id),this.x=this.source.getAttributeByName("x").target,this.y=this.source.getAttributeByName("y").target,this.width=this.source.getAttributeByName("width").target,this.height=this.source.getAttributeByName("height").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("x",this.x.value),this.element.setAttribute("y",this.y.value),this.element.setAttribute("height",this.height.value),this.element.setAttribute("width",this.width.value)},bindStyle(){const t=this.source.getAttributeByName("style").target;this.fill=t.getAttributeByName("fill").target,this.stroke=t.getAttributeByName("stroke").target,this.widthS=t.getAttributeByName("s-width").target,this.dash=t.getAttributeByName("s-dash").target,this.rx=t.getAttributeByName("rx").target,this.ry=t.getAttributeByName("ry").target,this.fill.register(this),this.stroke.register(this),this.widthS.register(this),this.dash.register(this),this.rx.register(this),this.ry.register(this)},update(t){this.refresh(),fa(this.fill.value)||this.element.setAttribute("fill",this.fill.value),fa(this.stroke.value)||(this.element.style.stroke=this.stroke.value),fa(this.widthS.value)||(this.element.style["stroke-width"]=this.widthS.value),fa(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value),fa(this.rx.value)||this.element.setAttribute("rx",this.rx.value),fa(this.ry.value)||this.element.setAttribute("ry",this.ry.value)},bindEvents(){this.x.register(this),this.y.register(this),this.width.register(this),this.height.register(this)}},ga=Object.assign(Object.create(Qs),ma),{isNullOrUndefined:va}=n(835),ba={init(){return this},render(){return va(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="ellipse",this.element.dataset.id=this.id),this.cx=this.source.getAttributeByName("cx").target,this.cy=this.source.getAttributeByName("cy").target,this.rx=this.source.getAttributeByName("rx").target,this.ry=this.source.getAttributeByName("ry").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("cx",this.cx.value),this.element.setAttribute("cy",this.cy.value),this.element.setAttribute("ry",this.ry.value),this.element.setAttribute("rx",this.rx.value)},bindStyle(){const t=this.source.getAttributeByName("style").target;this.fill=t.getAttributeByName("fill").target,this.stroke=t.getAttributeByName("stroke").target,this.width=t.getAttributeByName("s-width").target,this.dash=t.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},update(t){this.refresh(),va(this.fill.value)||this.element.setAttribute("fill",this.fill.value),va(this.stroke.value)||(this.element.style.stroke=this.stroke.value),va(this.width.value)||(this.element.style["stroke-width"]=this.width.value),va(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},bindEvents(){this.cx.register(this),this.cy.register(this),this.rx.register(this),this.ry.register(this)}},ya=Object.assign(Object.create(Qs),ba),{isNullOrUndefined:wa}=n(835),xa={init(){return this},render(){return wa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","polygon"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="polygon",this.element.dataset.id=this.id),this.points=this.source.getAttributeByName("points").target,this.refresh(),this.bindEvents(),this.element},refresh(){this.element.setAttribute("points",this.points.value)},update(t){this.refresh()},bindEvents(){this.points.register(this)}},Ea=Object.assign(Object.create(Qs),xa),{isNullOrUndefined:Aa}=n(835),Na={init(){return this},render(){return Aa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","path"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="path",this.element.dataset.id=this.id),this.d=this.source.getAttributeByName("d").target,this.element.style["stroke-width"]=5,this.element.style.stroke="black",this.source.getAttributeByName("style").target.getAttributeByName("s-width").setValue(5),this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("d",this.d.value)},bindEvents(){this.d.register(this)},bindStyle(){},update(t){this.refresh(),Aa(this.stroke.value)||this.element.setAttribute("fill",this.fill.value),Aa(this.stroke.value)||(this.element.style.stroke=this.stroke.value),Aa(this.width.value)||(this.element.style["stroke-width"]=this.width.value),Aa(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},bindStyle(){const t=this.source.getAttributeByName("style").target;this.fill=t.getAttributeByName("fill").target,this.stroke=t.getAttributeByName("stroke").target,this.width=t.getAttributeByName("s-width").target,this.dash=t.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},focusIn(){},focusOut(){}},Oa=Object.assign(Object.create(Qs),Na);var Ma=0;const ja=()=>"algo"+Ma++,Ca={canvas:(t,e,i)=>Object.create(na,{object:{value:"shape"},name:{value:"canvas-shape"},type:{value:"canvas"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),group:(t,e,i)=>Object.create(oa,{object:{value:"shape"},name:{value:"group-shape"},type:{value:"group"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),circle:(t,e,i)=>Object.create(ca,{object:{value:"shape"},name:{value:"circle-shape"},type:{value:"circle"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(t,e,i)=>Object.create(pa,{object:{value:"shape"},name:{value:"holder-shape"},type:{value:"holder"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),rectangle:(t,e,i)=>Object.create(ga,{object:{value:"shape"},name:{value:"rectangle-shape"},type:{value:"rectangle"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),ellipse:(t,e,i)=>Object.create(ya,{object:{value:"shape"},name:{value:"ellipse-shape"},type:{value:"ellipse"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),polygon:(t,e,i)=>Object.create(Ea,{object:{value:"shape"},name:{value:"polygon-shape"},type:{value:"polygon"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}}),path:(t,e,i)=>Object.create(Oa,{object:{value:"shape"},name:{value:"path-shape"},type:{value:"path"},id:{value:ja()},model:{value:t},schema:{value:e},projection:{value:i},source:{value:i.concept,writable:!0}})},La={createShape(e,i,n){const{type:r}=i,s=Ca[r];if((0,t.isNullOrUndefined)(s))throw new TypeError(`Missing handler: The '${r}' shape could not be handled`);const a=s(e,i,n);if((0,t.isNullOrUndefined)(a))throw new Error(`Bad request: The '${r}' shape could not be created`);return a.createShape=this.createShape,(0,t.isNullOrUndefined)(a.id)&&(a.id=ja()),a}};var Sa=0;const ka={createProjection(e,i,n,r){var s=Object.create(Ta,{id:{value:(0,t.valOrDefault)(i.id,"projection"+Sa++)},model:{value:e},schema:{value:i,writable:!0},environment:{value:r}});return s.concept=n,s}},Ta={handlers:null,init(t={}){return this.containers=new Map,this.attributes=[],this.params=[],this.templates=[],this.handlers={},this.args=t,this.concept.register(this),this},schema:null,concept:null,environment:null,parent:null,containers:null,placeholder:null,element:null,attributes:null,params:null,index:0,editing:!1,optional:!1,collapsible:!1,searchable:!1,focusable:!0,get hasMultipleViews(){return this.schema.length>1},get isReadOnly(){return(0,t.valOrDefault)(this.getSchema().readonly,!1)},isRoot(){return(0,t.isNullOrUndefined)(this.parent)},getSchema(e){return this.schema[(0,t.valOrDefault)(e,this.index)]},hasSchema(t){return-1!==this.schema.findIndex((e=>e.tags.includes(t)))},getContainer(e){return this.containers.get((0,t.valOrDefault)(e,this.index))},getStyle(){const{style:t}=this.getSchema();return t},addTemplate(t){this.templates.push(t)},addParam(t){this.params.push(...Array.isArray(t)?t:[t])},getParam(e,i){let n=this.params.find((t=>t.name===e));if((0,t.isNullOrUndefined)(n))return;const{type:r="string",value:s}=n;let a=(0,t.valOrDefault)(s,n.default);return(0,t.isNullOrUndefined)(a)?null:"string"===r?a.toString():"number"===r?+a:"boolean"===r?(0,t.toBoolean)(a):void 0},getParent(){return this.isRoot()?null:this.parent},getAttributes(t){return this.attributes.filter((e=>e.name===t))},getField(t){return this.environment.getField(t)},getStatic(t){return this.environment.getStatic(t)},getLayout(t){return this.environment.getLayout(t)},resolveElement(t){return this.environment.resolveElement(t)},getHandlers(e){return(0,t.valOrDefault)(this.handlers[e],[])},update(i,n,r){if((0,t.isEmpty)(this.containers))return;if("delete"===i&&r===this.concept)return void this.delete();const s=this.getHandlers(i);switch((0,t.isEmpty)(s)||s.forEach((t=>{t(n,r)})),i){case"attribute.added":return void this.getAttributes(n.name).forEach((t=>{const{schema:i}=t,r=this.model.createProjection(n.target,i.tag).init();r.parent=this,r.optional=!0;const s=r.render();Jt.call(this,s,i.style),r.element.parent=t.parent,t.element=s,t.placeholder&&(t.placeholder.after(s),(0,e.Cp)(t.placeholder))}));case"attribute.removed":return void this.getAttributes(n.name).forEach((i=>{i.element&&((0,t.removeChildren)(i.element).remove(),i.element=null),i.placeholder&&(0,e.$Z)(i.placeholder)}))}},delete(){return this.concept&&setTimeout((()=>{this.concept.unregister(this)}),50),this.placeholder&&this.getContainer().after(this.placeholder),this.containers.forEach((e=>{if((0,t.removeChildren)(e),(0,t.isHTMLElement)(e)&&e.remove(),"path"===e.tagName){if("force"===e.dataset.algorithm){let t=this.environment.resolveElement(e);t.projection.parent.removeArrow(t)}"anchor"===e.dataset.algorithm&&this.environment.resolveElement(e).deleteFromView(),"multi"===e.dataset.algorithm&&this.environment.resolveElement(e).deletePaths()}["svg","text"].includes(e.tagName)&&e.remove(),this.sibling&&this.sibling.delete()})),this.model.removeProjection(this.id),!0},registerHandler(t,e){return Array.isArray(this.handlers[t])||(this.handlers[t]=[]),this.handlers[t].push(e),!0},unregisterHandler(e,i){if(!(0,t.hasOwn)(this.handlers,e))return!1;for(let t=0;t<this.handlers[e].length;t++)if(this.handlers[e][t]===i)return this.handlers[e].splice(t,1),!0;return!1},focus(){this.element.focus()},render(){const e=this.getSchema();if((0,t.isNullOrUndefined)(e))return null;const{type:i,projection:n,content:r,kind:s,sibling:a,rtag:o,ratio:l}=e;var h=null;if("layout"===i||"layout"===s)this.element=Bs.createLayout(this.model,(0,t.valOrDefault)(n,r),this).init(this.args),this.model.registerLayout(this.element);else if("field"===i||"field"===s){let i=(0,t.hasOwn)(e,"field")?e.field:(0,t.valOrDefault)(n,r);this.element=_i.createField(this.model,i,this).init(this.args),this.model.registerField(this.element)}else"static"===i||"static"===s?(this.element=An.createStatic(this.model,(0,t.valOrDefault)(n,r),this).init(this.args),this.element.source=this.concept,this.model.registerStatic(this.element)):"dynamic"===i||"dynamic"===s?(this.element=An.createStatic(this.model,(0,t.valOrDefault)(n,r),this).init(this.args),this.model.registerStatic(this.element)):"algorithm"===i?(this.element=Ar.createAlgo(this.model,(0,t.valOrDefault)(n,r),this).init(this.args),this.model.registerAlgorithm(this.element)):"arrow"===i?(this.element=Ks.createArrow(this.model,(0,t.valOrDefault)(n,r),this).init(this.args),this.model.registerArrow(this.element)):"shape"===i?(this.element=La.createShape(this.model,(0,t.valOrDefault)(n,r),this).init(this.args),this.model.registerShape(this.element)):"simulation"===i?(this.element=as.createSimulation(this.model,(0,t.valOrDefault)(n,r),this).init(this.args),this.model.registerSimulation(this.element)):(this.element=Ln(this.model,e.container,this).init(this.args),this.model.registerLayout(this.element));if(this.isRoot()&&(this.element.focusable=!0),this.focusable||(this.element.focusable=!1),this.readonly&&(this.element.readonly=!0),h=this.element.render(),this.element.focusable||(h.tabIndex=-1),!(0,t.isNode)(h))throw new Error("Projection element container could not be created");if(h.classList.add("projection"),Object.assign(h.dataset,{projection:this.id,concept:this.concept.id,object:this.concept.object}),this.optional)if(this.element.schema.rmv)this.element.createDelete(),h.dataset.deletable=!0;else{let e=(0,t.createButton)({class:["btn","structure__btn-delete","projection__btn-delete"],title:`Delete ${this.concept.name}`,tabindex:-1,dataset:{action:"delete",projection:this.id}});e.addEventListener("click",(e=>{let i=this.getContainer(),n=(0,t.findAncestor)(i,(t=>0===t.tabIndex));this.environment.save(this.concept.getParent(),i.cloneNode(!0)),this.concept.delete();let r=this.environment.resolveElement(n);(0,t.isNullOrUndefined)(r)||r.focus()})),h.dataset.deletable=!0,h.prepend(e)}if(this.collapsible){let e=(0,t.createButton)({class:["btn","projection__btn-collapse"],title:`Collapse ${this.concept.name}`,tabindex:-1,dataset:{action:"collapse",projection:this.id}});e.addEventListener("click",(t=>{this.getContainer().classList.toggle("collapsed")})),h.dataset.collapsible=!0,h.prepend(e)}return this._style&&Jt.call(this,h,this._style),this.containers.set(this.index,h),a&&this.createSibling(this.concept,a,this.element),o&&(this.rtag=o,this.environment.registerReceiver(this.element,o)),h},refresh(){this.editing?this.containers.forEach((t=>{t.tabIndex=0})):this.containers.forEach((t=>{t.tabIndex=null}))},createSibling(e,i){const{render:n,params:r=!1,bind:s}=i,{tag:a,rtag:o}=n;if(this.checkForAliveSibling(e.id,a,o))return;let l=this.model.createProjection(e,a).init();s&&(l.bind=this.element);let h=l.render();if(r){const{coordinates:t,dimension:e}=r;h.setAttribute("x",t.x),h.setAttribute("y",t.y)}let c=this.environment.getActiveReceiver(o);l.parent=c,(0,t.isNullOrUndefined)(l.element.path)&&c.container.append(l.element.element||l.element.container),this.sibling=l},checkForAliveSibling(e,i,n){if((0,t.isNullOrUndefined)(this.environment.siblingModel)&&(this.environment.siblingModel=new Map),(0,t.isNullOrUndefined)(this.environment.siblingModel.get(e)))return this.environment.siblingModel.set(e,[{tag:i,rtag:n}]),!1;let r=this.environment.siblingModel.get(e);for(let t=0;t<r.length;t++)if(r[t].rtag===n&&r[t].tag===i)return!0;return r.push([{tag:i,rtag:n}]),this.environment.siblingModel.set(e,r),!1},changeView(e){if(!this.hasMultipleViews)return void this.environment.notify("There is no alternative projection for this concept");let i=this.getContainer();this.index=(0,t.valOrDefault)(e,(this.index+1)%this.schema.length);let n=this.getContainer();(0,t.isHTMLElement)(n)||(this.params=[],n=this.render()),i.replaceWith(n),this.element=this.resolveElement(n),"svg"===this.element.type&&this.element.update();const r=this.getHandlers("view.changed");return(0,t.isEmpty)(r)||r.forEach((t=>t(n))),this.focus(),this},findView(t){if(!this.hasSchema(t)){if(!this.model.hasProjectionSchema(this.concept,t))return-1;let e=this.model.getProjectionSchema(this.concept,t);this.schema.push(...e)}return this.schema.findIndex((e=>e.tags.includes(t)))},export(){return{id:this.id,root:this.isRoot(),concept:{id:this.concept.id,name:this.concept.name}}},bindEvents(){}},Ua=[{concept:{name:"set"},type:"field",tags:[],content:{type:"list"}},{concept:{name:"boolean"},type:"field",tags:[],content:{type:"binary"}},{concept:{name:"string"},type:"field",tags:[],content:{type:"text"}},{concept:{name:"number"},type:"field",tags:[],content:{type:"text",input:{type:"number"}}},{concept:{name:"reference"},type:"field",tags:[],content:{type:"choice"}}];function Ia(e,i){return Object.create(_a,{schema:{value:(0,t.valOrDefault)(e,{projection:[],algorithm:[],template:[],style:[]}),writable:!0},editor:{value:i},environment:{value:i}})}const _a={projections:null,fields:null,statics:null,layouts:null,algos:null,init(t){return this.projections=[],this.fields=new Map,this.statics=new Map,this.layouts=new Map,this.algos=new Map,this.arrows=new Map,this.shapes=new Map,this.simulations=new Map,this},addSchema(t){return Array.isArray(t.projection)&&this.schema.projection.push(...t.projection),Array.isArray(t.template)&&this.schema.template.push(...t.template),Array.isArray(t.style)&&this.schema.style.push(...t.style),this.environment.update("projection-model.updated"),!0},setSchema(t){return this.schema=[...t,...Ua],this.environment.update("projection-model.updated"),this},done(){for(;!(0,t.isEmpty)(this.projections);)this.projections[0].delete();return this.projections=[],this.fields.clear(),this.layouts.clear(),this.statics.clear(),this},createProjection(i,n){const r=this.getProjectionSchema(i,n);(0,t.isEmpty)(r)&&this.environment.notify(`Missing projection (#${n}) for ${i.name}`,e.k$.WARNING);const s=ka.createProjection(this,r,i,this.environment);return s.tag=n,this.addProjection(s),s},getProjections(){return this.projections.slice()},getProjection(t){return Number.isInteger(t)?this.projections[t]:this.projections.find((e=>e.id===t))},addProjection(e){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad request: The 'projection' argument must be a Projection");return this.projections.push(e),this},removeProjection(t){var e=this.projections.findIndex((e=>e.id===t));return-1!==e&&(this.projections.splice(e,1),!0)},registerField(t){return t.environment=this.environment,t.editor=this.environment,this.fields.set(t.id,t),this},unregisterField(t){var e=this.fields.get(t.id);return e&&(e.environment=null,this.fields.delete(e.id)),this},getField(t){return this.fields.get(t)},registerStatic(t){return t.environment=this.environment,t.editor=this.environment,this.statics.set(t.id,t),this},unregisterStatic(t){var e=this.statics.get(t.id);return e&&(e.environment=null,this.statics.delete(e.id)),this},getStatic(t){return this.statics.get(t)},registerLayout(t){return t.environment=this.environment,t.editor=this.environment,this.layouts.set(t.id,t),this},unregisterLayout(t){var e=this.layouts.get(t.id);return e&&(e.environment=null,this.layouts.delete(e.id)),this},getLayout(t){return this.layouts.get(t)},registerArrow(t){return t.environment=this.environment,this.arrows.set(t.id,t),this},unregisterArrow(t){var e=this.arrows.get(t.id);return e&&(e.environment=null,this._arrow.delete(e.id)),this},getArrow(t){return this.arrows.get(t)},registerShape(t){return t.environment=this.environment,this.shapes.set(t.id,t),this},registerSimulation(t){return t.environment=this.environment,this.simulations.set(t.id,t),this},unregisterArrow(t){var e=this.shapes.get(t.id);return e&&(e.environment=null,this._shape.delete(e.id)),this},getArrow(t){return this.shapes.get(t)},registerAlgorithm(t){return t.environment=this.environment,this.algos.set(t.id,t),this},unregisterAlgorithm(t){var e=this.algos.get(t.id);return e&&(e.environment=null,this.algos.delete(e.id)),this},getAlgo(t){return this.algos.get(t)},getSimulation(t){return this.simulations.get(t)},getArrow(t){return this.arrows.get(t)},getMetadata(t){let e=this.schema.find((e=>e.id===t));return e?e.metadata:null},hasConceptProjection(e,i){let n=null;return n=(0,t.isString)(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((i=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(i.concept.name)||(n=i.concept.prototype,!(0,t.isNullOrUndefined)(n)&&"prototype"!==e.nature&&e.hasPrototype(n));var n})),(0,t.isIterable)(i)&&!(0,t.isEmpty)(i)?-1!==n.findIndex((t=>(t=>Array.isArray(t.tags)&&t.tags.includes(i))(t))):!(0,t.isEmpty)(n)},getSchema(){return this.schema},getProjectionSchema(e,i){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad parameter: concept");var n=null;return n=(0,t.isString)(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((i=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(i.concept.name)||(n=i.concept.prototype,!(0,t.isNullOrUndefined)(n)&&"prototype"!==e.nature&&e.hasPrototype(n));var n})),(0,t.isIterable)(i)&&!(0,t.isEmpty)(i)?n.filter((t=>t.tags&&t.tags.includes(i))):n},getTemplateSchema(i){let n=this.schema.template.find((t=>t.name===i));return(0,t.isNullOrUndefined)(n)?null:(0,e.p$)(n)},getGFragmentSchema(i){let n=this.schema.find((t=>"g-fragment"===t.type&&t.name===i));return(0,t.isNullOrUndefined)(n)?null:(0,e.p$)(n)},getRuleSchema(i){let n=this.schema.find((t=>"rule"===t.type&&t.name===i));return(0,t.isNullOrUndefined)(n)?null:(0,e.p$)(n)},getStyleSchema(i){let n=this.schema.style.find((t=>t.name===i));return(0,t.isNullOrUndefined)(n)?null:(0,e.p$)(n)},hasProjectionSchema(e,i){if((0,t.isNullOrUndefined)(e))throw new TypeError("Bad parameter: concept");let n=[];return n=(0,t.isString)(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((i=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(i.concept.name)||(n=i.concept.prototype,!(0,t.isNullOrUndefined)(n)&&"prototype"!==e.nature&&e.hasPrototype&&e.hasPrototype(n));var n})),(0,t.isIterable)(i)&&!(0,t.isEmpty)(i)?n.some((t=>t.tags&&t.tags.includes(i))):!(0,t.isEmpty)(n)},export(){const t=[];return this.getProjections().forEach((e=>{t.push(e.export())})),t}},Ha={unloadAllConcept(){return this.hasConceptModel&&(this.conceptModel.done(),this.conceptModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-concept@post"}),this},unloadAllProjection(){return this.hasProjectionModel&&(this.projectionModel.done(),this.projectionModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-projection@post"}),this},loadSession(){this.conceptModel.getRootConcepts().forEach((t=>{this.createInstance(t)}))},loadConcept(i,n){let r=i.concept||i,s=i.values;return Array.isArray(r)?(0,t.isEmpty)(r)?(this.notify("The concept schema is empty",e.k$.ERROR),!1):((0,t.isNullOrUndefined)(this.conceptModel)&&(this.conceptModel=Xt.createModel(null,this).init()),this.conceptModel.addConceptSchema(r),this.conceptModel.init(s),this.triggerEvent({name:"editor.load-concept@post",args:[n,JSON.stringify(i)]}),this.refresh(),this):(this.notify("Invalid concept schema",e.k$.ERROR),!1)},loadValues(e,i){let n=e;if(!(0,t.isNullOrUndefined)(this.conceptModel))return this.conceptModel.initValue(n),this.loadSession(),this.triggerEvent({name:"editor.load-values@post",args:[i,JSON.stringify(n)]}),this.refresh(),this;console.error("concept model not found")},loadConcepts(i){return Array.isArray(i)?(0,t.isEmpty)(i)?(this.notify("The concept schema is empty",e.k$.ERROR),!1):((0,t.isNullOrUndefined)(this.conceptModel)&&(this.conceptModel=Xt.createModel(null,this).init()),i.forEach((t=>{this.conceptModel.addConceptSchema(t)})),this.refresh(),this):(this.notify("Invalid concept schema",e.k$.ERROR),!1)},loadProjection(e,i){return this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,(0,t.isNullOrUndefined)(this.projectionModel)&&(this.projectionModel=Ia(e,this).init()),this.projectionModel.addSchema(e),(0,t.isNullOrUndefined)(this.projectionModel),this.instances.forEach((t=>{t.projection=this.projectionModel.createProjection(t.concept).init(),t.render()})),this.triggerEvent({name:"editor.load-projection@post",args:[i,JSON.stringify(e)]}),this.refresh(),this},loadProjections(i){return Array.isArray(i)?(0,t.isEmpty)(i)?(this.notify("The concept schema is empty",e.k$.ERROR),!1):(this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,(0,t.isNullOrUndefined)(this.projectionModel)&&(this.projectionModel=Ia(null,this).init()),i.forEach((t=>{this.projectionModel.addSchema(t)})),this.refresh(),this):(this.notify("Invalid concept schema",e.k$.ERROR),!1)},load(i,n){let r=i.type;if((0,t.isNullOrWhitespace)(r)){let t=i.name.indexOf(".")+1;r=i.name.substring(t)}else r=e.D3[r];"jsoncp"===r&&"json"===r||this.addResource(i,n);let s=new FileReader;return s.onload=t=>{const e=JSON.parse(s.result),{type:i}=e;"concept"===i?this.loadConcept(e,n):"projection"===i?this.loadProjection(e,n):"model"===i&&(this.loadConcept(e.concept),this.loadProjection(e.projection),this.loadValues(e.values))},s.readAsText(i),!0},unload(){return this.unloadAllConcept(),this.unloadAllProjection(),this.clear(),this}},Da={getField(e){if(!(0,t.isHTMLElement)(e)&&"path"!==e.tagName&&"text"!==e.tagName&&"svg"!==e.tagName)return console.warn("Field error: Bad argument"),null;const{id:i,nature:n}=e.dataset;return(0,t.isNullOrUndefined)(i)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(n)?this.projectionModel.getField(i):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(e){if(!(0,t.isHTMLElement)(e)&&"svg"!==e.tagName)return console.warn("Static error: Bad argument"),null;const{id:i,nature:n}=e.dataset;return(0,t.isNullOrUndefined)(i)?(console.warn("Static error: Missing id attribute on field"),null):["static","static-component"].includes(n)?this.projectionModel.getStatic(i):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(e){if(!(0,t.isHTMLElement)(e)&&"svg"!==e.tagName)return console.warn("Layout error: Bad argument"),null;const{id:i,nature:n}=e.dataset;return(0,t.isNullOrUndefined)(i)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(n)?this.projectionModel.getLayout(i):(console.warn("Layout error: Unknown nature attribute on field"),null)},getAlgo(e){if(!(0,t.isHTMLElement)(e)&&"svg"!==e.tagName&&"text"!==e.tagName)return console.warn("Algo error: Bad argument"),null;const{id:i,nature:n}=e.dataset;return(0,t.isNullOrUndefined)(i)?(console.warn("Algo error: Missing id attribute on field"),null):["algorithm"].includes(n)?this.projectionModel.getAlgo(i):(console.warn("algo error: Unknown nature attribute on field"),null)},getSimulation(e){if(!(0,t.isHTMLElement)(e)&&"svg"!==e.tagName&&"text"!==e.tagName)return console.warn("Simulation error: Bad argument"),null;const{id:i,nature:n}=e.dataset;return(0,t.isNullOrUndefined)(i)?(console.warn("Simulation error: Missing id attribute on Simulation"),null):["simulation"].includes(n)?this.projectionModel.getSimulation(i):(console.warn("Simulation error: Unknown nature attribute on Simulation"),null)},getArrow(e){if("path"!==e.tagName)return console.warn("Arrow error: Bad argument"),null;const{id:i,nature:n}=e.dataset;return(0,t.isNullOrUndefined)(i)?(console.warn("Arrow error: Missing id attribute on field"),null):["arrow","arrow-path"].includes(n)?this.projectionModel.getArrow(i):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(e){if(e instanceof SVGElement){let i=e;for(;!(0,t.isNullOrUndefined)(i.parentNode)&&(0,t.isNullOrUndefined)(i.dataset);)i=i.parentNode;(0,t.isNullOrUndefined)(i.dataset.nature)||(e=i)}if(!(0,t.isHTMLElement)(e)&&"path"!==e.tagName&&"svg"!==e.tagName&&"text"!==e.tagName)return null;const{nature:i}=e.dataset;if((0,t.isNullOrUndefined)(i))return null;let n=null;switch(i){case"field":case"field-component":n=this.getField(e);break;case"layout":case"layout-component":n=this.getLayout(e);break;case"static":case"static-component":n=this.getStatic(e);break;case"algorithm":n=this.getAlgo(e);break;case"simulation":n=this.getSimulation(e);break;case"arrow":n=this.getArrow(e)}return n&&(n.environment=this),n}};var Pa=0;const Va={createState(e,i){const{id:n,name:r}=e;let s="value"+Pa++,a=JSON.stringify(e.clone()),o=((0,t.formatDate)(new Date,"hh:dd"),(0,t.createI)({class:["ico","ico-delete"]},"✖")),l=(0,t.createButton)({class:["btn","btn-delete"],title:`Delete ${r} state`},o),h=(0,t.createDiv)({class:["model-state-preview"],title:`Preview ${r}`},i),c=(0,t.createSpan)({class:["model-state-content","fit-content"]},`${e.getName()}`),u=(0,t.createListItem)({class:["model-state"],title:`Restore ${r} state`,dataset:{id:s,concept:n}},[l,c,h]);u.addEventListener("click",(e=>{let i=function(e){const i=t=>t===u||t===l;return i(e)?e:(0,t.findAncestor)(e,(t=>i(t)),5)}(e.target);if(this.unhighlight(),i===l)this.removeState(s);else{let e=this.restore(a);this.removeState(s);let i=(0,t.getElement)(`.projection[data-concept="${e.id}"]`,this.body);i&&i.focus()}}));let d=`.projection[data-concept="${n}"]`;if(u.addEventListener("mouseenter",(e=>{let i=(0,t.getElement)(d,this.body);i&&this.highlight(i)})),u.addEventListener("mouseleave",(t=>{this.unhighlight()})),this.states.length>8){let{id:t}=this.stateList.lastChild.dataset;this.removeValue(t)}let p=Object.create({},{id:{value:s},object:{value:"value"},type:{value:"state"},element:{value:u},concept:{value:e},value:{value:a}});return this.addState(p),p},getState(e){if(!(0,t.isNullOrUndefined)(e)&&!(0,t.isEmpty)(this.states))return this.states[e]},addState(t){return this.stateList.append(t.element),this.states.push(t),this.refresh(),t},removeState(e){if((0,t.isNullOrUndefined)(e))return;const i=this.states.findIndex((t=>t.id===e));if(-1===i)return null;let n=this.states.splice(i,1)[0],{element:r}=n;return(0,t.removeChildren)(r).remove(),this.refresh(),this}},Ba={"delete:value":t=>{const{id:e}=t.dataset;(void 0).conceptModel.removeValue(e),(void 0).header._valueSelector.update()},"delete:resource":t=>{const{id:e}=t.dataset;(void 0).removeResource(e)},"change-view":t=>{const{value:e}=t.dataset;(void 0).status.changeView(e)},"add-group":t=>{(void 0).status.addGroup()},"export--copy":t=>{(void 0).export(!0)}};var Ra=0;const za={conceptModel:null,projectionModel:null,concept:null,activeConcept:null,activeProjection:null,activeReceiver:null,activeInstance:null,container:null,header:null,body:null,instanceSection:null,designSection:null,navigationSection:null,valueWindow:null,valueList:null,breadcrumb:null,filter:null,home:null,exporter:null,style:null,logs:null,status:null,group:null,input:null,copyValue:null,states:null,activeElement:null,decoratedElements:null,config:null,active:!1,visible:!1,frozen:!1,handlers:null,actions:null,attached:null,instances:null,windows:null,values:null,resources:null,models:null,errors:null,init(t={}){const{conceptModel:e,projectionModel:i,toolbar:n=[],config:r={},handlers:s={},actions:a={}}=t;this.config=Object.assign({},r),this.handlers=new Map,this.actions=new Map,this.attached=[],this.instances=new Map,this.windows=new Map,this.values=new Map,this.resources=new Map,this.models=new Map,this.errors=[],Object.assign(this,j,S),this.states=[],this.decoratedElements=new Set;for(const t in s){const e=s[t];this.registerHandler(t,e)}return this.header=_.call(this).init(),this.home=D.call(this).init(),this.breadcrumb=H.call(this).init(),this.logs=V.call(this).init(),this.status=P.call(this).init(),this.exporter=B.call(this).init(),this.render(),Array.isArray(e)?this.loadConcepts(e):e&&this.loadConcept(e),Array.isArray(i)?this.loadProjections(i):i&&this.loadProjection(i),this.isReady?(this.conceptModel.getRootConcepts().forEach((t=>{this.createInstance(t)})),this.open()):(this.home.open(),this.refresh()),this},setConfig(e){return!(0,t.isNullOrUndefined)(e)&&(this.config=e,this.refresh(),this)},getConfig(e){return(0,t.isNullOrUndefined)(e)?this.config:this.config[e]},getName(){return(0,t.valOrDefault)(this.config.name,`editor${(new Date).getTime()}`)},createConcept(i){if((0,t.isNullOrUndefined)(i))throw new TypeError("Missing argument: The 'name' is required to create a concept");return this.conceptModel.isConcept(i)?this.conceptModel.createConcept(i):(this.notify(`The concept '${i}' is not defined in the model`,e.k$.ERROR),!1)},addConcept(t){let e=t.concept||t;Array.isArray(e)?this.conceptModel.schema.push(...e):this.conceptModel.schema.push(e),this.refresh()},createProjection(i,n){if((0,t.isNullOrUndefined)(i))throw new TypeError("Missing argument: The 'concept' is required to create a projection");return this.projectionModel.hasConceptProjection(i,n)?this.projectionModel.createProjection(i,n).init():(this.notify(`The projection for the concept '${i.name}' is not defined in the model`,e.k$.ERROR),!1)},addProjection(t){Array.isArray(t)?this.projectionModel.schema.projection.push(...t):this.projectionModel.addSchema(t),this.refresh()},download(i,n,r){let s;s=(0,t.isNullOrUndefined)(r)?e.n_.JSON:e.n_[r.toUpperCase()];const a=s.type;window.URL=window.webkitURL||window.URL;var o=(0,t.createAnchor)({class:["bare-link","download-item__link"]},"Download");(0,t.isNullOrWhitespace)(o.href)||window.URL.revokeObjectURL(o.href);var l=new Blob([JSON.stringify(i)],{type:a});return Object.assign(o,{download:n,href:window.URL.createObjectURL(l)}),o.dataset.downloadurl=[a,o.download,o.href].join(":"),o.click(),setTimeout((()=>{window.URL.revokeObjectURL(o.href),o.remove()}),1500),i},save(e,i){(0,t.isNullOrUndefined)(e)||(this.createState(e,i),this.refresh())},restore(t){let e=JSON.parse(t),i=this.conceptModel.getConcept(e.id);return i.restore(e),this.refresh(),i},undo(){if((0,t.isEmpty)(this.states))return void this.notify("There are no previous state",e.k$.NORMAL,2e3);let i=(0,t.last)(this.states);this.restore(i.value),this.removeState(i.id)},notify(e,i,n=4500){let r=(0,t.createParagraph)({class:["notify"],html:e});const s="open";i&&r.classList.add(i),this.container.append(r),setTimeout((()=>{r.classList.add(s)}),50),setTimeout((()=>{r.classList.remove(s),setTimeout((()=>{r.remove()}),500)}),n)},addResource(e,i){let n=(0,t.valOrDefault)(i,e.name.split(".")[0]);this.resources.set(n,e);let r=new FileReader;return r.onload=t=>{const e=JSON.parse(r.result);this.addModel(n,e)},r.readAsText(e),this.refresh(),e},getResource(t){return this.resources.get(t)},hasResource(t){return this.resources.has(t)},removeResource(t){return this.resources.delete(t),this.triggerEvent({name:"resource.removed"}),this.refresh(),!0},addError(t){return this.errors.push(t),this.refresh(),(0,e.lL)(this.status.editorstatusBadge),t},removeError(t){return this.errors.pop(),this.refresh(),!0},clearError(t){return this.errors=[],this.refresh(),!0},getModel(e){let i=this.models.get(e);return(0,t.isNullOrUndefined)(i)?null:JSON.parse(i)},addModel(t,e){this.models.set(t,e)},removeModel(t){return this.triggerEvent({name:"model.remove@pre",args:[t]},(()=>{this.models.delete(t),this.refresh(),this.triggerEvent({name:"model.remove@post"})}),!1),!0},hasModel(t){return this.models.has(t)},getValue(t){if(this.values.has(t))return this.values.get(t)},addValue(e){let i="value"+Ra++,n=(0,t.createI)({class:["ico","ico-copy"]}),r=(0,t.createI)({class:["ico","ico-delete"]},"✖"),s=(0,t.createButton)({class:["btn","btn-copy","fit-content"],title:`Copy ${e.name}`},[n,e.name]),a=(0,t.createButton)({class:["btn","btn-delete"]},r),o=(0,t.createListItem)({class:["model-value"],dataset:{id:i}},[s,a]);if(s.addEventListener("click",(t=>{this.copy(e)})),a.addEventListener("click",(t=>{this.removeValue(i)})),this.values.size>5){let{id:t}=this.valueList.lastChild.dataset;this.removeValue(t)}return this.valueList.prepend(o),this.values.set(i,{element:o,value:e}),this.refresh(),e},removeValue(e){if((0,t.isNullOrUndefined)(e)||!this.values.has(e))return;let{element:i}=this.values.get(e);return(0,t.removeChildren)(i).remove(),this.values.delete(e),this.refresh(),this},copy(i,n=!1){return(0,t.isNullOrUndefined)(i)||(this.copyValue=i,(0,t.copytoClipboard)(JSON.stringify(i)),n&&this.addValue(i),this.notify(`${i.name} copied`,e.k$.NORMAL)),this},paste(e,i){let n=(0,t.valOrDefault)(i,this.copyValue);if(!(0,t.isNullOrUndefined)(n)){if((0,t.isNullOrUndefined)(e)){let t=this.createConcept(n.name).init();t.setValue(n),this.createInstance(t)}else"prototype"===n.nature?e.setValue(n.value):e.setValue(n);return this}},show(){return this.triggerEvent({name:"editor.show@pre"},(()=>{(0,e.$Z)(this.container),this.attached.forEach((t=>t.show())),this.visible=!0,this.triggerEvent({name:"editor.show@post"})}),!1),this},hide(){return this.triggerEvent({name:"editor.hide@pre"},(()=>{(0,e.Cp)(this.container),this.attached.forEach((t=>t.hide())),this.visible=!1,this.triggerEvent({name:"editor.hide@post"})}),!1),this},toggle(){return this.triggerEvent({name:"editor.toggle@pre"},(()=>{(0,e.ZN)(this.container),this.visible=!this.visible,this.triggerEvent({name:"editor.toggle@post"})}),!1),this},open(){return this.triggerEvent({name:"editor.open@pre"},(()=>{this.show(),this.active=!0,this.isReady&&this.home.close(),this.triggerEvent({name:"editor.open@post"})}),!1),this},close(){return this.triggerEvent({name:"editor.close@pre"},(()=>{this.hide(),this.active=!1,this.done(),this.clear(),this.triggerEvent({name:"editor.close@post"})}),!1),this},destroy(){return this.triggerEvent({name:"editor.destroy@pre"},(()=>{this.hide(),this.done(),this.instances.forEach((t=>t.delete())),(0,t.removeChildren)(this.container).remove()}),!1),!0},freeze(){return this.triggerEvent({name:"editor.freeze@pre"},(()=>{this.frozen=!0,this.refresh(),this.triggerEvent({name:"editor.freeze@post"})}),!1),this},unfreeze(){return this.frozen=!1,this.refresh(),this},done(){return this.conceptModel&&this.conceptModel.done(),this.projectionModel&&this.projectionModel.done(),this},highlight(i){return(0,t.isHTMLElement)(i)?((0,e.CH)(i),this.decoratedElements.add(i),this):this},unhighlight(i){return(0,t.isHTMLElement)(i)?((0,e.HW)(i),this.decoratedElements.delete(i),this):(this.decoratedElements.forEach((t=>(0,e.HW)(t))),this.decoratedElements.clear(),this)},createWindow(){let e=(0,t.createDiv)({class:["editor-window"],tabindex:0});this.body.append(e)},clear(){return this.triggerEvent({name:"editor.clear@pre"},(()=>{this.instances.forEach((t=>t.delete())),this.instances.clear(),this.resources.clear(),this.models.clear(),this.states.forEach((t=>t.element.remove())),this.states=[],this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,this.refresh(),this.triggerEvent({name:"editor.clear@post"})}),!1),this},update(t,e,i){this.triggerEvent({name:t})},attach(t){this.attached.push(t)},detach(t){let e=this.attached.findIndex((e=>e===t));if(-1===e)return null;this.attached.splice(e,1)},render(e){const i=(0,t.createDocFragment)();if(this.home.isRendered||i.append(this.home.render()),this.header.isRendered||i.append(this.header.render()),this.exporter.isRendered||i.append(this.exporter.render()),(0,t.isHTMLElement)(this.navigationSection)||(this.navigationSection=(0,t.createSection)({class:["model-navigation-section"]}),this.viewSection=(0,t.createAside)({class:["model-view-section"]}),this.navigationSection.append(this.viewSection),i.append(this.navigationSection)),!(0,t.isHTMLElement)(this.body)){this.body=(0,t.createDiv)({class:["editor-body"],tabindex:0});let e=(0,t.createDiv)({class:["editor-body-main"],tabindex:0});this.instanceSection=(0,t.createSection)({class:["model-concept-section"]}),e.append(this.instanceSection),this.body.append(e),i.append(this.body)}return(0,t.isHTMLElement)(this.timeline)||(this.timeline=(0,t.createDiv)({class:["editor-timeline"]}),this.stateList=(0,t.createUnorderedList)({class:["bare-list","model-state-list"]}),this.timeline.append(this.stateList),i.append(this.timeline)),this.logs.isRendered||i.append(this.logs.render()),this.breadcrumb.isRendered||this.navigationSection.append(this.breadcrumb.render()),(0,t.isHTMLElement)(this.valueSection)||(this.valueSection=(0,t.createDiv)({class:["model-value-window"]}),this.valueList=(0,t.createUnorderedList)({class:["bare-list","model-value-list"]}),this.valueSection.append(this.valueList),this.navigationSection.append(this.valueSection)),this.status.isRendered||i.append(this.status.render()),(0,t.isHTMLElement)(this.input)||(this.input=(0,t.createInput)({type:"file",class:["hidden"],accept:".json,.jsoncp"}),i.append(this.input)),i.hasChildNodes()&&(this.container.append(i),this.bindEvents()),(0,t.isHTMLElement)(e)&&e.append(this.container),this.refresh(),this.container},refresh(i=!1){return this.frozen&&!i||(this.home.isOpen?this.container.classList.add("unfocus"):this.container.classList.remove("unfocus"),this.hasValues?(0,e.$Z)(this.valueWindow):(0,e.Cp)(this.valueWindow),this.header.refresh(),this.breadcrumb.refresh(),this.home.refresh(),this.logs.refresh(),this.status.refresh(),this.instanceSection.dataset.view=this.status.view,["grid"].includes(this.status.view)?(0,e.Cp)(this.viewSection):["tab"].includes(this.status.view)&&(0,e.$Z)(this.viewSection),(0,t.isEmpty)(this.states)?(0,e.Cp)(this.timeline):((0,e.$Z)(this.timeline),this.states.forEach((t=>{this.conceptModel.hasConcept(t.concept.id)?this.hasActiveConcept&&this.activeConcept===t.concept?t.element.classList.add("active"):t.element.classList.remove("active"):this.removeState(t.id)})))),this},updateActiveElement(t){return this.activeElement&&this.activeElement===t||(this.activeElement=t,this.triggerEvent({name:"editor.element@active:updated"})),this},updateActiveConcept(t){return this.hasActiveConcept&&this.activeConcept===t||(this.activeConcept=t,this.triggerEvent({name:"editor.concept@active:updated"}),this.refresh()),this},updateActiveProjection(e){if(this.activeProjection&&this.activeProjection===e)return this;let i=(0,t.getElements)(".active-parent",this.body);for(let t=0;t<i.length;t++)i[t].classList.remove("active-parent");this.activeProjection=e;let n=this.activeProjection.parent;for(;n;)n.getContainer().classList.add("active-parent"),n=n.parent;return this.triggerEvent({name:"editor.projection@active:updated"}),this.refresh(),this},updateActiveInstance(t){if(this.activeInstance){if(this.activeInstance===t)return this;this.activeInstance,this.activeInstance.container.classList.remove("active")}return this.activeInstance=t,this.activeInstance.container.classList.add("active"),this.triggerEvent({name:"editor.instance@active:updated"}),this.refresh(),this},registerReceiver(e,i){(0,t.isNullOrUndefined)(this.receivers)&&(this.receivers={}),(0,t.isNullOrUndefined)(this.receivers[i])?this.receivers[i]={root:e,projections:[e]}:this.receivers[i].projections.push(e),this.setActiveReceiver(e,i)},setActiveReceiver(e,i){(0,t.isNullOrUndefined)(this.activeReceiver)&&(this.activeReceiver={}),this.activeReceiver[i]=e},getActiveReceiver(t){return this.activeReceiver[t]},getReceivers(t){return this.receivers[t].projections},getRootReceiver(t){return this.receivers[t].root},bindEvents(){var i=null,n=null;const r={[e.sr.up_arrow]:"up",[e.sr.right_arrow]:"right",[e.sr.down_arrow]:"down",[e.sr.left_arrow]:"left"};this.container.addEventListener("click",(i=>{var n=(0,e.NI)(i.target);const{action:r,context:s,id:a}=n.dataset;if("instance"===s)return void this.getInstance(a).actionHandler(r);if("menu"===s)return void this.home.actionHandler(r,n);if(this.activeElement&&this.activeElement.clickHandler(n),(0,t.isNullOrUndefined)(r))return;if(this.actions.has(r))return this.actions.get(r).call(this,n),void n.blur();const o=Ba[r];(0,t.isFunction)(o)?(o(n),n.blur()):r&&this.triggerEvent({name:r,args:n})}),!0),this.input.addEventListener("change",(t=>{let e=this.input.files[0];this.load(e,n),this.input.value=""})),this.body.addEventListener("copy",(t=>{if(!(0,e.QE)(t.target)){let e=this.activeConcept.copy(!1);this.copy(e,!0),t.preventDefault()}})),this.body.addEventListener("keydown",(n=>{const{target:s}=n,{nature:a}=s.dataset;var o=!1;switch(n.key){case e.sr.backspace:this.activeElement&&i!==e.sr.ctrl&&!0===this.activeElement.backspaceHandler(s)&&n.preventDefault();break;case e.sr.ctrl:case e.sr.shift:n.preventDefault(),o=!0;break;case e.sr.delete:this.activeElement&&i!==e.sr.ctrl&&!(0,e.QE)(s)&&this.activeElement.deleteHandler(s)&&n.preventDefault();break;case e.sr.spacebar:this.activeElement&&i!==e.sr.ctrl&&this.activeElement.spaceHandler(s)&&n.preventDefault();break;case e.sr.alt:n.preventDefault();break;case e.sr.enter:this.activeElement?!0===this.activeElement.enterHandler(s)&&n.preventDefault():"concept-container"===a?this.activeInstance.projection.focus():"editable"===a?s.blur():"BUTTON"===s.tagName?(s.click(),n.preventDefault()):n.preventDefault();break;case e.sr.escape:this.activeElement&&(!0===this.activeElement.escapeHandler(s)?n.preventDefault():(0,t.findAncestor)(s,(t=>0===t.tabIndex)).focus());break;case e.sr.insert:this.activeElement&&n.preventDefault();break;case e.sr.up_arrow:case e.sr.right_arrow:case e.sr.down_arrow:case e.sr.left_arrow:if(this.activeElement&&![e.sr.ctrl,e.sr.shift,e.sr.alt].includes(i))!0===this.activeElement.arrowHandler(r[n.key],s)&&n.preventDefault();else if("concept-container"===a&&![e.sr.ctrl,e.sr.shift,e.sr.alt].includes(i)){let i=(0,e.As)(s,r[n.key],this.instanceSection);if(!(0,t.isHTMLElement)(i))return!1;i.focus()}break;case"s":i===e.sr.ctrl&&(this.activeConcept.copy(),this.header.valueCount++,this.refresh(),n.preventDefault());break;case"c":if(i===e.sr.ctrl){let t=new ClipboardEvent("copy");this.body.dispatchEvent(t)}break;case"v":if(i===e.sr.ctrl){if((0,e.QE)(s))return;this.paste(this.activeConcept,this.copyValue)}break;case"e":i===e.sr.ctrl&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{type:"projection",close:"DELETE-PROJECTION"}),n.preventDefault());break;case"f":break;case"z":i===e.sr.ctrl&&((0,e.QE)(s)||(this.undo(),n.preventDefault()))}o&&(i=n.key)}),!1),this.body.addEventListener("keyup",(n=>{var s=n.target;const{nature:a}=s.dataset;switch(n.key){case e.sr.spacebar:this.activeElement&&i===e.sr.ctrl&&this.activeElement._spaceHandler(s);break;case e.sr.delete:this.activeElement&&i===e.sr.ctrl&&this.activeElement.delete(s);break;case e.sr.alt:break;case e.sr.up_arrow:case e.sr.down_arrow:case e.sr.right_arrow:case e.sr.left_arrow:if(this.activeElement&&i===e.sr.ctrl)!0===this.activeElement._arrowHandler(r[n.key],s)&&n.preventDefault();else if("concept-container"===a&&i===e.sr.ctrl){let a=(0,e.As)(s,r[n.key],this.instanceSection);if(!(0,t.isHTMLElement)(a))return!1;this.swapInstance(s,a,!0),s.focus(),i=e.sr.ctrl}}i===n.key&&(i=-1)}),!1),this.body.addEventListener("focusin",(t=>{const{target:e}=t,n=this.resolveElement(e);if(i=-1,n?(this.activeElement&&this.activeElement!==n&&(this.activeElement.focusOut(),this.activeElement=null),this.updateActiveElement(n),this.activeElement.focusIn(e)):(this.activeElement&&this.activeElement.focusOut(e),this.activeElement=null),this.activeElement){let t=this.activeElement.projection;this.updateActiveProjection(t),this.updateActiveConcept(t.concept)}else this.activeConcept=null,this.activeProjection=null;this.refresh()})),this.registerHandler("value.changed",(()=>this.refresh())),this.registerHandler("value.added",(()=>this.refresh())),this.registerHandler("value.removed",(()=>this.refresh())),this.registerHandler("export.model",(()=>this.exporter.open())),this.registerHandler("home",(t=>{this.home.toggle()})),this.registerHandler("logs",(t=>{this.logs.toggle()})),this.registerHandler("export",(t=>{this.export()})),this.registerHandler("load",(t=>{let e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(e)})),this.registerHandler("load-resource",(t=>{let e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n=t[0],this.input.dispatchEvent(e)})),this.registerHandler("load-concept",(t=>{let e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(e)})),this.registerHandler("load-projection",(t=>{let e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(e)})),this.registerHandler("unload",(t=>{this.unload()})),this.registerHandler("unload-concept",(t=>{this.unloadAllConcept()})),this.registerHandler("unload-projection",(t=>{this.unloadAllProjection()})),this.registerHandler("download-concept",(t=>{const{schema:e,values:i}=this.conceptModel;let n=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({concept:e},`${n}_model`,"JSON")})),this.registerHandler("open",(t=>{const{context:e}=t.dataset;e?this[e].open():this.open()})),this.registerHandler("close",(t=>{const{context:e,id:i,type:n}=t.dataset;e?this[e].close():this.close()})),this.registerHandler("collapse",(e=>{const{rel:i,target:n}=e.dataset;if("parent"===i){let i=(0,t.findAncestor)(e,(t=>t.dataset.name===n));if((0,t.isHTMLElement)(i)){const{alias:t=""}=i.dataset;i.classList.toggle("collapsed");let n=i.classList.contains("collapsed");e.dataset.state=n?"ON":"OFF",e.title=n?`Expand ${t.toLowerCase()}`:`Collapse ${t.toLowerCase()}`}}})),this.registerHandler("delete",(e=>{const{target:i}=e.dataset;if("parent"===i){let i=e.parentElement;(0,t.removeChildren)(i),i.remove()}})),this.registerHandler("create-instance",(t=>{const{concept:e}=t.dataset;let i=this.createConcept(e);this.createInstance(i)})),this.registerHandler("create-instance:value",(t=>{const{id:e}=t.dataset;let i=this.conceptModel.getValue(e),n=this.createConcept(i.name);n.initValue(i),this.createInstance(n)})),this.registerHandler("copy:value",(t=>{const{id:e}=t.dataset;let i=this.conceptModel.getValue(e);this.copy(i)}))}},$a=Object.assign(Va,Ha,Da,R,Ba,za);Object.defineProperty($a,"hasConceptModel",{get(){return!(0,t.isNullOrUndefined)(this.conceptModel)}}),Object.defineProperty($a,"hasProjectionModel",{get(){return!(0,t.isNullOrUndefined)(this.projectionModel)}}),Object.defineProperty($a,"hasInstances",{get(){return this.instances.size>0}}),Object.defineProperty($a,"hasWindows",{get(){return this.windows.size>0}}),Object.defineProperty($a,"hasValues",{get(){return this.values.size>0}}),Object.defineProperty($a,"isReady",{get(){return this.hasConceptModel&&this.hasProjectionModel}}),Object.defineProperty($a,"hasActiveConcept",{get(){return!(0,t.isNullOrUndefined)(this.activeConcept)}}),Object.defineProperty($a,"hasActiveProjection",{get(){return!(0,t.isNullOrUndefined)(this.activeProjection)}}),Object.defineProperty($a,"hasActiveInstance",{get(){return!(0,t.isNullOrUndefined)(this.activeInstance)}}),Object.defineProperty($a,"hasError",{get(){return!(0,t.isEmpty)(this.errors)}});const Fa="editor";function qa(i){const n=(0,e.fP)(i),r=(e=>(0,t.isHTMLElement)(e)&&(0,t.hasOwn)(e.dataset,"gentleman"))(n)?[n]:(0,t.getElements)('[data-gentleman="editor"]',n),s=[];return r.forEach((t=>{s.push(Wa(t))})),s}function Wa(i){let n=(0,e.fP)(i);return(0,t.isHTMLElement)(i)||(n=(0,t.createDiv)({tabindex:-1})),n.classList.add("gentleman-editor"),n.dataset.gentleman=Fa,Object.create($a,{object:{value:"environment"},type:{value:Fa},name:{value:"gentleman editor"},container:{value:n}})}})(),r})()}));