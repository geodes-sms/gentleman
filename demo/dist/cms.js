(()=>{"use strict";var e={145:e=>{e.exports=JSON.parse('{"name":"GEODES","description":"GEODES was founded as part of DIRO in 1992. It was then called GÉLO and changed to GEODES in 2005. Since then, more than 30 students have obtained a PhD degree from the group, and more then a 100 students have graduated with a Master\'s degree. Many of these students are professors in Quebec, Canada, and around the world (ÉTS, Laval, Polytechnique, UQAM, Ottawa, DePaul, Houston, Indiana, Michigan, United Arab Emirates, etc.), and others hold key positions at large tech companies. GEODES is very scientifically very active group with over 20 publications per year in journals, conference proceedings and book chapters.","website":"https://geodes.iro.umontreal.ca/","twitter":"UMontrealGEODES","email":"geodes@iro.umontreal.ca","phone":"","socials":{"twitter":"UMontrealGEODES"}}')},871:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"name":"boolean"},"tags":["switch-field"],"type":"field","content":{"type":"binary","checkbox":{"label":{"content":[{"type":"property","name":"refname"}],"style":{"css":["switch-field__label"]}},"style":{"css":["switch-field__checkbox"]}},"style":{"css":["switch-field"]}}},{"concept":{"name":"string"},"type":"field","tags":["tag"],"content":{"type":"text","resizable":true,"input":{"type":"text","placeholder":"tag","style":{"css":["pp-tagbox__input"]}},"style":{"css":["pp-tagbox"]}}},{"concept":{"name":"string"},"type":"field","tags":["textbox"],"content":{"type":"text","input":{"type":"text","placeholder":{"type":"property","name":"label"},"style":{"css":["pp-textbox__input"]}},"style":{"css":["pp-textbox"]}}},{"concept":{"name":"string"},"type":"field","tags":["textbox-label"],"content":{"type":"text","container":{"type":"flex","orientation":"row","content":[{"type":"static","static":{"type":"text","content":{"type":"property","name":"label"},"style":{"css":["pp-textbox2__label"]}}},{"type":"input","input":{"type":"text","placeholder":{"type":"property","name":"placeholder"},"style":{"css":["pp-textbox2__input"]}}}],"style":{"css":["pp-textbox2"]}}}},{"concept":{"name":"string"},"type":"field","tags":["textarea"],"content":{"type":"text","multiline":true,"input":{"type":"text","placeholder":"Enter a description","style":{"css":["pp-textarea__input"]}},"style":{"css":["pp-textarea"]}}},{"concept":{"name":"string"},"type":"field","tags":["textarea-label"],"field":{"type":"text","multiline":true,"container":{"content":[{"type":"static","static":{"type":"text","content":{"type":"property","name":"label"},"style":{"css":["pp-textarea2__label"]}}},{"type":"input","multiline":true,"input":{"type":"text","placeholder":"Enter a description","style":{"css":["pp-textarea2__input"]}}}],"layout":{"type":"flex","orientation":"row","wrappable":true}},"style":{"css":["pp-textarea2"]}}},{"concept":{"name":"number"},"type":"field","tags":["textbox-label"],"content":{"type":"text","container":{"type":"flex","orientation":"row","content":[{"type":"static","static":{"type":"text","content":{"type":"property","name":"label"},"style":{"css":["pp-textbox2__label"]}}},{"type":"input","input":{"type":"number","placeholder":{"type":"property","name":"placeholder"},"style":{"css":["pp-textbox2__input"]}}}],"style":{"css":["pp-textbox2"]}}}},{"concept":{"name":"string"},"type":"static","tags":["text"],"content":{"type":"text","content":{"type":"property","name":"value"},"style":{"css":["pp-text"]}}},{"concept":{"name":"string"},"type":"static","tags":["email"],"content":{"type":"link","urlType":"email","url":{"type":"property","name":"value"},"content":[{"type":"property","name":"value"}],"style":{"css":["pp-email"]}}},{"concept":{"name":"string"},"type":"static","tags":["url"],"content":{"type":"link","urlType":"link","url":{"type":"property","name":"value"},"content":[{"type":"property","name":"value"}],"style":{"css":["pp-email"]}}},{"concept":{"name":"string"},"type":"static","tags":["image"],"content":{"type":"image","url":{"type":"property","name":"value"},"style":{"css":["pp-image"]}}},{"concept":{"name":"set"},"type":"field","tags":["tags"],"content":{"type":"list","list":{"item":{"template":{"tag":"tag"},"style":{"css":["pp-tag-set__list-item"]}},"style":{"css":["pp-tag-set__list"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-tag-set__btn-remove"]}}}}},{"concept":{"name":"set"},"type":"field","tags":["areas"],"content":{"type":"list","list":{"item":{"template":{"tag":"edit-view"},"style":{"css":["pp-set__list-item"]}},"style":{"css":["pp-set__list"]}},"action":{"add":false,"remove":false}}}]}')},353:e=>{e.exports=JSON.parse('{"concept":[{"name":"organization","nature":"prototype","root":true,"attributes":[{"name":"name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Name"}]},"required":true},{"name":"description","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Description"}]},"required":true},{"name":"members","target":{"name":"set","accept":{"name":"person"}},"required":true},{"name":"photo","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Photo URL"}]},"required":false},{"name":"address","target":{"name":"address"},"required":false},{"name":"email","target":{"name":"email","properties":[{"name":"label","type":"string","value":"Email"}]},"required":false},{"name":"socials","target":{"name":"set","accept":{"name":"social"}}},{"name":"website","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Website"}]},"required":false},{"name":"phone","target":{"name":"phone","properties":[{"name":"label","type":"string","value":"Phone"}]},"required":false}],"properties":[]},{"name":"default-organization","nature":"concrete","root":true,"prototype":"organization","attributes":[],"properties":[]},{"name":"research-organization","nature":"concrete","prototype":"organization","root":true,"attributes":[{"name":"areas","target":{"name":"set","accept":{"name":"area"}}},{"name":"projects","target":{"name":"set","accept":{"name":"project"}}},{"name":"tools","target":{"name":"set","accept":{"name":"tool"}}}],"properties":[]},{"name":"social","nature":"concrete","root":false,"attributes":[{"name":"name","target":{"name":"string","src":["twitter","facebook","linkedin","youtube","instagram","tiktok"]},"required":true},{"name":"handle","target":{"name":"string"},"required":true}],"properties":[]},{"name":"area","nature":"concrete","root":false,"attributes":[{"name":"title","target":{"name":"string"},"required":true},{"name":"description","target":{"name":"string"},"required":false},{"name":"tags","target":{"name":"set","accept":{"name":"string"}}}],"properties":[]},{"name":"address","nature":"concrete","root":false,"attributes":[{"name":"street-address","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Street address"}]},"required":true},{"name":"locality","target":{"name":"string","properties":[{"name":"label","type":"string","value":"City"}]},"required":true},{"name":"region","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Province"}]},"required":true},{"name":"country","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Country"}]},"required":true},{"name":"postal-code","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Postal code"}]},"required":true}],"properties":[]},{"name":"name","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":1}}}}},{"name":"email","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":5},"max":{"value":255}}}}},{"name":"phone","nature":"derivative","root":false,"base":"string","constraint":{"value":{"type":"pattern","pattern":{"insensitive":true,"global":true,"value":"^\\\\(?([0-9]{3})\\\\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$"}}}}]}')},369:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["general"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"name","tag":"textbox-label","style":{"css":["pp-wrap-element","pp-wrap-element--2"]}},{"type":"attribute","name":"email","tag":"textbox-label","required":true,"style":{"css":["pp-wrap-element"]}},{"type":"attribute","name":"website","tag":"textbox-label","required":true,"style":{"css":["pp-wrap-element"]}}],"style":{"css":["pp-wrap"]},"layout":{"type":"flex","orientation":"row","wrappable":false}},{"type":"attribute","name":"description","tag":"textarea-label","style":{"ref":["box-top"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Social media","style":{"css":["pp-subtitle"]}},{"kind":"static","type":"button","name":"add-area","action":{"type":"CREATE","target":{"type":"attribute","name":"socials"}},"help":"Add a social account","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"socials","tag":"areas","style":{"css":["areas"],"ref":["box-top"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Areas of research","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-area","action":{"type":"CREATE","target":{"type":"attribute","name":"areas"}},"help":"Add an area","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"areas","tag":"areas","style":{"css":["areas"],"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"address"},"tags":[],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"street-address","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"]}},{"type":"attribute","name":"locality","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}},{"type":"attribute","name":"region","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"container","content":[{"type":"attribute","name":"postal-code","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"]}},{"type":"attribute","name":"country","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup","pp-fieldgroup--50"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-address"]},"focusable":true}},{"concept":{"name":"area"},"tags":["edit-view"],"container":{"content":[{"kind":"static","type":"text","content":"Area","style":{"css":["pp-area-title"]}},{"type":"attribute","name":"title","tag":"textbox","options":{"placeholder":"Title"},"style":{"ref":["box-top"]}},{"type":"attribute","name":"description","tag":"textarea","required":true,"style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-area","pp-area--edit"]},"focusable":true}},{"concept":{"name":"social"},"tags":["edit-view"],"container":{"content":[{"type":"attribute","name":"name","tag":"textbox","options":{"placeholder":"Media"},"style":{"css":["pp-social-name"]}},{"type":"attribute","name":"handle","tag":"textbox","options":{"placeholder":"Handle"},"style":{"css":["pp-social-handle"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-social"]},"focusable":true}}],"template":[],"style":[{"type":"style","name":"box-top","style":{"box":{"outer":{"top":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-right","style":{"box":{"outer":{"right":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-left","style":{"box":{"outer":{"left":{"value":6,"unit":"px"}}}}}]}')},477:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["general"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"name","tag":"text","style":{"css":["pp-wrap-element","pp-wrap-element--2"]}},{"type":"attribute","name":"email","tag":"text","required":true,"style":{"css":["pp-wrap-element"]}},{"type":"attribute","name":"website","tag":"text","required":true,"style":{"css":["pp-wrap-element"]}}],"style":{"css":["pp-wrap"]},"layout":{"type":"flex","orientation":"row","wrappable":false}},{"type":"attribute","name":"description","tag":"textarea-label","style":{"ref":["box-top"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Social media","style":{"css":["pp-subtitle"]}},{"kind":"static","type":"button","name":"add-area","action":{"type":"CREATE","target":{"type":"attribute","name":"socials"}},"help":"Add a social account","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"socials","tag":"areas","style":{"css":["areas"],"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"address"},"tags":[],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"street-address","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"]}},{"type":"attribute","name":"locality","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}},{"type":"attribute","name":"region","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"container","content":[{"type":"attribute","name":"postal-code","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"]}},{"type":"attribute","name":"country","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup","pp-fieldgroup--50"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-address"]},"focusable":true}},{"concept":{"name":"area"},"tags":["edit-view"],"container":{"content":[{"kind":"static","type":"text","content":"Area","style":{"css":["pp-area-title"]}},{"type":"attribute","name":"title","tag":"textbox","options":{"placeholder":"Title"},"style":{"ref":["box-top"]}},{"type":"attribute","name":"description","tag":"textarea","required":true,"style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-area","pp-area--edit"]},"focusable":true}},{"concept":{"name":"social"},"tags":["edit-view"],"container":{"content":[{"type":"attribute","name":"name","tag":"textbox","options":{"placeholder":"Media"},"style":{"css":["pp-social-name"]}},{"type":"attribute","name":"handle","tag":"textbox","options":{"placeholder":"Handle"},"style":{"css":["pp-social-handle"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-social"]},"focusable":true}}],"template":[],"style":[{"type":"style","name":"box-top","style":{"box":{"outer":{"top":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-right","style":{"box":{"outer":{"right":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-left","style":{"box":{"outer":{"left":{"value":6,"unit":"px"}}}}}]}')},787:e=>{e.exports=JSON.parse('{"concept":[{"name":"person","nature":"concrete","root":true,"attributes":[{"name":"first-name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"First name"}]},"required":true},{"name":"last-name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Last name"}]},"required":true},{"name":"email","target":{"name":"email","properties":[{"name":"label","type":"string","value":"Email address"}]},"required":true},{"name":"website","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Website"}]},"required":true},{"name":"phone","target":{"name":"phone","properties":[{"name":"label","type":"string","value":"Phone number"}]},"required":true},{"name":"position","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Position"}]},"required":true},{"name":"occupation","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Occupation"}]},"required":true},{"name":"photo","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Photo URL"}]},"required":false},{"name":"address","target":{"name":"address"},"required":false},{"name":"birth-date","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Birthdate"}]},"required":false},{"name":"affiliations","target":{"name":"set","accept":{"name":"affiliation"}},"required":false}],"properties":[]},{"name":"affiliation","nature":"concrete","root":false,"attributes":[{"name":"name","target":{"name":"string"},"required":true},{"name":"role","target":{"name":"string"},"required":true}],"properties":[]},{"name":"name","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":1}}}}},{"name":"email","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":5},"max":{"value":255}}}}},{"name":"phone","nature":"derivative","root":false,"base":"string","constraint":{"value":{"type":"pattern","pattern":{"insensitive":true,"global":true,"value":"^\\\\(?([0-9]{3})\\\\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$"}}}}]}')},498:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["people"],"container":{"content":[{"type":"container","content":[{"kind":"static","type":"text","content":"Members","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-member","action":{"type":"CREATE","target":{"type":"attribute","name":"members"}},"help":"Add a member","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"members","tag":"view-table","style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"person"},"tags":["table-view","table-view--read"],"container":{"content":[{"type":"attribute","name":"first-name","tag":"text"},{"type":"attribute","name":"last-name","tag":"text","style":{"text":{"transform":"uppercase"},"ref":["box-left"]}},{"type":"attribute","name":"occupation","tag":"text"},{"type":"attribute","name":"website","tag":"url"},{"type":"attribute","name":"email","tag":"email"},{"type":"attribute","name":"phone","tag":"text","style":{"css":["phone"]}},{"kind":"static","type":"plink","tag":"table-view--edit","content":[],"style":{"css":["pp__btn-edit"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-person","pp-person--row","read"]},"focusable":true}},{"concept":{"name":"person"},"tags":["table-view","table-view--edit"],"container":{"content":[{"type":"attribute","name":"first-name","tag":"textbox","options":{"placeholder":"First name"}},{"type":"attribute","name":"last-name","tag":"textbox","options":{"placeholder":"Last name"}},{"type":"attribute","name":"occupation","tag":"textbox","options":{"placeholder":"Occupation"}},{"type":"attribute","name":"website","tag":"textbox","options":{"placeholder":"URL"}},{"type":"attribute","name":"email","options":{"placeholder":"Email address"},"tag":"textbox"},{"type":"attribute","name":"phone","tag":"textbox","options":{"placeholder":"Phone number"},"style":{"css":["phone"]}},{"kind":"static","type":"plink","tag":"table-view--read","content":[{"type":"raw","raw":"Done!"}],"style":{"css":["pp-navlink"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-person","pp-person--row"]},"focusable":true}},{"concept":{"name":"person"},"tags":["card-view","card-view--read"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"photo","tag":"image"}],"layout":{"type":"flex","orientation":"row","wrappable":true},"style":{"css":["pp-person-image"]}},{"type":"container","content":[{"type":"container","content":[{"type":"attribute","name":"first-name","tag":"text","style":{"css":["first-name"]}},{"type":"attribute","name":"last-name","tag":"text","style":{"text":{"transform":"uppercase"},"box":{"outer":{"left":{"value":3,"unit":"px"}}}}}],"layout":{"type":"flex","orientation":"row","wrappable":true},"style":{"css":["pp-combi-name"]}},{"type":"attribute","name":"occupation","tag":"text","style":{"text":{"bold":500}}},{"type":"attribute","name":"email","tag":"email"},{"type":"attribute","name":"phone","tag":"text"},{"kind":"static","type":"plink","tag":"card-view--edit","content":[],"style":{"css":["pp__btn-edit"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-person-info"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-person","pp-person--read"]},"focusable":true}},{"concept":{"name":"person"},"tags":["card-view","card-view--edit"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"first-name","tag":"textbox-label"},{"type":"attribute","name":"last-name","tag":"textbox-label","style":{"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"attribute","name":"occupation","tag":"textbox-label","style":{"ref":["box-top"]}},{"type":"attribute","name":"email","tag":"textbox-label","style":{"ref":["box-top"]}},{"type":"attribute","name":"phone","tag":"textbox-label","style":{"ref":["box-top"]}},{"type":"attribute","name":"photo","tag":"textbox-label","required":true,"style":{"ref":["box-top"]}},{"kind":"static","type":"plink","tag":"card-view--read","content":[{"type":"raw","raw":"Done!"}],"style":{"ref":["box-top"],"css":["pp-navlink"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-person","pp-person--edit"]},"focusable":true}},{"concept":{"name":"set"},"tags":["view-table"],"type":"container","container":{"content":[{"type":"template","name":"tpl-view-options","param":[{"name":"selected","value":"table"}]},{"kind":"field","type":"list","list":{"item":{"template":{"tag":"table-view"},"style":{"css":["pp-person-set__rowlist-item"]}},"style":{"css":["pp-person-set__rowlist"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-person-set__btn-remove"]}}}}],"layout":{"type":"flex","orientation":"column"}}},{"concept":{"name":"set"},"tags":["view-grid"],"type":"container","container":{"content":[{"type":"template","name":"tpl-view-options","param":[{"name":"selected","value":"grid"}]},{"kind":"field","type":"list","list":{"item":{"template":{"tag":"card-view"},"style":{"css":["pp-person-set__list-item"]}},"style":{"css":["pp-person-set__list"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-person-set__btn-remove"]}}}}],"layout":{"type":"flex","orientation":"column"}}}],"template":[{"type":"template","name":"tpl-view-options","param":[{"name":"selected","type":"string"}],"content":[{"type":"container","content":[{"kind":"static","type":"plink","tag":"view-table","content":[{"kind":"static","type":"text","content":"Row","style":{"css":["pp-viewnav__link-text"]}}],"style":{"css":["pp-viewnav__link","pp-viewnav__link--table"]}},{"kind":"static","type":"plink","tag":"view-grid","content":[{"kind":"static","type":"text","content":"Card","style":{"css":["pp-viewnav__link-text"]}}],"style":{"css":["pp-viewnav__link","pp-viewnav__link--grid"]}}],"style":{"html":[{"name":"view","value":{"type":"param","name":"selected"}}],"css":["pp-viewnav"]},"layout":{"type":"flex","orientation":"row"}}]}],"style":[{"type":"style","name":"box-top","style":{"box":{"outer":{"top":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-right","style":{"box":{"outer":{"right":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-left","style":{"box":{"outer":{"left":{"value":6,"unit":"px"}}}}}]}')},82:e=>{e.exports=JSON.parse('{"concept":[{"name":"project","nature":"concrete","root":true,"attributes":[{"name":"name","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Name"}]},"required":true},{"name":"description","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Description"}]},"required":true},{"name":"start-date","target":{"name":"number","properties":[{"name":"label","type":"string","value":"Start year"}]},"required":true},{"name":"end-date","target":{"name":"number","properties":[{"name":"label","type":"string","value":"End year"}]},"required":true},{"name":"partners","target":{"name":"set","accept":{"name":"partner"},"properties":[{"name":"label","type":"string","value":"Partners"}]},"required":true},{"name":"funding","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Funding"}]},"required":true},{"name":"logo","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Logo"}]},"required":false}],"properties":[]},{"name":"partner","nature":"concrete","root":false,"attributes":[{"name":"name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Name"}]},"required":true},{"name":"description","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Description"}]},"required":true},{"name":"website","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Website"}]},"required":false}],"properties":[]}]}')},140:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["project"],"container":{"content":[{"type":"container","content":[{"kind":"static","type":"text","content":"Projects","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-project","action":{"type":"CREATE","target":{"type":"attribute","name":"projects"}},"help":"Add a project","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"projects","tag":"view-box","style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"project"},"tags":["card-view"],"container":{"content":[{"type":"attribute","name":"name","tag":"textbox-label"},{"type":"attribute","name":"description","tag":"textarea-label","style":{"ref":["box-top"]}},{"type":"container","content":[{"type":"attribute","name":"start-date","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"]}},{"type":"attribute","name":"end-date","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}},{"type":"attribute","name":"funding","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Partners","style":{"css":["pp-subtitle"]}},{"kind":"static","type":"button","name":"add-area","action":{"type":"CREATE","target":{"type":"attribute","name":"partners"}},"help":"Add a partner","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"partners","tag":"partners","style":{"css":["areas"],"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-project","pp-project--edit"]},"focusable":true}},{"concept":{"name":"partner"},"tags":["edit-view"],"container":{"content":[{"kind":"static","type":"text","content":"Partner","style":{"css":["pp-area-title"]}},{"type":"attribute","name":"name","tag":"textbox","options":{"placeholder":"name"}},{"type":"attribute","name":"description","tag":"textarea","required":true,"style":{"ref":["box-top"]}},{"type":"attribute","name":"website","tag":"textbox","required":true,"options":{"placeholder":"URL"},"style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-area","pp-area--edit"]},"focusable":true}},{"concept":{"name":"set"},"tags":["view-box"],"type":"container","container":{"content":[{"kind":"field","type":"list","list":{"item":{"template":{"tag":"card-view"},"style":{"css":["pp-person-set__list-item"]}},"style":{"css":["pp-person-set__list"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-person-set__btn-remove"]}}}}],"layout":{"type":"flex","orientation":"column"}}},{"concept":{"name":"set"},"type":"field","tags":["partners"],"content":{"type":"list","list":{"item":{"template":{"tag":"edit-view"},"style":{"css":["pp-set__list-item"]}},"style":{"css":["pp-set__list"]}},"action":{"add":false,"remove":false}}}],"template":[],"style":[]}')},874:e=>{e.exports=JSON.parse('{"concept":[{"name":"tool","nature":"concrete","root":true,"attributes":[{"name":"name","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Name"}]},"required":true},{"name":"description","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Description"}]},"required":true},{"name":"start-date","target":{"name":"number","properties":[{"name":"label","type":"string","value":"Start year"}]},"required":true},{"name":"responsable","target":{"name":"reference","accept":{"name":"person"},"properties":[{"name":"label","type":"string","value":"URL"}]},"required":true},{"name":"contributors","target":{"name":"set","accept":{"name":"partner"},"properties":[{"name":"label","type":"string","value":"Partners"}]},"required":true},{"name":"active","target":{"name":"boolean"},"required":true},{"name":"url","target":{"name":"string","properties":[{"name":"label","type":"string","value":"URL"}]},"required":true},{"name":"logo","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Logo"}]},"required":false}],"properties":[]}]}')},661:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["tool"],"container":{"content":[{"type":"container","content":[{"kind":"static","type":"text","content":"Tools","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-project","action":{"type":"CREATE","target":{"type":"attribute","name":"tools"}},"help":"Add a project","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"tools","tag":"view-box","style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"tool"},"tags":["card-view"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"name","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"attribute","name":"description","tag":"textarea-label","style":{"ref":["box-top"]}},{"type":"container","content":[{"type":"attribute","name":"start-date","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"]}},{"type":"attribute","name":"url","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-project","pp-project--edit"]},"focusable":true}}],"template":[],"style":[]}')},835:(e,t,i)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function h(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?w(e)?t:e:x(e)?t:e}function u(e){return g(e)&&0===e.length}function d(e){return e instanceof Date||"object"===s(e)&&"[object Date]"===Object.prototype.toString.call(e)}function p(e){return"string"==typeof e||e instanceof String}function m(e){return"function"==typeof e}function f(e){return!x(e)&&"object"===s(e)}function g(e){return!x(e)&&"function"==typeof e[Symbol.iterator]}function b(e){return g(e)&&!p(e)}function v(e){return null===e}function y(e){return!e||p(e)&&(0===e.length||/^\s*$/.test(e))}function w(e){return void 0===e}function x(e){return v(e)||w(e)}function E(e,t,i){if(!Array.isArray(e)||!Number.isInteger(t))throw new TypeError("Bad argument");return e.splice(t,0,i),e.length}function A(e){if(!Array.isArray(e))throw new TypeError("Bad argument");if(!u(e))return e[e.length-1]}function O(e){if(!Array.isArray(e))throw new TypeError("Bad argument");return e[0]}i.r(t),i.d(t,{Accordion:()=>As,Collapsible:()=>Es,DELETE:()=>C,GET:()=>j,POST:()=>L,PUT:()=>S,Selector:()=>ts,SelectorFactory:()=>is,Switch:()=>us,addAttributes:()=>Ue,addPath:()=>ae,all:()=>Z,appendChildren:()=>Se,assert:()=>G,boolToInt:()=>Y,camelCase:()=>W,capitalize:()=>$,capitalizeFirstLetter:()=>F,changeSelectValue:()=>De,cloneObject:()=>R,cloneTemplate:()=>Ei,compareTime:()=>I,copytoClipboard:()=>Ci,createAbbreviation:()=>Bt,createAnchor:()=>gt,createArea:()=>bt,createArticle:()=>We,createAside:()=>Ye,createAudio:()=>wt,createB:()=>Pt,createBase:()=>vt,createBlockQuotation:()=>lt,createButton:()=>ri,createCaption:()=>oi,createCite:()=>$t,createCode:()=>qt,createDataList:()=>ti,createDeletedPart:()=>Ut,createDescriptionDetails:()=>ft,createDescriptionList:()=>pt,createDescriptionTerm:()=>mt,createDiv:()=>it,createDocFragment:()=>He,createEmbed:()=>nt,createEmphasis:()=>St,createFieldset:()=>Zt,createFigure:()=>Nt,createFigureCaption:()=>kt,createFooter:()=>qe,createForm:()=>zt,createH1:()=>Je,createH2:()=>Ge,createH3:()=>Qe,createH4:()=>Ze,createH5:()=>et,createH6:()=>tt,createHeader:()=>Fe,createI:()=>Ht,createImage:()=>yt,createInput:()=>Wt,createInsertedPart:()=>Dt,createLabel:()=>Xt,createLegend:()=>ei,createLineBreak:()=>rt,createLink:()=>Re,createListItem:()=>dt,createMain:()=>ze,createMark:()=>Ct,createMeter:()=>ii,createNav:()=>Xe,createObject:()=>st,createOption:()=>Jt,createOptionGroup:()=>Qt,createOrderedList:()=>ut,createOutput:()=>ni,createParagraph:()=>ot,createPicture:()=>Ot,createProgress:()=>si,createQuote:()=>_t,createS:()=>Vt,createSample:()=>Tt,createSection:()=>Ke,createSelect:()=>Yt,createSource:()=>Et,createSpan:()=>jt,createStrong:()=>Lt,createSubscript:()=>It,createSuperscript:()=>Mt,createTable:()=>ai,createTableBody:()=>hi,createTableCell:()=>gi,createTableColumn:()=>di,createTableColumnGroup:()=>pi,createTableFooter:()=>ui,createTableHeader:()=>ci,createTableHeaderCell:()=>fi,createTableRow:()=>mi,createTemplate:()=>$e,createTextArea:()=>Kt,createTextNode:()=>Ve,createThematicBreak:()=>at,createTime:()=>Ft,createTrack:()=>At,createU:()=>Rt,createUnorderedList:()=>ht,createVideo:()=>xt,fetchWithTimeout:()=>T,findAncestor:()=>ki,findByPath:()=>he,first:()=>O,floatingLabel:()=>Mi,formatCase:()=>z,formatDate:()=>U,getDir:()=>oe,getDirTarget:()=>le,getElement:()=>yi,getElements:()=>wi,getNextElementSibling:()=>Ni,getPreviousElementSibling:()=>Oi,getRootUrl:()=>Ns,getTemplate:()=>xi,getUrlParams:()=>ks,hasOwn:()=>H,htmlToElement:()=>Ee,htmlToElements:()=>Ae,inputCounter:()=>Ui,insert:()=>E,insertAfterElement:()=>je,insertBeforeElement:()=>ke,isCollection:()=>b,isDate:()=>d,isDerivedOf:()=>V,isDocumentFragment:()=>we,isElement:()=>ge,isEmpty:()=>u,isFunction:()=>m,isHTMLCollection:()=>ye,isHTMLElement:()=>be,isInElement:()=>Ne,isInViewport:()=>Oe,isIterable:()=>g,isNode:()=>me,isNodeList:()=>fe,isNull:()=>v,isNullOrUndefined:()=>x,isNullOrWhitespace:()=>y,isObject:()=>f,isString:()=>p,isUndefined:()=>w,last:()=>A,lone:()=>ie,no:()=>te,one:()=>ee,pascalCase:()=>K,preprendChild:()=>Le,queryBuilder:()=>js,random:()=>ne,removeAccents:()=>X,removeChildren:()=>Si,resolveDate:()=>M,shortDate:()=>D,shortDateTime:()=>_,some:()=>Q,toBoolean:()=>J,valOrDefault:()=>h,windowHeight:()=>de,windowWidth:()=>ue});var N={OK:200,Created:201,Accepted:202,NoContent:204,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,UnsupportedMediaType:415,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavaible:503,GatewayTimeout:504},k=function(e,t,i,s,n,r){var a=new XMLHttpRequest;return a.onreadystatechange=function(){var e;if(4===a.readyState){var t=function(e,t){return{status:e,message:t}}(a.status,a.responseText);i(a.status)?e=s:(e=n,a.status>=200&&a.status<300&&m(r)&&(e=r)),m(e)&&e(t)}},a.open(e,t,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a};function j(e,t,i,s){var n=(s=h(s,{})).successPred,r=m(n)?n:function(e){return e===N.OK};k("GET",e,r,t,i,s.pass).send()}function L(e,t,i,s,n){var r=(n=h(n,{})).successPred,a=m(r)?r:function(e){return[N.OK,N.Created].includes(e)};k("POST",e,a,i,s,n.pass).send(t)}function S(e,t,i,s,n){var r=(n=h(n,{})).successPred,a=m(r)?r:function(e){return[N.OK,N.NoContent].includes(e)};k("PUT",e,a,i,s,n.pass).send(t)}function C(e,t,i,s,n){var r=(n=h(n,{})).successPred,a=m(r)?r:function(e){return[N.OK,N.Accepted,N.NoContent].includes(e)};k("DELETE",e,a,i,s,n.pass).send(t)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,s=new AbortController,n=a(a({},t),{},{signal:s.signal});return setTimeout((function(){s.abort()}),i),fetch(e,n).then((function(e){if(!e.ok)throw new Error("".concat(e.status,": ").concat(e.statusText));return e})).catch((function(e){if("AbortError"===e.name)throw new Error("Response timed out");throw new Error(e.message)}))}function I(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":";if(x(e)||x(t)||!e.includes(i)||!t.includes(i))return null;var s=e.split(i),n=t.split(i);if(+s[0]>+n[0])return 1;if(+s[0]<+n[0])return-1;if(+s[1]>+n[1])return 1;if(+s[1]<+n[1])return-1;if(s.length==n.length&&3==s.length){if(+s[2]>+n[2])return 1;if(+s[2]<+n[2])return-1}return 0}function M(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(x(e))return new Date;if(d(e))return e;var i=new Date(e),s=i.getTime();return Number.isNaN(s)?new Date:t?new Date(s+6e4*i.getTimezoneOffset()):i}function U(e,t){var i=e.getDate(),s=e.getMonth()+1,n=e.getFullYear().toString(),r=e.getHours(),a=e.getMinutes(),o=e.getSeconds(),l=function(e){return e<10?"0".concat(e):e};return t.replace("yyyy",n).replace("yy",n.slice(-2)).replace("mm",l(s)).replace("m",s).replace("dd",l(i)).replace("d",i).replace("hh",l(r)).replace("h",r).replace("MM",l(a)).replace("M",a).replace("ss",l(o)).replace("s",o)}function D(e){return U(M(e),"yyyy-mm-dd")}function _(e){return U(M(e,!1),"yyyy-mm-dd hh:MM")}var B=Object.prototype.hasOwnProperty,P=Object.prototype.isPrototypeOf,H=function(e,t){return B.call(e,t)},V=function(e,t){return Object.getPrototypeOf(e)!==t&&P.call(t,e)};function R(e){if(x(e)||!f(e))return e;var t=e.constructor();for(var i in e)H(e,i)&&(e.isActiveClone=null,t[i]=R(e[i]),delete e.isActiveClone);return t}function $(e){return y(e)?e:e.toLowerCase().replace(/\b\w/g,(function(e){return e.toUpperCase()}))}function F(e){return y(e)?e:e.charAt(0).toUpperCase()+e.slice(1)}var q={camel:function(e){return W(e)},pascal:function(e){return K(e)},upper:function(e){return e.toUpperCase()},lower:function(e){return e.toLowerCase()}};function z(e,t){return y(e)?e:H(q,t)?q[t](e):e}function W(e){if(y(e))return e;var t=K(e);return t.charAt(0).toLowerCase()+t.slice(1)}function K(e){return y(e)?e:$(e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim()).replace(/\s+/g,"")}function X(e){return String.prototype.normalize?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e.replace(/[àâäæ]/gi,"a").replace(/[ç]/gi,"c").replace(/[éèê]/gi,"e").replace(/[îï]/gi,"i").replace(/[ôœ]/gi,"o").replace(/[ùûü]/gi,"u")}function Y(e){return e?1:0}function J(e){var t=h(e,!1);return p(t)&&"true"===t.toLowerCase()||Number.isInteger(t)&&1===t||!0===t}var G=function(e,t,i,s){if(!Array.isArray(e)||!m(t))throw new TypeError("Bad argument");var n=se(e,t);if(Z([i,s],Number.isInteger)){if(s<i)throw new Error("Bad argument: max must be greater than min");return n>=i&&n<=s}return Number.isInteger(i)?n>=i:Number.isInteger(s)?n<=s:n>0},Q=function(e,t){if(!Array.isArray(e)||!m(t))throw new TypeError("Bad argument");for(var i=0;i<e.length;i++){var s=e[i];if(t.apply(void 0,o(Array.isArray(s)?s:[s])))return!0}return!1},Z=function(e,t){if(!Array.isArray(e)||!m(t))throw new TypeError("Bad argument");for(var i=0;i<e.length;i++){var s=e[i];if(!t.apply(void 0,o(Array.isArray(s)?s:[s])))return!1}return!0},ee=function(e,t){if(!Array.isArray(e)||!m(t))throw new TypeError("Bad argument");return 1===se(e,t)},te=function(e,t){if(!Array.isArray(e)||!m(t))throw new TypeError("Bad argument");return 0===se(e,t)},ie=function(e,t){if(!Array.isArray(e)||!m(t))throw new TypeError("Bad argument");return se(e,t)<=1};function se(e,t){for(var i=0,s=0;s<e.length;s++){var n=e[s];t.apply(void 0,o(Array.isArray(n)?n:[n]))&&i++}return i}function ne(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Number.isInteger(e))throw new TypeError("Bad argument");if(Number.isInteger(t)||(t=e,e=0),t<e)throw new Error("Bad argument: max must be greater than min");return e+Math.floor((i?re():Math.random())*(t-e+1))}function re(){return window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295}function ae(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return y(e)?t:"".concat(e).concat(i).concat(t)}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return e.substring(0,e.lastIndexOf(t))}function le(e,t){return e.substring(0,e.lastIndexOf(t)-1)}function ce(e,t,i){var s=+t[0].match(/\d+/g);return e[i][s]}function he(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",s=/\[\d+\]/g,n=R(e),r=function(e,t,i){var s=e.match(t),r=e.substring(0,e.indexOf("["));return i(n,s,r)},a=t.split(i),o=0,l=a.length;o<l;o++){var c=a[o];if(x(n=s.test(c)?r(c,s,ce):n[c]))return}return n}var ue=function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},de=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},pe=function(e){return!x(e)&&e.nodeType===Node.ELEMENT_NODE},me=function(e){return e instanceof Node},fe=function(e){return e instanceof NodeList},ge=function(e){return pe(e)&&e instanceof Element},be=function(e,t){return!!(pe(e)&&e instanceof HTMLElement)&&(!g(t)||(i=e,s=Array.isArray(t)?t:[t],n=function(e){return i instanceof e},r=function(e){return i.tagName===e.toUpperCase()},a=function(e){return Array.isArray(e)?e.includes(i.type):i.type===e},s.some((function(e){if(!g(e))return!1;var t=e,i=null;if(Array.isArray(e)){var s=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,n=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){n=!0,r=e}finally{try{s||null==o.return||o.return()}finally{if(n)throw r}}return i}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2);t=s[0],i=s[1]}t=t.toLowerCase();var o="HTML".concat(H(ve,t)?ve[t]:K(t),"Element");return!(!n(window[o])&&!r(t))&&(!(b(i)&&!u(i))||a(i))}))));var i,s,n,r,a},ve={a:"Anchor",br:"BR",dl:"DList",datalist:"DataList",fieldset:"FieldSet",frameset:"FrameSet",hr:"HR",h1:"Heading",h2:"Heading",h3:"Heading",h4:"Heading",h5:"Heading",h6:"Heading",li:"LI",ol:"OList",optgroup:"OptGroup",p:"Paragraph",q:"Quote",blockquote:"Quote",caption:"TableCaption",td:"TableCell",th:"TableCell",col:"TableCol",tr:"TableRow",tbody:"TableSection",thead:"TableSection",tfoot:"TableSection",textarea:"TextArea",ul:"UList"},ye=function(e){return e instanceof HTMLCollection},we=function(e){return function(e){return!x(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(e)&&e instanceof DocumentFragment};function xe(e,t){if(!p(t))return null;var i=document.createElement("template");return i.innerHTML=t.trim(),i.content[e]}var Ee=xe.bind(null,"firstChild"),Ae=xe.bind(null,"childNodes");function Oe(e){if(!be(e))throw new Error("The given element is not a valid HTML Element");var t=e.getBoundingClientRect(),i=t.top,s=t.right,n=t.bottom,r=t.left;return i>=0&&r>=0&&n<=de()&&s<=ue()}function Ne(e,t){if(!Z([e,t],be))throw new Error("The given element is not a valid HTML Element");var i=e.getBoundingClientRect(),s=i.top,n=i.right,r=i.bottom,a=i.left,o=t.getBoundingClientRect(),l=o.top,c=o.right,h=o.bottom,u=o.left;return Z([[l,s],[u,a],[n,c],[r,h]],(function(e,t){return e<=t}))}function ke(e,t){if(!Z([e,t],ge))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return e.insertAdjacentElement("beforebegin",t),e}function je(e,t){if(!Z([e,t],ge))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return e.insertAdjacentElement("afterend",t),e}function Le(e,t){if(!Z([e,t],ge))throw new TypeError("Bad argument: The given `element` or `target` is not a valid Element");return e.insertAdjacentElement("afterbegin",t),e}function Se(e,t){if(!me(e))throw new TypeError("Bad argument: The given `parent` is not a valid Node");if(!ye(t)&&!b(t))throw new TypeError("Bad argument: The given `children` is not a valid HTMLCollection/HTMLElement array");var i=we(e)?e:document.createDocumentFragment();return Array.from(t).forEach((function(e){var t;x(e)||i.appendChild(me(e)?e:(t=e.toString(),document.createTextNode(t.toString())))})),e!==i&&e.appendChild(i),e}function Ce(e,t,i){e[t]=i}function Te(e,t,i){e.setAttribute(t,i)}var Ie="accesskey,autocapitalize,class,dataset,editable,draggable,hidden,id,inputmode,lang,html,style,tabindex,text,title",Me={accesskey:[Ce,"accessKey"],autocapitalize:[Ce,"autocapitalize"],class:[function(e,t){var i;if(!be(e))throw new Error("Bad argument: The passed `element` argument is not a valid HTML Element");return(i=e.classList).add.apply(i,o(Array.isArray(t)?t:[t])),e}],dataset:[function(e,t,i){Object.assign(e[t],i)},"dataset"],draggable:[Ce,"draggable"],editable:[Ce,"contentEditable"],hidden:[Ce,"hidden"],id:[Ce,"id"],inputmode:[Ce,"inputMode"],lang:[Ce,"lang"],html:[Ce,"innerHTML"],style:[Ce,"style"],tabindex:[Ce,"tabIndex"],text:[Ce,"textContent"],title:[Ce,"title"],data:[Ce,"data"],cite:[Ce,"cite"],download:[Ce,"download"],ping:[Ce,"ping"],target:[Ce,"target"],coords:[Ce,"coords"],shape:[Ce,"shape"],autoplay:[Ce,"autoplay"],buffered:[Ce,"buffered"],controls:[Ce,"controls"],loop:[Ce,"loop"],muted:[Ce,"muted"],playsinline:[Te,"playsinline"],poster:[Ce,"poster"],preload:[Ce,"preload"],crossorigin:[Ce,"crossOrigin"],decoding:[Ce,"decoding"],height:[Ce,"height"],ismap:[Ce,"isMap"],loading:[Ce,"loading"],srcset:[Ce,"srcset"],width:[Ce,"width"],alt:[Ce,"alt"],as:[Ce,"as"],media:[Ce,"media"],rel:[Ce,"rel"],src:[Ce,"src"],sizes:[Ce,"sizes"],reversed:[Ce,"reversed"],start:[Ce,"start"],accept:[Ce,"accept"],"accept-charset":[Ce,"acceptCharset"],action:[Ce,"action"],autocomplete:[Ce,"autocomplete"],autofocus:[Ce,"autofocus"],capture:[Ce,"capture"],checked:[Ce,"checked"],cols:[Ce,"cols"],disabled:[Ce,"disabled"],dirname:[Ce,"dirName"],enctype:[Ce,"enctype"],for:[Ce,"for"],form:[Ce,"form"],formaction:[Ce,"formAction"],formenctype:[Ce,"formEnctype"],formmethod:[Ce,"formMethod"],formnovalidate:[Ce,"formNoValidate"],formtarget:[Ce,"formTarget"],high:[Ce,"high"],label:[Ce,"label"],list:[Ce,"list"],low:[Ce,"low"],max:[Ce,"max"],maxlength:[Ce,"maxLength"],method:[Ce,"method"],min:[Ce,"min"],minlength:[Ce,"minLength"],multiple:[Ce,"multiple"],name:[Ce,"name"],novalidate:[Ce,"noValidate"],optimum:[Ce,"optimum"],pattern:[Ce,"pattern"],placeholder:[Ce,"placeholder"],readonly:[Ce,"readOnly"],required:[Ce,"required"],rows:[Ce,"rows"],selected:[Ce,"selected"],size:[Ce,"size"],spellcheck:[Te,"spellcheck"],step:[Ce,"step"],wrap:[Ce,"wrap"],default:[Ce,"default"],kind:[Ce,"kind"],srclang:[Ce,"srclang"],abbr:[Ce,"abbr"],colspan:[Ce,"colSpan"],span:[Ce,"span"],rowspan:[Ce,"rowSpan"],scope:[Ce,"scope"],href:[Ce,"href"],hreflang:[Ce,"hreflang"],datetime:[Ce,"dateTime"],type:[Ce,"type"],value:[Ce,"value"],usemap:[Ce,"useMap"]};function Ue(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!be(e))throw new Error("Bad argument: The given element argument is not a valid HTML Element");if(!f(t))return e;for(var s=function(e){return Ie.includes(e)||i.includes(e)},n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if(s(a)){var l=t[a],c=Me[a].slice(0),h=c.shift();h.apply(void 0,[e].concat(o(c),[l]))}}return e}function De(e,t){if(!be(e,"select"))throw new Error("Bad argument: The given select argument is not a valid HTML Select element");if(x(t))throw new Error("The given value parameter is a null or undefined");for(var i=e.options,s=0;s<i.length;s++){var n=i[s];if(n.value===t.toString())return n.selected=!0,!0}return!1}function _e(e,t,i){var s=document.createElement(e);return be(s)?(f(i)&&Ue(s,i,h(t,"")),s):null}function Be(e,t,i,s){var n=_e(e,t,i);return be(n)?(x(s)||bi(n,s),n):null}function Pe(e,t,i,s,n){var r=_e(e,t,s);return be(r)?(x(n)||bi(r,n,i),r):null}function He(e){var t=document.createDocumentFragment();return x(e)||bi(t,e),t}var Ve=function(e){return document.createTextNode(e)},Re=_e.bind(null,"link","as,crossorigin,disabled,href,hreflang,media,rel,sizes,type"),$e=Be.bind(null,"template",""),Fe=Be.bind(null,"header",""),qe=Be.bind(null,"footer",""),ze=Be.bind(null,"main",""),We=Be.bind(null,"article",""),Ke=Be.bind(null,"section",""),Xe=Be.bind(null,"nav",""),Ye=Be.bind(null,"aside",""),Je=Be.bind(null,"h1",""),Ge=Be.bind(null,"h2",""),Qe=Be.bind(null,"h3",""),Ze=Be.bind(null,"h4",""),et=Be.bind(null,"h5",""),tt=Be.bind(null,"h6",""),it=Be.bind(null,"div",""),st=Be.bind(null,"object","data,height,name,type,usemap,width"),nt=_e.bind(null,"embed","height,src,type,width"),rt=_e.bind(null,"br",""),at=_e.bind(null,"hr",""),ot=Be.bind(null,"p",""),lt=Be.bind(null,"blockquote","cite"),ct=function(e){return be(e,"li")?e:dt(null,e)},ht=Pe.bind(null,"ul","",ct),ut=Pe.bind(null,"ol","reversed,start,type",ct),dt=Be.bind(null,"li","value"),pt=Be.bind(null,"dl",""),mt=Be.bind(null,"dt",""),ft=Be.bind(null,"dd",""),gt=Be.bind(null,"a","download,href,hreflang,ping,rel,target,type"),bt=_e.bind(null,"area","alt,coords,download,href,hreflang,media,ping,rel,shape,target"),vt=_e.bind(null,"base","href,target"),yt=_e.bind(null,"img","alt,crossorigin,decoding,height,ismap,loading,sizes,src,srcset,usemap,width"),wt=Be.bind(null,"audio","autoplay,controls,crossorigin,loop,muted,preload,src"),xt=Be.bind(null,"video","autoplay,controls,crossorigin,height,loop,muted,playsinline,poster,preload,src,width"),Et=_e.bind(null,"source","media,sizes,src,srcset,type"),At=_e.bind(null,"track","default,kind,label,src,srclang"),Ot=Be.bind(null,"picture",""),Nt=Be.bind(null,"figure",""),kt=Be.bind(null,"figcaption",""),jt=Be.bind(null,"span",""),Lt=Be.bind(null,"strong",""),St=Be.bind(null,"em",""),Ct=Be.bind(null,"mark",""),Tt=Be.bind(null,"samp",""),It=Be.bind(null,"sub",""),Mt=Be.bind(null,"sup",""),Ut=Be.bind(null,"del","cite,datetime"),Dt=Be.bind(null,"ins","cite,datetime"),_t=Be.bind(null,"q","cite"),Bt=Be.bind(null,"abbr",""),Pt=Be.bind(null,"b",""),Ht=Be.bind(null,"i",""),Vt=Be.bind(null,"s",""),Rt=Be.bind(null,"u",""),$t=Be.bind(null,"cite",""),Ft=Be.bind(null,"time","datetime"),qt=Be.bind(null,"code",""),zt=Be.bind(null,"form","accept-charset,action,autocomplete,enctype,method,name,novalidate,rel,target"),Wt=_e.bind(null,"input","accept,alt,autocomplete,autofocus,capture,checked,dirname,disabled,height,max,maxlength,minlength,min,multiple,name,pattern,placeholder,readonly,required,size,src,step,type,value,width"),Kt=Be.bind(null,"textarea","autocomplete,autofocus,cols,disabled,maxlength,minlength,name,placeholder,readonly,required,rows,spellcheck,value,wrap"),Xt=Be.bind(null,"label","for"),Yt=Pe.bind(null,"select","autocomplete,autofocus,disabled,multiple,name,required,size",(function(e){return be(e,["option","optgroup"])?e:Array.isArray(e)?Qt(null,e):Jt(null,e)})),Jt=Be.bind(null,"option","disabled,label,selected,value"),Gt=function(e){return be(e,"option")?e:Jt(null,e)},Qt=Pe.bind(null,"optgroup","disabled,label",Gt),Zt=Be.bind(null,"fieldset","disabled,name"),ei=Be.bind(null,"legend",""),ti=Pe.bind(null,"datalist","",Gt),ii=Be.bind(null,"meter","high,low,max,min,optimum,value"),si=Be.bind(null,"progress","max,value"),ni=Be.bind(null,"output","name,value"),ri=Be.bind(null,"button","autofocus,disabled,formaction,formenctype,formmethod,formnovalidate,formtarget,name,type,value"),ai=Be.bind(null,"table",""),oi=Be.bind(null,"caption",""),li=function(e){return be(e,"tr")?e:mi(null,e)},ci=Pe.bind(null,"thead","",li),hi=Pe.bind(null,"tbody","",li),ui=Pe.bind(null,"tfoot","",li),di=_e.bind(null,"col","span"),pi=Pe.bind(null,"colgroup","span",(function(e){return be(e,"col")?e:null})),mi=Pe.bind(null,"tr","",(function(e){return be(e,["th","td"])?e:gi(null,e)})),fi=Be.bind(null,"th","abbr,colspan,rowspan,scope"),gi=Be.bind(null,"td","colspan,rowspan");function bi(e,t,i){var s=Array.isArray(t)?t:[t];return m(i)&&(s=s.map((function(e){return i(e)}))),Se(e,s),e}var vi=function(e){return/^\.[a-zA-Z0-9_-]+$/.test(e)};function yi(e,t){var i=h(t,document);return y(e)?null:we(i)?i.querySelector(e):function(e){return/^#[a-zA-Z0-9_-]+$/.test(e)}(e)?document.getElementById(e.substring(1)):vi(e)?i.getElementsByClassName(e.substring(1))[0]:i.querySelector(e)}function wi(e,t){var i=h(t,document);return y(e)?null:we(i)?i.querySelectorAll(e):vi(e)?i.getElementsByClassName(e.substring(1)):i.querySelectorAll(e)}function xi(e,t){return"content"in document.createElement("template")?yi(e,t):null}function Ei(e,t){return e?document.importNode(e.content,h(t,!0)):e}function Ai(e,t,i){if(!be(t))return null;var s=t[e];if(m(i))for(;ge(s)&&!i(s);)s=s[e];return s}var Oi=Ai.bind(null,"previousElementSibling"),Ni=Ai.bind(null,"nextElementSibling");function ki(e,t,i){if(!ge(e))throw new TypeError("Bad argument: The given target parameter is not a valid HTML Element");if(!m(t))throw new TypeError("Bad argument: The given pred parameter is not a valid Function");var s=e.parentElement;return i>0?Li(s,t,i-1):ji(s,t)}function ji(e,t){return x(e)?null:t(e)?e:ji(e.parentElement,t)}function Li(e,t,i){return x(e)||0===i?null:t(e)?e:Li(e.parentElement,t,i-1)}function Si(e,t){if(!me(e))throw new TypeError("Bad argument: The given `node` is not a valid Node");return m(t)?(Array.from(e.childNodes).forEach((function(i){t(i)&&e.removeChild(i)})),e):function(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild);return e}(e)}function Ci(e){if(x(e))return!1;var t=Kt({value:be(e)?e.textContent:e.toString(),readonly:!0});return!!be(t)&&(document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),!0)}var Ti=function(e){return e.classList.add("down")},Ii=function(e){return e.classList.remove("down")};function Mi(e){for(var t=wi(".form-label",e),i=0;i<t.length;i++){var s=t[i];if("placeholder"==s.dataset.type&&!y(s.htmlFor)){var n=yi("#".concat(s.htmlFor));be(n)?y(n.placeholder)?(r(n,s),u(n.value)&&Ti(s)):console.warn('%c@zenkai%c #FloatingLabel>%cfloatingLabel:%c Input "'.concat(s.htmlFor,'" contains a placeholder'),"text-decoration: underline","","font-weight: bold;","font-weight: normal;"):console.error('%c@zenkai%c #FloatingLabel>%cfloatingLabel:%c Missing input for label "'.concat(s.htmlFor,'"'),"text-decoration: underline","","font-weight: bold;","font-weight: normal;")}}function r(e,t){y(e.placeholder)&&(e.addEventListener("focus",(function(i){e.placeholder="",Ii(t),t.parentElement.classList.add("focused")})),e.addEventListener("blur",(function(e){u(this.value)&&Ti(t),t.parentElement.classList.remove("focused")})),e.addEventListener("input",(function(i){document.activeElement!=e&&(u(this.value)?Ti(t):Ii(t))})))}return t}function Ui(e){for(var t=wi("[data-counter]",e),i=0;i<t.length;i++){var s=t[i],n=s.dataset.counter,r=yi("#".concat(n));be(r)?(s.dataset.counterMax=r.maxLength,s.dataset.counterVal=r.value.length,a(r,s)):console.error("%c@zenkai%c #InputCounter>%cinputCounter:%c Failed to add counter ".concat(n,". Input (referenced) was not found."),"text-decoration: underline","","font-weight: bold;","font-weight: normal;")}function a(e,t){e.addEventListener("input",(function(i){t.dataset.counterVal=e.value.length}))}return t}var Di=function(e){return e.dataset.type},_i=function(e){return e.dataset.state},Bi=function(e,t){return e.dataset.state=t},Pi=function(e,t){return Bi(e,h(t,"checked"))},Hi=function(e,t){return Bi(e,h(t,"unchecked"))};function Vi(e,t,i){if(be(e))return t(e)?[e]:wi(i,e);if(p(e)&&!u(e)){var s=yi(e);return x(s)?null:Vi(s)}return x(e)?wi(i):null}function Ri(e,t){return y(t.htmlFor)?yi("input[type='".concat(h(e,"text"),"']"),t):yi("#".concat(t.htmlFor))}var $i="on",Fi={init:function(e){return Object.assign(this,e),this.isChecked()&&Pi(this.container,$i),this},container:null,index:null,get value(){return this.container.dataset.value},isChecked:function(){return _i(this.container)===$i},setChecked:function(e){return!x(e)&&(e?Pi(this.container,$i):Hi(this.container,"off"),!0)}},qi={name:"selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return v(this.selectedItem)&&!v(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=t.target;if(H(i.dataset,"selector")){var s=!1;if(m(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),!s){var n=e.items.find((function(e){return e.index===+h(i.dataset.selectorIndex,-1)}));x(n)||(e.setSelectedItem(n),m(e.afterChange)&&e.afterChange(e,t))}}}))}},zi={init:function(e){return Object.assign(this,e),this.isChecked()&&Pi(this.container,"on"),this},container:null,input:null,index:null,get value(){return this.input.value},isChecked:function(){return this.input.checked},setChecked:function(e){return!x(e)&&(e?(this.input.checked=!0,Pi(this.container,"on")):(this.input.checked=!1,Hi(this.container,"off")),!0)}},Wi={name:"form-selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return v(this.selectedItem)&&!v(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("change",(function(t){var i=t.target,s=!1;if(m(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),s)return i.checked=!1,void e.items[e.selectedIndex].setChecked(!0);var n=e.items.find((function(e){return e.index===+h(i.dataset.selectorIndex,-1)}));x(n)||(e.setSelectedItem(n),m(e.afterChange)&&e.afterChange(e,t))}))}},Ki="BAD_CONTAINER",Xi=function(e){return'[data-type="'.concat(e.name,'"]')},Yi={BaseSelector:Xi(qi),FormSelector:Xi(Wi)},Ji={create:function(e,t){if(!be(e))return Ki;var i=wi("[data-selector]",e);if(!fe(i))return Ki;var s=null,n=null,r=Di(e);switch(r){case"selector":n=Gi(i,r,!1),s=Object.create(qi);break;case"form-selector":n=Gi(i,r,!0),s=Object.create(Wi)}return Object.assign(s,t,{container:e,items:n,querySelector:Xi(s)}),s}};function Gi(e,t,i){for(var s=[],n={selector:function(){return Object.create(Fi)},"form-selector":function(){return Object.create(zi)}},r=0;r<e.length;r++){var a=e[r];a.dataset.selectorIndex=r;var o={container:a,index:r};if(i){var l=Ri("radio",a);if(!be(l))return"BAD_INPUT";l.dataset.selectorIndex=r,Object.assign(o,{input:l})}var c=n[t]().init(o);s.push(c)}return s}var Qi={BAD_CONTAINER:new Error("Missing container: A selector requires a container"),BAD_INPUT:new Error("Missing input: FormSelector requires an input in the container")},Zi=function(e){return RegExp("selector|form-selector").test(e.dataset.type)},es=[Yi.BaseSelector,Yi.FormSelector].join(",");function ts(e,t){var i=Vi(e,Zi,es),s=h(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=Ji.create(i[r],s);if(H(Qi,a))throw Qi[a];a.init(),n.push(a)}return n}var is=Ji,ss={BAD_CONTAINER:new Error("Missing container: A switch requires a container"),BAD_INPUT:new Error("Missing input: FormSwitch requires an input in the container")},ns="on",rs=function(e){return'[data-type="'.concat(e.name,'"]')},as=function(e){return RegExp("switch|form-switch").test(e.dataset.type)},os=function(e,t){if(!be(e))return"BAD_CONTAINER";var i=null,s=null;switch(Di(e)){case"switch":i=Object.create(ls);break;case"form-switch":if(s=Ri("checkbox",e),!be(s))return"BAD_INPUT";t.input=s,i=Object.create(cs)}return Object.assign(i,t,{container:e,querySelector:rs(i)}),i},ls={name:"switch",container:null,beforeChange:null,afterChange:null,get value(){return this.container.dataset.value},isChecked:function(){return _i(this.container)===ns},setChecked:function(e){return!x(e)&&(e?Pi(this.container,ns):Hi(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.isChecked()&&Pi(this.container,ns),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=!1;m(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i||(e.toggle(),m(e.afterChange)&&e.afterChange(e,t))}))}},cs={name:"form-switch",container:null,input:null,beforeChange:null,afterChange:null,get value(){return this.input.value},isChecked:function(){return _i(this.container)===ns},setChecked:function(e){return!x(e)&&(this.input.checked=e,e?Pi(this.container,ns):Hi(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.input.checked&&this.setChecked(!0),this.bindEvents(),this},bindEvents:function(){var e=this;this.input.addEventListener("change",(function(t){var i=!1;m(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i?e.input.checked=!e.input.checked:(e.toggle(),m(e.afterChange)&&e.afterChange(e,t))}))}},hs=[rs(ls),rs(cs)].join(",");function us(e,t){var i=Vi(e,as,hs),s=h(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=os(i[r],s);if(H(ss,a))throw ss[a];a.init(),n.push(a)}return n}function ds(e){e.style.display="block"}function ps(e){e.style.display="none"}var ms={BAD_CONTAINER_COLLAPSIBLE:"BAD_CONTAINER_COLLAPSIBLE",BAD_CONTAINER_ACCORDION:"BAD_CONTAINER_ACCORDION"},fs={BAD_CONTAINER_COLLAPSIBLE:new Error("Missing container: A collapsible requires a container"),BAD_CONTAINER_ACCORDION:new Error("Missing container: An accordion requires a container")},gs="expanded",bs="collapsed",vs=function(e){return"collapsible"in e.dataset},ys=function(e){return"accordion"===e.dataset.boost},ws={create:function(e,t){if(!be(e))return ms.BAD_CONTAINER_COLLAPSIBLE;var i=Object.create(this);return Object.assign(i,t,{container:e}),i},name:"collapsible",container:null,header:null,content:null,beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null,getState:function(){return this.container.dataset[this.name]},setState:function(e){this.container.dataset[this.name]=e},isCollapsed:function(){return this.getState()===bs},isExpanded:function(){return this.getState()===gs},isClosed:!1,isInitialized:!1,open:function(){if(this.isInitialized&&!this.isClosed)return this;var e=!1;return m(this.beforeOpen)&&(e=!1===this.beforeOpen(this)),e||(this.toggle(ds,gs,"add"),m(this.afterOpen)&&this.afterOpen(this),this.isClosed=!1),this},close:function(){if(this.isInitialized&&this.isClosed)return this;var e=!1;return m(this.beforeClose)&&(e=!1===this.beforeClose(this)),e||(this.toggle(ps,bs,"remove"),m(this.afterClose)&&this.afterClose(this),this.isClosed=!0),this},toggle:function(e,t,i){e(this.content),this.setState(t),this.container.classList[i]("expanded")},init:function(e){return Object.assign(this,e),this.header=yi("[data-".concat(this.name,"-header]"),this.container),this.content=yi("[data-".concat(this.name,"-content]"),this.container),this.isCollapsed()?this.close():this.isExpanded()&&(this.isClosed=!0,this.open()),this.bindEvents(),this.isInitialized=!0,this},bindEvents:function(){var e=this,t=this.container,i=this.header;i.addEventListener("click",(function(s){var n=ki(s.target,(function(t){return e.name in t.dataset}));t===n&&(e.isCollapsed()?e.open():i.parentNode===t&&e.close())}))}},xs={create:function(e,t){if(!be(e))return ms.BAD_CONTAINER_ACCORDION;var i=Object.create(this);return Object.assign(i,t,{container:e}),i},container:null,sections:null,selectedSection:null,beforeChange:null,afterChange:null,init:function(){var e=this;this.sections=[];for(var t=wi("[data-accordion]",this.container),i=0;i<t.length;i++){var s=t[i],n=ws.create(s,{name:"accordion",index:i,afterOpen:function(t){m(e.beforeChange)&&e.beforeChange(t),e.sections.filter((function(e){return e.index!==t.index})).forEach((function(e){return e.close()})),m(e.afterChange)&&e.afterChange(t),e.selectedSection=t}});if(H(ms,n))return n;this.sections.push(n),n.init()}return this}};function Es(e,t){var i=Vi(e,vs,"[data-collapsible]"),s=h(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=ws.create(i[r],s);if(H(fs,a))throw fs[a];a.init(),n.push(a)}return n}function As(e,t){var i=Vi(e,ys,"[data-boost=accordion]"),s=h(t,{});if(x(i))return null;for(var n=[],r=0;r<i.length;r++){var a=xs.create(i[r],s);if(H(fs,a))throw fs[a];a.init(),n.push(a)}return n}var Os=encodeURIComponent;function Ns(e){return e.toString().replace(/^(.*\/\/[^/?#]*).*$/,"$1")}function ks(e,t){var i=decodeURIComponent(window.location.search);if(y(i))return null;var s={};if("URLSearchParams"in window){var n,r=new URLSearchParams(i.substring(1)),a=function(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=l(e))){i&&(e=i);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){o=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw r}}}}(r.entries());try{for(a.s();!(n=a.n()).done;){var o=n.value;s[o[0]]=o[1]}}catch(e){a.e(e)}finally{a.f()}return e?r.get(e):s}return i.substring(1).split("&").forEach((function(e){var t=e.split("=",2);s[t[0]]=t[1]})),e?h(s[e],t):s}function js(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];return Object.keys(e).forEach((function(s){t&&y(e[s])||i.push("".concat(Os(s),"=").concat(Os(e[s])))})),i.join("&")}},185:(e,t,i)=>{i.r(t),i.d(t,{AnchorHandler:()=>n});var s=i(835);const n={models:null,init(){this.models=new Map},create(e,t){return(0,s.isNullOrUndefined)(this.models)&&this.init(),(0,s.isNullOrUndefined)(this.models.get(t.id))?this.createModel(t.id,t.rtag,e):this.register(t.id,t.rtag,e),this.models.get(t.id)},createModel(e,t,i){const s=i.projection.environment.getActiveReceiver(t);let n=[];for(let t=0;t<s.items.length;t++)if(s.items[t].render.contains(i.container))return n.push({id:i.id,pId:s.items[t].render.dataset.id,holder:s.items[t].render,elem:i}),void this.models.set(e,{items:n,index:0})},register(e,t,i){let s=this.models.get(e);const n=i.projection.environment.getActiveReceiver(t);for(let e=0;e<n.items.length;e++)if(n.items[e].render.contains(i.container)){s.items.push({id:i.id,pId:n.items[e].render.dataset.id,holder:n.items[e].render,elem:i});break}for(let e=0;e<s.index;e++)i.nextAnchor(!1)},nextAnchor(e,t){let i=this.models.get(e);for(let e=0;e<i.items.length;e++){let s=i.items[e];s.id!==t&&s.elem.nextAnchor(!1)}i.index++},findSource(e,t){const i=this.models.get(e).items,n={};let r,a;for(r=0;r<i.length;r++){const e=i[r].elem,o=e.items;if(!(0,s.isNullOrUndefined)(o))for(a=0;a<o.length;a++)if(o[a].render.contains(t)){n.x=Number(o[a].render.getAttribute("x"))+Number(i[r].holder.getAttribute("x"))+Number((e.container||e.element).getAttribute("x")),n.y=Number(o[a].render.getAttribute("y"))+Number(i[r].holder.getAttribute("y"))+Number((e.container||e.element).getAttribute("y")),n.calc={projItems:{x:Number(o[a].render.getAttribute("x")),y:Number(o[a].render.getAttribute("y"))},holder:i[r].holder,proj:e};break}if(!(0,s.isNullOrUndefined)(n.x))break}let o=i[r].elem.anchors.indexes;const l=Number(i[r].elem.items[a].render.getAttribute("x")),c=Number(i[r].elem.items[a].render.getAttribute("y"));for(let e=0;e<o.length;e++)if(o[e].x===l&&o[e].y===c)return n.index=e,n},unregister(e,t){let i=this.models.get(e).listeners;for(let e=0;e<i.length;e++)if(i[e]===t)return void i.splice(e,1)},createSubModel(e,t){let i=this.models.get(e);(0,s.isNullOrUndefined)(i.subModels)&&(i.subModels=[]),i.subModels.push({elem:t,size:1})},registerSubModel(e,t,i){let n,r=this.models.get(e);for(let e=0;e<r.subModels.length;e++)r.subModels[e].elem===t&&(n=r.subModels[e]);(0,s.isNullOrUndefined)(n.start)&&(n.start=this.estimateStart(r,n.elem));const a=r.items;let o;for(let e=0;e<a.length;e++){const t=a[e].elem,n=t.items;if(!(0,s.isNullOrUndefined)(t.items)){for(let e=0;e<n.length;e++)if(n[e].render.contains(i.container||i.element)){o={},o.j=e,o.index=n[e].index;break}if(!(0,s.isNullOrUndefined)(o)){o.i=e;break}}}if(o.index>n.start+n.size){const e=a[o.i].elem.moveElemToAnchor(n.start+n.size,o.j);a.forEach((t=>{t.elem.increaseAnchors(n.start+n.size,o.index,e,r.forbiden)}))}else if(o.index<n.start+n.size){const e=a[o.i].elem.moveElemToAnchor(n.start+n.size-1,o.j);a.forEach((t=>{t.elem.decreaseAnchors(o.index,n.start+n.size,e,r.forbiden)})),n.start--}n.elem.increaseSize(),n.size++,(0,s.isNullOrUndefined)(r.listeners)||r.listeners.forEach((e=>{e.updateValue()}))},estimateStart(e,t){const i=e.items;for(let e=0;e<i.length;e++){const s=i[e].elem.items;for(let e=0;e<s.length;e++)if(s[e].render.contains(t.container))return e}},findTarget(e,t,i){const s=this.models.get(e).items;for(let e=0;e<s.length;e++){const n=s[e].elem,r=s[e].holder,a=n.anchors.indexes;if(r.dataset.concept===t)return{x:a[i].x+Number(r.getAttribute("x"))+Number((n.container||n.element).getAttribute("x")),y:a[i].y+Number(r.getAttribute("y"))+Number((n.container||n.element).getAttribute("y")),calc:{projItems:a[i],holder:r,proj:n}}}},estimatePositionCondamn(e,t){const i=this.models.get(e),n=i.items;for(let e=0;e<n.length;e++){const r=n[e].elem,a=r.items;if(!(0,s.isNullOrUndefined)(a))for(let o=0;o<a.length;o++)if(a[o].render.contains(t.container))return(0,s.isNullOrUndefined)(this.condamn)&&(i.condamn=[],i.forbiden=[]),i.condamn.push({index:o,elem:t}),i.forbiden.push(o),i.subModels.forEach((e=>{e.elem.container===t.container&&(e.start=a[o].index)})),{x:Number(a[o].render.getAttribute("x"))+Number(n[e].holder.getAttribute("x"))+Number((r.container||r.element).getAttribute("x")),y:Number(a[o].render.getAttribute("y"))+Number(n[e].holder.getAttribute("y"))+Number((r.container||r.element).getAttribute("y")),anchors:r.anchors.next}}},estimatePosition(e){const{projItems:t,holder:i,proj:s}=e;return{x:t.x+Number(i.getAttribute("x"))+Number((s.container||s.element).getAttribute("x")),y:t.y+Number(i.getAttribute("y"))+Number((s.container||s.element).getAttribute("y"))}},registerListener(e,t){let i=this.models.get(e);(0,s.isNullOrUndefined)(i.listeners)&&(i.listeners=[]),i.listeners.push(t)},deleteItem(e,t,i){const n=this.models.get(e);if(n.items.forEach((e=>{e.id!==t&&e.elem.removeAnchor(i)})),!(0,s.isNullOrUndefined)(n.condamn)){for(let e=0;e<n.subModels.length;e++)n.subModels[e].start<i&&n.subModels[e].start+n.subModels[e].size>i&&(n.subModels[e].size--,n.subModels[e].elem.decreaseSize());for(let e=0;e<n.condamn.length;e++){if(n.condamn[e].index>i){n.condamn[e].index--,n.condamn[e].elem.decreaseAnchor();for(let e=0;e<n.subModels.length;e++)n.subModels[e].elem===n.elem&&n.subModels[e].start--}n.condamn[e].index===i&&(n.condamn.splice(e,1),e--)}for(let e=0;e<n.forbiden.length;e++)n.forbiden[e]===i&&(n.forbiden.splice(e,1),e--)}n.index--,(0,s.isNullOrUndefined)(n.listeners)||n.listeners.forEach((e=>{e.updateValue()}))}}}},t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={};s.r(e),s.d(e,{BOM:()=>vh,DOCUMENT:()=>yh,FLOW_END:()=>wh,SCALAR:()=>xh,createScalarToken:()=>ah,isCollection:()=>Eh,isScalar:()=>Ah,prettyToken:()=>Oh,resolveAsScalar:()=>rh,setScalarValue:()=>oh,stringify:()=>hh,tokenType:()=>Nh,visit:()=>gh});var t={};s.r(t),s.d(t,{Alias:()=>Wo,CST:()=>e,Composer:()=>nh,Document:()=>Tc,Lexer:()=>Ih,LineCounter:()=>Mh,Pair:()=>Al,Parser:()=>Vh,Scalar:()=>Jo,Schema:()=>Sc,YAMLError:()=>Mc,YAMLMap:()=>Sl,YAMLParseError:()=>Uc,YAMLSeq:()=>Tl,YAMLWarning:()=>Dc,isAlias:()=>Eo,isCollection:()=>Lo,isDocument:()=>Ao,isMap:()=>Oo,isNode:()=>So,isPair:()=>No,isScalar:()=>ko,isSeq:()=>jo,parse:()=>qh,parseAllDocuments:()=>$h,parseDocument:()=>Fh,stringify:()=>zh,visit:()=>Uo,visitAsync:()=>_o});var n=s(835);function r(e){let t=0;if(O(e))return e.selectionStart;if(0!==window.getSelection().rangeCount){const i=window.getSelection().getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),t=s.toString().length}return t}const a="hidden",o="collapsed",l="highlighted",c="shake",h="selected";function u(e){return(0,n.isHTMLElement)(e)?(e.classList.remove(a),e):e}function d(e){return(0,n.isHTMLElement)(e)?(e.classList.add(a),e):e}function p(e){return(0,n.isHTMLElement)(e)?(e.classList.toggle(a),e):e}function m(e){e.classList.contains(c)||(e.classList.add(c),setTimeout((()=>{e.classList.remove(c)}),1e3))}function f(e){return(0,n.isHTMLElement)(e)?(e.classList.remove(l),e):e}function g(e){return(0,n.isHTMLElement)(e)?(e.classList.add(h),e):e}function b(e){return(0,n.isHTMLElement)(e)?(e.classList.remove(h),e):e}const v={backspace:"Backspace",tab:"Tab",enter:"Enter",ctrl:"Control",shift:"Shift",alt:"Alt",escape:"Escape",spacebar:" ",page_up:"PageUp",page_down:"PageDown",insert:"Insert",end:"End",home:"Home",left_arrow:"ArrowLeft",up_arrow:"ArrowUp",right_arrow:"ArrowRight",down_arrow:"ArrowDown",delete:"Delete",period:"."},y={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},w="error",x={AAC:{type:"audio/aac",extension:"aac"},BIN:{type:"application/octet-stream",extension:"bin"},JPEG:{type:"image/jpeg",extension:"jpeg"},JSON:{type:"application/json",extension:"json"},JSONCP:{type:"application/json",extension:"jsoncp"},MP3:{type:"audio/mpeg",extension:"mp3"},PDF:{type:"application/pdf",extension:"pdf"},SVG:{type:"image/svg+xml",extension:"svg"},TEXT:{type:"text/plain",extension:"txt"},XML:{type:"text/xml",extension:"xml"},ZIP:{type:"application/zip",extension:"zip"}},E={"audio/aac":"aac","application/octet-stream":"bin","image/jpeg":"jpeg","application/json":"json","audio/mpeg":"mp3","application/pdf":"pdf","image/svg+xml":"svg","text/plain":"txt","text/xml":"xml","application/zip":"zip"};function A(e){if(!n.isHTMLElement)throw new TypeError("Bad parameter");return e.hidden||"none"===window.getComputedStyle(e).display}const O=e=>(0,n.isHTMLElement)(e,["input","textarea"]),N=e=>O(e)||"true"===e.contentEditable,k=e=>+e.substring(0,e.indexOf("px")),j={top:e=>e.marginTop,right:e=>e.marginRight,bottom:e=>e.marginBottom,left:e=>e.marginLeft},L={top:e=>e.paddingTop,right:e=>e.paddingRight,bottom:e=>e.paddingBottom,left:e=>e.paddingLeft},S={top:e=>e.borderTopWidth,right:e=>e.borderRightWidth,bottom:e=>e.borderBottomWidth,left:e=>e.borderLeftWidth};function C(e,t,i){const s=window.getComputedStyle(e),n=window.getComputedStyle(t),r=j[i](s),a=L[i](n),o=S[i](n);return l=e.getBoundingClientRect()[i]+k(r),c=t.getBoundingClientRect()[i]-k(a)-k(o),Math.abs(l-c)<2;var l,c}function T(e,t,i,s){return"up"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&C(e,t,"top"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(A(i)||i.classList.contains("badge")||i===e)continue;const{bottom:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n>=c-1&&(u<o||u===o&&d<l)&&(a=i,o=u,l=d)}return a}(e,i,s):"down"===t?function(e,t,i=!0){const s=t.children,{bottom:n,left:r}=e.getBoundingClientRect();if(i&&C(e,t,"bottom"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(A(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);n<=c+1&&(u<o||u===o&&d<l)&&(a=i,o=u,l=d)}return a}(e,i,s):"left"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&C(e,t,"left"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(A(i)||i.classList.contains("badge")||i===e)continue;const{top:c,right:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r>=h-1&&(d<l||d===l&&u<o)&&(a=i,o=u,l=d)}return a}(e,i,s):"right"===t?function(e,t,i=!0){const s=t.children,{top:n,right:r}=e.getBoundingClientRect();if(i&&C(e,t,"right"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(A(i)||i.classList.contains("badge")||i===e)continue;const{top:c,left:h}=i.getBoundingClientRect();let u=Math.abs(n-c),d=Math.abs(r-h);r<=h+1&&(d<l||d===l&&u<o)&&(a=i,o=u,l=d)}return a}(e,i,s):(console.error("unknown direction",t),null)}function I(e,t){const i=e.children,{top:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let o=null,l=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(A(n)||n.classList.contains("badge"))continue;const{top:h,left:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);s<=h+1&&(d<l||d===l&&p<c)&&(o=n,l=d,c=p)}return o}function M(e,t){const i=e.children,{top:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let o=null,l=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(A(n)||n.classList.contains("badge"))continue;const{top:h,left:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);r<=u+1&&(p<c||p===c&&d<l)&&(o=n,l=d,c=p)}return o}function U(e,t){const i=e.children,{top:s,right:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let o=null,l=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(A(n)||n.classList.contains("badge"))continue;const{top:h,right:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);r>=u-1&&(p<c||p===c&&d<l)&&(o=n,l=d,c=p)}return o}function D(e,t){const i=e.children,{bottom:s,left:r}=e.getBoundingClientRect();if(0===i.length)return null;const a=(0,n.isFunction)(t);let o=null,l=99999,c=99999;for(let e=0;e<i.length;e++){const n=i[e];if(a&&!t(n))continue;if(A(n)||n.classList.contains("badge"))continue;const{bottom:h,left:u}=n.getBoundingClientRect();let d=Math.abs(s-h),p=Math.abs(r-u);s>=h-1&&(d<l||d===l&&p<c)&&(o=n,l=d,c=p)}return o}function _(e){return(0,n.isHTMLElement)(e)?e:(0,n.isString)(e)&&!(0,n.isNullOrWhitespace)(e)?(0,n.getElement)(e):null}const B=e=>(0,n.createStrong)({class:["text-bf"]},e).outerHTML,P=e=>JSON.parse(JSON.stringify(e)),H=function(){var e={},t=[];for(let e=0;e<256;e++)t[e]=e<16?"0"+e.toString(16):e.toString(16);return e.generate=function(){var e=4294967296*Math.random()>>>0,i=4294967296*Math.random()>>>0,s=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]},e}(),V={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,n.isNullOrUndefined)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),d(this.placeholder),u(this.conceptList)):(this.container.classList.add("empty"),u(this.placeholder),d(this.conceptList)),this.hasSelection||d(this.infoView),this},render(){return this.container=(0,n.createDiv)({class:["editor-config"]}),this.mainView=(0,n.createDiv)({class:["editor-config-main"]}),this.infoView=(0,n.createDiv)({class:["editor-config-info"]}),this.conceptList=(0,n.createUnorderedList)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,n.createParagraph)({class:["editor-config-placeholder"],html:`${B("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,n.removeChildren)(this.conceptList),(0,n.removeChildren)(this.infoView),this.cache.clear(),this.refresh()},selectItem(e){if(!this.cache.has(e))return null;let t=this.cache.get(e);return(0,n.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=t,this.selection.classList.add("selected"),this.refresh(),e},show(){return u(this.container),this.visible=!0,this},hide(){return d(this.container),this.visible=!1,this},showInfo(e){let t=R(this.editor.conceptModel.getCompleteModelConcept(e),(0,n.getTemplate)("#concept-schema"));(0,n.removeChildren)(this.infoView).append(t),u(this.infoView)},addItem(e){let t=(0,n.createSpan)({class:["loaded-element-name","fit-content"]},e.name),i=(0,n.createListItem)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:e.name,status:"active"}}),s=(0,n.createButton)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:e.name}});i.append(t,s),this.conceptList.append(i),this.cache.set(e.name,i),this.refresh()},bindEvents(){}};function R(e,t){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad argument: The 'schema' is missing");if(!(0,n.isHTMLElement)(t))throw new TypeError("Bad argument: The given 'template' is not a valid HTML Element");const i=(0,n.cloneTemplate)(t);return(0,n.getElements)("[data-if]",i).forEach(((t,i)=>{let s=t.dataset.if;(0,n.hasOwn)(e,s)||t.remove()})),(0,n.getElements)("[data-name]",i).forEach(((t,i)=>{let s=t.dataset.name;t.textContent=e[s]})),(0,n.getElements)("[data-attr]",i).forEach(((t,i)=>{let s=t.dataset.attr,[n,r]=s.split(":"),a=(t=>t.startsWith("$")?e[t.substring(1)]:t)(r);delete t.dataset.attr,t.dataset[n]=a})),(0,n.getElements)("[data-bind]",i).forEach(((t,i)=>{let s=t.dataset.bind;if(!(0,n.hasOwn)(e,s))return;let r=(0,n.getElement)("[data-item]",t),a=r.dataset.item,o=(0,n.getTemplate)(`#${a}`);e[s].forEach((e=>{r.append(R(e,o))}))})),i}const $={PRIMITIVE:"E",CONCRETE:"C",PROTOTYPE:"P",DERIVATIVE:"D"},F={file:null,title:null,status:null,container:null,mainView:null,infoView:null,files:null,btnLoad:null,btnUnload:null,btnDownload:null,btnEdit:null,selection:null,concepts:null,selectedConcept:null,attributes:null,filter:null,init(){return this.concepts=new Map,this.attributes=new Map,this.filter=Object.create(z,{editor:{value:this.editor},settings:{value:this}}).init([{label:"Concrete",nature:"concrete"},{label:"Prototype",nature:"prototype"},{label:"Derivative",nature:"derivative"}]),this},get hasFile(){return this.concepts.size>0},get hasSelection(){return!(0,n.isNullOrUndefined)(this.selection)},getFile(){return this.file},setFile(e){this.file=e,this.refresh()},refresh(){return this.hasFile?(this.container.classList.remove("empty"),u(this.files)):(this.container.classList.add("empty"),d(this.files)),this.btnUnload.disabled=!this.hasFile,this.editor.isReady?(d(this.placeholder),this.placeholder.classList.remove("error")):this.hasFile?(this.editor.hasConceptModel||(this.placeholder.innerHTML=`${B("Missing projections")}`),this.editor.hasProjectionModel||(this.placeholder.innerHTML=`${B("Missing projections")}`),this.placeholder.classList.add("error"),u(this.placeholder)):(this.placeholder.innerHTML=`Add your ${B("concepts")} and ${B("projections")} or load a previously saved ${B("model")}`,this.placeholder.classList.remove("error")),this.hasSelection?u(this.infoView):d(this.infoView),this},reload(){this.editor.hasConceptModel&&(this.editor.conceptModel.schema.forEach((e=>{let t=(0,n.createListItem)({class:["editor-file-concept"],dataset:{name:e.name,nature:e.nature,root:(0,n.valOrDefault)(e.root,"false")}},e.name);if(e.root){let e=(0,n.createI)({class:["editor-file-concept-root"],title:"root concept"});t.append(e)}this.concepts.set(e.name,t),this.files.append(t)})),this.refresh())},render(){this.container=(0,n.createDiv)({class:["editor-file"]});let e=(0,n.createDiv)({class:["editor-file-actionbar"]});return this.btnLoad=(0,n.createButton)({class:["btn","editor-file__browse-button"],title:"Load file in editor",dataset:{action:"load"}},"Browse"),this.btnImport=(0,n.createButton)({class:["btn","editor-file__browse-button"],title:"Load file in editor",dataset:{action:"load"}},"Import"),this.btnUnload=(0,n.createButton)({class:["btn","editor-file-actionbar__button","editor-file-actionbar__btn-remove"],title:"Remove all files",dataset:{action:"unload"}}),e.append(this.btnLoad,this.btnUnload),this.mainView=(0,n.createDiv)({class:["editor-file-mainview"]}),this.files=(0,n.createUnorderedList)({class:["bare-list","editor-file__list"]}),this.infoView=(0,n.createDiv)({class:["detail-area","editor-file-detail"]}),this.placeholder=(0,n.createParagraph)({class:["editor-file-placeholder"],html:`Add your ${B("concepts")}, ${B("projections")} and all other ${B("resources")}`}),this.mainView.append(this.filter.render(),this.files,this.infoView),this.container.append(e,this.mainView),this.bindEvents(),this.refresh(),this.container},clear(){(0,n.removeChildren)(this.files)},show(){return u(this.container),this.visible=!0,this},hide(){return d(this.container),this.visible=!1,this},selectItem(e){let t=this.concepts.get(e);(0,n.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=t,this.selection.classList.add("selected"),this.displayInfo(e),this.refresh()},displayConcept(e){if((0,n.isNullOrUndefined)(e))return;let t=this.editor.conceptModel.getConceptSchema(e);if((0,n.isNullOrUndefined)(t))return;this.selection=e;const{name:i,nature:s,attributes:r}=t;let a=(0,n.createDiv)({class:["app-model-concept"]}),o=(0,n.createDiv)({class:["app-model-concept-header"]}),l=(0,n.createI)({class:["app-model-concept-nature"],dataset:{name:s}},$[s.toUpperCase()]),c=(0,n.createSpan)({class:["app-model-concept-name"]},i);o.append(l,c);let h=(0,n.createUnorderedList)({class:["bare-list","app-model-concept-attributes"]});Array.isArray(r)&&r.forEach((e=>{let t=(0,n.createListItem)({class:["app-model-concept-attribute"],dataset:{name:e.name,type:"attribute"}}),i=(0,n.createDiv)({class:["app-model__attribute-header"]}),s=(0,n.createSpan)({class:["app-model__attribute-name"]},e.name);if(e.required){let e=(0,n.createI)({class:["app-model__attribute-required"]},(0,n.createSpan)({class:["help"]},"required"));i.append(e)}i.append(s);let r=(0,n.createDiv)({class:["app-model__attribute-target"]},q(e.target)),a=(0,n.createDiv)({class:["app-model__attribute-info"]},[i,r]);t.append(a),this.attributes.set(e.name,t),h.append(t)})),a.append(o,h),(0,n.removeChildren)(this.infoView),this.infoView.append(a),this.selectedConcept=t,this.refresh()},selectAttribute(e){return!(0,n.isNullOrUndefined)(e)&&(this.selectedAttribute!==e&&(this.selectedAttribute&&this.attributes.get(this.selectedAttribute).classList.remove("selected"),!!this.attributes.has(e)&&(this.selectedAttribute=e,this.attributes.get(e).classList.add("selected"),this.displayAttribute(e),this.refresh(),!0)))},displayAttribute(e){this.refresh()},bindEvents(){this.editor.registerHandler("editor.load-concept@post",(e=>{this.reload()})),this.editor.registerHandler("editor.unload-concept@post",(e=>{this.reload()})),this.editor.registerHandler("editor.unload-projection@post",(e=>{this.reload()})),this.container.addEventListener("dragenter",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragleave",(e=>{this.container.classList.remove("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragover",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("drop",(e=>{this.container.classList.remove("highlight");let t=e.dataTransfer.files[0];if(!t.name.endsWith(".json"))return void this.notify("This file is not supported. Please use a .json file");let i=new FileReader;i.onload=e=>{this.editor.load(i.result,this.type)},i.readAsText(t),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("click",(e=>{const{target:t}=e,{type:i,name:s}=t.dataset;this.displayConcept(s),"attribute"===i?this.selectAttribute(s):"concept"===i&&this.parent.selectConcept(s)}))}};function q(e){const t=(0,n.createDocFragment)();if((0,n.isNullOrUndefined)(e))return t;const{name:i,accept:s}=e;let r=(0,n.createSpan)({class:["target-name"],dataset:{type:"concept",name:i}},i);if(t.append(r),s){let e=(0,n.createDiv)({class:["target-accept"]});Array.isArray(s)?(e.append(...s.map((e=>q(e)))),e.classList.add("array")):e.append(q(s)),t.append(e)}return t}const z={container:null,values:null,filters:null,concepts:null,init(e){this.values=(0,n.valOrDefault)(e,[]);let t=1;return this.values.forEach((e=>{e.id=t++})),this.filters=new Map,this},refresh(){this.filters.forEach(((e,t)=>{e.checked?e.parentElement.classList.add("checked"):e.parentElement.classList.remove("checked")}))},render(){return(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:"concept-filter"})),this.search=(0,n.createInput)({class:["concept-filter-search"]}),this.values.forEach((e=>{let t=(0,n.createInput)({class:["cf-option-checkbox"],type:"checkbox",checked:!0,value:e.id}),i=(0,n.createSpan)({class:["cf-option-text"]},e.label),s=(0,n.createLabel)({class:"concept-filter-option"},[t,i]);this.filters.set(e,t),this.container.append(s)})),this.bindEvents(),this.refresh(),this.container},filterConcepts(){this.settings.concepts.forEach(((e,t)=>{const{nature:i,root:s}=e.dataset;this.filters.forEach(((t,r)=>{r.nature===i&&(t.checked?u(e):d(e)),r.root===(0,n.toBoolean)(s)&&(t.checked?u(e):d(e))}))})),this.refresh()},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e;this.filterConcepts()}))}},W={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!(0,n.isNullOrUndefined)(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),d(this.placeholder),u(this.conceptList)):(this.container.classList.add("empty"),u(this.placeholder),d(this.conceptList)),this.hasSelection||d(this.infoView),this},render(){return this.container=(0,n.createDiv)({class:["editor-config"]}),this.mainView=(0,n.createDiv)({class:["editor-config-main"]}),this.infoView=(0,n.createDiv)({class:["editor-config-info"]}),this.conceptList=(0,n.createUnorderedList)({class:["bare-list","editor-config__list"]}),this.placeholder=(0,n.createParagraph)({class:["editor-config-placeholder"],html:`${B("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){(0,n.removeChildren)(this.conceptList),(0,n.removeChildren)(this.infoView),this.cache.clear(),this.refresh()},selectItem(e){if(!this.cache.has(e))return null;let t=this.cache.get(e);return(0,n.isHTMLElement)(this.selection)&&this.selection.classList.remove("selected"),this.selection=t,this.selection.classList.add("selected"),this.refresh(),e},show(){return u(this.container),this.visible=!0,this},hide(){return d(this.container),this.visible=!1,this},addItem(e){let t=(0,n.createSpan)({class:["loaded-element-name","fit-content"]},e.name),i=(0,n.createListItem)({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:e.name,status:"active"}}),s=(0,n.createButton)({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:e.name}});i.append(t,s),this.conceptList.append(i),this.cache.set(e.name,i),this.refresh()},bindEvents(){}},K={menu:null,schema:null,isOpen:!1,visible:!0,btnStart:null,settings:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,n.isHTMLElement)(this.container)},clear(){return(0,n.removeChildren)(this.container),this},update(){},render(){const e=(0,n.createDocFragment)();if(!(0,n.isHTMLElement)(this.container)){this.container=(0,n.createDiv)({class:["editor-home"]});let e=(0,n.createImage)({class:["editor-logo"],src:"https://gentlemancp.org/assets/images/logo_gentleman_200.png"}),t=(0,n.createH2)({class:["editor-title"]},"Settings"),i=(0,n.createDiv)({class:["editor-home-header"]},[e,t]);this.container.append(i)}return(0,n.isHTMLElement)(this.menu)||(this.menu=Object.create(X,{editor:{value:this.editor}}).init(),e.append(this.menu.render())),(0,n.isHTMLElement)(this.btnStart)||(this.btnStart=(0,n.createButton)({class:["btn","editor-home-section--model__button","editor-home-section__button--start"],dataset:{action:"close",context:"home"}},"Done!"),e.append(this.btnStart)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){const{hasConceptModel:e,hasProjectionModel:t}=this.editor;return this.btnStart.disabled=!(e&&t),this},actionHandler(e,t){const{concept:i}=t.dataset;"open-concept"===e&&(this.menu.config.selectItem(i),this.menu.config.showInfo(i))},bindEvents(){this.editor.registerHandler("concept-model.updated",(()=>{this.menu.config.clear(),this.editor.hasConceptModel&&this.editor.conceptModel.schema.filter((e=>e.root)).forEach((e=>{this.menu.config.addItem(e)}))}))}},X={container:null,tabsElement:null,tabs:null,currentTab:null,activeTab:null,fileIO:null,config:null,dataSettings:null,buildSettings:null,init(){return this.tabs=new Map,this.tabs.set("file","File"),this.tabs.set("config","Config"),this.currentTab="file",this},refresh(){},render(){return this.container=(0,n.createSection)({class:["editor-home-menu"]}),this.tabsElement=(0,n.createUnorderedList)({class:["bare-list","editor-home-menu-tabs"]}),this.tabs.forEach(((e,t)=>{let i=(0,n.createListItem)({class:["editor-home-menu-tab"],dataset:{name:t}},e);this.tabs.set(t,i),this.tabsElement.append(i)})),this.window=(0,n.createDiv)({class:["editor-home-menu-section"]}),this.fileIO=Y.call(this),this.config=J.call(this),this.dataSettings=G.call(this),this.window.append(this.fileIO.render()),this.window.append(this.config.render()),this.window.append(this.dataSettings.render()),this.selectTab(this.currentTab),this.container.append(this.tabsElement,this.window),this.bindEvents(),this.container},selectTab(e){(0,n.isNullOrUndefined)(e)||this.activeTab&&this.currentTab===e||("file"===e?(this.fileIO.show(),this.config.hide(),this.dataSettings.hide()):"config"===e&&(this.config.show(),this.fileIO.hide(),this.dataSettings.hide()),this.activeTab&&b(this.activeTab),this.currentTab=e,this.activeTab=this.tabs.get(this.currentTab),g(this.activeTab))},bindEvents(){this.tabsElement.addEventListener("click",(e=>{const{target:t}=e,{name:i}=t.dataset;this.selectTab(i)}))}};function Y(e){const t=Object.create(F,{editor:{value:this.editor}});return t.init(),t}function J(){const e=Object.create(V,{editor:{value:this.editor}});return e.init(),e}function G(){const e=Object.create(W,{editor:{value:this.editor}});return e.init(),e}function Q(e,t){const{name:i,object:s,id:r}=t,a=(0,n.createListItem)({class:["selector-concept",`selector-concept--${e}`],title:t.getName(),dataset:{concept:r,object:s}});var o=(0,n.createSpan)({class:["selector-concept-content"]},t.getName());a.append(o),"ancestor"===e&&o.classList.add("fit-content");const l=(0,n.createI)({class:["selector-concept-status"]});if(t.hasError){l.classList.add("error");let e=(0,n.createUnorderedList)({class:["bare-list","selector-concept-status__errors"]});t.errors.forEach((t=>{let i=(0,n.createListItem)({class:["selector-concept-status__error"]},t);i.style.minWidth=`${Math.min(.5*t.length,30)}em`,e.append(i)})),l.append(e),a.classList.add("error")}else l.classList.add("valid"),a.classList.add("valid");return a.append(l),a.addEventListener("mouseenter",(e=>{let t=(0,n.getElement)(`.projection[data-concept="${r}"]`,this.editor.body);t&&this.editor.highlight(t)})),a.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),a.addEventListener("click",(e=>{let t=(0,n.getElement)(`.projection[data-concept="${r}"]`,this.editor.body);t&&t.focus()})),a}const Z={container:null,title:null,conceptList:null,header:null,body:null,get isRendered(){return(0,n.isHTMLElement)(this.container)},init(e={}){return this.schema=e,this},update(){},refresh(){const{activeInstance:e,activeConcept:t,hasActiveInstance:i,hasActiveConcept:s}=this.editor;if(!i||!s)return(0,n.removeChildren)(this.conceptList),this;const r=e.concept,a=(0,n.createDocFragment)();let o=Q.call(this,"root",r);if(a.append(o),r===t&&o.classList.add("selector-concept--active"),r===t)return(0,n.removeChildren)(this.conceptList).append(a),this;if(!t.hasParent())return(0,n.removeChildren)(this.conceptList).append(a),this;let l=t.getParent(),c=[];for(;l&&l!==r;)c.unshift(l),l=l.getParent();return c.forEach((e=>{a.append(Q.call(this,"ancestor",e))})),o=Q.call(this,"active",t),a.append(o),(0,n.removeChildren)(this.conceptList).append(a),this},render(){const e=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["editor-breadcrumb"]})),(0,n.isHTMLElement)(this.notification)||(this.notification=(0,n.createDiv)({class:["notification","breadcrumb-notification"]}),e.append(this.notification));const t=(0,n.createSpan)({class:["breadcrumb-title","hidden"],dataset:{ignore:"all"}},"Breadcrumb");return e.append(t),(0,n.isHTMLElement)(this.conceptList)||(this.conceptList=(0,n.createUnorderedList)({class:["bare-list","selector-concepts"]}),e.append(this.conceptList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.update(),this.refresh(),this.container},bindEvents(){}},ee={schema:null,isOpen:!1,visible:!0,btnStart:null,logList:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,n.isHTMLElement)(this.container)},add(e,t,i="normal"){if(!Array.isArray(e))return;let s=(0,n.createUnorderedList)({class:["bare-list","log-item-messages"]});e.forEach((e=>s.append((0,n.createListItem)({class:["log-item-message"]},e))));let r=(0,n.createListItem)({class:["log-item",`log-item--${i}`]}),a=(0,n.createButton)({class:["btn","btn-delete"],dataset:{action:"delete",target:"parent"}},"✖"),o=(0,n.createSpan)({class:["log-item__name"],dataset:{action:"delete",target:"parent"}},`${(0,n.valOrDefault)(t,"Log")} (${(0,n.shortDateTime)(Date.now())})`);return r.append(a,o,s),this.logList.append(r),this.refresh(),this},clear(){return(0,n.removeChildren)(this.logList),this},update(){},render(){const e=(0,n.createDocFragment)();return(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["editor-log"]})),(0,n.isHTMLElement)(this.logList)||(this.logList=(0,n.createUnorderedList)({class:["bare-list","log-list"]}),e.append(this.logList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this.logList.hasChildNodes()?this.show():this.hide(),this},bindEvents(){}},te={modelstatus:null,editorstatus:null,notification:null,views:null,view:"grid",viewContainer:null,viewList:null,viewItem:null,activeViewItem:null,groupList:null,groupItem:null,activeGroupItem:null,visible:!0,container:null,get isRendered(){return(0,n.isHTMLElement)(this.container)},init(){return this.views=new Map,this},show(){return u(this.container),this.visible=!0,this},hide(){return d(this.container),this.visible=!1,this},toggle(){return p(this.container),this.visible=!this.visible,this},updateActiveView(){"tab"===this.view&&(this.editor.instances.forEach((e=>{e!==this.editor.activeInstance&&(e.view.classList.remove("active"),e.hide())})),this.editor.activeInstance.view.classList.add("active"),this.editor.activeInstance.show()),this.editor.refresh()},addView(e){if((0,n.isNullOrUndefined)(e))return!1;let t=e.title.textContent,i=(0,n.createI)({class:["ico","ico-delete"]},"✖"),s=(0,n.createButton)({class:["btn","btn-close"]},i),r=(0,n.createDiv)({class:[`editor-view-${this.view}list-item__content`,"fit-content"]},t),a=(0,n.createListItem)({class:[`editor-view-${this.view}list-item`],title:e.title.textContent},[r,s]);e.view=a,a.addEventListener("click",(t=>{let i=function(e){const t=e=>e===a||e===s;return t(e)?e:(0,n.findAncestor)(e,(e=>t(e)),5)}(t.target);if(i===s){let t=a.previousSibling||a.nextSibling;e.delete(),null===this.editor.activeInstance&&t&&t.click()}else this.editor.updateActiveInstance(e)})),this.tabView.append(a)},changeView(e){if(e===this.view)return this;this.view=e,b(this.viewItem),this.viewItem=this.views.get(this.view),g(this.viewItem),(0,n.removeChildren)(this.editor.viewSection),"tab"===e?(this.tabView=(0,n.createUnorderedList)({class:["bare-list","editor-view-tablist"]}),(0,n.removeChildren)(this.tabView),this.editor.instances.forEach((e=>{e.expand(),this.addView(e)})),this.editor.viewSection.append(this.tabView)):"grid"===e&&this.editor.instances.forEach((e=>{e.show()})),this.updateActiveView()},addGroup(){(0,n.createListItem)({class:["editor-footer-group"]})},notify(e,t=4500){let i=e;const s="open";if(this.notification.classList.contains(s))return!1;this.notification.appendChild(i),setTimeout((()=>{this.notification.classList.add(s),this.container.classList.add("menu--notifying")}),50),setTimeout((()=>{this.notification.classList.remove(s),this.container.classList.remove("menu--notifying"),setTimeout((()=>{(0,n.removeChildren)(this.notification)}),500)}),t)},refresh(){const{conceptModel:e}=this.editor;if(this.editor.isReady){if(e.hasError){this.modelstatusBadge.classList.add("error"),this.modelstatusBadge.classList.remove("valid"),this.container.classList.add("error");let t=e.concepts.filter((e=>e.hasError)).length;this.modelstatusInfo.textContent=`${t} ${function(e,t,i){if(1===i)return e;let s="s".split("|");return 1===s.length?e+s[0]:e.substring(0,e.lastIndexOf(s[0]))+s[1]}("error",0,t)}`}else this.modelstatusBadge.classList.add("valid"),this.modelstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,n.removeChildren)(this.modelstatusInfo),this.editor.logs.clear();if(this.editor.hasError){this.editorstatusBadge.classList.add("error"),this.editorstatusBadge.classList.remove("valid"),this.container.classList.add("error");let e=this.editor.errors.length;this.editorstatusInfo.textContent=`${e}`}else this.editorstatusBadge.classList.add("valid"),this.editorstatusBadge.classList.remove("error"),this.container.classList.remove("error"),(0,n.removeChildren)(this.editorstatusInfo),this.editor.logs.clear()}},render(){const e=(0,n.createDocFragment)();if((0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["editor-statusbar"]})),(0,n.isHTMLElement)(this.badgeContainer)||(this.badgeContainer=(0,n.createDiv)({class:["editor-statusbar-badge-container"]}),e.appendChild(this.badgeContainer)),(0,n.isHTMLElement)(this.modelstatus)||(this.modelstatus=(0,n.createDiv)({class:["editor-statusbar-model"]}),this.modelstatusBadge=(0,n.createI)({class:["editor-statusbar-model-badge"]}),this.modelstatusInfo=(0,n.createDiv)({class:["editor-statusbar-model-info"]}),this.modelstatus.append(this.modelstatusBadge,this.modelstatusInfo),this.badgeContainer.appendChild(this.modelstatus)),(0,n.isHTMLElement)(this.editorstatus)||(this.editorstatus=(0,n.createDiv)({class:["editor-statusbar-global"]}),this.editorstatusBadge=(0,n.createI)({class:["editor-statusbar-global-badge"]}),this.editorstatusInfo=(0,n.createDiv)({class:["editor-statusbar-global-info"]}),this.editorstatus.append(this.editorstatusBadge,this.editorstatusInfo),this.badgeContainer.appendChild(this.editorstatus)),(0,n.isHTMLElement)(this.viewContainer)||(this.viewContainer=(0,n.createDiv)({class:["editor-statusbar-viewer-container"]}),e.appendChild(this.viewContainer)),!(0,n.isHTMLElement)(this.btnGroup)){let e=(0,n.createI)({class:["ico","ico-plus","btn-content"],title:"Add a group",dataset:{ignore:"all"}},"+");this.btnGroup=(0,n.createButton)({class:["editor-statusbar-viewer__button-add"],dataset:{action:"add-group"}},e)}return(0,n.isHTMLElement)(this.groupContainer)||(this.groupContainer=(0,n.createDiv)({class:["editor-footer-group"]})),(0,n.isHTMLElement)(this.viewList)||(this.viewList=(0,n.createUnorderedList)({class:["bare-list","editor-statusbar-viewers"]}),this.viewContainer.appendChild(this.viewList)),["grid","tab"].forEach((e=>{let t=(0,n.createListItem)({class:["editor-statusbar-viewer"],dataset:{type:"viewer",action:"change-view",value:e}},e);this.views.set(e,t),this.viewList.append(t)})),this.viewItem=this.views.get(this.view),this.viewItem.classList.add("selected"),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},bindEvents(){function e(e,t){let i=(0,n.createEmphasis)({class:["link","error-message__link"]},e);const s=`.projection[data-concept="${t}"]`;return i.addEventListener("mouseenter",(e=>{let t=(0,n.getElement)(s,this.editor.body);t&&this.editor.highlight(t)})),i.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),i.addEventListener("click",(e=>{let t=this.editor.resolveElement((0,n.getElement)(s,this.editor.body));t&&t.focus()})),i}this.modelstatus.addEventListener("click",(t=>{if(!this.editor.conceptModel.hasError)return;let i=[];this.editor.conceptModel.concepts.forEach((t=>{t.hasError&&i.push(...t.errors.map((i=>{let s=e.call(this,t.getName(),t.id);return(0,n.createSpan)({class:["error-message"]},[s,`: ${i}`])})))})),this.editor.logs.clear(),this.editor.logs.add(i,"Validation error",w)})),this.editorstatus.addEventListener("click",(e=>{if(!this.editor.hasError)return;let t=[];t.push(...this.editor.errors.map((e=>(0,n.createSpan)({class:["error-message"]},[`${e.message}`])))),this.editor.logs.clear(),this.editor.logs.add(t,"Validation error",w)})),this.editor.registerHandler("editor.instance@active:updated",(()=>{this.updateActiveView()}))}},ie={container:null,list:null,editor:null,dataList:null,fetch:null,init(e){return this.fetch=e,this},render(){const e=(0,n.createDocFragment)();return(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["container","container--editor-selectors"]})),(0,n.isHTMLElement)(this.list)||(this.list=(0,n.createUnorderedList)({class:["bare-list","editor-selectors","font-ui"]}),e.append(this.list)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this},update(){this.dataList=this.fetch(),(0,n.removeChildren)(this.list);let e=(0,n.valOrDefault)(this.editor.getConfig("concept"),{});return this.dataList.forEach((t=>{const{concept:i,accept:s}=t;let r=(0,n.createH4)({class:["title","editor-selector__title"]},`${a=t.name,(0,n.hasOwn)(e,a)?e[a].name:a}`);var a;i&&r.append((0,n.createSpan)({class:["editor-selector__title-concept"]},(i.name||i.prototype).replace(" ","-").toLowerCase())),s&&r.append((0,n.createSpan)({class:["editor-selector__title-accept"]},s.name)),(0,n.createButton)({class:["btn","editor-selector__header-button","editor-selector__header-button--info"],title:`View ${t.name||t.type} info`,dataset:{action:"collapse",rel:"parent",target:"selector"}},"i");let o=(0,n.createHeader)({class:["title","editor-selector__header"],title:`Expand/Collapse ${this.type}`},[r]),l=se[this.type],c=(0,n.createDiv)({class:["editor-selector__action-bar"]},l.call(this,t)),h=(0,n.createListItem)({class:["editor-selector","collapsed","font-ui"],tabindex:0,dataset:{type:this.type,alias:`${t.name||t.type}`,name:"selector",projection:t.id}},[o,c]);this.list.append(h)})),this.refresh(),this},show(){return u(this.container),this},hide(){return d(this.container),this},bindEvents(){}},se={projection:function(e){const t=(0,n.createDocFragment)();let i=(0,n.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"edit:projection",id:e.id}},"Edit");return t.append(i),t},value:function(e){const t=(0,n.createDocFragment)();let i=(0,n.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"create-instance:value",id:e.id}},(0,n.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),s=(0,n.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"copy:value",id:e.id}},(0,n.createI)({class:["ico","ico-copy","btn-content"],dataset:{ignore:"all"}})),r=(0,n.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:value",id:e.id}},(0,n.createI)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return t.append(r,s,i),t},concept:function(e){const t=(0,n.createDocFragment)();let i=this.editor.projectionModel.hasProjectionSchema(e),s=(0,n.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],disabled:!i,title:`Create an instance of "${e.name}"`,dataset:{action:"create-instance",concept:e.name}},(0,n.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+"));return i||(s.title=`The concept ${e.name} has no projection`),t.append(s),t},resource:function(e){const{name:t,type:i,required:s}=e,r=(0,n.createDocFragment)();let a=(0,n.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--add"],dataset:{action:"load-resource",id:t}},(0,n.createI)({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),o=(0,n.createButton)({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:resource",id:t}},(0,n.createI)({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return this.editor.getResource(t)?r.append(o):r.append(a),r}},ne={editor:null,valueCount:0,fileCount:0,container:null,title:null,visible:!0,tabs:null,tabConcept:null,tabValue:null,tabProjection:null,tabResource:null,tabConceptNotification:null,tabValueNotification:null,tabProjectionNotification:null,tabResourceNotification:null,activeTab:null,activeTabValue:null,menu:null,header:null,body:null,btnHome:null,btnSave:null,btnClose:null,get isRendered(){return(0,n.isHTMLElement)(this.container)},init(e){return e&&(this.editor=e),this._conceptSelector=function(e,t,i){return Object.create(ie,{object:{value:"selector"},model:{value:void 0},type:{value:"concept"},editor:{value:t}})}(0,this.editor).init((()=>this.editor.isReady?this.editor.conceptModel.getSchema("concrete").filter((e=>e.root)):[])),this},render(){const e=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["editor-header"],dataset:{name:"editor-header",alias:"header"}})),(0,n.isHTMLElement)(this.title)||(this.title=(0,n.createSpan)({class:["editor-header-title"]},"Gentleman")),(0,n.isHTMLElement)(this.menu)||(this.menu=(0,n.createDiv)({class:["editor-header-left"]},[this.title]));let t=(0,n.valOrDefault)(this.editor.getConfig("toolbar"),[]),i=(0,n.createDiv)({class:["editor-toolbar"]},t.map((e=>(0,n.createButton)({class:(0,n.valOrDefault)(e.class,[]),dataset:{name:e.name,action:e.action}},e.content))));return(0,n.isHTMLElement)(this.btnHome)||(this.btnHome=(0,n.createButton)({class:["btn","editor-toolbar__button","editor-toolbar__button--home"],title:"Toggle menu",dataset:{action:"home"}}),i.append(this.btnHome)),(0,n.isHTMLElement)(this.header)||(this.header=(0,n.createDiv)({class:["editor-header-menu"]},[this.menu,i]),e.append(this.header)),(0,n.isHTMLElement)(this.body)||(this.body=(0,n.createDiv)({class:["editor-header-main"]}),e.append(this.body)),(0,n.isHTMLElement)(this._conceptSelector.container)||this.body.append(this._conceptSelector.render()),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){let e=(0,n.valOrDefault)(this.editor.getConfig("settings"),!0),t=(0,n.valOrDefault)(this.editor.getConfig("header"),!0);return this.editor.hasConceptModel?(this._conceptSelector.update(),u(this.body)):d(this.body),!1===e&&d(this.btnHome),!1===t&&d(this.body),this},show(e){if(!(0,n.isHTMLElement)(this[e]))return u(this.container),this.visible=!0,this;u(this[e])},hide(e){if(!(0,n.isHTMLElement)(this[e]))return d(this.container),this.visible=!1,this;d(this[e])},toggle(){return p(this.container),this.visible=!this.visible,this},bindEvents(){}};var re=0;const ae={createInstance(e,t,i){if((0,n.isNullOrUndefined)(e))return this.notify("The concept is not valid",y.ERROR),!1;let s="concept"===e.type?e:this.createConcept(e),r=t;(0,n.isNullOrUndefined)(r)&&this.hasProjectionModel&&(r=this.createProjection(s).init());let a=Object.create(oe,{id:{value:"instance"+re++},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},concept:{value:s,writable:!0},projection:{value:r,writable:!0},editor:{value:this}});const o=Object.assign({type:"concept",resize:!0,maximize:!0,close:"DELETE-CONCEPT"},i);return a.init(o),this.addInstance(a),a},getInstance(e){return this.instances.get(e)},addInstance(e){return e.isRendered||this.instanceSection.append(e.render()),this.instances.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),e.concept.notify("displayed",e.projection.element.id),this.updateActiveInstance(e),this.refresh(),this},removeInstance(e){let t=this.getInstance(e);return!(0,n.isNullOrUndefined)(t)&&(t===this.activeInstance&&(this.activeInstance=null),t.view&&(0,n.removeChildren)(t.view).remove(),this.instances.delete(e),this.refresh(),!0)},moveInstance(e,t){return this.instanceSection.children[t].before(e),this},swapInstance(e,t){let i=Array.from(this.instanceSection.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveInstance(t,s),this.moveInstance(e,n),this}},oe={window:null,container:null,title:null,visible:!0,menu:null,header:null,body:null,btnMaximize:null,btnClose:null,size:1,fullscreen:!1,collapsed:!1,schema:null,ctype:null,get isRendered(){return(0,n.isHTMLElement)(this.container)},init(e={}){return this.ctype=(0,n.valOrDefault)(e.type,"concept"),this.schema=e,this},setTitle(e){return!(0,n.isNullOrWhitespace)(e)&&(this.title.textContent=e,!0)},collapse(){var e;return e=this.container,(0,n.isHTMLElement)(e)&&e.classList.add(o),this.collapsed=!0,this.fullscreen=!1,this.size="normal",this.refresh(),this},expand(){var e;return e=this.container,(0,n.isHTMLElement)(e)&&e.classList.remove(o),this.collapsed=!1,this.refresh(),this},changeSize(e){this.size=e,"fullscreen"===e?(this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height")):this.fullscreen=!1,this.refresh()},full(){this.size="fullscreen",this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height"),this.refresh()},show(){return u(this.container),this.visible=!0,this},hide(){return d(this.container),this.visible=!1,this},toggle(){return p(this.container),this.visible=!this.visible,this},refresh(){return this.container.dataset.size=`${this.size}`,(0,n.isNullOrUndefined)(this.projection)&&(this.body.textContent="No projection found"),Array.from(this.editor.instances).some((e=>e.fullscreen))?this.editor.instanceSection.classList.add("fullscreen"):this.editor.instanceSection.classList.remove("fullscreen"),this},render(){const e=(0,n.createDocFragment)(),{name:t}=this.concept,i=t.toLowerCase();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["editor-concept",`editor-concept--${this.ctype}`],tabindex:0,dataset:{nature:"concept-container",type:this.ctype,size:1}})),(0,n.isHTMLElement)(this.header)||(this.header=(0,n.createHeader)({title:"concept"===this.schema.type?`Instance of "${i}"`:`Linked instance of "${i}"`,class:["editor-concept-header"]}),e.append(this.header)),(0,n.isHTMLElement)(this.btnClose)||(this.btnClose=(0,n.createButton)({class:["btn","editor-concept-toolbar__btn-delete"],title:`Delete the instance "${i}"`,dataset:{action:"close",context:this.type,id:this.id}}),"projection"===this.schema.type&&(this.btnClose.title=`Close the linked instance "${i}"`)),(0,n.isHTMLElement)(this.btnMaximize)||(this.btnMaximize=(0,n.createButton)({class:["btn","editor-concept-toolbar__btn-maximize"],title:`Maximize ${t.toLowerCase()}`,dataset:{action:"maximize",context:this.type,id:this.id}})),this.title=(0,n.createH3)({class:["title","editor-concept-title","fit-content"],dataset:{nature:"editable",id:this.id}},(0,n.valOrDefault)(this.schema.title,t));let s=(0,n.createDiv)({class:["editor-concept-toolbar"]},[this.btnMaximize,this.btnClose]);return(0,n.removeChildren)(this.header).append(this.title,s),this.body&&this.body.remove(),this.projection?this.body=this.projection.render():this.body=(0,n.createParagraph)(),e.append(this.body),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),function(e,t={}){const i=_(e);if(!(0,n.isHTMLElement)(i))return null;const s=Object.assign({horizontal:!0,vertical:!0,minWidth:60,minHeight:60},t),r=function(){let e=(0,n.createDiv)({class:["resizers"]});return["horizontal","vertical"].forEach((t=>{e.append((0,n.createDiv)({class:["resizer",`${t}`],dataset:{dir:t}}))})),e}();i.prepend(r),s.horizontal&&s.vertical?i.dataset.resizable="both":s.horizontal?i.dataset.resizable="horizontal":s.vertical&&(i.dataset.resizable="vertical");const{minWidth:a,minHeight:o}=getComputedStyle(i),l=(0,n.valOrDefault)(k(a),s.minWidth),c=(0,n.valOrDefault)(k(o),s.minHeight);let h=0,u=null;function d(e){const{dir:t}=u.dataset,{width:s,height:n}=getComputedStyle(i);let r="horizontal"===t?e.pageX:e.pageY;if("horizontal"===t){const e=k(s)+(r-h);e>l&&(i.style.width=`${e}px`)}else if("vertical"===t){const e=k(n)+(r-h);e>c&&(i.style.height=`${e}px`)}h=r}for(let e=0;e<r.childElementCount;e++){const t=r.children[e];t.addEventListener("mousedown",(function(e){e.preventDefault(),u=t;const{dir:i}=u.dataset;h="horizontal"===i?e.pageX:e.pageY,document.body.addEventListener("mousemove",d),document.body.addEventListener("mouseup",(()=>{document.body.removeEventListener("mousemove",d)}))}))}}(this.container),this.refresh(),this.container},clear(){},actionHandler(e){switch(e){case"collapse":this.collapsed?this.expand():this.collapse();break;case"maximize":this.fullscreen?this.changeSize("normal"):this.changeSize("fullscreen");break;case"close":this.delete()}},delete(){switch(this.schema.close){case"DELETE-CONCEPT":if(!this.concept.delete(!0))return this.editor.notify("The concept could not be deleted",y.ERROR),this;break;case"DELETE-PROJECTION":if(this.projection&&!this.projection.delete())return this.notify("The projection could not be deleted",y.ERROR),this}(0,n.removeChildren)(this.container).remove(),this.editor.removeInstance(this.id),this.window&&this.window.removeInstance(this)},bindEvents(){this.container.addEventListener("focusin",(e=>{this.editor.updateActiveInstance(this)}))}};var le=0;const ce={createWindow(e){let t=Object.create(he,{id:{value:"window"+le++},object:{value:"environment"},name:{value:"editor-window"},type:{value:"window"},editor:{value:this}});return t.refname=e,t.init(),this.addWindow(t),t},getWindow(e){return this.windows.get(e)},findWindow(e){return Array.from(this.windows.values()).find((t=>t.refname===e))},addWindow(e){return e.isRendered||this.body.append(e.render()),this.windows.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.refresh(),this},removeWindow(e){let t=this.getWindow(e);return!(0,n.isNullOrUndefined)(t)&&(t===this.activeWindow&&(this.activeWindow=null),t.view&&(0,n.removeChildren)(t.view).remove(),this.windows.delete(e),this.refresh(),!0)},moveWindow(e,t){return this.body.children[t].before(e),this},swapWindow(e,t){let i=Array.from(this.body.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveWindow(t,s),this.moveWindow(e,n),this}},he={container:null,title:null,visible:!0,instances:null,menu:null,header:null,body:null,btnClose:null,maxInstance:1,get isRendered(){return(0,n.isHTMLElement)(this.container)},init(e={}){return this.ctype=(0,n.valOrDefault)(e.type,"concept"),this.schema=e,this.instances=new Set,this},isEmpty(){return 0===this.instances.size},show(){return u(this.container),this.visible=!0,this},hide(){return d(this.container),this.visible=!1,this},toggle(){return p(this.container),this.visible=!this.visible,this},close(){(0,n.removeChildren)(this.container).remove(),this.editor.removeWindow(this.id)},refresh(){return this.isEmpty()?this.hide():this.show(),this},render(){const e=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["editor-window"],tabindex:-1})),(0,n.isHTMLElement)(this.header)||(this.header=(0,n.createHeader)({class:["editor-window-header"]}),e.append(this.header)),(0,n.isHTMLElement)(this.title)||(this.title=(0,n.createH3)({class:["title","editor-window-title","fit-content"]})),(0,n.isHTMLElement)(this.btnClose)||(this.btnClose=(0,n.createButton)({class:["btn","editor-window-header__btn-delete"],title:"Close the window",dataset:{action:"close",context:this.type,id:this.id}}));let t=(0,n.createDiv)({class:["editor-window-toolbar"]},[this.btnClose]);return(0,n.removeChildren)(this.header).append(this.title,t),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},getInstance(e){return(0,n.isNullOrUndefined)(e)?null:Array.from(this.instances).find((t=>t.id===e))},addInstance(e){if(!(0,n.isNullOrUndefined)(e)&&!this.instances.has(e))return this.instances.add(e),e.window=this,this.container.append(e.container),this.refresh(),!0},removeInstance(e){if(!(0,n.isNullOrUndefined)(e)&&this.instances.has(e))return this.instances.delete(e),this.refresh(),!0},actionHandler(e){"close"===e&&this.close()},bindEvents(){}},ue={schema:null,isOpen:!1,visible:!0,btnClose:null,btnExport:null,outputName:null,selector:null,init(e){return e&&(this.schema=e),this},get isRendered(){return(0,n.isHTMLElement)(this.container)},clear(){return(0,n.removeChildren)(this.logList),this},update(){},render(){const e=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["editor-exporter","hidden"]})),(0,n.isHTMLElement)(this.btnClose)||(this.btnClose=(0,n.createButton)({title:"Close window",class:["btn","btn-collapse"]}),e.append(this.btnClose));let t=(0,n.createH4)({class:["editor-exporter-title"]},"Export model");if(e.append(t),(0,n.isNullOrUndefined)(this.selector)){let t=(0,n.createParagraph)({class:["editor-exporter__instruction"]},"Select the export format");this.selector=(i=["JSON","XML"],Object.create(de).init(i)),e.append(t,this.selector.render()),this.selector.select("JSON")}var i;if(!(0,n.isHTMLElement)(this.outputName)){let t=(0,n.createLabel)({class:["editor-exporter-file__label"]}),i=(0,n.createLabel)({class:["editor-exporter-file__label-value"]},"File");this.outputName=(0,n.createInput)({placeholder:"File name",class:["editor-exporter-file__input"]}),t.append(i,this.outputName),e.append(t)}return(0,n.isHTMLElement)(this.btnExport)||(this.btnExport=(0,n.createButton)({class:["btn","btn-export"]},"Export"),e.append(this.btnExport)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this},execute(){switch(this.selector.getValue()){case"JSON":this.toJSON(this.outputName.value);break;case"XML":this.toXML(this.outputName.value)}},toXML(){const{conceptModel:e}=this.editor,t=e.toXML();this.editor.download(t,`${this.outputName.value}.xml`,"XML")},toJSON(){const{conceptModel:e,projectionModel:t}=this.editor,i=JSON.stringify({type:"model",concept:e.schema,projection:t.schema,values:e.export()});this.editor.download(i,`${this.outputName.value}.json`,"JSON")},isValid(){return!(0,n.isNullOrWhitespace)(this.outputName.value)},bindEvents(){this.btnClose.addEventListener("click",(e=>{this.close()})),this.btnExport.addEventListener("click",(e=>{if(!this.isValid())return m(this.btnExport),void this.editor.notify("Enter the file name",y.ERROR,3e3);this.execute()}))}},de={container:null,values:null,selectors:null,selected:null,value:null,init(e){return this.values=(0,n.valOrDefault)(e,[]),this.selectors=new Map,this},getValue(){return this.value},refresh(){(0,n.isNullOrUndefined)(this.value)?this.container.classList.add("empty"):this.container.classList.remove("empty")},render(){let e=!1;return(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createUnorderedList)({class:["bare-list","export-selector"]}),e=!0),this.values.forEach((e=>{let t=this.createItem(e);this.container.append(t)})),e&&this.bindEvents(),this.container},select(e){if((0,n.isNullOrUndefined)(e))return;if(!this.selectors.has(e))return;let t=this.selectors.get(e);this.setSelectedItem(t),this.value=e,this.refresh()},createItem(e){let t=(0,n.createListItem)({class:["export-selector-item"],dataset:{value:e}}),i=(0,n.createLabel)({class:["export-selector-item__label"]}),s=(0,n.createInput)({type:"radio",name:"export-choice",value:e,class:["export-selector-item__input"]});return i.append(s,e),t.append(i),this.addItem(e,t),t},addItem(e,t){return this.selectors.set(e,t),this.refresh(),this},getItem(e){return this.selectors.get(e)},setSelectedItem(e){return!(!(0,n.isHTMLElement)(e)||e.parentElement!==this.container)&&(this.selected!==e?(this.selected&&b(this.selected),this.selected=e,g(this.selected),!0):void 0)},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e;(0,n.isNullOrUndefined)(t.value)||this.select(t.value)}))}},pe={container:null,isOpen:!1,visible:!0,show(){return u(this.container),this.visible=!0,this},hide(){return d(this.container),this.visible=!1,this},toggle(){return p(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this.editor.refresh(),this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this.editor.refresh(),this}};function me(){return Object.create(ne,{object:{value:"environment"},name:{value:"editor-header"},editor:{value:this}})}function fe(){return Object.create(Z,{object:{value:"environment"},name:{value:"editor-breadcrumb"},type:{value:"breadcrumb"},editor:{value:this}})}function ge(){return Object.assign(Object.create(pe,{object:{value:"environment"},name:{value:"editor-home"},type:{value:"home"},editor:{value:this}}),K)}function be(){return Object.create(te,{object:{value:"environment"},name:{value:"editor-status"},type:{value:"status"},editor:{value:this}})}function ve(){return Object.assign(Object.create(pe,{object:{value:"environment"},name:{value:"editor-log"},type:{value:"log"},editor:{value:this}}),ee)}function ye(){return Object.assign(Object.create(pe,{object:{value:"environment"},name:{value:"editor-exporter"},type:{value:"exporter"},editor:{value:this}}),ue)}const we={getHandlers(e){return(0,n.valOrDefault)(this.handlers.get(e),[])},triggerEvent(e,t,i=!0){const{name:s,options:r,args:a}=e,o=this.getHandlers(s),l=(0,n.isFunction)(t);let c=!1;return o.forEach((e=>{let s=e.call(this,a,r);!1!==s?i&&l&&t.call(this,s):c=!0})),!c&&(!i&&l&&t.call(this),!0)},registerHandler(e,t){return this.hasHanlder(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),!0},unregisterHandler(e,t){if(!this.hasHanlder(e))return!1;let i=this.getHandlers(e);for(let e=0;e<i.length;e++)if(i[e]===t)return i.splice(e,1),!0;return!1},hasHanlder(e){return this.handlers.has(e)},registerReceiver(e,t){(0,n.isNullOrUndefined)(this.activeReceiver[t])&&(this.activeReceiver[t]=e),(0,n.isNullOrUndefined)(this.receivers[t])&&(this.receivers[t]={root:e,projections:[]},e.isRoot=!0),this.receivers[t].projections.push(e)},saturationRevolved(e,t){console.log("Revolving"),console.log(t),console.log(this.receivers);let i,s=this.receivers[t].projections;for(let t=0;t<s.length;t++)e.id===s[t].id&&(i=t);if(i>=s.length)return void this.setActiveReceiver(e,t);let n=s[i+1].transmitFirst();console.log("Transmitting first"),console.log(n),e.acceptAnchor(n)},getActiveReceiver(e){return this.activeReceiver[e]},setActiveReceiver(e,t){this.activeReceiver[t]=e},getRootReceiver(e){return this.receivers[e].root},findReceiverInstance(e,t){let i=this.receivers[t].projections;for(let t=0;t<i.length;t++){let s=i[t].instances.get(e);if((0,n.isHTMLElement)(s))return{container:i[t],instance:s}}alert("Not Found")}},xe={create(e,t){const i=Object.create(this);return i.concept=e,i.schema=t,i},model:null,schema:null,source:null,id:null,value:null,object:"structure",init(e){throw new Error("This function has not been implemented")}};Object.defineProperty(xe,"model",{get(){return this.concept.model}}),Object.defineProperty(xe,"name",{get(){return this.schema.name}}),Object.defineProperty(xe,"required",{get(){return(0,n.valOrDefault)(this.schema.required,!0)}});const Ee={object:"attribute",target:null,init(e){return this.target=this.model.createConcept(this.schema.target,{value:(0,n.valOrDefault)(e,this.schema.value),parent:this.concept,ref:this}),this},getValue(){return this.target.getValue()},hasValue(){return this.target.hasValue()},setValue(e){this.target.setValue(e)},getTarget(){return this.target},copy(){return this.target.hasValue()?this.target.copy(!1):null},clone(){return this.target.hasValue()?this.target.clone():null},export(){return this.target.hasValue()?{id:this.target.id,name:this.target.name}:null},toString(){return{[`attribute.${this.name}`]:this.target.toString()}},toXML(){return this.target.hasValue()?this.target.toXML():""}},Ae=Object.assign(Object.create(xe),Ee),Oe={attributes:null,attributes_created:null,initAttribute(){return this.attributes=[],this.attributes_created=new Set,this.attributes_updated=new Set,this.attributes_deleted=new Set,Array.isArray(this.attributeSchema)&&this.attributeSchema.filter((e=>(0,n.valOrDefault)(e.required,!0))).forEach((e=>this.createAttribute(e.name))),this},getAttributes(){return this.attributes},getAttribute(e){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad argument");return this.getAttributeByName(e)},getAttributeSchema(e){if((0,n.isNullOrWhitespace)(e))throw new TypeError("Bad argument");if(!this.hasAttribute(e))throw new Error(`Attribute '${e}' does not exist`);return(0,n.cloneObject)(this.attributeSchema.find((t=>t.name===e)))},getAttributeByName(e){if((0,n.isNullOrWhitespace)(e))throw new TypeError("Bad argument");var t=this.attributes.find((t=>t.name===e));return(0,n.isNullOrUndefined)(t)&&(t=this.createAttribute(e)),t},createAttribute(e,t){if(!this.hasAttribute(e))throw new Error(`Attribute not found: The concept '${this.name}' does not contain an attribute named '${e}'`);if(this.isAttributeCreated(e)){let i=this.getAttributeByName(e);if(t){let e=this.model.getValue(t);i.target.initValue(e)}return i}const i=this.getAttributeSchema(e);let s=this.model.getValue(t);var n=Ae.create(this,i).init(s);return this.addAttribute(n),n},addAttribute(e){if((0,n.isNullOrUndefined)(e)||"attribute"!==e.object)throw new Error("Bad argument: 'attribute' must be an attribute object");return this.attributes.push(e),this.attributes_created.add(e.name),this.notify("attribute.added",e),this},hasAttributes(){return!(0,n.isEmpty)(this.attributeSchema)||!(0,n.isEmpty)(this.attributes)},hasAttribute(e){return-1!==this.attributeSchema.findIndex((t=>t.name===e))},isAttributeRequired(e){const t=this.getAttributeSchema(e);return(0,n.valOrDefault)(t.required,!0)},isAttributeCreated(e){return this.attributes_created.has(e)},listAttributes(){const e=[];return this.attributeSchema.forEach((t=>{e.push({type:"attribute",name:t.name,target:t.target,accept:t.accept,required:this.isAttributeRequired(name),created:this.isAttributeCreated(name)})})),e},removeAttribute(e){if(this.isAttributeRequired(e))return{message:`The attribute '${e}' is required.`,success:!1};var t=this.attributes.findIndex((t=>t.name===e));if(-1===t)return{message:`The attribute '${e}' was not found.`,success:!1};var i=this.attributes.splice(t,1)[0];return this.attributes_created.delete(e),this.notify("attribute.removed",i),{message:`The attribute '${e}' was successfully removed.`,success:!0}}},Ne={listeners:null,initObserver(){return this.listeners=[],this},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){var t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t,this)}))}},ke={model:null,schema:null,source:null,id:null,name:null,ref:null,actions:null,operations:null,accept:null,parent:null,references:null,errors:null,value:null,values:null,action:null,shadows:null,watchers:null,kind:"concept",init(e={}){return this.accept=e.accept,this.parent=e.parent,this.ref=e.ref,this.properties=(0,n.valOrDefault)(this.schema.properties,[]),Array.isArray(e.properties)&&this.properties.push(...e.properties),this.default=(0,n.valOrDefault)(this.schema.default,null),this.values=(0,n.valOrDefault)(e.values,(0,n.valOrDefault)(this.schema.values,[])),this.src=(0,n.valOrDefault)(this.schema.src,[]),this.constraint=this.schema.constraint,this.watchers=new Map,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},isRoot(){return(0,n.isNullOrUndefined)(this.parent)},initValue(){throw new Error("This function has not been implemented")},getName(){return this.ref&&"attribute"===this.ref.object?this.ref.name:this.name},getCandidates(){return this.values.forEach((e=>{(0,n.isObject)(e)&&(e.type="value")})),this.values},getStructure(){return[...this.listAttributes()]},getProperty(e,t){if("refname"===e){if((0,n.isNullOrUndefined)(this.ref))return;return this.ref.name}if("name"===e)return this.name;if("value"===e)return this.value;if(!this.hasProperty(e))return;let i=this.properties.find((t=>t.name===e));const{type:s,value:r}=i;return"string"===s?je.call(this,r):"number"===s?+r:"boolean"===s?(0,n.toBoolean)(r):r},hasProperty(e){return!!["refname","name","value"].includes(e)||-1!==(0,n.valOrDefault)(this.schema.properties,[]).findIndex((t=>t.name===e))},getConstraint(e){if(this.hasConstraint(e))return this.constraint[e]},hasConstraint(e){return!(0,n.isNullOrUndefined)(this.constraint)&&(!!(0,n.isNullOrUndefined)(e)||(0,n.hasOwn)(this.constraint,e))},hasParent(){return!this.isRoot()},getParent(e){if(this.isRoot())return null;if((0,n.isNullOrWhitespace)(e))return this.parent;const t=this.parent;return t.name===e?t:t.getParent(e)},getParentWith(e){if(this.isRoot())return null;if((0,n.isNullOrWhitespace)(e))return this.parent;const t=this.parent;return t.hasPrototype(e)?t:t.getParentWith(e)},getPrototype(){return(0,n.isNullOrUndefined)(this.prototype)?null:this.prototype},hasPrototype(e){if((0,n.isNullOrUndefined)(this.schema.prototype))return!1;if((0,n.isNullOrUndefined)(e))return!0;let t=this.model.getConceptSchema(this.schema.prototype);for(;!(0,n.isNullOrUndefined)(t);){if(t.name===e)return!0;t=this.model.getConceptSchema(t.prototype)}return!1},getAncestor(e){const t=[];for(var i=this.getParent(e);i;)t.push(i),i=i.getParent(e);return t},getChildren(e){const t=[];return(0,n.isNullOrUndefined)(e)?this.getAttributes().forEach((e=>{t.push(e.target)})):this.getAttributes().forEach((i=>{i.target.name===e?t.push(i.target):t.push(...i.target.getChildren(e))})),t},getDescendant(e){const t=[];return this.getChildren(e).forEach((i=>{t.push(i),t.push(...i.getDescendant(e))})),t},propagate(e,t,i){this.watchers.has(e)&&this.signal(e,t,i),this.hasParent()&&this.getParent().propagate(e,t,i)},watch(e,t){this.watchers.has(e)||this.watchers.set(e,[]),this.watchers.get(e).push(t)},signal(e,t,i){this.watchers.has(e)&&this.watchers.get(e).forEach((e=>e(t,i)))},unwatch(e,t){if((0,n.isNullOrUndefined)(e)||!this.watchers.has(e))return!1;if(!(0,n.isFunction)(t))return this.watchers.delete(e),!0;let i=this.watchers.get(e).findIndex((e=>e===t));return-1!==i&&(this.watchers.splice(i,1),!0)},done(){this.unregisterAll(),this.watchers.clear()},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}this.getChildren().forEach((e=>{e&&e.delete(!0)}));try{this.notify("delete"),this.model.removeConcept(this.id),this.notify("delete")}catch(e){return console.error(this),{message:"Concept not found",success:!1}}return{message:`The concept '${this.name}' was successfully deleted.`,success:!0}},copy(e=!0){const t={name:this.name,nature:this.nature};var i=[];return this.getAttributes().forEach((e=>{i.push({name:e.name,value:e.copy(!1)})})),t.attributes=i,e&&this.model.addValue(t),t},clone(){const e={id:this.id,name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.clone()})})),e.attributes=t,e},export(){const e={id:this.id,root:this.isRoot(),name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.export()})})),e.force=this.force,e.attributes=t,e},toString(){var e={};return this.attributes.forEach((t=>{Object.assign(e,t.toString())})),e},toXML(){let e=this.getName().replace(" ","-");return`<${e} id="${this.id}">`+this.attributes.map((e=>e.toXML())).join("")+`</${e}>`},toXMI(){let e=this.getName().replace(" ","-");return`<${e} id="${this.id}">`+this.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function je(e){if((0,n.isString)(e))return e;const{type:t}=e;return"concat"===t?Se.call(this,e.concat):void 0}function Le(e,t){const{type:i}=e;return"string"===i?je.call(this,e.value):"property"===i?this.getProperty(e.name):t||e}function Se(e,t=""){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");return e.length<2?Le.call(this,e[0]):e.map((e=>Le.call(this,e))).join(t)}const Ce=Object.assign(ke,Ne,Oe);Object.defineProperty(Ce,"attributeSchema",{get(){return this.schema.attributes}}),Object.defineProperty(Ce,"_prototype",{get(){return this.schema.prototype}}),Object.defineProperty(Ce,"hasError",{get(){return this.errors&&!(0,n.isEmpty)(this.errors)}});const Te={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.default=(0,n.valOrDefault)(this.schema.default,!0),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if((0,n.isNullOrUndefined)(e))return this.value=this.default,this;if((0,n.isObject)(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return!(0,n.isNullOrUndefined)(this.value)},getValue(){return this.value},setValue(e){let t=(0,n.isObject)(e)?e.value:e;return 200!==this.validate(t)?{success:!1,message:"Validation failed: The value could not be updated."}:(this.value=(0,n.toBoolean)(t),this.notify("value.changed",t),{success:!0,message:"The value has been successfully updated."})},restore(e){const{value:t}=e;this.setValue(t)},update:(e,t)=>!0,getCandidates:()=>[!0,!1],getChildren:e=>[],validate(e){return this.errors=[],(0,n.isString)(e)&&["true","false"].includes(e.toLowerCase())||Number.isInteger(e)&&[1,0].includes(e)||[!0,!1].includes(e)?200:400},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}},Ie=Object.assign(Object.create(Ce),Te);function Me(e,t){switch(e){case 400:return{success:!1,message:"The value is not a number."};case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum allowed: ${t.value}.`};case 402:return{success:!1,message:`Minimum allowed: ${t.value}.`};case 404:return{success:!1,message:`Value allowed: ${t.value}.`}}}const Ue={nature:"primitive",initValue(e){if((0,n.isNullOrUndefined)(e))return this.value=this.default,this;if((0,n.isObject)(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return"number"==typeof this.value&&!isNaN(this.value)},getValue(){return this.hasValue()?+this.value:null},setValue(e){let t=(0,n.isObject)(e)?e.value:e;const{code:i,ctx:s}=this.validate(t);return this.value!==t&&(this.value=(0,n.isNullOrWhitespace)(t)?null:+t,this.notify("value.changed",t),this.propagate("value.changed",t,this)),200!==i?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},restore(e){const{value:t}=e;this.setValue(t)},getCandidates(){return this.values.forEach((e=>{(0,n.isObject)(e)&&(e.type="value")})),this.values},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(this.errors=[],isNaN(e)){let e=400;return this.errors.push(Me.call(this,e).message),{code:e}}if(!this.hasConstraint())return{code:200};if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("range"===i){const{min:s,max:n}=t[i];if(s&&+e<s.value){let e=402;return this.errors.push(Me.call(this,e,s).message),{code:e,ctx:s}}if(n&&+e>n.value){let e=403;return this.errors.push(Me.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=t[i];if(e!==s){let e=404;return this.errors.push(Me.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("values")){let t=this.getConstraint("values").map((e=>De.call(this,e))).flat(),i=!1;for(let s=0;!i&&s<t.length;s++){const r=t[s];i=(0,n.isObject)(r)?r.value===e:r===e}if(!i){let e=401;return this.errors.push(Me.call(this,e,t).message),{code:e,ctx:t}}}return{code:200}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function De(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}const _e=Object.assign(Object.create(Ce),Ue),Be={nature:"primitive",reference:null,path:null,init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.path=this.schema.path,this.values=(0,n.valOrDefault)(this.schema.values,[]),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){return(0,n.isNullOrUndefined)(e)||this.setValue(e.value),this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!(0,n.isNullOrWhitespace)(this.value)},getValue(e=!1){return(0,n.isNullOrUndefined)(this.value)?null:e?this.reference:this.value},removeValue(){return this.reference&&this.reference.unregister(this),this.reference=null,this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getReference(){return(0,n.isNullOrUndefined)(this.reference)?null:this.reference},setValue(e,t=!0){let i=(0,n.isObject)(e)?e.id:e;return 200!==this.validate(i)?{success:!1,message:"Validation failed: The value could not be updated."}:(0,n.isNullOrUndefined)(i)||this.value===i?{success:!0,message:"The value has been ignored."}:(this.reference&&this.reference.unregister(this),this.value=i,this.reference=this.model.getConcept(i),console.log("This.ref"),console.log(this.reference),console.log(this),(0,n.isNullOrUndefined)(this.reference)&&t?setTimeout((()=>this.setValue(e,!1)),20):(this.reference.register(this),this.notify("value.changed",this.reference)),{success:!0,message:"The value has been successfully updated."})},getCandidates(){if((0,n.isNullOrUndefined)(this.accept))throw new Error("Bad reference: 'accept' property is not defined");var e=Pe.call(this,this.accept);return this.path&&He(this,this.path).map((e=>({type:this.accept.type,value:e}))),e},getChildren(e){return(0,n.isNullOrUndefined)(this.reference)||e&&this.reference.name!==e?[]:[this.reference]},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(console.log("Updating"),console.log(e),e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference);break;case"value.changed":console.log("Received message"),this.setValue(this.value)}return!0},validate(e){return this.errors=[],(0,n.isNullOrUndefined)(e)||this.model.hasConcept(e)?200:(this.errors.push("This element is not valid"),401)},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function Pe(e){const{name:t,scope:i,rel:s}=e;return"parent"===s?this.getParent(i).getChildren(t):"children"===s?this.getChildren(t):this.model.isPrototype(t)?this.model.getConceptsByPrototype(t):this.model.getConcepts(t)}function He(e,t){if((0,n.isNullOrUndefined)(t))return e;const{target:i,value:s,rel:r}=t;var a=[];return"parent"===r?a.push(e.getParentWith(i)):"children"===r?a.push(...e.getChildren(i)):"property"===r&&a.push(e.getProperty(i)),a.map((e=>He(e,s))).flat()}const Ve=Object.assign({},Ce,Be),Re={SUCCESS:200,INVALID_VALUE:401,MIN_CARDINALITY_ERROR:402,MAX_CARDINALITY_ERROR:403,FIX_CARDINALITY_ERROR:404};function $e(e,t){switch(e){case Re.INVALID_VALUE:return{success:!1,message:`Valid values: ${t}`};case Re.MAX_CARDINALITY_ERROR:return{success:!1,message:`Maximum cardinality: ${this.value.length}/${t.value}.`};case Re.MIN_CARDINALITY_ERROR:return{success:!1,message:`Minimum cardinality: ${this.value.length}/${t.value}.`};case Re.FIX_CARDINALITY_ERROR:return{success:!1,message:`Fixed cardinality: ${t.value}.`};case Re.PATTERN_ERROR:return{success:!1,message:"The value is not valid."}}}const Fe={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.ordered=(0,n.valOrDefault)(this.schema.ordered,!0),this.constraint=this.schema.constraint,this.watchers=new Map,this.value=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){this.removeAllElement();let t=qe.call(this);if((0,n.isNullOrUndefined)(e)){let e=t;for(let t=0;t<e;t++)this.createElement();return this}const{id:i="",name:s,value:r}=e;i.length>10&&(this.id=i);for(let e=0;e<r.length;e++)this.createElement(r[e]);let a=t-r.length;for(let e=0;e<a;e++)this.createElement();return this},hasValue(){return!(0,n.isEmpty)(this.value)},getValue(e=!1){const t=this.value.map((e=>this.model.getConcept(e)));return e?t.map((e=>e.getValue())):t},removeValue(e){return this.hasValue()?(this.removeElement(e),{success:!0,message:"The value has been successfully updated."}):{success:!0,message:"The value has been successfully updated."}},isValidElement(e){const{name:t,accept:i}=this.accept;return this.model.isPrototype(t)?(0,n.isNullOrUndefined)(i)?this.model.hasPrototype(e.name,t):Array.isArray(i)?i.some((t=>t.name===e.name)):i.name===e.name:this.accept.name===e.name},setValue(e){let t=e.value||e;if(Array.isArray(t)){this.removeAllElement();for(let e=0;e<t.length;e++)this.createElement(t[e])}else this.isValidElement(t)&&this.createElement(t)},restore(e){const{value:t}=e;t.forEach(((e,t)=>{this.value.includes(e.id)||this.createElement(e)}))},getElements(){return this.value.map((e=>this.model.getConcept(e)))},getElement(e){var t=this.value.find((t=>t===e));if(!(0,n.isNullOrUndefined)(t))return this.model.getConcept(t)},getElementAt(e){if(!(e<0||e>=this.value.length))return this.model.getConcept(this.value[e])},getFirstElement(){return this.getElementAt(0)},getLastElement(){return this.getElementAt(this.count-1)},addElement(e){return!(0,n.isNullOrUndefined)(e)&&(this.value.push(e.id),e.index=this.value.length-1,e.parent=this,e.ref=this,this.validate(),this.notify("value.added",e),this.propagate("value.changed",e,this),!0)},addElementAt(e,t=0){return(0,n.isNullOrUndefined)(e)&&(e=this.createElement()),this.value.splice(t,0,e.id),this.validate(),this.notify("value.added",e),this.propagate("value.changed",e,this),this},swapElement(e,t){if(!this.ordered)return this;let i=this.value[e];this.value[e]=this.value[t],this.value[t]=i;let s=this.getElementAt(e);s.index=+e;let n=this.getElementAt(t);return n.index=+t,this.notify("value.swapped",[s,n]),this},removeElement(e){let t=(0,n.valOrDefault)(e.index,this.value.indexOf(e.id));return-1!==t&&this.removeElementAt(t)},removeElementAt(e){let t=this.getElementAt(e);if((0,n.isNullOrUndefined)(t))return{message:`The element at index '${e}' was not found.`,success:!1};t.delete(!0),this.value.splice(e,1);const i=this.getValue();for(let t=e;t<i.length;t++)i[t].index=t;return this.validate(),this.notify("value.removed",t),this.propagate("value.changed",t,this),{message:`The element '${t.name}' was successfully removed.`,success:!0}},removeAllElement(){return this.value.forEach((e=>{this.model.removeConcept(e)})),this.value=[],this.notify("value.changed",this.value),this.propagate("value.changed",this.value,this),this},createElement(e){const t={value:this.model.getValue(e),parent:this,ref:this},i=this.model.createConcept(this.accept,t);return this.addElement(i),i},getProperty(e,t){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e||"cardinality"===e)return this.value.length;let i=this.properties.find((t=>t.name===e));if((0,n.isNullOrUndefined)(i))return;const{type:s,value:r}=i;return"string"===s?r:"number"===s?+r:"boolean"===s?(0,n.toBoolean)(r):r},hasProperty(e){return!!["refname","name","value","length","cardinality"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){return ze.call(this,this.accept)},getChildren(e){if(!this.hasValue())return[];const t=this.getElements();return(0,n.isNullOrUndefined)(e)?t:t.filter((t=>t.name===e))},validate(){if(this.errors=[],!this.hasConstraint())return{code:Re.SUCCESS};if(this.hasConstraint("cardinality")){let e=this.getConstraint("cardinality");const{type:t}=e;if("range"===t){const{min:i,max:s}=e[t];if(i&&this.value.length<i.value){let e=Re.MIN_CARDINALITY_ERROR;return this.errors.push($e.call(this,e,i).message),{code:e,ctx:i}}if(s&&this.value.length>s.value){let e=Re.MAX_CARDINALITY_ERROR;return this.errors.push($e.call(this,e,s).message),{code:e,ctx:s}}}else if("fixed"===t){const{value:i}=e[t];if(this.value.length!==i){let i=Re.FIX_CARDINALITY_ERROR;return this.errors.push($e.call(this,i,e[t]).message),{code:i,ctx:e[t]}}}}return{code:Re.SUCCESS}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue().map((e=>e.copy(!1)))};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue().map((e=>e.clone()))}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.value}},toString(){return this.getValue().map((e=>e.toString()))},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue().map((e=>e.toXML())).join("")+`</${e}>`}};function qe(){if(!this.hasConstraint("cardinality"))return 0;const e=this.getConstraint("cardinality"),{type:t}=e;if("range"===t){const{min:i}=e[t];return i.value}if("fixed"===t){const{value:i}=e[t];return i}return 0}function ze(e){return this.model.getConceptSchema(e)}const We=Object.assign(Object.create(Ce),Fe);Object.defineProperty(We,"count",{get(){return this.value.length}}),Object.defineProperty(We,"canAddValue",{get:()=>!0});const Ke=200,Xe=405;function Ye(e,t){switch(e){case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum length: ${t.value}.`};case 402:return{success:!1,message:`Minimum length: ${t.value}.`};case 404:return{success:!1,message:`Fixed length: ${t.value}.`};case Xe:return{success:!1,message:"The value is not valid."};case 406:return{success:!1,message:"The value is already used."}}}const Je={nature:"primitive",initValue(e){if((0,n.isNullOrUndefined)(e))return this.value=this.default,this;if((0,n.isObject)(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!(0,n.isNullOrWhitespace)(this.value)},getValue(){return this.value},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},setValue(e){let t=(0,n.isObject)(e)?e.value:e;var{code:i,ctx:s}=this.validate(t);return this.value!==t&&(this.value=t,this.notify("value.changed",t),this.propagate("value.changed",t,this)),i!==Ke?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},getProperty(e,t){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e)return this.value.length;let i=this.properties.find((t=>t.name===e));if((0,n.isNullOrUndefined)(i))return;const{type:s,value:r}=i;return"string"===s?r:"number"===s?+r:"boolean"===s?(0,n.toBoolean)(r):r},hasProperty(e){return!!["refname","name","value","length"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){let e=(0,n.valOrDefault)(this.getConstraint("values"),[]);return(0,n.isEmpty)(e)?[...this.src.map((e=>{if("reference"===e.type){const{source:t,target:i}=e;let s=this.model.environment.getModel(t.name||t);if((0,n.isNullOrUndefined)(s))return null;let r=s.concept||s;if(!Array.isArray(r))return null;if(r.forEach((e=>{const t=function(e,t){var i=t;const s=[],r=t=>{let i=e.find((e=>e.name===t));if(!(0,n.isNullOrUndefined)(i))return P(i)};for(;!(0,n.isNullOrUndefined)(i);){const e=(0,n.valOrDefault)(r(i),{});a=e.attributes,Array.isArray(a)&&a.forEach((e=>{const t=s.find((t=>t.name===e.name));(0,n.isNullOrUndefined)(t)?s.push(e):e.required&&(t.required=e.required)})),i=e.prototype}var a;return{attributes:s}}(r,e.prototype);e.attributes.push(...t.attributes)})),(0,n.isNullOrUndefined)(i.rel))return r.map((e=>e[i.value]));let a=Qe.call(this,i,r);return(0,n.isNullOrUndefined)(a)?[]:a}if("concept"===e.type){const{concept:t,value:i}=e;let s=this.model.getConceptsByPrototype(t.prototype);return"attribute"===i.type?s.map((e=>e.getAttribute(i.name).getValue())):[]}return e}))].flat().filter((e=>!(0,n.isNullOrUndefined)(e))):e.map((e=>Ge.call(this,e))).flat().filter((e=>!(0,n.isNullOrWhitespace)(e)))},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(this.errors=[],(0,n.isNullOrWhitespace)(e))return{code:Ke};if(!this.hasConstraint())return{code:Ke};if(this.hasConstraint("length")){let t=this.getConstraint("length");const{type:i}=t;if("range"===i){const{min:s,max:n}=t[i];if(s&&e.length<s.value){let e=402;return this.errors.push(Ye.call(this,e,s).message),{code:e,ctx:s}}if(n&&e.length>n.value){let e=403;return this.errors.push(Ye.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=t[i];if(e.length!==s){let e=404;return this.errors.push(Ye.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("pattern"===i){const{value:i,insensitive:s=!0,global:n=!0}=t.pattern;let r="";if(s&&(r+="g"),n&&(r+="i"),!new RegExp(i,r).test(e)){let e=Xe;return this.errors.push(Ye.call(this,e,t.pattern).message),{code:e,ctx:t.pattern}}}else if(i==="match".startsWith){const{start:s,end:n}=t[i];if(s&&!e.startsWith<s.value){let e=Xe;return this.errors.push(Ye.call(this,e,t.match).message),{code:e,ctx:t.match}}if(n&&e.length>n.value){let e=Xe;return this.errors.push(Ye.call(this,e,t.match).message),{code:e,ctx:t.match}}}else if("unique"===i){const{rel:i="parent",prototype:s}=t.unique;let n=this.getParent(),r=[];if(s?(n.hasPrototype()||(r=[]),r=this.model.getConceptsByPrototype(n._prototype)):r=this.model.getConcepts(n.name),r.some((t=>t!==n&&et(t,this.ref.name)===e))){let e=406;return this.errors.push(Ye.call(this,e,t.unique).message),{code:e,ctx:t.unique}}}}if(this.hasConstraint("values")){let t=this.getConstraint("values").map((e=>Ge.call(this,e))).flat(),i=!1;for(let s=0;!i&&s<t.length;s++){const r=t[s];i=(0,n.isObject)(r)?r.value===e:r===e}if(!i){let e=401;return this.errors.push(Ye.call(this,e,t).message),{code:e,ctx:t}}}return{code:Ke}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function Ge(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}if("meta-reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}function Qe(e,t){const{name:i,rel:s,scope:r,value:a}=e;let o=null;if("parent"===s){let e=this.getParent(i);if((0,n.isNullOrUndefined)(a))return e;if("reference"===a.type)return Qe.call(e,a);if("attribute"===a.type)return e.getAttributeByName(a.name).getValue()}if("children"===s){let e=this.getChildren(i);if((0,n.isNullOrUndefined)(a))return e;if("reference"===a.type)return e.map((e=>Qe.call(e,a)));if("attribute"===a.type)return e.filter((e=>it(e,a.name)&&tt(e,a.name))).map((e=>et(e,a.name)))}if(e.source){const{type:t,value:i}=e.source;o="reference"===t?Qe.call(this,e.source):i}if((0,n.isNullOrUndefined)(o))return t.map((e=>e[i].map((e=>e[a]))));if((0,n.isIterable)(o)&&(0,n.isEmpty)(o))return[];let l=t.find((e=>Array.isArray(o)?o.includes(e.name):e.name===o));return(0,n.isNullOrUndefined)(l)||!(0,n.hasOwn)(l,i)?[]:l[i].map((e=>e[a]))}const Ze=(e,t)=>e.getAttributeByName(t).target,et=(e,t)=>Ze(e,t).getValue(),tt=(e,t)=>Ze(e,t).hasValue(),it=(e,t)=>e.isAttributeCreated(t),st=Object.assign(Object.create(Ce),Je),nt={nature:"concrete",initValue(e){if((0,n.isNullOrUndefined)(e))return!1;const{id:t="",attributes:i=[]}=e;return t.length>10&&(this.id=t),i.forEach((e=>{const{name:t,id:i,value:s}=e;this.createAttribute(t,s)})),!0},restore(e){const{attributes:t}=e;t.forEach((e=>{const{name:t,id:i,value:s}=e;this.isAttributeCreated(t)||this.createAttribute(t,s)}))},hasValue:()=>!0,getValue(){return{name:this.name,attributes:this.getAttributes().map((e=>({name:e.name,value:e.copy(!1)})))}},setValue(e){const{attributes:t=[]}=e;return t.forEach((e=>{const{name:t,id:i,value:s}=e;this.hasAttribute(t)&&this.createAttribute(t,s)})),!0}},rt=Object.assign(Object.create(Ce),nt),at=200;function ot(e){if(401===e)return{success:!1,message:"The value is not included in the list of valid values."}}const lt={name:"prototype",nature:"prototype",initValue(e){if((0,n.isNullOrUndefined)(e)){if(this.default){let e=this.createConcept(this.default);this.setValue(e)}return this}const{id:t="",value:i}=e;t.length>10&&(this.id=t);let s=null;return i?(s=this.createConcept(i.name,i),this.setValue(s)):e.name&&e.attributes&&(s=this.createConcept(e.name,e),this.setValue(s)),this},getValue(e=!1){return(0,n.isNullOrUndefined)(this.value)?null:e?this.target:this.value},getTarget(){return this.target},restore(e){const{value:t}=e;if((0,n.isNullOrUndefined)(t))return;let i=this.createConcept(t.name,t);this.setValue(i)},setValue(e){let t=e.name||e;if(this.validate(t)!==at)return{success:!1,message:"Validation failed: The value could not be updated."};let i=e;if(e&&"concept"===e.object&&(0,n.hasOwn)(e,"id")||(i=e.attributes?this.createConcept(t,e):this.createConcept(t)),this.target){let e=this.target.copy(!1);this.target.delete(!0),i.setValue(e)}return this.target=i,this.value=t,this.notify("value.changed",this.getCandidates().find((e=>e.name===this.value))),this.propagate("value.changed",t,this),{success:!0,message:"The value has been successfully updated."}},removeValue(){return(0,n.isNullOrUndefined)(this.value)||(this.value=null,this.notify("value.changed",this.value)),{success:!0,message:"The value has been successfully updated."}},hasValue(){return!(0,n.isNullOrUndefined)(this.value)},getCandidates(){return this.candidates||(this.candidates=ct.call(this,this.schema.accept).map((e=>({type:"meta-concept",name:e.name,concept:Object.create(ht,{object:{value:"meta-concept"},type:{value:"meta-concept"},name:{value:e.name},model:{value:this.model},schema:{value:e}})})))),this.candidates},getChildren(e){if(!this.hasValue())return[];const t=[];return((0,n.isNullOrUndefined)(e)||this.target.name===e)&&t.push(this.target),t},createConcept(e,t){let i=this.model.getValue(t);const s={parent:this,ref:this};i&&(s.value=i);const n=this.model.createConcept(e,s);return n.prototype=this,n},validate(e){if((0,n.isNullOrWhitespace)(e))return at;if((0,n.isEmpty)(this.values))return at;var t=!1;for(let i=0;!t&&i<this.values.length;i++){const s=this.values[i];t=(0,n.isObject)(s)?s.value===e:s===e}if(!t){let e=401;return this.errors.push(ot.call(this,e).message),e}return at},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.target.copy(!1)};return e&&this.model.addValue(t),t},clone(){let e=null;return this.hasValue()&&(e=this.target.clone()),{id:this.id,name:this.name,value:e}},export(){let e=null;return this.hasValue()&&(e={id:this.target.id,name:this.target.name}),{id:this.id,name:this.name,root:this.isRoot(),value:e}},toXML(){if(!this.hasValue())return"";let e=this.getName();return`<${e} id="${this.id}">`+this.target.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function ct(e){const t=this.model.getConcreteConcepts(this.name);return(0,n.isNullOrUndefined)(e)?t:Array.isArray(e)?t.filter((t=>e.some((e=>e.name===t.name)))):t.filter((t=>e===t.name))}const ht={getProperty(e,t){if("refname"===e)return this.name;if("name"===e)return this.name;let i=this.properties.find((t=>t.name===e));if((0,n.isNullOrUndefined)(i))return;const{type:s,value:r}=i;return"string"===s?r:"number"===s?+r:"boolean"===s?(0,n.toBoolean)(r):r},hasPrototype(e){if((0,n.isNullOrUndefined)(this.schema.prototype))return!1;let t=this.model.getConceptSchema(this.schema.prototype);for(;!(0,n.isNullOrUndefined)(t);){if(t.name===e)return!0;t=this.model.getConceptSchema(t.prototype)}return!1}},ut=Object.assign({},Ce,lt);function dt(e){if(401===e)return{success:!1,message:"The value is not included in the list of valid values."}}const pt={name:"meta",reference:null,initValue(e){return(0,n.isNullOrUndefined)(e)||this.setValue(e.value),this},hasValue(){return!(0,n.isNullOrWhitespace)(this.value)},getValue(){return(0,n.isNullOrUndefined)(this.value)?null:this.value},getProperty(e){const t=this.schema[e];if((0,n.isObject)(t)){const e=[];for(const i in t){const s=t[i];e.push(Object.assign({},{name:i},s))}return e}return t},setValue(e){var t=this.validate(e);return 200!==t?{success:!1,message:"Validation failed: The value could not be updated.",errors:[dt(t).message]}:(0,n.isNullOrUndefined)(e)||this.value===e?void 0:(this.reference&&this.reference.unregister(this),this.reference=this.model.getConcept(e),this.reference.register(this),this.value=e,this.notify("value.changed",this.reference),{success:!0,message:"The value has been successfully updated."})},getChildren:e=>[],delete(e=!1){if(!e){let e=this.getParent().remove(this);if(!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){return"delete"===e&&(this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)),!0},validate(e){return(0,n.isNullOrWhitespace)(e)||(0,n.isEmpty)(this.values),200},export(){return{id:this.id,name:this.name,value:this.value}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}},mt=Object.assign({},Ce,pt);function ft(e,t){return{object:{value:"concept"},type:{value:"concept"},model:{value:e},name:{value:t.name},base:{value:t.base},schema:{value:t,writable:!0}}}const gt={boolean:(e,t)=>Object.create(Ie,ft(e,t)),number:(e,t)=>Object.create(_e,ft(e,t)),reference:(e,t)=>Object.create(Ve,ft(e,t)),set:(e,t)=>Object.create(We,ft(e,t)),string:(e,t)=>Object.create(st,ft(e,t)),meta:(e,t)=>Object.create(mt,ft(e,t))},bt={primitive:(e,t)=>gt[t.name](e,t),prototype:(e,t)=>Object.create(ut,ft(e,t)),concrete:(e,t)=>Object.create(rt,ft(e,t)),derivative:(e,t)=>gt[t.base](e,t)},vt={createConcept(e,t,i){const{name:s,nature:r}=t,a=bt[r];if((0,n.isNullOrUndefined)(a))throw new Error(`Missing handler: The '${s}' concept could not be handled`);const o=a(e,t);if((0,n.isNullOrUndefined)(o))throw new Error(`Bad request: The '${s}' concept could not be created`);return o.init(i),(0,n.isNullOrUndefined)(o.id)&&(o.id=H.generate()),o}};var yt=0;const wt={concepts:null,values:null,listeners:null,get hasError(){return this.concepts.some((e=>e.hasError))},init(e){return this.concepts=[],this.values=[],this.listeners=[],Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})})),this.values=e.filter((e=>e.id.startsWith("value")))),this},initValue(e){return console.log(e),Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})})),this.values=e.filter((e=>e.id.startsWith("value")))),this},done(){return this.concepts.forEach((e=>{e.done()})),this.concepts=[],!0},createConcept(e,t){const i=this.getCompleteModelConcept(e);if((0,n.isNullOrUndefined)(i))throw new Error(`Concept not found: ${e}`);var s=vt.createConcept(this,i,t);return this.addConcept(s),s},getConcepts(e){if((0,n.isIterable)(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.concepts.filter((e=>t(e)))}return this.concepts.slice()},getRootConcepts(){return this.concepts.filter((e=>e.isRoot()))},getConceptsByPrototype(e){return this.concepts.filter((t=>t.hasPrototype(e)))},getConcept(e){if(!(0,n.isString)(e)||(0,n.isEmpty)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");return this.concepts.find((t=>t.id===e))},addConcept(e){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad request: The 'concept' argument must be a Concept");return this.concepts.push(e),e.register(this.environment),this},removeConcept(e){if(!(0,n.isObject)(e)&&!(0,n.isString)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.concepts.findIndex((t=>t.id===e));return-1===t?null:this.concepts.splice(t,1)[0]},hasConcept(e){if(!(0,n.isObject)(e)&&!(0,n.isString)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");if((0,n.isEmpty)(this.concepts))return!1;let t=e.id||e;return e.name,this.concepts.some((e=>e.id===t))},getValues(e){if((0,n.isIterable)(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.values.filter((e=>t(e)))}return this.values.slice()},getValue(e){return(0,n.isNullOrUndefined)(e)?null:(0,n.hasOwn)(e,"value")||(0,n.hasOwn)(e,"attributes")?e:(0,n.hasOwn)(e,"id")?this.values.find((t=>t.id===e.id)):this.values.find((t=>t.id===e))},addValue(e){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad request: The 'value' argument must be a Value");return this.values.some((t=>{return s=e,(i=t).name===s.name&&(i.value?i.value===s.value:JSON.stringify(i.attributes)===JSON.stringify(s.attributes));var i,s}))||(e.id="value"+yt++,this.values.push(e),this.notify("value.added",e)),this},removeValue(e){if(!(0,n.isObject)(e)&&!(0,n.isString)(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.values.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.values.splice(t,1)[0];return this.notify("value.removed",i),i},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){let t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t)}))},isConcept(e){return!!(0,n.isString)(e)&&-1!==this.schema.findIndex((t=>t.name===e))},isConcrete(e){if(!(0,n.isString)(e))return!1;const t=this.schema.find((t=>t.name===e));return!(0,n.isNullOrUndefined)(t)&&"concrete"===t.nature},isPrototype(e){if(!(0,n.isString)(e))return!1;const t=this.schema.find((t=>t.name===e));return!(0,n.isNullOrUndefined)(t)&&"prototype"===t.nature},hasPrototype(e,t){if(!this.isConcept(e))return!1;let i=this.getConceptSchema(e);for(;!(0,n.isNullOrUndefined)(i);){if(i.prototype===t)return!0;i=this.model.getConceptSchema(i.prototype)}return!1},addConceptSchema(e){let t=e.concept||e;return this.schema.push(...t),this.environment.update("concept-model.updated"),!0},getSchema(e){if((0,n.isIterable)(e)){const t=Array.isArray(e)?t=>e.includes(t.nature):t=>t.nature===e;return this.schema.filter((e=>t(e)))}return this.schema.slice()},getConceptSchema(e){const t=At(this.schema,e);if(!(0,n.isNullOrUndefined)(t))return P(t)},getCompleteModelConcept(e){let t=e;(0,n.isString)(e)&&(t={name:e});const i=this.getConceptSchema(t.name);if((0,n.isNullOrUndefined)(i))return;Object.assign(i,t),(0,n.hasOwn)(i,"attributes")||(i.attributes=[]);const s=xt.call(this,i.prototype);return i.attributes.push(...s.attributes),i},getConcreteConcepts(e){const t=t=>{for(var i=t.prototype;!(0,n.isNullOrUndefined)(i);){if(i===e)return!0;i=(0,n.valOrDefault)(At(this.schema,i),{}).prototype}return!1},i=this.schema.filter((e=>"concrete"===e.nature));return e?i.filter((e=>t(e))):i},getDerivedConcepts(e){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad argument");return this.schema.filter((t=>t.base===e))},export(){const e=[];return this.getConcepts().forEach((t=>{e.push(t.export())})),e.push(...this.getValues()),e},toString(){return JSON.stringify({[this.root.name]:this.root.toString()})},toXML(){return"<model:gentleman>"+this.getRootConcepts().map((e=>e.toXML())).join("")+"</model:gentleman>"},toXMI(){return'\n            <?xml version="1.0" encoding="ISO-8859-1"?>\n            <xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gent="geodes.sms.gentleman">\n                <gent:Model name="MindMap">\n        '+this.getRootConcepts().map((e=>e.toXMI())).join("")+"\n                </gent:Model>\n            </xmi:XMI>\n        "}};function xt(e){var t=e;const i=[];for(;!(0,n.isNullOrUndefined)(t);){const e=(0,n.valOrDefault)(this.getConceptSchema(t),{});s=e.attributes,Array.isArray(s)&&s.forEach((e=>{const t=i.find((t=>t.name===e.name));(0,n.isNullOrUndefined)(t)?i.push(e):e.required&&(t.required=e.required)})),t=e.prototype}var s;return{attributes:i}}const Et=[{name:"string",nature:"primitive"},{name:"number",nature:"primitive"},{name:"boolean",nature:"primitive"},{name:"reference",nature:"primitive"},{name:"set",nature:"primitive"}];function At(e,t){let i=e.find((e=>e.name===t));return(0,n.isNullOrUndefined)(i)&&(i=Et.find((e=>e.name===t))),i}const Ot=[],Nt={createModel(e,t){var i=Object.create(wt,{schema:{value:(0,n.valOrDefault)(e,[])},environment:{value:t}});return Ot.push(i),i}};function kt(e){const{type:t}=e;let i=this.concept||this.source;return"property"===t?(0,n.valOrDefault)(i.getProperty(e.name),""):"param"===t?this.getParam(e.name):e}const jt={css:function(e,t){return(0,n.isIterable)(t)?(It(e,t),e):e},ref:function(e,t){return(0,n.isIterable)(t)?(t.forEach((t=>{const{style:i={}}=(0,n.valOrDefault)(this.model.getStyleSchema(t),{});i.gss?St.call(this,e,i):Ct.call(this,e,i)})),e):e},gss:Ct,text:Tt,box:_t,html:function(e,t){return(0,n.isIterable)(t)?(t.forEach((t=>{let i=`style${(0,n.capitalizeFirstLetter)(t.name)}`;e.dataset[i]=kt.call(this,t.value),"property"===t.value.type&&this.registerHandler("value.changed",(s=>{e.dataset[i]=kt.call(this,t.value)}))})),e):e}},Lt={text:Tt,box:_t};function St(e,t){if(!(0,n.isObject)(t))return e;for(const i in t){const s=t[i];let r=jt[i];(0,n.isFunction)(r)&&r.call(this,e,s)}return e}function Ct(e,t){if(!(0,n.isObject)(t))return e;for(const i in t){const s=t[i];let r=Lt[i];(0,n.isFunction)(r)&&r.call(this,e,s)}return e}function Tt(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"bold":e.style.fontWeight=Ut(s);break;case"italic":e.style.fontStyle="italic";break;case"underline":e.style.textDecoration="underline";break;case"strikethrough":e.style.textDecoration="line-through";break;case"color":e.style.color=Mt(s);break;case"font":e.style.fontFamily=s.toString();break;case"size":e.style.fontSize=Dt(s);break;case"transform":e.style.textTransform=s}}return e}function It(e,t){if(Array.isArray(t))e.classList.add(...t);else{let i=t.replace(/\s+/g," ").trim();(0,n.isNullOrWhitespace)(e.className)?e.className=i:It(e,i.split(" "))}return e}function Mt(e){if((0,n.isNullOrUndefined)(e))return"";const{type:t,value:i}=e;switch(t){case"rgb":return(0,n.isObject)(i)?`rgb(${i.red}, ${i.green}, ${i.blue})`:i;case"rgba":return(0,n.isObject)(i)?`rgba(${i.red}, ${i.green}, ${i.blue}, ${i.opacity/100})`:i;case"name":case"hexadecimal":return i;default:return i||e}}function Ut(e){if((0,n.isNullOrUndefined)(e))return"";const{type:t,value:i}=e;return Number.isInteger(e)?`${e}`:"bold"}function Dt(e){if((0,n.isNullOrUndefined)(e))return"";const{value:t,unit:i}=e;return(0,n.isNullOrUndefined)(t)?"":`${t}${i}`}function _t(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"inner":Bt.call(this,e,s,"padding");break;case"outer":Bt.call(this,e,s,"margin");break;case"border":Vt.call(this,e,s);break;case"corner":Rt.call(this,e,s);break;case"background":Pt.call(this,e,s);break;case"width":e.style.width=Dt.call(this,s);break;case"height":e.style.height=Dt.call(this,s);break;case"opacity":e.style.opacity=s/100;break;case"shadow":Ht.call(this,e,s,"shadow")}}return e}function Bt(e,t,i){if(!(0,n.isNullOrUndefined)(t))for(const s in t){const n=t[s];switch(s){case"all":e.style[`${[i]}`]=Dt.call(this,n);break;case"top":e.style[`${[i]}Top`]=Dt.call(this,n);break;case"right":e.style[`${[i]}Right`]=Dt.call(this,n);break;case"bottom":e.style[`${[i]}Bottom`]=Dt.call(this,n);break;case"left":e.style[`${[i]}Left`]=Dt.call(this,n)}}}function Pt(e,t){if((0,n.isNullOrUndefined)(t))return;const{color:i,image:s}=t;i&&(e.style.backgroundColor=Mt.call(this,i)),s&&(e.style.backgroundImage=`url(${s})`)}function Ht(e,t){if((0,n.isNullOrUndefined)(t))return null;const{offsetX:i,offsetY:s,blur:r,spread:a,inset:o=!1,color:l}=t;if((0,n.isNullOrUndefined)(i)||(0,n.isNullOrUndefined)(s))return null;let c=Dt.call(this,i),h=Dt.call(this,s),u=Dt.call(this,r),d=Dt.call(this,a),p=Mt.call(this,l);e.style.boxShadow=o?`inset ${c} ${h} ${u} ${d} ${p}`.trim():`${c} ${h} ${u} ${d} ${p}`.trim()}function Vt(e,t){if(!(0,n.isNullOrUndefined)(t))for(const i in t){const s=t[i];switch(i){case"all":e.style.borderStyle=(0,n.valOrDefault)(s.type,"solid"),e.style.borderWidth=Dt.call(this,s.width),e.style.borderColor=Mt.call(this,s.color);break;case"top":e.style.borderTopStyle=(0,n.valOrDefault)(s.type,"solid"),e.style.borderTopWidth=Dt.call(this,s.width),e.style.borderTopColor=Mt.call(this,s.color);break;case"right":e.style.borderRightStyle=(0,n.valOrDefault)(s.type,"solid"),e.style.borderRightWidth=Dt.call(this,s.width),e.style.borderRightColor=Mt.call(this,s.color);break;case"bottom":e.style.borderBottomStyle=(0,n.valOrDefault)(s.type,"solid"),e.style.borderBottomWidth=Dt.call(this,s.width),e.style.borderBottomColor=Mt.call(this,s.color);break;case"left":e.style.borderLeftStyle=(0,n.valOrDefault)(s.type,"solid"),e.style.borderLeftWidth=Dt.call(this,s.width),e.style.borderLeftColor=Mt.call(this,s.color)}}}function Rt(e,t){if((0,n.isNullOrUndefined)(t))return null;for(const i in t){const s=t[i];switch(i){case"all":e.style.borderRadius=Dt.call(this,s);break;case"top-left":e.style.borderTopLeftRadius=Dt.call(this,s);break;case"top-right":e.style.borderTopRightRadius=Dt.call(this,s);break;case"bottom-right":e.style.borderBottomRightRadius=Dt.call(this,s);break;case"bottom-left":e.style.borderBottomLeftRadius=Dt.call(this,s)}}}const $t={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,children:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasError(){return this.source.hasError},get hasAttached(){return!(0,n.isEmpty)(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return(0,n.isFunction)(e)?this.attached.filter((t=>e(t))):this.attached},show(){return u(this.element),this.visible=!0,this.active=!0,this},hide(){return d(this.element),this.visible=!1,this},toggle(){return p(this.container),this.visible=!this.visible,this},focus(e){return this.element.contentEditable=!1,this.element.focus(),this.focused=!0,this},getContainer(){return this.element},notify(e,t,i){m(this.element),this.environment.notify(e,t)},append(e){if(!(0,n.isHTMLElement)(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.append(e),this},_focusIn:e=>!1,enable(){return this.disabled=!1,this},disable(){return this.disabled=!0,this},clear:()=>!0,delete(){var e=this.source.delete();e.success?(this.clear(),(0,n.removeChildren)(this.element),this.element.remove()):(this.environment.notify(e.message),m(this.element))},spaceHandler(e){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){return console.warn(`ESCAPE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},enterHandler(e){this.focusOut()},deleteHandler(e){if(this.projection.element!==this)return m(e),!1;if(!this.projection.optional)return m(this.element),!1;let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex)),i=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),i),this.source.delete();let s=this.environment.resolveElement(t);return(0,n.isNullOrUndefined)(s)||s.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){return console.warn(`ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()},shiftHandler(e,t){return console.warn(`SHIFT_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1}},Ft=Object.assign($t);function qt(e){if(!(0,n.isHTMLElement)(e))return!1;const{nature:t,id:i}=e.dataset;return"field-component"===t&&i===this.id}const zt={init(){return this.elements=new Map,this},render(){const e=(0,n.createDocFragment)(),{content:t="Add",items:i}=this.schema;(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:["field","add-button"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),St.call(this.projection,this.element,this.schema.style));let s=(0,n.createButton)({class:["field-action","field--list__add"],tabindex:0,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});return(0,n.isNullOrUndefined)(i)||(this.item=i),s.append(t),e.appendChild(s),e.hasChildNodes()&&this.element.append(e),this.bindEvent(),this.element},focusIn(){},clickHandler(e){const t=(e=>qt.call(this,e)?e:(0,n.findAncestor)(e,(e=>qt.call(this,e)),5))(e);if((0,n.isNullOrUndefined)(t))return;const{action:i,index:s,name:r}=t.dataset;"add"===i?(this.parent.prio=this.element,this.createElement()):"remove"===i&&this.delete(t.parentElement),this.parent.prio=this.element},createElement(){this.source.createElement()},addItem(e){return this.parent.addItem(e,this),this},removeItem(e){this.parent.removeItem(e)},refresh(){this.element&&this.source.getValue().forEach((e=>{this.addItem(e)}))},focusOut(){},bindEvent(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)}))}},Wt=Object.assign(Object.create(Ft),zt);function Kt(e,t){if(!Array.isArray(t))return!1;e.currentState=null;for(let i=0;i<t.length;i++){const s=t[i],{rule:r,result:a}=s;if((0,n.isNullOrUndefined)(r))return a;let o=!1,l=Xt[r.type];if((0,n.isFunction)(l)&&(o=l.call(this,r[r.type])),o)return e.currentState=i,a}return null}const Xt={ref:function(e){const{rule:t={}}=(0,n.valOrDefault)(this.model.getRuleSchema(e),{});let i=Xt[t.type];return!!(0,n.isFunction)(i)&&i.call(this,t[t.type])},eq:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Yt.call(this,e[0])==Yt.call(this,e[1])},ne:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Yt.call(this,e[0])!=Yt.call(this,e[1])},lt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Yt.call(this,e[0])<Yt.call(this,e[1])},le:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Yt.call(this,e[0])<=Yt.call(this,e[1])},gt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Yt.call(this,e[0])>Yt.call(this,e[1])},ge:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return Yt.call(this,e[0])>=Yt.call(this,e[1])},and:function(e){return Jt.call(this,e[0])&&Jt.call(this,e[1])},or:function(e){return Jt.call(this,e[0])||Jt.call(this,e[1])},not:function(e){return!Jt.call(this,e[0])},no:function(e){let t=Yt.call(this,e);return(0,n.isIterable)(t)?(0,n.isEmpty)(t):(0,n.isNullOrUndefined)(t)}};function Yt(e,t){if(e&&"property"===e.type){const{name:t}=e;let i=`get${(0,n.pascalCase)(t)}`;return this[i]?this[i]():this[t]}if(e&&"param"===e.type){const{name:t}=e;return this.projection.getParam(t)}if((0,n.isObject)(e)){let t=`get${(0,n.pascalCase)(e.prop)}`;return this[t]?this[t]():this[e.prop]}return t||e}function Jt(e){let t=Xt[e.type];return(0,n.isFunction)(t)?t.call(this,e[e.type]):(0,n.toBoolean)(Yt.call(this,e))}function Gt(e){const{type:t}=e;return"property"===t?(this.hasProperty=!0,(0,n.valOrDefault)(this.source.getProperty(e.name),"")):"param"===t?this.projection.getParam(e.name):"html"===t?(0,n.htmlToElement)(e.html):"raw"===t?(0,n.htmlToElement)(e.raw):e}const Qt={input:null,label:null,value:"",state:null,init(){const{focusable:e=!0}=this.schema;return this.focusable=e,this.children=[],this},refresh(){if((0,n.valOrDefault)(Kt.call(this,this.schema,this.schema.state),this.schema),this.schema.state){let e=this.schema.state[this.getValue().toString()];if(e&&e.content){const{style:t,content:i,value:s}=e;let r=(0,n.createDocFragment)();i.forEach((e=>{r.append(kr.call(this,e))})),(0,n.removeChildren)(this.label).append(r),St.call(this.projection,this.label,t)}}this.input.checked?this.element.dataset.state="on":this.element.dataset.state="off",this.hasError?(this.element.classList.add("error"),this.input.classList.add("error")):(this.element.classList.remove("error"),this.input.classList.remove("error"))},render(){const e=(0,n.createDocFragment)(),{checkbox:t}=this.schema;var i;if((0,n.isHTMLElement)(this.element)||(this.element=(i=this.id,(0,n.createDiv)({id:i,class:["field","field--binary"],tabindex:-1,dataset:{nature:"field",view:"binary",id:i}})),this.readonly&&this.element.classList.add("readonly"),St.call(this.projection,this.element,this.schema.style)),!(0,n.isHTMLElement)(this.input)){if(this.input=function(e){return(0,n.createInput)({id:`checkbox${e}`,type:"checkbox",class:["field--binary__input"],tabindex:0,dataset:{nature:"field-component",view:"binary",id:e}})}(this.id),this.input.checked=this.source.getValue(),this.value=this.input.checked,this.readonly&&(this.input.classList.add("readonly"),this.input.disabled=!0),t){const{style:e}=t;St.call(this.projection,this.input,e)}else d(this.input);e.append(this.input)}if(!(0,n.isHTMLElement)(this.label)){if(this.label=(0,n.createLabel)({class:["field--checkbox__label"],for:this.input.id,tabindex:0,dataset:{nature:"field-component",view:"binary",id:this.id}}),this.label.htmlFor=this.input.id,t&&t.label){const{content:e}=t.label;if(Array.isArray(e))e.forEach((e=>{let t=Gt.call(this,e),i=(0,n.createSpan)({class:["field--checkbox__label-content"],dataset:{ignore:"all"}},t);St.call(this.projection,i,e.style),this.label.append(i)}));else{let t=Gt.call(this,e);this.label.append(t)}St.call(this.projection,this.label,t.label.style)}e.append(this.label)}return e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.value=this.input.checked,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.hasChanges()&&this.setValue(this.input.checked),this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.choice&&d(this.choice),this.input.blur(),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!==this.input.checked},hasValue(){return this.input.checked},getValue(){return this.input.checked},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||this.environment.notify(i.message,"error"),this.input.checked=e,this.value=e,this.refresh()},getCandidates(){return this.source.getCandidates()},enable(){this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1},disable(){this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0},escapeHandler(e){let t=!0;if(this.messageElement&&!A(this.messageElement)&&(d(this.messageElement),t=!1),t){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}},backspaceHandler(e){return this.arrowHandler("left",e)},enterHandler(e){this.setValue(!this.input.checked,!0)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,this.element)},bindEvents(){this.element.addEventListener("change",(e=>{this.setValue(this.getValue(),!0)})),this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},Zt=Object.assign(Object.create(Ft),Qt);function ei(e){const t=e=>e.parentElement===this.choices;return t(e)?e:(0,n.findAncestor)(e,t,5)}function ti(e){const{type:t}=e.dataset;return t}function ii(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)).id:"meta-concept"===t?this.values.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const si=(e,t)=>"concept"===e.type?si(e.id,t):"concept"===t.type?si(e,t.id):"meta-concept"===e.type?si(e.name,t):"meta-concept"===t.type?si(e,t.name):e===t,ni={value:null,placeholder:null,expanded:null,values:null,choices:null,input:null,items:null,selection:null,selectList:null,selectListValue:null,icoToggle:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0,placeholder:i=!1,expanded:s=!0}=this.schema;return this.items=new Map,this.focusable=t,this.expanded=s,this.placeholder=i,this.children=[],(0,n.hasOwn)(this.schema,"choice")||(this.schema.choice={}),(0,n.hasOwn)(this.schema.choice,"option")||(this.schema.choice.option={}),this},hasChanges(){return this.value!=this.source.getValue()},reset(){this.source.removeValue()},hasValue(){return!(0,n.isNullOrUndefined)(this.value)},getValue(){return this.selection},setValue(e,t=!1){var i=null;if(t)return(i=this.source.setValue(e)).success||this.environment.notify(i.message,y.ERROR),!0;(0,n.isNullOrUndefined)(e)?(this.selection&&this.selection.classList.remove("selected"),this.expanded||(0,n.removeChildren)(this.selectListValue),this.selection=null):this.setChoice(e),(0,n.isNullOrUndefined)(e)?this.value=null:"concept"===e.type?this.value=e.id:"meta-concept"===e.type?this.value=e.name:this.value=e;const{template:s={}}=this.schema.choice.option;if(this.selection&&!this.expanded&&e)if((0,n.removeChildren)(this.selectListValue),"meta-concept"===e.type){let t=this.model.getProjectionSchema(e.concept,(0,n.valOrDefault)(s.tag))[0],i=t.type,r={type:i,[i]:t.content||t.projection},a=kr.call(this,r,e.concept,{focusable:!1,meta:e.name});this.selectListValue.append(a)}else if("concept"===e.type){let t=this.model.createProjection(e,s.tag).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,this.selectListValue.append(t.render())}else this.selectListValue.append(e.toString());this.refresh()},refresh(){return this.hasValue()?(this.element.classList.remove("empty"),this.element.dataset.value=this.value.name||this.value):(this.element.classList.add("empty"),this.element.dataset.value="",!this.expanded&&this.placeholder&&(0,n.removeChildren)(this.selectListValue).append(this.placeholder)),this.input&&(this.element.dataset.input=this.input.value),this.element.classList.remove("querying"),this.hasError?(this.element.classList.add("error"),this.input&&this.input.classList.add("error")):(this.element.classList.remove("error"),this.input&&this.input.classList.remove("error")),this},render(){const e=(0,n.createDocFragment)(),{choice:t,input:i,style:s}=this.schema;if((0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:["field","field--choice"],tabindex:-1,dataset:{nature:"field",view:"choice",input:"",id:this.id}})),!(0,n.isHTMLElement)(this.input)&&i){const{placeholder:t="",type:s,style:r}=i;let a=Er.call(this,t);this.input=(0,n.createInput)({class:["field--choice__input"],type:(0,n.valOrDefault)(s,"text"),placeholder:a,title:a,dataset:{nature:"field-component",view:this.type,id:this.id}}),St.call(this,this.input,r),e.append(this.input)}if(!(0,n.isHTMLElement)(this.choices)){const{style:i}=t;this.choices=(0,n.createUnorderedList)({class:["bare-list","field--choice__choices"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),St.call(this,this.choices,i),e.append(this.choices)}if(!this.expanded){let t=(0,n.createDiv)({class:["field--choice__select-wrapper"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}});this.selectListValue=(0,n.createDiv)({class:["field--choice__select-value"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),this.icoToggle=(0,n.createI)({class:["field--choice__select-icon"],dataset:{nature:"field-component",view:"choice",id:this.id}}),t.append(this.selectListValue,this.icoToggle),this.selectList=(0,n.createDiv)({class:["field--choice__select-list","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.input&&this.selectList.append(this.input),this.selectList.append(this.choices),e.append(t),e.append(this.selectList)}if(St.call(this,this.element,s),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),(0,n.removeChildren)(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let t=(0,n.createListItem)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(t),St.call(this,t,e)}return this.values=this.source.getCandidates(),this.values.forEach((e=>{this.choices.append(this.createChoiceOption(e))})),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},focus(e){if(this.expanded)if(this.choices.hasChildNodes()){let e=function(e){for(let t=0;t<e.children.length;t++){const i=e.children[t];if(!A(i))return i}return null}(this.choices);e&&e.focus()}else this.input&&!A(this.input)?this.input.focus():this.selection&&this.selection.focus();else this.input&&!A(this.input)?this.input.focus():this.selectListValue.focus();return this.element.classList.add("active"),this},navigate(e,t,i){let s=null;if("up"===e?s=D(this.element):"down"===e?s=I(this.element):"left"===e?s=U(this.element):"right"===e&&(s=M(this.element)),(0,n.isNullOrUndefined)(s))return!1;s.focus()},focusIn(){this.focused=!0,this.element.classList.add("active");const e=(0,n.createDocFragment)();return this.source.getCandidates().filter((e=>!this.values.some((t=>si(t,e))))).forEach((t=>{e.append(this.createChoiceOption(t)),this.values.push(t)})),this.choices.append(e),this.expanded||(u(this.selectList),this.selectList.dataset.state="open"),this},focusOut(){if(this.readonly)return;this.input&&(0,n.isNullOrWhitespace)(this.input.value)&&(this.input.value=""),this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.input&&this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("querying");const{children:e}=this.choices;for(let t=0;t<e.length;t++){const i=e[t];u(i),i.hidden=!1}return this.expanded||(d(this.selectList),this.selectList.dataset.state="close"),this.focused=!1,this},showChoices(){const{children:e}=this.choices;for(let t=0;t<e.length;t++){const i=e[t];u(i),i.hidden=!1}},enable(){return this.input&&(this.input.disabled=!1,this.input.tabIndex=0),this.disabled=!1,this},disable(){return this.input&&(this.input.disabled=!0,this.input.tabIndex=-1),this.disabled=!0,this},filterChoice(e){const{children:t}=this.choices;if(this.element.dataset.input=e.trim(),(0,n.isNullOrWhitespace)(e)){for(let e=0;e<t.length;e++){const i=t[e];u(i),i.hidden=!1}return}this.element.classList.add("querying");let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e];let n=s.textContent.toLowerCase(),r=n.replace(/[_-]+/g," ").replace(/\s+/g,"").trim();i.some((e=>n.includes(e)||r.includes(e)))?(u(s),s.hidden=!1):(d(s),s.hidden=!0)}return!0},createChoiceOption(e){const{template:t={},style:i}=this.schema.choice.option,s=(0,n.isObject)(e),r=(0,n.createListItem)({class:["field--choice__choice"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:s?"concept":"value",value:s?e.id:e}});if(St.call(this,r,i),this.items.set(e.id,r),"meta-concept"===e.type){let i=this.model.getProjectionSchema(e.concept,(0,n.valOrDefault)(t.tag))[0],s=i.type,a={type:s,[s]:i.content||i.projection},o=kr.call(this,a,e.concept,{focusable:!1,meta:e.name});r.dataset.type="meta-concept",r.dataset.value=e.name,r.append(o)}else if(s){if(!this.model.hasProjectionSchema(e,t.tag))return r;let i=this.model.createProjection(e,t.tag).init({focusable:!1});i.readonly=!0,i.focusable=!1,i.parent=this.projection,r.append(i.render())}else r.append(e.toString());return r},setChoice(e){const{children:t}=this.choices;let i=!1;for(let s=0;s<t.length;s++){const n=t[s];let r=ii.call(this,n);r&&si(r,e)?(n.classList.add("selected"),n.dataset.selected="selected",this.selection=n,u(n),i=!0):(n.classList.remove("selected"),delete n.dataset.selected)}return this},delete(){if(this.hasValue())this.reset();else{let e=this.source.delete();e.success?(this.clear(),(0,n.removeChildren)(this.element),this.element.remove()):(this.environment.notify(e.message),m(this.element))}},_spaceHandler(e){let t=this.source.getCandidates();if((0,n.isEmpty)(t))return void this.notify("No candidates found.",y.INFO);const i=(0,n.createDocFragment)();if(t.forEach((e=>{i.append(this.createChoiceOption(e))})),(0,n.removeChildren)(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let t=(0,n.createListItem)({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(t),St.call(this,t,e)}this.choices.append(i),this.filterChoice(this.input.value),u(this.choices),this.element.classList.add("querying")},escapeHandler(e){let t=!0;if(this.messageElement&&!A(this.messageElement)&&(d(this.messageElement),t=!1),!this.expanded&&"open"===this.selectList.dataset.state)return d(this.selectList),this.selectList.dataset.state="close",!0;if(t){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}this.focus()},enterHandler(e){const t=ei.call(this,e);(0,n.isHTMLElement)(t)&&this.selection!==t&&("placeholder"===ti(t)?this.source.removeValue():this.setValue(ii.call(this,t),!0),this.expanded||(d(this.selectList),this.selectList.dataset.state="close",this.focus()))},backspaceHandler(e){ei.call(this,e)&&this.input&&this.input.focus()},clickHandler(e){const t=ei.call(this,e);(0,n.isHTMLElement)(t)&&this.selection!==t?("placeholder"===ti(t)?this.source.removeValue():this.setValue(ii.call(this,t),!0),this.expanded||(d(this.selectList),this.selectList.dataset.state="close")):e===this.selectListValue&&(u(this.selectList),this.selectList.dataset.state="open")},arrowHandler(e,t){if(!(0,n.isHTMLElement)(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);if(!this.expanded&&t===this.selectListValue)return this.arrowHandler(e,this.selectListValue.parentElement);let r=ei.call(this,t);if(r){let t=T(r,e,this.choices,!1);return(0,n.isHTMLElement)(t)?(t.focus(),!0):this.arrowHandler(e,this.choices)}if(this.expanded&&i!==this.element)return s();let a=T(t,e,i,!1);return(0,n.isHTMLElement)(a)?(a===this.selectList&&(a=this.input||this.choices),a===this.choices&&this.choices.hasChildNodes()&&("up"===e?a=D(this.choices):"down"===e?a=I(this.choices):"left"===e?a=U(this.choices):"right"===e&&(a=M(this.choices))),a.focus(),!0):s()},bindEvents(){(0,n.isHTMLElement)(this.input)&&this.element.addEventListener("input",(e=>{this.filterChoice(this.input.value)})),this.projection.registerHandler("value.changed",((e,t)=>{this.setValue(e)}))}},ri=Object.assign(Object.create(Ft),ni),ai={init(){return this},render(){const e=(0,n.createDocFragment)(),{content:t,markers:i,marker:s,self:r}=this.schema;var a=new DOMParser;return(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"dynamic",id:this.id}})),(0,n.isHTMLElement)(this.content)||(this.content=a.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),(0,n.isNullOrUndefined)(this.place)&&(this.place=this.content.querySelector("[data-"+s+"]")),(0,n.isNullOrUndefined)(this.markers)&&(this.markers=new Map,this.content.querySelectorAll("[data-"+s+"]").forEach((e=>{let t=e.getAttribute("data-"+s);(0,n.isNullOrUndefined)(this.markers.get(t))?this.markers.set(t,[e]):this.markers.set(t,this.markers.get(t).concat([e]))}))),(0,n.isNullOrUndefined)(this.aliases)&&(this.aliases=new Map,i.forEach((e=>{let t=[];e.aliases.forEach((e=>{let i=this.markers.get(e.mv);const s=[];i.forEach((t=>{const i={};i.target=t;let r=[];e.props.forEach((e=>{const i={};i.property=e.props,i.value=e.value,(0,n.isNullOrUndefined)(t.style)||(0,n.isNullOrUndefined)(t.style[e.props])?i.default=t[e.props]:i.default=t.style[e.props],r.push(i)})),i.impacts=r,s.push(i)})),t.push(s)})),this.aliases.set(e.mv,t)}))),(0,n.isNullOrUndefined)(this.self)&&!(0,n.isEmpty)(r)&&(this.self=[],r.forEach((e=>{const t={};t.property=e,(0,n.isNullOrUndefined)(this.place.style[e])?t.default=this.place[e]:t.default=this.place.style[e],this.self.push(t)}))),e.hasChildNodes()&&this.element.appendChild(e),this.update=this.refresh,this.clear=this.clean,this},refresh(e){let t=this.aliases.get(e.toString());(0,n.isNullOrUndefined)(t)||t.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{(0,n.isNullOrUndefined)(e.target[t.property])?e.target.style[t.property]=t.value:e.target[t.property]=t.value}))}))})),(0,n.isNullOrUndefined)(this.self)||this.self.forEach((t=>{(0,n.isNullOrUndefined)(this.place.style[t.property])?this.place[t.property]=e:this.place.style[t.property]=e}))},clean(e){let t=this.aliases.get(e);(0,n.isNullOrUndefined)(t)||t.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{(0,n.isNullOrUndefined)(e.target.style[t.property])?e.target[t.property]=t.default:e.target.style[t.property]=t.default}))}))})),(0,n.isNullOrUndefined)(this.self)||this.self.forEach((e=>{(0,n.isNullOrUndefined)(this.place.style[e.property])?this.place[e.property]=e.default:this.place.style[e.property]=e.default}))}},oi=Object.assign(Object.create(Ft),ai),li={content:"",init(){return this},render(){const e=(0,n.createDocFragment)(),{content:t,marker:i,tag:s}=this.schema;var r=new DOMParser;return(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"interactive",id:this.id}})),(0,n.isHTMLElement)(this.content)||(this.content=r.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),(0,n.isNullOrUndefined)(this.place)&&(this.place=this.content.querySelector("[data-"+i+"]")),(0,n.isHTMLElement)(this.field)||(0,n.isNullOrUndefined)(s)||(this.field=kr.call(this,{type:"external",tag:s},null,this.args)),e.hasChildNodes()&&this.element.appendChild(e),this.initValue=this.update,this.bindEvents(),this.element},createForeign(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i=this.place.getBBox(),s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x",i.x),s.setAttribute("y",i.y),s.setAttribute("width",i.width),s.setAttribute("height",i.height),s.style.fill="red",t.setAttribute("width",i.width),t.setAttribute("height",i.height),e.setAttribute("width",i.width),e.setAttribute("height",i.height),e.append(t),t.append(this.field),this.place.replaceWith(e),e.setAttribute("x",120),e.setAttribute("y",50);let n=this.field.getBoundingClientRect();t.setAttribute("width",n.width),t.setAttribute("height",n.height),e.setAttribute("viewBox","0 0 "+n.width+" "+n.height)},selfUpdate(){let e;(0,n.isNullOrUndefined)(this.aliases)||(e=this.aliases.get(this.value)),(0,n.isNullOrUndefined)(e)||e.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{(0,n.isNullOrUndefined)(e.target[t.property])?e.target.style[t.property]=t.value:e.target[t.property]=t.value}))}))})),(0,n.isNullOrUndefined)(this.self)||this.self.forEach((e=>{(0,n.isNullOrUndefined)(this.place.style[e.property])?this.place[e.property]=this.value:this.place.style[e.property]=this.value}))},clear(){let e;(0,n.isNullOrUndefined)(this.aliases)||(e=this.aliases.get(this.value)),(0,n.isNullOrUndefined)(e)||e.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{(0,n.isNullOrUndefined)(e.target.style[t.property])?e.target[t.property]=t.default:e.target.style[t.property]=t.default}))}))})),(0,n.isNullOrUndefined)(this.self)||this.self.forEach((e=>{(0,n.isNullOrUndefined)(this.place.style[e.property])?this.place[e.property]=e.default:this.place.style[e.property]=e.default}))},updateStatics(){if(!(0,n.isNullOrUndefined)(this.sd)){let e=this.sd.get(this.value);(0,n.isNullOrUndefined)(e)||this.content.appendChild(e.content)}},clearStatics(){if(!(0,n.isNullOrUndefined)(this.sd)){let e=this.sd.get(this.value);(0,n.isNullOrUndefined)(e)||e.content.parentNode.removeChild(e.content)}},updateDynamics(e){(0,n.isNullOrUndefined)(this.dd)||this.dd.forEach((t=>{t.update(e)}))},clearDynamics(e){(0,n.isNullOrUndefined)(this.dd)||this.dd.forEach((t=>{t.clear(e)}))},update(e){(0,n.isNullOrUndefined)(this.value)||(this.clearStatics(),this.clearDynamics(this.value),this.clear()),""===e?this.value=this.attributeName:(0,n.isNullOrUndefined)(this.property)?this.value=e:this.value=this.translateProperty(e),this.selfUpdate(),this.updateDynamics(this.value),this.updateStatics()},bindEvents(){this.place.addEventListener("click",(e=>{(0,n.isNullOrUndefined)(this.foreign)?this.createForeign():(this.place.replaceWith(this.foreign),this.field.focus())}))},getContent(){return(0,n.isHTMLElement)(this.content)||(this.content=parser.parseFromString(content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.content},arrowHandler(e,t){return this.parent.arrowHandler(e,this)},focus(){this.focusIn()},focusIn(){this.place.replaceWith(this.foreign),this.field.focus()},focusOut(){this.foreign.replaceWith(this.place),""===this.field.value?this.update(this.attributeName):this.update(this.field.value)}},ci=Object.assign(Object.create(Ft),li),hi={content:[{type:"static",static:{type:"text",content:"+",focusable:!1}}]};function ui(e){if(!(0,n.isHTMLElement)(e))return!1;const{nature:t,id:i}=e.dataset;return"field-component"===t&&i===this.id}function di(e){const t=e=>e.parentElement===this.list;return t(e)?e:(0,n.findAncestor)(e,t,3)}const pi={list:null,items:null,elements:null,selection:null,content:null,init(e){const{focusable:t=!0}=this.schema;return this.items=new Map,this.elements=new Map,this.children=[],this.focusable=t,(0,n.hasOwn)(this.schema,"list")||(this.schema.list={item:{}}),this},hasChanges:()=>!1,hasValue(){return this.items.size>0},getValue(){return this.list.children},setValue(e,t=!1){t&&this.source.setValue(e),this.list&&((0,n.removeChildren)(this.list),e.forEach((e=>{var t=this.createItem(e);this.list.append(t)}))),this.refresh()},clear(){this.items.clear(),this.list&&(0,n.removeChildren)(this.list)},focus(e){if(this.hasValue()&&this.list)this.list.firstElementChild.focus();else{let e=I(this.element,(e=>e!==this.list));if(!(0,n.isHTMLElement)(e))return this;e.focus()}return this},navigate(e,t,i){let s=null;if("up"===e?s=D(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"down"===e?s=I(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"left"===e?s=U(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"right"===e&&(s=M(this.element,(e=>e!==this.notification&&e.hasChildNodes()))),!(0,n.isHTMLElement)(s))return!1;let r=this.environment.resolveElement(s);return!(0,n.isNullOrUndefined)(r)&&(r.focus(),!0)},focusIn(e){this.focused=!0,this.element.classList.add("active");const{component:t}=e.dataset},focusOut(){if(!this.readonly)return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},createElement(){return this.source.createElement()},getItem(e){return(0,n.isNullOrUndefined)(e)?null:(0,n.hasOwn)(e,"id")?this.items.get(e.id):this.items.get(e)},getItemIndex:e=>(0,n.isHTMLElement)(e)?e.dataset.index:null,createItem(e){const{template:t={},style:i}=this.schema.list.item;if(!this.model.hasProjectionSchema(e,t.tag))return"";let s=this.model.createProjection(e,t.tag);s.optional=!0,s.collapsible=!0,s.parent=this.projection;let n=s.init(t.options).render();return n.dataset.index=e.index,s.element.parent=this,s.registerHandler("view.changed",(e=>{St.call(this.projection,e,i)})),St.call(this.projection,n,i),this.items.set(e.id,n),n},addItem(e){if(!(0,n.isHTMLElement)(this.list))return;const t=this.createItem(e);e.index?this.list.children[e.index-1].after(t):this.list.append(t),this.refresh()},removeItem(e){this.hasList&&!(0,n.isNullOrUndefined)(e)&&(this.items.delete(e.id),this.items.forEach(((e,t)=>{let i=this.source.getElement(t);i&&(e.dataset.index=i.index)})),this.refresh())},moveItem(e,t,i=!1){return this.list.children[t].before(e),e.dataset.index=t,i&&this.source.swapElement(+this.getItemIndex(e),+t),this},swapItem(e,t,i=!1){const s=this.getItemIndex(e),n=this.getItemIndex(t);return this.moveItem(t,s),this.moveItem(e,n),i&&this.source.swapElement(+s,+n),this},delete(e){if(e===this.element)return this.environment.save(this.source.getParent()),void this.source.remove();const{index:t}=e.dataset;var i=this.source.removeElementAt(+t);if(i.success)if(this.hasValue()){let e=+t<this.list.childElementCount?+t:this.list.childElementCount-1;this.list.children[e].focus()}else this.focus();else this.environment.notify(`This element cannot be deleted: ${i.message}`),m(e)},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.list&&this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list&&this.list.classList.add("empty")),this.elements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=Kt.call(this,t,t.state);if(i===t.currentState)return;let r=t.content;s&&(r=s.content);let a=(0,n.createDocFragment)();r.forEach((e=>{let t=kr.call(this,e,null,{focusable:!1});a.append(t)})),(0,n.removeChildren)(e).append(a)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},render(){const e=(0,n.createDocFragment)(),{list:t,style:i,action:s={}}=this.schema;if((0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),St.call(this.projection,this.element,this.schema.style)),t&&!(0,n.isHTMLElement)(this.list)){const{style:i}=t;this.list=(0,n.createDiv)({class:["field--list__list"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.source.hasValue()||this.list.classList.add("empty"),t.currentState=null,this.elements.set(t,this.list),St.call(this.projection,this.list,i),e.append(this.list)}let r=(0,n.valOrDefault)(s.add,hi);if(r){const{position:t="after",content:i,help:s,style:a}=r;let o=(0,n.createButton)({class:["field-action","field--list__add"],tabindex:0,title:s,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});i.forEach((e=>{let t=kr.call(this,e,null,{focusable:!1});o.append(t)})),r.currentState=null,this.elements.set(r,o),St.call(this.projection,o,a),"before"===t&&this.list?this.list.before(o):e.append(o)}return this.list&&this.source.getValue().forEach((e=>{var t=this.createItem(e);this.list.append(t)})),St.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},_spaceHandler(e){this.notify(`Add or remove ${this.source.accept.name}`)},spaceHandler(e){return!!(0,n.isHTMLElement)(e)&&e.parentElement===this.list&&(this.createElement(),!0)},deleteHandler(e){return!(!ui.call(this,e)||e.parentElement!==this.list||(this.delete(e),0))},escapeHandler(e){let t=!0;if(this.messageElement&&!A(this.messageElement)&&(d(this.messageElement),t=!1),t){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}return this.focus(),!1},enterHandler(e){const t=(e=>ui.call(this,e)?e:(0,n.findAncestor)(e,(e=>ui.call(this,e)),5))(e);if((0,n.isNullOrUndefined)(t))return this.focus(),!1;const{action:i,index:s,component:r}=t.dataset;return"add"===i?(this.createElement(),!0):"remove"===i&&(this.delete(t.parentElement),!0)},backspaceHandler:e=>!1,clickHandler(e){const t=(e=>ui.call(this,e)?e:(0,n.findAncestor)(e,(e=>ui.call(this,e)),5))(e);if((0,n.isNullOrUndefined)(t))return;const{action:i,index:s,name:r}=t.dataset;"add"===i?this.createElement():"remove"===i&&this.delete(t.parentElement)},_arrowHandler(e,t){if(!(0,n.isHTMLElement)(t))return!1;let i=di.call(this,t);if(i){let t=T(i,e,this.list);return!!(0,n.isHTMLElement)(t)&&(this.swapItem(i,t,!0),i.focus(),!0)}return!1},arrowHandler(e,t){if(!(0,n.isHTMLElement)(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);if(i===this.list){let i=T(t,e,this.list);return(0,n.isHTMLElement)(i)?(this.environment.resolveElement(i).focus(),!0):this.arrowHandler(e,this.list)}if(i!==this.element)return s();let r=T(t,e,this.element);if(!(0,n.isHTMLElement)(r))return s();if(r===this.notification)return this.arrowHandler(e,r);if(r===this.list){if(!this.list.hasChildNodes())return s();"up"===e?r=D(this.list):"down"===e?r=I(this.list):"left"===e?r=U(this.list):"right"===e&&(r=M(this.list))}return r.focus(),!0},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.projection.listen&&!(0,n.isNullOrUndefined)(this.environment.activeReceiver)?this.environment.activeReceiver.addItem(e,this,this.schema.list.item.template.tag):this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.projection.listen&&!(0,n.isNullOrUndefined)(this.environment.activeReceiver)?this.environment.activeReceiver.removeItem(e):this.removeItem(e)})),this.projection.registerHandler("value.changed",(e=>{this.clear(),this.list&&this.source.getValue().forEach((e=>{let t=this.createItem(e);this.list.append(t)}))})),this.projection.registerHandler("value.swapped",(e=>{const[t,i]=e;let s=this.getItem(t),n=this.getItem(i),r=+this.getItemIndex(s);this.getItemIndex(n),r!==t.index&&this.swapItem(s,n)}))}},mi=Object.assign(Object.create(Ft),pi);Object.defineProperty(mi,"size",{get(){return this.items.size}}),Object.defineProperty(mi,"hasList",{get(){return(0,n.isHTMLElement)(this.list)}});const fi={init(){return this},render(){const e=(0,n.createDocFragment)(),{content:t,mv:i}=this.schema;var s=new DOMParser;return(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:[],dataset:{nature:"field",view:"static",id:this.id}})),(0,n.isHTMLElement)(this.content)||(this.content=s.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),(0,n.isNullOrUndefined)(this.mv)&&(this.mv=i),e.hasChildNodes()&&this.element.appendChild(e),this}},gi=Object.assign(Object.create(Ft),fi);var bi=0;const vi={content:{type:"static",static:{type:"text",content:"Add"}}},yi={content:{type:"static",static:{type:"text",content:"Remove"}}},wi={table:null,header:null,body:null,footer:null,elements:null,contentElements:null,content:null,init(){const{content:e=[],template:t,focusable:i=!0}=this.schema;return this.elements=new Map,this.focusable=i,this.content=e,this.contentElements=new Map,this.template=this.model.getProjectionSchema(this.source.accept,t.tag)[0].projection,this},render(){const{content:e,action:t={}}=this.schema,{disposition:i}=this.template,s=(0,n.createDocFragment)();if(!Array.isArray(e))throw new Error("Empty content for listfield");if((0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({class:["field","field--table"],id:this.id,tabindex:-1,dataset:{nature:"field",view:"table",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),St.call(this.projection,this.element,this.schema.style)),e.forEach((e=>{if("table"===e.type){let t=(0,n.valOrDefault)(e.table,{});const{style:i,header:r,body:a={},footer:o}=t;if(this.table=(0,n.createTable)({class:["field--table__table"],tabindex:0,dataset:{nature:"field-component",view:"table",id:this.id}}),r){const{style:e}=r;this.header=(0,n.createTableHeader)({class:["field--table-header"],dataset:{nature:"field-component",view:"table",id:this.id}}),St.call(this.projection,this.header,e),this.table.append(this.header)}if(a){const{style:e}=a;this.body=(0,n.createTableBody)({class:["field--table-body"],dataset:{nature:"field-component",view:"table",id:this.id}}),St.call(this.projection,this.body,e),this.table.append(this.body)}if(o){const{style:e}=o;this.footer=(0,n.createTableFooter)({class:["field--table-footer"],dataset:{nature:"field-component",view:"table",id:this.id}}),St.call(this.projection,this.footer,e),this.table.append(this.footer)}t.currentState=null,this.contentElements.set(t,this.table),St.call(this.projection,this.table,i),s.append(this.table)}else if("action"===e.type){let t=(0,n.valOrDefault)(e,vi);const{content:i,style:r}=t;let a=kr.call(this,i,null),o=(0,n.createButton)({class:["field-action","field--table__add"],tabindex:0,dataset:{nature:"field-component",view:"table",component:"action",id:this.id,action:"add"}},[a]);t.currentState=null,this.contentElements.set(t,o),St.call(this.projection,o,r),s.append(o)}else{let t=kr.call(this,e);this.contentElements.set(e,t),s.append(t)}})),this.header){let e=(0,n.createTableRow)({class:["field--table-header-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id}});i.forEach((t=>{const{header:i}=t,{style:s,content:r}=i;var a=kr.call(this,r),o=(0,n.createTableHeaderCell)({class:["field--table-header-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);St.call(this.projection,o,s),e.append(o)}));let t=(0,n.createTableCell)({class:["field--table-header-cell","field--table-header-cell--action"]},"Action");e.append(t),this.header.append(e)}return this.source.hasValue()&&this.source.getValue().forEach((e=>{this.addRow(e)})),s.hasChildNodes()&&(this.element.append(s),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,hasValue(){return this.body.rows.length>0},getValue(){return this.body.rows},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.table.classList.remove("empty")):(this.element.classList.add("empty"),this.table.classList.add("empty")),this.contentElements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=Kt.call(this,t,t.state);if(i===t.currentState)return;let r=null;r=s?kr.call(this,s.content,null):kr.call(this,t.content,null),(0,n.removeChildren)(e).append(r)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},createElement(){return this.source.createElement()},addRow(e){const{action:t={},before:i={},after:s={}}=this.schema,{disposition:r}=this.template,a=(0,n.valOrDefault)(e.index,this.table.rows.length),o="row"+bi++,l=(0,n.createTableRow)({class:["field--table-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id,index:a,elementId:o}});this.elements.set(o,l),r.forEach((t=>{const{body:i}=t,{style:s,content:r}=i;var a=kr.call(this,r,e),o=(0,n.createTableCell)({class:["field--table-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},a);St.call(this.projection,o,s),l.append(o)}));var c=(0,n.createTableCell)({class:["field--table__cell-action"]}),{content:h,style:u}=(0,n.valOrDefault)(t.remove,yi),d=kr.call(this,h),p=(0,n.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",rowId:o}},d),m=(0,n.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-up",rowId:o}},"Move up"),f=(0,n.createButton)({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-down",rowId:o}},"Move down");St.call(this.projection,p,u),c.append(p,m,f),l.append(c),this.body.append(l),this.refresh()},removeRow(e){var t=this.body.rows.item(e.index);if(!(0,n.isHTMLElement)(t))throw new Error("Table error: Row not found");(0,n.removeChildren)(t),t.remove();for(let t=e.index;t<this.body.rows.length;t++){const e=this.body.rows.item(t),{index:i}=e.dataset;e.dataset.index=+i-1}this.refresh()},removeElement(e){return this.source.removeElement(e)},delete(e){if(e===this.element||e===this.table)return void this.source.delete();const{index:t}=e.dataset;this.source.removeElementAt(+t)||(this.environment.notify("This element cannot be deleted"),m(e))},bindEvents(){this.element.addEventListener("click",(e=>{const{target:t}=e,i=function(e){const t="field-component";return e.dataset.nature===t?e:(0,n.findAncestor)(e,(e=>e.dataset.nature===t))}(t);if(!(0,n.isHTMLElement)(i))return;const{id:s,action:r}=i.dataset;if(s===this.id)if("add"===r)this.createElement();else if("remove"===r){const{rowId:e}=i.dataset;let t=this.elements.get(e);this.delete(t)}else if("move-up"===r){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.previousElementSibling;s&&s.before(t)}else if("move-down"===r){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.nextElementSibling;s&&s.after(t)}}),!0),this.projection.registerHandler("value.added",(e=>{this.addRow(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeRow(e)})),this.projection.registerHandler("value.changed",(e=>{(0,n.removeChildren)(this.body),this.source.getValue().forEach((e=>{this.addRow(e)}))}))}},xi=Object.assign(Object.create(Ft),wi),Ei=e=>(0,n.isHTMLElement)(e,["input","textarea"]),Ai="error";function Oi(){return(0,n.isHTMLElement)(this.choice)||(this.choice=(0,n.createUnorderedList)({class:["bare-list","field--textbox__choices"],dataset:{nature:"field-component",view:"text",component:"choice",id:this.id}}),this.append(this.choice)),this.choice}function Ni(e){return(0,n.createListItem)({class:["field--textbox__choice"],tabindex:0,dataset:{nature:"field-component",view:"text",component:"choice-item",value:e,id:this.id}},e)}function ki(e){return e.parentElement===this.choice?e:(0,n.findAncestor)(e,(e=>e.parentElement===this.choice),3)}function ji(e){const{placeholder:t="",type:i}=e;let s="";return s=this._placeholder?(0,n.valOrDefault)(Er.call(this,this._placeholder),""):(0,n.valOrDefault)(Er.call(this,t),""),this.readonly||this.resizable?(0,n.createSpan)({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:s,dataset:{placeholder:s,nature:"field-component",view:this.type,id:this.id}}):this.multiline?(0,n.createTextArea)({class:["field--textbox__input"],placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}}):(0,n.createInput)({class:["field--textbox__input"],type:(0,n.valOrDefault)(i,"text"),placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}})}const Li={input:null,choice:null,value:"",placeholder:null,multiline:!1,resizable:!1,content:null,hasOwnSource:!1,init(e={}){Object.assign(this.schema,e);const{multiline:t=!1,placeholder:i="",resizable:s=!1,focusable:r=!0,source:a}=this.schema;if(this.multiline=t,this.focusable=r,this.resizable=s,this.children=[],this._placeholder=i,a){const e=this.projection.concept.getAttribute(a).getTarget();e.register(this),this.source=e,this.hasOwnSource=!0}return(0,n.hasOwn)(this.schema,"choice")||(this.schema.choice={}),this},focus(e){return this.input.focus(),this},focusIn(){return this.focused=!0,this.value=this.getValue(),this.element.classList.add("active"),this.element.classList.add("focus"),this},focusOut(){return this.hasChanges()&&this.setValue(this.getValue(),!0),(0,n.isNullOrWhitespace)(this.getValue())&&(this.input.textContent=""),this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.choice&&d(this.choice),this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("focus"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!=this.getValue()},hasValue(){return!(0,n.isEmpty)(this.getValue())},getValue(){return Ei(this.input)?this.input.value:this.input.textContent},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||(m(this.element),this.environment.notify(i.message,"error")),this.setInputValue(e),this.value=e,this.refresh()},setInputValue(e){Ei(this.input)?this.input.value=e:this.input.textContent=e},getCandidates(){let e=this.source.getCandidates();return Array.isArray(e)?e:[]},enable(){return this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1,this.element.classList.add("disabled"),this},disable(){return this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0,this.element.classList.remove("disabled"),this},refresh(){Kt.call(this,this.schema,this.schema.state),this.hasValue()?this.element.classList.remove("empty"):this.element.classList.add("empty"),this.element.dataset.value=this.value,this.hasError?(this.element.classList.add(Ai),this.input.classList.add(Ai)):(this.element.classList.remove(Ai),this.input.classList.remove(Ai)),this.choice&&this.filterChoice(this.getValue())},render(){const e=(0,n.createDocFragment)(),{container:t,input:i={},style:s}=this.schema;if((0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:["field","text-field","field--textbox"],dataset:{nature:"field",view:"text",id:this.id,disabled:this.disabled,readonly:this.readonly,value:""}}),this.readonly&&this.element.classList.add("readonly"),this.disabled&&this.element.classList.add("disabled"),St.call(this.projection,this.element,this.schema.style)),t){const{content:i=[],style:s}=t;i.forEach((t=>{if("input"===t.type){const{style:i}=t.input;this.input=ji.call(this,t.input),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",St.call(this.projection,this.input,i),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}else{let i=kr.call(this,t,null,{focusable:!1});e.append(i)}})),St.call(this.projection,this.element,s)}else{if(!(0,n.isHTMLElement)(this.input)){const{style:t}=i;this.input=ji.call(this,i),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",St.call(this,this.input,t),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}St.call(this.projection,this.element,s)}return e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},filterChoice(e){const{children:t}=this.choice;if((0,n.isNullOrWhitespace)(e)){for(let e=0;e<t.length;e++){const i=t[e];u(i),i.hidden=!1}return!0}let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e],{value:n}=s.dataset;i.some((e=>n.toLowerCase().includes(e)))?(u(s),s.hidden=!1):(d(s),s.hidden=!0)}return!0},selectChoice(e){if(!(0,n.isHTMLElement)(e))return;const t=function(e){return e.dataset.value}(e);return this.setValue(t,!0),this.input.focus(),d(this.choice),this},update(e,t,i){"delete"!==e?"value.changed"===e&&this.setValue(t):this.delete()},_spaceHandler(e){const t=new Set(this.getCandidates());if(0===t.size)this.notify("Enter any text.",y.INFO);else{Oi.call(this);const e=(0,n.createDocFragment)();t.forEach((t=>e.append(Ni.call(this,t)))),(0,n.removeChildren)(this.choice).append(e),this.filterChoice(this.getValue()),u(this.choice)}},escapeHandler(e){let t=!0;if(this.messageElement&&!A(this.messageElement)&&(d(this.messageElement),t=!1),this.choice&&!A(this.choice)&&(d(this.choice),t=!1),t){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return i&&i.focus(t),!1}return this.input.focus(),!0},enterHandler(e){const t=ki.call(this,e);return t?this.selectChoice(t):this.multiline||(e===this.input?this.setValue(this.getValue(),!0):this.focus()),!0},backspaceHandler(e){ki.call(this,e)&&this.input.focus()},clickHandler(e){const t=ki.call(this,e);(0,n.isHTMLElement)(t)&&this.selectChoice(t)},arrowHandler(e,t){if(!(0,n.isHTMLElement)(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);let a=ki.call(this,t);if((0,n.isHTMLElement)(a)){let t=T(a,e,this.choice);return(0,n.isHTMLElement)(t)?(t.focus(),!0):this.arrowHandler(e,this.choice)}if(i!==this.element)return s();let o=null;if("right"===e){if(t===this.input&&!(this.getValue().length<r(this.input)+1))return!1;o=T(t,e,this.element,!1)}else if("left"===e){if(t===this.input&&0!==r(this.input))return!1;o=T(t,e,this.element,!1)}else o=T(t,e,this.element,!1);return(0,n.isHTMLElement)(o)&&o.dataset.id===this.id?("up"===e?o=D(this.choice):"down"===e?o=I(this.choice):"left"===e?o=U(this.choice):"right"===e&&(o=M(this.choice)),o.focus(),!0):s()},bindEvents(){this.element.addEventListener("input",(e=>{this.hasError&&this.source.setValue(this.getValue(),!0),this.refresh()})),this.hasOwnSource||this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},Si=Object.assign(Object.create(Ft),Li);var Ci=s(185);const Ti={init(){const{arrowStyle:e=null,path:t,attach:i={}}=this.schema;return(0,n.isNullOrUndefined)(e)?this.arrowStyle={}:this.arrowStyle=e,t&&(this.meet=t.meet),i&&(this.attach=i.type),this},render(){const{reference:e,decorator:t=!1}=this.schema;if((0,n.isHTMLElement)(this.element)||(this.element=document.createElementNS("http://www.w3.org/2000/svg","path"),this.element.style.fill="transparent",this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="arrow",this.element.dataset.id=this.id),(0,n.isNullOrUndefined)(this.reference))switch(e.type){case"multiple":this.reference=this.source.getAttributeByName(e.listen).target,this.multiple=!0;break;case"duo":this.from=this.source.getAttributeByName(e.from).target,this.to=this.source.getAttributeByName(e.to).target,this.multiple=!1}return this.computeStyle(),this.bindEvent(),this.element},getStyle(){},signal(){(0,n.isNullOrUndefined)(this.valSource)||(0,n.isNullOrUndefined)(this.valTarget)||this.projection.parent.accept(this.valSource,this.valTarget,this)},computeStyle(){const{stroke:e="black",dasharray:t=null,width:i=1,linecap:s="butt",end:r=!1,start:a=!1}=this.arrowStyle;this.element.style.stroke=e,(0,n.isNullOrUndefined)(t)||(this.element.style["stroke-dasharray"]=t),this.element.style["stroke-width"]=(0,n.valOrDefault)(i,5),this.element.style["stroke-linecap"]=s,r&&this.createMarkerEnd()},createMarkerEnd(){(0,n.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.end=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.end.id="marker"+this.id,this.end.setAttribute("refY",5),this.end.setAttribute("refX",10),this.end.setAttribute("markerUnit","strokeWidth"),this.end.setAttribute("markerWidth",10),this.end.setAttribute("markerHeight",10),this.end.setAttribute("orient","auto"),this.end.classList.add("end");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.end.appendChild(e),this.definitions.appendChild(this.end),this.path.setAttribute("marker-end","url(#"+this.end.id+")")},createMarkerStart(){(0,n.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.start=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.start.id="marker"+this.id,this.start.setAttribute("refY",5),this.start.setAttribute("refX",1),this.start.setAttribute("markerUnit","strokeWidth"),this.start.setAttribute("markerWidth",10),this.start.setAttribute("markerHeight",10),this.start.setAttribute("orient","auto"),this.start.classList.add("start");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.start.appendChild(e),this.definitions.appendChild(this.end),this.element.setAttribute("marker-start","url(#"+this.end.id+")")},setValues(){(0,n.isNullOrUndefined)(this.source.getAttributeByName("target").target.value)||(this.valTarget=this.source.getAttributeByName("target").target.value),(0,n.isNullOrUndefined)(this.source.getAttributeByName("source").target.value)||(this.valSource=this.source.getAttributeByName("source").target.value)},refresh(){this.setValues(),this.updateRegister(),this.signal()},deleteRef(e,t){this.valTarget!==e.id&&this.valSource!==e.id||this.projection.parent.removeArrow(this,t)},setLine(e,t){this.element.setAttribute("d","M "+e.x+", "+e.y+"L "+t.x+", "+t.y)},setPath(e){this.element.setAttribute("d",e)},updateRegister(){for(let e=0;e<this.registered.length;e++)this.registered[e]={name:this.registered[e].name,value:this.source.getAttributeByName(this.registered[e].name).target.value}},register(e){(0,n.isNullOrUndefined)(this.getAttribute)&&(this.registered.push({name:e,value:this.source.getAttributeByName(e).target.value}),this.source.getAttributeByName(e).target.register(this.projection),this.projection.registerHandler("value.added",(e=>{this.refresh()})))},get(e){for(let t=0;t<this.registered.length;t++)if(this.registered[t].name===e)return this.registered[t].value},registerValue(e){(0,n.isNullOrUndefined)(this.registered)&&(this.registered=[]),e.register(this),this.registered.push({concept:e,currentVal:e.value})},update(e,t){"value.changed"===e&&this.updatePath(t)},updatePath(){this.lineUpdate(),this.parent.container.append(this.element)},updatePathDuo(){"anchor"===this.attach&&this.anchorAttach()},anchorAttach(){this.occupied&&Ci.AnchorHandler.freeOccupation(this),this.occupant&&this.occupant.removeAnchor(this);let e=this.parent.container.querySelector('[data-concept="'+this.valueF+'"]'),t=this.parent.container.querySelector('[data-concept="'+this.valueT+'"]'),i=Ci.AnchorHandler.findCommonIndex(e.dataset.id,t.dataset.id,this.occupant,this),s=Ci.AnchorHandler.getAnchorAt(e.dataset.id,i),n=Ci.AnchorHandler.getAnchorAt(t.dataset.id,i),r=e.getBoundingClientRect(),a=this.parent.container.createSVGPoint();a.x=r.x+s.x,a.y=r.y+s.y;let o=a.matrixTransform(this.parent.container.getScreenCTM().inverse());r=t.getBoundingClientRect(),a.x=r.x+n.x,a.y=r.y+n.y;let l=a.matrixTransform(this.parent.container.getScreenCTM().inverse());this.setPath("M "+o.x+" "+o.y+" L "+l.x+" "+l.y),this.parent.container.append(this.element),this.occupant&&this.occupant.accept(this,o,l,i),Ci.AnchorHandler.registerOccupation(this,i,e.dataset.id,t.dataset.id),this.occupied=!0},forceAnchor(e){let t=this.parent.container.querySelector('[data-concept="'+this.valueF+'"]'),i=this.parent.container.querySelector('[data-concept="'+this.valueT+'"]'),s=Ci.AnchorHandler.getAnchorAt(t.dataset.id,e),n=Ci.AnchorHandler.getAnchorAt(i.dataset.id,e),r=t.getBoundingClientRect(),a=this.parent.container.createSVGPoint();a.x=r.x+s.x,a.y=r.y+s.y;let o=a.matrixTransform(this.parent.container.getScreenCTM().inverse());r=i.getBoundingClientRect(),a.x=r.x+n.x,a.y=r.y+n.y;let l=a.matrixTransform(this.parent.container.getScreenCTM().inverse());return this.setPath("M "+o.x+" "+o.y+" L "+l.x+" "+l.y),this.parent.container.append(this.element),this.occupant&&this.occupant.accept(this,o,l,e),Ci.AnchorHandler.registerOccupation(this,e,t.dataset.id,i.dataset.id),this.occupied=!0,{e:this,from:t.dataset.id,to:i.dataset.id,index:e}},lineUpdate(){let e=this.targetInformations();if("minY"===this.meet){let t=e[0].y,i=e[0];for(let s=1;s<e.length;s++){let n=e[s].y;n<t&&(t=n,i=e[s])}this.computeLineMin(e,e[0],i)}},computeLineMin(e,t,i,s){let r=t.x,a=i.x,o=t.y,l=(o-i.y)/(r-a),c=o-l*r;(0,n.isNullOrUndefined)(s)||(c-=s);for(let s=0;s<e.length;s++){let n=l*e[s].x+c;if(n>e[s].y)return this.computeLineMin(e,t,i,n-e[s].y)}let h="M "+(r-.5)+" "+(a*l+c)+" L "+(e[e.length-1].x+.5)+" "+(a*l+c);this.setPath(h),(0,n.isNullOrUndefined)(this.subPath)&&(this.subPath=[]),(0,n.isEmpty)(this.subPath)||(this.subPath.forEach((e=>{e.remove()})),this.subPath=[]);let u=a*l+c;for(let t=0;t<e.length;t++)if(e[t].y>u){let i=document.createElementNS("http://www.w3.org/2000/svg","line");i.classList.add("subPath"),this.subPath.push(i),i.setAttribute("x1",e[t].x),i.setAttribute("x2",e[t].x),i.setAttribute("y1",e[t].y),i.setAttribute("y2",u),this.parent.container.append(i),i.style["stroke-width"]=.75,i.setAttribute("stroke","black")}},targetInformations(){let e=[],t=!1;return this.registered.forEach((i=>{let s=i.concept.value;if((0,n.isNullOrUndefined)(s))return void(t=!0);let r=this.parent.container.querySelector('[data-concept="'+s+'"]'),a=this.projection.resolveElement(r),o=this.parent.container.createSVGPoint(),l=r.getBoundingClientRect();o.x=l.x,o.y=l.y;let c=o.matrixTransform(this.parent.container.getScreenCTM().inverse());(0,n.isNullOrUndefined)(a.schema.arrowAnchor)||(c.x+=a.schema.arrowAnchor.x,c.y+=a.schema.arrowAnchor.y),e.push({x:c.x,y:c.y})})),!t&&e},duoUpdate(){this.valueF=this.from.value,this.valueT=this.to.value,(0,n.isNullOrUndefined)(this.valueF)||(0,n.isNullOrUndefined)(this.valueT)||this.updatePathDuo()},updatePosition(e){let t=this.projection.resolveElement(this.projection.parent.findItem(e.id).render),i=this.projection.resolveElement(this.projection.parent.findAncestor(this.bind.container).render),s=i.findAnchorIndex(this.bind.container),n=t.findAnchor(s),r=i.findAnchor(s);const a=Number(i.container.getAttribute("x"))+r.x,o=Number(i.container.getAttribute("y"))+r.y,l=Number(t.container.getAttribute("x"))+n.x,c=Number(t.container.getAttribute("y"))+n.y;this.element.setAttribute("d","M "+a+" "+o+" L "+l+" "+c),this.projection.parent.container.append(this.element)},bindProj(e){this.bind=e;const t=this.schema.reference.target;this.objectiv=this.source.getAttributeByName(t).target,this.objectiv.register(this.projection),this.projection.registerHandler("value.changed",(e=>{this.updatePosition(e)}))},bindEvent(){switch(this.schema.reference.type){case"duo":this.from.register(this.projection),this.to.register(this.projection),this.projection.registerHandler("value.changed",(e=>{this.duoUpdate()}));break;case"multiple":this.reference.register(this.projection),this.projection.registerHandler("value.added",(e=>{this.registerValue(e)}))}}},Ii=Object.assign(Object.create(Ft),Ti),Mi={init(e){if(!(0,n.isNullOrUndefined)(e)){const{focusable:t=!1}=e;this.focusable=t}return this},render(){const{placeholder:e,style:t,readonly:i,breakDown:s=!1}=this.schema;return(0,n.isNullOrUndefined)(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","text"),this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="svg",this.element.style["dominant-baseline"]="hanging",this.element.dataset.id=this.id,this.element.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")),this.source.hasValue()?this.content=this.source.getValue().toString():this.content=e,s&&(this.breakDown=s),this.breakDown?this.element.textContent=this.content.substring(0,s):this.element.textContent=this.content,this.caps=!1,this.readonly=i,this.bindEvents(),this.style(),this.element},registerDimensionsObserver(e){(0,n.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(e)},setActiveChar(e,t,i){let{target:s,end:n=!1}=this.findChar(t,i);this.index=s,this.end=n,this.char=n?this.element.getEndPositionOfChar(s):this.element.getStartPositionOfChar(s),this.createCursor(),this.switchOn(),this.addListeners()},style(){const{font:e,size:t,anchor:i="left",weight:s,baseline:n}=this.schema.style;this.element.setAttribute("text-anchor",i),this.element.setAttribute("font-family",e),this.element.setAttribute("font-size",t),this.element.style["dominant-baseline"]=n,s&&this.element.setAttribute("font-weight",s),this.baseline=n,this.size=t},setValue(){"number"===this.source.name?this.source.setValue(Number(this.content)):this.source.setValue(this.content)},addListeners(){this.element.addEventListener("keydown",(e=>{let t=e.keyCode;if(27===t)return""===this.content&&(this.content=this.schema.placeholder,this.element.textContent=this.content),this.setValue(this.content),void this.switchOff();if(e.stopPropagation(),t!==this.lastKey||!this.repeat){switch(t){case 8:0===this.index&&this.end&&""!==this.content&&(this.content="",this.element.textContent=""),this.index>0&&(this.end?(this.content=this.content.slice(0,this.index),this.element.textContent=this.content):(this.content=this.content.slice(0,this.index-1)+this.content.slice(this.index),this.element.textContent=this.content),this.index--);break;case 46:this.index<this.content.length-1&&!this.end&&(this.content=this.content.slice(0,this.index)+this.content.slice(this.index+1),this.element.textContent=this.content),this.index!==this.content.length-1||this.end||(this.content=this.content.slice(0,this.index),this.element.textContent=this.content,this.end=!0,this.index--),0===this.index&&1===this.content.length&&(this.content="",this.element.textContent=this.content);break;case 20:this.caps=!this.caps;break;case 32:e.preventDefault(),this.end?(this.content+=" ",this.element.textContent=this.content):(this.content=this.content.slice(0,this.index)+" "+this.content.slice(this.index),this.element.textContent=this.content),this.index++}"number"!==this.source.name&&(t>=65&&t<=90||t>=48&&t<=57||t>=90&&t<=105)&&(this.caps?this.end?this.content=this.content+String.fromCharCode(e.keyCode):this.content=this.content.slice(0,this.index)+String.fromCharCode(e.keyCode)+this.content.slice(this.index):this.end?this.content=this.content+String.fromCharCode(e.keyCode).toLowerCase():this.content=this.content.slice(0,this.index)+String.fromCharCode(e.keyCode).toLowerCase()+this.content.slice(this.index),this.element.textContent=this.content,this.index++),"number"===this.source.name&&(t>=48&&t<=57||t>=96&&t<=105)&&(t>=96&&t<=105&&(t-=48),this.end?this.content=this.content+String.fromCharCode(t):this.content=this.content.slice(0,this.index)+String.fromCharCode(t)+this.content.slice(this.index),this.element.textContent=this.content,this.index++),this.lastKey=e.keyCode,this.repeat=!0,setTimeout((()=>{this.repeat=!1}),50),this.updateCursor(),this.setValue(this.content)}}))},switchOn(){this.on=!0,this.element.parentNode.append(this.cursor),(0,n.isNullOrUndefined)(this.interval)||clearInterval(this.interval),this.interval=setInterval((()=>{this.on?(this.cursor.remove(),this.on=!1):(this.element.parentNode.append(this.cursor),this.on=!0)}),1e3)},switchOff(){this.on=!1,(0,n.isNullOrUndefined)(this.cursor)||this.cursor.remove(),clearInterval(this.interval)},createCursor(){(0,n.isNullOrUndefined)(this.cursor)||this.cursor.remove();let e=this.element.getBBox();switch(n.isNullOrUndefined&&(this.cursor=document.createElementNS("http://www.w3.org/2000/svg","rect")),this.cursor.setAttribute("x",this.char.x),this.baseline){case"middle":case"auto":this.cursor.setAttribute("y",Number(this.element.getAttribute("y"))-e.height/2);break;case"hanging":this.cursor.setAttribute("y",this.element.getAttribute("y"))}this.cursor.setAttribute("width",1),this.cursor.setAttribute("height",e.height)},updateCursor(){if(""!==this.content){if(this.end)return this.char=this.element.getEndPositionOfChar(this.content.length-1),void this.cursor.setAttribute("x",this.char.x);this.char=this.element.getStartPositionOfChar(this.index),this.cursor.setAttribute("x",this.char.x)}else this.cursor.setAttribute("x",Number(this.element.getAttribute("x")))},findChar(e,t){let i=0,s=this.element.getStartPositionOfChar(0),n=s.x,r=this.element.getBoundingClientRect().x,a=(e-r)*(e-r);for(let t=1;t<this.element.getNumberOfChars();t++){let s=e-(r-n+this.element.getStartPositionOfChar(t).x);if(!(a>s*s))return{target:t,end:!1};a=s*s,i=t}s=this.element.getEndPositionOfChar(this.element.getNumberOfChars()-1);let o=e-(r-n+s.x);return o*o<a?{target:this.element.getNumberOfChars()-1,end:!0}:{target:this.element.getNumberOfChars()-1,end:!1}},findCharRelative(e){let t,i=0,s=this.element.getStartPositionOfChar(0),n=e.x-s.x,r=e.y-s.y,a=Math.sqrt(n*n+r*r),o=a;for(t=1;t<this.element.getNumberOfChars();t++){if(s=this.element.getStartPositionOfChar(t),n=e.x-s.x,r=e.y-s.y,a=Math.sqrt(n*n+r*r),!(a<o))return{target:i,start:!0};o=a,i=t}return s=this.element.getEndPositionOfChar(t-1),n=e.x-s.x,r=e.y-s.y,a=Math.sqrt(n*n+r*r),a<o?{target:t-1,start:!1,end:!0}:{target:i,start:!0}},focusIn(){},focusOut(){console.log("SwitchOff"),this.readonly||(console.log("SwitchOff"),this.switchOff(),this.setValue(this.content))},bindEvents(){this.readonly||this.element.addEventListener("click",(e=>{this.setActiveChar(e.target,e.clientX,e.clientY)})),this.projection.registerHandler("value.changed",(e=>{this.content=e.toString(),this.breakDown&&e.length>this.breakDown?this.element.textContent=this.content.substring(0,this.breakDown):this.element.textContent=this.content}))}},Ui=Object.assign(Object.create(Ft),Mi),Di={createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return t.append(i),i.append(e),t},analysePos(e,t){console.log("Analysing"),console.log(t);let i=t.coordinates;const s={};return s.type=i.type,s.render=e,console.log(i.type),"delegate"===i.type?s.await=!1:(s.anchor=i.anchor,s.x=i.x,s.y=i.y,s.await=!0),console.log(s),s},positionElement(e,t){switch(e.anchor){case"middle":return t.setAttribute("x",e.x-Number(t.getAttribute("width"))/2),void t.setAttribute("y",e.y);case"right":return t.setAttribute("x",e.x-Number(t.getAttribute("width"))),void t.setAttribute("y",e.y);case"center":return t.setAttribute("x",e.x-Number(t.getAttribute("width"))/2),void t.setAttribute("y",e.x-Number(t.getAttribute("height"))/2);default:console.log("Undefined"),console.log(t),t.setAttribute("x",e.x),t.setAttribute("y",e.y)}},analyseDim(e,t){let i=t.dimension;const s={};switch(s.type=i.type,s.item=e,i.type){case"fixed":s.value=i.value,s.holder=this.createHolder(e),s.await=!0;break;case"absolute":s.width=i.width,s.height=i.height,s.holder=this.createHolder(e),s.await=!0;break;case"ratio":s.ratio=i.ratio,s.holder=this.createHolder(e),s.await=!0;break;case"pure":s.await=!1}return s},setDimensions(e){switch(e.type){case"fixed":this.adaptFixed(e.item,e.value);break;case"absolute":this.adaptAbsolute(e.item,e.width,e.height);break;case"ratio":this.adaptRatio(e.item,e.ratio)}},adaptFixed(e,t){let i=e.parentNode,s=i.parentNode,n=e.getBoundingClientRect();i.setAttribute("width",n.width),i.setAttribute("height",n.height),s.setAttribute("width",t),s.setAttribute("height",t*n.height/n.width),s.setAttribute("viewBox","0 0 "+n.width+" "+n.height)},adaptAbsolute(e,t,i){let s=e.parentNode,n=s.parentNode;s.setAttribute("width",t),s.setAttribute("height",i),n.setAttribute("width",t),n.setAttribute("height",i)},adaptRatio(e,t){let i=Number(e.getAttribute("width")),s=Number(e.getAttribute("height")),n=e.parentNode,r=n.parentNode;n.setAttribute("width",i),n.setAttribute("height",s),r.setAttribute("width",i*t),r.setAttribute("height",s*t),r.setAttribute("viewBox","0 0 "+i+" "+s)}},{createDocFragment:_i,isNullOrUndefined:Bi,createI:Pi,createArticle:Hi,findAncestor:Vi,removeChildren:Ri,windowWidth:$i,isObject:Fi,valOrDefault:qi}=s(835);function zi(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.candidates.find((e=>e.id===i)).id:"meta-concept"===t?this.candidates.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const Wi={init(){return this.width=0,this.height=0,this.items=new Map,this},render(){const{selection:e,dimensions:t,openSelection:i}=this.schema;if(Bi(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-choice",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),t?(this.element.setAttribute("width",t.width),this.element.setAttribute("height",t.height)):this.element.style.overflow="visible",this.candidates=this.source.getCandidates(),Bi(this.selection)&&(this.createSelection(e),this.element.append(this.selection)),i&&Bi(this.openSelection)){const e=new DOMParser;this.openSelection=e.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.element.append(this.openSelection),this.openSelection.addEventListener("click",(()=>{if(this.open)return this.selection.remove(),void(this.open=!1);this.element.append(this.selection),this.open=!0}))}return this.open=!0,this.bindEvents(),this.element},setValue(e){this.source.setValue(e)},createSelection(e){const{item:t,breakPoint:i=!1,direction:s,close:n}=e;this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg");let r=0;this.candidates.forEach((e=>{const n=Fi(e),{dimension:a,tag:o}=t;let{holder:l,foreign:c}=this.createChoiceContainer(a);if(this.items.set(e.id,l),"meta-concept"===e.type){let t=this.model.getProjectionSchema(e.concept,qi(o))[0],i=t.type,s={type:i,[i]:t.content||t.projection},n=kr.call(this,s,e.concept,{focusable:!1,meta:e.name});l.dataset.type="meta-concept",l.dataset.value=e.name,n.style.position="fixed",c.append(n)}else if(n){if(!this.model.hasProjectionSchema(e,o))return container;let t=this.model.createProjection(e,o).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,c.append(t.render()),c.childNodes[0].style.position="fixed",l.dataset.type="concept",l.dataset.value=e.id}else c.append(e.toString());switch(s){case"horizontal":i?(l.setAttribute("y",~~(r/i)*a.height),l.setAttribute("x",r%i*a.width),this.width=i*a.width,this.height=(1+~~(r/i))*a.height):(l.setAttribute("x",r*a.width),this.width=(r+1)*a.width,this.height=a.height);break;case"vertical":i?(l.setAttribute("x",~~(r/i)*a.width),l.setAttribute("y",r%i*a.height)):l.setAttribute("y",r*a.height)}this.bindEvent(l),this.selection.append(l),l.style.border="dotted black",r++}))},registerDimensionsObserver(e){Bi(this.observers)&&(this.observers=[]),this.observers.push(e)},notifyDimObservers(){Bi(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))},bindEvent(e){e.addEventListener("click",(()=>{this.setValue(zi.call(this,e)),this.schema.selection.close&&(this.open=!1,this.selection.remove(),this.width=0,this.height=0,this.notifyDimObservers())}))},bindEvents(){this.projection.registerHandler("displayed",(()=>{this.displayed||(this.displayed=!0,this.items.forEach(((e,t)=>{const i=e.childNodes[0].childNodes[0];this.projection.resolveElement(i).projection.update("displayed")})))})),this.projection.registerHandler("value.changed",(()=>{this.schema.selection.close&&(this.open=!1,this.selection.remove(),this.width=0,this.height=0,this.notifyDimObservers())}))},createChoiceContainer(e){const{width:t,height:i}=e;let s=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return s.setAttribute("width",t),s.setAttribute("height",i),n.setAttribute("width",t),n.setAttribute("height",i),s.append(n),{holder:s,foreign:n}},focusIn(){},focusOut(){}},Ki=Object.assign(Object.create(Ft),Wi),{createDocFragment:Xi,isNullOrUndefined:Yi,createI:Ji,createArticle:Gi,findAncestor:Qi,removeChildren:Zi,windowWidth:es,isObject:ts,valOrDefault:is}=s(835);function ss(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.candidates.find((e=>e.id===i)).id:"meta-concept"===t?this.candidates.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const ns={init(){return this.width=0,this.height=0,this.items=new Map,this},render(){const{selection:e,dimensions:t,open:i,overflow:s=!1}=this.schema;if(Yi(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-placeholder",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),s&&(this.element.style.overflow="visible"),t&&(this.element.setAttribute("width",t.width),this.element.setAttribute("height",t.height)),Yi(this.openBack)){const{render:e,coordinates:t,dimensions:s}=i;console.log("rendering open-back"),console.log(i),this.openBack=kr.call(this,Object.assign(e,{action:{type:"OPEN",target:this}})),this.openBack.setAttribute("x",is(t.x,0)),this.openBack.setAttribute("y",is(t.y,0))}return this.candidates=this.source.getCandidates(),Yi(this.selection)&&(this.createSelection(e),this.element.append(this.selection)),Yi(this.source.value)?this.opened=!0:(this.opened=!1,this.element.append(this.openBack)),this.element},clickHandler(e){},setValue(e){this.source.setValue(e),this.element.append(this.openBack),this.opened=!1},open(){this.opened=!0,this.element.append(this.selection),this.openBack.remove(),this.source.removeValue()},createSelection(e){const{item:t,breakPoint:i=!1,direction:s,close:n}=e;this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.candidates.forEach((e=>{const i=ts(e),{tag:s}=t;if("meta-concept"===e.type){let t=this.model.getProjectionSchema(e.concept,is(s))[0],i=t.type,n={type:i,[i]:t.content||t.projection},r=kr.call(this,n,e.concept,{focusable:!1,meta:e.name});r.dataset.type="meta-concept",r.dataset.value=e.name;const a=this.projection.resolveElement(r).schema.coordinates;r.setAttribute("x",a.x),r.setAttribute("y",a.y),this.bindEvent(r),this.selection.append(r),this.items.set(e.id,r)}else if(i){if(!this.model.hasProjectionSchema(e,s))return container;let t=this.model.createProjection(e,s).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection;let i=t.render();const n=t.element.schema.coordinates;i.setAttribute("x",n.x),i.setAttribute("y",n.y),this.bindEvent(i),this.selection.append(i),this.items.set(e.id,i)}}))},focusIn(){this.opened||this.element.append(this.openBack)},focusOut(){this.opened||this.openBack.remove()},registerDimensionsObserver(e){Yi(this.observers)&&(this.observers=[]),this.observers.push(e)},notifyDimObservers(){Yi(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))},bindEvent(e){e.addEventListener("click",(()=>{const t=ss.call(this,e);this.setValue(t),this.selection.remove(),this.element.append(this.openBack)}))}},rs=Object.assign(Object.create(Ft),ns),{isNull:as,isNullOrUndefined:os}=s(835),ls={init(){return this},render(){const{order:e,dimensions:t=!1}=this.schema;if(os(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.element.dataset.id=this.id,this.element.dataset.nature="field",this.element.dataset.view="svg-switch",this.element.id=this.id,this.element.classList.add("field"),this.element.classList.add("field--svg_choice")),t&&(this.element.setAttribute("width",t.width),this.element.setAttribute("height",t.height)),os(this.index)&&(this.index=0),this.order=e,this.source.hasValue())for(let e=0;e<this.order.length;e++)if(this.order[e]===this.source.value){this.index=e;break}return this.bindEvents(),this.element},clickHandler(){this.index=(this.index+1)%this.order.length,this.source.setValue(this.order[this.index])},registerDimensionsObserver(e){},focusIn(){},focusOut(){},bindEvents(){}},cs=Object.assign(Object.create(Ft),ls),hs={binary:(e,t,i)=>Object.create(Zt,{object:{value:"field"},name:{value:"binary-field"},type:{value:"binary"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),choice:(e,t,i)=>Object.create(ri,{object:{value:"field"},name:{value:"choice-field"},type:{value:"choice"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),list:(e,t,i)=>Object.create(mi,{object:{value:"field"},name:{value:"list-field"},type:{value:"list"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),table:(e,t,i)=>Object.create(xi,{object:{value:"field"},name:{value:"table-field"},type:{value:"table"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),text:(e,t,i)=>Object.create(Si,{object:{value:"field"},name:{value:"text-field"},type:{value:"text"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),interactive:(e,t,i)=>Object.create(ci,{object:{value:"field"},name:{value:"interactive-field"},type:{value:"interactive"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),static:(e,t,i)=>Object.create(gi,{object:{value:"field"},name:{value:"static-field"},type:{value:"static"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),dynamic:(e,t,i)=>Object.create(oi,{object:{value:"field"},name:{value:"dynamic-field"},type:{value:"dynamic"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),add:(e,t,i)=>Object.create(Wt,{object:{value:"field"},name:{value:"add-field"},type:{value:"add"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),arrow:(e,t,i)=>Object.create(Ii,{object:{value:"field"},name:{value:"arrow"},type:{value:"arrow"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),svg:(e,t,i)=>Object.create(Ui,{object:{value:"field"},name:{value:"svg"},type:{value:"svg"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),"svg-choice":(e,t,i)=>Object.create(Ki,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),"svg-placeholder":(e,t,i)=>Object.create(rs,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),"svg-switch":(e,t,i)=>Object.create(cs,{object:{value:"field"},name:{value:"switch"},type:{value:"switch"},id:{value:ds()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}})};var us=0;const ds=()=>"field"+us++,ps={createField(e,t,i){const{type:s}=t,r=hs[s];if((0,n.isNullOrUndefined)(r))throw new Error(`Missing handler: The '${s}' field could not be handled`);var a=r(e,t,i);if((0,n.isNullOrUndefined)(a))throw new Error(`Bad request: The '${s}' field could not be created`);return a.errors=[],a.readonly=(0,n.valOrDefault)(t.readonly,!1),(0,n.isNullOrUndefined)(a.id)&&(a.id=ds()),a}},ms={init(){throw new Error("This function has not been implemented")},element:null,children:null,statusElement:null,attached:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasAttached(){return!(0,n.isEmpty)(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return(0,n.isFunction)(e)?this.attached.filter((t=>e(t))):this.attached},show(){return u(this.element),this.visible=!0,this.active=!0,this},hide(){return d(this.element),this.visible=!1,this},toggle(){return p(this.container),this.visible=!this.visible,this},focus(){return this.element.focus(),this.focused=!0,this.active=!0,this},_focusIn:e=>!1,navigate(e,t,i){return this.focusable?(this.element.focus(),!0):this.parent.arrowHandler(e,this.element)},clear:()=>!0,delete(){this.environment.notify("This element cannot be removed",y.WARNING,1500),m(this.element)},spaceHandler(e){return this.arrowHandler("right",e)},_spaceHandler(e){return this.environment.notify("Nothing do here.",y.NORMAL,1500),!1},escapeHandler(e){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));return this.projection.resolveElement(t).focus(t),!0},enterHandler(e){this.element.click()},deleteHandler(e){return this.environment.notify("This element cannot be removed",y.WARNING,1500),m(this.element),!1},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,t)},clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler:e=>(console.warn("CONTROL NOT IMPLEMENTED"),!1)},fs=Object.assign(ms),gs={init(){return this.children=[],this},render(){const e=(0,n.createDocFragment)(),{help:t,style:i,content:s}=this.schema;return(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createAudio)({class:["static","audio-static"],src:s,dataset:{nature:"static",static:"audio",id:this.id,ignore:"all"}})),(0,n.isNullOrUndefined)(t)||(this.element.title=t),St.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},bindEvents(){}},bs=Object.assign(Object.create(fs),gs);function vs(e,t){let i=e.param.find((e=>e.name===t));if((0,n.isNullOrUndefined)(i))return;const{type:s="string",value:r}=i;let a=(0,n.valOrDefault)(r,i.default);return(0,n.isNullOrUndefined)(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}function ys(e){if((0,n.isNullOrUndefined)(e))return"";const{type:t}=e;return"property"===t?(this.hasProperty=!0,(0,n.valOrDefault)(this.source.getProperty(e.name),"")):"param"===t?vs.call(this,this.schema.template,e.name):"raw"===t?(0,n.htmlToElement)(e.raw):e}function ws(e){return(0,n.isNullOrWhitespace)(e)?"":e.startsWith("http://")||e.startsWith("https://")?new URL(e).href:ws(`https://${e}`)}const xs={url:null,alt:null,width:null,height:null,init(){const{url:e,width:t,height:i,alt:s}=this.schema;return this.width=t,this.height=i,this.alt=s,this},render(){let e=!1;const{help:t,style:i,url:s}=this.schema;return this.url=ws(ys.call(this,s)),(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createImage)({class:["static","image-static"],src:this.url,alt:this.alt,dataset:{nature:"static",static:"image",id:this.id,ignore:"all"}}),e=!0),(0,n.isNullOrUndefined)(this.width)||isNaN(this.width)||(this.element.width=this.width),(0,n.isNullOrUndefined)(this.height)||isNaN(this.height)||(this.element.height=this.height),(0,n.isNullOrUndefined)(t)||(this.element.title=t),St.call(this.projection,this.element,i),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return(0,n.isNullOrWhitespace)(this.url)?this.element.classList.add("empty"):this.element.classList.remove("empty"),this},update(){const{url:e}=this.schema;return this.url=ws(ys.call(this,e)),this.element.src=this.url,this.refresh(),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},Es=Object.assign(Object.create(fs),xs),As={email:e=>`mailto:${e}`,phone:e=>`tel:${e}`,link:e=>`${e}`,url:e=>`${e}`};function Os(e,t){let i=e.param.find((e=>e.name===t));if((0,n.isNullOrUndefined)(i))return;const{type:s="string",value:r}=i;let a=(0,n.valOrDefault)(r,i.default);return(0,n.isNullOrUndefined)(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}function Ns(e){if((0,n.isNullOrUndefined)(e))return"";const{type:t}=e;return"property"===t?(this.hasProperty=!0,(0,n.valOrDefault)(this.source.getProperty(e.name),"")):"param"===t?Os.call(this,this.schema.template,e.name):"raw"===t?(0,n.htmlToElement)(e.raw):e}const ks={url:null,urlType:null,href:null,hrefHandler:null,content:null,init(){const{content:e=[],urlType:t="link"}=this.schema;if(this.content=e,this.urlType=t,this.children=[],this.hrefHandler=As[this.urlType],!(0,n.isFunction)(this.hrefHandler))throw new TypeError("type not handled");return this},render(){let e=!1;const t=(0,n.createDocFragment)(),{help:i,style:s,url:r}=this.schema;return this.href=this.hrefHandler(Ns.call(this,r)),(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createAnchor)({class:["static","link"],href:this.href,dataset:{nature:"static",static:"link",id:this.id,ignore:"all"}}),"link"===this.urlType&&(this.element.target="_blank"),e=!0),this.content.forEach((e=>{let i=kr.call(this,e,this.projection.concept,{focusable:!1});t.append(i)})),(0,n.isNullOrUndefined)(i)||(this.element.title=i),St.call(this.projection,this.element,s),t.hasChildNodes()&&this.element.append(t),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},update(){const{url:e}=this.schema;return this.element.href=this.hrefHandler(Ns.call(this,e)),(0,n.removeChildren)(this.element),this.content.forEach((e=>{this.element.append(kr.call(this,e,this.projection.concept,{focusable:!1}))})),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},js=Object.assign(Object.create(fs),ks);function Ls(e,t){let i=e.param.find((e=>e.name===t));if((0,n.isNullOrUndefined)(i))return;const{type:s="string",value:r}=i;let a=(0,n.valOrDefault)(r,i.default);return(0,n.isNullOrUndefined)(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}function Ss(e){if((0,n.isNullOrUndefined)(e))return"";const{type:t}=e;return"property"===t?(this.hasProperty=!0,(0,n.valOrDefault)(this.source.getProperty(e.name),"")):"param"===t?Ls.call(this,this.schema.template,e.name):"html"===t?(0,n.htmlToElement)(e.html):"raw"===t?(0,n.htmlToElement)(e.raw):e}const Cs={editable:null,focusable:null,hasProperty:!1,asHTML:!1,init(e={}){Object.assign(this.schema,e);const{content:t,editable:i=!1,focusable:s=!1}=this.schema;return this.children=[],this._content=t,this.editable=i,this.focusable=s,this},render(){let e=!1;const{content:t,help:i,style:s}=this.schema;if(!(0,n.isHTMLElement)(this.element)){if(this.element=(0,n.createSpan)({class:["text","static","text-static"],editable:this.editable,dataset:{nature:"static",view:"text",static:"text",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0),Array.isArray(t))t.forEach((e=>{let t=Ss.call(this,e),i=(0,n.createSpan)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",content:t,id:this.id,ignore:"all"}},t);St.call(this.projection,i,e.style),this.element.append(i)}));else{let e=Ss.call(this,t);this.element.append(e),this.element.content=e}e=!0}return(0,n.isNullOrUndefined)(i)||(this.element.title=i),St.call(this.projection,this.element,s),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},getLength(){return this.element.textContent.length},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){if(!this.editable&&this.parent)return this.parent.arrowHandler(e,t);if("right"===e){if(this.getLength()<r(this.element)+1&&this.parent)return this.parent.arrowHandler(e,t)}else if("left"===e){if(0===r(this.element)&&this.parent)return this.parent.arrowHandler(e,t)}else if(this.parent)return this.parent.arrowHandler(e,t);return!1},escapeHandler(e){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));this.projection.resolveElement(t).focus(t)},update(){const{content:e}=this.schema;return(0,n.removeChildren)(this.element),Array.isArray(e)?e.forEach((e=>{this.element.append((0,n.createSpan)({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",id:this.id,ignore:"all"}},Ss.call(this,e)))})):this.element.append(Ss.call(this,e)),this},refresh(){return this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},Ts=Object.assign(Object.create(fs),Cs),Is={contentType:null,editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.children=[],this.focusable=t,this},render(){const e=(0,n.createDocFragment)(),{help:t,style:i,content:s}=this.schema;return(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createButton)({class:["btn","static"],dataset:{nature:"static",view:"plink",static:"plink",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),s.forEach((t=>{let i=kr.call(this,t,this.projection.concept,{focusable:!1});e.append(i)})),(0,n.isNullOrUndefined)(t)||(this.element.title=t),St.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(e){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));this.environment.resolveElement(t).focus(t)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){let t=this.projection.findView(this.schema.tag);return-1===t||this.projection.changeView(t),!1},refresh(){return this},bindEvents(){}},Ms=Object.assign(Object.create(fs),Is),Us={template:null,selector:null,content:null,init(){return this.selector=this.schema.selector,this.template=(0,n.getTemplate)(this.selector),this},render(){const{style:e,content:t}=this.schema;return(0,n.isNode)(this.element)||(this.element=(0,n.cloneTemplate)(this.template)),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},Ds=Object.assign(Object.create(fs),Us);function _s(e,t){let i=e.param.find((e=>e.name===t));if((0,n.isNullOrUndefined)(i))return;const{type:s="string",value:r}=i;let a=(0,n.valOrDefault)(r,i.default);return(0,n.isNullOrUndefined)(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}const Bs={contentType:null,editable:null,focusable:null,disabled:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0,disabled:i=!1}=this.schema;return this.children=[],this.focusable=t,this.disabled=i,this},render(){const e=(0,n.createDocFragment)(),{help:t,style:i,content:s}=this.schema;return(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createButton)({class:["btn","static"],dataset:{nature:"static",view:"button",static:"button",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),s.forEach((t=>{let i=kr.call(this,t,this.projection.concept,{template:this.schema.template,focusable:!1});e.append(i)})),(0,n.isNullOrUndefined)(t)||(this.element.title=t),St.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(e){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));this.environment.resolveElement(t).focus(t)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){let t=this.source;if(this.schema.bind&&(t=this.source.getValue(!0)),this.schema.action){const{type:e,value:i,target:s}=this.schema.action;if((0,n.isObject)(i))for(const e in i){const t=i[e];"param"===t.type&&(i[e]=_s.call(this,this.schema.template,t.name))}switch(e){case"CREATE":(0,n.isNullOrUndefined)(s)?t.createElement():"attribute"===s.type&&t.getAttribute(s.name).target.createElement({value:i});break;case"SELECT":if((0,n.isNullOrUndefined)(s)&&t.createElement(),(0,n.isObject)(i))for(const e in i){const t=i[e];"param"===t.type&&(i[e]=_s.call(this,this.schema.template,t.name))}"attribute"===s.type&&t.getAttribute(s.name).target.setValue((0,n.valOrDefault)(i.name,i)),"bind"===s.type&&t.setValue((0,n.valOrDefault)(i.name,i));break;case"CREATES":if((0,n.isNullOrUndefined)(s)&&t.createElement(),(0,n.isObject)(i))for(const e in i){const t=i[e];"param"===t.type&&(i[e]=_s.call(this,this.schema.template,t.name))}"attribute"===s.type&&t.getAttribute(s.name).target.createElement().getAttribute(s.attribute).target.setValue((0,n.valOrDefault)(i.name,i));break;case"SIDE":let e=this.environment.createProjection(t,s),r=this.environment.findWindow("side-instance");(0,n.isNullOrUndefined)(r)&&(r=this.environment.createWindow("side-instance"),r.container.classList.add("model-projection-sideview")),r.instances.size>0&&Array.from(r.instances)[0].delete();let a=this.environment.createInstance(t,e,{type:"projection",close:"DELETE-PROJECTION"});r.addInstance(a)}return!1}return this.environment.triggerEvent({name:this.schema.trigger,args:[t]}),!1},refresh(){return this},bindEvents(){}},Ps=Object.assign(Object.create(fs),Bs),Hs={editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.focusable=t,this},render(){(0,n.createDocFragment)();const{help:e,style:t,content:i,external:s=!0,tag:r}=this.schema,a=new DOMParser;return(0,n.isHTMLElement)(this.element)||(this.element=a.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.element.classList.add(["btn","static"]),this.element.dataset.nature="static",this.element.dataset.view="svg-alt",this.element.dataset.id=this.id,this.element.dataset.ignore="all",this.focusable&&(this.element.tabIndex=0)),(0,n.isNullOrUndefined)(e)||(this.element.title=e),this.refresh(),this.bindEvents(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(d(this.messageElement),(0,n.removeChildren)(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(e){let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex));this.environment.resolveElement(t).focus(t)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){},refresh(){return this},bindEvents(){this.element.addEventListener("click",(()=>{let e=this.source,t=this.environment.createProjection(e,this.schema.tag),i=this.environment.findWindow("side-instance");(0,n.isNullOrUndefined)(i)&&(i=this.environment.createWindow("side-instance"),i.container.classList.add("model-projection-sideview")),i.instances.size>0&&Array.from(i.instances)[0].delete();let s=this.environment.createInstance(e,t,{type:"projection",close:"DELETE-PROJECTION"});i.addInstance(s)}))}},Vs=Object.assign(Object.create(fs),Hs),Rs={CREATE:function(e,t){this.source.createElement(t)},DELETE:$s,EXTRACT:function(e,t){let i=this.projection.environment.actions.get("extract-instance")("graphical").getAttribute("shape").target.getAttribute("elements").target.createElement();i.setValue(this.source.name),Fs.call(this,i.getValue(!0)),qs.call(this,i.getValue(!0)),$s.call(this)},SIDE:function(e,t){let i=this.environment.createProjection(this.source,e),s=this.environment.findWindow("side-instance");(0,n.isNullOrUndefined)(s)&&(s=this.environment.createWindow("side-instance"),s.container.classList.add("model-projection-sideview")),s.instances.size>0&&Array.from(s.instances)[0].delete();let r=this.environment.createInstance(this.source,i,{type:"projection",close:"DELETE-PROJECTION"});s.addInstance(r)},OPEN:function(e){(0,n.isNullOrUndefined)(this.target)&&(this.target=e),this.target.open()}};function $s(e,t){"prototype"!==this.source.parent.schema.nature?this.source.delete():this.source.parent.delete()}function Fs(e){switch(this.source.name){case"circle":e.getAttributeByName("cx").target.setValue(this.source.getAttributeByName("cx").target.value),e.getAttributeByName("cy").target.setValue(this.source.getAttributeByName("cy").target.value),e.getAttributeByName("r").target.setValue(this.source.getAttributeByName("r").target.value);break;case"ellipse":e.getAttributeByName("cx").target.setValue(this.source.getAttributeByName("cx").target.value),e.getAttributeByName("cy").target.setValue(this.source.getAttributeByName("cy").target.value),e.getAttributeByName("rx").target.setValue(this.source.getAttributeByName("rx").target.value),e.getAttributeByName("ry").target.setValue(this.source.getAttributeByName("ry").target.value);break;case"rectangle":e.getAttributeByName("x").target.setValue(this.source.getAttributeByName("x").target.value),e.getAttributeByName("y").target.setValue(this.source.getAttributeByName("y").target.value),e.getAttributeByName("width").target.setValue(this.source.getAttributeByName("width").target.value),e.getAttributeByName("height").target.setValue(this.source.getAttributeByName("height").target.value);break;case"polygon":e.getAttributeByName("points").target.setValue(this.source.getAttributeByName("points").target.value);break;case"path":e.getAttributeByName("d").target.setValue(this.source.getAttributeByName("d").target.value)}}function qs(e){const t=e.getAttributeByName("style").target,i=this.source.getAttributeByName("style").target;t.getAttributeByName("fill").target.setValue(i.getAttributeByName("fill").target.value),t.getAttributeByName("stroke").target.setValue(i.getAttributeByName("stroke").target.value),t.getAttributeByName("s-width").target.setValue(i.getAttributeByName("s-width").target.value),t.getAttributeByName("s-dash").target.setValue(i.getAttributeByName("s-dash").target.value),t.getAttributeByName("rx").target.setValue(i.getAttributeByName("rx").target.value),t.getAttributeByName("ry").target.setValue(i.getAttributeByName("ry").target.value)}const zs={init(){return this},render(){const{action:e,content:t}=this.schema;if((0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="static",this.container.dataset.algorithm="button",this.container.dataset.id=this.id),t&&(0,n.isNullOrUndefined)(this.content)&&this.createContent(t),this.schema.dimensions){const{width:e,height:t}=this.schema.dimensions;this.container.setAttribute("width",e),this.container.setAttribute("height",t)}return this.container.style.width="fit-content",this.container},createContent(e){const t=new DOMParser;this.content=t.parseFromString(e.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.content),this.content.addEventListener("click",(()=>{const{type:e,target:t,value:i}=this.schema.action;console.log("target"),console.log(t),console.log(this.schema.action),Rs[e].call(this,t,i)}))},focusIn(){},focusOut(){}},Ws=Object.assign({},fs,zs),Ks={init(){return this},render(){const e=new DOMParser,{content:t}=this.schema;return(0,n.isNullOrUndefined)(this.element)&&(this.element=e.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.element},focusIn(){},focusOut(){},clickHandler(e){}},Xs=Object.assign(Object.create(fs),Ks),Ys={init(){return this},render(){new DOMParser;const{content:e,style:t}=this.schema;return(0,n.isNullOrUndefined)(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","text"),this.element.textContent=e),this.style(),this.element},style(){const{font:e,size:t,anchor:i="left",weight:s,baseline:n}=this.schema.style;this.element.setAttribute("text-anchor",i),this.element.setAttribute("font-family",e),this.element.setAttribute("font-size",t),this.element.style["dominant-baseline"]=n,s&&this.element.setAttribute("font-weight",s)},focusIn(){},focusOut(){},clickHandler(e){}},Js=Object.assign(Object.create(fs),Ys);var Gs=0;const Qs=()=>"static"+Gs++,Zs={audio:(e,t,i)=>Object.create(bs,{object:{value:"static"},name:{value:"audio-static"},type:{value:"audio"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),plink:(e,t,i)=>Object.create(Ms,{object:{value:"static"},name:{value:"plink-static"},type:{value:"plink"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),image:(e,t,i)=>Object.create(Es,{object:{value:"static"},name:{value:"image-static"},type:{value:"image"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),link:(e,t,i)=>Object.create(js,{object:{value:"field"},name:{value:"link-static"},type:{value:"link"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),text:(e,t,i)=>Object.create(Ts,{object:{value:"static"},name:{value:"text-static"},type:{value:"text"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),html:(e,t,i)=>Object.create(Ds,{object:{value:"static"},name:{value:"html-static"},type:{value:"html"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),button:(e,t,i)=>Object.create(Ps,{object:{value:"static"},name:{value:"button-static"},type:{value:"button"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),"svg-alt":(e,t,i)=>Object.create(Vs,{object:{value:"static"},name:{value:"svg-static"},type:{value:"svgAlt"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),"svg-button":(e,t,i)=>Object.create(Ws,{object:{value:"static"},name:{value:"svg-button"},type:{value:"svgButton"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),svg:(e,t,i)=>Object.create(Xs,{object:{value:"static"},name:{value:"svg-static"},type:{value:"svg"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}}),"svg-text":(e,t,i)=>Object.create(Js,{object:{value:"static"},name:{value:"svgText-static"},type:{value:"svgText"},id:{value:Qs()},model:{value:e},schema:{value:t},projection:{value:i}})},en={createStatic(e,t,i){const{type:s}=t,r=Zs[s];if((0,n.isNullOrUndefined)(r))throw new Error(`Missing handler: The '${s}' static could not be handled`);var a=r(e,t,i);if((0,n.isNullOrUndefined)(a))throw new Error(`Bad request: The '${s}' static could not be created`);return(0,n.isNullOrUndefined)(a.id)&&(a.id=Qs()),a}},tn={focusable:null,readonly:!1,visible:!1,editable:!1,active:!1,container:null,elements:null,children:null,editing:!1,getStyle(){return this.schema.style},setStyle(e){return this.schema.style=e,St.call(this.projection,this.container,e),this.refresh(),!0},getContainer(){return this.container},isRoot(){return(0,n.isNullOrUndefined)(this.parent)},getField(e){return this.projection.getField(e)},getStatic(e){return this.projection.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},show(){return u(this.element),this.visible=!0,this.active=!0,this},hide(){return d(this.element),this.visible=!1,this},toggle(){return p(this.container),this.visible=!this.visible,this},_focusIn:e=>!1,spaceHandler(e){return e===this.container&&!(0,n.isNullOrUndefined)(this.parent)&&this.parent.spaceHandler(this.container)},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){if(this.isRoot())return!1;let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return!(0,n.isNullOrUndefined)(i)&&(i.focus(t),!0)},enterHandler(e){let t=(0,n.getElement)('[tabindex]:not([tabindex="-1"])',this.container),i=this.environment.resolveElement(t);return!(0,n.isNullOrUndefined)(i)&&(i.focus(),!0)},delete(){var e=this.source.delete();e.success||this.environment.notify(e.message)},deleteHandler(e){if(this.projection.element!==this)return!1;if(!this.projection.optional)return m(this.container),!1;let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex)),i=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),i),this.source.delete();let s=this.environment.resolveElement(t);return(0,n.isNullOrUndefined)(s)||s.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){if(t===this.container)return!(0,n.isNullOrUndefined)(this.parent)&&this.parent.arrowHandler(e,this.container);let i=T(t,e,this.container);if(!(0,n.isHTMLElement)(i))return!(0,n.isNullOrUndefined)(this.parent)&&"layout"===this.parent.object&&this.parent.arrowHandler(e,this.container);let s=this.environment.resolveElement(i);return s&&((0,n.isFunction)(s.navigate)?s.navigate(e):s.focus()),!0},shiftHandler(e,t){if("up"===e){let e=k(window.getComputedStyle(this.container).marginTop);this.container.style.marginTop=`${e+1}px`}return!0},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()}},sn={ROW:"row",COLUMN:"column"},nn={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},rn={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"};var an=0;function on(e,t,i){return Object.create(cn,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:"layout"+an++},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})}const ln={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema,{orientation:s=sn.ROW,wrappable:n=!0,alignItems:r,justifyContent:a}=this.schema.layout;return this.orientation=s,this.wrappable=n,this.alignItems=r,this.justifyContent=a,this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){(0,n.hasOwn)(sn,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=(0,n.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let t=(0,n.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{label:e,content:t,style:i,help:s}=this.schema,r=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),s&&(this.container.title=s);for(let e=0;e<t.length;e++){let i=kr.call(this,t[e],null,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),r.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",St.call(this.projection,this.container,i),r.hasChildNodes()&&(this.container.append(r),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=rn[this.justifyContent],this.container.style.alignItems=nn[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,n.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,n.isNullOrUndefined)(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},cn=Object.assign({},tn,ln),hn={clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},getContainer(){return this.container},getWidth(){return this.width},getHeight(){return this.height},setViewBox(e){this.container.setAttribute("viewBox",e),this.notifyObsevers()},setWidth(e){this.width=e,this.container.setAttribute("width",e),this.notifyObsevers()},setWidth(e){this.height=e,this.container.setAttribute("height",e),this.notifyObsevers()},notifyDimObservers(){(0,n.isNullOrUndefined)(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))},registerDimensionsObserver(e){(0,n.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(e)},setInteraction(e){(0,n.isNullOrUndefined)(this.items)||((0,n.isNullOrUndefined)(this.warnings)&&(this.warnings=[]),this.warnings.push(e),this.items.forEach((t=>{this.projection.resolveElement(t.render).warn(e)})))},checkAugment(e,t){if(!(0,n.isNullOrUndefined)(this.background))if(e.x+Number(t.getAttribute("x"))>Number(this.background.getAttribute("x"))+Number(this.background.getAttribute("width"))||e.y+Number(t.getAttribute("y"))>Number(this.background.getAttribute("y"))+Number(this.background.getAttribute("height"))){let i=this.background.querySelector("[data-augment]");const s=Number(i.getAttribute("y")),n=e.y+Number(t.getAttribute("y"));i.setAttribute("height",n-s)}else if(e.y+Number(t.getAttribute("y"))<Number(this.background.getAttribute("y"))+Number(this.background.getAttribute("height"))){let i=this.background.querySelector("[data-augment]");const s=Number(i.getAttribute("y")),n=e.y+Number(t.getAttribute("y"));i.setAttribute("height",n-s)}},createDelete(){const{type:e}=this.schema.rmv;if("bind"===e){this.deleteMap=new Map;let e=0;this.schema.rmv.bind.forEach((t=>{e++;const{alias:i,focus:s,coordinates:n,content:r}=t;let a=(new DOMParser).parseFromString(r.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement;a.dataset.nature="static",a.dataset.algorithm="button",a.setAttribute("x",n.x),a.setAttribute("y",n.y),a.addEventListener("click",(()=>{this.source.delete()})),this.deleteMap.set(i,a)})),this.projection.registerHandler("value.changed",(e=>{(0,n.isNullOrUndefined)(this.deleteElem)||this.deleteElem.remove(),this.deleteMap.get("default").remove();const t=e.name||e;let i=this.deleteMap.get(t);if(!i.dataset.focusable||this.focused)return(0,n.isNullOrUndefined)(i)?(this.container.append(this.deleteMap.get("default")),void(this.deleteElem=this.deleteMap.get("default"))):(this.container.append(i),void(this.deleteElem=i));this.deleteElem=i})),this.source.hasValue()?(this.container.append(this.deleteMap.get(this.source.value)),this.deleteElem=this.deleteMap.get(this.source.value)):(this.container.append(this.deleteMap.get("default")),this.deleteElem=this.deleteMap.get("default"))}else{const{focus:e,coordinates:t,dimensions:i,render:s}=this.schema.rmv;let n=kr.call(this,s);n.setAttribute("x",t.x),n.setAttribute("y",t.y),this.container.append(n),n.addEventListener("click",(()=>{this.source.delete()})),e&&(this.rmv=n)}},findItem(e){for(let t=0;t<this.items.length;t++)if(this.items[t].render.dataset.concept===e)return this.items[t]},findAncestor(e){for(let t=0;t<this.items.length;t++)if(this.items[t].render.contains(e))return this.items[t]},findAnchorIndex(e){for(let t=0;t<this.items.length;t++)if(this.items[t].render===e)return this.items[t].index},findAnchorIndex(e){return this.anchors.indexes[e]}},un={init(){const{dimensions:e={}}=this.schema;return this.ratio=.4,this.width=(0,n.valOrDefault)(e.width,500),this.height=(0,n.valOrDefault)(e.height,500),this.buttons=[],this.dummies=[],this.transLink=[],this.transLinkId=[],this.arrowInventory=[],this.linkInventory=new Map,this},render(){const{dimensions:e,style:t}=this.schema,i=(0,n.createDocFragment)();return(0,n.isNullOrUndefined)(this.instances)&&(this.instances=new Map),(0,n.isNullOrUndefined)(this.holders)&&(this.holders=new Map),(0,n.isHTMLElement)(this.container)||(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="force",this.container.dataset.id=this.id,this.container.tabindex=1,this.container.id=this.id),e&&(this.container.setAttribute("width",e.width),this.container.setAttribute("height",e.height)),this.focusable=!0,(0,n.isHTMLElement)(this.ids)||(this.ids=[]),i.hasChildNodes()&&this.container.append(i),t&&(this.container.style=t),(0,n.isNullOrUndefined)(this.content)&&(this.content=[]),this.bindEvents(),this.container},setUpForce(){const{intensity:e,linkval:t}=this.schema.force;this.force=d3.layout.force().size([this.width,this.height]).nodes([]).links([]).linkDistance(t).charge(e).on("tick",this.ticked.bind(this));var i=d3.select("#"+this.id);this.nodes=this.force.nodes(),this.node=i.selectAll("svg"),this.links=this.force.links(),this.link=i.selectAll(".link"+this.id),this.force.start()},restart(){let e=d3.select("#"+this.id);this.node=e.selectAll(".node"+this.id).data(this.nodes),(0,n.isNullOrUndefined)(this.links)||(this.link=e.selectAll(".link"+this.id).data(this.links)),this.force.start()},addItem(e){(0,n.isNullOrUndefined)(this.force)&&this.setUpForce(this.width,this.height,this.intensity,this.direction),"prototype"===e.schema.nature&&(e.register(this.projection),this.projection.registerHandler("value.changed",(t=>{if(e.hasValue())for(let t=0;t<this.nodes.length;t++)this.nodes[t].concept===e.id&&(this.nodes[t].meta=this.nodes[t].concept,this.nodes[t].concept=e.getValue(!0).id)})));let t=this.createItem(e,this.schema.tag);t.classList.add("node"+this.id),this.container.append(t);let i=this.projection.resolveElement(t);if(i.projection.update("displayed"),i.registerDimensionsObserver(this),this.content.push(i),"prototype"===e.schema.nature)if(e.force)e.force.index=this.nodes.length,e.force.id=i.id,this.nodes.push(e.force),e.force=this.nodes[this.nodes.length-1];else{const t={nbLink:0,points:[],width:i.width,height:i.height,id:i.id,concept:e.id};this.nodes.push(t),e.force=t}else if(e.force)e.force.index=this.nodes.length,e.force.id=i.id,this.nodes.push(e.force),e.force=this.nodes[this.nodes.length-1];else{const s={nbLink:0,points:[],width:i.width,height:i.height,id:i.id,concept:e.id,shape:this.computeShape(t)};this.nodes.push(s),e.force=s}t.getBoundingClientRect(),this.restart()},checkForContent(e,t){const i=this.findIndex(e),s=this.findIndex(t);return i>=0&&s>=0},addArrow(e,t,i){if((0,n.isNullOrUndefined)(this.force)&&this.setUpForce(),(0,n.isNullOrUndefined)(this.links)&&(this.links=this.force.links()),this.containsArrow(e,t,i))return;this.containsTransArrow(e,t,i),this.force.stop();const s=t.id||t,r=i.id||i,a=this.findIndex(s),o=this.findIndex(r);if(a<0||o<0){let s=this.environment.getReceivers(this.projection.rtag);for(let n=0;n<s.length;n++)if(s[n].checkForContent(t,i))return e.projection.parent=s[n],void s[n].addArrow(e,t,i);return this.environment.getRootReceiver(this.projection.rtag).addTransLink(e,t,i),void this.restart()}let l=this.linkInventory.get(a+","+o);(0,n.isNullOrUndefined)(l)?(this.linkInventory.set(a+","+o,{length:1}),this.links.push({source:a,target:o,id:e.id,indexL:1})):(l.length++,this.links.push({source:a,target:o,id:e.id,indexL:l.length})),e.path.classList.add("link"+this.id),this.container.append(e.path),e.definitions&&this.container.append(e.definitions),this.addDummy(e,e.decorator,this.links.length-1),this.restart()},addDummy(e,t=!1,i){if((0,n.isNullOrUndefined)(t)){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("node"+this.id),e.classList.add("dummy"),this.container.append(e)}else this.container.append(t),t.classList.add("node"+this.id),t.classList.add("dummy");const s=t.getBBox();this.nodes.push({dummy:!0,ref:i,fixed:!0,width:s.width,height:s.height})},addTransLink(e,t,i){e.projection.parent=this,(0,n.isNullOrUndefined)(this.transLinks)&&(this.transLinks=[]),this.transLinks.push({id:e.id,from:t.id||t,to:i.id||i,arrow:e}),this.container.append(e.path),e.definitions&&this.container.append(e.definitions),this.restart()},containsTransArrow(e,t,i){if(!(0,n.isNullOrUndefined)(this.transLinks))for(let t=0;t<this.transLinks.length;t++)if(this.transLinks[t].id===e.id)return void this.transLinks.splice(t,1)},containsArrow(e,t,i){for(let s=0;s<this.links.length;s++)if(this.links[s].id===e.id){const r=t.id||t,a=i.id||i,o=this.findIndex(r),l=this.findIndex(a);if(o<0||l<0)this.removeArrow(e,s),this.addTransLink(e,t,i);else{let e=this.links[s].source.index,t=this.links[s].target.index;if(!(0,n.isNullOrUndefined)(this.linkInventory.get(e+","+t))){let i=this.linkInventory.get(e+","+t);i.length--,i.length<=0&&this.linkInventory.delete(e+","+t)}this.links[s].source=o,this.links[s].target=l,(0,n.isNullOrUndefined)(this.linkInventory.get(o+","+l))?this.linkInventory.set(o+","+l,{length:1}):this.linkInventory.get(o+","+l).length++}return this.restart(),!0}return!1},removeArrow(e,t=-1,i,s){if((0,n.isNullOrUndefined)(this.links))return;let r=0;if(t>=0){if(!(0,n.isNullOrUndefined)(this.linkInventory.get(this.links[t].source.index+","+this.links[t].target.index))){let e=this.linkInventory.get(this.links[t].source.index+","+this.links[t].target.index);e.length--,0===e.length&&this.linkInventory.delete(this.links[t].source.index+","+this.links[t].target.index)}return this.links.splice(t,1),e.decorator&&(r=this.removeDummy(t),e.decorator.remove()),e.path.remove(),this.restart(),r}for(let t=0;t<this.links.length;t++)if(this.links[t].id===e.id){if(!(0,n.isNullOrUndefined)(this.linkInventory.get(this.links[t].source.index+","+this.links[t].target.index))){let e=this.linkInventory.get(this.links[t].source.index+","+this.links[t].target.index);e.length--,0===e.length&&this.linkInventory.delete(this.links[t].source.index+","+this.links[t].target.index)}return e.decorator&&(r=this.removeDummy(t),e.decorator.remove()),this.links.splice(t,1),e.path.remove(),void this.restart()}},findIndex(e){for(let t=0;t<this.nodes.length;t++)if(this.nodes[t].concept===e)return t;return-1},createItem(e,t){t.item;const i=this.schema.item;let s=this.model.createProjection(e,i);s.optional=!0,s.parent=this.projection;let n=s.init().render();return this.instances.set(s.element.source.id,n),n},removeItem(e){let t;for(this.force.stop(),t=0;t<this.nodes.length&&this.nodes[t].meta!==e.id&&this.nodes[t].concept!==e.id;t++);if((0,n.isNullOrUndefined)(this.links)||(0,n.isEmpty)(this.links))return this.nodes.splice(t,1),void this.restart();for(let e=0;e<this.links.length;e++){let i;if(this.links[e].source.index===t||this.links[e].target.index===t){let s=this.projection.model.getArrow(this.links[e].id);i=this.removeArrow(s,e,null,t),e--}(0,n.isNullOrUndefined)(this.links[e])||(this.links[e].source.index>t&&this.links[e].source.index--,this.links[e].target.index>t&&this.links[e].target.index--)}this.nodes.splice(t,1),this.restart()},removeDummy(e){for(let t=0;t<this.nodes.length;t++)this.nodes[t].ref===e&&(this.nodes.splice(t,1),t--),this.nodes[t].ref>e&&this.nodes[t].ref--},ticked(){let e=!0;for(;e&&!(0,n.isEmpty)(this.nodes);)this.nodes.forEach((t=>{this.nodes.forEach((i=>{e=this.collide(t,i)}))}));let t=this.links,i=this.container,s=this.linkInventory;const r=this.width,a=this.height;(0,n.isNullOrUndefined)(this.link)||this.link.attr("d",(function(e){if(e.source===e.target)return;const t=dn.computeBorder(e.source,e.target),i=dn.computeBorder(e.target,e.source);let n=i.x-t.x,r=i.y-t.y,a=Math.sqrt(n*n+r*r);e.dr=a,e.s=t,e.t=i;let o=s.get(e.source.index+","+e.target.index);return o.length>1&&(a/=1+1/o.length*(e.indexL-1)),"M"+i.x+","+i.y+"A"+a+","+a+" 0 0 1,"+t.x+","+t.y+"A"+a+","+a+" 0 0 0,"+i.x+","+i.y})),(0,n.isNullOrUndefined)(this.transLinks)||this.transLinks.forEach((e=>{const{arrow:t,id:s,from:r,to:a}=e,o=this.container.getBoundingClientRect();let l=this.container.querySelector("[data-concept='"+r+"']");(0,n.isNullOrUndefined)(l)&&(l=document.querySelector("[data-concept='"+r+"']"));let c=this.container.querySelector("[data-concept='"+a+"']");(0,n.isNullOrUndefined)(c)&&(c=document.querySelector("[data-concept='"+a+"']"));const h=l.getBoundingClientRect(),u=c.getBoundingClientRect(),d={x:h.x+h.width/2-o.x,y:h.y+h.height/2-o.y},p={x:u.x+u.width/2-o.x,y:u.y+u.height/2-o.y};d.shape=this.computeRelativeShape(i,l),p.shape=this.computeRelativeShape(i,c);const m=dn.computeBorder(d,p),f=dn.computeBorder(p,d),g=f.x-m.x,b=f.y-m.y,v=Math.sqrt(g*g+b*b);t.setPath("M"+f.x+","+f.y+"A"+v+","+v+" 0 0 1,"+m.x+","+m.y+"A"+v+","+v+" 0 0 0,"+f.x+","+f.y)})),this.node.attr("x",(function(e){if(!(0,n.isNullOrUndefined)(e.ref)){let r=t[e.ref].dr,a=s.get(t[e.ref].source.index+","+t[e.ref].target.index);a.length>1&&(r/=1+1/a.length*(t[e.ref].indexL-1));let o=dn.getEllipseCenter(r,t[e.ref].s,t[e.ref].t,i),l=dn.getPerpendicularLine(t[e.ref].s,t[e.ref].t),c=dn.getPointConstructedEllipse(l,r,r,o),h=dn.getCloserBorder(c,t[e.ref].t);return e.fx=h.x,(0,n.isNullOrUndefined)(e.width)?h.x:(e.fx=h.x-e.width/2,h.x-e.width/2)}return(e.x=Math.max(e.width/2,Math.min(r-e.width/2,e.x)))-e.width/2})).attr("y",(function(e){if(!(0,n.isNullOrUndefined)(e.ref)){let r=t[e.ref].dr,a=s.get(t[e.ref].source.index+","+t[e.ref].target.index);a.length>1&&(r/=1+1/a.length*(t[e.ref].indexL-1));let o=dn.getEllipseCenter(r,t[e.ref].s,t[e.ref].t,i),l=dn.getPerpendicularLine(t[e.ref].s,t[e.ref].t),c=dn.getPointConstructedEllipse(l,r,r,o),h=dn.getCloserBorder(c,t[e.ref].t);return e.fy=h.y,(0,n.isNullOrUndefined)(e.height)?h.y:h.y-e.height/2}return(e.y=Math.max(e.height/2,Math.min(a-e.height/2,e.y)))-e.height/2}))},analyseContentDim(){this.content.forEach((e=>{for(let t=0;t<this.nodes.length;t++)if(this.nodes[t].id===e.id){this.nodes[t].width=e.width,this.nodes[t].height=e.height,this.nodes[t].shape=this.computeShape(e.container||e.element);break}})),this.force.start()},computeRelativeShape(e,t){const i=t.querySelector("[data-shape]");if((0,n.isUndefined)(i))return;const s=e.getBoundingClientRect(),r=i.getBoundingClientRect(),a=t.getBoundingClientRect(),o=Number(e.getAttribute("width")),l=Number(e.getAttribute("height")),c={};c.width=o*r.width/s.width,c.height=l*r.height/s.height;const h=e.createSVGPoint();h.x=r.x,h.y=r.y;const u=h.matrixTransform(e.getScreenCTM().inverse());c.x=u.x,c.y=u.y;const d={};d.width=o*a.width/s.width,d.height=l*a.height/s.height;const p=e.createSVGPoint();p.x=r.x,p.y=r.y;const m=p.matrixTransform(e.getScreenCTM().inverse());let f;switch(d.x=m.x,d.y=m.y,i.tagName){case"circle":return{type:"circle",r:c.width/2};case"ellipse":return f=Number(i.getAttribute("width"))/r.width,a.width,f=Number(i.getAttribute("height"))/r.height,a.height,{type:"ellipse",rx:c.width/2,ry:c.height/2};default:f=Number(i.getAttribute("width"))/r.width;const e=a.width*f;return f=Number(i.getAttribute("height"))/r.height,{type:"rect",w:e,h:a.height*f}}},computeShape(e){const t=e.querySelector("[data-shape]");if((0,n.isNullOrUndefined)(t))return;const i=t.getBoundingClientRect(),s=e.getBoundingClientRect();let r;switch(t.tagName){case"circle":return r=Number(t.getAttribute("r"))/(i.width/2),{type:"circle",r:s.width*r/2};case"ellipse":r=Number(t.getAttribute("width"))/i.width;const e=s.width*r;return r=Number(t.getAttribute("height"))/i.height,{type:"ellipse",rx:e,ry:s.height*r};case"polygon":let n=t.getAttribute("data-points").split(" "),a=[];for(let e=0;e<n.length;e++)a.push({x:Number(n[e].split(",")[0])/i.width,y:Number(n[e].split(",")[1])/i.height});return{type:"polygon",points:a};default:r=Number(t.getAttribute("width"))/i.width;const o=s.width*r;return r=Number(t.getAttribute("height"))/i.height,{type:"rect",w:o,h:s.height*r}}},collide(e,t){let i=!1;const s=this.width,r=this.height;if(!(0,n.isNullOrUndefined)(e.ref)&&!(0,n.isNullOrUndefined)(t.ref))return i;if(!(0,n.isNullOrUndefined)(e.ref)){if(e.fx<t.x&&e.fy<t.y&&e.fx+e.width/2>t.x-t.width/2&&e.fy+e.height>t.x-t.height/2){let i=e.fx+e.width/2-(t.x-t.width/2),s=1.1*(e.fy+e.height/2-(t.y-t.height/2));switch(Math.min(i,s)){case i:t.x+=i;break;case s:t.y+=s}}else if(e.fx>t.x&&e.fy<t.y&&t.x+t.width/2>e.fx-e.width/2&&e.fy+e.height/2>t.y-t.height/2){let i=t.x+t.width/2-(e.fx-e.width/2),s=1.1*(e.fy+e.height/2-(t.y-t.height/2));switch(Math.min(i,s)){case i:t.x-=i;break;case s:t.y+=s}}else if(e.fx>t.x&&e.fy>t.y&&t.x+t.width/2>e.fx-e.width/2&&t.y+t.height/2>e.fy-e.height){let i=t.x+t.width/2-(e.fx-e.width/2),s=1.1*(t.y+t.height/2-(e.fy-e.height/2));switch(Math.min(i,s)){case i:t.x-=i;break;case s:t.y-=s}}else if(e.fx<t.x&&e.fy>t.y&&e.fx+e.width/2>t.x-t.width/2&&e.fy-e.height<t.y+t.height/2){let i=e.x+e.width-(t.x-t.width/2),s=1.1*(t.y+t.height/2-(e.y-e.height/2));switch(Math.min(i,s)){case i:t.x+=i;break;case s:t.y-=s}}return i}if(!(0,n.isNullOrUndefined)(t.ref)){if(e.x<t.fx&&e.y<t.fy&&e.x+e.width/2>t.fx-t.width/2&&e.y+e.height/2>t.fx-t.height/2){let i=e.x+e.width/2-(t.fx-t.width/2),s=1.1*(e.y+e.height/2-(t.fy-t.height/2));switch(Math.min(i,s)){case i:e.x-=i;break;case s:e.y-=s}}else if(e.x>t.fx&&e.y<t.fy&&t.fx+t.width/2>e.x-e.width/2&&e.y+e.height/2>t.fy-t.height/2){let i=t.fx+t.width/2-(e.x-e.width/2),s=1.1*(e.y+e.height/2-(t.fy-t.height/2));switch(Math.min(i,s)){case i:e.x+=i;break;case s:e.y-=s}}else if(e.x>t.fx&&e.y>t.fy&&t.fx+t.width/2>e.x-e.width/2&&t.fy+t.height/2>e.y-e.height/2){let i=t.fx+t.width/2-(e.x-e.width/2),s=1.1*(t.fy+t.height/2-(e.y-e.height/2));switch(Math.min(i,s)){case i:e.x+=i;break;case s:e.y+=s}}else if(e.x<t.fx&&e.y>t.fy&&e.x+e.width/2>t.fx-t.width/2&&e.y-e.height/2<t.fy+t.height/2){let i=e.x+e.width/2-(t.fx-t.width/2),s=1.1*(t.fy+t.height/2-(e.y-e.height/2));switch(Math.min(i,s)){case i:e.x-=i;break;case s:e.y+=s}}return i}if(t&&t!==e)if(e.x<=t.x&&e.y<=t.y&&e.x+e.width/2>=t.x-t.width/2&&e.y+e.height/2>=t.y-t.height/2){let i=e.x+e.width/2-(t.x-t.width/2),n=1.1*(e.y+e.height/2-(t.y-t.height/2));switch(Math.min(i,n)){case i:if(e.x-i/2<0){t.x+=i;break}if(t.x+i/2>s){e.x-=i;break}e.x-=i/2,t.x+=i/2;break;case n:if(e.y-n/2<0){t.x+=n;break}if(t.y+n/2>r){e.x-=n;break}e.y-=n/2,t.y+=n/2}}else if(e.x>t.x&&e.y<t.y&&t.x+t.width/2>e.x-e.width/2&&e.y+e.height/2>t.y-t.height/2){let i=t.x+t.width/2-(e.x-e.width/2),n=1.1*(e.y+e.height/2-(t.y-t.height/2));switch(Math.min(i,n)){case i:if(e.x+i/2>s){t.x-=i;break}if(t.x-i/2<0){e.x+=i;break}e.x+=i/2,t.x-=i/2;break;case n:if(e.y-n/2<0){t.x+=n;break}if(t.y+n/2>r){e.x-=n;break}e.y-=n/2,t.y+=n/2}}else if(e.x>t.x&&e.y>t.y&&t.x+t.width/2>e.x-e.width/2&&t.y+t.height/2>e.y-e.height/2){let i=t.x+t.width/2-(e.x-e.width/2),n=1.1*(t.y+t.height/2-(e.y-e.height/2));switch(Math.min(i,n)){case i:if(e.x+i/2>s){t.x-=i;break}if(t.x-i/2<0){e.x+=i;break}e.x+=i/2,t.x-=i/2;break;case n:if(e.y+n/2>r){t.y-=n;break}if(t.y-n/2<0){e.y+=n;break}e.y+=n/2,t.y-=n/2}}else if(e.x<t.x&&e.y>t.y&&e.x+e.width/2>t.x-t.width/2&&e.y-e.height/2<t.y+t.height/2){let i=e.x+e.width/2-(t.x-t.width/2),n=1.1*(t.y+t.height/2-(e.y-e.height/2));switch(Math.min(i,n)){case i:if(e.x-i/2<0){t.x+=i;break}if(t.x+i/2>s){e.x-=i;break}e.x-=i/2,t.x+=i/2;break;case n:if(e.y+n/2>r){t.y-=n;break}if(t.y-n/2<0){e.y+=n;break}e.y+=n/2,t.y-=n/2}}return i},focus(){return this.container.focus(),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this.container.focus(),this},focusOut(){return this.focused=!1,this.container.classList.remove("active"),this.container.classList.remove("focus"),this},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)})),this.projection.registerHandler("displayed",(()=>{(0,n.isEmpty)(this.source.value)||this.source.values.forEach((e=>{this.addItem(e),"prototype"===value.schema.nature&&(this.nodes[this.nodes.length-1].meta=this.nodes[i].concept,this.nodes[this.nodes.length-1].concept=value.getValue(!0).id)}))}))}},dn={getPointEllipse(e,t,i){const s=i.rx/2,n=i.ry/2,r=e.x,a=e.y,o=this.getDeq(e,t);let l=n*n+s*s*o.a*o.a,c=2*s*s*o.a*o.b-2*r*n*n-2*a*o.a*s*s,h=c*c-4*l*(r*r*n*n+s*s*a*a+s*s*o.b*o.b-2*a*s*s*o.b-s*s*n*n);if(h>=0){let e=(-c-Math.sqrt(h))/(2*l),t=e*o.a+o.b,i=(-c+Math.sqrt(h))/(2*l);return{x1:{x:e,y:t},x2:{x:i,y:i*o.a+o.b}}}},getPointConstructedEllipse(e,t,i,s){const n=t,r=i,a=s.x,o=s.y;let l=r*r+n*n*e.a*e.a,c=2*n*n*e.a*e.b-2*a*r*r-2*o*e.a*n*n,h=c*c-4*l*(a*a*r*r+n*n*o*o+n*n*e.b*e.b-2*o*n*n*e.b-n*n*r*r);if(h>=0){let t=(-c-Math.sqrt(h))/(2*l),i=t*e.a+e.b,s=(-c+Math.sqrt(h))/(2*l);return[{x:t,y:i},{x:s,y:s*e.a+e.b}]}},getEllipseCenter(e,t,i,s){let n=(t.x-i.x)/2,r=(t.y-i.y)/2,a=-Math.sqrt((e*e*(e*e)-e*e*(r*r)-e*e*(n*n))/(e*e*(r*r)+e*e*n*n)),o=a*(-e*n/e);return{x:a*(e*r/e)+(t.x+i.x)/2,y:o+(t.y+i.y)/2}},getPerpendicularLine(e,t){let i=(e.x+t.x)/2,s=(e.y+t.y)/2,n=-1/dn.getDeq(e,t).a;return{a:n,b:s-n*i}},getSelfPointEllipse(e){let t={x:e.x-e.ellipse.rx/2,y:e.y},i={x:e.x+e.ellipse.rx/2,y:e.y},s={x:e.x,y:e.y-e.ellipse.ry/2},n={x:e.x,y:e.y-e.ellipse.ry/2},r=0,a=0,o=0,l=0;switch(e.points.forEach((e=>{r+=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),a+=Math.sqrt((e.x-i.x)*(e.x-i.x)+(e.y-i.y)*(e.y-i.y)),o+=Math.sqrt((e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y)),l+=Math.sqrt((e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y))})),Math.max(r,a,o,l)){case o:return{x:s.x,y:s.y,direction:"top"};case a:return{x:i.x,y:i.y,direction:"right"};case l:return{x:n.x,y:n.y,direction:"bot"};default:return{x:t.x,y:t.y,direction:"left"}}},getPointPolygon(e,t,i){let s=[];i.points.forEach((t=>{s.push({x:t.x*e.width+e.x-e.width/2,y:t.y*e.height+e.y-e.height/2})}));let n=s[0].x-t.x,r=s[0].y-t.y,a=Math.sqrt(n*n+r*r),o=a,l=0;for(let e=1;e<s.length;e++)n=s[e].x-t.x,r=s[e].y-t.y,a=Math.sqrt(n*n+r*r),a<o&&(o=a,l=e);return s[l]},getDeq(e,t){let i=(t.y-e.y)/(t.x-e.x);return{a:i,b:e.y-i*e.x}},getCloserBorder(e,t){let i=Math.sqrt((e[0].x-t.x)*(e[0].x-t.x)+(e[0].y-t.y)*(e[0].y-t.y));return Math.sqrt((e[1].x-t.x)*(e[1].x-t.x)+(e[1].y-t.y)*(e[1].y-t.y))<i?e[1]:e[0]},getPointRect(e,t,i){let s=e.x-i.w/2,n=e.y-i.h/2,r=e.x+i.w/2,a=e.y-i.h/2,o=e.y+i.h/2,l=dn.getDeq({x:e.x,y:e.y},{x:t.x,y:t.y}),c=dn.getDeq({x:s,y:n},{x:r,y:a}),h=dn.getLineIntersection(l,c);return h&&h.x>s&&h.x<r?[h,{x:(o-l.b)/l.a,y:o}]:[{x:r,y:l.a*r+l.b},{x:s,y:l.a*s+l.b}]},getLineIntersection(e,t){if(e.a===t.a)return!1;let i=e.a-t.a,s=t.b-e.b;return{x:s/i,y:e.a*(s/i)+e.b}},getPointCircle(e,t,i){let s=dn.getDeq({x:e.x,y:e.y},{x:t.x,y:t.y}),n=s.a*s.a+1,r=2*s.a*s.b-2*s.a*e.y-2*e.x,a=r*r-4*n*(s.b*s.b-s.b*e.y*2+e.y*e.y+e.x*e.x-i.r*i.r);if(a>0){let e=(-r+Math.sqrt(a))/(2*n),t=(-r-Math.sqrt(a))/(2*n);return[{x:e,y:s.a*e+s.b},{x:t,y:s.a*t+s.b}]}},computeBorder(e,t){let i={},s={};switch(e.shape.type){case"rect":return i=dn.getPointRect(e,t,e.shape),s=dn.getCloserBorder(i,t),s;case"circle":return i=dn.getPointCircle(e,t,e.shape),s=dn.getCloserBorder(i,t),s;case"ellipse":return i=dn.getPointEllipse(e,t,e.shape),s=dn.getCloserBorder(i,t),s;case"polygon":return i=dn.getPointPolygon(e,t,e.shape),i}}},pn=Object.assign({},hn,un),mn={init(){const{dimensions:e}=this.schema;return this.dimensions=e,this},render(){(0,n.createDocFragment)();const{dimensions:e,saturation:t,overflow:i=!1,create:s,add:r,style:a}=this.schema;if(this.focusable=!0,(0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),e&&(this.container.setAttribute("width",e.width),this.container.setAttribute("height",e.height)),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="pattern",this.container.dataset.id=this.id,this.container.dataset.click="container",this.container.tabIndex=0),i&&(this.container.style.overflow="visible"),t&&(this.saturation=t.value,this.satTarget=t.target,(0,n.isNullOrUndefined)(t.satParams)||(this.satParams=t.satParams),(0,n.isNullOrUndefined)(t.acceptTarget)||(this.acceptTarget=t.acceptTarget)),(0,n.isNullOrUndefined)(this.anchors)&&this.setUpAnchors(),r&&(0,n.isNullOrUndefined)(this.add)){const{coordinates:e=!1,render:t}=r;this.add=kr.call(this,t),e?(this.add.setAttribute("x",e.x),this.add.setAttribute("y",e.y)):(this.add.setAttribute("x",this.anchors.current.x),this.add.setAttribute("y",this.anchors.current.y)),this.container.append(this.add),this.add.style.overflow="visible",this.add.addEventListener("click",(()=>{}))}return this.displayed=!1,a&&(this.container.style=a),this.bindEvents(),s&&this.source.createElement(),a&&(this.container.style=a),this.container},checkDim(e,t,i){t+20+Number(i.getAttribute("y"))>Number(this.items[0].render.getAttribute("height"))&&this.items.forEach((e=>{this.projection.resolveElement(e.render).augment()}))},checkSpeDim(e,t,i){for(;t+20+Number(i.getAttribute("y"))>Number(this.items[this.items.length-1].render.getAttribute("height"));)this.projection.resolveElement(this.items[this.items.length-1].render).augment()},createItem(e){const{tag:t}=this.schema.pattern;let i=this.model.createProjection(e,t);return i.optional=!0,i.parent=this.projection,{render:i.init().render(),projection:i}},addItem(e){if(console.log("Saturation test"),console.log(this),console.log(this.count),console.log(this.saturation),this.saturation&&((0,n.isNullOrUndefined)(this.count)&&(this.count=0),this.count>=this.saturation))return console.log(this.satTarget),this.environment.getActiveReceiver(this.satTarget).source.createElement(),void this.saturate(e);let{render:t,projection:i}=this.createItem(e);(0,n.isNullOrUndefined)(this.dimSchema)&&(this.dimSchema=new Map),this.dimSchema.set(t.dataset.id,Di.analyseDim(t,this.schema.pattern)),this.container.append(t);let s=this.anchors.current;(0,n.isNullOrUndefined)(this.items)&&(this.items=[]),this.items.push({render:t,position:s,index:this.anchorIndex,id:e.id}),this.displayed?(Di.setDimensions(this.dimSchema.get(t.dataset.id)),i.update("displayed",t.dataset.id)):((0,n.isNullOrUndefined)(this.waiting)&&(this.waiting=[]),this.waiting.push({render:t,projection:i})),(0,n.isNullOrUndefined)(this.anchors)&&this.setUpAnchors(),Di.positionElement(s,t),this.nextAnchor(!0),this.count++,this.warnings&&this.warnings.forEach((e=>{i.warn(e)}))},placeAdd(){this.add.setAttribute("x",this.anchors.current.x),this.add.setAttribute("y",this.anchors.current.y)},setUpAnchors(){const{first:e,next:t}=this.schema.pattern;this.anchors={},this.anchors.current=e,this.anchors.next=t,this.anchors.indexes=[e],this.anchorIndex=0},saturate(e){let t=this.environment.projectionModel.createProjection(this.projection.concept,this.projection.tag).init();t.render(),console.log("SATPARAMS"),console.log(this.satParams),console.log(this.satParams.coordinates),this.environment.getActiveReceiver("solo").accept(t.element.container,this.satParams.dimension,this.satParams.coordinates),t.element.addItem(e),this.full=!0,this.saturated=!0},accept(e,t=!1){const{render:i,params:s}=e;if(t){let e=this.projection.resolveElement(i);return e.parent=this,void(e.definitions&&this.container.append(e.definitions))}this.container.append(i)},acceptAnchor(e){console.log("AcceptingAnchor"),this.container.append(e);let t=this.anchors.current;this.items.push({render:e,anchor:t,index:this.anchorIndex,id:e.id}),Di.positionElement(t,e),this.nextAnchor(!0),this.count++,this.count>=this.saturation&&(this.full=!0)},nextAnchor(e=!1){let{x:t,y:i}=this.anchors.current,s=this.anchors.next.x,r=this.anchors.next.y;this.anchors.current={x:t+s,y:i+r},e&&this.anchorModel&&Ci.AnchorHandler.nextAnchor(this.schema.handler.id,this.id),(0,n.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),this.anchors.indexes.push({x:t+s,y:i+r}),this.anchorIndex++,(0,n.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container)},createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return i.append(e),t.append(i),t},adapt(e,t){let i,s=e.parentNode.parentNode,n=e.parentNode;"fixed"===t.type&&(s.setAttribute("width",t.value),n.setAttribute("width",t.value),i=e.getBoundingClientRect(),n.setAttribute("height",i.height),n.setAttribute("width",i.width),s.setAttribute("height",i.height*t.value/i.width),s.setAttribute("viewBox","0 0 "+i.width+" "+i.height))},transmitFirst(){const{render:e,position:t,index:i,id:s}=this.items[0];return console.log("Transmitting"),console.log(e),this.removeItem({id:s}),console.log("Removed"),e},removeItem(e){let t,i;for(i=0;i<this.items.length;i++)if(this.items[i].id===e.id){const{position:e}=this.items[i];t=e;break}if(console.log("Value"),console.log(e),console.log(i),i>=this.items.length||(0,n.isNullOrUndefined)(this.items[i]))return;const s=this.items[i].index;for(this.items.splice(i,1),i>this.items.length&&i--;i<this.items.length;){let e=this.items[i].position;this.items[i].position=t,this.items[i].render.setAttribute("x",t.x),this.items[i].render.setAttribute("y",t.y),this.items[i].index--,t=e,i++}this.anchors.indexes.splice(this.anchors.indexes.length-1,1),this.anchors.current=this.anchors.indexes[this.anchors.indexes.length-1],(0,n.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),(0,n.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container),this.anchorModel&&Ci.AnchorHandler.deleteItem(this.schema.handler.id,this.id,s),(0,n.isNullOrUndefined)(this.count)||(this.count--,this.full&&(this.full=!1,this.environment.saturationRevolved(this,this.projection.rtag),this.saturated=!0),this.count)},removeAnchor(e){if(!(0,n.isNullOrUndefined)(this.items))for(let t=0;t<this.items.length;t++)this.items[t].index>e&&(this.items[t].position.x-=this.anchors.next.x,this.items[t].position.y-=this.anchors.next.y,this.items[t].render.setAttribute("x",this.items[t].position.x),this.items[t].render.setAttribute("y",this.items[t].position.y),this.items[t].index--);this.anchors.indexes.splice(this.anchors.indexes.length-1,1),this.anchors.current=this.anchors.indexes[this.anchors.indexes.length-1],(0,n.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd(),(0,n.isNullOrUndefined)(this.parent)||this.parent.checkAugment(this.anchors.current,this.container)},moveElemToAnchor(e,t){this.anchors.indexes.length<=e+1&&(this.nextAnchor(!0),(0,n.isNullOrUndefined)(this.add)||this.schema.add.coordinates||this.placeAdd());let i=this.anchors.indexes[e];this.items[t].position=i,this.items[t].index=e;let s=this.items[t].render;return s.setAttribute("x",i.x),s.setAttribute("y",i.y),s},increaseAnchors(e,t,i,s){t>this.anchors.indexes.length&&this.nextAnchor(!0),(0,n.isNullOrUndefined)(this.items)||this.items.forEach((n=>{n.render!==i&&n.index>=e&&n.index<=t&&(n.index++,s.includes(n.index)?this.projection.resolveElement(n.render).increaseAnchor():(n.position=this.anchors.indexes[n.index],n.render.setAttribute("x",n.position.x),n.render.setAttribute("y",n.position.y)))}))},decreaseAnchors(e,t,i,s){(0,n.isNullOrUndefined)(this.items)||this.items.forEach((n=>{n.render!==i&&n.index>=e&&n.index<=t&&(n.index--,s.includes(n.index)?this.projection.resolveElement(n.render).decreaseAnchor():(n.position=this.anchors.indexes[n.index],n.render.setAttribute("x",n.position.x),n.render.setAttribute("y",n.position.y)))}))},clickHandler(e){},focusIn(){return this.add&&this.container.append(this.add),this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.hide&&this.add&&this.add.remove(),this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.projection.registerHandler("displayed",(e=>{this.displayed||(this.displayed=!0,(0,n.isNullOrUndefined)(this.waiting)||this.waiting.forEach((e=>{let{render:t,projection:i}=e;Di.setDimensions(this.dimSchema.get(t.dataset.id)),i.update("displayed")}))),this.schema.handler&&(this.anchorModel=Ci.AnchorHandler.create(this,this.schema.handler))})),this.projection.registerHandler("value.added",(e=>{this.full?this.saturated||this.saturate():this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)}))}},fn=Object.assign({},hn,mn),{isHTMLElement:gn,createDiv:bn,isNullOrUndefined:vn,createDocFragment:yn,isEmpty:wn,isNull:xn,valOrDefault:En,isUndefined:An}=s(835),On={init(){return this},render(){const{content:e=[],coordinates:t=!1,overflow:i=!1,background:s,data:n=!1,reference:r=!1,dimensions:a=!1,style:o,rmv:l=!1,anchor:c=!1}=this.schema,h=yn(),u=new DOMParser;if(vn(this.container)){if(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),s&&(this.background=u.parseFromString(s.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.background),this.container.setAttribute("width",this.background.getAttribute("width")),this.container.setAttribute("height",this.background.getAttribute("height")),this.width=Number(this.background.getAttribute("width")),this.height=Number(this.background.getAttribute("height")),this.fixed=!0),a){const{width:e,height:t,viewBox:i=!1}=a;this.container.setAttribute("width",e),this.container.setAttribute("height",t),this.width=a.width,this.height=a.height,this.fixed=!0,i&&this.container.setAttribute("viewBox",i.minX+" "+i.minY+" "+i.width+" "+i.height)}if(i&&(this.container.style.overflow="visible"),s||a||(this.container.style.overflow="visible"),t){const{x:e,y:i}=t;this.container.setAttribute("x",e),this.container.setAttribute("y",i)}this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="decoration",this.container.dataset.id=this.id,r&&(this.container.dataset.reference=!0)}return n&&this.container.setAttribute("data-shape",n),c&&(this.attachPoint=c),vn(this.content)&&!wn(e)&&(this.waiting=[],this.positioning=[],this.itemsPos=new Map,this.itemsDim=new Map,this.content=[],e.forEach((e=>{let t=kr.call(this,e.render),i=Di.analyseDim(t,e);this.itemsDim.set(t.dataset.id,i);let s=this.projection.resolveElement(t);vn(s)?this.waitingRendered=!0:this.content.push(s),i.await&&this.waiting.push(t.dataset.id);let n=Di.analysePos(t,e);this.itemsPos.set(t.dataset.id,n),n.await&&this.positioning.push(n),vn(i.holder)?this.container.append(i.item):this.container.append(i.holder)}))),h.hasChildNodes()&&this.container.append(h),o&&(this.container.style=o),this.displayed=!1,this.bindEvents(),this.container},focus(e){this.container.focus()},focusIn(){return!vn(this.deleteElem)&&this.deleteElem.dataset.focusable&&this.container.append(this.deleteElem),vn(this.focusedElement)||this.focusedElement.forEach((e=>{this.container.append(e)})),vn(this.content)||this.content.forEach((e=>{e.focusIn()})),this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this.rmv&&this.container.append(this.rmv),this},focusOut(){return!vn(this.deleteElem)&&this.deleteElem.dataset.focusable&&this.deleteElem.remove(),vn(this.focusedElement)||this.focusedElement.forEach((e=>{e.remove()})),vn(this.content)||this.content.forEach((e=>{e.focusOut()})),this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this.rmv&&this.rmv.remove(),this},notify(e){this.updateContentDim(e.id)},augment(){let e=this.container.querySelector("[data-augment]");e.setAttribute("height",Number(e.getAttribute("height"))+30),vn(this.container.getAttribute("height"))||this.container.setAttribute("height",Number(this.container.getAttribute("height"))+30),xn(this.background)||this.background.setAttribute("height",Number(this.background.getAttribute("height"))+30)},updateContentDim(e){let t=this.itemsDim.get(e),i=this.itemsPos.get(e);"ratio"===t.type&&(Di.adaptRatio(t.item,t.ratio),Di.positionElement(i,t.holder))},accept(e,t,i){console.log("Accepting"),console.log(i);let s=Di.analyseDim(e,{dimension:t}),n=Di.analysePos(e,{coordinates:i});vn(this.itemsDim)&&(this.itemsDim=new Map),this.itemsDim.set(e.dataset.id,s),vn(this.itemsPos)&&(this.itemsPos=new Map),this.itemsPos.set(e.dataset.id,n),this.displayed?(Di.setDimensions(s),vn(s.holder)?Di.positionElement(n,e):Di.positionElement(n,s.holder)):(vn(this.content)&&(this.content=[],this.waiting=[],this.positioning=[]),this.content.push(this.projection.resolveElement(e)),s.await&&this.waiting.push(e.dataset.id),n.await&&this.positioning.push(n)),vn(s.holder)?this.container.append(s.item):this.container.append(s.holder)},analyseContentDim(){if(this.fixed)return;let e=0;if(0===this.content.length)return;for(;e<this.content.length&&vn(this.content[e]);)e++;if(e>this.content.length)return;let t=this.itemsDim.get(this.content[e].id);if("pure"===t.type){let t,i,s,n;vn(this.content[e].container)?(t=Number(this.content[e].element.getAttribute("x")),i=Number(this.content[e].element.getAttribute("y")),s=Number(this.content[e].width),n=Number(this.content[e].height)):(t=Number(this.content[e].container.getAttribute("x")),i=Number(this.content[e].container.getAttribute("y")),s=Number(this.content[e].width),n=Number(this.content[e].height)),this.width=t+s,this.height=i+n}for(let i=e+1;i<this.content.length;i++)if(!vn(this.content[i])&&(t=this.itemsDim.get(this.content[i].id),"pure"===t.type)){let e,t,s,n;vn(this.content[i].container)?(e=Number(this.content[i].element.getAttribute("x")),t=Number(this.content[i].element.getAttribute("y")),s=Number(this.content[i].width),n=Number(this.content[i].height)):(e=Number(this.content[i].container.getAttribute("x")),t=Number(this.content[i].container.getAttribute("y")),s=Number(this.content[i].width),n=Number(this.content[i].height)),(vn(this.width)||this.width<e+s)&&(this.width=e+s),(vn(this.height)||this.height<t+n)&&(this.height=t+n)}this.notifyDimObservers()},notifyDim(e,t,i){if(this.fixed)return;this.analyseContentDim();let s=Number(i.getAttribute("x")),n=Number(i.getAttribute("y"));(vn(this.width)||this.width<s+e)&&(this.width=s+e),(vn(this.height)||this.height<n+t)&&(this.height=n+t)},clickHandler(e){if(this.container.contains(e)){for(;e!==this.container&&vn(e.dataset.nature);)e=e.parentNode;e!==this.container&&this.projection.resolveElement(e).clickHandler(e)}return!1},bindEvents(){vn(this.content)||this.content.forEach((e=>{vn(e)||"static"===e.object||"simulation"===e.object||e.registerDimensionsObserver(this)})),this.projection.registerHandler("displayed",(e=>{this.displayed||(this.displayed=!0,vn(this.waiting)||this.waiting.forEach((e=>{Di.setDimensions(this.itemsDim.get(e))})),vn(this.positioning)||this.positioning.forEach((e=>{let t=this.itemsDim.get(e.render.dataset.id);t.holder?Di.positionElement(e,t.holder):Di.positionElement(e,e.render)})),vn(this.content)||this.content.forEach((e=>{vn(e)||e.projection.update("displayed",e.id)})),vn(this.width)&&this.analyseContentDim(),vn(this.parent)||gn(this.parent.element)||gn(this.parent.container)||this.parent.notifyDim(this.width,this.height,this.container))})),this.waitingRendered&&this.projection.registerHandler("binding",(e=>{this.itemsDim.set(e.dataset.id,{await:!1,item:e,type:"pure"}),this.content.push(this.projection.resolveElement(e)),this.analyseContentDim()}))}},Nn=Object.assign({},hn,On),kn={init(){return this},render(){const{interaction:e,algorithm:t}=this.schema,i=(0,n.createDocFragment)();if((0,n.isNullOrUndefined)(this.container)&&(this.container=(0,n.createDiv)({id:this.id,class:["algorithm","algorithm--holder"],tabindex:-1,dataset:{nature:"algorithm",view:"holder",id:this.id}})),(0,n.isNullOrUndefined)(this.interactionArea)&&(this.interactionArea=kr.call(this,e),i.append(this.interactionArea)),(0,n.isNullOrUndefined)(this.svgArea)){let e=this.source.getAttributeByName(t.name).target,s=this.environment.projectionModel.createProjection(e,t.tag);this.svgArea=s.init().render(),i.append(this.svgArea)}return i.hasChildNodes()&&this.container.append(i),this.container}},jn=Object.assign({},hn,kn),{createDocFragment:Ln,isNullOrUndefined:Sn,isEmpty:Cn,isNull:Tn}=s(835),{AnchorHandler:In}=s(185),Mn={init(){return this},render(){const{dimensions:e,overflow:t=!1,contains:i,reserve:s,model:n,style:r,offset:a,zindex:o,content:l=[]}=this.schema;if(Sn(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="anchor",this.container.dataset.id=this.id),t&&(this.container.style.overflow="visible"),e){const{width:t,height:i}=e;this.container.setAttribute("width",t),this.container.setAttribute("height",i)}return!Cn(l)&&Sn(this.items)&&(this.items=[],l.forEach((e=>{const{coordinates:t,render:i,dimension:s}=e;let n=kr.call(this,i);n.setAttribute("x",t.x),n.setAttribute("y",t.y),this.container.append(n),this.items.push(n)}))),n&&(In.createSubModel(n,this),this.anchorModel=n),this.bindEvents(),r&&this.createStyleMimic(r),this.container},focusIn(){},focusOut(){},increaseSize(){const e=Number(this.container.getAttribute("height"));this.container.setAttribute("height",e+this.anchors.y),this.mimic.setAttribute("height",e+this.anchors.y)},decreaseSize(){const e=Number(this.container.getAttribute("height"));this.container.setAttribute("height",e-this.anchors.y),this.mimic.setAttribute("height",e-this.anchors.y)},increaseAnchor(){const e=Number(this.container.getAttribute("y"));this.container.setAttribute("y",e+this.anchors.y)},decreaseAnchor(){const e=Number(this.container.getAttribute("y"));this.container.setAttribute("y",e-this.anchors.y)},createStyleMimic(e){this.mimic=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.mimic.setAttribute("width",this.container.getAttribute("width")),this.mimic.setAttribute("height",this.container.getAttribute("height")),this.mimic.style=e,this.container.prepend(this.mimic)},checkCover(){let e,t;for(let i=0;i<this.covering.length;i++)Sn(e)?(e=Math.min(this.covering[i].from.x,this.covering[i].to.x),t=Math.max(this.covering[i].from.x,this.covering[i].to.x)):(e>Math.min(this.covering[i].from.x,this.covering[i].to.x)&&(e=Math.min(this.covering[i].from.x,this.covering[i].to.x)),t<Math.max(this.covering[i].from.x,this.covering[i].to.x)&&(t=Math.max(this.covering[i].from.x,this.covering[i].to.x)));const i=Number(this.container.getAttribute("x"));i<e?(this.container.setAttribute("width",t-e+2*this.schema.offset.x+(e-i)),this.mimic.setAttribute("width",t-e+2*this.schema.offset.x+(e-i))):(this.container.setAttribute("width",t-e+2*this.schema.offset.x),this.mimic.setAttribute("width",t-e+2*this.schema.offset.x))},bindEvents(){this.projection.registerHandler("displayed",(()=>{let e=In.estimatePositionCondamn(this.anchorModel,this);const{offset:t=!1}=this.schema;t&&(this.container.setAttribute("x",e.x-t.x),this.container.setAttribute("y",e.y-t.y)),this.anchors=e.anchors,this.rtag=this.environment.getActiveReceiver(this.schema.rtag),this.rtag.container.prepend(this.container)})),this.projection.registerHandler("accept",(e=>{In.registerSubModel(this.anchorModel,this,e)})),this.projection.registerHandler("cover",(e=>{Sn(this.rtag)&&(this.rtag=this.findActiveReceiver(this.schema.rtag));const t=In.estimatePosition(e.calcS),i=In.estimatePosition(e.calcT);Sn(this.covering)&&(this.covering=[]),this.setCovering(e,t,i),this.checkCover()}))},setCovering(e,t,i){for(let s=0;s<this.covering.length;s++)if(this.covering[s].item===e)return this.covering[s].from=t,void(this.covering[s].to=i);this.covering.push({item:e,from:t,to:i})}},Un=Object.assign({},hn,Mn),Dn={init(){return this},render(){const{button:e,view:t}=this.schema;if((0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="decoration",this.container.dataset.id=this.id),(0,n.isNullOrUndefined)(this.button)){const t=new DOMParser,{content:i,coordinates:s}=e;this.button=t.parseFromString(parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.button.setAttribute("x",s.x),this.button.setAttribute("y",s.y),this.container.append(e)}return this.bindEvents(),this.container},bindEvents(){}},_n=Object.assign({},hn,Dn),{isHTMLElement:Bn,createDiv:Pn,isNullOrUndefined:Hn,createDocFragment:Vn,isEmpty:Rn,isNull:$n,valOrDefault:Fn}=s(835),qn={init(){return this},render(){const{content:e,dimensions:t}=this.schema;return Hn(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","text"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="add",this.container.dataset.id=this.id,this.container.setAttribute("font-size",12),this.container.style["dominant-baseline"]="hanging"),this.container.textContent=e,this.container},focusIn(){},focusOut(){},clickHandler(){this.source.createElement()},bindEvents(){this.container.addEventListener("click",(()=>{this.source.createElement()}))}},zn=Object.assign({},hn,qn),Wn={init(){return this},render(){const{action:e,content:t,background:i}=this.schema;if((0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("algorithm-container"),this.container.dataset.nature="algorithm",this.container.dataset.algorithm="button",this.container.dataset.id=this.id),t&&(0,n.isNullOrUndefined)(this.content)&&this.createContent(t),i){const e=new DOMParser;this.background=e.parseFromString(i.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.container.append(this.background)}return this.container},createContent(e){if("text"===e.type){this.content=document.createElementNS("http://www.w3.org/2000/svg","text");const{placeholder:t,font:i,size:s,anchor:n}=e.text;this.content.setAttribute("font-family",i),this.content.setAttribute("font-size",s),this.content.setAttribute("text-anchor",n),this.content.style["dominant-baseline"]="hanging",this.content.textContent=t,this.container.append(this.content)}},focusIn(){},focusOut(){}},Kn=Object.assign({},hn,Wn);var Xn=0;const Yn=()=>"algo"+Xn++,Jn={force:(e,t,i)=>Object.create(pn,{object:{value:"algorithm"},name:{value:"force-algorithm"},type:{value:"force"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(e,t,i)=>Object.create(fn,{object:{value:"algorithm"},name:{value:"pattern-algorithm"},type:{value:"pattern"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),decoration:(e,t,i)=>Object.create(Nn,{object:{value:"algorithm"},name:{value:"decoration-algorithm"},type:{value:"decoration"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(e,t,i)=>Object.create(jn,{object:{value:"algorithm"},name:{value:"holder-algorithm"},type:{value:"holder"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),anchor:(e,t,i)=>Object.create(Un,{object:{value:"algorithm"},name:{value:"anchor-algorithm"},type:{value:"anchor"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),"alt-view":(e,t,i)=>Object.create(_n,{object:{value:"algorithm"},name:{value:"alt-view"},type:{value:"alt-view"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),add:(e,t,i)=>Object.create(zn,{object:{value:"algorithm"},name:{value:"add"},type:{value:"add"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),button:(e,t,i)=>Object.create(Kn,{object:{value:"algorithm"},name:{value:"svg-button"},type:{value:"button"},id:{value:Yn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},Gn={createAlgo(e,t,i){const{type:s}=t,r=Jn[s];if((0,n.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${s}' algo could not be handled`);const a=r(e,t,i);if((0,n.isNullOrUndefined)(a))throw new Error(`Bad request: The '${s}' algo could not be created`);return a.createAlgo=this.createAlgo,(0,n.isNullOrUndefined)(a.id)&&(a.id=Yn()),a}},Qn={notifyDimObservers(){isNullOrUndefined(this.observers)||this.observers.forEach((e=>{e.analyseContentDim()}))}},Zn={init(){return this.width=700,this.height=700,this},render(){(0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",350),this.container.setAttribute("height",350),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.simulationArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.simulationArea.setAttribute("width",350),this.simulationArea.setAttribute("height",350),this.simulationArea.setAttribute("viewBox","0 0 700 700"),this.simulationArea.setAttribute("preserveAspectRatio","xMidYMid meet"),this.simulationArea.id=this.id,this.settingArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.settingArea.setAttribute("x",0),this.settingArea.setAttribute("y",0),this.container.append(this.settingArea),this.container.append(this.simulationArea)),(0,n.isNullOrUndefined)(this.circleRadiusTxt)&&(this.circleRadiusTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.circleRadiusTxt.textContent="Radius:",this.circleRadiusTxt.setAttribute("x",5),this.circleRadiusTxt.setAttribute("y",30),this.circleRadiusTxt.setAttribute("font-size",8),this.circleRadiusTxt.setAttribute("font-weight",500),this.circleRadiusTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.circleRadiusTxt)),(0,n.isNullOrUndefined)(this.radiusTxt)&&(this.radiusTxt=kr.call(this,{type:"attribute",name:"radius",tag:"simulation"}),this.radiusTxt.setAttribute("x",37),this.radiusTxt.setAttribute("y",30),this.settingArea.append(this.radiusTxt)),(0,n.isNullOrUndefined)(this.widthTxt)&&(this.widthTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.widthTxt.textContent="Width:",this.widthTxt.setAttribute("x",5),this.widthTxt.setAttribute("y",40),this.widthTxt.setAttribute("font-size",8),this.widthTxt.setAttribute("font-weight",500),this.widthTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.widthTxt)),(0,n.isNullOrUndefined)(this.wTxt)&&(this.wTxt=kr.call(this,{type:"attribute",name:"width",tag:"simulation"}),this.wTxt.setAttribute("x",37),this.wTxt.setAttribute("y",40),this.settingArea.append(this.wTxt)),(0,n.isNullOrUndefined)(this.heightTxt)&&(this.heightTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.heightTxt.textContent="Height",this.heightTxt.setAttribute("x",5),this.heightTxt.setAttribute("y",50),this.heightTxt.setAttribute("font-size",8),this.heightTxt.setAttribute("font-weight",500),this.heightTxt.setAttribute("font-family","Segoe UI"),this.settingArea.append(this.heightTxt)),(0,n.isNullOrUndefined)(this.hTxt)&&(this.hTxt=kr.call(this,{type:"attribute",name:"height",tag:"simulation"}),this.hTxt.setAttribute("x",37),this.hTxt.setAttribute("y",50),this.settingArea.append(this.hTxt)),this.button=document.createElementNS("http://www.w3.org/2000/svg","text"),this.button.textContent="Simulate",this.settingArea.append(this.button),this.button.addEventListener("click",(()=>{this.setUpForce()})),this.button.setAttribute("x",5),this.button.setAttribute("y",12),this.button.setAttribute("font-size",12),this.button.setAttribute("font-weight",500),this.button.setAttribute("font-family","Segoe UI");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.classList.add("linkSimulation"),e.id="linkSimulation"+this.id,e.setAttribute("stroke","black"),this.simulationArea.append(e),this.svgNode=[];for(let e=0;e<3;e++){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.style.fill="red",e.style.stroke="black",e.setAttribute("r",50),e.classList.add("nodeSimulation"),e.classList.add("hidden"),this.svgNode.push(e),this.simulationArea.append(e)}let t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.classList.add("nodeSimulation"),t.classList.add("hidden"),this.svgNode.push(t),this.simulationArea.append(t),this.bindEvents(),this.intensity=Number(this.intensityAttr.value),this.linkVal=Number(this.linkDistAttr.value),this.container},branch(){this.setUpForce()},setUpForce(){if((0,n.isNullOrUndefined)(this.force)){this.svgNode.forEach((e=>{e.classList.remove("hidden")})),this.source.getAttributeByName("intensity").target.value;const t=Number(this.source.getAttributeByName("linkVal").target.value);this.force=d3.layout.force().size([this.width,this.height]).nodes([]).links([{source:0,target:1}]).linkDistance(t).charge(-500).on("tick",this.tick.bind(this));var e=d3.select("#"+this.id);this.nodes=this.force.nodes(),this.nodes.push({x:25,y:25}),this.nodes.push({x:325,y:25}),this.nodes.push({x:175,y:75}),this.nodes.push({ref:!0}),this.node=e.selectAll("circle").data(this.nodes),this.links=this.force.links(),this.link=e.selectAll("path").data(this.links)}this.force.start()},clickHandler(){},tick(){let e=this.nodes;this.node.attr("cx",(function(t){if(t.ref){er.getMediatrice(e[0],e[1]);let t={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2};return e[0].x,e[1].x,e[0].x,e[1].x,e[0].y,e[1].y,e[0].y,e[1].y,t.x}return t.x})).attr("cy",(function(t){if(t.ref){er.getMediatrice(e[0],e[1]);let t={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2};return e[0].x,e[1].x,e[0].x,e[1].x,e[0].y,e[1].y,e[0].y,e[1].y,t.y}return t.y})),this.link.attr("d",(function(e){return"M"+e.target.x+","+e.target.y+"A1,1 0 0 1,"+e.source.x+","+e.source.y+"A1,1 0 0 0,"+e.target.x+","+e.target.y}))},updateClean(){this.height=this.heightAttr.value,this.width=this.widthAttr.value,this.height>0&&this.width>0&&this.simulationArea.setAttribute("viewBox","0 0 "+this.width+" "+this.height);for(let e=0;e<3;e++)this.radius.value>0&&this.svgNode[e].setAttribute("r",this.radius.value)},focusIn(){},focusOut(){},updateParams(){if((0,n.isNullOrUndefined)(this.force))this.updateClean();else{this.force.stop(),this.intensity=Math.min(-1*Number(this.intensityAttr.value),-1*Number(this.intensityAttr.value)),this.linkVal=Number(this.linkDistAttr.value);for(let e=0;e<3;e++)this.radius.value>0&&this.svgNode[e].setAttribute("r",this.radius.value);this.height=this.heightAttr.value,this.width=this.widthAttr.value,this.height>0&&this.width>0&&(this.simulationArea.setAttribute("viewBox","0 0 "+this.width+" "+this.height),this.force.size([this.width,this.height])),this.force.linkDistance(this.linkVal).charge(this.intensity),this.force.start()}},bindEvents(){this.intensityAttr=this.source.getAttributeByName("intensity").target,this.linkDistAttr=this.source.getAttributeByName("linkVal").target,this.widthAttr=this.source.getAttributeByName("width").target,this.heightAttr=this.source.getAttributeByName("height").target,this.radius=this.source.getAttributeByName("radius").target,this.intensityAttr.register(this.projection),this.linkDistAttr.register(this.projection),this.widthAttr.register(this.projection),this.heightAttr.register(this.projection),this.radius.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateParams()}))}},er={getMediatrice(e,t){let i=(e.x+t.x)/2,s=(e.y+t.y)/2,n=(t.y-e.y)/(t.x-e.x);return{k:-1/n,h:s+-1/n*i}},findPoint(e,t,i){let s=1-e.k*e.k,n=2*t.y*e.k-2-2*e.k*e.h,r=n*n-4*s*(t.x*t.x-t.y*t.y-e.h*e.h+2*t.y*e.h-i);if(r>0)return(-n-Math.sqrt(r))/(2*s);console.log(r),console.log("Not Found")}},tr=Object.assign(Object.create(Qn),Zn),ir={init(){return this.width=350,this.height=100,this},focusIn(){},focusOut(){},render(){return(0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",300),this.container.setAttribute("height",50),this.container.setAttribute("x",100),this.container.setAttribute("y",0),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("d","M 0 25 L 200 25"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.id=this.id,this.path.id="path"+this.id,this.container.append(this.path)),this.markerStart=kr.call(this,{type:"attribute",name:"start",placeholder:!1,tag:"simulation-start"}),this.markerEnd=kr.call(this,{type:"attribute",name:"end",placeholder:!1,tag:"simulation-end"}),this.container.append(this.markerStart),this.container.append(this.markerEnd),this.bindEvents(),this.container},applyStyle(){this.stroke.hasValue()&&this.path.setAttribute("stroke",this.stroke.value),this.width.hasValue()&&this.path.setAttribute("stroke-width",this.width.value),this.dasharray.hasValue()&&this.path.setAttribute("stroke-dasharray",this.dasharray.value),this.linecap.hasValue()&&this.path.setAttribute("stroke-linecap",this.linecap.value)},bindEvents(){this.stroke=this.source.getAttributeByName("stroke").target,this.stroke.register(this.projection),this.path.setAttribute("stroke","black"),this.width=this.source.getAttributeByName("width").target,this.width.register(this.projection),this.width.hasValue()&&this.path.setAttribute("stroke-width",this.width.value),this.dasharray=this.source.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.dasharray.hasValue()&&this.path.setAttribute("stroke-dasharray",this.dasharray.value),this.linecap=this.source.getAttributeByName("linecap").target,this.linecap.register(this.projection),this.linecap.hasValue()&&this.path.setAttribute("stroke-linecap",this.linecap.value),this.projection.registerHandler("value.changed",(()=>{this.applyStyle()}))}},sr=Object.assign(Object.create(Qn),ir),nr={init(){return this.width=350,this.height=100,this},render(){return(0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",200),this.container.setAttribute("height",200),this.container.setAttribute("viewBox","0 0 50 50"),this.text=document.createElementNS("http://www.w3.org/2000/svg","text"),this.text.setAttribute("x",25),this.text.setAttribute("y",25),this.text.textContent="Element",this.heightTxt=document.createElementNS("http://www.w3.org/2000/svg","text"),this.heightTxt.setAttribute("x",2),this.heightTxt.setAttribute("y",45),this.heightTxt.setAttribute("font-size",2),this.heightTxt.textContent="dimensions: 50x50",this.xyText=document.createElementNS("http://www.w3.org/2000/svg","text"),this.xyText.setAttribute("x",2),this.xyText.setAttribute("y",47),this.xyText.setAttribute("font-size",2),this.xyText.textContent="x,y: 25, 25",this.container.append(this.text),this.container.append(this.widthTxt),this.container.append(this.heightTxt),this.container.append(this.xyText),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="text",this.container.dataset.id=this.id,this.container.style="border:solid rgb(135, 161, 255); border-radius:10%;",this.container.id=this.id),this.bindEvents(),this.container},applyStyle(){this.font.hasValue()&&this.text.setAttribute("font-family",this.font.value),this.size.hasValue()&&this.text.setAttribute("font-size",this.size.value),this.anchor.hasValue()&&this.text.setAttribute("text-anchor",this.anchor.value),this.weight.hasValue()&&this.text.setAttribute("font-weight",this.weight.value),this.baseline.hasValue()&&(this.text.style["dominant-baseline"]=this.baseline.value)},bindEvents(){this.font=this.source.getAttributeByName("font").target,this.font.register(this.projection),this.text.setAttribute("font-family","Verdana"),this.size=this.source.getAttributeByName("size").target,this.size.register(this.projection),this.size.hasValue()&&this.text.setAttribute("font-size",this.size.value),this.weight=this.source.getAttributeByName("weight").target,this.weight.register(this.projection),this.weight.hasValue()&&this.text.setAttribute("font-weight",this.weight.value),this.anchor=this.source.getAttributeByName("anchor").target,this.anchor.register(this.projection),this.anchor.hasValue()&&this.text.setAttribute("text-anchor",this.anchor.value),this.baseline=this.source.getAttributeByName("baseline").target,this.baseline.register(this.projection),this.baseline.hasValue()&&this.text.setAttribute("dominant-baseline",this.anchor.value),this.projection.registerHandler("value.changed",(()=>{this.applyStyle()}))}},rr=Object.assign(Object.create(Qn),nr),ar={init(){return this.width=400,this.height=200,this},render(){return(0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",200),this.container.setAttribute("height",200),this.container.setAttribute("viewBox","0 0 400 400"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.simulation="selection",this.container.dataset.id=this.id,this.container.style="border:solid rgb(135, 161, 255); border-radius:10%;",this.container.id=this.id),this.bindEvents(),this.setUpSimulation(),this.container},bindEvents(){this.nbItem=this.source.getAttributeByName("nbItem").target,this.orientation=this.source.getAttributeByName("orientation").target,this.break=this.source.getAttributeByName("break").target,this.itemW=this.source.getAttributeByName("dimensions").target.getAttributeByName("width").target,this.itemH=this.source.getAttributeByName("dimensions").target.getAttributeByName("height").target,this.nbItem.register(this.projection),this.orientation.register(this.projection),this.break.register(this.projection),this.itemW.register(this.projection),this.itemH.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.setUpSimulation()}))},setUpSimulation(){this.baseLetter=65,(0,n.isNullOrUndefined)(this.selection)||this.selection.remove(),this.selection=document.createElementNS("http://www.w3.org/2000/svg","svg");for(let e=0;e<this.nbItem.value;e++){let t=this.createItem();this.place(t,e),this.baseLetter++}this.center(),this.container.append(this.selection)},focusIn(){},focusOut(){},place(e,t){const i=(0,n.valOrDefault)(this.itemW.value,50),s=(0,n.valOrDefault)(this.itemH.value,50),r=this.break.value;switch(this.orientation.value){case"horizontal":r>0?(e.setAttribute("x",t%r*i),e.setAttribute("y",~~(t/r)*s)):e.setAttribute("x",t*i);break;case"vertical":r>0?(e.setAttribute("x",~~(t/r)*s),e.setAttribute("y",t%r*i)):e.setAttribute("y",t*s)}},createItem(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");const t=(0,n.valOrDefault)(this.itemW.value,50),i=(0,n.valOrDefault)(this.itemH.value,50);this.break.value,e.setAttribute("width",t),e.setAttribute("height",i);let s=document.createElementNS("http://www.w3.org/2000/svg","text");return s.textContent=String.fromCharCode(this.baseLetter),s.setAttribute("x",t/2),s.setAttribute("y",i/2),s.setAttribute("text-anchor","middle"),s.setAttribute("font-size",i/2),s.setAttribute("font-family","Segoe UI"),s.setAttribute("font-weight",500),e.append(s),this.selection.append(e),e},center(){const e=this.orientation.value,t=this.break.value,i=(0,n.valOrDefault)(this.itemW.value,50),s=(0,n.valOrDefault)(this.itemH.value,50),r=this.nbItem.value;switch(e){case"horizontal":t>0&&r>t?(this.selection.setAttribute("x",200-t*i/2),this.selection.setAttribute("y",200-Math.ceil(r/t)*s/2)):(this.selection.setAttribute("x",200-r*i/2),this.selection.setAttribute("y",200-s/2));break;case"vertical":t>0&&r>t?(this.selection.setAttribute("y",200-t*s/2),this.selection.setAttribute("x",200-Math.ceil(r/t)*i/2)):(this.selection.setAttribute("y",200-r*s/2),this.selection.setAttribute("x",200-i/2))}}},or=Object.assign(Object.create(Qn),ar),lr={init(){return this},focusIn(){},focusOut(){},render(){return(0,n.isNullOrUndefined)(this.def)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.def=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.marker=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.marker.setAttribute("orient","auto"),this.marker.setAttribute("markerUnit","strokeWidth"),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="marker",this.container.dataset.id=this.id,this.def.append(this.marker),this.marker.append(this.path),this.container.append(this.def)),this.bindEvents(),this.container},focus(){},updateParams(){(0,n.isNullOrUndefined)(this.idAttr.value)||(this.marker.setAttribute("id",this.idAttr.value),this.user=this.container.parentNode.getElementById("path"+this.container.parentNode.id),this.user.setAttribute("marker-"+(this.schema.start?"start":"end"),"url(#"+this.idAttr.value+")")),(0,n.isNullOrUndefined)(this.minX.value)||(0,n.isNullOrUndefined)(this.minY.value)||(0,n.isNullOrUndefined)(this.width.value)||(0,n.isNullOrUndefined)(this.height.value)||this.marker.setAttribute("viewBox",this.minX.value+" "+this.minY.value+" "+this.width.value+" "+this.height.value),(0,n.isNullOrUndefined)(this.refX.value)||this.marker.setAttribute("refX",this.refX.value),(0,n.isNullOrUndefined)(this.refY.value)||this.marker.setAttribute("refY",this.refY.value),(0,n.isNullOrUndefined)(this.markerWidth.value)||this.marker.setAttribute("markerWidth",this.markerWidth.value),(0,n.isNullOrUndefined)(this.markerHeight.value)||this.marker.setAttribute("markerHeight",this.markerHeight.value),(0,n.isNullOrUndefined)(this.d.value)||this.path.setAttribute("d",this.d.value)},bindEvents(){this.idAttr=this.source.getAttributeByName("id").target,this.idAttr.register(this.projection),this.minX=this.source.getAttributeByName("minX").target,this.minX.register(this.projection),this.minY=this.source.getAttributeByName("minY").target,this.minY.register(this.projection),this.width=this.source.getAttributeByName("width").target,this.width.register(this.projection),this.height=this.source.getAttributeByName("height").target,this.height.register(this.projection),this.refX=this.source.getAttributeByName("refX").target,this.refX.register(this.projection),this.refY=this.source.getAttributeByName("refY").target,this.refY.register(this.projection),this.markerWidth=this.source.getAttributeByName("markerWidth").target,this.markerWidth.register(this.projection),this.markerHeight=this.source.getAttributeByName("markerHeight").target,this.markerHeight.register(this.projection),this.d=this.source.getAttributeByName("d").target,this.d.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateParams()}))}},cr=Object.assign(Object.create(Qn),lr),hr={init(){return this.width=350,this.height=350,this},render(){return(0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="content",this.container.dataset.id=this.id,this.container.setAttribute("width",300),this.container.setAttribute("height",300),this.holder=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.append(this.holder)),this.bindEvent(),this.container},focusIn(){},focusOut(){},scale(){const e=this.content.width.baseVal.value,t=this.content.height.baseVal.value;let i=Math.max(e,t)/100;this.holder.setAttribute("viewBox","0 0 "+e+" "+t),this.holder.setAttribute("width",e/i),this.holder.setAttribute("height",t/i),this.holder.setAttribute("x",100),this.holder.setAttribute("y",100)},bindEvent(){const e=new DOMParser;this.projection.registerHandler("value.changed",(t=>{(0,n.isNullOrUndefined)(this.content)||this.content.remove(),this.content=e.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.holder.append(this.content),this.scale()})),this.source.hasValue()&&(this.content=e.parseFromString(this.source.value.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,this.holder.append(this.content),this.scale())}},ur=Object.assign(Object.create(Qn),hr),dr={init(){return this.width=350,this.height=350,this},render(){return(0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.setAttribute("width",400),this.container.setAttribute("height",400),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="pattern",this.container.dataset.id=this.id),(0,n.isNullOrUndefined)(this.visualization)&&(this.visualization=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.visualization.setAttribute("viewBox","0 0 400 400"),this.visualization.setAttribute("width",400),this.visualization.setAttribute("height",400),this.visualization.setAttribute("preserveAspectRatio","xMidYMid meet"),this.container.append(this.visualization)),(0,n.isNullOrUndefined)(this.interaction)&&(this.interaction=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.interaction.setAttribute("viewBox","0 0 400 400"),this.interaction.setAttribute("width",400),this.interaction.setAttribute("height",400),this.container.append(this.interaction)),(0,n.isNullOrUndefined)(this.firstX)&&(this.firstX=this.source.getAttributeByName("first").target.getAttributeByName("x").target,this.firstY=this.source.getAttributeByName("first").target.getAttributeByName("y").target),(0,n.isNullOrUndefined)(this.nextX)&&(this.nextX=this.source.getAttributeByName("next").target.getAttributeByName("x").target,this.nextY=this.source.getAttributeByName("next").target.getAttributeByName("y").target),(0,n.isNullOrUndefined)(this.itemWidth)&&(this.itemWidth=this.source.getAttributeByName("itemWidth").target,this.itemWidthTextual=kr.call(this,{type:"attribute",name:"itemWidth",tag:"simulation-large"}),this.itemWidthTextual.setAttribute("x",57),this.itemWidthTextual.setAttribute("y",30),this.itemWidthStatic=kr.call(this,{kind:"static",type:"svg-text",content:"ItemWidth:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.itemWidthStatic.setAttribute("x",56),this.itemWidthStatic.setAttribute("y",30),this.interaction.append(this.itemWidthTextual),this.interaction.append(this.itemWidthStatic)),(0,n.isNullOrUndefined)(this.widthTextual)&&(this.widthAttr=this.source.getAttributeByName("width").target,this.widthTextual=kr.call(this,{type:"attribute",name:"width",tag:"simulation-large"}),this.widthTextual.setAttribute("x",34),this.widthTextual.setAttribute("y",45),this.widthStatic=kr.call(this,{kind:"static",type:"svg-text",content:"Width:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.widthStatic.setAttribute("x",33),this.widthStatic.setAttribute("y",45),this.interaction.append(this.widthTextual),this.interaction.append(this.widthStatic)),(0,n.isNullOrUndefined)(this.heightTextual)&&(this.heightAttr=this.source.getAttributeByName("height").target,this.heightTextual=kr.call(this,{type:"attribute",name:"height",tag:"simulation-large"}),this.heightTextual.setAttribute("x",38),this.heightTextual.setAttribute("y",60),this.heightStatic=kr.call(this,{kind:"static",type:"svg-text",content:"Height:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.heightStatic.setAttribute("x",37),this.heightStatic.setAttribute("y",60),this.interaction.append(this.heightTextual),this.interaction.append(this.heightStatic)),(0,n.isNullOrUndefined)(this.nbItem)&&(this.nbItem=this.source.getAttributeByName("nbItem").target,this.nbItemText=kr.call(this,{type:"attribute",name:"nbItem",tag:"simulation-large"}),this.nbItemStatic=kr.call(this,{kind:"static",type:"svg-text",content:"nbItem:",style:{font:"Segoe UI",size:11,anchor:"end",baseline:"auto",color:"black",weight:500}}),this.nbItemText.setAttribute("x",26),this.nbItemText.setAttribute("y",15),this.nbItemStatic.setAttribute("x",25),this.nbItemStatic.setAttribute("y",15),this.interaction.append(this.nbItemStatic),this.interaction.append(this.nbItemText),this.setUpItems()),this.bindEvents(),this.container},setUpItems(){let e=this.nbItem.value;this.items=[];for(let t=0;t<e;t++){let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("width",this.itemWidth.value),e.setAttribute("height",this.itemWidth.value),e.setAttribute("fill","white"),e.setAttribute("stroke","#738CFF"),e.setAttribute("stroke-width",5),e.setAttribute("x",t*this.nextX.value+this.firstX.value),e.setAttribute("y",t*this.nextY.value+this.firstY.value),this.visualization.append(e),this.items.push(e)}},updateContainer(){(0,n.isNullOrUndefined)(this.widthAttr.value)||(0,n.isNullOrUndefined)(this.heightAttr.value)||this.visualization.setAttribute("viewBox","0 0 "+this.widthAttr.value+" "+this.heightAttr.value)},updateItems(){let e=this.nbItem.value;if(!(0,n.isNullOrUndefined)(e)){if(this.items.length>e){for(let t=e;t<this.items.length;t++)this.items[t].remove();this.items.splice(e,this.items.length-e)}if(this.items.length<e)for(let t=this.items.length;t<e;t++){let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("fill","white"),e.setAttribute("stroke","#738CFF"),e.setAttribute("stroke-width",5),this.visualization.append(e),this.items.push(e)}for(let e=0;e<this.items.length;e++)this.items[e].setAttribute("width",(0,n.valOrDefault)(this.itemWidth.value,50)),this.items[e].setAttribute("height",(0,n.valOrDefault)(this.itemWidth.value,50)),this.items[e].setAttribute("x",e*this.nextX.value+this.firstX.value),this.items[e].setAttribute("y",e*this.nextY.value+this.firstY.value)}},bindEvents(){this.nbItem.register(this.projection),this.firstX.register(this.projection),this.firstY.register(this.projection),this.nextX.register(this.projection),this.nextY.register(this.projection),this.itemWidth.register(this.projection),this.widthAttr.register(this.projection),this.heightAttr.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateContainer(),this.updateItems()}))}},pr=Object.assign(Object.create(Qn),dr),mr={init(){return this.width=460,this.height=220,this},render(){if((0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,n.isNullOrUndefined)(this.nodes)){this.nodes=[];for(let e=0;e<3;e++){let e=kr.call(this,{kind:"static",type:"svg",content:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" width="10" height="10" version="1"><circle r="5" cx="5" cy="5"></circle></svg>'});this.container.append(e),this.nodes.push(e)}this.nodes[0].setAttribute("x",50),this.nodes[0].setAttribute("y",110),this.nodes[1].setAttribute("x",225),this.nodes[1].setAttribute("y",35),this.nodes[2].setAttribute("x",400),this.nodes[2].setAttribute("y",190)}return(0,n.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("stroke","black"),this.path.setAttribute("fill","transparent"),this.container.append(this.path)),this.sp=kr.call(this,{type:"attribute",name:"sub-paths",tag:"simulation"}),this.container.append(this.sp),this.subPaths=this.projection.resolveElement(this.sp),this.bindEvents(),this.bindStyle(),this.bindSubPath(),this.bindSubStyle(),this.setPath(),this.container},setPath(){let e=this.meet.value;switch(e){case"free":this.path.setAttribute("d","M 55 115 L 230 40 L 405 195");break;case"minX":this.path.setAttribute("d","M 55 40 L 55 195");break;case"maxX":this.path.setAttribute("d","M 405 40 L 405 195");break;case"minY":this.path.setAttribute("d","M 55 40 L 405 40");break;case"maxY":this.path.setAttribute("d","M 55 195 L 405 195")}this.style(),this.subPaths.setPath(e,{x:0,y:0})},bindEvents(){this.meet=this.source.getAttributeByName("meet").target,this.meet.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.setPath()}))},style(){this.path.setAttribute("stroke",this.stroke.value),this.path.setAttribute("stroke-width",this.width.value),this.path.setAttribute("stroke-linecap",this.linecap.value),(0,n.isNullOrUndefined)(this.dasharray.value)||(this.path.style["stroke-dasharray"]=this.dasharray.value)},bindStyle(){const e=this.source.getAttributeByName("arrow-style").target;this.dasharray=e.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.stroke=e.getAttributeByName("stroke").target.getAttributeByName("value").target,this.stroke.register(this.projection),this.width=e.getAttributeByName("width").target,this.width.register(this.projection),this.linecap=e.getAttributeByName("linecap").target,this.linecap.register(this.projection),console.log(this)},bindSubPath(){},bindSubStyle(){}},fr=Object.assign(Object.create(Qn),mr),gr={init(){return this.width=460,this.height=220,this},render(){if((0,n.isNullOrUndefined)(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("simulation-container"),this.container.dataset.nature="simulation",this.container.dataset.shape="force",this.container.dataset.id=this.id,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height)),(0,n.isNullOrUndefined)(this.paths)){this.paths=[];for(let e=0;e<3;e++){let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("stroke","black"),e.setAttribute("fill","transparent"),console.log(e),this.container.append(e),this.paths.push(e)}}return this.bindEvents(),this.bindStyle(),console.log("Returning this"),console.log(this.container),this.container},setPath(e,t){if((0,n.isNullOrUndefined)(e)||(this.meet=e),(0,n.isNullOrUndefined)(t)||(this.offset=t),"free"===this.meet)return this.paths[0].remove(),this.paths[1].remove(),this.paths[2].remove(),void this.style();switch(this.container.append(this.paths[0]),this.container.append(this.paths[1]),this.container.append(this.paths[2]),this.meet){case"minX":this.paths[0].setAttribute("d","M "+(55+this.offset.x)+" 110 L 60 110"),this.paths[1].setAttribute("d","M "+(55+this.offset.x)+" 40 L 230 40"),this.paths[2].setAttribute("d","M "+(55+this.offset.x)+" 195 L 405 195");break;case"maxX":this.paths[0].setAttribute("d","M "+(405+this.offset.x)+" 110 L 60 110"),this.paths[1].setAttribute("d","M "+(405+this.offset.x)+" 35 L 230 110"),this.paths[2].setAttribute("d","M "+(405+this.offset.x)+" 190 L 405 190");break;case"minY":this.paths[0].setAttribute("d","M 110 "+(35+this.offset.y)+" 110 L 60 110"),this.paths[1].setAttribute("d","M 35 "+(35+this.offset.y)+" 35 L 230 110"),this.paths[2].setAttribute("d","M 190 "+(35+this.offset.y)+" 190 L 405 190");break;case"maxY":this.paths[0].setAttribute("d","M 110 "+(190+this.offset.y)+" 110 L 60 110"),this.paths[1].setAttribute("d","M 35 "+(190+this.offset.y)+" 35 L 230 110"),this.paths[2].setAttribute("d","M 190 "+(190+this.offset.y)+" 190 L 405 190")}this.style()},bindEvents(){this.projection.registerHandler("value.changed",(()=>{this.setPath()}))},style(){for(let e=0;e<3;e++)this.paths[e].setAttribute("stroke",this.stroke.value),this.paths[e].setAttribute("stroke-width",this.width.value),this.paths[e].setAttribute("stroke-linecap",this.linecap.value),(0,n.isNullOrUndefined)(this.dasharray.value)||(this.path.style["stroke-dasharray"]=this.dasharray.value)},bindStyle(){const e=this.source.getAttributeByName("arrow-style").target;this.dasharray=e.getAttributeByName("dasharray").target,this.dasharray.register(this.projection),this.stroke=e.getAttributeByName("stroke").target.getAttributeByName("value").target,this.stroke.register(this.projection),this.width=e.getAttributeByName("width").target,this.width.register(this.projection),this.linecap=e.getAttributeByName("linecap").target,this.linecap.register(this.projection),console.log(this)}},br=Object.assign(Object.create(Qn),gr);var vr=0;const yr=()=>"algo"+vr++,wr={force:(e,t,i)=>Object.create(tr,{object:{value:"simulation"},name:{value:"force-simulation"},type:{value:"force"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),arrow:(e,t,i)=>Object.create(sr,{object:{value:"simulation"},name:{value:"arrow-simulation"},type:{value:"arrow"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),text:(e,t,i)=>Object.create(rr,{object:{value:"simulation"},name:{value:"text-simulation"},type:{value:"text"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),selection:(e,t,i)=>Object.create(or,{object:{value:"simulation"},name:{value:"selection-simulation"},type:{value:"selection"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),marker:(e,t,i)=>Object.create(cr,{object:{value:"simulation"},name:{value:"marker-simulation"},type:{value:"marker"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),content:(e,t,i)=>Object.create(ur,{object:{value:"simulation"},name:{value:"content-simulation"},type:{value:"content"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(e,t,i)=>Object.create(pr,{object:{value:"simulation"},name:{value:"pattern-simulation"},type:{value:"pattern"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),multi:(e,t,i)=>Object.create(fr,{object:{value:"simulation"},name:{value:"multi-simulation"},type:{value:"multi"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),"sub-path":(e,t,i)=>Object.create(br,{object:{value:"simulation"},name:{value:"subPath-simulation"},type:{value:"subPath"},id:{value:yr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},xr={createSimulation(e,t,i){console.log(t);const{type:s}=t,r=wr[s];if((0,n.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${s}' simulation could not be handled`);const a=r(e,t,i);if((0,n.isNullOrUndefined)(a))throw new Error(`Bad request: The '${s}' simulation could not be created`);return a.createSimulation=this.createSimulation,(0,n.isNullOrUndefined)(a.id)&&(a.id=yr()),console.log("About to return simu"),console.log(a),a}};function Er(e){return"property"===e.type?this.projection.concept.getProperty(e.name):e}function Ar(e,t,i){const{tag:s,placeholder:r={},style:a,options:o,listen:l}=t;if(!i.hasAttribute(e)){let t=`Attribute '${e}' does not exist in the concept '${i.name}'`;return this.environment.notify(t,y.ERROR),this.environment.addError({source:"projection",code:"attribute_not_found",message:t}),(0,n.createI)({hidden:!0},e)}(0,n.valOrDefault)(t.required,i.isAttributeRequired(e))&&!i.isAttributeCreated(e)&&i.createAttribute(e);const c={name:e,get created(){return i.isAttributeCreated(e)},schema:t,placeholder:(0,n.createI)({class:["projection-element"],hidden:!0},e),parent:this,projection:this.projection,element:null};if(this.projection.attributes.push(c),!c.created){const{content:t}=r;return c.placeholder=t?kr.call(this,t,i,{focusable:!0}):(0,n.createI)({class:["projection-element","projection-element--placeholder"],tabindex:0,dataset:{object:"attribute",id:e}},`Add ${e}`),c.placeholder.addEventListener("click",(t=>{i.createAttribute(e),this.projection.resolveElement(c.element).focus()})),c.placeholder}{const{target:t,schema:r}=i.getAttributeByName(e);let h=this.projection.model.createProjection(t,s).init(o);if(l&&(h.listen=!0),h.parent=this.projection,h._style=a,c.element=h.render(),(0,n.isNullOrUndefined)(c.element))return(0,n.createI)({hidden:!0},e);h.element.parent=this}return c.element}function Or(e,t){const{value:i,placement:s}=e,{target:r,description:a}=t.getAttributeByName(i);let o=this.projection.model.createProjection(r,s.tag).init();o.parent=this.projection,o.render(),(0,n.isNullOrUndefined)(r.value)||o.element.initValue(r.value),o.element.parent=this;let l=i[0].toUpperCase()+i.substring(1);return o.element.attributeName=l,o.element}function Nr(e,t){let i=this.projection.model.createProjection(t,e).init();return i.parent=this.projection,i.render(),i.element.parent=this,i.element.container}function kr(e,t,i={}){if(e.kind)return jr.call(this,e,t,i);const s=(0,n.valOrDefault)(t,this.projection.concept);if("container"===e.type){let t=on(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("layout"===e.type){let t=ta.createLayout(this.model,e.layout,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("field"===e.type){let t=ps.createField(this.model,e.field,this.projection);return t.parent=this,t.init(i),this.model.registerField(t),t.render()}if("static"===e.type){let t=en.createStatic(this.model,e.static,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerStatic(t),t.render()}if("algorithm"===e.type){let t=Gn.createAlgo(this.model,e.algorithm,this.projection);return t.init(),this.model.registerAlgorithm(t),t.render()}if("simulation"===e.type){let t=xr.createSimulation(this.model,e.simulation,this.projection);return t.init(),this.model.registerSimulation(t),t.render()}if("dynamic"===e.type)return kr.call(this,e.dynamic,t,i);if("attribute"===e.type)return Ar.call(this,e.name,e,s);if("svg-attribute"===e.type)return Or.call(this,e,s);if("external"===e.type)return Nr.call(this,e.tag,s);if("g-fragment"===e.type){let t=e.name,i=this.model.getGFragmentSchema(t.toLowerCase());return(new DOMParser).parseFromString(i.content.content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement}if("template"===e.type){let s=e.name;"param"===s.type&&(s=this.projection.getParam(s.name)),console.log(e);let r=this.model.getTemplateSchema(s);r.param&&(e.param&&r.param.forEach((t=>{Object.assign(t,e.param.find((e=>e.name===t.name)))})),this.projection.addParam(r.param));const a=(0,n.createDocFragment)();let o,l=Object.assign({template:r},i),c=!1;return r.content.forEach((e=>{a.append(kr.call(this,e,t,l))})),c?o:a}if("projection"===e.type){const{tag:t,style:i,src:r,required:a=!1}=e;if(r&&"attribute"===r.type)return Ar.call(this,r.name,e,s);const o={schema:e,placeholder:(0,n.createI)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return o.update=function(e,r,a){if(o.element&&(o.element.remove(),o.element=null),s.hasValue()){let e=s.getValue(!0),r=this.projection.model.createProjection(e,t).init();r.placeholder=o.placeholder,r.parent=this.projection,o.element=r.render(),o.placeholder&&o.placeholder.after(o.element),(0,n.isHTMLElement)(o.element)&&St.call(this.projection,o.element,i),r.element.parent=this.projection.element,r.update("displayed"),this.projection.update("binding",r.element.container||r.element.element)}},s.register(o),o.update(),o.element||o.placeholder}if("property"===e.type){const{name:t}=e;return this.projection.concept.getProperty(t)}if("html"===e.type){const{html:t}=e;return(0,n.htmlToElement)(t)}if("raw"===e.type){const{raw:t}=e;return t}if("state"===e.type){let s={},n=Kt.call(this,s,e.state);return kr.call(this,n.content,t,i)}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}function jr(e,t,i={}){const s=(0,n.valOrDefault)(t,this.projection.concept),{kind:r}=e;if("container"===r){let t=on(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("layout"===r){let t=ta.createLayout(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("field"===r){let t=ps.createField(this.model,e,this.projection);return t.parent=this,t.init(i),this.model.registerField(t),t.render()}if("static"===r){let t=en.createStatic(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerStatic(t),t.render()}if("attribute"===r||"dynamic"===r)return Ar.call(this,e.name,e,s);if("template"===r){let s=e.name;"param"===s.type&&(s=this.projection.getParam(s.name));let r=this.model.getTemplateSchema(s);r.param&&(e.param&&r.param.forEach((t=>{Object.assign(t,e.param.find((e=>e.name===t.name)))})),this.projection.addParam(r.param));const a=(0,n.createDocFragment)();return r.content.forEach((e=>{a.append(kr.call(this,e,t,i))})),a}if("projection"===r){const{tag:t,style:i,required:r=!1}=e,a={schema:e,placeholder:(0,n.createI)({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return a.update=function(e,r,o){if(a.element&&(a.element.remove(),a.element=null),s.hasValue()){let e=s.getValue(!0),r=this.projection.model.createProjection(e,t).init();r.placeholder=a.placeholder,r.parent=this.projection,a.element=r.render(),a.placeholder&&a.placeholder.after(a.element),(0,n.isHTMLElement)(a.element)&&St.call(this.projection,a.element,i),r.element.parent=this.projection.element}},s.register(a),a.update(),a.element||a.placeholder}if("property"===r){const{name:t}=e;return this.projection.concept.getProperty(t)}if("html"===r){const{html:t}=e;return(0,n.htmlToElement)(t)}if("raw"===r){const{raw:t}=e;return t}if("state"===r){let s={},n=Kt.call(this,s,e.state);return kr.call(this,n.content,t,i)}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}const Lr={HORIZONTAL:"horizontal",VERTICAL:"vertical"},Sr=[{concept:{name:"stack-layout"},type:"layout",tags:[],projection:{type:"stack",orientation:"vertical",disposition:[{type:"attribute",name:"orientation"}]}}],Cr={orientation:null,args:null,init(e={}){const{orientation:t=Lr.HORIZONTAL,editable:i=!0,focusable:s=!1}=this.schema;return this.orientation=t,this.focusable=s,this.editable=i,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){this.orientation=e,this.refresh()},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["layout-container","stack-layout"],title:i,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let t=0;t<e.length;t++){let i=kr.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",St.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.container.style.display="flex",this.container.style.flexWrap="nowrap",this.refresh(),this.container},design(){return{concept:[{name:"stack-layout",nature:"concrete",attributes:[{name:"orientation",target:{name:"string",default:this.orientation,constraint:{values:["horizontal","vertical"]}}}]}],projection:Sr,handlers:{orientation:(e,t)=>{this.setOrientation(t)}}}},refresh(){return this.orientation===Lr.VERTICAL?this.container.style.flexDirection="column":this.orientation===Lr.HORIZONTAL&&(this.container.style.flexDirection="row"),this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,n.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,n.isNullOrUndefined)(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Tr=Object.assign({},tn,Cr),Ir={args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema;return this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["layout-container"],title:i,dataset:{nature:"layout",layout:"wrap",id:this.id}}));for(let t=0;t<e.length;t++){let i=kr.call(this,e[t],this.source,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",St.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="inline-flex",this.container.style.alignItems="baseline",this.refresh(),this.container},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,n.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,n.isNullOrUndefined)(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},Mr=Object.assign({},tn,Ir),Ur={elements:null,edit:!1,btnEdit:!1,btnCollapse:!1,menu:!1,collapsed:!1,init(e={}){const{editable:t=!0,collapsible:i=!1,focusable:s=!1}=this.schema;return this.focusable=s,this.collapsible=i,this.editable=t,this.elements=[],this.children=[],Object.assign(this,e),this},collapse(e){if(!this.collapsed)return this.collapseContainer=(0,n.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e){if(!this.collapsed)return;let t=(0,n.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!0,this.refresh(),this},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"table"}})),this.focusable?this.container.tabIndex=-1:this.container.dataset.ignore="all";for(let t=0;t<e.length;t++){let i=e[t],r=(0,n.createDiv)({class:["table-row"]});r.style.display="table-row";for(let e=0;e<i.length;e++){const t=i[e];let s=(0,n.createDiv)({class:["table-cell"]},kr.call(this,t.content));s.style.display="table-cell",St.call(this.projection,s,t.style),r.append(s)}s.append(r)}return St.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.container.style.display="table",this.refresh(),this.container},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},Dr=Object.assign({},tn,Ur),_r={ROW:"row",COLUMN:"column"},Br={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},Pr={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"},Hr={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{orientation:t=_r.ROW,wrappable:i=!0,alignItems:s,justifyContent:n,editable:r=!0,focusable:a=!1}=this.schema;return this.orientation=t,this.wrappable=i,this.alignItems=s,this.justifyContent=n,this.focusable=a,this.editable=r,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){(0,n.hasOwn)(_r,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=(0,n.createDiv)({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let t=(0,n.createDocFragment)(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=(0,n.createDocFragment)();(0,n.isHTMLElement)(this.container)||(this.container=(0,n.createDiv)({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),i&&(this.container.title=i);for(let t=0;t<e.length;t++){let i=kr.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",St.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=Pr[this.justifyContent],this.container.style.alignItems=Br[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=(0,n.getElement)('[tabindex]:not([tabindex="-1"])',this.container);if((0,n.isNullOrUndefined)(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},Vr=Object.assign({},tn,Hr),Rr={content:"",init(){return this},render(){const e=(0,n.createDocFragment)(),{content:t,attributes:i=[],link:s,dimensions:r={}}=this.schema;var a=new DOMParser;return(0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,class:[],dataset:{nature:"layout",view:"svg",id:this.id}})),this.element.setAttribute("tabIndex",0),this.focusable=!0,!(0,n.isHTMLElement)(this.content)&&t?(this.content=a.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)):(0,n.isHTMLElement)(this.content)||(this.content=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.appendChild(this.content)),(0,n.isEmpty)(i)||i.forEach((e=>{let t=kr.call(this,e.attribute);this.environment.resolveElement(t),e.marker?this.content.querySelector("[data-"+e.marker+"]").append(t):this.content.append(t)})),r.type&&(this.dimensions=r),e.hasChildNodes()&&this.element.appendChild(e),this.element},getWidth(){return Number(this.content.getAttribute("width"))},getHeight(){return Number(this.content.getAttribute("height"))},registerDimObsever(e){(0,n.isNullOrUndefined)(this.observers)&&(this.observers=[]),this.observers.push(e)},attributeHandler(e,t){switch(e.type){case"interactive":this.content.querySelector("[data-"+t+"]").append(e.content);break;case"text-svg":case"choice":break;default:let i=this.content.querySelector("[data-"+t+"]");e.element.append(e.element);let s=this.createHolder(e.element);i.append(s),this.adapt(e.element,e.ratio)}},createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreign");i.append(e),t.append(i)},adapt(e,t){let i=e.getBoundingClientRect();e.parentNode.setAttribute("width",i.width),e.parentNode.setAttribute("height",i.height);let s=e.parentNode.parentNode;if(!(0,n.isNullOrUndefined)(t)){let e=this.content.width.baseVal.value;this.content.height.baseVal.value,s.setAttribute("width",e*t),s.setAttribute("height",e*t)}},_attributeHandler(e){let t=[];return e.forEach((e=>{switch(e.placement.type){case"in-place":let i=this.content.querySelector("[data-"+e.placement.marker+"]");e.type="svg-attribute";let s=kr.call(this,e,null,this.args);(0,n.isNullOrUndefined)(e.property)||(s.property=propertyHandler(e.property)),t.push(s),i.appendChild(s.content);break;case"link-place":let{type:r,sd:a=[],dd:o=[]}=e.placement;(0,n.isNullOrUndefined)(this.linkAttr)&&(this.linkAttr=[]);let l={};l.name=e.value,l.field=this.informations.get(e.value),"list"===l.field.type?l.value=l.field.items:l.value=l.field.value,(0,n.isNullOrUndefined)(e.property)||(l.property=propertyHandler(e.property)),(0,n.isEmpty)(a)||(l.sd=new Map,a.forEach((e=>{e.type="template";const t={};var i=kr.call(this,e,null,this.args);t.render=i,t.parent=this.content.querySelector("[data-"+e.marker+"]"),l.sd.set(i.mv,t)}))),!(0,n.isNullOrUndefined)(this.dd)||(0,n.isEmpty)(o)||(0,n.isNullOrUndefined)(o)||(l.dd=[],o.forEach((e=>{e.type="template";var t=kr.call(this,e,null,this.args);l.dd.push(t),t.property=l.property;var i=this.content.querySelector("[data-"+e.marker+"]");(0,n.isNullOrUndefined)(i)?"before"===this.content.getAttribute("data-"+e.marker)?this.content.prepend(t.content):this.content.appendChild(t.content):"before"===i.getAttribute("data-"+e.marker)?i.prepend(t.content):i.appendChild(t.content)}))),this.linkAttr.push(l)}})),t},update(){(0,n.isNullOrUndefined)(this.linkAttr)||this.linkAttr.forEach((e=>{this.clearStatics(e.sd,e.value),(0,n.isNullOrUndefined)(e.property)?this.clearDynamics(e.dd,e.value):this.clearDynamics(e.dd,this.translateProperty(e.value,e.property)),"list"===e.field.type?e.value=e.field.items:e.value=e.field.value,(0,n.isNullOrUndefined)(e.property)?this.updateDynamics(e.dd,e.value):this.updateDynamics(e.dd,this.translateProperty(e.value,e.property)),this.updateStatics(e.sd,e.value)})),(0,n.isNullOrUndefined)(this.deciders)||(0,n.isEmpty)(this.deciders)||this.deciders.forEach((e=>{e.update(e.field.value)}))},clearDynamics(e,t){(0,n.isNullOrUndefined)(e)||e.forEach((e=>{e.clear(t)}))},updateDynamics(e,t){(0,n.isNullOrUndefined)(e)||e.forEach((e=>{e.update(t)}))},clearStatics(e,t){if(!(0,n.isNullOrUndefined)(e)){let i=e.get(t);(0,n.isNullOrUndefined)(i)||i.parent.removeChild(i.render.content)}},updateStatics(e,t){if(!(0,n.isNullOrUndefined)(e)){let i=e.get(t);(0,n.isNullOrUndefined)(i)||i.parent.appendChild(i.render.content)}},focus(){return this.element.focus(),this.focused=!0,(0,n.isNullOrUndefined)(this.deciders)||this.deciders.forEach((e=>{e.focusOut()})),this},focusIn(){return this.focus(),this},focusOut(){return this.focused=!1,this},arrowHandler(e,t){if(t===this.element)return!(0,n.isNullOrUndefined)(this.parent)&&this.parent.arrowHandler(e,this.element);let i=getClosestSVG(t.foreign,e,this,!1);return!(0,n.isNullOrUndefined)(i)&&(t.focusOut(),i.focus(),!0)},enterHandler(e){this.index=0,this.deciders[0].focusIn()},escapeHandler(e){if(e!==this.element)return this.focus();let t=(0,n.findAncestor)(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return i&&i.focus(t),!1},getDimensions(){if("absolute"===this.dimensions.type)return{height:this.dimensions.height,width:this.dimensions.width}},setIndex(e){let t=0;this.deciders.forEach((i=>{i.id!==e.id?t++:this.index=t}))}},$r=Object.assign(Object.create(tn),Rr);function Fr(e){const{placeholder:t="",type:i}=e;let s=Er.call(this,t);return this.readonly||this.resizable?(0,n.createSpan)({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:s,dataset:{placeholder:s,nature:"field-component",view:this.type,id:this.id}}):this.multiline?(0,n.createTextArea)({class:["field--textbox__input"],placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}}):(0,n.createInput)({class:["field--textbox__input"],type:(0,n.valOrDefault)(i,"text"),placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}})}const qr={init(){return this},render(){const e=(0,n.createDocFragment)(),{current:t={},root:i}=this.schema;this.isRoot=i;var s=new DOMParser;if((0,n.isHTMLElement)(this.element)||(this.element=(0,n.createDiv)({id:this.id,dataset:{nature:"layout",view:"visualizer",id:this.id}})),!(0,n.isHTMLElement)(this.content)&&(this.svg=this.source.value,!(0,n.isNullOrUndefined)(this.svg))){if(this.content=s.parseFromString(this.svg.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,"svg"!==this.content.tagName){let e=s.parseFromString('<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"/>',"image/svg+xml").documentElement;e.appendChild(this.content),this.content=e}e.appendChild(this.content)}if(!(0,n.isHTMLElement)(this.input)){const{placeholder:i="",type:s,style:n}=t;this.input=Fr.call(this,t),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",St.call(this,this.input,n),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}if(i&&(0,n.isNullOrUndefined)(this.buttons)){this.buttons=[];const t={type:"static",static:{type:"button",trigger:"make interactive",content:[{type:"static",static:{type:"text",content:"Interactive",focusable:!0}}]}};this.mkeInteractive=kr.call(this,t,null,this.args);let i=this.environment.resolveElement(this.mkeInteractive);i.parent=this,i.visualizer=this,this.buttons.push(i),e.append(this.mkeInteractive);const s={type:"static",static:{type:"button",trigger:"make dynamic",content:[{type:"static",static:{type:"text",content:"Dynamic",focusable:!0}}]}};this.mkeDynamic=kr.call(this,s,null,this.args),i=this.environment.resolveElement(this.mkeDynamic),i.visualizer=this,i.parent=this,this.buttons.push(i),e.append(this.mkeDynamic);const n={type:"static",static:{type:"button",trigger:"make static",content:[{type:"static",static:{type:"text",content:"Static",focusable:!0}}]}};this.mkeStatic=kr.call(this,n,null,this.args),i=this.environment.resolveElement(this.mkeStatic),i.visualizer=this,i.parent=this,this.buttons.push(i),e.append(this.mkeStatic)}return e.hasChildNodes()&&this.element.appendChild(e),this.bindEvent(),this.element},focusIn(e){return this.input.focus()},focusOut(){},createProj(){let e=this.current;"tspan"===e.tagName.toLowerCase()&&(e=e.parentNode);let t=new XMLSerializer;return this.cleanInput(),this.updateInput(t.serializeToString(this.content)),'<g xmlns="http://www.w3.org/2000/svg">'+t.serializeToString(e)+"</g>"},cleanInput(){this.input.value="",this.current.parentNode.removeChild(this.current)},updateInput(e){this.source.setValue(e)},bindEvent(){this.content.addEventListener("click",(e=>{var t=new XMLSerializer;let i=e.target;"tspan"===i.tagName.toLowerCase()&&(i=i.parentNode);var s=t.serializeToString(i);this.input.value=s,this.current=i})),this.input.addEventListener("keydown",(e=>{if(""!==this.input.value&&!(0,n.isNullOrUndefined)(this.current)&&"Enter"===e.key){var t=(new DOMParser).parseFromString(this.input.value.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement;this.current!==this.content?this.current.replaceWith(t):this.content=t,this.current=t;var i=new XMLSerializer;this.isRoot?this.updateInput(i.serializeToString(this.content)):this.updateInput(i.serializeToString(this.content.childNodes[0]))}}))}},zr=Object.assign(Object.create(tn),qr),{createDocFragment:Wr,isNullOrUndefined:Kr,isEmpty:Xr,isHTMLElement:Yr}=s(835),Jr={init(){const{coordinates:e=null,dimensions:t=null}=this.schema;return this.coordinates=e,this.dimensions=t,this},render(){const{content:e}=this.schema,t=Wr();return Kr(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("layout-container"),this.container.dataset.nature="layout",this.container.dataset.layout="holder",this.container.dataset.id=this.id),Kr(this.foreign)&&(this.foreign=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),t.append(this.foreign)),Kr(this.content)&&!Xr(e)&&(this.content=new Map,e.forEach((e=>{switch(e.type){case"projection":let t=this.projection.model.createProjection(this.projection.concept.getValue(!0),e.tag).init().render(),i=this.projection.resolveElement(t);this.element=t,this.foreign.append(t),this.content.set(e.correspondance,{render:t,projection:i});break;case"attribute":this.container.append(kr.call(this,e))}}))),t.hasChildNodes()&&this.container.append(t),this.bindEvents(),this.container},registerRelative(e){this.apply=e.apply,this.relative=!0,"duo"===e.listen.type&&(this.from=this.source.getValue(!0).getAttributeByName(e.listen.from).target,this.from.register(this.projection),this.to=this.source.getValue(!0).getAttributeByName(e.listen.to).target,this.to.register(this.projection),this.rtag=this.environment.getActiveReceiver(e.rtag))},adapt(){},getDimensions(){return{width:this.dimensions.width,height:this.dimensions.height}},placeItem(e){"delegate"===this.coordinates.type&&(this.container.setAttribute("x",e.schema.coordinates.x),this.container.setAttribute("y",e.schema.coordinates.y))},setDimensions(){if(this.relative){let e=this.rtag.container.querySelector('[data-concept="'+this.from.value+'"]'),t=this.rtag.container.querySelector('[data-concept="'+this.to.value+'"]'),i=this.rtag.container.createSVGPoint(),s=e.getBoundingClientRect();i.x=s.x,i.y=s.y;let n=i.matrixTransform(this.rtag.container.getScreenCTM().inverse());s=t.getBoundingClientRect(),i.x=s.x,i.y=s.y;let r=i.matrixTransform(this.rtag.container.getScreenCTM().inverse()),a=n.x-r.x,o=n.y-r.y,l=Math.sqrt(a*a+o+o);this.width=l,this.container.setAttribute("width",this.width),this.container.setAttribute("height",30),this.foreign.setAttribute("width",this.width),this.foreign.setAttribute("height",30),this.container.setAttribute("x",n.x),this.container.setAttribute("y",n.y),this.projection.resolveElement(this.element).setDimensions(this.width)}else this.adapt(),this.parent.notify(this.container)},setHolder(e,t){this.container.setAttribute("width",e),Kr(t)?this.container.setAttribute("height",e*this.height/this.width):this.container.setAttribute("height",t)},bindEvents(){this.projection.registerHandler("value.changed",(e=>{})),this.projection.registerHandler("displayed",(e=>{let{render:t,projection:i}=this.content.get(this.source.value);this.element=t,this.foreign.append(this.element),this.setDimensions(),this.coordinates&&this.placeItem(i)}))}},Gr=Object.assign(Object.create(tn),Jr);var Qr=0;const Zr=()=>"layout"+Qr++,ea={stack:(e,t,i)=>Object.create(Tr,{object:{value:"layout"},name:{value:"stack-layout"},type:{value:"stack"},id:{value:Zr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),wrap:(e,t,i)=>Object.create(Mr,{object:{value:"layout"},name:{value:"wrap-layout"},type:{value:"wrap"},id:{value:Zr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),table:(e,t,i)=>Object.create(Dr,{object:{value:"layout"},name:{value:"table-layout"},type:{value:"table"},id:{value:Zr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),flex:(e,t,i)=>Object.create(Vr,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:Zr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),svg:(e,t,i)=>Object.create($r,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:Zr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),visualizer:(e,t,i)=>Object.create(zr,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:Zr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(e,t,i)=>Object.create(Gr,{object:{value:"layout"},name:{value:"holder-layout"},type:{value:"holder"},id:{value:Zr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},ta={createLayout(e,t,i){const{type:s}=t,r=ea[s];if((0,n.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${s}' layout could not be handled`);const a=r(e,t,i);if((0,n.isNullOrUndefined)(a))throw new Error(`Bad request: The '${s}' layout could not be created`);return a.createLayout=this.createLayout,(0,n.isNullOrUndefined)(a.id)&&(a.id=Zr()),a}},ia={stylePath(e){const{stroke:t="black",dasharray:i=null,width:s=1,linecap:r="butt",end:a=!1,start:o=!1}=e;this.path.style.stroke=t,(0,n.isNullOrUndefined)(i)||(this.path.style["stroke-dasharray"]=i),this.path.style["stroke-width"]=(0,n.valOrDefault)(s,5),this.path.style["stroke-linecap"]=r,a&&this.createMarkerEnd()},styleSubPath(e,t){const{stroke:i="black",dasharray:s=null,width:r=1,linecap:a="butt",end:o=!1,start:l=!1}=e;t.style.stroke=i,(0,n.isNullOrUndefined)(s)||(t.style["stroke-dasharray"]=s),t.style["stroke-width"]=(0,n.valOrDefault)(r,5),t.style["stroke-linecap"]=a},createMarkerEnd(){(0,n.isNullOrUndefined)(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.end=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.end.id="marker"+this.id,this.end.setAttribute("refY",5),this.end.setAttribute("refX",10),this.end.setAttribute("markerUnit","strokeWidth"),this.end.setAttribute("markerWidth",10),this.end.setAttribute("markerHeight",10),this.end.setAttribute("orient","auto"),this.end.classList.add("end");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.end.appendChild(e),this.definitions.appendChild(this.end),this.path.setAttribute("marker-end","url(#"+this.end.id+")")},setPath(e){this.path.setAttribute("d",e)}},sa={init(){return this},render(){const{aiming:e,model:t,move:i,decorator:s=!1,style:r}=this.schema;return(0,n.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="anchor",this.path.dataset.id=this.id),(0,n.isNullOrUndefined)(this.aiming)&&(this.aiming=this.source.getAttributeByName(e.name).target),(0,n.isNullOrUndefined)(this.anchorModel)&&(this.anchorModel=t,Ci.AnchorHandler.registerListener(t,this)),i&&(this.movingPiece=this.source.getAttributeByName(i.name).target,this.movingPiece.register(this)),s&&(0,n.isNullOrUndefined)(this.decorator)&&this.createDecorator(s),this.bind=this.projection.bind,this.bindEvents(),this.stylePath(r),this.path},update(){if(!(0,n.isNullOrUndefined)(this.movingPiece)&&this.movingPiece.hasValue()){let e=this.movingPiece.getValue();(0,n.isString)(e)&&(e=this.movingPiece.getValue(!0)),e.notify("accept",this.bind),(0,n.isNullOrUndefined)(this.path.parenNode)||e.notify("cover",this)}},deleteFromView(){Ci.AnchorHandler.unregister(this.anchorModel,this),this.movingPiece=null,this.path.remove(),this.decorator.remove()},createDecorator(e){this.decorator=kr.call(this,e.render)},updateValue(){if(!this.aiming.hasValue())return this.path.remove(),this.decorator.remove(),void this.definitions.remove();let e=this.aiming.value.id||this.aiming.value,t=Ci.AnchorHandler.findSource(this.anchorModel,this.bind.element||this.bind.container),i=Ci.AnchorHandler.findTarget(this.anchorModel,e,t.index);if(this.schema.offset&&(t.x+=this.schema.offset.x,t.y+=this.schema.offset.y,i.x+=this.schema.offset.x,i.y+=this.schema.offset.y),this.decorator){const{origin:e,x:s,y:n}=this.schema.decorator.coordinates;switch(e){case"source":this.decorator.setAttribute("x",t.x+s),this.decorator.setAttribute("y",t.y+n),this.projection.parent.container.append(this.decorator);break;case"target":this.decorator.setAttribute("x",i.x+s),this.decorator.setAttribute("y",i.y+n),this.projection.parent.container.append(this.decorator);break;case"minX":t.x<i.x?(this.decorator.setAttribute("x",t.x+s),this.decorator.setAttribute("y",t.y+n)):(this.decorator.setAttribute("x",i.x+s),this.decorator.setAttribute("y",i.y+n)),this.projection.parent.container.append(this.decorator);break;case"minY":t.y<i.y?(this.decorator.setAttribute("x",t.x+s),this.decorator.setAttribute("y",t.y+n)):(this.decorator.setAttribute("x",i.x+s),this.decorator.setAttribute("y",i.y+n)),this.projection.parent.container.append(this.decorator);break;case"maxX":t.x>i.x?(this.decorator.setAttribute("x",t.x+s),this.decorator.setAttribute("y",t.y+n)):(this.decorator.setAttribute("x",i.x+s),this.decorator.setAttribute("y",i.y+n)),this.projection.parent.container.append(this.decorator);break;case"maxY":t.y>i.y?(this.decorator.setAttribute("x",t.x+s),this.decorator.setAttribute("y",t.y+n)):(this.decorator.setAttribute("x",i.x+s),this.decorator.setAttribute("y",i.y+n)),this.projection.parent.container.append(this.decorator)}}if(t.x===i.x&&t.y===i.y?this.setSelfPath(t):this.setPath("M "+t.x+" "+t.y+" L "+i.x+" "+i.y),this.definitions&&this.projection.parent.container.append(this.definitions),this.projection.parent.container.prepend(this.path),this.decorator&&this.environment.resolveElement(this.decorator).projection.update("displayed"),this.calcS=t.calc,this.calcT=i.calc,this.movingPiece&&this.movingPiece.hasValue()){let e=this.movingPiece.value;(0,n.isString)(e)&&(e=this.movingPiece.getValue(!0)),e.notify("cover",this)}},setSelfPath(e){const t=this.schema.self.points;let i={x:e.x,y:e.y},s="M "+e.x+" "+e.y+" ";for(let e=0;e<t.length;e++){const{x:n,y:r}=t[e];s+=" L "+(i.x+n)+" "+(i.y+r)+" ",i.x+=n,i.y+=r}this.path.setAttribute("d",s),this.path.setAttribute("fill","transparent")},bindEvents(){this.aiming.register(this.projection),this.projection.registerHandler("value.changed",(e=>{this.updateValue(e)}))}},na=Object.assign({},ia,sa),ra={init(){return this},render(){const{style:e,from:t,to:i,decorator:s}=this.schema;return(0,n.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="force",this.path.dataset.id=this.id),(0,n.isNullOrUndefined)(this.from)&&this.registerAttribute(t,!0),(0,n.isNullOrUndefined)(this.to)&&this.registerAttribute(i),e&&this.stylePath(e),s&&(0,n.isNullOrUndefined)(this.decorator)&&(this.decorator=kr.call(this,s)),this.bindEvents(),this.path},registerAttribute(e,t=!1){const{name:i}=e;t?this.from=this.source.getAttributeByName(i).target:this.to=this.source.getAttributeByName(i).target},updateValue(){this.fromVal=this.from.value,this.toVal=this.to.value,(0,n.isNullOrUndefined)(this.fromVal)||(0,n.isNullOrUndefined)(this.toVal)?(0,n.isNullOrUndefined)(this.path.parentNode)||this.projection.parent.removeArrow(this,-1,this.decorator):this.projection.parent.addArrow(this,this.fromVal,this.toVal,this.decorator)},setPath(e){this.path.setAttribute("d",e)},bindEvents(){this.from.register(this.projection),this.to.register(this.projection),this.projection.registerHandler("value.changed",(()=>{this.updateValue()}))}},aa=Object.assign({},ia,ra),oa={minY:function(e){let t=e[0].y,i=e[0].x,s=e[0].x;for(let n=0;n<e.length;n++){const{x:r,y:a}=e[n];r<i&&(i=r),r>s&&(s=r),a<t&&(t=a)}this.setPath("M "+i+" "+t+" L "+s+" "+t),this.drawSupPath(e,t,!1)}},la={init(){return this.subPath=[],this.targets=[],this.elements=[],this},render(){const{style:e}=this.schema;return(0,n.isNullOrUndefined)(this.path)&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("arrow-path"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="multi",this.path.dataset.id=this.id),this.bindEvents(),this.stylePath(e),this.path},addTarget(e){this.targets=[],this.elements.forEach((e=>{e.hasValue()&&this.targets.push(e.getValue())})),this.targets.length>1&&(this.drawPath(),this.projection.parent.container.append(this.path),this.subPath.forEach((e=>{this.projection.parent.container.append(e)})))},drawSupPath(e,t,i){(0,n.isEmpty)(this.subPath)||(this.subPath.forEach((e=>{e.remove()})),this.subPath=[]),e.forEach((e=>{if(e.y===t&&!i)return;if(e.x===t&&i)return;let s=document.createElementNS("http://www.w3.org/2000/svg","path");this.path.classList.add("arrow-subpath"),this.path.dataset.nature="arrow",this.path.dataset.algorithm="multi",this.path.dataset.id=this.id,i||s.setAttribute("d","M "+e.x+" "+t+" L "+e.x+" "+e.y),this.styleSubPath(this.schema.subpath.style,s),this.subPath.push(s)}))},drawPath(){const e=this.projection.parent.container;let t=[];for(let i=0;i<this.targets.length;i++){const s=this.targets[i];let r=e.querySelector("[data-concept='"+s+"']"),a=this.projection.resolveElement(r);if((0,n.isNullOrUndefined)(r))return;t.push({item:r,proj:a})}let i=[];for(let s=0;s<t.length;s++){let r=t[s].item.getBoundingClientRect();const a=e.createSVGPoint();a.x=r.x,a.y=r.y;const o=a.matrixTransform(e.getScreenCTM().inverse());(0,n.isNullOrUndefined)(t[s].proj.attachPoint)?i.push({x:o.x,y:o.y}):i.push({x:o.x+t[s].proj.attachPoint.x,y:o.y+t[s].proj.attachPoint.y})}oa[this.schema.meet].call(this,i)},removeTarget(e){(0,n.isNullOrUndefined)(this.targets)},registerElem(e){(0,n.isNullOrUndefined)(this.elements)&&(this.elements=[]),this.elements.push(e),e.register(this.projection)},unregisterElem(e){for(let t=0;t<this.elements.length;t++)if(this.elements[t]===e){this.elements[t].unregister(this.projection),this.elements.splice(t,1);break}this.elements.length>1?this.addTarget():(this.path.remove(),(0,n.isEmpty)(this.subPath)||this.subPath.forEach((e=>{e.remove()})))},deletePaths(){this.path.remove(),(0,n.isEmpty)(this.subPath)||this.subPath.forEach((e=>{e.remove()}))},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.registerElem(e)})),this.projection.registerHandler("value.removed",(e=>{this.unregisterElem(e)})),this.projection.registerHandler("value.changed",(e=>{this.addTarget(e)}))}},ca=Object.assign({},ia,la);var ha=0;const ua=()=>"algo"+ha++,da={force:(e,t,i)=>Object.create(aa,{object:{value:"arrow"},name:{value:"force-arrow"},type:{value:"force"},id:{value:ua()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),anchor:(e,t,i)=>Object.create(na,{object:{value:"arrow"},name:{value:"anchor-arrow"},type:{value:"anchor"},id:{value:ua()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),multi:(e,t,i)=>Object.create(ca,{object:{value:"arrow"},name:{value:"multi-arrow"},type:{value:"multi"},id:{value:ua()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},pa={createArrow(e,t,i){const{type:s}=t,r=da[s];if((0,n.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${s}' arrow could not be handled`);const a=r(e,t,i);if((0,n.isNullOrUndefined)(a))throw new Error(`Bad request: The '${s}' arrow could not be created`);return a.createArrow=this.createArrow,(0,n.isNullOrUndefined)(a.id)&&(a.id=ua()),a}},ma={},{isNullOrUndefined:fa,valOrDefault:ga}=s(835),ba={init(){return this},render(){const{content:e}=this.schema;return fa(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="canas",this.container.dataset.id=this.id),fa(e)||e.forEach((e=>{this.container.append(kr.call(this,e))})),this.w=this.source.getAttributeByName("width").target,this.h=this.source.getAttributeByName("height").target,this.minX=this.source.getAttributeByName("minX").target,this.minY=this.source.getAttributeByName("minY").target,this.windowW=this.source.getAttributeByName("windowW").target,this.windowH=this.source.getAttributeByName("windowH").target,this.container.style.border="solid #87a1ff",this.refresh(),this.bindEvents(),this.container},refresh(){this.container.setAttribute("width",this.w.value),this.container.setAttribute("height",this.h.value);const e=ga(this.windowW.value,this.w.value),t=ga(this.windowH.value,this.h.value);this.container.setAttribute("viewBox",this.minX.value+" "+this.minY.value+" "+e+" "+t)},update(){this.refresh()},bindEvents(){this.w.register(this),this.h.register(this),this.minX.register(this),this.minY.register(this),this.windowW.register(this),this.windowH.register(this),this.container.addEventListener("click",(e=>{const t=e.target,{concept:i=null,nature:s=null,shape:n=null}=t.dataset;fa(s)||"shape"!==s||"canvas"===n||this.source.getAttributeByName("current").setValue(i)}))},focusIn(){},focusOut(){},clickHandler(e){}},va=Object.assign(Object.create(ma),ba),{isNullOrUndefined:ya,isEmpty:wa}=s(835),xa={init(){return this.items=[],this},render(){const{add:e}=this.schema;return ya(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="group",this.container.dataset.id=this.id),e&&(this.addButton=kr.call(this,{kind:"static",type:"svg-button",action:{type:"CREATE"},content:'<svg style="overflow:visible" xmlns="http://www.w3.org/2000/svg" version="1.0"><text style="dominant-baseline:hanging;" font-family="Segoe UI" font-size="16">+</text></svg>'}),this.container.append(this.addButton)),wa(this.source)||this.reconstruct(),this.bindEvents(),this.container},reconstruct(){let e=this.source.value;for(let t=0;t<e.length;t++){let i=this.projection.environment.conceptModel.getConcept(e[t]).getValue(!0),s=this.model.createProjection(i,"shape");s.parent=this.projection;let n=s.init().render();this.items.push({concept:s.concept,projection:n,centered:!0}),s.concept.register(this.projection),this.container.append(n),this.blur()}},createItem(e){let t=this.model.createProjection(e,"shape");t.parent=this.projection;let i=t.init().render();return this.items.push({concept:t.concept,projection:i,centered:!1}),t.concept.register(this.projection),this.blur(),i},addItem(e){let t=this.createItem(e);this.container.append(t)},removeItem(e){for(let t=0;t<this.items.length;t++)if(this.items[t].concept.id===e.id)return this.items[t].projection.remove(),ya(this.items[t].container)||this.items[t].container.remove(),void this.items.splice(t,1)},update(){for(let e=0;e<this.items.length;e++)this.items[e].centered||this.center(this.items[e]),this.items[e].centered=!0},center(e){const t=e.concept.getValue(!0),i=this.getWindow();switch(t.name){case"circle":t.getAttributeByName("cx").setValue((i.minX+i.vW)/2),t.getAttributeByName("cy").setValue((i.minY+i.vH)/2),t.getAttributeByName("r").setValue(20*i.vW/i.width);break;case"rectangle":const e=40*i.vW/i.width,s=30*i.vH/i.height;t.getAttributeByName("x").setValue((i.minX+i.vW)/2-e/2),t.getAttributeByName("y").setValue((i.minY+i.vH)/2-s/2),t.getAttributeByName("width").setValue(e),t.getAttributeByName("height").setValue(s);break;case"ellipse":const n=40*i.vW/(2*i.width),r=30*i.vH/(2*i.height);t.getAttributeByName("cx").setValue((i.minX+i.vW)/2),t.getAttributeByName("cy").setValue((i.minY+i.vH)/2),t.getAttributeByName("rx").setValue(n),t.getAttributeByName("ry").setValue(r);break;case"polygon":const a=40*i.vW/(2*i.width),o=30*i.vH/(2*i.height),l=(i.minX+i.vW)/2,c=(i.minY+i.vH)/2,h={x:l-a/4,y:c-o/2},u={x:l+a/4,y:c-o/2},d={x:l+a/2,y:c-o/4},p={x:l+a/2,y:c+o/4},m={x:l+a/4,y:c+o/2},f={x:l-a/4,y:c+o/2},g={x:l-a/2,y:c+o/4},b={x:l-a/2,y:c-o/4};t.getAttributeByName("points").setValue(h.x+" "+h.y+", "+u.x+" "+u.y+", "+d.x+" "+d.y+", "+p.x+" "+p.y+", "+m.x+" "+m.y+", "+f.x+" "+f.y+", "+g.x+" "+g.y+", "+b.x+" "+b.y);break;case"path":const v=40*i.vW/(2*i.width),y=(i.vH,i.height,(i.minX+i.vW)/2),w=(i.minY+i.vH)/2;t.getAttributeByName("d").setValue("M "+(y-v/2)+" "+w+" L "+(y+v/2)+" "+w)}let s=this.model.createProjection(t,"shape");s.parent=this.projection;let n=s.init().render();this.container.append(n),e.container=n},focusIn(){},focusOut(){},blur(){},getWindow(){const e=this.container.parentNode,t=e.viewBox.baseVal;return{width:Number(e.getAttribute("width")),height:Number(e.getAttribute("height")),vW:t.width,vH:t.height,minX:t.x,minY:t.y}},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)}))}},Ea=Object.assign(Object.create(ma),xa),{isNullOrUndefined:Aa}=s(835),Oa={init(){return this},render(){return Aa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="circle",this.element.dataset.id=this.id),this.cx=this.source.getAttributeByName("cx").target,this.cy=this.source.getAttributeByName("cy").target,this.r=this.source.getAttributeByName("r").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("cx",this.cx.value),this.element.setAttribute("cy",this.cy.value),this.element.setAttribute("r",this.r.value)},bindEvents(){this.cx.register(this),this.cy.register(this),this.r.register(this),this.element.addEventListener("click",(()=>{this.source.notify("current.updated",this.source)}))},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.width=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},update(e){this.refresh(),Aa(this.fill.value)||this.element.setAttribute("fill",this.fill.value),Aa(this.stroke.value)||this.element.setAttribute("stroke",this.stroke.value),Aa(this.width.value)||(this.element.style["stroke-width"]=this.width.value),Aa(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},focusIn(){},focusOut(){}},Na=Object.assign(Object.create(ma),Oa),{isNullOrUndefined:ka}=s(835),ja={init(){return this},render(){return ka(this.container)&&(this.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.classList.add("shape-container"),this.container.dataset.nature="shape",this.container.dataset.shape="group",this.container.dataset.id=this.id),this.bindEvents(),this.container.style.overflow="visible",this.container},bindEvents(){this.projection.registerHandler("value.changed",(e=>{let t=this.model.createProjection(this.source.getValue(!0),"shape");t.parent=this.projection;let i=t.init().render();this.container.append(i)}))}},La=Object.assign(Object.create(ma),ja),{isNullOrUndefined:Sa}=s(835),Ca={init(){return this},render(){return Sa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="circle",this.element.dataset.id=this.id),this.x=this.source.getAttributeByName("x").target,this.y=this.source.getAttributeByName("y").target,this.width=this.source.getAttributeByName("width").target,this.height=this.source.getAttributeByName("height").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("x",this.x.value),this.element.setAttribute("y",this.y.value),this.element.setAttribute("height",this.height.value),this.element.setAttribute("width",this.width.value)},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.widthS=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.rx=e.getAttributeByName("rx").target,this.ry=e.getAttributeByName("ry").target,this.fill.register(this),this.stroke.register(this),this.widthS.register(this),this.dash.register(this),this.rx.register(this),this.ry.register(this)},update(e){this.refresh(),Sa(this.fill.value)||this.element.setAttribute("fill",this.fill.value),Sa(this.stroke.value)||(this.element.style.stroke=this.stroke.value),Sa(this.widthS.value)||(this.element.style["stroke-width"]=this.widthS.value),Sa(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value),Sa(this.rx.value)||this.element.setAttribute("rx",this.rx.value),Sa(this.ry.value)||this.element.setAttribute("ry",this.ry.value)},bindEvents(){this.x.register(this),this.y.register(this),this.width.register(this),this.height.register(this)}},Ta=Object.assign(Object.create(ma),Ca),{isNullOrUndefined:Ia}=s(835),Ma={init(){return this},render(){return Ia(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="ellipse",this.element.dataset.id=this.id),this.cx=this.source.getAttributeByName("cx").target,this.cy=this.source.getAttributeByName("cy").target,this.rx=this.source.getAttributeByName("rx").target,this.ry=this.source.getAttributeByName("ry").target,this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("cx",this.cx.value),this.element.setAttribute("cy",this.cy.value),this.element.setAttribute("ry",this.ry.value),this.element.setAttribute("rx",this.rx.value)},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.width=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},update(e){this.refresh(),Ia(this.fill.value)||this.element.setAttribute("fill",this.fill.value),Ia(this.stroke.value)||(this.element.style.stroke=this.stroke.value),Ia(this.width.value)||(this.element.style["stroke-width"]=this.width.value),Ia(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},bindEvents(){this.cx.register(this),this.cy.register(this),this.rx.register(this),this.ry.register(this)}},Ua=Object.assign(Object.create(ma),Ma),{isNullOrUndefined:Da}=s(835),_a={init(){return this},render(){return Da(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","polygon"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="polygon",this.element.dataset.id=this.id),this.points=this.source.getAttributeByName("points").target,this.refresh(),this.bindEvents(),this.element},refresh(){this.element.setAttribute("points",this.points.value)},update(e){this.refresh()},bindEvents(){this.points.register(this)}},Ba=Object.assign(Object.create(ma),_a),{isNullOrUndefined:Pa}=s(835),Ha={init(){return this},render(){return Pa(this.element)&&(this.element=document.createElementNS("http://www.w3.org/2000/svg","path"),this.element.classList.add("shape-container"),this.element.dataset.nature="shape",this.element.dataset.shape="path",this.element.dataset.id=this.id),this.d=this.source.getAttributeByName("d").target,this.element.style["stroke-width"]=5,this.element.style.stroke="black",this.source.getAttributeByName("style").target.getAttributeByName("s-width").setValue(5),this.refresh(),this.bindEvents(),this.bindStyle(),this.element},refresh(){this.element.setAttribute("d",this.d.value)},bindEvents(){this.d.register(this)},bindStyle(){},update(e){this.refresh(),Pa(this.stroke.value)||this.element.setAttribute("fill",this.fill.value),Pa(this.stroke.value)||(this.element.style.stroke=this.stroke.value),Pa(this.width.value)||(this.element.style["stroke-width"]=this.width.value),Pa(this.dash.value)||(this.element.style["stroke-dasharray"]=this.dash.value)},bindStyle(){const e=this.source.getAttributeByName("style").target;this.fill=e.getAttributeByName("fill").target,this.stroke=e.getAttributeByName("stroke").target,this.width=e.getAttributeByName("s-width").target,this.dash=e.getAttributeByName("s-dash").target,this.fill.register(this),this.stroke.register(this),this.width.register(this),this.dash.register(this)},focusIn(){},focusOut(){}},Va=Object.assign(Object.create(ma),Ha);var Ra=0;const $a=()=>"algo"+Ra++,Fa={canvas:(e,t,i)=>Object.create(va,{object:{value:"shape"},name:{value:"canvas-shape"},type:{value:"canvas"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),group:(e,t,i)=>Object.create(Ea,{object:{value:"shape"},name:{value:"group-shape"},type:{value:"group"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),circle:(e,t,i)=>Object.create(Na,{object:{value:"shape"},name:{value:"circle-shape"},type:{value:"circle"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),holder:(e,t,i)=>Object.create(La,{object:{value:"shape"},name:{value:"holder-shape"},type:{value:"holder"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),rectangle:(e,t,i)=>Object.create(Ta,{object:{value:"shape"},name:{value:"rectangle-shape"},type:{value:"rectangle"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),ellipse:(e,t,i)=>Object.create(Ua,{object:{value:"shape"},name:{value:"ellipse-shape"},type:{value:"ellipse"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),polygon:(e,t,i)=>Object.create(Ba,{object:{value:"shape"},name:{value:"polygon-shape"},type:{value:"polygon"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),path:(e,t,i)=>Object.create(Va,{object:{value:"shape"},name:{value:"path-shape"},type:{value:"path"},id:{value:$a()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},qa={createShape(e,t,i){const{type:s}=t,r=Fa[s];if((0,n.isNullOrUndefined)(r))throw new TypeError(`Missing handler: The '${s}' shape could not be handled`);const a=r(e,t,i);if((0,n.isNullOrUndefined)(a))throw new Error(`Bad request: The '${s}' shape could not be created`);return a.createShape=this.createShape,(0,n.isNullOrUndefined)(a.id)&&(a.id=$a()),a}};var za=0;const Wa={createProjection(e,t,i,s){var r=Object.create(Ka,{id:{value:(0,n.valOrDefault)(t.id,"projection"+za++)},model:{value:e},schema:{value:t,writable:!0},environment:{value:s}});return r.concept=i,r}},Ka={handlers:null,init(e={}){return this.containers=new Map,this.attributes=[],this.params=[],this.templates=[],this.handlers={},this.args=e,this.concept.register(this),this},schema:null,concept:null,environment:null,parent:null,containers:null,placeholder:null,element:null,attributes:null,params:null,index:0,editing:!1,optional:!1,collapsible:!1,searchable:!1,focusable:!0,get hasMultipleViews(){return this.schema.length>1},get isReadOnly(){return(0,n.valOrDefault)(this.getSchema().readonly,!1)},isRoot(){return(0,n.isNullOrUndefined)(this.parent)},getSchema(e){return this.schema[(0,n.valOrDefault)(e,this.index)]},hasSchema(e){return-1!==this.schema.findIndex((t=>t.tags.includes(e)))},getContainer(e){return this.containers.get((0,n.valOrDefault)(e,this.index))},getStyle(){const{style:e}=this.getSchema();return e},addTemplate(e){this.templates.push(e)},addParam(e){this.params.push(...Array.isArray(e)?e:[e])},getParam(e,t){let i=this.params.find((t=>t.name===e));if((0,n.isNullOrUndefined)(i))return;const{type:s="string",value:r}=i;let a=(0,n.valOrDefault)(r,i.default);return(0,n.isNullOrUndefined)(a)?null:"string"===s?a.toString():"number"===s?+a:"boolean"===s?(0,n.toBoolean)(a):void 0},getParent(){return this.isRoot()?null:this.parent},getAttributes(e){return this.attributes.filter((t=>t.name===e))},getField(e){return this.environment.getField(e)},getStatic(e){return this.environment.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},resolveElement(e){return this.environment.resolveElement(e)},getHandlers(e){return(0,n.valOrDefault)(this.handlers[e],[])},update(e,t,i){if((0,n.isEmpty)(this.containers))return;if("delete"===e&&i.parent!==this.concept)return void this.delete();const s=this.getHandlers(e);switch((0,n.isEmpty)(s)||s.forEach((e=>{e(t,i)})),e){case"attribute.added":return void this.getAttributes(t.name).forEach((e=>{const{schema:i}=e,s=this.model.createProjection(t.target,i.tag).init();s.parent=this,s.optional=!0;const n=s.render();St.call(this,n,i.style),s.element.parent=e.parent,e.element=n,e.placeholder&&(e.placeholder.after(n),d(e.placeholder))}));case"attribute.removed":return void this.getAttributes(t.name).forEach((e=>{e.element&&((0,n.removeChildren)(e.element).remove(),e.element=null),e.placeholder&&u(e.placeholder)}))}},delete(){return this.concept&&this.concept.unregister(this),this.placeholder&&this.getContainer().after(this.placeholder),this.containers.forEach((e=>{if((0,n.removeChildren)(e),(0,n.isHTMLElement)(e)&&e.remove(),"path"===e.tagName){if("force"===e.dataset.algorithm){let t=this.environment.resolveElement(e);t.projection.parent.removeArrow(t)}"anchor"===e.dataset.algorithm&&this.environment.resolveElement(e).deleteFromView(),"multi"===e.dataset.algorithm&&this.environment.resolveElement(e).deletePaths()}["svg","text"].includes(e.tagName)&&e.remove(),this.sibling&&this.sibling.delete()})),this.model.removeProjection(this.id),!0},registerHandler(e,t){return Array.isArray(this.handlers[e])||(this.handlers[e]=[]),this.handlers[e].push(t),!0},unregisterHandler(e,t){if(!(0,n.hasOwn)(this.handlers,e))return!1;for(let i=0;i<this.handlers[e].length;i++)if(this.handlers[e][i]===t)return this.handlers[e].splice(i,1),!0;return!1},focus(){this.element.focus()},render(){const e=this.getSchema();if((0,n.isNullOrUndefined)(e))return null;const{type:t,projection:i,content:s,kind:r,sibling:a,rtag:o,ratio:l}=e;var c=null;if("layout"===t||"layout"===r)this.element=ta.createLayout(this.model,(0,n.valOrDefault)(i,s),this).init(this.args),this.model.registerLayout(this.element);else if("field"===t||"field"===r){let t=(0,n.hasOwn)(e,"field")?e.field:(0,n.valOrDefault)(i,s);this.element=ps.createField(this.model,t,this).init(this.args),this.model.registerField(this.element)}else"static"===t||"static"===r?(this.element=en.createStatic(this.model,(0,n.valOrDefault)(i,s),this).init(this.args),this.element.source=this.concept,this.model.registerStatic(this.element)):"dynamic"===t||"dynamic"===r?(this.element=en.createStatic(this.model,(0,n.valOrDefault)(i,s),this).init(this.args),this.model.registerStatic(this.element)):"algorithm"===t?(this.element=Gn.createAlgo(this.model,(0,n.valOrDefault)(i,s),this).init(this.args),this.model.registerAlgorithm(this.element)):"arrow"===t?(this.element=pa.createArrow(this.model,(0,n.valOrDefault)(i,s),this).init(this.args),this.model.registerArrow(this.element)):"shape"===t?(this.element=qa.createShape(this.model,(0,n.valOrDefault)(i,s),this).init(this.args),this.model.registerShape(this.element)):"simulation"===t?(this.element=xr.createSimulation(this.model,(0,n.valOrDefault)(i,s),this).init(this.args),this.model.registerSimulation(this.element)):(this.element=on(this.model,e.container,this).init(this.args),this.model.registerLayout(this.element));if(this.isRoot()&&(this.element.focusable=!0),this.focusable||(this.element.focusable=!1),this.readonly&&(this.element.readonly=!0),c=this.element.render(),this.element.focusable||(c.tabIndex=-1),!(0,n.isNode)(c))throw new Error("Projection element container could not be created");if(c.classList.add("projection"),Object.assign(c.dataset,{projection:this.id,concept:this.concept.id,object:this.concept.object}),this.optional)if(this.element.schema.rmv)this.element.createDelete(),c.dataset.deletable=!0;else{let e=(0,n.createButton)({class:["btn","structure__btn-delete","projection__btn-delete"],title:`Delete ${this.concept.name}`,tabindex:-1,dataset:{action:"delete",projection:this.id}});e.addEventListener("click",(e=>{let t=this.getContainer(),i=(0,n.findAncestor)(t,(e=>0===e.tabIndex));this.environment.save(this.concept.getParent(),t.cloneNode(!0)),this.concept.delete();let s=this.environment.resolveElement(i);(0,n.isNullOrUndefined)(s)||s.focus()})),c.dataset.deletable=!0,c.prepend(e)}if(this.collapsible){let e=(0,n.createButton)({class:["btn","projection__btn-collapse"],title:`Collapse ${this.concept.name}`,tabindex:-1,dataset:{action:"collapse",projection:this.id}});e.addEventListener("click",(e=>{this.getContainer().classList.toggle("collapsed")})),c.dataset.collapsible=!0,c.prepend(e)}return this._style&&St.call(this,c,this._style),this.containers.set(this.index,c),a&&this.createSibling(this.concept,a,this.element),o&&(this.rtag=o,this.environment.registerReceiver(this.element,o)),c},refresh(){this.editing?this.containers.forEach((e=>{e.tabIndex=0})):this.containers.forEach((e=>{e.tabIndex=null}))},createSibling(e,t){const{render:i,params:s=!1,bind:r}=t,{tag:a,rtag:o}=i;if(this.checkForAliveSibling(e.id,a,o))return;let l=this.model.createProjection(e,a).init();r&&(l.bind=this.element);let c=l.render();if(s){const{coordinates:e,dimension:t}=s;c.setAttribute("x",e.x),c.setAttribute("y",e.y)}let h=this.environment.getActiveReceiver(o);l.parent=h,(0,n.isNullOrUndefined)(l.element.path)&&h.container.append(l.element.element||l.element.container),this.sibling=l},checkForAliveSibling(e,t,i){if((0,n.isNullOrUndefined)(this.environment.siblingModel)&&(this.environment.siblingModel=new Map),(0,n.isNullOrUndefined)(this.environment.siblingModel.get(e)))return this.environment.siblingModel.set(e,[{tag:t,rtag:i}]),!1;let s=this.environment.siblingModel.get(e);for(let e=0;e<s.length;e++)if(s[e].rtag===i&&s[e].tag===t)return!0;return s.push([{tag:t,rtag:i}]),this.environment.siblingModel.set(e,s),!1},changeView(e){if(!this.hasMultipleViews)return void this.environment.notify("There is no alternative projection for this concept");let t=this.getContainer();this.index=(0,n.valOrDefault)(e,(this.index+1)%this.schema.length);let i=this.getContainer();(0,n.isHTMLElement)(i)||(this.params=[],i=this.render()),t.replaceWith(i),this.element=this.resolveElement(i),"svg"===this.element.type&&this.element.update();const s=this.getHandlers("view.changed");return(0,n.isEmpty)(s)||s.forEach((e=>e(i))),this.focus(),this},findView(e){if(!this.hasSchema(e)){if(!this.model.hasProjectionSchema(this.concept,e))return-1;let t=this.model.getProjectionSchema(this.concept,e);this.schema.push(...t)}return this.schema.findIndex((t=>t.tags.includes(e)))},export(){return{id:this.id,root:this.isRoot(),concept:{id:this.concept.id,name:this.concept.name}}},bindEvents(){}},Xa=[{concept:{name:"set"},type:"field",tags:[],content:{type:"list"}},{concept:{name:"boolean"},type:"field",tags:[],content:{type:"binary"}},{concept:{name:"string"},type:"field",tags:[],content:{type:"text"}},{concept:{name:"number"},type:"field",tags:[],content:{type:"text",input:{type:"number"}}},{concept:{name:"reference"},type:"field",tags:[],content:{type:"choice"}}];function Ya(e,t){return Object.create(Ja,{schema:{value:(0,n.valOrDefault)(e,{projection:[],algorithm:[],template:[],style:[]}),writable:!0},editor:{value:t},environment:{value:t}})}const Ja={projections:null,fields:null,statics:null,layouts:null,algos:null,init(e){return this.projections=[],this.fields=new Map,this.statics=new Map,this.layouts=new Map,this.algos=new Map,this.arrows=new Map,this.shapes=new Map,this.simulations=new Map,this},addSchema(e){return Array.isArray(e.projection)&&this.schema.projection.push(...e.projection),Array.isArray(e.template)&&this.schema.template.push(...e.template),Array.isArray(e.style)&&this.schema.style.push(...e.style),this.environment.update("projection-model.updated"),!0},setSchema(e){return this.schema=[...e,...Xa],this.environment.update("projection-model.updated"),this},done(){for(;!(0,n.isEmpty)(this.projections);)this.projections[0].delete();return this.projections=[],this.fields.clear(),this.layouts.clear(),this.statics.clear(),this},createProjection(e,t){const i=this.getProjectionSchema(e,t);(0,n.isEmpty)(i)&&this.environment.notify(`Missing projection (#${t}) for ${e.name}`,y.WARNING);const s=Wa.createProjection(this,i,e,this.environment);return s.tag=t,this.addProjection(s),s},getProjections(){return this.projections.slice()},getProjection(e){return Number.isInteger(e)?this.projections[e]:this.projections.find((t=>t.id===e))},addProjection(e){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad request: The 'projection' argument must be a Projection");return this.projections.push(e),this},removeProjection(e){var t=this.projections.findIndex((t=>t.id===e));return-1!==t&&(this.projections.splice(t,1),!0)},registerField(e){return e.environment=this.environment,e.editor=this.environment,this.fields.set(e.id,e),this},unregisterField(e){var t=this.fields.get(e.id);return t&&(t.environment=null,this.fields.delete(t.id)),this},getField(e){return this.fields.get(e)},registerStatic(e){return e.environment=this.environment,e.editor=this.environment,this.statics.set(e.id,e),this},unregisterStatic(e){var t=this.statics.get(e.id);return t&&(t.environment=null,this.statics.delete(t.id)),this},getStatic(e){return this.statics.get(e)},registerLayout(e){return e.environment=this.environment,e.editor=this.environment,this.layouts.set(e.id,e),this},unregisterLayout(e){var t=this.layouts.get(e.id);return t&&(t.environment=null,this.layouts.delete(t.id)),this},getLayout(e){return this.layouts.get(e)},registerArrow(e){return e.environment=this.environment,this.arrows.set(e.id,e),this},unregisterArrow(e){var t=this.arrows.get(e.id);return t&&(t.environment=null,this._arrow.delete(t.id)),this},getArrow(e){return this.arrows.get(e)},registerShape(e){return e.environment=this.environment,this.shapes.set(e.id,e),this},registerSimulation(e){return e.environment=this.environment,this.simulations.set(e.id,e),this},unregisterArrow(e){var t=this.shapes.get(e.id);return t&&(t.environment=null,this._shape.delete(t.id)),this},getArrow(e){return this.shapes.get(e)},registerAlgorithm(e){return e.environment=this.environment,this.algos.set(e.id,e),this},unregisterAlgorithm(e){var t=this.algos.get(e.id);return t&&(t.environment=null,this.algos.delete(t.id)),this},getAlgo(e){return this.algos.get(e)},getSimulation(e){return this.simulations.get(e)},getArrow(e){return this.arrows.get(e)},getMetadata(e){let t=this.schema.find((t=>t.id===e));return t?t.metadata:null},hasConceptProjection(e,t){let i=null;return i=(0,n.isString)(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((t=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||(i=t.concept.prototype,!(0,n.isNullOrUndefined)(i)&&"prototype"!==e.nature&&e.hasPrototype(i));var i})),(0,n.isIterable)(t)&&!(0,n.isEmpty)(t)?-1!==i.findIndex((e=>(e=>Array.isArray(e.tags)&&e.tags.includes(t))(e))):!(0,n.isEmpty)(i)},getSchema(){return this.schema},getProjectionSchema(e,t){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad parameter: concept");var i=null;return i=(0,n.isString)(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((t=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||(i=t.concept.prototype,!(0,n.isNullOrUndefined)(i)&&"prototype"!==e.nature&&e.hasPrototype(i));var i})),(0,n.isIterable)(t)&&!(0,n.isEmpty)(t)?i.filter((e=>e.tags&&e.tags.includes(t))):i},getTemplateSchema(e){let t=this.schema.template.find((t=>t.name===e));return(0,n.isNullOrUndefined)(t)?null:P(t)},getGFragmentSchema(e){let t=this.schema.find((t=>"g-fragment"===t.type&&t.name===e));return(0,n.isNullOrUndefined)(t)?null:P(t)},getRuleSchema(e){let t=this.schema.find((t=>"rule"===t.type&&t.name===e));return(0,n.isNullOrUndefined)(t)?null:P(t)},getStyleSchema(e){let t=this.schema.style.find((t=>t.name===e));return(0,n.isNullOrUndefined)(t)?null:P(t)},hasProjectionSchema(e,t){if((0,n.isNullOrUndefined)(e))throw new TypeError("Bad parameter: concept");let i=[];return i=(0,n.isString)(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((t=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||(i=t.concept.prototype,!(0,n.isNullOrUndefined)(i)&&"prototype"!==e.nature&&e.hasPrototype&&e.hasPrototype(i));var i})),(0,n.isIterable)(t)&&!(0,n.isEmpty)(t)?i.some((e=>e.tags&&e.tags.includes(t))):!(0,n.isEmpty)(i)},export(){const e=[];return this.getProjections().forEach((t=>{e.push(t.export())})),e}},Ga={unloadAllConcept(){return this.hasConceptModel&&(this.conceptModel.done(),this.conceptModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-concept@post"}),this},unloadAllProjection(){return this.hasProjectionModel&&(this.projectionModel.done(),this.projectionModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-projection@post"}),this},loadSession(){this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)}))},loadConcept(e,t){let i=e.concept||e,s=e.values;return Array.isArray(i)?(0,n.isEmpty)(i)?(this.notify("The concept schema is empty",y.ERROR),!1):((0,n.isNullOrUndefined)(this.conceptModel)&&(this.conceptModel=Nt.createModel(null,this).init()),this.conceptModel.addConceptSchema(i),this.conceptModel.init(s),this.triggerEvent({name:"editor.load-concept@post",args:[t,JSON.stringify(e)]}),this.refresh(),this):(this.notify("Invalid concept schema",y.ERROR),!1)},loadValues(e,t){let i=e;if(!(0,n.isNullOrUndefined)(this.conceptModel))return this.conceptModel.initValue(i),this.loadSession(),this.triggerEvent({name:"editor.load-values@post",args:[t,JSON.stringify(i)]}),this.refresh(),this;console.error("concept model not found")},loadConcepts(e){return Array.isArray(e)?(0,n.isEmpty)(e)?(this.notify("The concept schema is empty",y.ERROR),!1):((0,n.isNullOrUndefined)(this.conceptModel)&&(this.conceptModel=Nt.createModel(null,this).init()),e.forEach((e=>{this.conceptModel.addConceptSchema(e)})),this.refresh(),this):(this.notify("Invalid concept schema",y.ERROR),!1)},loadProjection(e,t){return this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,(0,n.isNullOrUndefined)(this.projectionModel)&&(this.projectionModel=Ya(e,this).init()),this.projectionModel.addSchema(e),(0,n.isNullOrUndefined)(this.projectionModel),this.instances.forEach((e=>{e.projection=this.projectionModel.createProjection(e.concept).init(),e.render()})),this.triggerEvent({name:"editor.load-projection@post",args:[t,JSON.stringify(e)]}),this.refresh(),this},loadProjections(e){return Array.isArray(e)?(0,n.isEmpty)(e)?(this.notify("The concept schema is empty",y.ERROR),!1):(this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,(0,n.isNullOrUndefined)(this.projectionModel)&&(this.projectionModel=Ya(null,this).init()),e.forEach((e=>{this.projectionModel.addSchema(e)})),this.refresh(),this):(this.notify("Invalid concept schema",y.ERROR),!1)},load(e,t){let i=e.type;if((0,n.isNullOrWhitespace)(i)){let t=e.name.indexOf(".")+1;i=e.name.substring(t)}else i=E[i];"jsoncp"===i&&"json"===i||this.addResource(e,t);let s=new FileReader;return s.onload=e=>{const i=JSON.parse(s.result),{type:n}=i;"concept"===n?this.loadConcept(i,t):"projection"===n?this.loadProjection(i,t):"model"===n&&(this.loadConcept(i.concept),this.loadProjection(i.projection),this.loadValues(i.values))},s.readAsText(e),!0},unload(){return this.unloadAllConcept(),this.unloadAllProjection(),this.clear(),this}},Qa={getField(e){if(!(0,n.isHTMLElement)(e)&&"path"!==e.tagName&&"text"!==e.tagName&&"svg"!==e.tagName)return console.warn("Field error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return(0,n.isNullOrUndefined)(t)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(i)?this.projectionModel.getField(t):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(e){if(!(0,n.isHTMLElement)(e)&&"svg"!==e.tagName)return console.warn("Static error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return(0,n.isNullOrUndefined)(t)?(console.warn("Static error: Missing id attribute on field"),null):["static","static-component"].includes(i)?this.projectionModel.getStatic(t):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(e){if(!(0,n.isHTMLElement)(e)&&"svg"!==e.tagName)return console.warn("Layout error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return(0,n.isNullOrUndefined)(t)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(i)?this.projectionModel.getLayout(t):(console.warn("Layout error: Unknown nature attribute on field"),null)},getAlgo(e){if(!(0,n.isHTMLElement)(e)&&"svg"!==e.tagName&&"text"!==e.tagName)return console.warn("Algo error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return(0,n.isNullOrUndefined)(t)?(console.warn("Algo error: Missing id attribute on field"),null):["algorithm"].includes(i)?this.projectionModel.getAlgo(t):(console.warn("algo error: Unknown nature attribute on field"),null)},getSimulation(e){if(!(0,n.isHTMLElement)(e)&&"svg"!==e.tagName&&"text"!==e.tagName)return console.warn("Simulation error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return(0,n.isNullOrUndefined)(t)?(console.warn("Simulation error: Missing id attribute on Simulation"),null):["simulation"].includes(i)?this.projectionModel.getSimulation(t):(console.warn("Simulation error: Unknown nature attribute on Simulation"),null)},getArrow(e){if("path"!==e.tagName)return console.warn("Arrow error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return(0,n.isNullOrUndefined)(t)?(console.warn("Arrow error: Missing id attribute on field"),null):["arrow","arrow-path"].includes(i)?this.projectionModel.getArrow(t):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(e){if(e instanceof SVGElement){let t=e;for(;!(0,n.isNullOrUndefined)(t.parentNode)&&(0,n.isNullOrUndefined)(t.dataset);)t=t.parentNode;(0,n.isNullOrUndefined)(t.dataset.nature)||(e=t)}if(!(0,n.isHTMLElement)(e)&&"path"!==e.tagName&&"svg"!==e.tagName&&"text"!==e.tagName)return null;const{nature:t}=e.dataset;if((0,n.isNullOrUndefined)(t))return null;let i=null;switch(t){case"field":case"field-component":i=this.getField(e);break;case"layout":case"layout-component":i=this.getLayout(e);break;case"static":case"static-component":i=this.getStatic(e);break;case"algorithm":i=this.getAlgo(e);break;case"simulation":i=this.getSimulation(e);break;case"arrow":i=this.getArrow(e)}return i&&(i.environment=this),i}};var Za=0;const eo={createState(e,t){const{id:i,name:s}=e;let r="value"+Za++,a=JSON.stringify(e.clone()),o=((0,n.formatDate)(new Date,"hh:dd"),(0,n.createI)({class:["ico","ico-delete"]},"✖")),l=(0,n.createButton)({class:["btn","btn-delete"],title:`Delete ${s} state`},o),c=(0,n.createDiv)({class:["model-state-preview"],title:`Preview ${s}`},t),h=(0,n.createSpan)({class:["model-state-content","fit-content"]},`${e.getName()}`),u=(0,n.createListItem)({class:["model-state"],title:`Restore ${s} state`,dataset:{id:r,concept:i}},[l,h,c]);u.addEventListener("click",(e=>{let t=function(e){const t=e=>e===u||e===l;return t(e)?e:(0,n.findAncestor)(e,(e=>t(e)),5)}(e.target);if(this.unhighlight(),t===l)this.removeState(r);else{let e=this.restore(a);this.removeState(r);let t=(0,n.getElement)(`.projection[data-concept="${e.id}"]`,this.body);t&&t.focus()}}));let d=`.projection[data-concept="${i}"]`;if(u.addEventListener("mouseenter",(e=>{let t=(0,n.getElement)(d,this.body);t&&this.highlight(t)})),u.addEventListener("mouseleave",(e=>{this.unhighlight()})),this.states.length>8){let{id:e}=this.stateList.lastChild.dataset;this.removeValue(e)}let p=Object.create({},{id:{value:r},object:{value:"value"},type:{value:"state"},element:{value:u},concept:{value:e},value:{value:a}});return this.addState(p),p},getState(e){if(!(0,n.isNullOrUndefined)(e)&&!(0,n.isEmpty)(this.states))return this.states[e]},addState(e){return this.stateList.append(e.element),this.states.push(e),this.refresh(),e},removeState(e){if((0,n.isNullOrUndefined)(e))return;const t=this.states.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.states.splice(t,1)[0],{element:s}=i;return(0,n.removeChildren)(s).remove(),this.refresh(),this}};var to=0;const io={conceptModel:null,projectionModel:null,concept:null,activeConcept:null,activeProjection:null,activeReceiver:null,activeInstance:null,container:null,header:null,body:null,instanceSection:null,designSection:null,navigationSection:null,valueWindow:null,valueList:null,breadcrumb:null,filter:null,home:null,exporter:null,style:null,logs:null,status:null,group:null,input:null,copyValue:null,states:null,activeElement:null,decoratedElements:null,config:null,active:!1,visible:!1,frozen:!1,handlers:null,actions:null,attached:null,instances:null,windows:null,values:null,resources:null,models:null,errors:null,init(e={}){const{conceptModel:t,projectionModel:i,toolbar:s=[],config:n={},handlers:r={},actions:a={}}=e;this.config=Object.assign({},n),this.handlers=new Map,this.actions=new Map,this.attached=[],this.instances=new Map,this.windows=new Map,this.values=new Map,this.resources=new Map,this.models=new Map,this.errors=[],Object.assign(this,ae,ce),this.states=[],this.decoratedElements=new Set;for(const e in r){const t=r[e];this.registerHandler(e,t)}return this.header=me.call(this).init(),this.home=ge.call(this).init(),this.breadcrumb=fe.call(this).init(),this.logs=ve.call(this).init(),this.status=be.call(this).init(),this.exporter=ye.call(this).init(),this.render(),Array.isArray(t)?this.loadConcepts(t):t&&this.loadConcept(t),Array.isArray(i)?this.loadProjections(i):i&&this.loadProjection(i),this.isReady?(this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)})),this.open()):(this.home.open(),this.refresh()),this},setConfig(e){return!(0,n.isNullOrUndefined)(e)&&(this.config=e,this.refresh(),this)},getConfig(e){return(0,n.isNullOrUndefined)(e)?this.config:this.config[e]},getName(){return(0,n.valOrDefault)(this.config.name,`editor${(new Date).getTime()}`)},createConcept(e){if((0,n.isNullOrUndefined)(e))throw new TypeError("Missing argument: The 'name' is required to create a concept");return this.conceptModel.isConcept(e)?this.conceptModel.createConcept(e):(this.notify(`The concept '${e}' is not defined in the model`,y.ERROR),!1)},addConcept(e){let t=e.concept||e;Array.isArray(t)?this.conceptModel.schema.push(...t):this.conceptModel.schema.push(t),this.refresh()},createProjection(e,t){if((0,n.isNullOrUndefined)(e))throw new TypeError("Missing argument: The 'concept' is required to create a projection");return this.projectionModel.hasConceptProjection(e,t)?this.projectionModel.createProjection(e,t).init():(this.notify(`The projection for the concept '${e.name}' is not defined in the model`,y.ERROR),!1)},addProjection(e){Array.isArray(e)?this.projectionModel.schema.projection.push(...e):this.projectionModel.addSchema(e),this.refresh()},download(e,t,i){const s=x[i.toUpperCase()].type;window.URL=window.webkitURL||window.URL;var r=(0,n.createAnchor)({class:["bare-link","download-item__link"]},"Download");(0,n.isNullOrWhitespace)(r.href)||window.URL.revokeObjectURL(r.href);var a=new Blob([e],{type:s});return Object.assign(r,{download:t,href:window.URL.createObjectURL(a)}),r.dataset.downloadurl=[s,r.download,r.href].join(":"),r.click(),setTimeout((()=>{window.URL.revokeObjectURL(r.href),r.remove()}),1500),e},save(e,t){(0,n.isNullOrUndefined)(e)||(this.createState(e,t),this.refresh())},restore(e){let t=JSON.parse(e),i=this.conceptModel.getConcept(t.id);return i.restore(t),this.refresh(),i},undo(){if((0,n.isEmpty)(this.states))return void this.notify("There are no previous state",y.NORMAL,2e3);let e=(0,n.last)(this.states);this.restore(e.value),this.removeState(e.id)},notify(e,t,i=4500){let s=(0,n.createParagraph)({class:["notify"],html:e});const r="open";t&&s.classList.add(t),this.container.append(s),setTimeout((()=>{s.classList.add(r)}),50),setTimeout((()=>{s.classList.remove(r),setTimeout((()=>{s.remove()}),500)}),i)},addResource(e,t){let i=(0,n.valOrDefault)(t,e.name.split(".")[0]);this.resources.set(i,e);let s=new FileReader;return s.onload=e=>{const t=JSON.parse(s.result);console.log("Resulting Schema"),console.log(t),this.addModel(i,t)},s.readAsText(e),this.refresh(),e},getResource(e){return this.resources.get(e)},hasResource(e){return this.resources.has(e)},removeResource(e){return this.resources.delete(e),this.triggerEvent({name:"resource.removed"}),this.refresh(),!0},addError(e){return this.errors.push(e),this.refresh(),m(this.status.editorstatusBadge),e},removeError(e){return this.errors.pop(),this.refresh(),!0},clearError(e){return this.errors=[],this.refresh(),!0},getModel(e){let t=this.models.get(e);return(0,n.isNullOrUndefined)(t)?null:JSON.parse(t)},addModel(e,t){this.models.set(e,t)},removeModel(e){return this.triggerEvent({name:"model.remove@pre",args:[e]},(()=>{this.models.delete(e),this.refresh(),this.triggerEvent({name:"model.remove@post"})}),!1),!0},hasModel(e){return this.models.has(e)},getValue(e){if(this.values.has(e))return this.values.get(e)},addValue(e){let t="value"+to++,i=(0,n.createI)({class:["ico","ico-copy"]}),s=(0,n.createI)({class:["ico","ico-delete"]},"✖"),r=(0,n.createButton)({class:["btn","btn-copy","fit-content"],title:`Copy ${e.name}`},[i,e.name]),a=(0,n.createButton)({class:["btn","btn-delete"]},s),o=(0,n.createListItem)({class:["model-value"],dataset:{id:t}},[r,a]);if(r.addEventListener("click",(t=>{this.copy(e)})),a.addEventListener("click",(e=>{this.removeValue(t)})),this.values.size>5){let{id:e}=this.valueList.lastChild.dataset;this.removeValue(e)}return this.valueList.prepend(o),this.values.set(t,{element:o,value:e}),this.refresh(),e},removeValue(e){if((0,n.isNullOrUndefined)(e)||!this.values.has(e))return;let{element:t}=this.values.get(e);return(0,n.removeChildren)(t).remove(),this.values.delete(e),this.refresh(),this},copy(e,t=!1){return(0,n.isNullOrUndefined)(e)||(this.copyValue=e,(0,n.copytoClipboard)(JSON.stringify(e)),t&&this.addValue(e),this.notify(`${e.name} copied`,y.NORMAL)),this},paste(e,t){let i=(0,n.valOrDefault)(t,this.copyValue);if(!(0,n.isNullOrUndefined)(i)){if((0,n.isNullOrUndefined)(e)){let e=this.createConcept(i.name).init();e.setValue(i),this.createInstance(e)}else"prototype"===i.nature?e.setValue(i.value):e.setValue(i);return this}},show(){return this.triggerEvent({name:"editor.show@pre"},(()=>{u(this.container),this.attached.forEach((e=>e.show())),this.visible=!0,this.triggerEvent({name:"editor.show@post"})}),!1),this},hide(){return this.triggerEvent({name:"editor.hide@pre"},(()=>{d(this.container),this.attached.forEach((e=>e.hide())),this.visible=!1,this.triggerEvent({name:"editor.hide@post"})}),!1),this},toggle(){return this.triggerEvent({name:"editor.toggle@pre"},(()=>{p(this.container),this.visible=!this.visible,this.triggerEvent({name:"editor.toggle@post"})}),!1),this},open(){return this.triggerEvent({name:"editor.open@pre"},(()=>{this.show(),this.active=!0,this.isReady&&this.home.close(),this.triggerEvent({name:"editor.open@post"})}),!1),this},close(){return this.triggerEvent({name:"editor.close@pre"},(()=>{this.hide(),this.active=!1,this.done(),this.clear(),this.triggerEvent({name:"editor.close@post"})}),!1),this},destroy(){return this.triggerEvent({name:"editor.destroy@pre"},(()=>{this.hide(),this.done(),this.instances.forEach((e=>e.delete())),(0,n.removeChildren)(this.container).remove()}),!1),!0},freeze(){return this.triggerEvent({name:"editor.freeze@pre"},(()=>{this.frozen=!0,this.refresh(),this.triggerEvent({name:"editor.freeze@post"})}),!1),this},unfreeze(){return this.frozen=!1,this.refresh(),this},done(){return this.conceptModel&&this.conceptModel.done(),this.projectionModel&&this.projectionModel.done(),this},highlight(e){return(0,n.isHTMLElement)(e)?(function(e){(0,n.isHTMLElement)(e)&&e.classList.add(l)}(e),this.decoratedElements.add(e),this):this},unhighlight(e){return(0,n.isHTMLElement)(e)?(f(e),this.decoratedElements.delete(e),this):(this.decoratedElements.forEach((e=>f(e))),this.decoratedElements.clear(),this)},createWindow(){let e=(0,n.createDiv)({class:["editor-window"],tabindex:0});this.body.append(e)},clear(){return this.triggerEvent({name:"editor.clear@pre"},(()=>{this.instances.forEach((e=>e.delete())),this.instances.clear(),this.resources.clear(),this.models.clear(),this.states.forEach((e=>e.element.remove())),this.states=[],this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,this.refresh(),this.triggerEvent({name:"editor.clear@post"})}),!1),this},update(e,t,i){this.triggerEvent({name:e})},attach(e){this.attached.push(e)},detach(e){let t=this.attached.findIndex((t=>t===e));if(-1===t)return null;this.attached.splice(t,1)},render(e){const t=(0,n.createDocFragment)();if(this.home.isRendered||t.append(this.home.render()),this.header.isRendered||t.append(this.header.render()),this.exporter.isRendered||t.append(this.exporter.render()),(0,n.isHTMLElement)(this.navigationSection)||(this.navigationSection=(0,n.createSection)({class:["model-navigation-section"]}),this.viewSection=(0,n.createAside)({class:["model-view-section"]}),this.navigationSection.append(this.viewSection),t.append(this.navigationSection)),!(0,n.isHTMLElement)(this.body)){this.body=(0,n.createDiv)({class:["editor-body"],tabindex:0});let e=(0,n.createDiv)({class:["editor-body-main"],tabindex:0});this.instanceSection=(0,n.createSection)({class:["model-concept-section"]}),e.append(this.instanceSection),this.body.append(e),t.append(this.body)}return(0,n.isHTMLElement)(this.timeline)||(this.timeline=(0,n.createDiv)({class:["editor-timeline"]}),this.stateList=(0,n.createUnorderedList)({class:["bare-list","model-state-list"]}),this.timeline.append(this.stateList),t.append(this.timeline)),this.logs.isRendered||t.append(this.logs.render()),this.breadcrumb.isRendered||this.navigationSection.append(this.breadcrumb.render()),(0,n.isHTMLElement)(this.valueSection)||(this.valueSection=(0,n.createDiv)({class:["model-value-window"]}),this.valueList=(0,n.createUnorderedList)({class:["bare-list","model-value-list"]}),this.valueSection.append(this.valueList),this.navigationSection.append(this.valueSection)),this.status.isRendered||t.append(this.status.render()),(0,n.isHTMLElement)(this.input)||(this.input=(0,n.createInput)({type:"file",class:["hidden"],accept:".json,.jsoncp"}),t.append(this.input)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),(0,n.isHTMLElement)(e)&&e.append(this.container),this.refresh(),this.container},refresh(e=!1){return this.frozen&&!e||(this.home.isOpen?this.container.classList.add("unfocus"):this.container.classList.remove("unfocus"),this.hasValues?u(this.valueWindow):d(this.valueWindow),this.header.refresh(),this.breadcrumb.refresh(),this.home.refresh(),this.logs.refresh(),this.status.refresh(),this.instanceSection.dataset.view=this.status.view,["grid"].includes(this.status.view)?d(this.viewSection):["tab"].includes(this.status.view)&&u(this.viewSection),(0,n.isEmpty)(this.states)?d(this.timeline):(u(this.timeline),this.states.forEach((e=>{this.conceptModel.hasConcept(e.concept.id)?this.hasActiveConcept&&this.activeConcept===e.concept?e.element.classList.add("active"):e.element.classList.remove("active"):this.removeState(e.id)})))),this},updateActiveElement(e){return this.activeElement&&this.activeElement===e||(this.activeElement=e,this.triggerEvent({name:"editor.element@active:updated"})),this},updateActiveConcept(e){return this.hasActiveConcept&&this.activeConcept===e||(this.activeConcept=e,this.triggerEvent({name:"editor.concept@active:updated"}),this.refresh()),this},updateActiveProjection(e){if(this.activeProjection&&this.activeProjection===e)return this;let t=(0,n.getElements)(".active-parent",this.body);for(let e=0;e<t.length;e++)t[e].classList.remove("active-parent");this.activeProjection=e;let i=this.activeProjection.parent;for(;i;)i.getContainer().classList.add("active-parent"),i=i.parent;return this.triggerEvent({name:"editor.projection@active:updated"}),this.refresh(),this},updateActiveInstance(e){if(this.activeInstance){if(this.activeInstance===e)return this;this.activeInstance,this.activeInstance.container.classList.remove("active")}return this.activeInstance=e,this.activeInstance.container.classList.add("active"),this.triggerEvent({name:"editor.instance@active:updated"}),this.refresh(),this},registerReceiver(e,t){(0,n.isNullOrUndefined)(this.receivers)&&(this.receivers={}),(0,n.isNullOrUndefined)(this.receivers[t])?this.receivers[t]={root:e,projections:[e]}:this.receivers[t].projections.push(e),this.setActiveReceiver(e,t)},setActiveReceiver(e,t){(0,n.isNullOrUndefined)(this.activeReceiver)&&(this.activeReceiver={}),this.activeReceiver[t]=e},getActiveReceiver(e){return this.activeReceiver[e]},getReceivers(e){return this.receivers[e].projections},getRootReceiver(e){return this.receivers[e].root},bindEvents(){var e=null,t=null;const i={open:e=>{const{context:t}=e.dataset;t?this[t].open():this.open()},close:e=>{const{context:t,id:i,type:s}=e.dataset;t?this[t].close():this.close()},collapse:e=>{const{rel:t,target:i}=e.dataset;if("parent"===t){let t=(0,n.findAncestor)(e,(e=>e.dataset.name===i));if((0,n.isHTMLElement)(t)){const{alias:i=""}=t.dataset;t.classList.toggle("collapsed");let s=t.classList.contains("collapsed");e.dataset.state=s?"ON":"OFF",e.title=s?`Expand ${i.toLowerCase()}`:`Collapse ${i.toLowerCase()}`}}},delete:e=>{const{target:t}=e.dataset;if("parent"===t){let t=e.parentElement;(0,n.removeChildren)(t),t.remove()}},"delete:value":e=>{const{id:t}=e.dataset;this.conceptModel.removeValue(t),this.header._valueSelector.update()},"delete:resource":e=>{const{id:t}=e.dataset;this.removeResource(t)},"change-view":e=>{const{value:t}=e.dataset;this.status.changeView(t)},"add-group":e=>{this.status.addGroup()},style:e=>{this.style.toggle()},home:e=>{this.home.toggle()},logs:e=>{this.logs.toggle()},export:e=>{this.export()},"export--copy":e=>{this.export(!0)},"create-instance":e=>{const{concept:t}=e.dataset;let i=this.createConcept(t);this.createInstance(i)},"create-instance:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t),s=this.createConcept(i.name);s.initValue(i),this.createInstance(s)},"copy:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t);this.copy(i)},save:e=>{this.save()},undo:e=>{this.undo()},load:e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},unload:e=>{this.unload()},"load-concept":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-concept":e=>{this.unloadAllConcept()},"download-concept":e=>{const{schema:t,values:i}=this.conceptModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({concept:t},`${s}_model`,"JSON")},"load-projection":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-projection":e=>{this.unloadAllProjection()},"download-projection":e=>{const{schema:t,views:i}=this.projectionModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({projection:t},`${s}_projection`,"JSON")}},s={[v.up_arrow]:"up",[v.right_arrow]:"right",[v.down_arrow]:"down",[v.left_arrow]:"left"};this.container.addEventListener("click",(e=>{var t=function(e){const t=e=>!(0,n.hasOwn)(e.dataset,"ignore");return t(e)?e:(0,n.findAncestor)(e,t,10)}(e.target);const{action:s,context:r,id:a}=t.dataset;if("instance"===r)return void this.getInstance(a).actionHandler(s);if("menu"===r)return void this.home.actionHandler(s,t);if(this.activeElement&&this.activeElement.clickHandler(t),(0,n.isNullOrUndefined)(s))return;if(this.actions.has(s))return this.actions.get(s).call(this,t),void t.blur();const o=i[s];(0,n.isFunction)(o)?(o(t),t.blur()):s&&this.triggerEvent({name:s})}),!0),this.input.addEventListener("change",(e=>{let i=this.input.files[0];this.load(i,t),this.input.value=""})),this.body.addEventListener("copy",(e=>{if(!N(e.target)){let t=this.activeConcept.copy(!1);this.copy(t,!0),e.preventDefault()}})),this.body.addEventListener("keydown",(t=>{const{target:i}=t,{nature:r}=i.dataset;var a=!1;switch(t.key){case v.backspace:this.activeElement&&e!==v.ctrl&&!0===this.activeElement.backspaceHandler(i)&&t.preventDefault();break;case v.ctrl:case v.shift:t.preventDefault(),a=!0;break;case v.delete:this.activeElement&&e!==v.ctrl&&!N(i)&&this.activeElement.deleteHandler(i)&&t.preventDefault();break;case v.spacebar:this.activeElement&&e!==v.ctrl&&this.activeElement.spaceHandler(i)&&t.preventDefault();break;case v.alt:t.preventDefault();break;case v.enter:this.activeElement?!0===this.activeElement.enterHandler(i)&&t.preventDefault():"concept-container"===r?this.activeInstance.projection.focus():"editable"===r?i.blur():"BUTTON"===i.tagName?(i.click(),t.preventDefault()):t.preventDefault();break;case v.escape:this.activeElement&&(!0===this.activeElement.escapeHandler(i)?t.preventDefault():(0,n.findAncestor)(i,(e=>0===e.tabIndex)).focus());break;case v.insert:this.activeElement&&t.preventDefault();break;case v.up_arrow:case v.right_arrow:case v.down_arrow:case v.left_arrow:if(this.activeElement&&![v.ctrl,v.shift,v.alt].includes(e))!0===this.activeElement.arrowHandler(s[t.key],i)&&t.preventDefault();else if("concept-container"===r&&![v.ctrl,v.shift,v.alt].includes(e)){let e=T(i,s[t.key],this.instanceSection);if(!(0,n.isHTMLElement)(e))return!1;e.focus()}break;case"s":e===v.ctrl&&(this.activeConcept.copy(),this.header.valueCount++,this.refresh(),t.preventDefault());break;case"c":if(e===v.ctrl){let e=new ClipboardEvent("copy");this.body.dispatchEvent(e)}break;case"v":if(e===v.ctrl){if(N(i))return;this.paste(this.activeConcept,this.copyValue)}break;case"e":e===v.ctrl&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{type:"projection",close:"DELETE-PROJECTION"}),t.preventDefault());break;case"f":break;case"z":e===v.ctrl&&(N(i)||(this.undo(),t.preventDefault()))}a&&(e=t.key)}),!1),this.body.addEventListener("keyup",(t=>{var i=t.target;const{nature:r}=i.dataset;switch(t.key){case v.spacebar:this.activeElement&&e===v.ctrl&&this.activeElement._spaceHandler(i);break;case v.delete:this.activeElement&&e===v.ctrl&&this.activeElement.delete(i);break;case v.alt:break;case v.up_arrow:case v.down_arrow:case v.right_arrow:case v.left_arrow:if(this.activeElement&&e===v.ctrl)!0===this.activeElement._arrowHandler(s[t.key],i)&&t.preventDefault();else if("concept-container"===r&&e===v.ctrl){let r=T(i,s[t.key],this.instanceSection);if(!(0,n.isHTMLElement)(r))return!1;this.swapInstance(i,r,!0),i.focus(),e=v.ctrl}}e===t.key&&(e=-1)}),!1),this.body.addEventListener("focusin",(t=>{const{target:i}=t,s=this.resolveElement(i);if(e=-1,s?(this.activeElement&&this.activeElement!==s&&(this.activeElement.focusOut(),this.activeElement=null),this.updateActiveElement(s),this.activeElement.focusIn(i)):(this.activeElement&&this.activeElement.focusOut(i),this.activeElement=null),this.activeElement){let e=this.activeElement.projection;this.updateActiveProjection(e),this.updateActiveConcept(e.concept)}else this.activeConcept=null,this.activeProjection=null;this.refresh()})),this.registerHandler("value.changed",(()=>this.refresh())),this.registerHandler("value.added",(()=>this.refresh())),this.registerHandler("value.removed",(()=>this.refresh())),this.registerHandler("export.model",(()=>this.exporter.open())),this.registerHandler("load-resource",(e=>{let i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t=e[0],this.input.dispatchEvent(i)}))}},so=Object.assign(eo,Ga,Qa,we,io);Object.defineProperty(so,"hasConceptModel",{get(){return!(0,n.isNullOrUndefined)(this.conceptModel)}}),Object.defineProperty(so,"hasProjectionModel",{get(){return!(0,n.isNullOrUndefined)(this.projectionModel)}}),Object.defineProperty(so,"hasInstances",{get(){return this.instances.size>0}}),Object.defineProperty(so,"hasWindows",{get(){return this.windows.size>0}}),Object.defineProperty(so,"hasValues",{get(){return this.values.size>0}}),Object.defineProperty(so,"isReady",{get(){return this.hasConceptModel&&this.hasProjectionModel}}),Object.defineProperty(so,"hasActiveConcept",{get(){return!(0,n.isNullOrUndefined)(this.activeConcept)}}),Object.defineProperty(so,"hasActiveProjection",{get(){return!(0,n.isNullOrUndefined)(this.activeProjection)}}),Object.defineProperty(so,"hasActiveInstance",{get(){return!(0,n.isNullOrUndefined)(this.activeInstance)}}),Object.defineProperty(so,"hasError",{get(){return!(0,n.isEmpty)(this.errors)}});const no="editor",ro=s(787),ao=s(498),oo=s(353),lo=s(874),co=s(369),ho=(s(477),s(82)),uo=s(140),po=s(661),mo=s(871),fo=Symbol.for("yaml.alias"),go=Symbol.for("yaml.document"),bo=Symbol.for("yaml.map"),vo=Symbol.for("yaml.pair"),yo=Symbol.for("yaml.scalar"),wo=Symbol.for("yaml.seq"),xo=Symbol.for("yaml.node.type"),Eo=e=>!!e&&"object"==typeof e&&e[xo]===fo,Ao=e=>!!e&&"object"==typeof e&&e[xo]===go,Oo=e=>!!e&&"object"==typeof e&&e[xo]===bo,No=e=>!!e&&"object"==typeof e&&e[xo]===vo,ko=e=>!!e&&"object"==typeof e&&e[xo]===yo,jo=e=>!!e&&"object"==typeof e&&e[xo]===wo;function Lo(e){if(e&&"object"==typeof e)switch(e[xo]){case bo:case wo:return!0}return!1}function So(e){if(e&&"object"==typeof e)switch(e[xo]){case fo:case bo:case yo:case wo:return!0}return!1}class Co{constructor(e){Object.defineProperty(this,xo,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}}const To=Symbol("break visit"),Io=Symbol("skip children"),Mo=Symbol("remove node");function Uo(e,t){const i=Po(t);Ao(e)?Do(null,e.contents,i,Object.freeze([e]))===Mo&&(e.contents=null):Do(null,e,i,Object.freeze([]))}function Do(e,t,i,s){const n=Ho(e,t,i,s);if(So(n)||No(n))return Vo(e,s,n),Do(e,n,i,s);if("symbol"!=typeof n)if(Lo(t)){s=Object.freeze(s.concat(t));for(let e=0;e<t.items.length;++e){const n=Do(e,t.items[e],i,s);if("number"==typeof n)e=n-1;else{if(n===To)return To;n===Mo&&(t.items.splice(e,1),e-=1)}}}else if(No(t)){s=Object.freeze(s.concat(t));const e=Do("key",t.key,i,s);if(e===To)return To;e===Mo&&(t.key=null);const n=Do("value",t.value,i,s);if(n===To)return To;n===Mo&&(t.value=null)}return n}async function _o(e,t){const i=Po(t);Ao(e)?await Bo(null,e.contents,i,Object.freeze([e]))===Mo&&(e.contents=null):await Bo(null,e,i,Object.freeze([]))}async function Bo(e,t,i,s){const n=await Ho(e,t,i,s);if(So(n)||No(n))return Vo(e,s,n),Bo(e,n,i,s);if("symbol"!=typeof n)if(Lo(t)){s=Object.freeze(s.concat(t));for(let e=0;e<t.items.length;++e){const n=await Bo(e,t.items[e],i,s);if("number"==typeof n)e=n-1;else{if(n===To)return To;n===Mo&&(t.items.splice(e,1),e-=1)}}}else if(No(t)){s=Object.freeze(s.concat(t));const e=await Bo("key",t.key,i,s);if(e===To)return To;e===Mo&&(t.key=null);const n=await Bo("value",t.value,i,s);if(n===To)return To;n===Mo&&(t.value=null)}return n}function Po(e){return"object"==typeof e&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function Ho(e,t,i,s){return"function"==typeof i?i(e,t,s):Oo(t)?i.Map?.(e,t,s):jo(t)?i.Seq?.(e,t,s):No(t)?i.Pair?.(e,t,s):ko(t)?i.Scalar?.(e,t,s):Eo(t)?i.Alias?.(e,t,s):void 0}function Vo(e,t,i){const s=t[t.length-1];if(Lo(s))s.items[e]=i;else if(No(s))"key"===e?s.key=i:s.value=i;else{if(!Ao(s)){const e=Eo(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${e} parent`)}s.contents=i}}Uo.BREAK=To,Uo.SKIP=Io,Uo.REMOVE=Mo,_o.BREAK=To,_o.SKIP=Io,_o.REMOVE=Mo;const Ro={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"};class $o{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},$o.defaultYaml,e),this.tags=Object.assign({},$o.defaultTags,t)}clone(){const e=new $o(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new $o(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:$o.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},$o.defaultTags)}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:$o.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},$o.defaultTags),this.atNextDocument=!1);const i=e.trim().split(/[ \t]+/),s=i.shift();switch(s){case"%TAG":{if(2!==i.length&&(t(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[e,s]=i;return this.tags[e]=s,!0}case"%YAML":{if(this.yaml.explicit=!0,1!==i.length)return t(0,"%YAML directive should contain exactly one part"),!1;const[e]=i;return"1.1"===e||"1.2"===e?(this.yaml.version=e,!0):(t(6,`Unsupported YAML version ${e}`,/^\d+\.\d+$/.test(e)),!1)}default:return t(0,`Unknown directive ${s}`,!0),!1}}tagName(e,t){if("!"===e)return"!";if("!"!==e[0])return t(`Not a valid tag: ${e}`),null;if("<"===e[1]){const i=e.slice(2,-1);return"!"===i||"!!"===i?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(">"!==e[e.length-1]&&t("Verbatim tags must end with a >"),i)}const[,i,s]=e.match(/^(.*!)([^!]*)$/);s||t(`The ${e} tag has no suffix`);const n=this.tags[i];return n?n+decodeURIComponent(s):"!"===i?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,i]of Object.entries(this.tags))if(e.startsWith(i))return t+e.substring(i.length).replace(/[!,[\]{}]/g,(e=>Ro[e]));return"!"===e[0]?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let s;if(e&&i.length>0&&So(e.contents)){const t={};Uo(e.contents,((e,i)=>{So(i)&&i.tag&&(t[i.tag]=!0)})),s=Object.keys(t)}else s=[];for(const[n,r]of i)"!!"===n&&"tag:yaml.org,2002:"===r||e&&!s.some((e=>e.startsWith(r)))||t.push(`%TAG ${n} ${r}`);return t.join("\n")}}function Fo(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){const t=JSON.stringify(e);throw new Error(`Anchor must not contain whitespace or control characters: ${t}`)}return!0}function qo(e){const t=new Set;return Uo(e,{Value(e,i){i.anchor&&t.add(i.anchor)}}),t}function zo(e,t){for(let i=1;;++i){const s=`${e}${i}`;if(!t.has(s))return s}}$o.defaultYaml={explicit:!1,version:"1.2"},$o.defaultTags={"!!":"tag:yaml.org,2002:"};class Wo extends Co{constructor(e){super(fo),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let t;return Uo(e,{Node:(e,i)=>{if(i===this)return Uo.BREAK;i.anchor===this.source&&(t=i)}}),t}toJSON(e,t){if(!t)return{source:this.source};const{anchors:i,doc:s,maxAliasCount:n}=t,r=this.resolve(s);if(!r){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(e)}const a=i.get(r);if(!a||void 0===a.res)throw new ReferenceError("This should not happen: Alias anchor was not resolved?");if(n>=0&&(a.count+=1,0===a.aliasCount&&(a.aliasCount=Ko(s,r,i)),a.count*a.aliasCount>n))throw new ReferenceError("Excessive alias count indicates a resource exhaustion attack");return a.res}toString(e,t,i){const s=`*${this.source}`;if(e){if(Fo(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(e)}if(e.implicitKey)return`${s} `}return s}}function Ko(e,t,i){if(Eo(t)){const s=t.resolve(e),n=i&&s&&i.get(s);return n?n.count*n.aliasCount:0}if(Lo(t)){let s=0;for(const n of t.items){const t=Ko(e,n,i);t>s&&(s=t)}return s}if(No(t)){const s=Ko(e,t.key,i),n=Ko(e,t.value,i);return Math.max(s,n)}return 1}function Xo(e,t,i){if(Array.isArray(e))return e.map(((e,t)=>Xo(e,String(t),i)));if(e&&"function"==typeof e.toJSON){if(!i||!ko(s=e)&&!Lo(s)||!s.anchor)return e.toJSON(t,i);const n={aliasCount:0,count:1,res:void 0};i.anchors.set(e,n),i.onCreate=e=>{n.res=e,delete i.onCreate};const r=e.toJSON(t,i);return i.onCreate&&i.onCreate(r),r}var s;return"bigint"!=typeof e||i?.keep?e:Number(e)}const Yo=e=>!e||"function"!=typeof e&&"object"!=typeof e;class Jo extends Co{constructor(e){super(yo),this.value=e}toJSON(e,t){return t?.keep?this.value:Xo(this.value,e,t)}toString(){return String(this.value)}}function Go(e,t,i){if(Ao(e)&&(e=e.contents),So(e))return e;if(No(e)){const t=i.schema[bo].createNode?.(i.schema,null,i);return t.items.push(e),t}(e instanceof String||e instanceof Number||e instanceof Boolean||"function"==typeof BigInt&&e instanceof BigInt)&&(e=e.valueOf());const{aliasDuplicateObjects:s,onAnchor:n,onTagObj:r,schema:a,sourceObjects:o}=i;let l;if(s&&e&&"object"==typeof e){if(l=o.get(e),l)return l.anchor||(l.anchor=n(e)),new Wo(l.anchor);l={anchor:null,node:null},o.set(e,l)}t?.startsWith("!!")&&(t="tag:yaml.org,2002:"+t.slice(2));let c=function(e,t,i){if(t){const e=i.filter((e=>e.tag===t)),s=e.find((e=>!e.format))??e[0];if(!s)throw new Error(`Tag ${t} not found`);return s}return i.find((t=>t.identify?.(e)&&!t.format))}(e,t,a.tags);if(!c){if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),!e||"object"!=typeof e){const t=new Jo(e);return l&&(l.node=t),t}c=e instanceof Map?a[bo]:Symbol.iterator in Object(e)?a[wo]:a[bo]}r&&(r(c),delete i.onTagObj);const h=c?.createNode?c.createNode(i.schema,e,i):new Jo(e);return t&&(h.tag=t),l&&(l.node=h),h}function Qo(e,t,i){let s=i;for(let e=t.length-1;e>=0;--e){const i=t[e];if("number"==typeof i&&Number.isInteger(i)&&i>=0){const e=[];e[i]=s,s=e}else s=new Map([[i,s]])}return Go(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:new Map})}Jo.BLOCK_FOLDED="BLOCK_FOLDED",Jo.BLOCK_LITERAL="BLOCK_LITERAL",Jo.PLAIN="PLAIN",Jo.QUOTE_DOUBLE="QUOTE_DOUBLE",Jo.QUOTE_SINGLE="QUOTE_SINGLE";const Zo=e=>null==e||"object"==typeof e&&!!e[Symbol.iterator]().next().done;class el extends Co{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map((t=>So(t)||No(t)?t.clone(e):t)),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(Zo(e))this.add(t);else{const[i,...s]=e,n=this.get(i,!0);if(Lo(n))n.addIn(s,t);else{if(void 0!==n||!this.schema)throw new Error(`Expected YAML collection at ${i}. Remaining path: ${s}`);this.set(i,Qo(this.schema,s,t))}}}deleteIn(e){const[t,...i]=e;if(0===i.length)return this.delete(t);const s=this.get(t,!0);if(Lo(s))return s.deleteIn(i);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${i}`)}getIn(e,t){const[i,...s]=e,n=this.get(i,!0);return 0===s.length?!t&&ko(n)?n.value:n:Lo(n)?n.getIn(s,t):void 0}hasAllNullValues(e){return this.items.every((t=>{if(!No(t))return!1;const i=t.value;return null==i||e&&ko(i)&&null==i.value&&!i.commentBefore&&!i.comment&&!i.tag}))}hasIn(e){const[t,...i]=e;if(0===i.length)return this.has(t);const s=this.get(t,!0);return!!Lo(s)&&s.hasIn(i)}setIn(e,t){const[i,...s]=e;if(0===s.length)this.set(i,t);else{const e=this.get(i,!0);if(Lo(e))e.setIn(s,t);else{if(void 0!==e||!this.schema)throw new Error(`Expected YAML collection at ${i}. Remaining path: ${s}`);this.set(i,Qo(this.schema,s,t))}}}}el.maxFlowStringSingleLineLength=60;const tl=e=>e.replace(/^(?!$)(?: $)?/gm,"#");function il(e,t){return/^\n+$/.test(e)?e.substring(1):t?e.replace(/^(?! *$)/gm,t):e}const sl=(e,t,i)=>e.endsWith("\n")?il(i,t):i.includes("\n")?"\n"+il(i,t):(e.endsWith(" ")?"":" ")+i,nl="flow",rl="block",al="quoted";function ol(e,t,i="flow",{indentAtStart:s,lineWidth:n=80,minContentWidth:r=20,onFold:a,onOverflow:o}={}){if(!n||n<0)return e;const l=Math.max(1+r,1+n-t.length);if(e.length<=l)return e;const c=[],h={};let u,d,p=n-t.length;"number"==typeof s&&(s>n-Math.max(2,r)?c.push(0):p=n-s);let m,f=!1,g=-1,b=-1,v=-1;for(i===rl&&(g=ll(e,g),-1!==g&&(p=g+l));m=e[g+=1];){if(i===al&&"\\"===m){switch(b=g,e[g+1]){case"x":g+=3;break;case"u":g+=5;break;case"U":g+=9;break;default:g+=1}v=g}if("\n"===m)i===rl&&(g=ll(e,g)),p=g+l,u=void 0;else{if(" "===m&&d&&" "!==d&&"\n"!==d&&"\t"!==d){const t=e[g+1];t&&" "!==t&&"\n"!==t&&"\t"!==t&&(u=g)}if(g>=p)if(u)c.push(u),p=u+l,u=void 0;else if(i===al){for(;" "===d||"\t"===d;)d=m,m=e[g+=1],f=!0;const t=g>v+1?g-2:b-1;if(h[t])return e;c.push(t),h[t]=!0,p=t+l,u=void 0}else f=!0}d=m}if(f&&o&&o(),0===c.length)return e;a&&a();let y=e.slice(0,c[0]);for(let s=0;s<c.length;++s){const n=c[s],r=c[s+1]||e.length;0===n?y=`\n${t}${e.slice(0,r)}`:(i===al&&h[n]&&(y+=`${e[n]}\\`),y+=`\n${t}${e.slice(n+1,r)}`)}return y}function ll(e,t){let i=e[t+1];for(;" "===i||"\t"===i;){do{i=e[t+=1]}while(i&&"\n"!==i);i=e[t+1]}return t}const cl=e=>({indentAtStart:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),hl=e=>/^(%|---|\.\.\.)/m.test(e);function ul(e,t){const i=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return i;const{implicitKey:s}=t,n=t.options.doubleQuotedMinMultiLineLength,r=t.indent||(hl(e)?"  ":"");let a="",o=0;for(let e=0,t=i[e];t;t=i[++e])if(" "===t&&"\\"===i[e+1]&&"n"===i[e+2]&&(a+=i.slice(o,e)+"\\ ",e+=1,o=e,t="\\"),"\\"===t)switch(i[e+1]){case"u":{a+=i.slice(o,e);const t=i.substr(e+2,4);switch(t){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:"00"===t.substr(0,2)?a+="\\x"+t.substr(2):a+=i.substr(e,6)}e+=5,o=e+1}break;case"n":if(s||'"'===i[e+2]||i.length<n)e+=1;else{for(a+=i.slice(o,e)+"\n\n";"\\"===i[e+2]&&"n"===i[e+3]&&'"'!==i[e+4];)a+="\n",e+=2;a+=r," "===i[e+2]&&(a+="\\"),e+=1,o=e+1}break;default:e+=1}return a=o?a+i.slice(o):i,s?a:ol(a,r,al,cl(t))}function dl(e,t){if(!1===t.options.singleQuote||t.implicitKey&&e.includes("\n")||/[ \t]\n|\n[ \t]/.test(e))return ul(e,t);const i=t.indent||(hl(e)?"  ":""),s="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&\n${i}`)+"'";return t.implicitKey?s:ol(s,i,nl,cl(t))}function pl(e,t){const{singleQuote:i}=t.options;let s;if(!1===i)s=ul;else{const t=e.includes('"'),n=e.includes("'");s=t&&!n?dl:n&&!t?ul:i?dl:ul}return s(e,t)}function ml({comment:e,type:t,value:i},s,n,r){const{blockQuote:a,commentString:o,lineWidth:l}=s.options;if(!a||/\n[\t ]+$/.test(i)||/^\s*$/.test(i))return pl(i,s);const c=s.indent||(s.forceBlockIndent||hl(i)?"  ":""),h="literal"===a||"folded"!==a&&t!==Jo.BLOCK_FOLDED&&(t===Jo.BLOCK_LITERAL||!function(e,t,i){if(!t||t<0)return!1;const s=t-i,n=e.length;if(n<=s)return!1;for(let t=0,i=0;t<n;++t)if("\n"===e[t]){if(t-i>s)return!0;if(i=t+1,n-i<=s)return!1}return!0}(i,l,c.length));if(!i)return h?"|\n":">\n";let u,d;for(d=i.length;d>0;--d){const e=i[d-1];if("\n"!==e&&"\t"!==e&&" "!==e)break}let p=i.substring(d);const m=p.indexOf("\n");-1===m?u="-":i===p||m!==p.length-1?(u="+",r&&r()):u="",p&&(i=i.slice(0,-p.length),"\n"===p[p.length-1]&&(p=p.slice(0,-1)),p=p.replace(/\n+(?!\n|$)/g,`$&${c}`));let f,g=!1,b=-1;for(f=0;f<i.length;++f){const e=i[f];if(" "===e)g=!0;else{if("\n"!==e)break;b=f}}let v=i.substring(0,b<f?b+1:f);v&&(i=i.substring(v.length),v=v.replace(/\n+/g,`$&${c}`));let y=(h?"|":">")+(g?c?"2":"1":"")+u;return e&&(y+=" "+o(e.replace(/ ?[\r\n]+/g," ")),n&&n()),h?`${y}\n${c}${v}${i=i.replace(/\n+/g,`$&${c}`)}${p}`:`${y}\n${c}${ol(`${v}${i=i.replace(/\n+/g,"\n$&").replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`)}${p}`,c,rl,cl(s))}`}function fl(e,t,i,s){const{implicitKey:n,inFlow:r}=t,a="string"==typeof e.value?e:Object.assign({},e,{value:String(e.value)});let{type:o}=e;o!==Jo.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(o=Jo.QUOTE_DOUBLE);const l=e=>{switch(e){case Jo.BLOCK_FOLDED:case Jo.BLOCK_LITERAL:return n||r?pl(a.value,t):ml(a,t,i,s);case Jo.QUOTE_DOUBLE:return ul(a.value,t);case Jo.QUOTE_SINGLE:return dl(a.value,t);case Jo.PLAIN:return function(e,t,i,s){const{type:n,value:r}=e,{actualString:a,implicitKey:o,indent:l,inFlow:c}=t;if(o&&/[\n[\]{},]/.test(r)||c&&/[[\]{},]/.test(r))return pl(r,t);if(!r||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return o||c||!r.includes("\n")?pl(r,t):ml(e,t,i,s);if(!o&&!c&&n!==Jo.PLAIN&&r.includes("\n"))return ml(e,t,i,s);if(""===l&&hl(r))return t.forceBlockIndent=!0,ml(e,t,i,s);const h=r.replace(/\n+/g,`$&\n${l}`);if(a){const e=e=>e.default&&"tag:yaml.org,2002:str"!==e.tag&&e.test?.test(h),{compat:i,tags:s}=t.doc.schema;if(s.some(e)||i?.some(e))return pl(r,t)}return o?h:ol(h,l,nl,cl(t))}(a,t,i,s);default:return null}};let c=l(o);if(null===c){const{defaultKeyType:e,defaultStringType:i}=t.options,s=n&&e||i;if(c=l(s),null===c)throw new Error(`Unsupported default string type ${s}`)}return c}function gl(e,t){const i=Object.assign({blockQuote:!0,commentString:tl,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,t);let s;switch(i.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:e,indent:"",indentStep:"number"==typeof i.indent?" ".repeat(i.indent):"  ",inFlow:s,options:i}}function bl(e,t,i,s){if(No(e))return e.toString(t,i,s);if(Eo(e)){if(t.doc.directives)return e.toString(t);if(t.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(e):t.resolvedAliases=new Set([e]),e=e.resolve(t.doc)}let n;const r=So(e)?e:t.doc.createNode(e,{onTagObj:e=>n=e});n||(n=function(e,t){if(t.tag){const i=e.filter((e=>e.tag===t.tag));if(i.length>0)return i.find((e=>e.format===t.format))??i[0]}let i,s;if(ko(t)){s=t.value;const n=e.filter((e=>e.identify?.(s)));i=n.find((e=>e.format===t.format))??n.find((e=>!e.format))}else s=t,i=e.find((e=>e.nodeClass&&s instanceof e.nodeClass));if(!i)throw new Error(`Tag not resolved for ${s?.constructor?.name??typeof s} value`);return i}(t.doc.schema.tags,r));const a=function(e,t,{anchors:i,doc:s}){if(!s.directives)return"";const n=[],r=(ko(e)||Lo(e))&&e.anchor;r&&Fo(r)&&(i.add(r),n.push(`&${r}`));const a=e.tag?e.tag:t.default?null:t.tag;return a&&n.push(s.directives.tagString(a)),n.join(" ")}(r,n,t);a.length>0&&(t.indentAtStart=(t.indentAtStart??0)+a.length+1);const o="function"==typeof n.stringify?n.stringify(r,t,i,s):ko(r)?fl(r,t,i,s):r.toString(t,i,s);return a?ko(r)||"{"===o[0]||"["===o[0]?`${a} ${o}`:`${a}\n${t.indent}${o}`:o}function vl(e,t){"debug"!==e&&"warn"!==e||("undefined"!=typeof process&&process.emitWarning?process.emitWarning(t):console.warn(t))}function yl(e,t,{key:i,value:s}){if(e?.doc.schema.merge&&wl(i))if(s=Eo(s)?s.resolve(e.doc):s,jo(s))for(const i of s.items)xl(e,t,i);else if(Array.isArray(s))for(const i of s)xl(e,t,i);else xl(e,t,s);else{const n=Xo(i,"",e);if(t instanceof Map)t.set(n,Xo(s,n,e));else if(t instanceof Set)t.add(n);else{const r=function(e,t,i){if(null===t)return"";if("object"!=typeof t)return String(t);if(So(e)&&i&&i.doc){const t=gl(i.doc,{});t.anchors=new Set;for(const e of i.anchors.keys())t.anchors.add(e.anchor);t.inFlow=!0,t.inStringifyKey=!0;const s=e.toString(t);if(!i.mapKeyWarned){let e=JSON.stringify(s);e.length>40&&(e=e.substring(0,36)+'..."'),vl(i.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${e}. Set mapAsMap: true to use object keys.`),i.mapKeyWarned=!0}return s}return JSON.stringify(t)}(i,n,e),a=Xo(s,r,e);r in t?Object.defineProperty(t,r,{value:a,writable:!0,enumerable:!0,configurable:!0}):t[r]=a}}return t}const wl=e=>"<<"===e||ko(e)&&"<<"===e.value&&(!e.type||e.type===Jo.PLAIN);function xl(e,t,i){const s=e&&Eo(i)?i.resolve(e.doc):i;if(!Oo(s))throw new Error("Merge sources must be maps or map aliases");const n=s.toJSON(null,e,Map);for(const[e,i]of n)t instanceof Map?t.has(e)||t.set(e,i):t instanceof Set?t.add(e):Object.prototype.hasOwnProperty.call(t,e)||Object.defineProperty(t,e,{value:i,writable:!0,enumerable:!0,configurable:!0});return t}function El(e,t,i){const s=Go(e,void 0,i),n=Go(t,void 0,i);return new Al(s,n)}class Al{constructor(e,t=null){Object.defineProperty(this,xo,{value:vo}),this.key=e,this.value=t}clone(e){let{key:t,value:i}=this;return So(t)&&(t=t.clone(e)),So(i)&&(i=i.clone(e)),new Al(t,i)}toJSON(e,t){return yl(t,t?.mapAsMap?new Map:{},this)}toString(e,t,i){return e?.doc?function({key:e,value:t},i,s,n){const{allNullValues:r,doc:a,indent:o,indentStep:l,options:{commentString:c,indentSeq:h,simpleKeys:u}}=i;let d=So(e)&&e.comment||null;if(u){if(d)throw new Error("With simple keys, key nodes cannot have comments");if(Lo(e))throw new Error("With simple keys, collection cannot be used as a key value")}let p=!u&&(!e||d&&null==t&&!i.inFlow||Lo(e)||(ko(e)?e.type===Jo.BLOCK_FOLDED||e.type===Jo.BLOCK_LITERAL:"object"==typeof e));i=Object.assign({},i,{allNullValues:!1,implicitKey:!p&&(u||!r),indent:o+l});let m=!1,f=!1,g=bl(e,i,(()=>m=!0),(()=>f=!0));if(!p&&!i.inFlow&&g.length>1024){if(u)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");p=!0}if(i.inFlow){if(r||null==t)return m&&s&&s(),""===g?"?":p?`? ${g}`:g}else if(r&&!u||null==t&&p)return g=`? ${g}`,d&&!m?g+=sl(g,i.indent,c(d)):f&&n&&n(),g;m&&(d=null),p?(d&&(g+=sl(g,i.indent,c(d))),g=`? ${g}\n${o}:`):(g=`${g}:`,d&&(g+=sl(g,i.indent,c(d))));let b="",v=null;So(t)?(t.spaceBefore&&(b="\n"),t.commentBefore&&(b+=`\n${il(c(t.commentBefore),i.indent)}`),v=t.comment):t&&"object"==typeof t&&(t=a.createNode(t)),i.implicitKey=!1,p||d||!ko(t)||(i.indentAtStart=g.length+1),f=!1,h||!(l.length>=2)||i.inFlow||p||!jo(t)||t.flow||t.tag||t.anchor||(i.indent=i.indent.substr(2));let y=!1;const w=bl(t,i,(()=>y=!0),(()=>f=!0));let x=" ";return b||d?x=""!==w||i.inFlow?`${b}\n${i.indent}`:"\n"===b?"\n\n":b:!p&&Lo(t)?("["===w[0]||"{"===w[0])&&!w.includes("\n")||(x=`\n${i.indent}`):""!==w&&"\n"!==w[0]||(x=""),g+=x+w,i.inFlow?y&&s&&s():v&&!y?g+=sl(g,i.indent,c(v)):f&&n&&n(),g}(this,e,t,i):JSON.stringify(this)}}function Ol(e,t,i){return(t.inFlow??e.flow?kl:Nl)(e,t,i)}function Nl({comment:e,items:t},i,{blockItemPrefix:s,flowChars:n,itemIndent:r,onChompKeep:a,onComment:o}){const{indent:l,options:{commentString:c}}=i,h=Object.assign({},i,{indent:r,type:null});let u=!1;const d=[];for(let e=0;e<t.length;++e){const n=t[e];let a=null;if(So(n))!u&&n.spaceBefore&&d.push(""),jl(i,d,n.commentBefore,u),n.comment&&(a=n.comment);else if(No(n)){const e=So(n.key)?n.key:null;e&&(!u&&e.spaceBefore&&d.push(""),jl(i,d,e.commentBefore,u))}u=!1;let o=bl(n,h,(()=>a=null),(()=>u=!0));a&&(o+=sl(o,r,c(a))),u&&a&&(u=!1),d.push(s+o)}let p;if(0===d.length)p=n.start+n.end;else{p=d[0];for(let e=1;e<d.length;++e){const t=d[e];p+=t?`\n${l}${t}`:"\n"}}return e?(p+="\n"+il(c(e),l),o&&o()):u&&a&&a(),p}function kl({comment:e,items:t},i,{flowChars:s,itemIndent:n,onComment:r}){const{indent:a,indentStep:o,options:{commentString:l}}=i;n+=o;const c=Object.assign({},i,{indent:n,inFlow:!0,type:null});let h=!1,u=0;const d=[];for(let e=0;e<t.length;++e){const s=t[e];let r=null;if(So(s))s.spaceBefore&&d.push(""),jl(i,d,s.commentBefore,!1),s.comment&&(r=s.comment);else if(No(s)){const e=So(s.key)?s.key:null;e&&(e.spaceBefore&&d.push(""),jl(i,d,e.commentBefore,!1),e.comment&&(h=!0));const t=So(s.value)?s.value:null;t?(t.comment&&(r=t.comment),t.commentBefore&&(h=!0)):null==s.value&&e&&e.comment&&(r=e.comment)}r&&(h=!0);let a=bl(s,c,(()=>r=null));e<t.length-1&&(a+=","),r&&(a+=sl(a,n,l(r))),!h&&(d.length>u||a.includes("\n"))&&(h=!0),d.push(a),u=d.length}let p;const{start:m,end:f}=s;if(0===d.length)p=m+f;else if(h||(h=d.reduce(((e,t)=>e+t.length+2),2)>el.maxFlowStringSingleLineLength),h){p=m;for(const e of d)p+=e?`\n${o}${a}${e}`:"\n";p+=`\n${a}${f}`}else p=`${m} ${d.join(" ")} ${f}`;return e&&(p+=sl(p,l(e),a),r&&r()),p}function jl({indent:e,options:{commentString:t}},i,s,n){if(s&&n&&(s=s.replace(/^\n+/,"")),s){const n=il(t(s),e);i.push(n.trimStart())}}function Ll(e,t){const i=ko(t)?t.value:t;for(const s of e)if(No(s)){if(s.key===t||s.key===i)return s;if(ko(s.key)&&s.key.value===i)return s}}class Sl extends el{constructor(e){super(bo,e),this.items=[]}static get tagName(){return"tag:yaml.org,2002:map"}add(e,t){let i;i=No(e)?e:e&&"object"==typeof e&&"key"in e?new Al(e.key,e.value):new Al(e,e?.value);const s=Ll(this.items,i.key),n=this.schema?.sortMapEntries;if(s){if(!t)throw new Error(`Key ${i.key} already set`);ko(s.value)&&Yo(i.value)?s.value.value=i.value:s.value=i.value}else if(n){const e=this.items.findIndex((e=>n(i,e)<0));-1===e?this.items.push(i):this.items.splice(e,0,i)}else this.items.push(i)}delete(e){const t=Ll(this.items,e);return!!t&&this.items.splice(this.items.indexOf(t),1).length>0}get(e,t){const i=Ll(this.items,e)?.value;return(!t&&ko(i)?i.value:i)??void 0}has(e){return!!Ll(this.items,e)}set(e,t){this.add(new Al(e,t),!0)}toJSON(e,t,i){const s=i?new i:t?.mapAsMap?new Map:{};t?.onCreate&&t.onCreate(s);for(const e of this.items)yl(t,s,e);return s}toString(e,t,i){if(!e)return JSON.stringify(this);for(const e of this.items)if(!No(e))throw new Error(`Map items must all be pairs; found ${JSON.stringify(e)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),Ol(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:i,onComment:t})}}const Cl={collection:"map",createNode:function(e,t,i){const{keepUndefined:s,replacer:n}=i,r=new Sl(e),a=(e,a)=>{if("function"==typeof n)a=n.call(t,e,a);else if(Array.isArray(n)&&!n.includes(e))return;(void 0!==a||s)&&r.items.push(El(e,a,i))};if(t instanceof Map)for(const[e,i]of t)a(e,i);else if(t&&"object"==typeof t)for(const e of Object.keys(t))a(e,t[e]);return"function"==typeof e.sortMapEntries&&r.items.sort(e.sortMapEntries),r},default:!0,nodeClass:Sl,tag:"tag:yaml.org,2002:map",resolve:(e,t)=>(Oo(e)||t("Expected a mapping for this tag"),e)};class Tl extends el{constructor(e){super(wo,e),this.items=[]}static get tagName(){return"tag:yaml.org,2002:seq"}add(e){this.items.push(e)}delete(e){const t=Il(e);return"number"==typeof t&&this.items.splice(t,1).length>0}get(e,t){const i=Il(e);if("number"!=typeof i)return;const s=this.items[i];return!t&&ko(s)?s.value:s}has(e){const t=Il(e);return"number"==typeof t&&t<this.items.length}set(e,t){const i=Il(e);if("number"!=typeof i)throw new Error(`Expected a valid index, not ${e}.`);const s=this.items[i];ko(s)&&Yo(t)?s.value=t:this.items[i]=t}toJSON(e,t){const i=[];t?.onCreate&&t.onCreate(i);let s=0;for(const e of this.items)i.push(Xo(e,String(s++),t));return i}toString(e,t,i){return e?Ol(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:i,onComment:t}):JSON.stringify(this)}}function Il(e){let t=ko(e)?e.value:e;return t&&"string"==typeof t&&(t=Number(t)),"number"==typeof t&&Number.isInteger(t)&&t>=0?t:null}const Ml={collection:"seq",createNode:function(e,t,i){const{replacer:s}=i,n=new Tl(e);if(t&&Symbol.iterator in Object(t)){let e=0;for(let r of t){if("function"==typeof s){const i=t instanceof Set?r:String(e++);r=s.call(t,i,r)}n.items.push(Go(r,void 0,i))}}return n},default:!0,nodeClass:Tl,tag:"tag:yaml.org,2002:seq",resolve:(e,t)=>(jo(e)||t("Expected a sequence for this tag"),e)},Ul={identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:(e,t,i,s)=>fl(e,t=Object.assign({actualString:!0},t),i,s)},Dl={identify:e=>null==e,createNode:()=>new Jo(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Jo(null),stringify:({source:e},t)=>"string"==typeof e&&Dl.test.test(e)?e:t.options.nullStr},_l={identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new Jo("t"===e[0]||"T"===e[0]),stringify:({source:e,value:t},i)=>e&&_l.test.test(e)&&t===("t"===e[0]||"T"===e[0])?e:t?i.options.trueStr:i.options.falseStr};function Bl({format:e,minFractionDigits:t,tag:i,value:s}){if("bigint"==typeof s)return String(s);const n="number"==typeof s?s:Number(s);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let r=JSON.stringify(s);if(!e&&t&&(!i||"tag:yaml.org,2002:float"===i)&&/^\d/.test(r)){let e=r.indexOf(".");e<0&&(e=r.length,r+=".");let i=t-(r.length-e-1);for(;i-- >0;)r+="0"}return r}const Pl={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN))$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Bl},Hl={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():Bl(e)}},Vl={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new Jo(parseFloat(e)),i=e.indexOf(".");return-1!==i&&"0"===e[e.length-1]&&(t.minFractionDigits=e.length-i-1),t},stringify:Bl},Rl=e=>"bigint"==typeof e||Number.isInteger(e),$l=(e,t,i,{intAsBigInt:s})=>s?BigInt(e):parseInt(e.substring(t),i);function Fl(e,t,i){const{value:s}=e;return Rl(s)&&s>=0?i+s.toString(t):Bl(e)}const ql={identify:e=>Rl(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,i)=>$l(e,2,8,i),stringify:e=>Fl(e,8,"0o")},zl={identify:Rl,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,i)=>$l(e,0,10,i),stringify:Bl},Wl={identify:e=>Rl(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,i)=>$l(e,2,16,i),stringify:e=>Fl(e,16,"0x")},Kl=[Cl,Ml,Ul,Dl,_l,ql,zl,Wl,Pl,Hl,Vl];function Xl(e){return"bigint"==typeof e||Number.isInteger(e)}const Yl=({value:e})=>JSON.stringify(e),Jl=[Cl,Ml].concat([{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:Yl},{identify:e=>null==e,createNode:()=>new Jo(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Yl},{identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:e=>"true"===e,stringify:Yl},{identify:Xl,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:i})=>i?BigInt(e):parseInt(e,10),stringify:({value:e})=>Xl(e)?e.toString():JSON.stringify(e)},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:Yl}],{default:!0,tag:"",test:/^/,resolve:(e,t)=>(t(`Unresolved plain scalar ${JSON.stringify(e)}`),e)}),Gl={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if("function"==typeof Buffer)return Buffer.from(e,"base64");if("function"==typeof atob){const t=atob(e.replace(/[\n\r]/g,"")),i=new Uint8Array(t.length);for(let e=0;e<t.length;++e)i[e]=t.charCodeAt(e);return i}return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:i},s,n,r){const a=i;let o;if("function"==typeof Buffer)o=a instanceof Buffer?a.toString("base64"):Buffer.from(a.buffer).toString("base64");else{if("function"!=typeof btoa)throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");{let e="";for(let t=0;t<a.length;++t)e+=String.fromCharCode(a[t]);o=btoa(e)}}if(t||(t=Jo.BLOCK_LITERAL),t!==Jo.QUOTE_DOUBLE){const e=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),i=Math.ceil(o.length/e),n=new Array(i);for(let t=0,s=0;t<i;++t,s+=e)n[t]=o.substr(s,e);o=n.join(t===Jo.BLOCK_LITERAL?"\n":" ")}return fl({comment:e,type:t,value:o},s,n,r)}};function Ql(e,t){if(jo(e))for(let i=0;i<e.items.length;++i){let s=e.items[i];if(!No(s)){if(Oo(s)){s.items.length>1&&t("Each pair must have its own sequence indicator");const e=s.items[0]||new Al(new Jo(null));if(s.commentBefore&&(e.key.commentBefore=e.key.commentBefore?`${s.commentBefore}\n${e.key.commentBefore}`:s.commentBefore),s.comment){const t=e.value??e.key;t.comment=t.comment?`${s.comment}\n${t.comment}`:s.comment}s=e}e.items[i]=No(s)?s:new Al(s)}}else t("Expected a sequence for this tag");return e}function Zl(e,t,i){const{replacer:s}=i,n=new Tl(e);n.tag="tag:yaml.org,2002:pairs";let r=0;if(t&&Symbol.iterator in Object(t))for(let e of t){let a,o;if("function"==typeof s&&(e=s.call(t,String(r++),e)),Array.isArray(e)){if(2!==e.length)throw new TypeError(`Expected [key, value] tuple: ${e}`);a=e[0],o=e[1]}else if(e&&e instanceof Object){const t=Object.keys(e);if(1!==t.length)throw new TypeError(`Expected { key: value } tuple: ${e}`);a=t[0],o=e[a]}else a=e;n.items.push(El(a,o,i))}return n}const ec={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Ql,createNode:Zl};class tc extends Tl{constructor(){super(),this.add=Sl.prototype.add.bind(this),this.delete=Sl.prototype.delete.bind(this),this.get=Sl.prototype.get.bind(this),this.has=Sl.prototype.has.bind(this),this.set=Sl.prototype.set.bind(this),this.tag=tc.tag}toJSON(e,t){if(!t)return super.toJSON(e);const i=new Map;t?.onCreate&&t.onCreate(i);for(const e of this.items){let s,n;if(No(e)?(s=Xo(e.key,"",t),n=Xo(e.value,s,t)):s=Xo(e,"",t),i.has(s))throw new Error("Ordered maps must not include duplicate keys");i.set(s,n)}return i}}tc.tag="tag:yaml.org,2002:omap";const ic={collection:"seq",identify:e=>e instanceof Map,nodeClass:tc,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const i=Ql(e,t),s=[];for(const{key:e}of i.items)ko(e)&&(s.includes(e.value)?t(`Ordered maps must not include duplicate keys: ${e.value}`):s.push(e.value));return Object.assign(new tc,i)},createNode(e,t,i){const s=Zl(e,t,i),n=new tc;return n.items=s.items,n}};function sc({value:e,source:t},i){return t&&(e?nc:rc).test.test(t)?t:e?i.options.trueStr:i.options.falseStr}const nc={identify:e=>!0===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Jo(!0),stringify:sc},rc={identify:e=>!1===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/i,resolve:()=>new Jo(!1),stringify:sc},ac={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Bl},oc={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():Bl(e)}},lc={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new Jo(parseFloat(e.replace(/_/g,""))),i=e.indexOf(".");if(-1!==i){const s=e.substring(i+1).replace(/_/g,"");"0"===s[s.length-1]&&(t.minFractionDigits=s.length)}return t},stringify:Bl},cc=e=>"bigint"==typeof e||Number.isInteger(e);function hc(e,t,i,{intAsBigInt:s}){const n=e[0];if("-"!==n&&"+"!==n||(t+=1),e=e.substring(t).replace(/_/g,""),s){switch(i){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`}const t=BigInt(e);return"-"===n?BigInt(-1)*t:t}const r=parseInt(e,i);return"-"===n?-1*r:r}function uc(e,t,i){const{value:s}=e;if(cc(s)){const e=s.toString(t);return s<0?"-"+i+e.substr(1):i+e}return Bl(e)}const dc={identify:cc,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,i)=>hc(e,2,2,i),stringify:e=>uc(e,2,"0b")},pc={identify:cc,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,i)=>hc(e,1,8,i),stringify:e=>uc(e,8,"0")},mc={identify:cc,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,i)=>hc(e,0,10,i),stringify:Bl},fc={identify:cc,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,i)=>hc(e,2,16,i),stringify:e=>uc(e,16,"0x")};class gc extends Sl{constructor(e){super(e),this.tag=gc.tag}add(e){let t;t=No(e)?e:"object"==typeof e&&"key"in e&&"value"in e&&null===e.value?new Al(e.key,null):new Al(e,null),Ll(this.items,t.key)||this.items.push(t)}get(e,t){const i=Ll(this.items,e);return!t&&No(i)?ko(i.key)?i.key.value:i.key:i}set(e,t){if("boolean"!=typeof t)throw new Error("Expected boolean value for set(key, value) in a YAML set, not "+typeof t);const i=Ll(this.items,e);i&&!t?this.items.splice(this.items.indexOf(i),1):!i&&t&&this.items.push(new Al(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,i){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,i);throw new Error("Set items must all have null values")}}gc.tag="tag:yaml.org,2002:set";const bc={collection:"map",identify:e=>e instanceof Set,nodeClass:gc,default:!1,tag:"tag:yaml.org,2002:set",resolve(e,t){if(Oo(e)){if(e.hasAllNullValues(!0))return Object.assign(new gc,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e},createNode(e,t,i){const{replacer:s}=i,n=new gc(e);if(t&&Symbol.iterator in Object(t))for(let e of t)"function"==typeof s&&(e=s.call(t,e,e)),n.items.push(El(e,null,i));return n}};function vc(e,t){const i=e[0],s="-"===i||"+"===i?e.substring(1):e,n=e=>t?BigInt(e):Number(e),r=s.replace(/_/g,"").split(":").reduce(((e,t)=>e*n(60)+n(t)),n(0));return"-"===i?n(-1)*r:r}function yc(e){let{value:t}=e,i=e=>e;if("bigint"==typeof t)i=e=>BigInt(e);else if(isNaN(t)||!isFinite(t))return Bl(e);let s="";t<0&&(s="-",t*=i(-1));const n=i(60),r=[t%n];return t<60?r.unshift(0):(t=(t-r[0])/n,r.unshift(t%n),t>=60&&(t=(t-r[0])/n,r.unshift(t))),s+r.map((e=>e<10?"0"+String(e):String(e))).join(":").replace(/000000\d*$/,"")}const wc={identify:e=>"bigint"==typeof e||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:i})=>vc(e,i),stringify:yc},xc={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>vc(e,!1),stringify:yc},Ec={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(Ec.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,i,s,n,r,a,o]=t.map(Number),l=t[7]?Number((t[7]+"00").substr(1,3)):0;let c=Date.UTC(i,s-1,n,r||0,a||0,o||0,l);const h=t[8];if(h&&"Z"!==h){let e=vc(h,!1);Math.abs(e)<30&&(e*=60),c-=6e4*e}return new Date(c)},stringify:({value:e})=>e.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")},Ac=[Cl,Ml,Ul,Dl,nc,rc,dc,pc,mc,fc,ac,oc,lc,Gl,ic,ec,bc,wc,xc,Ec],Oc=new Map([["core",Kl],["failsafe",[Cl,Ml,Ul]],["json",Jl],["yaml11",Ac],["yaml-1.1",Ac]]),Nc={binary:Gl,bool:_l,float:Vl,floatExp:Hl,floatNaN:Pl,floatTime:xc,int:zl,intHex:Wl,intOct:ql,intTime:wc,map:Cl,null:Dl,omap:ic,pairs:ec,seq:Ml,set:bc,timestamp:Ec},kc={"tag:yaml.org,2002:binary":Gl,"tag:yaml.org,2002:omap":ic,"tag:yaml.org,2002:pairs":ec,"tag:yaml.org,2002:set":bc,"tag:yaml.org,2002:timestamp":Ec};function jc(e,t){let i=Oc.get(t);if(!i){if(!Array.isArray(e)){const e=Array.from(Oc.keys()).filter((e=>"yaml11"!==e)).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${e} or define customTags array`)}i=[]}if(Array.isArray(e))for(const t of e)i=i.concat(t);else"function"==typeof e&&(i=e(i.slice()));return i.map((e=>{if("string"!=typeof e)return e;const t=Nc[e];if(t)return t;const i=Object.keys(Nc).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown custom tag "${e}"; use one of ${i}`)}))}const Lc=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0;class Sc{constructor({compat:e,customTags:t,merge:i,resolveKnownTags:s,schema:n,sortMapEntries:r,toStringDefaults:a}){this.compat=Array.isArray(e)?jc(e,"compat"):e?jc(null,e):null,this.merge=!!i,this.name="string"==typeof n&&n||"core",this.knownTags=s?kc:{},this.tags=jc(t,this.name),this.toStringOptions=a??null,Object.defineProperty(this,bo,{value:Cl}),Object.defineProperty(this,yo,{value:Ul}),Object.defineProperty(this,wo,{value:Ml}),this.sortMapEntries="function"==typeof r?r:!0===r?Lc:null}clone(){const e=Object.create(Sc.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function Cc(e,t,i,s){if(s&&"object"==typeof s)if(Array.isArray(s))for(let t=0,i=s.length;t<i;++t){const i=s[t],n=Cc(e,s,String(t),i);void 0===n?delete s[t]:n!==i&&(s[t]=n)}else if(s instanceof Map)for(const t of Array.from(s.keys())){const i=s.get(t),n=Cc(e,s,t,i);void 0===n?s.delete(t):n!==i&&s.set(t,n)}else if(s instanceof Set)for(const t of Array.from(s)){const i=Cc(e,s,t,t);void 0===i?s.delete(t):i!==t&&(s.delete(t),s.add(i))}else for(const[t,i]of Object.entries(s)){const n=Cc(e,s,t,i);void 0===n?delete s[t]:n!==i&&(s[t]=n)}return e.call(t,i,s)}class Tc{constructor(e,t,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,xo,{value:go});let s=null;"function"==typeof t||Array.isArray(t)?s=t:void 0===i&&t&&(i=t,t=void 0);const n=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,uniqueKeys:!0,version:"1.2"},i);this.options=n;let{version:r}=n;i?._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(r=this.directives.yaml.version)):this.directives=new $o({version:r}),this.setSchema(r,i),this.contents=void 0===e?null:this.createNode(e,s,i)}clone(){const e=Object.create(Tc.prototype,{[xo]:{value:go}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=So(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Ic(this.contents)&&this.contents.add(e)}addIn(e,t){Ic(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const i=qo(this);e.anchor=!t||i.has(t)?zo(t||"a",i):t}return new Wo(e.anchor)}createNode(e,t,i){let s;if("function"==typeof t)e=t.call({"":e},"",e),s=t;else if(Array.isArray(t)){const e=e=>"number"==typeof e||e instanceof String||e instanceof Number,i=t.filter(e).map(String);i.length>0&&(t=t.concat(i)),s=t}else void 0===i&&t&&(i=t,t=void 0);const{aliasDuplicateObjects:n,anchorPrefix:r,flow:a,keepUndefined:o,onTagObj:l,tag:c}=i??{},{onAnchor:h,setAnchors:u,sourceObjects:d}=function(e,t){const i=[],s=new Map;let n=null;return{onAnchor:s=>{i.push(s),n||(n=qo(e));const r=zo(t,n);return n.add(r),r},setAnchors:()=>{for(const e of i){const t=s.get(e);if("object"!=typeof t||!t.anchor||!ko(t.node)&&!Lo(t.node)){const t=new Error("Failed to resolve repeated object (this should not happen)");throw t.source=e,t}t.node.anchor=t.anchor}},sourceObjects:s}}(this,r||"a"),p=Go(e,c,{aliasDuplicateObjects:n??!0,keepUndefined:o??!1,onAnchor:h,onTagObj:l,replacer:s,schema:this.schema,sourceObjects:d});return a&&Lo(p)&&(p.flow=!0),u(),p}createPair(e,t,i={}){const s=this.createNode(e,null,i),n=this.createNode(t,null,i);return new Al(s,n)}delete(e){return!!Ic(this.contents)&&this.contents.delete(e)}deleteIn(e){return Zo(e)?null!=this.contents&&(this.contents=null,!0):!!Ic(this.contents)&&this.contents.deleteIn(e)}get(e,t){return Lo(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return Zo(e)?!t&&ko(this.contents)?this.contents.value:this.contents:Lo(this.contents)?this.contents.getIn(e,t):void 0}has(e){return!!Lo(this.contents)&&this.contents.has(e)}hasIn(e){return Zo(e)?void 0!==this.contents:!!Lo(this.contents)&&this.contents.hasIn(e)}set(e,t){null==this.contents?this.contents=Qo(this.schema,[e],t):Ic(this.contents)&&this.contents.set(e,t)}setIn(e,t){Zo(e)?this.contents=t:null==this.contents?this.contents=Qo(this.schema,Array.from(e),t):Ic(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){let i;switch("number"==typeof e&&(e=String(e)),e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new $o({version:"1.1"}),i={merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new $o({version:e}),i={merge:!1,resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const t=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${t}`)}}if(t.schema instanceof Object)this.schema=t.schema;else{if(!i)throw new Error("With a null YAML version, the { schema: Schema } option is required");this.schema=new Sc(Object.assign(i,t))}}toJS({json:e,jsonArg:t,mapAsMap:i,maxAliasCount:s,onAnchor:n,reviver:r}={}){const a={anchors:new Map,doc:this,keep:!e,mapAsMap:!0===i,mapKeyWarned:!1,maxAliasCount:"number"==typeof s?s:100,stringify:bl},o=Xo(this.contents,t??"",a);if("function"==typeof n)for(const{count:e,res:t}of a.anchors.values())n(t,e);return"function"==typeof r?Cc(r,{"":o},"",o):o}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return function(e,t){const i=[];let s=!0===t.directives;if(!1!==t.directives&&e.directives){const t=e.directives.toString(e);t?(i.push(t),s=!0):e.directives.docStart&&(s=!0)}s&&i.push("---");const n=gl(e,t),{commentString:r}=n.options;if(e.commentBefore){1!==i.length&&i.unshift("");const t=r(e.commentBefore);i.unshift(il(t,""))}let a=!1,o=null;if(e.contents){if(So(e.contents)){if(e.contents.spaceBefore&&s&&i.push(""),e.contents.commentBefore){const t=r(e.contents.commentBefore);i.push(il(t,""))}n.forceBlockIndent=!!e.comment,o=e.contents.comment}const t=o?void 0:()=>a=!0;let l=bl(e.contents,n,(()=>o=null),t);o&&(l+=sl(l,"",r(o))),"|"!==l[0]&&">"!==l[0]||"---"!==i[i.length-1]?i.push(l):i[i.length-1]=`--- ${l}`}else i.push(bl(e.contents,n));if(e.directives?.docEnd)if(e.comment){const t=r(e.comment);t.includes("\n")?(i.push("..."),i.push(il(t,""))):i.push(`... ${t}`)}else i.push("...");else{let t=e.comment;t&&a&&(t=t.replace(/^\n+/,"")),t&&(a&&!o||""===i[i.length-1]||i.push(""),i.push(il(r(t),"")))}return i.join("\n")+"\n"}(this,e)}}function Ic(e){if(Lo(e))return!0;throw new Error("Expected a YAML collection as document contents")}class Mc extends Error{constructor(e,t,i,s){super(),this.name=e,this.code=i,this.message=s,this.pos=t}}class Uc extends Mc{constructor(e,t,i){super("YAMLParseError",e,t,i)}}class Dc extends Mc{constructor(e,t,i){super("YAMLWarning",e,t,i)}}const _c=(e,t)=>i=>{if(-1===i.pos[0])return;i.linePos=i.pos.map((e=>t.linePos(e)));const{line:s,col:n}=i.linePos[0];i.message+=` at line ${s}, column ${n}`;let r=n-1,a=e.substring(t.lineStarts[s-1],t.lineStarts[s]).replace(/[\n\r]+$/,"");if(r>=60&&a.length>80){const e=Math.min(r-39,a.length-79);a="…"+a.substring(e),r-=e-1}if(a.length>80&&(a=a.substring(0,79)+"…"),s>1&&/^ *$/.test(a.substring(0,r))){let i=e.substring(t.lineStarts[s-2],t.lineStarts[s-1]);i.length>80&&(i=i.substring(0,79)+"…\n"),a=i+a}if(/[^ ]/.test(a)){let e=1;const t=i.linePos[1];t&&t.line===s&&t.col>n&&(e=Math.min(t.col-n,80-r));const o=" ".repeat(r)+"^".repeat(e);i.message+=`:\n\n${a}\n${o}\n`}};function Bc(e,{flow:t,indicator:i,next:s,offset:n,onError:r,startOnNewline:a}){let o=!1,l=a,c=a,h="",u="",d=!1,p=!1,m=!1,f=null,g=null,b=null,v=null,y=null;for(const s of e)switch(m&&("space"!==s.type&&"newline"!==s.type&&"comma"!==s.type&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),m=!1),s.type){case"space":!t&&l&&"doc-start"!==i&&"\t"===s.source[0]&&r(s,"TAB_AS_INDENT","Tabs are not allowed as indentation"),c=!0;break;case"comment":{c||r(s,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const e=s.source.substring(1)||" ";h?h+=u+e:h=e,u="",l=!1;break}case"newline":l?h?h+=s.source:o=!0:u+=s.source,l=!0,d=!0,(f||g)&&(p=!0),c=!0;break;case"anchor":f&&r(s,"MULTIPLE_ANCHORS","A node can have at most one anchor"),s.source.endsWith(":")&&r(s.offset+s.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),f=s,null===y&&(y=s.offset),l=!1,c=!1,m=!0;break;case"tag":g&&r(s,"MULTIPLE_TAGS","A node can have at most one tag"),g=s,null===y&&(y=s.offset),l=!1,c=!1,m=!0;break;case i:(f||g)&&r(s,"BAD_PROP_ORDER",`Anchors and tags must be after the ${s.source} indicator`),v&&r(s,"UNEXPECTED_TOKEN",`Unexpected ${s.source} in ${t??"collection"}`),v=s,l=!1,c=!1;break;case"comma":if(t){b&&r(s,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),b=s,l=!1,c=!1;break}default:r(s,"UNEXPECTED_TOKEN",`Unexpected ${s.type} token`),l=!1,c=!1}const w=e[e.length-1],x=w?w.offset+w.source.length:n;return m&&s&&"space"!==s.type&&"newline"!==s.type&&"comma"!==s.type&&("scalar"!==s.type||""!==s.source)&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),{comma:b,found:v,spaceBefore:o,comment:h,hasNewline:d,hasNewlineAfterProp:p,anchor:f,tag:g,end:x,start:y??x}}function Pc(e){if(!e)return null;switch(e.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(e.source.includes("\n"))return!0;if(e.end)for(const t of e.end)if("newline"===t.type)return!0;return!1;case"flow-collection":for(const t of e.items){for(const e of t.start)if("newline"===e.type)return!0;if(t.sep)for(const e of t.sep)if("newline"===e.type)return!0;if(Pc(t.key)||Pc(t.value))return!0}return!1;default:return!0}}function Hc(e,t,i){if("flow-collection"===t?.type){const s=t.end[0];s.indent!==e||"]"!==s.source&&"}"!==s.source||!Pc(t)||i(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Vc(e,t,i){const{uniqueKeys:s}=e.options;if(!1===s)return!1;const n="function"==typeof s?s:(t,i)=>t===i||ko(t)&&ko(i)&&t.value===i.value&&!("<<"===t.value&&e.schema.merge);return t.some((e=>n(e.key,i)))}const Rc="All mapping items must start at the same column";function $c(e,t,i,s){let n="";if(e){let r=!1,a="";for(const o of e){const{source:e,type:l}=o;switch(l){case"space":r=!0;break;case"comment":{i&&!r&&s(o,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const t=e.substring(1)||" ";n?n+=a+t:n=t,a="";break}case"newline":n&&(a+=e),r=!0;break;default:s(o,"UNEXPECTED_TOKEN",`Unexpected ${l} at node end`)}t+=e.length}}return{comment:n,offset:t}}const Fc="Block collections are not allowed within flow collections",qc=e=>e&&("block-map"===e.type||"block-seq"===e.type);function zc(e,t,i){const s=e.offset,n=function({offset:e,props:t},i,s){if("block-scalar-header"!==t[0].type)return s(t[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:n}=t[0],r=n[0];let a=0,o="",l=-1;for(let t=1;t<n.length;++t){const i=n[t];if(o||"-"!==i&&"+"!==i){const s=Number(i);!a&&s?a=s:-1===l&&(l=e+t)}else o=i}-1!==l&&s(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let c=!1,h="",u=n.length;for(let e=1;e<t.length;++e){const n=t[e];switch(n.type){case"space":c=!0;case"newline":u+=n.source.length;break;case"comment":i&&!c&&s(n,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),u+=n.source.length,h=n.source.substring(1);break;case"error":s(n,"UNEXPECTED_TOKEN",n.message),u+=n.source.length;break;default:{s(n,"UNEXPECTED_TOKEN",`Unexpected token in block scalar header: ${n.type}`);const e=n.source;e&&"string"==typeof e&&(u+=e.length)}}}return{mode:r,indent:a,chomp:o,comment:h,length:u}}(e,t,i);if(!n)return{value:"",type:null,comment:"",range:[s,s,s]};const r=">"===n.mode?Jo.BLOCK_FOLDED:Jo.BLOCK_LITERAL,a=e.source?function(e){const t=e.split(/\n( *)/),i=t[0],s=i.match(/^( *)/),n=[s?.[1]?[s[1],i.slice(s[1].length)]:["",i]];for(let e=1;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}(e.source):[];let o=a.length;for(let e=a.length-1;e>=0;--e){const t=a[e][1];if(""!==t&&"\r"!==t)break;o=e}if(0===o){const t="+"===n.chomp&&a.length>0?"\n".repeat(Math.max(1,a.length-1)):"";let i=s+n.length;return e.source&&(i+=e.source.length),{value:t,type:r,comment:n.comment,range:[s,i,i]}}let l=e.indent+n.indent,c=e.offset+n.length,h=0;for(let e=0;e<o;++e){const[t,s]=a[e];if(""!==s&&"\r"!==s){if(t.length<l){const e="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";i(c+t.length,"MISSING_CHAR",e)}0===n.indent&&(l=t.length),h=e;break}0===n.indent&&t.length>l&&(l=t.length),c+=t.length+s.length+1}for(let e=a.length-1;e>=o;--e)a[e][0].length>l&&(o=e+1);let u="",d="",p=!1;for(let e=0;e<h;++e)u+=a[e][0].slice(l)+"\n";for(let e=h;e<o;++e){let[t,s]=a[e];c+=t.length+s.length+1;const o="\r"===s[s.length-1];if(o&&(s=s.slice(0,-1)),s&&t.length<l){const e="Block scalar lines must not be less indented than their "+(n.indent?"explicit indentation indicator":"first line");i(c-s.length-(o?2:1),"BAD_INDENT",e),t=""}r===Jo.BLOCK_LITERAL?(u+=d+t.slice(l)+s,d="\n"):t.length>l||"\t"===s[0]?(" "===d?d="\n":p||"\n"!==d||(d="\n\n"),u+=d+t.slice(l)+s,d="\n",p=!0):""===s?"\n"===d?u+="\n":d="\n":(u+=d+s,d=" ",p=!1)}switch(n.chomp){case"-":break;case"+":for(let e=o;e<a.length;++e)u+="\n"+a[e][0].slice(l);"\n"!==u[u.length-1]&&(u+="\n");break;default:u+="\n"}const m=s+n.length+e.source.length;return{value:u,type:r,comment:n.comment,range:[s,m,m]}}function Wc(e,t,i){const{offset:s,type:n,source:r,end:a}=e;let o,l;const c=(e,t,n)=>i(s+e,t,n);switch(n){case"scalar":o=Jo.PLAIN,l=function(e,t){let i="";switch(e[0]){case"\t":i="a tab character";break;case",":i="flow indicator character ,";break;case"%":i="directive indicator character %";break;case"|":case">":i=`block scalar indicator ${e[0]}`;break;case"@":case"`":i=`reserved character ${e[0]}`}return i&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${i}`),Kc(e)}(r,c);break;case"single-quoted-scalar":o=Jo.QUOTE_SINGLE,l=function(e,t){return"'"===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR","Missing closing 'quote"),Kc(e.slice(1,-1)).replace(/''/g,"'")}(r,c);break;case"double-quoted-scalar":o=Jo.QUOTE_DOUBLE,l=function(e,t){let i="";for(let s=1;s<e.length-1;++s){const n=e[s];if("\r"!==n||"\n"!==e[s+1])if("\n"===n){const{fold:t,offset:n}=Xc(e,s);i+=t,s=n}else if("\\"===n){let n=e[++s];const r=Yc[n];if(r)i+=r;else if("\n"===n)for(n=e[s+1];" "===n||"\t"===n;)n=e[1+ ++s];else if("\r"===n&&"\n"===e[s+1])for(n=e[1+ ++s];" "===n||"\t"===n;)n=e[1+ ++s];else if("x"===n||"u"===n||"U"===n){const r={x:2,u:4,U:8}[n];i+=Jc(e,s+1,r,t),s+=r}else{const n=e.substr(s-1,2);t(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${n}`),i+=n}}else if(" "===n||"\t"===n){const t=s;let r=e[s+1];for(;" "===r||"\t"===r;)r=e[1+ ++s];"\n"===r||"\r"===r&&"\n"===e[s+2]||(i+=s>t?e.slice(t,s+1):n)}else i+=n}return'"'===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR",'Missing closing "quote'),i}(r,c);break;default:return i(e,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[s,s+r.length,s+r.length]}}const h=s+r.length,u=$c(a,h,t,i);return{value:l,type:o,comment:u.comment,range:[s,h,u.offset]}}function Kc(e){let t,i;try{t=new RegExp("(.*?)(?<![ \t])[ \t]*\r?\n","sy"),i=new RegExp("[ \t]*(.*?)(?:(?<![ \t])[ \t]*)?\r?\n","sy")}catch(e){t=/(.*?)[ \t]*\r?\n/sy,i=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=t.exec(e);if(!s)return e;let n=s[1],r=" ",a=t.lastIndex;for(i.lastIndex=a;s=i.exec(e);)""===s[1]?"\n"===r?n+=r:r="\n":(n+=r+s[1],r=" "),a=i.lastIndex;const o=/[ \t]*(.*)/sy;return o.lastIndex=a,s=o.exec(e),n+r+(s?.[1]??"")}function Xc(e,t){let i="",s=e[t+1];for(;!(" "!==s&&"\t"!==s&&"\n"!==s&&"\r"!==s||"\r"===s&&"\n"!==e[t+2]);)"\n"===s&&(i+="\n"),s=e[(t+=1)+1];return i||(i=" "),{fold:i,offset:t}}const Yc={0:"\0",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",N:"",_:" ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","\t":"\t"};function Jc(e,t,i,s){const n=e.substr(t,i),r=n.length===i&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(r)){const n=e.substr(t-2,i+2);return s(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${n}`),n}return String.fromCodePoint(r)}function Gc(e,t,i,s){const{value:n,type:r,comment:a,range:o}="block-scalar"===t.type?zc(t,e.options.strict,s):Wc(t,e.options.strict,s),l=i?e.directives.tagName(i.source,(e=>s(i,"TAG_RESOLVE_FAILED",e))):null,c=i&&l?function(e,t,i,s,n){if("!"===i)return e[yo];const r=[];for(const t of e.tags)if(!t.collection&&t.tag===i){if(!t.default||!t.test)return t;r.push(t)}for(const e of r)if(e.test?.test(t))return e;const a=e.knownTags[i];return a&&!a.collection?(e.tags.push(Object.assign({},a,{default:!1,test:void 0})),a):(n(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${i}`,"tag:yaml.org,2002:str"!==i),e[yo])}(e.schema,n,l,i,s):"scalar"===t.type?function({directives:e,schema:t},i,s,n){const r=t.tags.find((e=>e.default&&e.test?.test(i)))||t[yo];if(t.compat){const a=t.compat.find((e=>e.default&&e.test?.test(i)))??t[yo];r.tag!==a.tag&&n(s,"TAG_RESOLVE_FAILED",`Value may be parsed as either ${e.tagString(r.tag)} or ${e.tagString(a.tag)}`,!0)}return r}(e,n,t,s):e.schema[yo];let h;try{const r=c.resolve(n,(e=>s(i??t,"TAG_RESOLVE_FAILED",e)),e.options);h=ko(r)?r:new Jo(r)}catch(e){const r=e instanceof Error?e.message:String(e);s(i??t,"TAG_RESOLVE_FAILED",r),h=new Jo(n)}return h.range=o,h.source=n,r&&(h.type=r),l&&(h.tag=l),c.format&&(h.format=c.format),a&&(h.comment=a),h}function Qc(e,t,i){if(t){null===i&&(i=t.length);for(let s=i-1;s>=0;--s){let i=t[s];switch(i.type){case"space":case"comment":case"newline":e-=i.source.length;continue}for(i=t[++s];"space"===i?.type;)e+=i.source.length,i=t[++s];break}}return e}const Zc={composeNode:eh,composeEmptyNode:th};function eh(e,t,i,s){const{spaceBefore:n,comment:r,anchor:a,tag:o}=i;let l,c=!0;switch(t.type){case"alias":l=function({options:e},{offset:t,source:i,end:s},n){const r=new Wo(i.substring(1));""===r.source&&n(t,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&n(t+i.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const a=t+i.length,o=$c(s,a,e.strict,n);return r.range=[t,a,o.offset],o.comment&&(r.comment=o.comment),r}(e,t,s),(a||o)&&s(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":l=Gc(e,t,o,s),a&&(l.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":l=function(e,t,i,s,n){let r;switch(i.type){case"block-map":r=function({composeNode:e,composeEmptyNode:t},i,s,n){const r=new Sl(i.schema);i.atRoot&&(i.atRoot=!1);let a=s.offset;for(const o of s.items){const{start:l,key:c,sep:h,value:u}=o,d=Bc(l,{indicator:"explicit-key-ind",next:c??h?.[0],offset:a,onError:n,startOnNewline:!0}),p=!d.found;if(p){if(c&&("block-seq"===c.type?n(a,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in c&&c.indent!==s.indent&&n(a,"BAD_INDENT",Rc)),!d.anchor&&!d.tag&&!h){d.comment&&(r.comment?r.comment+="\n"+d.comment:r.comment=d.comment);continue}(d.hasNewlineAfterProp||Pc(c))&&n(c??l[l.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else d.found?.indent!==s.indent&&n(a,"BAD_INDENT",Rc);const m=d.end,f=c?e(i,c,d,n):t(i,m,l,null,d,n);i.schema.compat&&Hc(s.indent,c,n),Vc(i,r.items,f)&&n(m,"DUPLICATE_KEY","Map keys must be unique");const g=Bc(h??[],{indicator:"map-value-ind",next:u,offset:f.range[2],onError:n,startOnNewline:!c||"block-scalar"===c.type});if(a=g.end,g.found){p&&("block-map"!==u?.type||g.hasNewline||n(a,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),i.options.strict&&d.start<g.found.offset-1024&&n(f.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const l=u?e(i,u,g,n):t(i,a,h,null,g,n);i.schema.compat&&Hc(s.indent,u,n),a=l.range[2];const c=new Al(f,l);i.options.keepSourceTokens&&(c.srcToken=o),r.items.push(c)}else{p&&n(f.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),g.comment&&(f.comment?f.comment+="\n"+g.comment:f.comment=g.comment);const e=new Al(f);i.options.keepSourceTokens&&(e.srcToken=o),r.items.push(e)}}return r.range=[s.offset,a,a],r}(e,t,i,n);break;case"block-seq":r=function({composeNode:e,composeEmptyNode:t},i,s,n){const r=new Tl(i.schema);i.atRoot&&(i.atRoot=!1);let a=s.offset;for(const{start:o,value:l}of s.items){const c=Bc(o,{indicator:"seq-item-ind",next:l,offset:a,onError:n,startOnNewline:!0});if(a=c.end,!c.found){if(!(c.anchor||c.tag||l)){c.comment&&(r.comment=c.comment);continue}l&&"block-seq"===l.type?n(a,"BAD_INDENT","All sequence items must start at the same column"):n(a,"MISSING_CHAR","Sequence item without - indicator")}const h=l?e(i,l,c,n):t(i,a,o,null,c,n);i.schema.compat&&Hc(s.indent,l,n),a=h.range[2],r.items.push(h)}return r.range=[s.offset,a,a],r}(e,t,i,n);break;case"flow-collection":r=function({composeNode:e,composeEmptyNode:t},i,s,n){const r="{"===s.start.source,a=r?"flow map":"flow sequence",o=r?new Sl(i.schema):new Tl(i.schema);o.flow=!0;const l=i.atRoot;l&&(i.atRoot=!1);let c=s.offset+s.start.source.length;for(let l=0;l<s.items.length;++l){const h=s.items[l],{start:u,key:d,sep:p,value:m}=h,f=Bc(u,{flow:a,indicator:"explicit-key-ind",next:d??p?.[0],offset:c,onError:n,startOnNewline:!1});if(!f.found){if(!(f.anchor||f.tag||p||m)){0===l&&f.comma?n(f.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):l<s.items.length-1&&n(f.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),f.comment&&(o.comment?o.comment+="\n"+f.comment:o.comment=f.comment),c=f.end;continue}!r&&i.options.strict&&Pc(d)&&n(d,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(0===l)f.comma&&n(f.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(f.comma||n(f.start,"MISSING_CHAR",`Missing , between ${a} items`),f.comment){let e="";e:for(const t of u)switch(t.type){case"comma":case"space":break;case"comment":e=t.source.substring(1);break e;default:break e}if(e){let t=o.items[o.items.length-1];No(t)&&(t=t.value??t.key),t.comment?t.comment+="\n"+e:t.comment=e,f.comment=f.comment.substring(e.length+1)}}if(r||p||f.found){const s=f.end,l=d?e(i,d,f,n):t(i,s,u,null,f,n);qc(d)&&n(l.range,"BLOCK_IN_FLOW",Fc);const g=Bc(p??[],{flow:a,indicator:"map-value-ind",next:m,offset:l.range[2],onError:n,startOnNewline:!1});if(g.found){if(!r&&!f.found&&i.options.strict){if(p)for(const e of p){if(e===g.found)break;if("newline"===e.type){n(e,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}f.start<g.found.offset-1024&&n(g.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else m&&("source"in m&&m.source&&":"===m.source[0]?n(m,"MISSING_CHAR",`Missing space after : in ${a}`):n(g.start,"MISSING_CHAR",`Missing , or : between ${a} items`));const b=m?e(i,m,g,n):g.found?t(i,g.end,p,null,g,n):null;b?qc(m)&&n(b.range,"BLOCK_IN_FLOW",Fc):g.comment&&(l.comment?l.comment+="\n"+g.comment:l.comment=g.comment);const v=new Al(l,b);if(i.options.keepSourceTokens&&(v.srcToken=h),r){const e=o;Vc(i,e.items,l)&&n(s,"DUPLICATE_KEY","Map keys must be unique"),e.items.push(v)}else{const e=new Sl(i.schema);e.flow=!0,e.items.push(v),o.items.push(e)}c=b?b.range[2]:g.end}else{const s=m?e(i,m,f,n):t(i,f.end,p,null,f,n);o.items.push(s),c=s.range[2],qc(m)&&n(s.range,"BLOCK_IN_FLOW",Fc)}}const h=r?"}":"]",[u,...d]=s.end;let p=c;if(u&&u.source===h)p=u.offset+u.source.length;else{const e=a[0].toUpperCase()+a.substring(1);n(c,l?"MISSING_CHAR":"BAD_INDENT",l?`${e} must end with a ${h}`:`${e} in block collection must be sufficiently indented and end with a ${h}`),u&&1!==u.source.length&&d.unshift(u)}if(d.length>0){const e=$c(d,p,i.options.strict,n);e.comment&&(o.comment?o.comment+="\n"+e.comment:o.comment=e.comment),o.range=[s.offset,p,e.offset]}else o.range=[s.offset,p,p];return o}(e,t,i,n)}if(!s)return r;const a=t.directives.tagName(s.source,(e=>n(s,"TAG_RESOLVE_FAILED",e)));if(!a)return r;const o=r.constructor;if("!"===a||a===o.tagName)return r.tag=o.tagName,r;const l=Oo(r)?"map":"seq";let c=t.schema.tags.find((e=>e.collection===l&&e.tag===a));if(!c){const e=t.schema.knownTags[a];if(!e||e.collection!==l)return n(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${a}`,!0),r.tag=a,r;t.schema.tags.push(Object.assign({},e,{default:!1})),c=e}const h=c.resolve(r,(e=>n(s,"TAG_RESOLVE_FAILED",e)),t.options),u=So(h)?h:new Jo(h);return u.range=r.range,u.tag=a,c?.format&&(u.format=c.format),u}(Zc,e,t,o,s),a&&(l.anchor=a.source.substring(1));break;default:s(t,"UNEXPECTED_TOKEN","error"===t.type?t.message:`Unsupported token (type: ${t.type})`),l=th(e,t.offset,void 0,null,i,s),c=!1}return a&&""===l.anchor&&s(a,"BAD_ALIAS","Anchor cannot be an empty string"),n&&(l.spaceBefore=!0),r&&("scalar"===t.type&&""===t.source?l.comment=r:l.commentBefore=r),e.options.keepSourceTokens&&c&&(l.srcToken=t),l}function th(e,t,i,s,{spaceBefore:n,comment:r,anchor:a,tag:o},l){const c=Gc(e,{type:"scalar",offset:Qc(t,i,s),indent:-1,source:""},o,l);return a&&(c.anchor=a.source.substring(1),""===c.anchor&&l(a,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(c.spaceBefore=!0),r&&(c.comment=r),c}function ih(e){if("number"==typeof e)return[e,e+1];if(Array.isArray(e))return 2===e.length?e:[e[0],e[1]];const{offset:t,source:i}=e;return[t,t+("string"==typeof i?i.length:1)]}function sh(e){let t="",i=!1,s=!1;for(let n=0;n<e.length;++n){const r=e[n];switch(r[0]){case"#":t+=(""===t?"":s?"\n\n":"\n")+(r.substring(1)||" "),i=!0,s=!1;break;case"%":"#"!==e[n+1]?.[0]&&(n+=1),i=!1;break;default:i||(s=!0),i=!1}}return{comment:t,afterEmptyLine:s}}class nh{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,t,i,s)=>{const n=ih(e);s?this.warnings.push(new Dc(n,t,i)):this.errors.push(new Uc(n,t,i))},this.directives=new $o({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:i,afterEmptyLine:s}=sh(this.prelude);if(i){const n=e.contents;if(t)e.comment=e.comment?`${e.comment}\n${i}`:i;else if(s||e.directives.docStart||!n)e.commentBefore=i;else if(Lo(n)&&!n.flow&&n.items.length>0){let e=n.items[0];No(e)&&(e=e.key);const t=e.commentBefore;e.commentBefore=t?`${i}\n${t}`:i}else{const e=n.commentBefore;n.commentBefore=e?`${i}\n${e}`:i}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:sh(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,i=-1){for(const t of e)yield*this.next(t);yield*this.end(t,i)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,((t,i,s)=>{const n=ih(e);n[0]+=t,this.onError(n,"BAD_DIRECTIVE",i,s)})),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=function(e,t,{offset:i,start:s,value:n,end:r},a){const o=Object.assign({_directives:t},e),l=new Tc(void 0,o),c={atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},h=Bc(s,{indicator:"doc-start",next:n??r?.[0],offset:i,onError:a,startOnNewline:!0});h.found&&(l.directives.docStart=!0,!n||"block-map"!==n.type&&"block-seq"!==n.type||h.hasNewline||a(h.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=n?eh(c,n,h,a):th(c,h.end,s,null,h,a);const u=l.contents.range[2],d=$c(r,u,!1,a);return d.comment&&(l.comment=d.comment),l.range=[i,u,d.offset],l}(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,i=new Uc(ih(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const t="Unexpected doc-end without preceding document";this.errors.push(new Uc(ih(e),"UNEXPECTED_TOKEN",t));break}this.doc.directives.docEnd=!0;const t=$c(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const e=this.doc.comment;this.doc.comment=e?`${e}\n${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new Uc(ih(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const e=Object.assign({_directives:this.directives},this.options),i=new Tc(void 0,e);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,t,t],this.decorate(i,!1),yield i}}}function rh(e,t=!0,i){if(e){const s=(e,t,s)=>{const n="number"==typeof e?e:Array.isArray(e)?e[0]:e.offset;if(!i)throw new Uc([n,n+1],t,s);i(n,t,s)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return Wc(e,t,s);case"block-scalar":return zc(e,t,s)}}return null}function ah(e,t){const{implicitKey:i=!1,indent:s,inFlow:n=!1,offset:r=-1,type:a="PLAIN"}=t,o=fl({type:a,value:e},{implicitKey:i,indent:s>0?" ".repeat(s):"",inFlow:n,options:{blockQuote:!0,lineWidth:-1}}),l=t.end??[{type:"newline",offset:-1,indent:s,source:"\n"}];switch(o[0]){case"|":case">":{const e=o.indexOf("\n"),t=o.substring(0,e),i=o.substring(e+1)+"\n",n=[{type:"block-scalar-header",offset:r,indent:s,source:t}];return lh(n,l)||n.push({type:"newline",offset:-1,indent:s,source:"\n"}),{type:"block-scalar",offset:r,indent:s,props:n,source:i}}case'"':return{type:"double-quoted-scalar",offset:r,indent:s,source:o,end:l};case"'":return{type:"single-quoted-scalar",offset:r,indent:s,source:o,end:l};default:return{type:"scalar",offset:r,indent:s,source:o,end:l}}}function oh(e,t,i={}){let{afterKey:s=!1,implicitKey:n=!1,inFlow:r=!1,type:a}=i,o="indent"in e?e.indent:null;if(s&&"number"==typeof o&&(o+=2),!a)switch(e.type){case"single-quoted-scalar":a="QUOTE_SINGLE";break;case"double-quoted-scalar":a="QUOTE_DOUBLE";break;case"block-scalar":{const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");a=">"===t.source[0]?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:a="PLAIN"}const l=fl({type:a,value:t},{implicitKey:n||null===o,indent:null!==o&&o>0?" ".repeat(o):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(l[0]){case"|":case">":!function(e,t){const i=t.indexOf("\n"),s=t.substring(0,i),n=t.substring(i+1)+"\n";if("block-scalar"===e.type){const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");t.source=s,e.source=n}else{const{offset:t}=e,i="indent"in e?e.indent:-1,r=[{type:"block-scalar-header",offset:t,indent:i,source:s}];lh(r,"end"in e?e.end:void 0)||r.push({type:"newline",offset:-1,indent:i,source:"\n"});for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:"block-scalar",indent:i,props:r,source:n})}}(e,l);break;case'"':ch(e,l,"double-quoted-scalar");break;case"'":ch(e,l,"single-quoted-scalar");break;default:ch(e,l,"scalar")}}function lh(e,t){if(t)for(const i of t)switch(i.type){case"space":case"comment":e.push(i);break;case"newline":return e.push(i),!0}return!1}function ch(e,t,i){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=i,e.source=t;break;case"block-scalar":{const s=e.props.slice(1);let n=t.length;"block-scalar-header"===e.props[0].type&&(n-=e.props[0].source.length);for(const e of s)e.offset+=n;delete e.props,Object.assign(e,{type:i,source:t,end:s});break}case"block-map":case"block-seq":{const s={type:"newline",offset:e.offset+t.length,indent:e.indent,source:"\n"};delete e.items,Object.assign(e,{type:i,source:t,end:[s]});break}default:{const s="indent"in e?e.indent:-1,n="end"in e&&Array.isArray(e.end)?e.end.filter((e=>"space"===e.type||"comment"===e.type||"newline"===e.type)):[];for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:i,indent:s,source:t,end:n})}}}const hh=e=>"type"in e?uh(e):dh(e);function uh(e){switch(e.type){case"block-scalar":{let t="";for(const i of e.props)t+=uh(i);return t+e.source}case"block-map":case"block-seq":{let t="";for(const i of e.items)t+=dh(i);return t}case"flow-collection":{let t=e.start.source;for(const i of e.items)t+=dh(i);for(const i of e.end)t+=i.source;return t}case"document":{let t=dh(e);if(e.end)for(const i of e.end)t+=i.source;return t}default:{let t=e.source;if("end"in e&&e.end)for(const i of e.end)t+=i.source;return t}}}function dh({start:e,key:t,sep:i,value:s}){let n="";for(const t of e)n+=t.source;if(t&&(n+=uh(t)),i)for(const e of i)n+=e.source;return s&&(n+=uh(s)),n}const ph=Symbol("break visit"),mh=Symbol("skip children"),fh=Symbol("remove item");function gh(e,t){"type"in e&&"document"===e.type&&(e={start:e.start,value:e.value}),bh(Object.freeze([]),e,t)}function bh(e,t,i){let s=i(t,e);if("symbol"==typeof s)return s;for(const n of["key","value"]){const r=t[n];if(r&&"items"in r){for(let t=0;t<r.items.length;++t){const s=bh(Object.freeze(e.concat([[n,t]])),r.items[t],i);if("number"==typeof s)t=s-1;else{if(s===ph)return ph;s===fh&&(r.items.splice(t,1),t-=1)}}"function"==typeof s&&"key"===n&&(s=s(t,e))}}return"function"==typeof s?s(t,e):s}gh.BREAK=ph,gh.SKIP=mh,gh.REMOVE=fh,gh.itemAtPath=(e,t)=>{let i=e;for(const[e,s]of t){const t=i?.[e];if(!t||!("items"in t))return;i=t.items[s]}return i},gh.parentCollection=(e,t)=>{const i=gh.itemAtPath(e,t.slice(0,-1))?.[t[t.length-1][0]];if(i&&"items"in i)return i;throw new Error("Parent collection not found")};const vh="\ufeff",yh="",wh="",xh="",Eh=e=>!!e&&"items"in e,Ah=e=>!!e&&("scalar"===e.type||"single-quoted-scalar"===e.type||"double-quoted-scalar"===e.type||"block-scalar"===e.type);function Oh(e){switch(e){case vh:return"<BOM>";case yh:return"<DOC>";case wh:return"<FLOW_END>";case xh:return"<SCALAR>";default:return JSON.stringify(e)}}function Nh(e){switch(e){case vh:return"byte-order-mark";case yh:return"doc-mode";case wh:return"flow-error-end";case xh:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case"\n":case"\r\n":return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"\t":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}function kh(e){switch(e){case void 0:case" ":case"\n":case"\r":case"\t":return!0;default:return!1}}const jh="0123456789ABCDEFabcdef".split(""),Lh="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()".split(""),Sh=",[]{}".split(""),Ch=" ,[]{}\n\r\t".split(""),Th=e=>!e||Ch.includes(e);class Ih{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){e&&(this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null),this.atEnd=!t;let i=this.next??"stream";for(;i&&(t||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;" "===t||"\t"===t;)t=this.buffer[++e];return!t||"#"===t||"\n"===t||"\r"===t&&"\n"===this.buffer[e+1]}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let i=0;for(;" "===t;)t=this.buffer[++i+e];if("\r"===t){const t=this.buffer[i+e+1];if("\n"===t||!t&&!this.atEnd)return e+i+1}return"\n"===t||i>=this.indentNext||!t&&!this.atEnd?e+i:-1}if("-"===t||"."===t){const t=this.buffer.substr(e,3);if(("---"===t||"..."===t)&&kh(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return("number"!=typeof e||-1!==e&&e<this.pos)&&(e=this.buffer.indexOf("\n",this.pos),this.lineEndPos=e),-1===e?this.atEnd?this.buffer.substring(this.pos):null:("\r"===this.buffer[e-1]&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(null===e)return this.setNext("stream");if(e[0]===vh&&(yield*this.pushCount(1),e=e.substring(1)),"%"===e[0]){let t=e.length;const i=e.indexOf("#");if(-1!==i){const s=e[i-1];" "!==s&&"\t"!==s||(t=i-1)}for(;;){const i=e[t-1];if(" "!==i&&"\t"!==i)break;t-=1}const s=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-s),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield yh,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if("-"===e||"."===e){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const e=this.peek(3);if("---"===e&&kh(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"doc";if("..."===e&&kh(this.charAt(3)))return yield*this.pushCount(3),"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!kh(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if(("-"===e||"?"===e||":"===e)&&kh(t)){const e=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=e,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(null===e)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Th),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=(yield*this.parseBlockScalarHeader()),t+=(yield*this.pushSpaces(!0)),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,i=-1;do{e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=i=t):t=0,t+=(yield*this.pushSpaces(!0))}while(e+t>0);const s=this.getLine();if(null===s)return this.setNext("flow");if((-1!==i&&i<this.indentNext&&"#"!==s[0]||0===i&&(s.startsWith("---")||s.startsWith("..."))&&kh(s[3]))&&(i!==this.indentNext-1||1!==this.flowLevel||"]"!==s[0]&&"}"!==s[0]))return this.flowLevel=0,yield wh,yield*this.parseLineStart();let n=0;for(;","===s[n];)n+=(yield*this.pushCount(1)),n+=(yield*this.pushSpaces(!0)),this.flowKey=!1;switch(n+=(yield*this.pushIndicators()),s[n]){case void 0:return"flow";case"#":return yield*this.pushCount(s.length-n),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Th),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const e=this.charAt(1);if(this.flowKey||kh(e)||","===e)return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if("'"===e)for(;-1!==t&&"'"===this.buffer[t+1];)t=this.buffer.indexOf("'",t+2);else for(;-1!==t;){let e=0;for(;"\\"===this.buffer[t-1-e];)e+=1;if(e%2==0)break;t=this.buffer.indexOf('"',t+1)}const i=this.buffer.substring(0,t);let s=i.indexOf("\n",this.pos);if(-1!==s){for(;-1!==s;){const e=this.continueScalar(s+1);if(-1===e)break;s=i.indexOf("\n",e)}-1!==s&&(t=s-("\r"===i[s-1]?2:1))}if(-1===t){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if("+"===t)this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if("-"!==t)break}return yield*this.pushUntil((e=>kh(e)||"#"===e))}*parseBlockScalar(){let e,t=this.pos-1,i=0;e:for(let s=this.pos;e=this.buffer[s];++s)switch(e){case" ":i+=1;break;case"\n":t=s,i=0;break;case"\r":{const e=this.buffer[s+1];if(!e&&!this.atEnd)return this.setNext("block-scalar");if("\n"===e)break}default:break e}if(!e&&!this.atEnd)return this.setNext("block-scalar");if(i>=this.indentNext){-1===this.blockScalarIndent?this.indentNext=i:this.indentNext+=this.blockScalarIndent;do{const e=this.continueScalar(t+1);if(-1===e)break;t=this.buffer.indexOf("\n",e)}while(-1!==t);if(-1===t){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}if(!this.blockScalarKeep)for(;;){let e=t-1,s=this.buffer[e];"\r"===s&&(s=this.buffer[--e]);const n=e;for(;" "===s||"\t"===s;)s=this.buffer[--e];if(!("\n"===s&&e>=this.pos&&e+1+i>n))break;t=e}return yield xh,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t,i=this.pos-1,s=this.pos-1;for(;t=this.buffer[++s];)if(":"===t){const t=this.buffer[s+1];if(kh(t)||e&&","===t)break;i=s}else if(kh(t)){let n=this.buffer[s+1];if("\r"===t&&("\n"===n?(s+=1,t="\n",n=this.buffer[s+1]):i=s),"#"===n||e&&Sh.includes(n))break;if("\n"===t){const e=this.continueScalar(s+1);if(-1===e)break;s=Math.max(s,e-2)}}else{if(e&&Sh.includes(t))break;i=s}return t||this.atEnd?(yield xh,yield*this.pushToIndex(i+1,!0),e?"flow":"doc"):this.setNext("plain-scalar")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const i=this.buffer.slice(this.pos,e);return i?(yield i,this.pos+=i.length,i.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Th))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(kh(t)||e&&Sh.includes(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if("<"===this.charAt(1)){let e=this.pos+2,t=this.buffer[e];for(;!kh(t)&&">"!==t;)t=this.buffer[++e];return yield*this.pushToIndex(">"===t?e+1:e,!1)}{let e=this.pos+1,t=this.buffer[e];for(;t;)if(Lh.includes(t))t=this.buffer[++e];else{if("%"!==t||!jh.includes(this.buffer[e+1])||!jh.includes(this.buffer[e+2]))break;t=this.buffer[e+=3]}return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return"\n"===e?yield*this.pushCount(1):"\r"===e&&"\n"===this.charAt(1)?yield*this.pushCount(2):0}*pushSpaces(e){let t,i=this.pos-1;do{t=this.buffer[++i]}while(" "===t||e&&"\t"===t);const s=i-this.pos;return s>0&&(yield this.buffer.substr(this.pos,s),this.pos=i),s}*pushUntil(e){let t=this.pos,i=this.buffer[t];for(;!e(i);)i=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class Mh{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,i=this.lineStarts.length;for(;t<i;){const s=t+i>>1;this.lineStarts[s]<e?t=s+1:i=s}return this.lineStarts[t]===e?{line:t+1,col:1}:0===t?{line:0,col:e}:{line:t,col:e-this.lineStarts[t-1]+1}}}}function Uh(e,t){for(let i=0;i<e.length;++i)if(e[i].type===t)return!0;return!1}function Dh(e){for(let t=0;t<e.length;++t)switch(e[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function _h(e){switch(e?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Bh(e){switch(e.type){case"document":return e.start;case"block-map":{const t=e.items[e.items.length-1];return t.sep??t.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function Ph(e){if(0===e.length)return[];let t=e.length;e:for(;--t>=0;)switch(e[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;"space"===e[++t]?.type;);return e.splice(t,e.length)}function Hh(e){if("flow-seq-start"===e.start.type)for(const t of e.items)!t.sep||t.value||Uh(t.start,"explicit-key-ind")||Uh(t.sep,"map-value-ind")||(t.key&&(t.value=t.key),delete t.key,_h(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}class Vh{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Ih,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&0===this.offset&&this.onNewLine(0);for(const i of this.lexer.lex(e,t))yield*this.next(i);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar)return this.atScalar=!1,yield*this.step(),void(this.offset+=e.length);const t=Nh(e);if(t)if("scalar"===t)this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&" "===e[0]&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const t=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:t,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if("doc-end"!==this.type||e&&"doc-end"===e.type){if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}else{for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source})}}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(t)if(0===this.stack.length)yield t;else{const e=this.peek(1);switch("block-scalar"===t.type?t.indent="indent"in e?e.indent:0:"flow-collection"===t.type&&"document"===e.type&&(t.indent=0),"flow-collection"===t.type&&Hh(t),e.type){case"document":e.value=t;break;case"block-scalar":e.props.push(t);break;case"block-map":{const i=e.items[e.items.length-1];if(i.value)return e.items.push({start:[],key:t,sep:[]}),void(this.onKeyLine=!0);if(!i.sep)return Object.assign(i,{key:t,sep:[]}),void(this.onKeyLine=!Uh(i.start,"explicit-key-ind"));i.value=t;break}case"block-seq":{const i=e.items[e.items.length-1];i.value?e.items.push({start:[],value:t}):i.value=t;break}case"flow-collection":{const i=e.items[e.items.length-1];return void(!i||i.value?e.items.push({start:[],key:t,sep:[]}):i.sep?i.value=t:Object.assign(i,{key:t,sep:[]}))}default:yield*this.pop(),yield*this.pop(t)}if(!("document"!==e.type&&"block-map"!==e.type&&"block-seq"!==e.type||"block-map"!==t.type&&"block-seq"!==t.type)){const i=t.items[t.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&-1===Dh(i.start)&&(0===t.indent||i.start.every((e=>"comment"!==e.type||e.indent<t.indent)))&&("document"===e.type?e.end=i.start:e.items.push({start:i.start}),t.items.splice(-1,1))}}else{const e="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:e}}}*stream(){switch(this.type){case"directive-line":return void(yield{type:"directive",offset:this.offset,source:this.source});case"byte-order-mark":case"space":case"comment":case"newline":return void(yield this.sourceToken);case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};return"doc-start"===this.type&&e.start.push(this.sourceToken),void this.stack.push(e)}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":return void(-1!==Dh(e.start)?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken));case"anchor":case"tag":case"space":case"comment":case"newline":return void e.start.push(this.sourceToken)}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if("map-value-ind"===this.type){const t=Ph(Bh(this.peek(2)));let i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];const s={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:t,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=s}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":return void e.props.push(this.sourceToken);case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const i="end"in t.value?t.value.end:void 0;"comment"===(Array.isArray(i)?i[i.length-1]:void 0)?.type?i?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i))return Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const i=!this.onKeyLine&&this.indent===e.indent&&t.sep;let s=[];if(i&&t.sep&&!t.value){const i=[];for(let s=0;s<t.sep.length;++s){const n=t.sep[s];switch(n.type){case"newline":i.push(s);break;case"space":break;case"comment":n.indent>e.indent&&(i.length=0);break;default:i.length=0}}i.length>=2&&(s=t.sep.splice(i[1]))}switch(this.type){case"anchor":case"tag":return void(i||t.value?(s.push(this.sourceToken),e.items.push({start:s}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"explicit-key-ind":return t.sep||Uh(t.start,"explicit-key-ind")?i||t.value?(s.push(this.sourceToken),e.items.push({start:s})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]}):t.start.push(this.sourceToken),void(this.onKeyLine=!0);case"map-value-ind":if(Uh(t.start,"explicit-key-ind"))if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Uh(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]});else if(_h(t.key)&&!Uh(t.sep,"newline")){const e=Ph(t.start),i=t.key,s=t.sep;s.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:i,sep:s}]})}else s.length>0?t.sep=t.sep.concat(s,this.sourceToken):t.sep.push(this.sourceToken);else if(Uh(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const e=Ph(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||i?e.items.push({start:s,key:null,sep:[this.sourceToken]}):Uh(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return void(this.onKeyLine=!0);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);return void(i||t.value?(e.items.push({start:s,key:n,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(n):(Object.assign(t,{key:n,sep:[]}),this.onKeyLine=!0))}default:{const n=this.startBlockValue(e);if(n)return i&&"block-seq"!==n.type&&Uh(t.start,"explicit-key-ind")&&e.items.push({start:s}),void this.stack.push(n)}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const i="end"in t.value?t.value.end:void 0;"comment"===(Array.isArray(i)?i[i.length-1]:void 0)?.type?i?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i))return Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;return void t.start.push(this.sourceToken);case"seq-item-ind":if(this.indent!==e.indent)break;return void(t.value||Uh(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken))}if(this.indent>e.indent){const t=this.startBlockValue(e);if(t)return void this.stack.push(t)}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if("flow-error-end"===this.type){let e;do{yield*this.pop(),e=this.peek(1)}while(e&&"flow-collection"===e.type)}else if(0===e.end.length){switch(this.type){case"comma":case"explicit-key-ind":return void(!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken));case"map-value-ind":return void(!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]}));case"space":case"comment":case"newline":case"anchor":case"tag":return void(!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const i=this.flowScalar(this.type);return void(!t||t.value?e.items.push({start:[],key:i,sep:[]}):t.sep?this.stack.push(i):Object.assign(t,{key:i,sep:[]}))}case"flow-map-end":case"flow-seq-end":return void e.end.push(this.sourceToken)}const i=this.startBlockValue(e);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const t=this.peek(2);if("block-map"===t.type&&("map-value-ind"===this.type&&t.indent===e.indent||"newline"===this.type&&!t.items[t.items.length-1].sep))yield*this.pop(),yield*this.step();else if("map-value-ind"===this.type&&"flow-collection"!==t.type){const i=Ph(Bh(t));Hh(e);const s=e.end.splice(1,e.end.length);s.push(this.sourceToken);const n={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:i,key:e,sep:s}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=n}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=Ph(Bh(e));return t.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t}]}}case"map-value-ind":{this.onKeyLine=!0;const t=Ph(Bh(e));return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return"comment"===this.type&&!(this.indent<=t)&&e.every((e=>"newline"===e.type||"space"===e.type))}*documentEnd(e){"doc-mode"!==this.type&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop())}}}function Rh(e){const t=!1!==e.prettyErrors;return{lineCounter:e.lineCounter||t&&new Mh||null,prettyErrors:t}}function $h(e,t={}){const{lineCounter:i,prettyErrors:s}=Rh(t),n=new Vh(i?.addNewLine),r=new nh(t),a=Array.from(r.compose(n.parse(e)));if(s&&i)for(const t of a)t.errors.forEach(_c(e,i)),t.warnings.forEach(_c(e,i));return a.length>0?a:Object.assign([],{empty:!0},r.streamInfo())}function Fh(e,t={}){const{lineCounter:i,prettyErrors:s}=Rh(t),n=new Vh(i?.addNewLine),r=new nh(t);let a=null;for(const t of r.compose(n.parse(e),!0,e.length))if(a){if("silent"!==a.options.logLevel){a.errors.push(new Uc(t.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}}else a=t;return s&&i&&(a.errors.forEach(_c(e,i)),a.warnings.forEach(_c(e,i))),a}function qh(e,t,i){let s;"function"==typeof t?s=t:void 0===i&&t&&"object"==typeof t&&(i=t);const n=Fh(e,i);if(!n)return null;if(n.warnings.forEach((e=>vl(n.options.logLevel,e))),n.errors.length>0){if("silent"!==n.options.logLevel)throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:s},i))}function zh(e,t,i){let s=null;if("function"==typeof t||Array.isArray(t)?s=t:void 0===i&&t&&(i=t),"string"==typeof i&&(i=i.length),"number"==typeof i){const e=Math.round(i);i=e<1?void 0:e>8?{indent:8}:{indent:e}}if(void 0===e){const{keepUndefined:e}=i??t??{};if(!e)return}return new Tc(e,s,i).toString(i)}const Wh=t,Kh=s(145),Xh={fetchOrganization(e,t){t.getAttribute("name").setValue(Kh.name),t.getAttribute("description").setValue(Kh.description),t.getAttribute("phone").setValue(Kh.phone),t.getAttribute("website").setValue(Kh.website),t.getAttribute("email").setValue(Kh.email);let i=t.getAttribute("socials").getTarget();for(const t in Kh.socials){const s=Kh.socials[t];let n=e.createConcept("social");n.getAttribute("name").setValue(t),n.getAttribute("handle").setValue(s),i.addElement(n)}},fetchProjects(e,t){fetch("https://raw.githubusercontent.com/geodes-sms/geodes-sms.github.io/main/_data/projects/funded.yml").then((e=>e.text())).then((i=>{const s=Wh.parse(i);let n=t.getAttribute("projects").getTarget();n.removeAllElement(),s.forEach((t=>{let i=e.createConcept("project");const{name:s,description:r,startYear:a,endYear:o,funding:l,logo:c,partners:h=[]}=t;i.getAttribute("name").setValue(s),i.getAttribute("description").setValue(r),i.getAttribute("start-date").setValue(a),i.getAttribute("end-date").setValue(o),i.getAttribute("funding").setValue(l),i.getAttribute("logo").setValue(c);let u=i.getAttribute("partners").getTarget();Array.isArray(h)&&h.forEach((t=>{let i=e.createConcept("partner");i.getAttribute("name").setValue(t),u.addElement(i)})),n.addElement(i)}))}))},fetchTools(e,t){fetch("https://raw.githubusercontent.com/geodes-sms/geodes-sms.github.io/main/_data/projects/tools.yml").then((e=>e.text())).then((i=>{const s=Wh.parse(i);let n=t.getAttribute("tools").getTarget();n.removeAllElement(),s.forEach((t=>{let i=e.createConcept("tool");const{name:s,description:r,startYear:a,url:o,logo:l,contributors:c=[]}=t;i.getAttribute("name").setValue(s),i.getAttribute("description").setValue(r),i.getAttribute("start-date").setValue(a),i.getAttribute("url").setValue(o),i.getAttribute("logo").setValue(l);let h=i.getAttribute("contributors").getTarget();c.forEach((t=>{let i=e.createConcept("partner");i.getAttribute("name").setValue(t),h.addElement(i)})),n.addElement(i)}))}))},fetchPeople(e,t){fetch("https://raw.githubusercontent.com/geodes-sms/geodes-sms.github.io/main/_data/people/people.yml").then((e=>e.text())).then((i=>{const s=Wh.parse(i);let n=t.getAttribute("members").getTarget();n.removeAllElement(),s.forEach((t=>{let i=e.createConcept("person");const[s,r]=t.name.split(",");i.getAttribute("first-name").setValue(r),i.getAttribute("last-name").setValue(s),i.getAttribute("occupation").setValue(t.position),i.getAttribute("website").setValue(t.website),i.getAttribute("email").setValue(t.email),i.getAttribute("phone").setValue(t.phone),i.getAttribute("photo").setValue(`https://geodes.iro.umontreal.ca/images/people/people/${t.image}`),n.addElement(i)}))}))}};let Yh=function(e){const t=_(".app-editor"),i=(e=>(0,n.isHTMLElement)(e)&&(0,n.hasOwn)(e.dataset,"gentleman"))(t)?[t]:(0,n.getElements)('[data-gentleman="editor"]',t),s=[];return i.forEach((e=>{s.push(function(e){let t=_(e);return(0,n.isHTMLElement)(e)||(t=(0,n.createDiv)({tabindex:-1})),t.classList.add("gentleman-editor"),t.dataset.gentleman=no,Object.create(so,{object:{value:"environment"},type:{value:no},name:{value:"gentleman editor"},container:{value:t}})}(e))})),s}(),Jh=Yh[0];Jh.init({config:{header:!1},conceptModel:[ro,oo,ho,lo],projectionModel:[co,ao,uo,po,mo]}),Jh.home.close(),Jh.exporter.close(),console.log(Yh.length);for(let e=1;e<Yh.length;e++){let t=Yh[e];t.init({config:{header:!1},conceptModel:[ro,oo,ho,lo],projectionModel:[co,ao,uo,po,mo]}),t.home.close(),t.exporter.close()}const Gh={general:"general",people:"people",projects:"project",tools:"tool"},Qh={general:"General information",people:"Members",projects:"Funded projects",tools:"Tools"},Zh={editorInstance:null,organization:null,container:null,menu:null,items:null,views:null,selectedItem:null,init(e,t){return this.container=e,this.items=new Map,this.views=new Map,this.editor=t,this.bindDOM(),this.bindEvents(),this.render(),this},get hasSelectedItem(){return(0,n.isHTMLElement)(this.selectedItem)},getItemName:e=>(0,n.isHTMLElement)(e)?e.dataset.cmsName:null,refresh(){this.container.dataset.item=this.hasSelectedItem?this.getItemName(this.selectedItem):""},render(){return this.instance||(this.organization=this.editor.createConcept("research-organization"),this.editorInstance=this.editor.createInstance(this.organization),this.editorInstance.changeSize("fullscreen"),this.selectItem("general"),this.refresh()),this},selectItem(e){if((0,n.isNullOrUndefined)(e))return!1;if(!this.items.has(e))return!1;let t=this.items.get(e);return t===this.selectedItem||(this.selectedItem&&this.selectedItem.classList.remove("selected"),this.selectedItem=t,this.selectedItem.classList.add("selected"),this.updateView()),this},updateView(){let e=this.getItemName(this.selectedItem);if((0,n.isNullOrUndefined)(e)||!(0,n.hasOwn)(Gh,e))return;switch(e){case"general":Xh.fetchOrganization(this.editor,this.organization);break;case"people":Xh.fetchPeople(this.editor,this.organization);break;case"tools":Xh.fetchTools(this.editor,this.organization);break;case"projects":Xh.fetchProjects(this.editor,this.organization)}let t=Gh[e],i=this.editorInstance.projection,s=i.findView(t);if(-1===s)return!1;i.changeView(s),this.editorInstance.setTitle(`GEODES – ${Qh[e]}`),this.refresh()},bindDOM(){this.menu=(0,n.getElement)('[data-cms="menu"]'),(0,n.getElements)('[data-cms="menu-item"]',this.menu).forEach((e=>{const{cmsName:t}=e.dataset;this.items.set(t,e)}))},bindEvents(){const e=e=>(0,n.isHTMLElement)(e)&&"menu-item"===e.dataset.cms;this.menu.addEventListener("click",(t=>{let i=(s=t.target,e(s)?s:(0,n.findAncestor)(s,e,3));var s;(0,n.isHTMLElement)(i)&&this.selectItem(this.getItemName(i))}))}};Zh.init((0,n.getElement)(".page-body"),Jh)})()})();