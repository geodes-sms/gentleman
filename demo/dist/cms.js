(()=>{"use strict";var e={145:e=>{e.exports=JSON.parse('{"name":"GEODES","description":"GEODES was founded as part of DIRO in 1992. It was then called GÉLO and changed to GEODES in 2005. Since then, more than 30 students have obtained a PhD degree from the group, and more then a 100 students have graduated with a Master\'s degree. Many of these students are professors in Quebec, Canada, and around the world (ÉTS, Laval, Polytechnique, UQAM, Ottawa, DePaul, Houston, Indiana, Michigan, United Arab Emirates, etc.), and others hold key positions at large tech companies. GEODES is very scientifically very active group with over 20 publications per year in journals, conference proceedings and book chapters.","website":"https://geodes.iro.umontreal.ca/","twitter":"UMontrealGEODES","email":"geodes@iro.umontreal.ca","phone":"","socials":{"twitter":"UMontrealGEODES"}}')},528:e=>{e.exports=JSON.parse('[{"name":"Sahraoui, Houari","image":"houari.png","position":"Full Professor","website":"http://www.iro.umontreal.ca/~sahraouh/","photo":"https://geodes.iro.umontreal.ca/images/people/faculty/houari.jpg","email":"sahraouh@iro.umontreal.ca"},{"name":"Syriani, Eugene","image":"eugene.jpg","position":"Associate Professor","website":"http://www-ens.iro.umontreal.ca/~syriani/","photo":"https://geodes.iro.umontreal.ca/images/people/faculty/eugene.jpg","email":"syriani@iro.umontreal.ca"},{"name":"Famelis, Michalis","image":"michalis.jpg","position":"Postdoc","website":"https://michalis.famelis.info/","photo":"https://geodes.iro.umontreal.ca/images/people/faculty/michalis.jpg","email":"famelis@iro.umontreal.ca"},{"name":"Galasso-Carbonnel, Jessie","image":"jessie.png","position":"Postdoc","start":2020,"website":"https://jgalasso.github.io/","photo":"https://geodes.iro.umontreal.ca/images/people/people/jessie.png","email":"jessie.galasso-carbonnel@umontreal.ca"},{"name":"David, Istvan","image":"istvan.png","position":"Postdoc","start":2021,"website":"http://istvandavid.com","photo":"https://geodes.iro.umontreal.ca/images/people/people/istvan.png","email":"istvan.david@umontreal.ca"},{"name":"Oakes, Bentley James","image":"bentley.png","position":"Postdoc","start":2021,"website":"http://msdl.cs.mcgill.ca/people/bentley","photo":"https://geodes.iro.umontreal.ca/images/people/people/bentley.png","email":"bentley.oakes@umontreal.ca"},{"name":"Zadahmad, Manouchehr","image":"manouchehr.jpg","position":"PhD","start":null,"website":"https://www.linkedin.com/in/manouchehr-zadahmad/","photo":"https://geodes.iro.umontreal.ca/images/people/people/manouchehr.jpg","email":"manouchehr.zadahmad.jafarlou@umontreal.ca"},{"name":"Weyssow, Martin","image":"martin.png","position":"PhD","start":null,"website":"https://martiwey.github.io/","photo":"https://geodes.iro.umontreal.ca/images/people/people/martin.png","email":"martin.weyssow@umontreal.ca"},{"name":"Zaheri, MohammadAmin","image":"mohammadamin.png","position":"PhD","start":null,"website":"http://zaheri.info/","photo":"https://geodes.iro.umontreal.ca/images/people/people/mohammadamin.png","email":"mohammadamin.zaheri@umontreal.ca"},{"name":"Dhaouadi, Mouna","image":"mouna.jpeg","position":"PhD","start":null,"website":"http://www-ens.iro.umontreal.ca/~dhaouadm/","photo":"https://geodes.iro.umontreal.ca/images/people/people/mouna.jpeg","email":"mouna.dhaouadi@umontreal.ca"},{"name":"Ben Sghaier, Oussama","image":"oussama.jpg","position":"PhD","start":null,"website":"https://oussamasghaier.github.io/","photo":"https://geodes.iro.umontreal.ca/images/people/people/oussama.jpg","email":"oussama.ben.sghaier@umontreal.ca"},{"name":"Faridmoayer, Sogol","image":"sogol.jpg","position":"PhD","start":2021,"website":"https://www.linkedin.com/in/sogol-faridmoayer-88413118a","photo":"https://geodes.iro.umontreal.ca/images/people/people/sogol.jpg","email":"sogol.faridmoayer@umontreal.ca"},{"name":"VaraminyBahnemiry, Zahra","image":"zahra.jpg","position":"PhD","start":null,"website":"https://www.linkedin.com/in/zahra-varaminy-b9a47376/","photo":"https://geodes.iro.umontreal.ca/images/people/people/zahra.jpg","email":"zahra.varaminybahnemiry@umontreal.ca"},{"name":"Dougnon, Raïssa Yapan","image":"raissa.jpg","position":"PhD","start":2021,"website":"https://www.linkedin.com/in/ra%C3%AFssa-yapan-dougnon-54167ab2","photo":"https://geodes.iro.umontreal.ca/images/people/people/raissa.jpg","email":"raissa.yapan.dougnon@umontreal.ca"},{"name":"Lafontant, Louis-Edouard","image":"louis_edouard.jpeg","position":"PhD","website":"http://www-ens.iro.umontreal.ca/~lafontle/","photo":"https://geodes.iro.umontreal.ca/images/people/people/louis_edouard.jpeg","email":"louis.edouard.lafontant@umontreal.ca"},{"name":"Jézéquel, Jean-Marc","image":"jmjezequel.jpg","position":"Collaborator","website":"https://people.irisa.fr/Jean-Marc.Jezequel/","photo":"https://geodes.iro.umontreal.ca/images/people/people/jmjezequel.jpg"},{"name":"Essadi, Naima","image":"naima.jpg","position":"Collaborator","website":"https://www.linkedin.com/in/naima-essadi/","photo":"https://geodes.iro.umontreal.ca/images/people/people/naima.jpg","email":"naima.essadi@umontreal.ca"},{"name":"Hernández López, José Antonio","image":"joseantonio.jpg","position":"Collaborator","website":"https://models-lab.github.io/members/joseantonio/","photo":"https://geodes.iro.umontreal.ca/images/people/people/joseantonio.jpg","email":"jose.antonio.hernandez.lopez@umontreal.ca"},{"name":"Ben Chaaben, Meriem","image":null,"position":"MSc","website":null,"email":"meriem.ben.chaaben@umontreal.ca"},{"name":"Kamanda, Aton","image":null,"position":"MSc","website":null,"email":"aton.kamanda@umontreal.ca"},{"name":"Maes, Lucas","image":null,"position":"MSc","website":"https://lumaes.org/","email":"lucas.maes@umontreal.ca"},{"name":"Hornung, Lucas","image":null,"position":"MSc","website":null,"email":"lucas.hornung@umontreal.ca"},{"name":"Ducoin, Aurelien","image":null,"position":"MSc","website":null,"email":"aurelien.ducoin@umontreal.ca"},{"name":"Khaldi, Hamed","image":null,"position":"MSc","website":"https://www.linkedin.com/in/hamedkhaldi/","email":"hamed.khaldi@umontreal.ca"},{"name":"Yang, Song","image":"song.jpg","position":"MSc","website":null,"email":"song.yang.1@umontreal.ca"},{"name":"Nikitchin, Vitaliy","image":null,"position":"MSc","website":"http://www-ens.iro.umontreal.ca/~nikitchv/"}]')},297:e=>{e.exports=JSON.parse('[{"name":"Inference of Simulation Models in Digital Twins by Reinforcement Learning","startYear":2021,"endYear":2024,"funding":"IVADO Postdoctoral Research Funding","PI":null,"partners":[],"logo":"ivado.png","description":null},{"name":"From examples to knowledge to software engineering support and automation","startYear":2019,"endYear":2025,"funding":"NSERC Discovery Grant","PI":null,"partners":[],"logo":"nserc.png","description":null},{"name":"Lightweight Formal Support for Software Design","startYear":2017,"endYear":2022,"funding":"NSERC Discovery Grant","PI":null,"partners":[],"logo":"nserc.png","description":null},{"name":"Artificial intelligence for and by software engineering","startYear":2019,"endYear":2024,"funding":"Private philanthropic fund","PI":null,"partners":[],"logo":"phil.png","description":null},{"name":"Detection of microservices for software migration by combining metaheuristic optimization and machine learning","startYear":2021,"endYear":2022,"funding":"Recherche, Formation & Innovation en Pays de Loire, AtlanSTIC 2020","PI":null,"partners":["IVADO"],"logo":"rfi.jpg","description":null},{"name":"Assisting software development in the time of massive data","startYear":2020,"endYear":2022,"funding":"IVADO Postdoctoral Research Funding","PI":null,"partners":[],"logo":"ivado.png","description":null},{"name":"Advanced analytics design at BNC","startYear":2020,"endYear":2021,"funding":"Mitacs Accelerate","PI":null,"partners":[],"logo":"mitacs.jpg","description":null},{"name":"AI to support software-development processes","startYear":2020,"endYear":2020,"funding":"Mitacs Accelerate","PI":null,"partners":[],"logo":"mitacs.jpg","description":null},{"name":"Learning from examples to improve Automation in Model-Driven Engineering","startYear":2014,"endYear":2019,"funding":"NSERC Discovery Grant","PI":null,"partners":[],"logo":"nserc.png","description":null},{"name":"Migration of software applications to the cloud","startYear":2017,"endYear":2018,"funding":"NSERC Engage Grant","PI":null,"partners":[],"logo":"nserc.png","description":null},{"name":"Optimization of task sequencing and allocation","startYear":2021,"endYear":2022,"funding":"Mitacs Accelerate","PI":null,"partners":["the National Bank of Canada"],"logo":"mitacs.jpg","description":null},{"name":"Semantic versioning of model changes in decision support systems","startYear":2020,"endYear":2022,"funding":"Mitacs Accelerate","PI":null,"partners":["the Technology Evaluation Centers"],"logo":"mitacs.jpg","description":null},{"name":"Constraint resolution as primitive operator for multi-paradigm model transformations","startYear":2020,"endYear":2021,"funding":"Recherche, Formation & Innovation en Pays de Loire, AtlanSTIC 2020","PI":null,"partners":["ESEO-Tech","IVADO"],"logo":"rfi.jpg","description":null},{"name":"From domain-specific languages to domain-specific environments","startYear":2020,"endYear":2025,"funding":"NSERC Discovery Grant","PI":null,"partners":[],"logo":"nserc.png","description":null},{"name":"Management of smart production lines","startYear":2018,"endYear":2019,"funding":"Relations internationales et francophones Quebec-Bavaria","PI":null,"partners":["Fortiss"],"logo":"rifqb.jpg","description":null},{"name":"Improving the modernization of legacy applications","startYear":2017,"endYear":2017,"funding":"NSERC Engage Plus Grant","PI":null,"partners":["Fresche Legacy"],"logo":"nserc.png","description":null},{"name":"Automating the modernization of legacy applications","startYear":2016,"endYear":2016,"funding":"NSERC Engage Grant","PI":null,"partners":["Fresche Legacy"],"logo":"nserc.png","description":null},{"name":"Collaborative modeling among cross-domain teams","startYear":2015,"endYear":2020,"funding":"NSERC Discovery Grant","PI":null,"partners":[],"logo":"nserc.png","description":null}]')},538:e=>{e.exports=JSON.parse('[{"name":"AToMPM","startYear":2009,"url":"https://atompm.github.io","logo":"atompm.png","partners":null,"description":"AToMPM (A Tool for Multi-Paradigm Modeling) is the modeling tool we are developing at the University of Montreal in collaboration with McGill University, the University of Antwerp, and the University of Alabama. AToMPM provides facilities for generating web-based, domain-specific modeling tools tools that run on the cloud."},{"name":"gentleman","startYear":2019,"url":"https://github.com/geodes-sms/gentleman","logo":null,"partners":null,"description":"Gentleman is a web-based projectional editor generator. It allows you to express and interact with your DSL."},{"name":"lowkey","startYear":2021,"url":"https://github.com/geodes-sms/lowkey","logo":null,"partners":null,"description":"lowkey is a low-level and transparent framework for real-time collaborative framework for multi-level and multi-view modeling. At the bottom layer of the architecture of lowkey, conflict-free replicated data types (CRDT) take care of preventing inconsistencies before they happen. The physical metamodel built on top of these data types allows for defining arbitrary numbers of linguistic models, which are in a type-instance relationship with each other. The framework is available as a Python implementation."},{"name":"ReLiS","startYear":2017,"url":"http://relis.iro.umontreal.ca/auth.html","logo":null,"partners":null,"description":"Conducting a systematic review involves many steps over a long period of time, and it is typically repetitive and labor-intensive. ReLiS (Revue Littéraire Systématique - Systematic Literature Review) can considerably reduce the effort of many of these steps by providing essential software support to reviewers. ReLiS supports planning, conducting and reportig a review, while following a previously defined process, which can be automatically adapted as the project evolves."},{"name":"BiBler","startYear":null,"url":"https://github.com/geodes-sms/bibler","logo":null,"partners":null,"description":"BiBler is a software for managing references to scientific articles using BibTeX. Not only is it a fully functional software, the tool has been entirely modeled and synthesized in Python. It is used for educational purposes in order to understand how to generate a complete application from UML models in an agile and test-driven environment."},{"name":"TAPIR","startYear":2019,"url":"https://bitbucket.org/ErickFifa/tapir/","logo":null,"partners":null,"description":"TAPIR  is a tool developed by Erick Raelijohn for generating recommendations to developers about correct API usage. At its core, it relies on the representation of API usage patterns as LTL formulars."},{"name":"T-Core","startYear":200,"url":"https://github.com/geodes-sms/tcore","logo":null,"partners":null,"description":"T-Core is a python framework for building your own domain-specific model transformation languages."}]')},871:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"name":"string"},"type":"field","tags":["tag"],"content":{"type":"text","resizable":true,"input":{"type":"text","placeholder":"tag","style":{"css":["pp-tagbox__input"]}},"style":{"css":["pp-tagbox"]}}},{"concept":{"name":"string"},"type":"field","tags":["textbox"],"content":{"type":"text","input":{"type":"text","placeholder":{"type":"property","name":"label"},"style":{"css":["pp-textbox__input"]}},"style":{"css":["pp-textbox"]}}},{"concept":{"name":"string"},"type":"field","tags":["textbox-label"],"content":{"type":"text","container":{"type":"flex","orientation":"row","content":[{"type":"static","static":{"type":"text","content":{"type":"property","name":"label"},"style":{"css":["pp-textbox2__label"]}}},{"type":"input","input":{"type":"text","placeholder":{"type":"property","name":"placeholder"},"style":{"css":["pp-textbox2__input"]}}}],"style":{"css":["pp-textbox2"]}}}},{"concept":{"name":"string"},"type":"field","tags":["textarea"],"content":{"type":"text","multiline":true,"input":{"type":"text","placeholder":"Enter a description","style":{"css":["pp-textarea__input"]}},"style":{"css":["pp-textarea"]}}},{"concept":{"name":"string"},"type":"field","tags":["textarea-label"],"field":{"type":"text","multiline":true,"container":{"content":[{"type":"static","static":{"type":"text","content":{"type":"property","name":"label"},"style":{"css":["pp-textarea2__label"]}}},{"type":"input","multiline":true,"input":{"type":"text","placeholder":"Enter a description","style":{"css":["pp-textarea2__input"]}}}],"layout":{"type":"flex","orientation":"row","wrappable":true}},"style":{"css":["pp-textarea2"]}}},{"concept":{"name":"number"},"type":"field","tags":["textbox-label"],"content":{"type":"text","container":{"type":"flex","orientation":"row","content":[{"type":"static","static":{"type":"text","content":{"type":"property","name":"label"},"style":{"css":["pp-textbox2__label"]}}},{"type":"input","input":{"type":"number","placeholder":{"type":"property","name":"placeholder"},"style":{"css":["pp-textbox2__input"]}}}],"style":{"css":["pp-textbox2"]}}}},{"concept":{"name":"string"},"type":"static","tags":["text"],"content":{"type":"text","content":{"type":"property","name":"value"},"style":{"css":["pp-text"]}}},{"concept":{"name":"string"},"type":"static","tags":["email"],"content":{"type":"link","urlType":"email","url":{"type":"property","name":"value"},"content":[{"type":"property","name":"value"}],"style":{"css":["pp-email"]}}},{"concept":{"name":"string"},"type":"static","tags":["url"],"content":{"type":"link","urlType":"link","url":{"type":"property","name":"value"},"content":[{"type":"property","name":"value"}],"style":{"css":["pp-email"]}}},{"concept":{"name":"string"},"type":"static","tags":["image"],"content":{"type":"image","url":{"type":"property","name":"value"},"style":{"css":["pp-image"]}}},{"concept":{"name":"set"},"type":"field","tags":["tags"],"content":{"type":"list","list":{"item":{"template":{"tag":"tag"},"style":{"css":["pp-tag-set__list-item"]}},"style":{"css":["pp-tag-set__list"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-tag-set__btn-remove"]}}}}},{"concept":{"name":"set"},"type":"field","tags":["areas"],"content":{"type":"list","list":{"item":{"template":{"tag":"edit-view"},"style":{"css":["pp-set__list-item"]}},"style":{"css":["pp-set__list"]}},"action":{"add":false,"remove":false}}}]}')},353:e=>{e.exports=JSON.parse('{"concept":[{"name":"organization","nature":"prototype","root":true,"attributes":[{"name":"name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Name"}]},"required":true},{"name":"description","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Description"}]},"required":true},{"name":"members","target":{"name":"set","accept":{"name":"person"}},"required":true},{"name":"photo","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Photo URL"}]},"required":false},{"name":"address","target":{"name":"address"},"required":false},{"name":"email","target":{"name":"email","properties":[{"name":"label","type":"string","value":"Email"}]},"required":false},{"name":"socials","target":{"name":"set","accept":{"name":"social"}}},{"name":"website","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Website"}]},"required":false},{"name":"phone","target":{"name":"phone","properties":[{"name":"label","type":"string","value":"Phone"}]},"required":false}],"properties":[]},{"name":"default-organization","nature":"concrete","root":true,"prototype":"organization","attributes":[],"properties":[]},{"name":"research-organization","nature":"concrete","prototype":"organization","root":true,"attributes":[{"name":"areas","target":{"name":"set","accept":{"name":"area"}}},{"name":"projects","target":{"name":"set","accept":{"name":"project"}}}],"properties":[]},{"name":"social","nature":"concrete","root":false,"attributes":[{"name":"name","target":{"name":"string","src":["twitter","facebook","linkedin","youtube","instagram","tiktok"]},"required":true},{"name":"handle","target":{"name":"string"},"required":true}],"properties":[]},{"name":"area","nature":"concrete","root":false,"attributes":[{"name":"title","target":{"name":"string"},"required":true},{"name":"description","target":{"name":"string"},"required":false},{"name":"tags","target":{"name":"set","accept":{"name":"string"}}}],"properties":[]},{"name":"address","nature":"concrete","root":false,"attributes":[{"name":"street-address","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Street address"}]},"required":true},{"name":"locality","target":{"name":"string","properties":[{"name":"label","type":"string","value":"City"}]},"required":true},{"name":"region","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Province"}]},"required":true},{"name":"country","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Country"}]},"required":true},{"name":"postal-code","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Postal code"}]},"required":true}],"properties":[]},{"name":"name","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":1}}}}},{"name":"email","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":5},"max":{"value":255}}}}},{"name":"phone","nature":"derivative","root":false,"base":"string","constraint":{"value":{"type":"pattern","pattern":{"insensitive":true,"global":true,"value":"^\\\\(?([0-9]{3})\\\\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$"}}}}]}')},369:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["general"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"name","tag":"textbox-label","style":{"css":["pp-wrap-element","pp-wrap-element--2"]}},{"type":"attribute","name":"email","tag":"textbox-label","required":true,"style":{"css":["pp-wrap-element"]}},{"type":"attribute","name":"website","tag":"textbox-label","required":true,"style":{"css":["pp-wrap-element"]}}],"style":{"css":["pp-wrap"]},"layout":{"type":"flex","orientation":"row","wrappable":false}},{"type":"attribute","name":"description","tag":"textarea-label","style":{"ref":["box-top"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Social media","style":{"css":["pp-subtitle"]}},{"kind":"static","type":"button","name":"add-area","action":{"type":"CREATE","target":{"type":"attribute","name":"socials"}},"help":"Add a social account","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"socials","tag":"areas","style":{"css":["areas"],"ref":["box-top"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Areas of research","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-area","action":{"type":"CREATE","target":{"type":"attribute","name":"areas"}},"help":"Add an area","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"areas","tag":"areas","style":{"css":["areas"],"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"address"},"tags":[],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"street-address","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"]}},{"type":"attribute","name":"locality","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}},{"type":"attribute","name":"region","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"container","content":[{"type":"attribute","name":"postal-code","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"]}},{"type":"attribute","name":"country","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup","pp-fieldgroup--50"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-address"]},"focusable":true}},{"concept":{"name":"area"},"tags":["edit-view"],"container":{"content":[{"kind":"static","type":"text","content":"Area","style":{"css":["pp-area-title"]}},{"type":"attribute","name":"title","tag":"textbox","options":{"placeholder":"Title"},"style":{"ref":["box-top"]}},{"type":"attribute","name":"description","tag":"textarea","required":true,"style":{"ref":["box-top"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Tags","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-taf","action":{"type":"CREATE","target":{"type":"attribute","name":"tags"}},"help":"Add a tag","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"tags","tag":"tags","style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-area","pp-area--edit"]},"focusable":true}},{"concept":{"name":"social"},"tags":["edit-view"],"container":{"content":[{"type":"attribute","name":"name","tag":"textbox","options":{"placeholder":"Media"},"style":{"css":["pp-social-name"]}},{"type":"attribute","name":"handle","tag":"textbox","options":{"placeholder":"Handle"},"style":{"css":["pp-social-handle"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-social"]},"focusable":true}}],"template":[],"style":[{"type":"style","name":"box-top","style":{"box":{"outer":{"top":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-right","style":{"box":{"outer":{"right":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-left","style":{"box":{"outer":{"left":{"value":6,"unit":"px"}}}}}]}')},787:e=>{e.exports=JSON.parse('{"concept":[{"name":"person","nature":"concrete","root":true,"attributes":[{"name":"first-name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"First name"}]},"required":true},{"name":"last-name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Last name"}]},"required":true},{"name":"email","target":{"name":"email","properties":[{"name":"label","type":"string","value":"Email address"}]},"required":true},{"name":"website","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Website"}]},"required":true},{"name":"phone","target":{"name":"phone","properties":[{"name":"label","type":"string","value":"Phone number"}]},"required":true},{"name":"position","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Position"}]},"required":true},{"name":"occupation","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Occupation"}]},"required":true},{"name":"photo","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Photo URL"}]},"required":false},{"name":"address","target":{"name":"address"},"required":false},{"name":"birth-date","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Birthdate"}]},"required":false},{"name":"affiliations","target":{"name":"set","accept":{"name":"affiliation"}},"required":false}],"properties":[]},{"name":"affiliation","nature":"concrete","root":false,"attributes":[{"name":"name","target":{"name":"string"},"required":true},{"name":"role","target":{"name":"string"},"required":true}],"properties":[]},{"name":"name","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":1}}}}},{"name":"email","nature":"derivative","root":false,"base":"string","constraint":{"length":{"type":"range","range":{"min":{"value":5},"max":{"value":255}}}}},{"name":"phone","nature":"derivative","root":false,"base":"string","constraint":{"value":{"type":"pattern","pattern":{"insensitive":true,"global":true,"value":"^\\\\(?([0-9]{3})\\\\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$"}}}}]}')},498:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["people"],"container":{"content":[{"type":"container","content":[{"kind":"static","type":"text","content":"Members","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-member","action":{"type":"CREATE","target":{"type":"attribute","name":"members"}},"help":"Add a member","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"members","tag":"view-table","style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"person"},"tags":["table-view","table-view--read"],"container":{"content":[{"type":"attribute","name":"first-name","tag":"text"},{"type":"attribute","name":"last-name","tag":"text","style":{"text":{"transform":"uppercase"},"ref":["box-left"]}},{"type":"attribute","name":"occupation","tag":"text"},{"type":"attribute","name":"website","tag":"url"},{"type":"attribute","name":"email","tag":"email"},{"type":"attribute","name":"phone","tag":"text","style":{"css":["phone"]}},{"kind":"static","type":"plink","tag":"table-view--edit","content":[],"style":{"css":["pp__btn-edit"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-person","pp-person--row","read"]},"focusable":true}},{"concept":{"name":"person"},"tags":["table-view","table-view--edit"],"container":{"content":[{"type":"attribute","name":"first-name","tag":"textbox","options":{"placeholder":"First name"}},{"type":"attribute","name":"last-name","tag":"textbox","options":{"placeholder":"Last name"}},{"type":"attribute","name":"occupation","tag":"textbox","options":{"placeholder":"Occupation"}},{"type":"attribute","name":"website","tag":"textbox","options":{"placeholder":"URL"}},{"type":"attribute","name":"email","options":{"placeholder":"Email address"},"tag":"textbox"},{"type":"attribute","name":"phone","tag":"textbox","options":{"placeholder":"Phone number"},"style":{"css":["phone"]}},{"kind":"static","type":"plink","tag":"table-view--read","content":[{"type":"raw","raw":"Done!"}],"style":{"css":["pp-navlink"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-person","pp-person--row"]},"focusable":true}},{"concept":{"name":"person"},"tags":["card-view","card-view--read"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"photo","tag":"image"}],"layout":{"type":"flex","orientation":"row","wrappable":true},"style":{"css":["pp-person-image"]}},{"type":"container","content":[{"type":"container","content":[{"type":"attribute","name":"first-name","tag":"text","style":{"css":["first-name"]}},{"type":"attribute","name":"last-name","tag":"text","style":{"text":{"transform":"uppercase"},"box":{"outer":{"left":{"value":3,"unit":"px"}}}}}],"layout":{"type":"flex","orientation":"row","wrappable":true},"style":{"css":["pp-combi-name"]}},{"type":"attribute","name":"occupation","tag":"text","style":{"text":{"bold":500}}},{"type":"attribute","name":"email","tag":"email"},{"type":"attribute","name":"phone","tag":"text"},{"kind":"static","type":"plink","tag":"card-view--edit","content":[],"style":{"css":["pp__btn-edit"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-person-info"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-person","pp-person--read"]},"focusable":true}},{"concept":{"name":"person"},"tags":["card-view","card-view--edit"],"container":{"content":[{"type":"container","content":[{"type":"attribute","name":"first-name","tag":"textbox-label"},{"type":"attribute","name":"last-name","tag":"textbox-label","style":{"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"attribute","name":"occupation","tag":"textbox-label","style":{"ref":["box-top"]}},{"type":"attribute","name":"email","tag":"textbox-label","style":{"ref":["box-top"]}},{"type":"attribute","name":"phone","tag":"textbox-label","style":{"ref":["box-top"]}},{"type":"attribute","name":"photo","tag":"textbox-label","required":true,"style":{"ref":["box-top"]}},{"kind":"static","type":"plink","tag":"card-view--read","content":[{"type":"raw","raw":"Done!"}],"style":{"ref":["box-top"],"css":["pp-navlink"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-person","pp-person--edit"]},"focusable":true}},{"concept":{"name":"set"},"tags":["view-table"],"type":"container","container":{"content":[{"type":"template","name":"tpl-view-options","param":[{"name":"selected","value":"table"}]},{"kind":"field","type":"list","list":{"item":{"template":{"tag":"table-view"},"style":{"css":["pp-person-set__rowlist-item"]}},"style":{"css":["pp-person-set__rowlist"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-person-set__btn-remove"]}}}}],"layout":{"type":"flex","orientation":"column"}}},{"concept":{"name":"set"},"tags":["view-grid"],"type":"container","container":{"content":[{"type":"template","name":"tpl-view-options","param":[{"name":"selected","value":"grid"}]},{"kind":"field","type":"list","list":{"item":{"template":{"tag":"card-view"},"style":{"css":["pp-person-set__list-item"]}},"style":{"css":["pp-person-set__list"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-person-set__btn-remove"]}}}}],"layout":{"type":"flex","orientation":"column"}}}],"template":[{"type":"template","name":"tpl-view-options","param":[{"name":"selected","type":"string"}],"content":[{"type":"container","content":[{"kind":"static","type":"text","content":"List View","style":{"css":["label"]}},{"kind":"static","type":"plink","tag":"view-table","content":[{"kind":"static","type":"text","content":"Row","style":{"css":["pp-viewnav__link-text"]}}],"style":{"css":["pp-viewnav__link","pp-viewnav__link--table"]}},{"kind":"static","type":"plink","tag":"view-grid","content":[{"kind":"static","type":"text","content":"Card","style":{"css":["pp-viewnav__link-text"]}}],"style":{"css":["pp-viewnav__link","pp-viewnav__link--grid"]}}],"style":{"html":[{"name":"view","value":{"type":"param","name":"selected"}}],"css":["pp-viewnav"]},"layout":{"type":"flex","orientation":"row"}}]}],"style":[{"type":"style","name":"box-top","style":{"box":{"outer":{"top":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-right","style":{"box":{"outer":{"right":{"value":6,"unit":"px"}}}}},{"type":"style","name":"box-left","style":{"box":{"outer":{"left":{"value":6,"unit":"px"}}}}}]}')},82:e=>{e.exports=JSON.parse('{"concept":[{"name":"project","nature":"concrete","root":true,"attributes":[{"name":"name","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Name"}]},"required":true},{"name":"description","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Description"}]},"required":true},{"name":"start-date","target":{"name":"number","properties":[{"name":"label","type":"string","value":"Start year"}]},"required":true},{"name":"end-date","target":{"name":"number","properties":[{"name":"label","type":"string","value":"End year"}]},"required":true},{"name":"partners","target":{"name":"set","accept":{"name":"partner"},"properties":[{"name":"label","type":"string","value":"Partners"}]},"required":true},{"name":"funding","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Funding"}]},"required":true},{"name":"logo","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Logo"}]},"required":false}],"properties":[]},{"name":"partner","nature":"concrete","root":false,"attributes":[{"name":"name","target":{"name":"name","properties":[{"name":"label","type":"string","value":"Name"}]},"required":true},{"name":"description","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Description"}]},"required":true},{"name":"website","target":{"name":"string","properties":[{"name":"label","type":"string","value":"Website"}]},"required":false}],"properties":[]}]}')},140:e=>{e.exports=JSON.parse('{"projection":[{"concept":{"prototype":"organization"},"tags":["project"],"container":{"content":[{"type":"container","content":[{"kind":"static","type":"text","content":"Projects","style":{"css":["pp-title"]}},{"kind":"static","type":"button","name":"add-project","action":{"type":"CREATE","target":{"type":"attribute","name":"projects"}},"help":"Add a project","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"projects","tag":"view-box","style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column","wrappable":false},"style":{"css":["pp-organization"]},"focusable":true}},{"concept":{"name":"project"},"tags":["card-view"],"container":{"content":[{"type":"attribute","name":"name","tag":"textbox-label"},{"type":"attribute","name":"description","tag":"textarea-label","style":{"ref":["box-top"]}},{"type":"container","content":[{"type":"attribute","name":"start-date","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"]}},{"type":"attribute","name":"end-date","tag":"textbox-label","style":{"css":["pp-fieldgroup-element"],"ref":["box-left"]}},{"type":"attribute","name":"funding","tag":"textbox-label","style":{"css":["pp-fieldgroup-element","pp-fieldgroup-element--3"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row","wrappable":false},"style":{"css":["pp-fieldgroup"]}},{"type":"container","content":[{"kind":"static","type":"text","content":"Partners","style":{"css":["pp-subtitle"]}},{"kind":"static","type":"button","name":"add-area","action":{"type":"CREATE","target":{"type":"attribute","name":"partners"}},"help":"Add a partner","content":[{"kind":"static","type":"text","content":"+","style":{"css":["pp__btn-add-icon"]}},{"kind":"static","type":"text","content":"New","style":{"css":["pp__btn-add-text"]}}],"style":{"css":["btn","pp__btn-add"],"ref":["box-left"]}}],"layout":{"type":"flex","orientation":"row"},"style":{"css":["pp-wrap"],"ref":["box-top"]}},{"type":"attribute","name":"partners","tag":"partners","style":{"css":["areas"],"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-project","pp-project--edit"]},"focusable":true}},{"concept":{"name":"partner"},"tags":["edit-view"],"container":{"content":[{"kind":"static","type":"text","content":"Partner","style":{"css":["pp-area-title"]}},{"type":"attribute","name":"name","tag":"textbox","options":{"placeholder":"name"}},{"type":"attribute","name":"description","tag":"textarea","required":true,"style":{"ref":["box-top"]}},{"type":"attribute","name":"website","tag":"textbox","required":true,"options":{"placeholder":"URL"},"style":{"ref":["box-top"]}}],"layout":{"type":"flex","orientation":"column"},"style":{"css":["pp-area","pp-area--edit"]},"focusable":true}},{"concept":{"name":"set"},"tags":["view-box"],"type":"container","container":{"content":[{"kind":"field","type":"list","list":{"item":{"template":{"tag":"card-view"},"style":{"css":["pp-person-set__list-item"]}},"style":{"css":["pp-person-set__list"]}},"action":{"add":false,"remove":{"content":[{"kind":"static","type":"text","content":"✖"}],"style":{"css":["pp-person-set__btn-remove"]}}}}],"layout":{"type":"flex","orientation":"column"}}},{"concept":{"name":"set"},"type":"field","tags":["partners"],"content":{"type":"list","list":{"item":{"template":{"tag":"edit-view"},"style":{"css":["pp-set__list-item"]}},"style":{"css":["pp-set__list"]}},"action":{"add":false,"remove":false}}}],"template":[],"style":[]}')}},t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}(()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function r(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i?g(e)?t:e:f(e)?t:e}function a(e){return d(e)&&0===e.length}function o(t){return t instanceof Date||"object"===e(t)&&"[object Date]"===Object.prototype.toString.call(t)}function l(e){return"string"==typeof e||e instanceof String}function h(e){return"function"==typeof e}function c(t){return!f(t)&&"object"===e(t)}function d(e){return!f(e)&&"function"==typeof e[Symbol.iterator]}function u(e){return d(e)&&!l(e)}function p(e){return null===e}function m(e){return!e||l(e)&&(0===e.length||/^\s*$/.test(e))}function g(e){return void 0===e}function f(e){return p(e)||g(e)}function b(e,t){var i=e.getDate(),s=e.getMonth()+1,n=e.getFullYear().toString(),r=e.getHours(),a=e.getMinutes(),o=e.getSeconds(),l=function(e){return e<10?"0".concat(e):e};return t.replace("yyyy",n).replace("yy",n.slice(-2)).replace("mm",l(s)).replace("m",s).replace("dd",l(i)).replace("d",i).replace("hh",l(r)).replace("h",r).replace("MM",l(a)).replace("M",a).replace("ss",l(o)).replace("s",o)}var v=Object.prototype.hasOwnProperty,y=(Object.prototype.isPrototypeOf,function(e,t){return v.call(e,t)});function w(e){if(f(e)||!c(e))return e;var t=e.constructor();for(var i in e)y(e,i)&&(e.isActiveClone=null,t[i]=w(e[i]),delete e.isActiveClone);return t}function x(e){return m(e)?e:function(e){return m(e)?e:e.toLowerCase().replace(/\b\w/g,(function(e){return e.toUpperCase()}))}(e.replace(/[_-]+/g," ").replace(/\s+/g," ").trim()).replace(/\s+/g,"")}function E(e){var t=r(e,!1);return l(t)&&"true"===t.toLowerCase()||Number.isInteger(t)&&1===t||!0===t}var A=function(e){return!f(e)&&e.nodeType===Node.ELEMENT_NODE},j=function(e){return e instanceof Node},C=function(e){return A(e)&&e instanceof Element},L=function(e,t){return!!(A(e)&&e instanceof HTMLElement)&&(!d(t)||(i=e,n=Array.isArray(t)?t:[t],r=function(e){return i instanceof e},o=function(e){return i.tagName===e.toUpperCase()},l=function(e){return Array.isArray(e)?e.includes(i.type):i.type===e},n.some((function(e){if(!d(e))return!1;var t,i,n=e,h=null;if(Array.isArray(e)){var c=(i=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,n=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);s=!0);}catch(e){n=!0,r=e}finally{try{s||null==o.return||o.return()}finally{if(n)throw r}}return i}}(t,i)||s(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());n=c[0],h=c[1]}n=n.toLowerCase();var p="HTML".concat(y(k,n)?k[n]:x(n),"Element");return!(!r(window[p])&&!o(n))&&(!(u(h)&&!a(h))||l(h))}))));var i,n,r,o,l},k={a:"Anchor",br:"BR",dl:"DList",datalist:"DataList",fieldset:"FieldSet",frameset:"FrameSet",hr:"HR",h1:"Heading",h2:"Heading",h3:"Heading",h4:"Heading",h5:"Heading",h6:"Heading",li:"LI",ol:"OList",optgroup:"OptGroup",p:"Paragraph",q:"Quote",blockquote:"Quote",caption:"TableCaption",td:"TableCell",th:"TableCell",col:"TableCol",tr:"TableRow",tbody:"TableSection",thead:"TableSection",tfoot:"TableSection",textarea:"TextArea",ul:"UList"},I=function(e){return function(e){return!f(e)&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(e)&&e instanceof DocumentFragment};function S(e,t){if(!l(t))return null;var i=document.createElement("template");return i.innerHTML=t.trim(),i.content[e]}var O=S.bind(null,"firstChild");function N(e,t,i){e[t]=i}function M(e,t,i){e.setAttribute(t,i)}S.bind(null,"childNodes");var R="accesskey,autocapitalize,class,dataset,editable,draggable,hidden,id,inputmode,lang,html,style,tabindex,text,title",_={accesskey:[N,"accessKey"],autocapitalize:[N,"autocapitalize"],class:[function(e,i){var s;if(!L(e))throw new Error("Bad argument: The passed `element` argument is not a valid HTML Element");return(s=e.classList).add.apply(s,t(Array.isArray(i)?i:[i])),e}],dataset:[function(e,t,i){Object.assign(e[t],i)},"dataset"],draggable:[N,"draggable"],editable:[N,"contentEditable"],hidden:[N,"hidden"],id:[N,"id"],inputmode:[N,"inputMode"],lang:[N,"lang"],html:[N,"innerHTML"],style:[N,"style"],tabindex:[N,"tabIndex"],text:[N,"textContent"],title:[N,"title"],data:[N,"data"],cite:[N,"cite"],download:[N,"download"],ping:[N,"ping"],target:[N,"target"],coords:[N,"coords"],shape:[N,"shape"],autoplay:[N,"autoplay"],buffered:[N,"buffered"],controls:[N,"controls"],loop:[N,"loop"],muted:[N,"muted"],playsinline:[M,"playsinline"],poster:[N,"poster"],preload:[N,"preload"],crossorigin:[N,"crossOrigin"],decoding:[N,"decoding"],height:[N,"height"],ismap:[N,"isMap"],loading:[N,"loading"],srcset:[N,"srcset"],width:[N,"width"],alt:[N,"alt"],as:[N,"as"],media:[N,"media"],rel:[N,"rel"],src:[N,"src"],sizes:[N,"sizes"],reversed:[N,"reversed"],start:[N,"start"],accept:[N,"accept"],"accept-charset":[N,"acceptCharset"],action:[N,"action"],autocomplete:[N,"autocomplete"],autofocus:[N,"autofocus"],capture:[N,"capture"],checked:[N,"checked"],cols:[N,"cols"],disabled:[N,"disabled"],dirname:[N,"dirName"],enctype:[N,"enctype"],for:[N,"for"],form:[N,"form"],formaction:[N,"formAction"],formenctype:[N,"formEnctype"],formmethod:[N,"formMethod"],formnovalidate:[N,"formNoValidate"],formtarget:[N,"formTarget"],high:[N,"high"],label:[N,"label"],list:[N,"list"],low:[N,"low"],max:[N,"max"],maxlength:[N,"maxLength"],method:[N,"method"],min:[N,"min"],minlength:[N,"minLength"],multiple:[N,"multiple"],name:[N,"name"],novalidate:[N,"noValidate"],optimum:[N,"optimum"],pattern:[N,"pattern"],placeholder:[N,"placeholder"],readonly:[N,"readOnly"],required:[N,"required"],rows:[N,"rows"],selected:[N,"selected"],size:[N,"size"],spellcheck:[M,"spellcheck"],step:[N,"step"],wrap:[N,"wrap"],default:[N,"default"],kind:[N,"kind"],srclang:[N,"srclang"],abbr:[N,"abbr"],colspan:[N,"colSpan"],span:[N,"span"],rowspan:[N,"rowSpan"],scope:[N,"scope"],href:[N,"href"],hreflang:[N,"hreflang"],datetime:[N,"dateTime"],type:[N,"type"],value:[N,"value"],usemap:[N,"useMap"]};function V(e,i,s){var n=document.createElement(e);return L(n)?(c(s)&&function(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!L(e))throw new Error("Bad argument: The given element argument is not a valid HTML Element");if(!c(i))return e;for(var n=function(e){return R.includes(e)||s.includes(e)},r=0,a=Object.keys(i);r<a.length;r++){var o=a[r];if(n(o)){var l=i[o],h=_[o].slice(0);h.shift().apply(void 0,[e].concat(t(h),[l]))}}}(n,s,r(i,"")),n):null}function P(e,t,i,s){var n=V(e,t,i);return L(n)?(f(s)||ve(n,s),n):null}function T(e,t,i,s,n){var r=V(e,t,s);return L(r)?(f(n)||ve(r,n,i),r):null}function H(e){var t=document.createDocumentFragment();return f(e)||ve(t,e),t}V.bind(null,"link","as,crossorigin,disabled,href,hreflang,media,rel,sizes,type"),P.bind(null,"template","");var D=P.bind(null,"header",""),$=(P.bind(null,"footer",""),P.bind(null,"main",""),P.bind(null,"article",""),P.bind(null,"section","")),B=(P.bind(null,"nav",""),P.bind(null,"aside","")),z=(P.bind(null,"h1",""),P.bind(null,"h2","")),q=P.bind(null,"h3",""),F=P.bind(null,"h4",""),W=(P.bind(null,"h5",""),P.bind(null,"h6",""),P.bind(null,"div","")),U=(P.bind(null,"object","data,height,name,type,usemap,width"),V.bind(null,"embed","height,src,type,width"),V.bind(null,"br",""),V.bind(null,"hr",""),P.bind(null,"p","")),Y=(P.bind(null,"blockquote","cite"),function(e){return L(e,"li")?e:J(null,e)}),G=T.bind(null,"ul","",Y),J=(T.bind(null,"ol","reversed,start,type",Y),P.bind(null,"li","value")),X=(P.bind(null,"dl",""),P.bind(null,"dt",""),P.bind(null,"dd",""),P.bind(null,"a","download,href,hreflang,ping,rel,target,type")),K=(V.bind(null,"area","alt,coords,download,href,hreflang,media,ping,rel,shape,target"),V.bind(null,"base","href,target"),V.bind(null,"img","alt,crossorigin,decoding,height,ismap,loading,sizes,src,srcset,usemap,width")),Z=P.bind(null,"audio","autoplay,controls,crossorigin,loop,muted,preload,src"),Q=(P.bind(null,"video","autoplay,controls,crossorigin,height,loop,muted,playsinline,poster,preload,src,width"),V.bind(null,"source","media,sizes,src,srcset,type"),V.bind(null,"track","default,kind,label,src,srclang"),P.bind(null,"picture",""),P.bind(null,"figure",""),P.bind(null,"figcaption",""),P.bind(null,"span","")),ee=P.bind(null,"strong",""),te=P.bind(null,"em",""),ie=(P.bind(null,"mark",""),P.bind(null,"samp",""),P.bind(null,"sub",""),P.bind(null,"sup",""),P.bind(null,"del","cite,datetime"),P.bind(null,"ins","cite,datetime"),P.bind(null,"q","cite"),P.bind(null,"abbr",""),P.bind(null,"b",""),P.bind(null,"i","")),se=(P.bind(null,"s",""),P.bind(null,"u",""),P.bind(null,"cite",""),P.bind(null,"time","datetime"),P.bind(null,"code",""),P.bind(null,"form","accept-charset,action,autocomplete,enctype,method,name,novalidate,rel,target"),V.bind(null,"input","accept,alt,autocomplete,autofocus,capture,checked,dirname,disabled,height,max,maxlength,minlength,min,multiple,name,pattern,placeholder,readonly,required,size,src,step,type,value,width")),ne=P.bind(null,"textarea","autocomplete,autofocus,cols,disabled,maxlength,minlength,name,placeholder,readonly,required,rows,spellcheck,value,wrap"),re=P.bind(null,"label","for"),ae=(T.bind(null,"select","autocomplete,autofocus,disabled,multiple,name,required,size",(function(e){return L(e,["option","optgroup"])?e:Array.isArray(e)?le(null,e):ae(null,e)})),P.bind(null,"option","disabled,label,selected,value")),oe=function(e){return L(e,"option")?e:ae(null,e)},le=T.bind(null,"optgroup","disabled,label",oe),he=(P.bind(null,"fieldset","disabled,name"),P.bind(null,"legend",""),T.bind(null,"datalist","",oe),P.bind(null,"meter","high,low,max,min,optimum,value"),P.bind(null,"progress","max,value"),P.bind(null,"output","name,value"),P.bind(null,"button","autofocus,disabled,formaction,formenctype,formmethod,formnovalidate,formtarget,name,type,value")),ce=P.bind(null,"table",""),de=(P.bind(null,"caption",""),function(e){return L(e,"tr")?e:ge(null,e)}),ue=T.bind(null,"thead","",de),pe=T.bind(null,"tbody","",de),me=T.bind(null,"tfoot","",de),ge=(V.bind(null,"col","span"),T.bind(null,"colgroup","span",(function(e){return L(e,"col")?e:null})),T.bind(null,"tr","",(function(e){return L(e,["th","td"])?e:be(null,e)}))),fe=P.bind(null,"th","abbr,colspan,rowspan,scope"),be=P.bind(null,"td","colspan,rowspan");function ve(e,t,i){var s=Array.isArray(t)?t:[t];return h(i)&&(s=s.map((function(e){return i(e)}))),function(e,t){if(!j(e))throw new TypeError("Bad argument: The given `parent` is not a valid Node");if(!(t instanceof HTMLCollection||u(t)))throw new TypeError("Bad argument: The given `children` is not a valid HTMLCollection/HTMLElement array");var i=I(e)?e:document.createDocumentFragment();Array.from(t).forEach((function(e){var t;f(e)||i.appendChild(j(e)?e:(t=e.toString(),document.createTextNode(t.toString())))})),e!==i&&e.appendChild(i)}(e,s),e}var ye=function(e){return/^\.[a-zA-Z0-9_-]+$/.test(e)};function we(e,t){var i=r(t,document);return m(e)?null:I(i)?i.querySelector(e):function(e){return/^#[a-zA-Z0-9_-]+$/.test(e)}(e)?document.getElementById(e.substring(1)):ye(e)?i.getElementsByClassName(e.substring(1))[0]:i.querySelector(e)}function xe(e,t){var i=r(t,document);return m(e)?null:I(i)?i.querySelectorAll(e):ye(e)?i.getElementsByClassName(e.substring(1)):i.querySelectorAll(e)}function Ee(e,t){return"content"in document.createElement("template")?we(e,t):null}function Ae(e,t){return e?document.importNode(e.content,r(t,!0)):e}function je(e,t,i){if(!L(t))return null;var s=t[e];if(h(i))for(;C(s)&&!i(s);)s=s[e];return s}function Ce(e,t,i){if(!C(e))throw new TypeError("Bad argument: The given target parameter is not a valid HTML Element");if(!h(t))throw new TypeError("Bad argument: The given pred parameter is not a valid Function");var s=e.parentElement;return i>0?ke(s,t,i-1):Le(s,t)}function Le(e,t){return f(e)?null:t(e)?e:Le(e.parentElement,t)}function ke(e,t,i){return f(e)||0===i?null:t(e)?e:ke(e.parentElement,t,i-1)}function Ie(e,t){if(!j(e))throw new TypeError("Bad argument: The given `node` is not a valid Node");return h(t)?(Array.from(e.childNodes).forEach((function(i){t(i)&&e.removeChild(i)})),e):function(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild);return e}(e)}function Se(e){if(f(e))return!1;var t=ne({value:L(e)?e.textContent:e.toString(),readonly:!0});return!!L(t)&&(document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),!0)}je.bind(null,"previousElementSibling"),je.bind(null,"nextElementSibling");var Oe=function(e){return e.dataset.state},Ne=function(e,t){return e.dataset.state=t},Me=function(e,t){return Ne(e,r(t,"checked"))},Re=function(e,t){return Ne(e,r(t,"unchecked"))},_e={name:"form-selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return p(this.selectedItem)&&!p(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("change",(function(t){var i=t.target,s=!1;if(h(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),s)return i.checked=!1,void e.items[e.selectedIndex].setChecked(!0);var n=e.items.find((function(e){return e.index===+r(i.dataset.selectorIndex,-1)}));f(n)||(e.setSelectedItem(n),h(e.afterChange)&&e.afterChange(e,t))}))}},Ve=function(e){return'[data-type="'.concat(e.name,'"]')},Pe={BaseSelector:Ve({name:"selector",container:null,items:null,selectedIndex:null,selectedItem:null,beforeChange:null,afterChange:null,get value(){return this.selectedItem.value},setSelectedItem:function(e){return this.items.includes(e)?(this.selectedItem&&this.selectedItem.setChecked(!1),this.selectedItem=e,this.selectedItem.setChecked(!0),!0):null},init:function(){for(var e=this.container.dataset.value,t=null,i=0;i<this.items.length;i++){var s=this.items[i];s.isChecked()&&this.setSelectedItem(s),s.value===e&&(t=s)}return p(this.selectedItem)&&!p(t)&&this.setSelectedItem(t),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=t.target;if(y(i.dataset,"selector")){var s=!1;if(h(e.beforeChange)&&(s=!1===e.beforeChange(e,t)),!s){var n=e.items.find((function(e){return e.index===+r(i.dataset.selectorIndex,-1)}));f(n)||(e.setSelectedItem(n),h(e.afterChange)&&e.afterChange(e,t))}}}))}}),FormSelector:Ve(_e)};new Error("Missing container: A selector requires a container"),new Error("Missing input: FormSelector requires an input in the container"),[Pe.BaseSelector,Pe.FormSelector].join(","),new Error("Missing container: A switch requires a container"),new Error("Missing input: FormSwitch requires an input in the container");var Te="on",He=function(e){return'[data-type="'.concat(e.name,'"]')},De={name:"form-switch",container:null,input:null,beforeChange:null,afterChange:null,get value(){return this.input.value},isChecked:function(){return Oe(this.container)===Te},setChecked:function(e){return!f(e)&&(this.input.checked=e,e?Me(this.container,Te):Re(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.input.checked&&this.setChecked(!0),this.bindEvents(),this},bindEvents:function(){var e=this;this.input.addEventListener("change",(function(t){var i=!1;h(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i?e.input.checked=!e.input.checked:(e.toggle(),h(e.afterChange)&&e.afterChange(e,t))}))}};function $e(e){let t=0;if(it(e))return e.selectionStart;if(0!==window.getSelection().rangeCount){const i=window.getSelection().getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),t=s.toString().length}return t}[He({name:"switch",container:null,beforeChange:null,afterChange:null,get value(){return this.container.dataset.value},isChecked:function(){return Oe(this.container)===Te},setChecked:function(e){return!f(e)&&(e?Me(this.container,Te):Re(this.container,"off"),!0)},toggle:function(){this.isChecked()?this.setChecked(!1):this.setChecked(!0)},init:function(e){return Object.assign(this,e),this.isChecked()&&Me(this.container,Te),this.bindEvents(),this},bindEvents:function(){var e=this;this.container.addEventListener("click",(function(t){var i=!1;h(e.beforeChange)&&(i=!1===e.beforeChange(e,t)),i||(e.toggle(),h(e.afterChange)&&e.afterChange(e,t))}))}}),He(De)].join(","),new Error("Missing container: A collapsible requires a container"),new Error("Missing container: An accordion requires a container"),encodeURIComponent;const Be="hidden",ze="collapsed",qe="highlighted",Fe="shake",We="selected";function Ue(e){return L(e)?(e.classList.remove(Be),e):e}function Ye(e){return L(e)?(e.classList.add(Be),e):e}function Ge(e){return L(e)?(e.classList.toggle(Be),e):e}function Je(e){e.classList.contains(Fe)||(e.classList.add(Fe),setTimeout((()=>{e.classList.remove(Fe)}),1e3))}function Xe(e){return L(e)?(e.classList.remove(qe),e):e}const Ke={backspace:"Backspace",tab:"Tab",enter:"Enter",ctrl:"Control",shift:"Shift",alt:"Alt",escape:"Escape",spacebar:" ",page_up:"PageUp",page_down:"PageDown",insert:"Insert",end:"End",home:"Home",left_arrow:"ArrowLeft",up_arrow:"ArrowUp",right_arrow:"ArrowRight",down_arrow:"ArrowDown",delete:"Delete",period:"."},Ze={NORMAL:"normal",WARNING:"warning",SUCCESS:"success",ERROR:"error"},Qe="error",et={"audio/aac":"aac","application/octet-stream":"bin","image/jpeg":"jpeg","application/json":"json","audio/mpeg":"mp3","application/pdf":"pdf","image/svg+xml":"svg","text/plain":"txt","text/xml":"xml","application/zip":"zip"};function tt(e){if(!L)throw new TypeError("Bad parameter");return e.hidden||"none"===window.getComputedStyle(e).display}const it=e=>L(e,["input","textarea"]),st=e=>it(e)||"true"===e.contentEditable,nt=e=>+e.substring(0,e.indexOf("px")),rt={top:e=>e.marginTop,right:e=>e.marginRight,bottom:e=>e.marginBottom,left:e=>e.marginLeft},at={top:e=>e.paddingTop,right:e=>e.paddingRight,bottom:e=>e.paddingBottom,left:e=>e.paddingLeft},ot={top:e=>e.borderTopWidth,right:e=>e.borderRightWidth,bottom:e=>e.borderBottomWidth,left:e=>e.borderLeftWidth};function lt(e,t,i){const s=window.getComputedStyle(e),n=window.getComputedStyle(t),r=rt[i](s),a=at[i](n),o=ot[i](n);return l=e.getBoundingClientRect()[i]+nt(r),h=t.getBoundingClientRect()[i]-nt(a)-nt(o),Math.abs(l-h)<2;var l,h}function ht(e,t,i,s){return"up"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&lt(e,t,"top"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(tt(i)||i.classList.contains("badge")||i===e)continue;const{bottom:h,left:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);n>=h-1&&(d<o||d===o&&u<l)&&(a=i,o=d,l=u)}return a}(e,i,s):"down"===t?function(e,t,i=!0){const s=t.children,{bottom:n,left:r}=e.getBoundingClientRect();if(i&&lt(e,t,"bottom"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(tt(i)||i.classList.contains("badge")||i===e)continue;const{top:h,left:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);n<=h+1&&(d<o||d===o&&u<l)&&(a=i,o=d,l=u)}return a}(e,i,s):"left"===t?function(e,t,i=!0){const s=t.children,{top:n,left:r}=e.getBoundingClientRect();if(i&&lt(e,t,"left"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(tt(i)||i.classList.contains("badge")||i===e)continue;const{top:h,right:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);r>=c-1&&(u<l||u===l&&d<o)&&(a=i,o=d,l=u)}return a}(e,i,s):"right"===t?function(e,t,i=!0){const s=t.children,{top:n,right:r}=e.getBoundingClientRect();if(i&&lt(e,t,"right"))return null;let a=null,o=99999,l=99999;for(let t=0;t<s.length;t++){const i=s[t];if(tt(i)||i.classList.contains("badge")||i===e)continue;const{top:h,left:c}=i.getBoundingClientRect();let d=Math.abs(n-h),u=Math.abs(r-c);r<=c+1&&(u<l||u===l&&d<o)&&(a=i,o=d,l=u)}return a}(e,i,s):(console.error("unknown direction",t),null)}function ct(e,t){const i=e.children,{top:s,left:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,o=99999,l=99999;for(let e=0;e<i.length;e++){const h=i[e];if(r&&!t(h))continue;if(tt(h)||h.classList.contains("badge"))continue;const{top:c,left:d}=h.getBoundingClientRect();let u=Math.abs(s-c),p=Math.abs(n-d);s<=c+1&&(u<o||u===o&&p<l)&&(a=h,o=u,l=p)}return a}function dt(e,t){const i=e.children,{top:s,left:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,o=99999,l=99999;for(let e=0;e<i.length;e++){const h=i[e];if(r&&!t(h))continue;if(tt(h)||h.classList.contains("badge"))continue;const{top:c,left:d}=h.getBoundingClientRect();let u=Math.abs(s-c),p=Math.abs(n-d);n<=d+1&&(p<l||p===l&&u<o)&&(a=h,o=u,l=p)}return a}function ut(e,t){const i=e.children,{top:s,right:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,o=99999,l=99999;for(let e=0;e<i.length;e++){const h=i[e];if(r&&!t(h))continue;if(tt(h)||h.classList.contains("badge"))continue;const{top:c,right:d}=h.getBoundingClientRect();let u=Math.abs(s-c),p=Math.abs(n-d);n>=d-1&&(p<l||p===l&&u<o)&&(a=h,o=u,l=p)}return a}function pt(e,t){const i=e.children,{bottom:s,left:n}=e.getBoundingClientRect();if(0===i.length)return null;const r=h(t);let a=null,o=99999,l=99999;for(let e=0;e<i.length;e++){const h=i[e];if(r&&!t(h))continue;if(tt(h)||h.classList.contains("badge"))continue;const{bottom:c,left:d}=h.getBoundingClientRect();let u=Math.abs(s-c),p=Math.abs(n-d);s>=c-1&&(u<o||u===o&&p<l)&&(a=h,o=u,l=p)}return a}function mt(e){return L(e)?e:l(e)&&!m(e)?we(e):null}function gt(e,t={}){const i=mt(e);if(!L(i))return null;const s=Object.assign({horizontal:!0,vertical:!0,minWidth:60,minHeight:60},t),n=function(){let e=W({class:["resizers"]});return["horizontal","vertical"].forEach((t=>{e.append(W({class:["resizer",`${t}`],dataset:{dir:t}}))})),e}();i.prepend(n),s.horizontal&&s.vertical?i.dataset.resizable="both":s.horizontal?i.dataset.resizable="horizontal":s.vertical&&(i.dataset.resizable="vertical");const{minWidth:a,minHeight:o}=getComputedStyle(i),l=r(nt(a),s.minWidth),h=r(nt(o),s.minHeight);let c=0,d=null;function u(e){const{dir:t}=d.dataset,{width:s,height:n}=getComputedStyle(i);let r="horizontal"===t?e.pageX:e.pageY;if("horizontal"===t){const e=nt(s)+(r-c);e>l&&(i.style.width=`${e}px`)}else if("vertical"===t){const e=nt(n)+(r-c);e>h&&(i.style.height=`${e}px`)}c=r}for(let e=0;e<n.childElementCount;e++){const t=n.children[e];t.addEventListener("mousedown",(function(e){e.preventDefault(),d=t;const{dir:i}=d.dataset;c="horizontal"===i?e.pageX:e.pageY,document.body.addEventListener("mousemove",u),document.body.addEventListener("mouseup",(()=>{document.body.removeEventListener("mousemove",u)}))}))}return i}const ft=e=>JSON.parse(JSON.stringify(e)),bt=function(){var e={},t=[];for(let e=0;e<256;e++)t[e]=e<16?"0"+e.toString(16):e.toString(16);return e.generate=function(){var e=4294967296*Math.random()>>>0,i=4294967296*Math.random()>>>0,s=4294967296*Math.random()>>>0,n=4294967296*Math.random()>>>0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&s|128]+t[s>>8&255]+"-"+t[s>>16&255]+t[s>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]},e}(),vt={menu:null,schema:null,isOpen:!1,visible:!0,btnStart:null,fileIO:null,config:null,settings:null,init(e){return e&&(this.schema=e),this},get isRendered(){return L(this.container)},clear(){return Ie(this.container),this},update(){},render(){const e=H();if(!L(this.container)){this.container=W({class:["editor-home"]});let e=z({class:["editor-title"]},"Settings");this.container.append(e)}return L(this.menu)||(this.menu=yt.call(this),e.append(this.menu)),L(this.btnStart)||(this.btnStart=he({class:["btn","editor-home-section--model__button","editor-home-section__button--start"],dataset:{action:"close",context:"home"}},"Done"),e.append(this.btnStart)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){const{hasConceptModel:e,hasProjectionModel:t}=this.editor;return this.btnStart.disabled=!(e&&t),this},actionHandler(e,t){const{concept:i}=t.dataset;"open-concept"===e&&(this.config.selectItem(i),this.config.showInfo(i))},bindEvents(){this.editor.registerHandler("editor.load-concept@post",(e=>{this.editor.hasConceptModel&&this.fileIO.addFile("concept",e[0],e[1])})),this.editor.registerHandler("editor.load-projection@post",(e=>{this.editor.hasConceptModel&&this.fileIO.addFile("projection",e[0],e[1])})),this.editor.registerHandler("editor.unload-concept@post",(e=>{this.fileIO.removeFile("concept"),this.config.clear()})),this.editor.registerHandler("editor.unload-projection@post",(e=>{this.fileIO.removeFile("projection")})),this.editor.registerHandler("concept-model.updated",(()=>{this.config.clear(),this.editor.hasConceptModel&&this.editor.conceptModel.schema.filter((e=>e.root)).forEach((e=>{this.config.addItem(e)}))}))}};function yt(){const e=$({class:["editor-home-menu"]});let t=W({class:["editor-home-menu-section","editor-home-menu-section--file"]}),i=W({class:["editor-home-menu-section","editor-home-menu-section--config"]});return this.fileIO=xt.call(this),this.config=jt.call(this),t.append(this.fileIO.render(),wt("Files")),i.append(this.config.render(),wt("Configuration")),e.append(t,i),e}function wt(e){return q({class:["title","editor-home-menu-title"]},e)}function xt(e){const t=Object.create(Et,{editor:{value:this.editor}});return t.init(),t}const Et={file:null,title:null,status:null,container:null,mainView:null,infoView:null,files:null,btnLoad:null,btnUnload:null,btnDownload:null,btnEdit:null,selection:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!f(this.selection)},getFile(){return this.file},setFile(e){this.file=e,this.refresh()},refresh(){return this.hasFile?(this.container.classList.remove("empty"),Ue(this.files)):(this.container.classList.add("empty"),Ye(this.files)),this.btnUnload.disabled=!this.hasFile,this.editor.isReady?(Ye(this.placeholder),this.placeholder.classList.remove("error")):this.hasFile?(this.editor.hasConceptModel||(this.placeholder.innerHTML=`${At("Missing projections")}`),this.editor.hasProjectionModel||(this.placeholder.innerHTML=`${At("Missing projections")}`),this.placeholder.classList.add("error"),Ue(this.placeholder)):(this.placeholder.innerHTML=`Add your ${At("concepts")} and ${At("projections")} or load a previously saved ${At("model")}`,this.placeholder.classList.remove("error")),this.hasSelection||Ye(this.infoView),this},render(){this.container=W({class:["editor-file"]});let e=W({class:["drop-area","editor-file-main"]});this.files=G({class:["bare-list","editor-file__list"]}),this.placeholder=U({class:["editor-file-placeholder"],html:`Add your ${At("concepts")}, ${At("projections")} and all other ${At("resources")}`});let t=W({class:["editor-file-actionbar"]});this.btnUnload=he({class:["btn","editor-file-actionbar__button","editor-file-actionbar__btn-remove"],title:"Remove all files",dataset:{action:"unload"}}),t.append(this.btnUnload);let i=W({class:["editor-file__browse"]}),s=Q({class:["editor-file__browse-instruction"]},"Upload your files");return this.btnLoad=he({class:["btn","editor-file__browse-button"],title:"Load file in editor",dataset:{action:"load"}},"Browse"),i.append(s,this.btnLoad),e.append(this.files,this.placeholder,i),this.container.append(t,e),this.bindEvents(),this.refresh(),this.container},clear(){Ie(this.files)},selectItem(e){if(!this.cache.has(e))return null;let t=this.cache.get(e);L(this.selection)&&this.selection.classList.remove("selected"),this.selection=t,this.selection.classList.add("selected"),this.displayInfo(e),this.refresh()},addFile(e,t,i){let s=J({class:["editor-file__list-item",`editor-file__list-item--${e}`],dataset:{context:"menu",action:`open-${e}`,status:"active"}}),n=ie({class:["ico","ico-file","editor-file__list-item-icon"]}),a=Q({class:["editor-file__list-item-type"]},r(t,e)),o=he({class:["editor-file__list-item__btn-remove"],dataset:{action:`unload-${e}`}},ie({class:["ico","ico-delete"],dataset:{ignore:"all"}},"✖"));s.append(n,a,o),this.files.append(s),this.cache.set(e,s),this.refresh()},removeFile(e,t){this.cache.has(e)&&(Ie(this.cache.get(e)).remove(),this.cache.delete(e),this.refresh())},bindEvents(){this.editor.registerHandler("editor.load@post",(e=>{this.editor.hasConceptModel&&this.editor.hasProjectionModel})),this.container.addEventListener("dragenter",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragleave",(e=>{this.container.classList.remove("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("dragover",(e=>{this.container.classList.add("highlight"),e.preventDefault(),e.stopPropagation()}),!1),this.container.addEventListener("drop",(e=>{this.container.classList.remove("highlight");let t=e.dataTransfer.files[0];if(!t.name.endsWith(".json"))return void this.notify("This file is not supported. Please use a .json file");let i=new FileReader;i.onload=e=>{this.editor.load(i.result,this.type)},i.readAsText(t),e.preventDefault(),e.stopPropagation()}),!1)}};function At(e){return ee({class:["text-bf"]},e).outerHTML}function jt(){const e=Object.create(Ct,{editor:{value:this.editor}});return e.init(),e}const Ct={file:null,title:null,status:null,container:null,mainView:null,infoView:null,conceptList:null,selection:null,placeholder:null,cache:null,init(){return this.cache=new Map,this},get hasFile(){return this.cache.size>0},get hasSelection(){return!f(this.selection)},refresh(){return this.hasFile?(this.container.classList.remove("empty"),Ye(this.placeholder),Ue(this.conceptList)):(this.container.classList.add("empty"),Ue(this.placeholder),Ye(this.conceptList)),this.hasSelection||Ye(this.infoView),this},render(){return this.container=W({class:["editor-config"]}),this.mainView=W({class:["editor-config-main"]}),this.infoView=W({class:["editor-config-info"]}),this.conceptList=G({class:["bare-list","editor-config__list"]}),this.placeholder=U({class:["editor-config-placeholder"],html:`${At("No concept found")}. Please upload your files.`}),this.mainView.append(this.conceptList,this.placeholder),this.container.append(this.mainView,this.infoView),this.bindEvents(),this.refresh(),this.container},clear(){Ie(this.conceptList),Ie(this.infoView),this.cache.clear(),this.refresh()},selectItem(e){if(!this.cache.has(e))return null;let t=this.cache.get(e);return L(this.selection)&&this.selection.classList.remove("selected"),this.selection=t,this.selection.classList.add("selected"),this.refresh(),e},showInfo(e){let t=Lt(this.editor.conceptModel.getCompleteModelConcept(e),Ee("#concept-schema"));Ie(this.infoView).append(t),Ue(this.infoView)},addItem(e){let t=Q({class:["loaded-element-name","fit-content"]},e.name),i=J({class:["loaded-element",`loaded-element--${this.type}`],dataset:{context:"menu",action:"open-concept",concept:e.name,status:"active"}}),s=he({class:["btn","file-section__actionbar-button","file-section__actionbar-button--edit"],title:`Reload the ${this.type}`,dataset:{context:"menu",action:"open-concept",concept:e.name}});i.append(t,s),this.conceptList.append(i),this.cache.set(e.name,i),this.refresh()},bindEvents(){}};function Lt(e,t){if(f(e))throw new TypeError("Bad argument: The 'schema' is missing");if(!L(t))throw new TypeError("Bad argument: The given 'template' is not a valid HTML Element");const i=Ae(t);return xe("[data-if]",i).forEach(((t,i)=>{let s=t.dataset.if;y(e,s)||t.remove()})),xe("[data-name]",i).forEach(((t,i)=>{let s=t.dataset.name;t.textContent=e[s]})),xe("[data-attr]",i).forEach(((t,i)=>{let s=t.dataset.attr,[n,r]=s.split(":"),a=(t=>t.startsWith("$")?e[t.substring(1)]:t)(r);delete t.dataset.attr,t.dataset[n]=a})),xe("[data-bind]",i).forEach(((t,i)=>{let s=t.dataset.bind;if(!y(e,s))return;let n=we("[data-item]",t),r=Ee(`#${n.dataset.item}`);e[s].forEach((e=>{n.append(Lt(e,r))}))})),i}function kt(e,t){const{name:i,object:s,id:n}=t,r=J({class:["selector-concept",`selector-concept--${e}`],title:t.getName(),dataset:{concept:n,object:s}});var a=Q({class:["selector-concept-content"]},t.getName());r.append(a),"ancestor"===e&&a.classList.add("fit-content");const o=ie({class:["selector-concept-status"]});if(t.hasError){o.classList.add("error");let e=G({class:["bare-list","selector-concept-status__errors"]});t.errors.forEach((t=>{let i=J({class:["selector-concept-status__error"]},t);i.style.minWidth=`${Math.min(.5*t.length,30)}em`,e.append(i)})),o.append(e),r.classList.add("error")}else o.classList.add("valid"),r.classList.add("valid");return r.append(o),r.addEventListener("mouseenter",(e=>{let t=we(`.projection[data-concept="${n}"]`,this.editor.body);t&&this.editor.highlight(t)})),r.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),r.addEventListener("click",(e=>{let t=we(`.projection[data-concept="${n}"]`,this.editor.body);t&&t.focus()})),r}const It={container:null,title:null,conceptList:null,header:null,body:null,get isRendered(){return L(this.container)},init(e={}){return this.schema=e,this},update(){},refresh(){const{activeInstance:e,activeConcept:t,hasActiveInstance:i,hasActiveConcept:s}=this.editor;if(!i||!s)return Ie(this.conceptList),this;const n=e.concept,r=H();let a=kt.call(this,"root",n);if(r.append(a),n===t&&a.classList.add("selector-concept--active"),n===t)return Ie(this.conceptList).append(r),this;if(!t.hasParent())return Ie(this.conceptList).append(r),this;let o=t.getParent(),l=[];for(;o&&o!==n;)l.unshift(o),o=o.getParent();return l.forEach((e=>{r.append(kt.call(this,"ancestor",e))})),a=kt.call(this,"active",t),r.append(a),Ie(this.conceptList).append(r),this},render(){const e=H();L(this.container)||(this.container=W({class:["editor-breadcrumb"]})),L(this.notification)||(this.notification=W({class:["notification","breadcrumb-notification"]}),e.append(this.notification));const t=Q({class:["breadcrumb-title","hidden"],dataset:{ignore:"all"}},"Breadcrumb");return e.append(t),L(this.conceptList)||(this.conceptList=G({class:["bare-list","selector-concepts"]}),e.append(this.conceptList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.update(),this.refresh(),this.container},bindEvents(){}},St={schema:null,isOpen:!1,visible:!0,btnStart:null,logList:null,init(e){return e&&(this.schema=e),this},get isRendered(){return L(this.container)},add(e,t,i="normal"){if(!Array.isArray(e))return;let s=G({class:["bare-list","log-item-messages"]});e.forEach((e=>s.append(J({class:["log-item-message"]},e))));let n=J({class:["log-item",`log-item--${i}`]}),a=he({class:["btn","btn-delete"],dataset:{action:"delete",target:"parent"}},"✖"),l=Q({class:["log-item__name"],dataset:{action:"delete",target:"parent"}},`${r(t,"Log")} (${h=Date.now(),b(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(f(e))return new Date;if(o(e))return e;var i=new Date(e),s=i.getTime();return Number.isNaN(s)?new Date:t?new Date(s+6e4*i.getTimezoneOffset()):i}(h,!1),"yyyy-mm-dd hh:MM")})`);var h;return n.append(a,l,s),this.logList.append(n),this.refresh(),this},clear(){return Ie(this.logList),this},update(){},render(){const e=H();return L(this.container)||(this.container=W({class:["editor-log"]})),L(this.logList)||(this.logList=G({class:["bare-list","log-list"]}),e.append(this.logList)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this.logList.hasChildNodes()?this.show():this.hide(),this},bindEvents(){}},Ot={container:null,list:null,editor:null,dataList:null,fetch:null,init(e){return this.fetch=e,this},render(){const e=H();return L(this.container)||(this.container=W({class:["container","container--editor-selectors"]})),L(this.list)||(this.list=G({class:["bare-list","editor-selectors","font-ui"]}),e.append(this.list)),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){return this},update(){this.dataList=this.fetch(),Ie(this.list);let e=r(this.editor.getConfig("concept"),{});return this.dataList.forEach((t=>{const{concept:i,accept:s}=t;let n=F({class:["title","editor-selector__title"]},`${r=t.name,y(e,r)?e[r].name:r}`);var r;i&&n.append(Q({class:["editor-selector__title-concept"]},(i.name||i.prototype).replace(" ","-").toLowerCase())),s&&n.append(Q({class:["editor-selector__title-accept"]},s.name)),he({class:["btn","editor-selector__header-button","editor-selector__header-button--info"],title:`View ${t.name||t.type} info`,dataset:{action:"collapse",rel:"parent",target:"selector"}},"i");let a=D({class:["title","editor-selector__header"],title:`Expand/Collapse ${this.type}`},[n]),o=Nt[this.type],l=W({class:["editor-selector__action-bar"]},o.call(this,t)),h=J({class:["editor-selector","collapsed","font-ui"],tabindex:0,dataset:{type:this.type,alias:`${t.name||t.type}`,name:"selector",projection:t.id}},[a,l]);this.list.append(h)})),this.refresh(),this},show(){return Ue(this.container),this},hide(){return Ye(this.container),this},bindEvents(){}},Nt={projection:function(e){const t=H();let i=he({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"edit:projection",id:e.id}},"Edit");return t.append(i),t},value:function(e){const t=H();let i=he({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"create-instance:value",id:e.id}},ie({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),s=he({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],dataset:{action:"copy:value",id:e.id}},ie({class:["ico","ico-copy","btn-content"],dataset:{ignore:"all"}})),n=he({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:value",id:e.id}},ie({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return t.append(n,s,i),t},concept:function(e){const t=H();let i=this.editor.projectionModel.hasProjectionSchema(e),s=he({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--clone"],disabled:!i,title:`Create an instance of "${e.name}"`,dataset:{action:"create-instance",concept:e.name}},ie({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+"));return i||(s.title=`The concept ${e.name} has no projection`),t.append(s),t},resource:function(e){const{name:t,type:i,required:s}=e,n=H();let r=he({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--add"],dataset:{action:"load-resource",id:t}},ie({class:["ico","ico-plus","btn-content"],dataset:{ignore:"all"}},"+")),a=he({class:["btn","editor-selector__action-bar-button","editor-selector__action-bar-button--delete"],dataset:{action:"delete:resource",id:t}},ie({class:["ico","ico-delete","btn-content"],dataset:{ignore:"all"}},"✖"));return this.editor.getResource(t)?n.append(a):n.append(r),n}},Mt={editor:null,valueCount:0,fileCount:0,container:null,title:null,visible:!0,tabs:null,tabConcept:null,tabValue:null,tabProjection:null,tabResource:null,tabConceptNotification:null,tabValueNotification:null,tabProjectionNotification:null,tabResourceNotification:null,activeTab:null,activeTabValue:null,menu:null,header:null,body:null,btnHome:null,btnSave:null,btnClose:null,get isRendered(){return L(this.container)},init(e){return e&&(this.editor=e),this._conceptSelector=function(e,t,i){return Object.create(Ot,{object:{value:"selector"},model:{value:void 0},type:{value:"concept"},editor:{value:t}})}(0,this.editor).init((()=>this.editor.isReady?this.editor.conceptModel.getSchema("concrete").filter((e=>e.root)):[])),this},render(){const e=H();L(this.container)||(this.container=W({class:["editor-header"],dataset:{name:"editor-header",alias:"header"}})),L(this.title)||(this.title=Q({class:["editor-header-title"]},"Gentleman")),L(this.menu)||(this.menu=W({class:["editor-header-left"]},[this.title]));let t=r(this.editor.getConfig("toolbar"),[]),i=W({class:["editor-toolbar"]},t.map((e=>he({class:r(e.class,[]),dataset:{name:e.name,action:e.action}},e.content))));return L(this.btnHome)||(this.btnHome=he({class:["btn","editor-toolbar__button","editor-toolbar__button--home"],title:"Toggle menu",dataset:{action:"home"}}),i.append(this.btnHome)),L(this.header)||(this.header=W({class:["editor-header-menu"]},[this.menu,i]),e.append(this.header)),L(this.body)||(this.body=W({class:["editor-header-main"]}),e.append(this.body)),L(this._conceptSelector.container)||this.body.append(this._conceptSelector.render()),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},refresh(){let e=r(this.editor.getConfig("settings"),!0),t=r(this.editor.getConfig("header"),!0);return this.editor.hasConceptModel?(this._conceptSelector.update(),Ue(this.body)):Ye(this.body),!1===e&&Ye(this.btnHome),!1===t&&Ye(this.body),this},show(e){if(!L(this[e]))return Ue(this.container),this.visible=!0,this;Ue(this[e])},hide(e){if(!L(this[e]))return Ye(this.container),this.visible=!1,this;Ye(this[e])},toggle(){return Ge(this.container),this.visible=!this.visible,this},bindEvents(){}};var Rt=0;const _t={createInstance(e,t,i){if(f(e))return this.notify("The concept is not valid",Ze.ERROR),!1;let s="concept"===e.type?e:this.createConcept(e),n=t;f(n)&&this.hasProjectionModel&&(n=this.createProjection(s).init());let r=Object.create(Vt,{id:{value:"instance"+Rt++},object:{value:"environment"},name:{value:"editor-instance"},type:{value:"instance"},concept:{value:s,writable:!0},projection:{value:n,writable:!0},editor:{value:this}});const a=Object.assign({type:"concept",resize:!0,maximize:!0,close:"DELETE-CONCEPT"},i);return r.init(a),this.addInstance(r),r},getInstance(e){return this.instances.get(e)},addInstance(e){return e.isRendered||this.instanceSection.append(e.render()),this.instances.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.updateActiveInstance(e),this.refresh(),this},removeInstance(e){let t=this.getInstance(e);return!f(t)&&(t===this.activeInstance&&(this.activeInstance=null),t.view&&Ie(t.view).remove(),this.instances.delete(e),this.refresh(),!0)},moveInstance(e,t){return this.instanceSection.children[t].before(e),this},swapInstance(e,t){let i=Array.from(this.instanceSection.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveInstance(t,s),this.moveInstance(e,n),this}},Vt={window:null,container:null,title:null,visible:!0,menu:null,header:null,body:null,btnMaximize:null,btnClose:null,size:1,fullscreen:!1,collapsed:!1,schema:null,ctype:null,get isRendered(){return L(this.container)},init(e={}){return this.ctype=r(e.type,"concept"),this.schema=e,this},setTitle(e){return!m(e)&&(this.title.textContent=e,!0)},collapse(){var e;return e=this.container,L(e)&&e.classList.add(ze),this.collapsed=!0,this.fullscreen=!1,this.size="normal",this.refresh(),this},expand(){var e;return e=this.container,L(e)&&e.classList.remove(ze),this.collapsed=!1,this.refresh(),this},changeSize(e){this.size=e,"fullscreen"===e?(this.fullscreen=!0,this.container.style.removeProperty("width"),this.container.style.removeProperty("height")):this.fullscreen=!1,this.refresh()},show(){return Ue(this.container),this.visible=!0,this},hide(){return Ye(this.container),this.visible=!1,this},toggle(){return Ge(this.container),this.visible=!this.visible,this},refresh(){return this.container.dataset.size=`${this.size}`,f(this.projection)&&(this.body.textContent="No projection found"),Array.from(this.editor.instances).some((e=>e.fullscreen))?this.editor.instanceSection.classList.add("fullscreen"):this.editor.instanceSection.classList.remove("fullscreen"),this},render(){const e=H(),{name:t}=this.concept,i=t.toLowerCase();L(this.container)||(this.container=W({class:["editor-concept",`editor-concept--${this.ctype}`],tabindex:0,dataset:{nature:"concept-container",type:this.ctype,size:1}})),L(this.header)||(this.header=D({title:"concept"===this.schema.type?`Instance of "${i}"`:`Linked instance of "${i}"`,class:["editor-concept-header"]}),e.append(this.header)),L(this.btnClose)||(this.btnClose=he({class:["btn","editor-concept-toolbar__btn-delete"],title:`Delete the instance "${i}"`,dataset:{action:"close",context:this.type,id:this.id}}),"projection"===this.schema.type&&(this.btnClose.title=`Close the linked instance "${i}"`)),L(this.btnMaximize)||(this.btnMaximize=he({class:["btn","editor-concept-toolbar__btn-maximize"],title:`Maximize ${t.toLowerCase()}`,dataset:{action:"maximize",context:this.type,id:this.id}})),this.title=q({class:["title","editor-concept-title","fit-content"],dataset:{nature:"editable",id:this.id}},r(this.schema.title,t));let s=W({class:["editor-concept-toolbar"]},[this.btnMaximize,this.btnClose]);return Ie(this.header).append(this.title,s),this.body&&this.body.remove(),this.projection?this.body=this.projection.render():this.body=U(),e.append(this.body),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),gt(this.container),this.refresh(),this.container},clear(){},actionHandler(e){switch(e){case"collapse":this.collapsed?this.expand():this.collapse();break;case"maximize":this.fullscreen?this.changeSize("normal"):this.changeSize("fullscreen");break;case"close":this.delete()}},delete(){switch(this.schema.close){case"DELETE-CONCEPT":if(!this.concept.delete(!0))return this.editor.notify("The concept could not be deleted",Ze.ERROR),this;break;case"DELETE-PROJECTION":if(this.projection&&!this.projection.delete())return this.notify("The projection could not be deleted",Ze.ERROR),this}Ie(this.container).remove(),this.editor.removeInstance(this.id),this.window&&this.window.removeInstance(this)},bindEvents(){this.container.addEventListener("focusin",(e=>{this.editor.updateActiveInstance(this)}))}};var Pt=0;const Tt={createWindow(e){let t=Object.create(Ht,{id:{value:"window"+Pt++},object:{value:"environment"},name:{value:"editor-window"},type:{value:"window"},editor:{value:this}});return t.refname=e,t.init(),this.addWindow(t),t},getWindow(e){return this.windows.get(e)},findWindow(e){return Array.from(this.windows.values()).find((t=>t.refname===e))},addWindow(e){return e.isRendered||this.body.append(e.render()),this.windows.set(e.id,e),"tab"===this.status.view&&this.status.addView(e),this.refresh(),this},removeWindow(e){let t=this.getWindow(e);return!f(t)&&(t===this.activeWindow&&(this.activeWindow=null),t.view&&Ie(t.view).remove(),this.windows.delete(e),this.refresh(),!0)},moveWindow(e,t){return this.body.children[t].before(e),this},swapWindow(e,t){let i=Array.from(this.body.children);const s=i.indexOf(e),n=i.indexOf(t);return this.moveWindow(t,s),this.moveWindow(e,n),this}},Ht={container:null,title:null,visible:!0,instances:null,menu:null,header:null,body:null,btnClose:null,maxInstance:1,get isRendered(){return L(this.container)},init(e={}){return this.ctype=r(e.type,"concept"),this.schema=e,this.instances=new Set,this},isEmpty(){return 0===this.instances.size},show(){return Ue(this.container),this.visible=!0,this},hide(){return Ye(this.container),this.visible=!1,this},toggle(){return Ge(this.container),this.visible=!this.visible,this},close(){Ie(this.container).remove(),this.editor.removeWindow(this.id)},refresh(){return this.isEmpty()?this.hide():this.show(),this},render(){const e=H();L(this.container)||(this.container=W({class:["editor-window"],tabindex:-1})),L(this.header)||(this.header=D({class:["editor-window-header"]}),e.append(this.header)),L(this.title)||(this.title=q({class:["title","editor-window-title","fit-content"]})),L(this.btnClose)||(this.btnClose=he({class:["btn","editor-window-header__btn-delete"],title:"Close the window",dataset:{action:"close",context:this.type,id:this.id}}));let t=W({class:["editor-window-toolbar"]},[this.btnClose]);return Ie(this.header).append(this.title,t),e.hasChildNodes()&&(this.container.appendChild(e),this.bindEvents()),this.refresh(),this.container},getInstance(e){return f(e)?null:Array.from(this.instances).find((t=>t.id===e))},addInstance(e){if(!f(e)&&!this.instances.has(e))return this.instances.add(e),e.window=this,this.container.append(e.container),this.refresh(),!0},removeInstance(e){if(!f(e)&&this.instances.has(e))return this.instances.delete(e),this.refresh(),!0},actionHandler(e){switch(e){case"close":this.close()}},bindEvents(){}},Dt={modelstatus:null,editorstatus:null,notification:null,views:null,view:"grid",viewContainer:null,viewList:null,viewItem:null,activeViewItem:null,groupList:null,groupItem:null,activeGroupItem:null,visible:!0,container:null,get isRendered(){return L(this.container)},init(){return this.views=new Map,this},show(){return Ue(this.container),this.visible=!0,this},hide(){return Ye(this.container),this.visible=!1,this},toggle(){return Ge(this.container),this.visible=!this.visible,this},updateActiveView(){"tab"===this.view&&(this.editor.instances.forEach((e=>{e!==this.editor.activeInstance&&(e.view.classList.remove("active"),e.hide())})),this.editor.activeInstance.view.classList.add("active"),this.editor.activeInstance.show()),this.editor.refresh()},addView(e){if(f(e))return!1;let t=e.title.textContent,i=ie({class:["ico","ico-delete"]},"✖"),s=he({class:["btn","btn-close"]},i),n=W({class:[`editor-view-${this.view}list-item__content`,"fit-content"]},t),r=J({class:[`editor-view-${this.view}list-item`],title:e.title.textContent},[n,s]);e.view=r,r.addEventListener("click",(t=>{if(function(e){const t=e=>e===r||e===s;return t(e)?e:Ce(e,(e=>t(e)),5)}(t.target)===s){let t=r.previousSibling||r.nextSibling;e.delete(),null===this.editor.activeInstance&&t&&t.click()}else this.editor.updateActiveInstance(e)})),this.tabView.append(r)},changeView(e){if(e===this.view)return this;var t;this.view=e,t=this.viewItem,L(t)&&t.classList.remove(We),this.viewItem=this.views.get(this.view),function(e){L(e)&&e.classList.add(We)}(this.viewItem),Ie(this.editor.viewSection),"tab"===e?(this.tabView=G({class:["bare-list","editor-view-tablist"]}),Ie(this.tabView),this.editor.instances.forEach((e=>{e.expand(),this.addView(e)})),this.editor.viewSection.append(this.tabView)):"grid"===e&&this.editor.instances.forEach((e=>{e.show()})),this.updateActiveView()},addGroup(){J({class:["editor-footer-group"]})},notify(e,t=4500){let i=e;const s="open";if(this.notification.classList.contains(s))return!1;this.notification.appendChild(i),setTimeout((()=>{this.notification.classList.add(s),this.container.classList.add("menu--notifying")}),50),setTimeout((()=>{this.notification.classList.remove(s),this.container.classList.remove("menu--notifying"),setTimeout((()=>{Ie(this.notification)}),500)}),t)},refresh(){const{conceptModel:e}=this.editor;if(this.editor.isReady){if(e.hasError){this.modelstatusBadge.classList.add("error"),this.modelstatusBadge.classList.remove("valid"),this.container.classList.add("error");let t=e.concepts.filter((e=>e.hasError)).length;this.modelstatusInfo.textContent=`${t} ${function(e,t,i){if(1===i)return e;let s="s".split("|");return 1===s.length?e+s[0]:e.substring(0,e.lastIndexOf(s[0]))+s[1]}("error",0,t)}`}else this.modelstatusBadge.classList.add("valid"),this.modelstatusBadge.classList.remove("error"),this.container.classList.remove("error"),Ie(this.modelstatusInfo),this.editor.logs.clear();if(this.editor.hasError){this.editorstatusBadge.classList.add("error"),this.editorstatusBadge.classList.remove("valid"),this.container.classList.add("error");let e=this.editor.errors.length;this.editorstatusInfo.textContent=`${e}`}else this.editorstatusBadge.classList.add("valid"),this.editorstatusBadge.classList.remove("error"),this.container.classList.remove("error"),Ie(this.editorstatusInfo),this.editor.logs.clear()}},render(){const e=H();if(L(this.container)||(this.container=W({class:["editor-statusbar"]})),L(this.badgeContainer)||(this.badgeContainer=W({class:["editor-statusbar-badge-container"]}),e.appendChild(this.badgeContainer)),L(this.modelstatus)||(this.modelstatus=W({class:["editor-statusbar-model"]}),this.modelstatusBadge=ie({class:["editor-statusbar-model-badge"]}),this.modelstatusInfo=W({class:["editor-statusbar-model-info"]}),this.modelstatus.append(this.modelstatusBadge,this.modelstatusInfo),this.badgeContainer.appendChild(this.modelstatus)),L(this.editorstatus)||(this.editorstatus=W({class:["editor-statusbar-global"]}),this.editorstatusBadge=ie({class:["editor-statusbar-global-badge"]}),this.editorstatusInfo=W({class:["editor-statusbar-global-info"]}),this.editorstatus.append(this.editorstatusBadge,this.editorstatusInfo),this.badgeContainer.appendChild(this.editorstatus)),L(this.viewContainer)||(this.viewContainer=W({class:["editor-statusbar-viewer-container"]}),e.appendChild(this.viewContainer)),!L(this.btnGroup)){let e=ie({class:["ico","ico-plus","btn-content"],title:"Add a group",dataset:{ignore:"all"}},"+");this.btnGroup=he({class:["editor-statusbar-viewer__button-add"],dataset:{action:"add-group"}},e)}return L(this.groupContainer)||(this.groupContainer=W({class:["editor-footer-group"]})),L(this.viewList)||(this.viewList=G({class:["bare-list","editor-statusbar-viewers"]}),this.viewContainer.appendChild(this.viewList)),["grid","tab"].forEach((e=>{let t=J({class:["editor-statusbar-viewer"],dataset:{type:"viewer",action:"change-view",value:e}},e);this.views.set(e,t),this.viewList.append(t)})),this.viewItem=this.views.get(this.view),this.viewItem.classList.add("selected"),e.hasChildNodes()&&(this.container.append(e),this.bindEvents()),this.refresh(),this.container},bindEvents(){function e(e,t){let i=te({class:["link","error-message__link"]},e);const s=`.projection[data-concept="${t}"]`;return i.addEventListener("mouseenter",(e=>{let t=we(s,this.editor.body);t&&this.editor.highlight(t)})),i.addEventListener("mouseleave",(e=>{this.editor.unhighlight()})),i.addEventListener("click",(e=>{let t=this.editor.resolveElement(we(s,this.editor.body));t&&t.focus()})),i}this.modelstatus.addEventListener("click",(t=>{if(!this.editor.conceptModel.hasError)return;let i=[];this.editor.conceptModel.concepts.forEach((t=>{t.hasError&&i.push(...t.errors.map((i=>{let s=e.call(this,t.getName(),t.id);return Q({class:["error-message"]},[s,`: ${i}`])})))})),this.editor.logs.clear(),this.editor.logs.add(i,"Validation error",Qe)})),this.editorstatus.addEventListener("click",(e=>{if(!this.editor.hasError)return;let t=[];t.push(...this.editor.errors.map((e=>Q({class:["error-message"]},[`${e.message}`])))),this.editor.logs.clear(),this.editor.logs.add(t,"Validation error",Qe)})),this.editor.registerHandler("editor.instance@active:updated",(()=>{this.updateActiveView()}))}},$t={container:null,isOpen:!1,visible:!0,show(){return Ue(this.container),this.visible=!0,this},hide(){return Ye(this.container),this.visible=!1,this},toggle(){return Ge(this.container),this.visible=!this.visible,this},open(){return this.container.classList.add("open"),this.show(),this.isOpen=!0,this.editor.refresh(),this},close(){return this.container.classList.remove("open"),this.hide(),this.isOpen=!1,this.editor.refresh(),this}};function Bt(){return Object.create(Mt,{object:{value:"environment"},name:{value:"editor-header"},editor:{value:this}})}function zt(){return Object.create(It,{object:{value:"environment"},name:{value:"editor-breadcrumb"},type:{value:"breadcrumb"},editor:{value:this}})}function qt(){return Object.assign(Object.create($t,{object:{value:"environment"},name:{value:"editor-home"},type:{value:"home"},editor:{value:this}}),vt)}function Ft(){return Object.create(Dt,{object:{value:"environment"},name:{value:"editor-status"},type:{value:"status"},editor:{value:this}})}function Wt(){return Object.assign(Object.create($t,{object:{value:"environment"},name:{value:"editor-log"},type:{value:"log"},editor:{value:this}}),St)}const Ut={getHandlers(e){return r(this.handlers.get(e),[])},triggerEvent(e,t,i=!0){const{name:s,options:n,args:r}=e,a=this.getHandlers(s),o=h(t);let l=!1;return a.forEach((e=>{let s=e.call(this,r,n);!1!==s?i&&o&&t.call(this,s):l=!0})),!l&&(!i&&o&&t.call(this),!0)},registerHandler(e,t){return this.hasHanlder(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),!0},unregisterHandler(e,t){if(!this.hasHanlder(e))return!1;let i=this.getHandlers(e);for(let e=0;e<i.length;e++)if(i[e]===t)return i.splice(e,1),!0;return!1},hasHanlder(e){return this.handlers.has(e)},registerReceiver(e,t){console.log("REGISTERING RECEIVER"),f(this.activeReceiver[t])&&(this.activeReceiver[t]=e),f(this.receivers[t])&&(this.receivers[t]={root:e,projections:[]},e.isRoot=!0),this.receivers[t].projections.push(e)},getActiveReceiver(e){return this.activeReceiver[e]},setActiveReceiver(e,t){this.activeReceiver[t]=e},getRootReceiver(e){return this.receivers[e].root},findReceiverInstance(e,t){let i=this.receivers[t].projections;for(let t=0;t<i.length;t++){let s=i[t].instances.get(e);if(L(s))return{container:i[t],instance:s}}alert("Not Found")}},Yt={create(e,t){const i=Object.create(this);return i.concept=e,i.schema=t,i},model:null,schema:null,source:null,id:null,value:null,object:"structure",init(e){throw new Error("This function has not been implemented")}};Object.defineProperty(Yt,"model",{get(){return this.concept.model}}),Object.defineProperty(Yt,"name",{get(){return this.schema.name}}),Object.defineProperty(Yt,"required",{get(){return r(this.schema.required,!0)}});const Gt={object:"attribute",target:null,init(e){return this.target=this.model.createConcept(this.schema.target,{value:r(e,this.schema.value),parent:this.concept,ref:this}),this},getValue(){return this.target.getValue()},hasValue(){return this.target.hasValue()},setValue(e){this.target.setValue(e)},getTarget(){return this.target},copy(){return this.target.hasValue()?this.target.copy(!1):null},clone(){return this.target.hasValue()?this.target.clone():null},export(){return this.target.hasValue()?{id:this.target.id,name:this.target.name}:null},toString(){return{[`attribute.${this.name}`]:this.target.toString()}},toXML(){return this.target.hasValue()?this.target.toXML():""}},Jt=Object.assign(Object.create(Yt),Gt),Xt={attributes:null,attributes_created:null,initAttribute(){return this.attributes=[],this.attributes_created=new Set,this.attributes_updated=new Set,this.attributes_deleted=new Set,Array.isArray(this.attributeSchema)&&this.attributeSchema.filter((e=>r(e.required,!0))).forEach((e=>this.createAttribute(e.name))),this},getAttributes(){return this.attributes},getAttribute(e){if(f(e))throw new TypeError("Bad argument");return this.getAttributeByName(e)},getAttributeSchema(e){if(m(e))throw new TypeError("Bad argument");if(!this.hasAttribute(e))throw new Error(`Attribute '${e}' does not exist`);return w(this.attributeSchema.find((t=>t.name===e)))},getAttributeByName(e){if(m(e))throw new TypeError("Bad argument");var t=this.attributes.find((t=>t.name===e));return f(t)&&(t=this.createAttribute(e)),t},createAttribute(e,t){if(!this.hasAttribute(e))throw new Error(`Attribute not found: The concept '${this.name}' does not contain an attribute named '${e}'`);if(this.isAttributeCreated(e)){let i=this.getAttributeByName(e);if(t){let e=this.model.getValue(t);i.target.initValue(e)}return i}const i=this.getAttributeSchema(e);let s=this.model.getValue(t);var n=Jt.create(this,i).init(s);return this.addAttribute(n),n},addAttribute(e){if(f(e)||"attribute"!==e.object)throw new Error("Bad argument: 'attribute' must be an attribute object");return this.attributes.push(e),this.attributes_created.add(e.name),this.notify("attribute.added",e),this},hasAttributes(){return!a(this.attributeSchema)||!a(this.attributes)},hasAttribute(e){return-1!==this.attributeSchema.findIndex((t=>t.name===e))},isAttributeRequired(e){return r(this.getAttributeSchema(e).required,!0)},isAttributeCreated(e){return this.attributes_created.has(e)},listAttributes(){const e=[];return this.attributeSchema.forEach((t=>{e.push({type:"attribute",name:t.name,target:t.target,accept:t.accept,required:this.isAttributeRequired(name),created:this.isAttributeCreated(name)})})),e},removeAttribute(e){if(this.isAttributeRequired(e))return{message:`The attribute '${e}' is required.`,success:!1};var t=this.attributes.findIndex((t=>t.name===e));if(-1===t)return{message:`The attribute '${e}' was not found.`,success:!1};var i=this.attributes.splice(t,1)[0];return this.attributes_created.delete(e),this.notify("attribute.removed",i),{message:`The attribute '${e}' was successfully removed.`,success:!0}}},Kt={listeners:null,initObserver(){return this.listeners=[],this},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){var t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t,this)}))}},Zt={model:null,schema:null,source:null,id:null,name:null,ref:null,actions:null,operations:null,accept:null,parent:null,references:null,errors:null,value:null,values:null,action:null,shadows:null,watchers:null,kind:"concept",init(e={}){return this.accept=e.accept,this.parent=e.parent,this.ref=e.ref,this.properties=r(this.schema.properties,[]),Array.isArray(e.properties)&&this.properties.push(...e.properties),this.default=r(this.schema.default,null),this.values=r(e.values,r(this.schema.values,[])),this.src=r(this.schema.src,[]),this.constraint=this.schema.constraint,this.watchers=new Map,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},isRoot(){return f(this.parent)},initValue(){throw new Error("This function has not been implemented")},getName(){return this.ref&&"attribute"===this.ref.object?this.ref.name:this.name},getCandidates(){return this.values.forEach((e=>{c(e)&&(e.type="value")})),this.values},getStructure(){return[...this.listAttributes()]},getProperty(e,t){if("refname"===e){if(f(this.ref))return;return this.ref.name}if("name"===e)return this.name;if("value"===e)return this.value;if(!this.hasProperty(e))return;let i=this.properties.find((t=>t.name===e));const{type:s,value:n}=i;return"string"===s?Qt.call(this,n):"number"===s?+n:"boolean"===s?E(n):n},hasProperty(e){return!!["refname","name","value"].includes(e)||-1!==r(this.schema.properties,[]).findIndex((t=>t.name===e))},getConstraint(e){if(this.hasConstraint(e))return this.constraint[e]},hasConstraint(e){return!f(this.constraint)&&(!!f(e)||y(this.constraint,e))},hasParent(){return!this.isRoot()},getParent(e){if(this.isRoot())return null;if(m(e))return this.parent;const t=this.parent;return t.name===e?t:t.getParent(e)},getParentWith(e){if(this.isRoot())return null;if(m(e))return this.parent;const t=this.parent;return t.hasPrototype(e)?t:t.getParentWith(e)},getPrototype(){return f(this.prototype)?null:this.prototype},hasPrototype(e){if(f(this.schema.prototype))return!1;if(f(e))return!0;let t=this.model.getConceptSchema(this.schema.prototype);for(;!f(t);){if(t.name===e)return!0;t=this.model.getConceptSchema(t.prototype)}return!1},getAncestor(e){const t=[];for(var i=this.getParent(e);i;)t.push(i),i=i.getParent(e);return t},getChildren(e){const t=[];return f(e)?this.getAttributes().forEach((e=>{t.push(e.target)})):this.getAttributes().forEach((i=>{i.target.name===e?t.push(i.target):t.push(...i.target.getChildren(e))})),t},getDescendant(e){const t=[];return this.getChildren(e).forEach((i=>{t.push(i),t.push(...i.getDescendant(e))})),t},propagate(e,t,i){this.watchers.has(e)&&this.signal(e,t,i),this.hasParent()&&this.getParent().propagate(e,t,i)},watch(e,t){this.watchers.has(e)||this.watchers.set(e,[]),this.watchers.get(e).push(t)},signal(e,t,i){this.watchers.has(e)&&this.watchers.get(e).forEach((e=>e(t,this)))},unwatch(e,t){if(f(e)||!this.watchers.has(e))return!1;if(!h(t))return this.watchers.delete(e),!0;let i=this.watchers.get(e).findIndex((e=>e===t));return-1!==i&&(this.watchers.splice(i,1),!0)},done(){this.unregisterAll(),this.watchers.clear()},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}this.getChildren().forEach((e=>{e&&e.delete(!0)}));try{this.model.removeConcept(this.id)&&this.notify("delete")}catch(e){return console.error(this),{message:"Concept not found",success:!1}}return{message:`The concept '${this.name}' was successfully deleted.`,success:!0}},copy(e=!0){const t={name:this.name,nature:this.nature};var i=[];return this.getAttributes().forEach((e=>{i.push({name:e.name,value:e.copy(!1)})})),t.attributes=i,e&&this.model.addValue(t),t},clone(){const e={id:this.id,name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.clone()})})),e.attributes=t,e},export(){const e={id:this.id,root:this.isRoot(),name:this.name};var t=[];return this.getAttributes().forEach((e=>{t.push({name:e.name,value:e.export()})})),e.attributes=t,e},toString(){var e={};return this.attributes.forEach((t=>{Object.assign(e,t.toString())})),e},toXML(){let e=this.getName().replace(" ","-");return`<${e} id="${this.id}">`+this.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function Qt(e){if(l(e))return e;const{type:t}=e;switch(t){case"concat":return ti.call(this,e.concat)}}function ei(e,t){const{type:i}=e;return"string"===i?Qt.call(this,e.value):"property"===i?this.getProperty(e.name):t||e}function ti(e,t=""){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");return e.length<2?ei.call(this,e[0]):e.map((e=>ei.call(this,e))).join(t)}const ii=Object.assign(Zt,Kt,Xt);Object.defineProperty(ii,"attributeSchema",{get(){return this.schema.attributes}}),Object.defineProperty(ii,"_prototype",{get(){return this.schema.prototype}}),Object.defineProperty(ii,"hasError",{get(){return this.errors&&!a(this.errors)}});const si={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.default=r(this.schema.default,!0),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){if(f(e))return this.value=this.default,this;if(c(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return!f(this.value)},getValue(){return this.value},setValue(e){let t=c(e)?e.value:e;return 200!==this.validate(t)?{success:!1,message:"Validation failed: The value could not be updated."}:(this.value=E(t),this.notify("value.changed",t),{success:!0,message:"The value has been successfully updated."})},restore(e){const{value:t}=e;this.setValue(t)},update:(e,t)=>!0,getCandidates:()=>[!0,!1],getChildren:e=>[],validate(e){return this.errors=[],l(e)&&["true","false"].includes(e.toLowerCase())||Number.isInteger(e)&&[1,0].includes(e)||[!0,!1].includes(e)?200:400},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}},ni=Object.assign(Object.create(ii),si);function ri(e,t){switch(e){case 400:return{success:!1,message:"The value is not a number."};case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum allowed: ${t.value}.`};case 402:return{success:!1,message:`Minimum allowed: ${t.value}.`};case 404:return{success:!1,message:`Value allowed: ${t.value}.`}}}const ai={nature:"primitive",initValue(e){if(f(e))return this.value=this.default,this;if(c(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},hasValue(){return"number"==typeof this.value&&!isNaN(this.value)},getValue(){return this.hasValue()?+this.value:null},setValue(e){let t=c(e)?e.value:e;const{code:i,ctx:s}=this.validate(t);return this.value!==t&&(this.value=m(t)?null:+t,this.notify("value.changed",t),this.propagate("value.changed",t,this)),200!==i?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},restore(e){const{value:t}=e;this.setValue(t)},getCandidates(){return this.values.forEach((e=>{c(e)&&(e.type="value")})),this.values},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(this.errors=[],isNaN(e)){let e=400;return this.errors.push(ri.call(this,e).message),{code:e}}if(!this.hasConstraint())return{code:200};if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("range"===i){const{min:s,max:n}=t[i];if(s&&+e<s.value){let e=402;return this.errors.push(ri.call(this,e,s).message),{code:e,ctx:s}}if(n&&+e>n.value){let e=403;return this.errors.push(ri.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=t[i];if(e!==s){let e=404;return this.errors.push(ri.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("values")){let t=this.getConstraint("values").map((e=>oi.call(this,e))).flat(),i=!1;for(let s=0;!i&&s<t.length;s++){const n=t[s];i=c(n)?n.value===e:n===e}if(!i){let e=401;return this.errors.push(ri.call(this,e,t).message),{code:e,ctx:t}}}return{code:200}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function oi(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}const li=Object.assign(Object.create(ii),ai),hi={nature:"primitive",reference:null,path:null,init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.path=this.schema.path,this.values=r(this.schema.values,[]),this.constraint=this.schema.constraint,this.errors=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){return f(e)||this.setValue(e.value),this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!m(this.value)},getValue(e=!1){return f(this.value)?null:e?this.reference:this.value},removeValue(){return this.reference&&this.reference.unregister(this),this.reference=null,this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},getReference(){return f(this.reference)?null:this.reference},setValue(e,t=!0){let i=c(e)?e.id:e;return 200!==this.validate(i)?{success:!1,message:"Validation failed: The value could not be updated."}:f(i)||this.value===i?{success:!0,message:"The value has been ignored."}:(this.reference&&this.reference.unregister(this),this.value=i,this.reference=this.model.getConcept(i),f(this.reference)&&t?setTimeout((()=>this.setValue(e,!1)),20):(this.reference.register(this),this.notify("value.changed",this.reference)),{success:!0,message:"The value has been successfully updated."})},getCandidates(){if(f(this.accept))throw new Error("Bad reference: 'accept' property is not defined");var e=ci.call(this,this.accept);return this.path&&di(this,this.path).map((e=>({type:this.accept.type,value:e}))),e},getChildren(e){return f(this.reference)||e&&this.reference.name!==e?[]:[this.reference]},delete(e=!1){if(!e){const{object:e}=this.ref;let t={success:!0};if("concept"===e?t=this.getParent().removeValue(this):"attribute"===e&&(t=this.getParent().removeAttribute(this.ref.name)),!t.success)return t}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(e){return this.errors=[],f(e)||this.model.hasConcept(e)?200:(this.errors.push("This element is not valid"),401)},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function ci(e){const{name:t,scope:i,rel:s}=e;return"parent"===s?this.getParent(i).getChildren(t):"children"===s?this.getChildren(t):this.model.isPrototype(t)?this.model.getConceptsByPrototype(t):this.model.getConcepts(t)}function di(e,t){if(f(t))return e;const{target:i,value:s,rel:n}=t;var r=[];return"parent"===n?r.push(e.getParentWith(i)):"children"===n?r.push(...e.getChildren(i)):"property"===n&&r.push(e.getProperty(i)),r.map((e=>di(e,s))).flat()}const ui=Object.assign({},ii,hi),pi={SUCCESS:200,INVALID_VALUE:401,MIN_CARDINALITY_ERROR:402,MAX_CARDINALITY_ERROR:403,FIX_CARDINALITY_ERROR:404};function mi(e,t){switch(e){case pi.INVALID_VALUE:return{success:!1,message:`Valid values: ${t}`};case pi.MAX_CARDINALITY_ERROR:return{success:!1,message:`Maximum cardinality: ${this.value.length}/${t.value}.`};case pi.MIN_CARDINALITY_ERROR:return{success:!1,message:`Minimum cardinality: ${this.value.length}/${t.value}.`};case pi.FIX_CARDINALITY_ERROR:return{success:!1,message:`Fixed cardinality: ${t.value}.`};case pi.PATTERN_ERROR:return{success:!1,message:"The value is not valid."}}}const gi={nature:"primitive",init(e={}){return this.parent=e.parent,this.ref=e.ref,this.accept=this.schema.accept,this.ordered=r(this.schema.ordered,!0),this.constraint=this.schema.constraint,this.watchers=new Map,this.value=[],this.initObserver(),this.initAttribute(),this.initValue(e.value),this},initValue(e){this.removeAllElement();let t=fi.call(this);if(f(e)){let e=t;for(let t=0;t<e;t++)this.createElement();return this}const{id:i="",name:s,value:n}=e;i.length>10&&(this.id=i);for(let e=0;e<n.length;e++)this.createElement(n[e]);let r=t-n.length;for(let e=0;e<r;e++)this.createElement();return this},hasValue(){return!a(this.value)},getValue(e=!1){const t=this.value.map((e=>this.model.getConcept(e)));return e?t.map((e=>e.getValue())):t},removeValue(e){return this.hasValue()?(this.removeElement(e),{success:!0,message:"The value has been successfully updated."}):{success:!0,message:"The value has been successfully updated."}},isValidElement(e){const{name:t,accept:i}=this.accept;return this.model.isPrototype(t)?f(i)?this.model.hasPrototype(e.name,t):Array.isArray(i)?i.some((t=>t.name===e.name)):i.name===e.name:this.accept.name===e.name},setValue(e){let t=e.value||e;if(Array.isArray(t)){this.removeAllElement();for(let e=0;e<t.length;e++)this.createElement(t[e])}else this.isValidElement(t)&&this.createElement(t)},restore(e){const{value:t}=e;t.forEach(((e,t)=>{this.value.includes(e.id)||this.createElement(e)}))},getElements(){return this.value.map((e=>this.model.getConcept(e)))},getElement(e){var t=this.value.find((t=>t===e));if(!f(t))return this.model.getConcept(t)},getElementAt(e){if(!(e<0||e>=this.value.length))return this.model.getConcept(this.value[e])},getFirstElement(){return this.getElementAt(0)},getLastElement(){return this.getElementAt(this.count-1)},addElement(e){return!f(e)&&(this.value.push(e.id),e.index=this.value.length-1,this.validate(),this.notify("value.added",e),this.propagate("value.changed",e,this),!0)},addElementAt(e,t=0){return f(e)&&(e=this.createElement()),this.value.splice(t,0,e.id),this.validate(),this.notify("value.added",e),this.propagate("value.changed",e,this),this},swapElement(e,t){if(!this.ordered)return this;let i=this.value[e];this.value[e]=this.value[t],this.value[t]=i;let s=this.getElementAt(e);s.index=+e;let n=this.getElementAt(t);return n.index=+t,this.notify("value.swapped",[s,n]),this},removeElement(e){let t=r(e.index,this.value.indexOf(e.id));return-1!==t&&this.removeElementAt(t)},removeElementAt(e){let t=this.getElementAt(e);if(f(t))return{message:`The element at index '${e}' was not found.`,success:!1};t.delete(!0),this.value.splice(e,1);const i=this.getValue();for(let t=e;t<i.length;t++)i[t].index=t;return this.validate(),this.notify("value.removed",t),this.propagate("value.changed",t,this),{message:`The element '${t.name}' was successfully removed.`,success:!0}},removeAllElement(){return this.value.forEach((e=>{this.model.removeConcept(e)})),this.value=[],this.notify("value.changed",this.value),this.propagate("value.changed",this.value,this),this},createElement(e){const t={value:this.model.getValue(e),parent:this,ref:this},i=this.model.createConcept(this.accept,t);return this.addElement(i),i},getProperty(e,t){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e||"cardinality"===e)return this.value.length;let i=this.properties.find((t=>t.name===e));if(f(i))return;const{type:s,value:n}=i;return"string"===s?n:"number"===s?+n:"boolean"===s?E(n):n},hasProperty(e){return!!["refname","name","value","length","cardinality"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){return bi.call(this,this.accept)},getChildren(e){if(!this.hasValue())return[];const t=this.getElements();return f(e)?t:t.filter((t=>t.name===e))},validate(){if(this.errors=[],!this.hasConstraint())return{code:pi.SUCCESS};if(this.hasConstraint("cardinality")){let e=this.getConstraint("cardinality");const{type:t}=e;if("range"===t){const{min:i,max:s}=e[t];if(i&&this.value.length<i.value){let e=pi.MIN_CARDINALITY_ERROR;return this.errors.push(mi.call(this,e,i).message),{code:e,ctx:i}}if(s&&this.value.length>s.value){let e=pi.MAX_CARDINALITY_ERROR;return this.errors.push(mi.call(this,e,s).message),{code:e,ctx:s}}}else if("fixed"===t){const{value:i}=e[t];if(this.value.length!==i){let i=pi.FIX_CARDINALITY_ERROR;return this.errors.push(mi.call(this,i,e[t]).message),{code:i,ctx:e[t]}}}}return{code:pi.SUCCESS}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue().map((e=>e.copy(!1)))};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue().map((e=>e.clone()))}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.value}},toString(){return this.getValue().map((e=>e.toString()))},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue().map((e=>e.toXML())).join("")+`</${e}>`}};function fi(){if(!this.hasConstraint("cardinality"))return 0;const e=this.getConstraint("cardinality"),{type:t}=e;if("range"===t){const{min:i}=e[t];return i.value}if("fixed"===t){const{value:i}=e[t];return i}return 0}function bi(e){return this.model.getConceptSchema(e)}const vi=Object.assign(Object.create(ii),gi);Object.defineProperty(vi,"count",{get(){return this.value.length}}),Object.defineProperty(vi,"canAddValue",{get:()=>!0});const yi=200,wi=405;function xi(e,t){switch(e){case 401:return{success:!1,message:`Valid values: ${t}`};case 403:return{success:!1,message:`Maximum length: ${t.value}.`};case 402:return{success:!1,message:`Minimum length: ${t.value}.`};case 404:return{success:!1,message:`Fixed length: ${t.value}.`};case wi:return{success:!1,message:"The value is not valid."};case 406:return{success:!1,message:"The value is already used."}}}const Ei={nature:"primitive",initValue(e){if(f(e))return this.value=this.default,this;if(c(e)){const{id:t="",value:i}=e;t.length>10&&(this.id=t),this.setValue(i)}else this.setValue(e);return this},restore(e){const{value:t}=e;this.setValue(t)},hasValue(){return!m(this.value)},getValue(){return this.value},removeValue(){return this.value=null,this.notify("value.changed",this.value),{success:!0,message:"The value has been successfully updated."}},setValue(e){let t=c(e)?e.value:e;var{code:i,ctx:s}=this.validate(t);return this.value!==t&&(this.value=t,this.notify("value.changed",t),this.propagate("value.changed",t,this)),i!==yi?{success:!1,message:"Validation failed."}:{success:!0,message:"The value has been successfully updated."}},getProperty(e,t){if("refname"===e)return this.ref.name;if("name"===e)return this.name;if("value"===e)return this.value;if("length"===e)return this.value.length;let i=this.properties.find((t=>t.name===e));if(f(i))return;const{type:s,value:n}=i;return"string"===s?n:"number"===s?+n:"boolean"===s?E(n):n},hasProperty(e){return!!["refname","name","value","length"].includes(e)||-1!==this.properties.findIndex((t=>t.name===e))},getCandidates(){let e=r(this.getConstraint("values"),[]);return a(e)?[...this.src.map((e=>{if("reference"===e.type){const{source:t,target:i}=e;let s=this.model.environment.getModel(t.name||t);if(f(s))return null;let n=s.concept||s;if(!Array.isArray(n))return null;if(n.forEach((e=>{const t=function(e,t){var i=t;const s=[],n=t=>{let i=e.find((e=>e.name===t));if(!f(i))return ft(i)};for(;!f(i);){const e=r(n(i),{});a=e.attributes,Array.isArray(a)&&a.forEach((e=>{const t=s.find((t=>t.name===e.name));f(t)?s.push(e):e.required&&(t.required=e.required)})),i=e.prototype}var a;return{attributes:s}}(n,e.prototype);e.attributes.push(...t.attributes)})),f(i.rel))return n.map((e=>e[i.value]));let a=ji.call(this,i,n);return f(a)?[]:a}if("concept"===e.type){const{concept:t,value:i}=e;let s=this.model.getConceptsByPrototype(t.prototype);return console.log(s),"attribute"===i.type?s.map((e=>e.getAttribute(i.name).getValue())):[]}return e}))].flat().filter((e=>!f(e))):e.map((e=>Ai.call(this,e))).flat().filter((e=>!m(e)))},getChildren:e=>[],update:(e,t)=>!0,validate(e){if(this.errors=[],m(e))return{code:yi};if(!this.hasConstraint())return{code:yi};if(this.hasConstraint("length")){let t=this.getConstraint("length");const{type:i}=t;if("range"===i){const{min:s,max:n}=t[i];if(s&&e.length<s.value){let e=402;return this.errors.push(xi.call(this,e,s).message),{code:e,ctx:s}}if(n&&e.length>n.value){let e=403;return this.errors.push(xi.call(this,e,n).message),{code:e,ctx:n}}}else if("fixed"===i){const{value:s}=t[i];if(e.length!==s){let e=404;return this.errors.push(xi.call(this,e,t[i]).message),{code:e,ctx:t[i]}}}}if(this.hasConstraint("value")){let t=this.getConstraint("value");const{type:i}=t;if("pattern"===i){const{value:i,insensitive:s=!0,global:n=!0}=t.pattern;let r="";if(s&&(r+="g"),n&&(r+="i"),!new RegExp(i,r).test(e)){let e=wi;return this.errors.push(xi.call(this,e,t.pattern).message),{code:e,ctx:t.pattern}}}else if(i==="match".startsWith){const{start:s,end:n}=t[i];if(s&&!e.startsWith<s.value){let e=wi;return this.errors.push(xi.call(this,e,t.match).message),{code:e,ctx:t.match}}if(n&&e.length>n.value){let e=wi;return this.errors.push(xi.call(this,e,t.match).message),{code:e,ctx:t.match}}}else if("unique"===i){const{rel:i="parent",prototype:s}=t.unique;let n=this.getParent(),r=[];if(s?(n.hasPrototype()||(r=[]),r=this.model.getConceptsByPrototype(n._prototype)):r=this.model.getConcepts(n.name),r.some((t=>t!==n&&Li(t,this.ref.name)===e))){let e=406;return this.errors.push(xi.call(this,e,t.unique).message),{code:e,ctx:t.unique}}}}if(this.hasConstraint("values")){let t=this.getConstraint("values").map((e=>Ai.call(this,e))).flat(),i=!1;for(let s=0;!i&&s<t.length;s++){const n=t[s];i=c(n)?n.value===e:n===e}if(!i){let e=401;return this.errors.push(xi.call(this,e,t).message),{code:e,ctx:t}}}return{code:yi}},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.getValue()};return e&&this.model.addValue(t),t},clone(){return{id:this.id,name:this.name,value:this.getValue()}},export(){return{id:this.id,name:this.name,root:this.isRoot(),value:this.getValue()}},toString(){return this.value},toXML(){let e=this.getName();return`<${e} id="${this.id}">`+this.getValue()+`</${e}>`}};function Ai(e){if("reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}if("meta-reference"===e.type){let e=[];return this.model.isPrototype("model concept")&&(e=this.model.getConceptsByPrototype("model concept")),e.map((e=>e.getChildren(this.name))).flat().map((e=>e.value))}return e}function ji(e,t){const{name:i,rel:s,scope:n,value:r}=e;let o=null;if("parent"===s){let e=this.getParent(i);if(f(r))return e;if("reference"===r.type)return ji.call(e,r);if("attribute"===r.type)return e.getAttributeByName(r.name).getValue()}if("children"===s){let e=this.getChildren(i);if(f(r))return e;if("reference"===r.type)return e.map((e=>ji.call(e,r)));if("attribute"===r.type)return e.filter((e=>Ii(e,r.name)&&ki(e,r.name))).map((e=>Li(e,r.name)))}if(e.source){const{type:t,value:i}=e.source;o="reference"===t?ji.call(this,e.source):i}if(f(o))return t.map((e=>e[i].map((e=>e[r]))));if(d(o)&&a(o))return[];let l=t.find((e=>Array.isArray(o)?o.includes(e.name):e.name===o));return f(l)||!y(l,i)?[]:l[i].map((e=>e[r]))}const Ci=(e,t)=>e.getAttributeByName(t).target,Li=(e,t)=>Ci(e,t).getValue(),ki=(e,t)=>Ci(e,t).hasValue(),Ii=(e,t)=>e.isAttributeCreated(t),Si=Object.assign(Object.create(ii),Ei),Oi={nature:"concrete",initValue(e){if(f(e))return!1;const{id:t="",attributes:i=[]}=e;return t.length>10&&(this.id=t),i.forEach((e=>{const{name:t,id:i,value:s}=e;this.createAttribute(t,s)})),!0},restore(e){const{attributes:t}=e;t.forEach((e=>{const{name:t,id:i,value:s}=e;this.isAttributeCreated(t)||this.createAttribute(t,s)}))},hasValue:()=>!0,getValue(){return{name:this.name,attributes:this.getAttributes().map((e=>({name:e.name,value:e.copy(!1)})))}},setValue(e){const{attributes:t=[]}=e;return t.forEach((e=>{const{name:t,id:i,value:s}=e;this.hasAttribute(t)&&this.createAttribute(t,s)})),!0}},Ni=Object.assign(Object.create(ii),Oi),Mi=200;function Ri(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const _i={name:"prototype",nature:"prototype",initValue(e){if(f(e)){if(this.default){let e=this.createConcept(this.default);this.setValue(e)}return this}const{id:t="",value:i}=e;t.length>10&&(this.id=t);let s=null;return i?(s=this.createConcept(i.name,i),this.setValue(s)):e.name&&e.attributes&&(s=this.createConcept(e.name,e),this.setValue(s)),this},getValue(e=!1){return f(this.value)?null:e?this.target:this.value},getTarget(){return this.target},restore(e){const{value:t}=e;if(f(t))return;let i=this.createConcept(t.name,t);this.setValue(i)},setValue(e){let t=e.name||e;if(this.validate(t)!==Mi)return{success:!1,message:"Validation failed: The value could not be updated."};let i=e;if(e&&"concept"===e.object&&y(e,"id")||(i=e.attributes?this.createConcept(t,e):this.createConcept(t)),this.target){let e=this.target.copy(!1);this.target.delete(!0),i.setValue(e)}return this.target=i,this.value=t,this.notify("value.changed",this.getCandidates().find((e=>e.name===this.value))),{success:!0,message:"The value has been successfully updated."}},removeValue(){return f(this.value)||(this.value=null,this.notify("value.changed",this.value)),{success:!0,message:"The value has been successfully updated."}},hasValue(){return!f(this.value)},getCandidates(){return this.candidates||(this.candidates=Vi.call(this,this.schema.accept).map((e=>({type:"meta-concept",name:e.name,concept:Object.create(Pi,{object:{value:"meta-concept"},type:{value:"meta-concept"},name:{value:e.name},model:{value:this.model},schema:{value:e}})})))),this.candidates},getChildren(e){if(!this.hasValue())return[];const t=[];return(f(e)||this.target.name===e)&&t.push(this.target),t},createConcept(e,t){let i=this.model.getValue(t);const s={parent:this,ref:this};i&&(s.value=i);const n=this.model.createConcept(e,s);return n.prototype=this,n},validate(e){if(m(e))return Mi;if(a(this.values))return Mi;var t=!1;for(let i=0;!t&&i<this.values.length;i++){const s=this.values[i];t=c(s)?s.value===e:s===e}if(!t){let e=401;return this.errors.push(Ri.call(this,e).message),e}return Mi},copy(e=!0){if(!this.hasValue())return null;const t={name:this.name,nature:this.nature,value:this.target.copy(!1)};return e&&this.model.addValue(t),t},clone(){let e=null;return this.hasValue()&&(e=this.target.clone()),{id:this.id,name:this.name,value:e}},export(){let e=null;return this.hasValue()&&(e={id:this.target.id,name:this.target.name}),{id:this.id,name:this.name,root:this.isRoot(),value:e}},toXML(){if(!this.hasValue())return"";let e=this.getName();return`<${e} id="${this.id}">`+this.target.attributes.map((e=>e.toXML())).join("")+`</${e}>`}};function Vi(e){const t=this.model.getConcreteConcepts(this.name);return f(e)?t:Array.isArray(e)?t.filter((t=>e.some((e=>e.name===t.name)))):t.filter((t=>e===t.name))}const Pi={getProperty(e,t){if("refname"===e)return this.name;if("name"===e)return this.name;let i=this.properties.find((t=>t.name===e));if(f(i))return;const{type:s,value:n}=i;return"string"===s?n:"number"===s?+n:"boolean"===s?E(n):n},hasPrototype(e){if(f(this.schema.prototype))return!1;let t=this.model.getConceptSchema(this.schema.prototype);for(;!f(t);){if(t.name===e)return!0;t=this.model.getConceptSchema(t.prototype)}return!1}},Ti=Object.assign({},ii,_i);function Hi(e){switch(e){case 401:return{success:!1,message:"The value is not included in the list of valid values."}}}const Di={name:"meta",reference:null,initValue(e){return f(e)||this.setValue(e.value),this},hasValue(){return!m(this.value)},getValue(){return f(this.value)?null:this.value},getProperty(e){const t=this.schema[e];if(c(t)){const e=[];for(const i in t){const s=t[i];e.push(Object.assign({},{name:i},s))}return e}return t},setValue(e){var t=this.validate(e);return 200!==t?{success:!1,message:"Validation failed: The value could not be updated.",errors:[Hi(t).message]}:f(e)||this.value===e?void 0:(this.reference&&this.reference.unregister(this),this.reference=this.model.getConcept(e),this.reference.register(this),this.value=e,this.notify("value.changed",this.reference),{success:!0,message:"The value has been successfully updated."})},getChildren:e=>[],delete(e=!1){if(!e){let e=this.getParent().remove(this);if(!e.success)return e}return this.reference&&this.reference.unregister(this),this.model.removeConcept(this.id),this.notify("delete"),{message:`The concept '${name}' was successfully deleted.`,success:!0}},update(e,t){switch(e){case"delete":this.reference.unregister(this),this.value=null,this.reference=null,this.notify("value.changed",this.reference)}return!0},validate(e){return m(e)||a(this.values),200},export(){return{id:this.id,name:this.name,value:this.value}},toString(){var e=[];return this.value.forEach((t=>{e.push(t.toString())})),e}},$i=Object.assign({},ii,Di);function Bi(e,t){return{object:{value:"concept"},type:{value:"concept"},model:{value:e},name:{value:t.name},base:{value:t.base},schema:{value:t,writable:!0}}}const zi={boolean:(e,t)=>Object.create(ni,Bi(e,t)),number:(e,t)=>Object.create(li,Bi(e,t)),reference:(e,t)=>Object.create(ui,Bi(e,t)),set:(e,t)=>Object.create(vi,Bi(e,t)),string:(e,t)=>Object.create(Si,Bi(e,t)),meta:(e,t)=>Object.create($i,Bi(e,t))},qi={primitive:(e,t)=>zi[t.name](e,t),prototype:(e,t)=>Object.create(Ti,Bi(e,t)),concrete:(e,t)=>Object.create(Ni,Bi(e,t)),derivative:(e,t)=>zi[t.base](e,t)},Fi={createConcept(e,t,i){const{name:s,nature:n}=t,r=qi[n];if(f(r))throw new Error(`Missing handler: The '${s}' concept could not be handled`);const a=r(e,t);if(f(a))throw new Error(`Bad request: The '${s}' concept could not be created`);return a.init(i),f(a.id)&&(a.id=bt.generate()),a}};var Wi=0;const Ui={concepts:null,values:null,listeners:null,get hasError(){return this.concepts.some((e=>e.hasError))},init(e){return this.concepts=[],this.values=[],this.listeners=[],Array.isArray(e)&&(this.values=e,e.filter((e=>e.root)).forEach((e=>{this.createConcept({name:e.name},{value:e})})),this.values=e.filter((e=>e.id.startsWith("value")))),this},done(){return this.concepts.forEach((e=>{e.done()})),this.concepts=[],!0},createConcept(e,t){const i=this.getCompleteModelConcept(e);var s=Fi.createConcept(this,i,t);return this.addConcept(s),s},getConcepts(e){if(d(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.concepts.filter((e=>t(e)))}return this.concepts.slice()},getRootConcepts(){return this.concepts.filter((e=>e.isRoot()))},getConceptsByPrototype(e){return this.concepts.filter((t=>t.hasPrototype(e)))},getConcept(e){if(!l(e)||a(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");return this.concepts.find((t=>t.id===e))},addConcept(e){if(f(e))throw new TypeError("Bad request: The 'concept' argument must be a Concept");return this.concepts.push(e),e.register(this.environment),this},removeConcept(e){if(!c(e)&&!l(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.concepts.findIndex((t=>t.id===e));return-1===t?null:this.concepts.splice(t,1)[0]},hasConcept(e){if(!c(e)&&!l(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");if(a(this.concepts))return!1;let t=e.id||e;return e.name,this.concepts.some((e=>e.id===t))},getValues(e){if(d(e)){const t=Array.isArray(e)?t=>e.includes(t.name):t=>t.name===e;return this.values.filter((e=>t(e)))}return this.values.slice()},getValue(e){return f(e)?null:y(e,"value")||y(e,"attributes")?e:y(e,"id")?this.values.find((t=>t.id===e.id)):this.values.find((t=>t.id===e))},addValue(e){if(f(e))throw new TypeError("Bad request: The 'value' argument must be a Value");return this.values.some((t=>{return s=e,(i=t).name===s.name&&(i.value?i.value===s.value:JSON.stringify(i.attributes)===JSON.stringify(s.attributes));var i,s}))||(e.id="value"+Wi++,this.values.push(e),this.notify("value.added",e)),this},removeValue(e){if(!c(e)&&!l(e))throw new TypeError("Bad request: The 'id' argument must be a non-empty string");var t=this.values.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.values.splice(t,1)[0];return this.notify("value.removed",i),i},register(e){return this.listeners.includes(e)||this.listeners.push(e),!0},unregister(e){let t=this.listeners.indexOf(e);return-1!==t&&(this.listeners.splice(t,1),!0)},unregisterAll(){this.listeners=[]},notify(e,t){this.listeners.forEach((i=>{i.update(e,t)}))},isConcept(e){return!!l(e)&&-1!==this.schema.findIndex((t=>t.name===e))},isConcrete(e){if(!l(e))return!1;const t=this.schema.find((t=>t.name===e));return!f(t)&&"concrete"===t.nature},isPrototype(e){if(!l(e))return!1;const t=this.schema.find((t=>t.name===e));return!f(t)&&"prototype"===t.nature},hasPrototype(e,t){if(!this.isConcept(e))return!1;let i=this.getConceptSchema(e);for(;!f(i);){if(i.prototype===t)return!0;i=this.model.getConceptSchema(i.prototype)}return!1},addConceptSchema(e){let t=e.concept||e;return this.schema.push(...t),this.environment.update("concept-model.updated"),!0},getSchema(e){if(d(e)){const t=Array.isArray(e)?t=>e.includes(t.nature):t=>t.nature===e;return this.schema.filter((e=>t(e)))}return this.schema.slice()},getConceptSchema(e){const t=Ji(this.schema,e);if(!f(t))return ft(t)},getCompleteModelConcept(e){let t=e;l(e)&&(t={name:e});const i=this.getConceptSchema(t.name);if(f(i))return;Object.assign(i,t),y(i,"attributes")||(i.attributes=[]);const s=Yi.call(this,i.prototype);return i.attributes.push(...s.attributes),i},getConcreteConcepts(e){const t=t=>{for(var i=t.prototype;!f(i);){if(i===e)return!0;i=r(Ji(this.schema,i),{}).prototype}return!1},i=this.schema.filter((e=>"concrete"===e.nature));return e?i.filter((e=>t(e))):i},getDerivedConcepts(e){if(f(e))throw new TypeError("Bad argument");return this.schema.filter((t=>t.base===e))},export(){const e=[];return this.getConcepts().forEach((t=>{e.push(t.export())})),e.push(...this.getValues()),e},toString(){return JSON.stringify({[this.root.name]:this.root.toString()})},toXML(){return"<model:gentleman>"+this.getRootConcepts().map((e=>e.toXML())).join("")+"</model:gentleman>"}};function Yi(e){var t=e;const i=[];for(;!f(t);){const e=r(this.getConceptSchema(t),{});s=e.attributes,Array.isArray(s)&&s.forEach((e=>{const t=i.find((t=>t.name===e.name));f(t)?i.push(e):e.required&&(t.required=e.required)})),t=e.prototype}var s;return{attributes:i}}const Gi=[{name:"string",nature:"primitive"},{name:"number",nature:"primitive"},{name:"boolean",nature:"primitive"},{name:"reference",nature:"primitive"},{name:"set",nature:"primitive"}];function Ji(e,t){let i=e.find((e=>e.name===t));return f(i)&&(i=Gi.find((e=>e.name===t))),i}const Xi=[],Ki={createModel(e,t){var i=Object.create(Ui,{schema:{value:r(e,[])},environment:{value:t}});return Xi.push(i),i}};function Zi(e){const{type:t}=e;let i=this.concept||this.source;return"property"===t?r(i.getProperty(e.name),""):"param"===t?this.getParam(e.name):e}const Qi={css:function(e,t){return d(t)?(ns(e,t),e):e},ref:function(e,t){return d(t)?(t.forEach((t=>{const{style:i={}}=r(this.model.getStyleSchema(t),{});i.gss?ts.call(this,e,i):is.call(this,e,i)})),e):e},gss:is,text:ss,box:ls,html:function(e,t){return d(t)?(t.forEach((t=>{let i=`style${s=t.name,m(s)?s:s.charAt(0).toUpperCase()+s.slice(1)}`;var s;e.dataset[i]=Zi.call(this,t.value),"property"===t.value.type&&this.registerHandler("value.changed",(s=>{e.dataset[i]=Zi.call(this,t.value)}))})),e):e}},es={text:ss,box:ls};function ts(e,t){if(!c(t))return e;for(const i in t){const s=t[i];let n=Qi[i];h(n)&&n.call(this,e,s)}return e}function is(e,t){if(!c(t))return e;for(const i in t){const s=t[i];let n=es[i];h(n)&&n.call(this,e,s)}return e}function ss(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"bold":e.style.fontWeight=as(s);break;case"italic":e.style.fontStyle="italic";break;case"underline":e.style.textDecoration="underline";break;case"strikethrough":e.style.textDecoration="line-through";break;case"color":e.style.color=rs(s);break;case"font":e.style.fontFamily=s.toString();break;case"size":e.style.fontSize=os(s);break;case"transform":e.style.textTransform=s}}return e}function ns(e,t){if(Array.isArray(t))e.classList.add(...t);else{let i=t.replace(/\s+/g," ").trim();m(e.className)?e.className=i:ns(e,i.split(" "))}return e}function rs(e){if(f(e))return"";const{type:t,value:i}=e;switch(t){case"rgb":return c(i)?`rgb(${i.red}, ${i.green}, ${i.blue})`:i;case"rgba":return c(i)?`rgba(${i.red}, ${i.green}, ${i.blue}, ${i.opacity/100})`:i;case"name":case"hexadecimal":return i;default:return i||e}}function as(e){if(f(e))return"";const{type:t,value:i}=e;return Number.isInteger(e)?`${e}`:"bold"}function os(e){if(f(e))return"";const{value:t,unit:i}=e;return f(t)?"":`${t}${i}`}function ls(e,t){for(const i in t){const s=t[i];if(!1!==s)switch(i){case"inner":hs.call(this,e,s,"padding");break;case"outer":hs.call(this,e,s,"margin");break;case"border":us.call(this,e,s);break;case"corner":ps.call(this,e,s);break;case"background":cs.call(this,e,s);break;case"width":e.style.width=os.call(this,s);break;case"height":e.style.height=os.call(this,s);break;case"opacity":e.style.opacity=s/100;break;case"shadow":ds.call(this,e,s,"shadow")}}return e}function hs(e,t,i){if(!f(t))for(const s in t){const n=t[s];switch(s){case"all":e.style[`${[i]}`]=os.call(this,n);break;case"top":e.style[`${[i]}Top`]=os.call(this,n);break;case"right":e.style[`${[i]}Right`]=os.call(this,n);break;case"bottom":e.style[`${[i]}Bottom`]=os.call(this,n);break;case"left":e.style[`${[i]}Left`]=os.call(this,n)}}}function cs(e,t){if(f(t))return;const{color:i,image:s}=t;i&&(e.style.backgroundColor=rs.call(this,i)),s&&(e.style.backgroundImage=`url(${s})`)}function ds(e,t){if(f(t))return null;const{offsetX:i,offsetY:s,blur:n,spread:r,inset:a=!1,color:o}=t;if(f(i)||f(s))return null;let l=os.call(this,i),h=os.call(this,s),c=os.call(this,n),d=os.call(this,r),u=rs.call(this,o);e.style.boxShadow=a?`inset ${l} ${h} ${c} ${d} ${u}`.trim():`${l} ${h} ${c} ${d} ${u}`.trim()}function us(e,t){if(!f(t))for(const i in t){const s=t[i];switch(i){case"all":e.style.borderStyle=r(s.type,"solid"),e.style.borderWidth=os.call(this,s.width),e.style.borderColor=rs.call(this,s.color);break;case"top":e.style.borderTopStyle=r(s.type,"solid"),e.style.borderTopWidth=os.call(this,s.width),e.style.borderTopColor=rs.call(this,s.color);break;case"right":e.style.borderRightStyle=r(s.type,"solid"),e.style.borderRightWidth=os.call(this,s.width),e.style.borderRightColor=rs.call(this,s.color);break;case"bottom":e.style.borderBottomStyle=r(s.type,"solid"),e.style.borderBottomWidth=os.call(this,s.width),e.style.borderBottomColor=rs.call(this,s.color);break;case"left":e.style.borderLeftStyle=r(s.type,"solid"),e.style.borderLeftWidth=os.call(this,s.width),e.style.borderLeftColor=rs.call(this,s.color)}}}function ps(e,t){if(f(t))return null;for(const i in t){const s=t[i];switch(i){case"all":e.style.borderRadius=os.call(this,s);break;case"top-left":e.style.borderTopLeftRadius=os.call(this,s);break;case"top-right":e.style.borderTopRightRadius=os.call(this,s);break;case"bottom-right":e.style.borderBottomRightRadius=os.call(this,s);break;case"bottom-left":e.style.borderBottomLeftRadius=os.call(this,s)}}}const ms={init(){throw new Error("This function has not been implemented")},element:null,statusElement:null,attached:null,children:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasError(){return this.source.hasError},get hasAttached(){return!a(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return h(e)?this.attached.filter((t=>e(t))):this.attached},show(){return Ue(this.element),this.visible=!0,this.active=!0,this},hide(){return Ye(this.element),this.visible=!1,this},toggle(){return Ge(this.container),this.visible=!this.visible,this},focus(e){return this.element.contentEditable=!1,this.element.focus(),this.focused=!0,this},getContainer(){return this.element},notify(e,t,i){Je(this.element),this.environment.notify(e,t)},append(e){if(!L(e))throw new TypeError("Bad argument: The 'element' argument must be an HTML Element");return this.element.append(e),this},_focusIn:e=>!1,enable(){return this.disabled=!1,this},disable(){return this.disabled=!0,this},clear:()=>!0,delete(){var e=this.source.delete();e.success?(this.clear(),Ie(this.element),this.element.remove()):(this.environment.notify(e.message),Je(this.element))},spaceHandler(e){return console.warn(`SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){return console.warn(`ESCAPE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},enterHandler(e){this.focusOut()},deleteHandler(e){if(this.projection.element!==this)return Je(e),!1;if(!this.projection.optional)return Je(this.element),!1;let t=Ce(e,(e=>0===e.tabIndex)),i=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),i),this.source.delete();let s=this.environment.resolveElement(t);return f(s)||s.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){return console.warn(`ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()},shiftHandler(e,t){return console.warn(`SHIFT_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1}},gs=Object.assign(ms);function fs(e){if(!L(e))return!1;const{nature:t,id:i}=e.dataset;return"field-component"===t&&i===this.id}const bs={init(){return this.elements=new Map,this},render(){const e=H(),{content:t="Add",items:i}=this.schema;L(this.element)||(this.element=W({id:this.id,class:["field","add-button"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),ts.call(this.projection,this.element,this.schema.style));let s=he({class:["field-action","field--list__add"],tabindex:0,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});return f(i)||(this.item=i),s.append(t),e.appendChild(s),e.hasChildNodes()&&this.element.append(e),this.bindEvent(),this.element},focusIn(){},clickHandler(e){const t=(e=>fs.call(this,e)?e:Ce(e,(e=>fs.call(this,e)),5))(e);if(f(t))return;const{action:i,index:s,name:n}=t.dataset;"add"===i?(this.parent.prio=this.element,this.createElement()):"remove"===i&&this.delete(t.parentElement),this.parent.prio=this.element},createElement(){this.source.createElement()},addItem(e){return this.parent.addItem(e,this),this},removeItem(e){this.parent.removeItem(e)},refresh(){this.element&&this.source.getValue().forEach((e=>{this.addItem(e)}))},focusOut(){},bindEvent(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)}))}},vs=Object.assign(Object.create(gs),bs);function ys(e,t){if(!Array.isArray(t))return!1;e.currentState=null;for(let i=0;i<t.length;i++){const s=t[i],{rule:n,result:r}=s;if(f(n))return r;let a=!1,o=ws[n.type];if(h(o)&&(a=o.call(this,n[n.type])),a)return e.currentState=i,r}return null}const ws={ref:function(e){const{rule:t={}}=r(this.model.getRuleSchema(e),{});let i=ws[t.type];return!!h(i)&&i.call(this,t[t.type])},eq:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return xs.call(this,e[0])==xs.call(this,e[1])},ne:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return xs.call(this,e[0])!=xs.call(this,e[1])},lt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return xs.call(this,e[0])<xs.call(this,e[1])},le:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return xs.call(this,e[0])<=xs.call(this,e[1])},gt:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return xs.call(this,e[0])>xs.call(this,e[1])},ge:function(e){if(!Array.isArray(e))throw new TypeError("Terms need to be an array");if(e.length<2)return null;return xs.call(this,e[0])>=xs.call(this,e[1])},and:function(e){return Es.call(this,e[0])&&Es.call(this,e[1])},or:function(e){return Es.call(this,e[0])||Es.call(this,e[1])},not:function(e){return!Es.call(this,e[0])},no:function(e){let t=xs.call(this,e);return d(t)?a(t):f(t)}};function xs(e,t){if(e&&"property"===e.type){const{name:t}=e;let i=`get${x(t)}`;return this[i]?this[i]():this[t]}if(e&&"param"===e.type){const{name:t}=e;return this.projection.getParam(t)}if(c(e)){let t=`get${x(e.prop)}`;return this[t]?this[t]():this[e.prop]}return t||e}function Es(e){let t=ws[e.type];return h(t)?t.call(this,e[e.type]):E(xs.call(this,e))}function As(e){const{type:t}=e;return"property"===t?(this.hasProperty=!0,r(this.source.getProperty(e.name),"")):"param"===t?this.projection.getParam(e.name):"html"===t?O(e.html):"raw"===t?O(e.raw):e}const js={input:null,label:null,value:"",state:null,init(){const{focusable:e=!0}=this.schema;return this.focusable=e,this.children=[],this},refresh(){if(r(ys.call(this,this.schema,this.schema.state),this.schema),this.schema.state){let e=this.schema.state[this.getValue().toString()];if(e&&e.content){const{style:t,content:i,value:s}=e;let n=H();i.forEach((e=>{n.append(Zn.call(this,e))})),Ie(this.label).append(n),ts.call(this.projection,this.label,t)}}this.input.checked?this.element.dataset.state="on":this.element.dataset.state="off",this.hasError?(this.element.classList.add("error"),this.input.classList.add("error")):(this.element.classList.remove("error"),this.input.classList.remove("error"))},render(){const e=H(),{checkbox:t}=this.schema;var i;if(L(this.element)||(this.element=(i=this.id,W({id:i,class:["field","field--binary"],tabindex:-1,dataset:{nature:"field",view:"binary",id:i}})),this.readonly&&this.element.classList.add("readonly"),ts.call(this.projection,this.element,this.schema.style)),!L(this.input)){if(this.input=function(e){return se({id:`checkbox${e}`,type:"checkbox",class:["field--binary__input"],tabindex:0,dataset:{nature:"field-component",view:"binary",id:e}})}(this.id),this.input.checked=this.source.getValue(),this.value=this.input.checked,this.readonly&&(this.input.classList.add("readonly"),this.input.disabled=!0),t){const{style:e}=t;ts.call(this.projection,this.input,e)}else Ye(this.input);e.append(this.input)}if(!L(this.label)){if(this.label=re({class:["field--checkbox__label"],for:this.input.id,tabindex:0,dataset:{nature:"field-component",view:"binary",id:this.id}}),this.label.htmlFor=this.input.id,t&&t.label){const{content:e}=t.label;if(Array.isArray(e))e.forEach((e=>{let t=As.call(this,e),i=Q({class:["field--checkbox__label-content"],dataset:{ignore:"all"}},t);ts.call(this.projection,i,e.style),this.label.append(i)}));else{let t=As.call(this,e);this.label.append(t)}ts.call(this.projection,this.label,t.label.style)}e.append(this.label)}return e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.value=this.input.checked,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.hasChanges()&&this.setValue(this.input.checked),this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.choice&&Ye(this.choice),this.input.blur(),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!==this.input.checked},hasValue(){return this.input.checked},getValue(){return this.input.checked},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||this.environment.notify(i.message,"error"),this.input.checked=e,this.value=e,this.refresh()},getCandidates(){return this.source.getCandidates()},enable(){this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1},disable(){this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0},escapeHandler(e){let t=!0;if(this.messageElement&&!tt(this.messageElement)&&(Ye(this.messageElement),t=!1),t){let t=Ce(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}},backspaceHandler(e){return this.arrowHandler("left",e)},enterHandler(e){this.setValue(!this.input.checked,!0)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,this.element)},bindEvents(){this.element.addEventListener("change",(e=>{this.setValue(this.getValue(),!0)})),this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},Cs=Object.assign(Object.create(gs),js);function Ls(e){const t=e=>e.parentElement===this.choices;return t(e)?e:Ce(e,t,5)}function ks(e){const{type:t}=e.dataset;return t}function Is(e){const{type:t,value:i}=e.dataset;return"concept"===t?this.values.find((e=>e.id===i)).id:"meta-concept"===t?this.values.find((e=>e.name===i)).name:"value"===t?i:"placeholder"===t?null:i}const Ss=(e,t)=>"concept"===e.type?Ss(e.id,t):"concept"===t.type?Ss(e,t.id):"meta-concept"===e.type?Ss(e.name,t):"meta-concept"===t.type?Ss(e,t.name):e===t,Os={value:null,placeholder:null,expanded:null,values:null,choices:null,input:null,items:null,selection:null,selectList:null,selectListValue:null,icoToggle:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0,placeholder:i=!1,expanded:s=!0}=this.schema;return this.items=new Map,this.focusable=t,this.expanded=s,this.placeholder=i,this.children=[],y(this.schema,"choice")||(this.schema.choice={}),y(this.schema.choice,"option")||(this.schema.choice.option={}),this},hasChanges(){return this.value!=this.source.getValue()},reset(){this.source.removeValue()},hasValue(){return!f(this.value)},getValue(){return this.selection},setValue(e,t=!1){var i=null;if(t)return(i=this.source.setValue(e)).success||this.environment.notify(i.message,Ze.ERROR),!0;f(e)?(this.selection&&this.selection.classList.remove("selected"),this.expanded||Ie(this.selectListValue),this.selection=null):this.setChoice(e),f(e)?this.value=null:"concept"===e.type?this.value=e.id:"meta-concept"===e.type?this.value=e.name:this.value=e;const{template:s={}}=this.schema.choice.option;if(this.selection&&!this.expanded&&e)if(Ie(this.selectListValue),"meta-concept"===e.type){let t=this.model.getProjectionSchema(e.concept,r(s.tag))[0],i=t.type,n={type:i,[i]:t.content||t.projection},a=Zn.call(this,n,e.concept,{focusable:!1,meta:e.name});this.selectListValue.append(a)}else if("concept"===e.type){let t=this.model.createProjection(e,s.tag).init({focusable:!1});t.readonly=!0,t.focusable=!1,t.parent=this.projection,this.selectListValue.append(t.render())}else this.selectListValue.append(e.toString());this.refresh()},refresh(){return this.hasValue()?(this.element.classList.remove("empty"),this.element.dataset.value=this.value.name||this.value):(this.element.classList.add("empty"),this.element.dataset.value="",!this.expanded&&this.placeholder&&Ie(this.selectListValue).append(this.placeholder)),this.input&&(this.element.dataset.input=this.input.value),this.element.classList.remove("querying"),this.hasError?(this.element.classList.add("error"),this.input&&this.input.classList.add("error")):(this.element.classList.remove("error"),this.input&&this.input.classList.remove("error")),this},render(){const e=H(),{choice:t,input:i,style:s}=this.schema;if(L(this.element)||(this.element=W({id:this.id,class:["field","field--choice"],tabindex:-1,dataset:{nature:"field",view:"choice",input:"",id:this.id}})),!L(this.input)&&i){const{placeholder:t="",type:s,style:n}=i;let a=Gn.call(this,t);this.input=se({class:["field--choice__input"],type:r(s,"text"),placeholder:a,title:a,dataset:{nature:"field-component",view:this.type,id:this.id}}),ts.call(this,this.input,n),e.append(this.input)}if(!L(this.choices)){const{style:i}=t;this.choices=G({class:["bare-list","field--choice__choices"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),ts.call(this,this.choices,i),e.append(this.choices)}if(!this.expanded){let t=W({class:["field--choice__select-wrapper"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}});this.selectListValue=W({class:["field--choice__select-value"],tabindex:-1,dataset:{nature:"field-component",view:"choice",id:this.id}}),this.icoToggle=ie({class:["field--choice__select-icon"],dataset:{nature:"field-component",view:"choice",id:this.id}}),t.append(this.selectListValue,this.icoToggle),this.selectList=W({class:["field--choice__select-list","hidden"],dataset:{nature:"field-component",view:"choice",id:this.id}}),this.input&&this.selectList.append(this.input),this.selectList.append(this.choices),e.append(t),e.append(this.selectList)}if(ts.call(this,this.element,s),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),Ie(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let t=J({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(t),ts.call(this,t,e)}return this.values=this.source.getCandidates(),this.values.forEach((e=>{this.choices.append(this.createChoiceOption(e))})),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},focus(e){if(this.expanded)if(this.choices.hasChildNodes()){let e=function(e){for(let t=0;t<e.children.length;t++){const i=e.children[t];if(!tt(i))return i}return null}(this.choices);e&&e.focus()}else this.input&&!tt(this.input)?this.input.focus():this.selection&&this.selection.focus();else this.input&&!tt(this.input)?this.input.focus():this.selectListValue.focus();return this.element.classList.add("active"),this},navigate(e,t,i){let s=null;if("up"===e?s=pt(this.element):"down"===e?s=ct(this.element):"left"===e?s=ut(this.element):"right"===e&&(s=dt(this.element)),f(s))return!1;s.focus()},focusIn(){this.focused=!0,this.element.classList.add("active");const e=H();return this.source.getCandidates().filter((e=>!this.values.some((t=>Ss(t,e))))).forEach((t=>{e.append(this.createChoiceOption(t)),this.values.push(t)})),this.choices.append(e),this.expanded||(Ue(this.selectList),this.selectList.dataset.state="open"),this},focusOut(){if(this.readonly)return;this.input&&m(this.input.value)&&(this.input.value=""),this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.input&&this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("querying");const{children:e}=this.choices;for(let t=0;t<e.length;t++){const i=e[t];Ue(i),i.hidden=!1}return this.expanded||(Ye(this.selectList),this.selectList.dataset.state="close"),this.focused=!1,this},showChoices(){const{children:e}=this.choices;for(let t=0;t<e.length;t++){const i=e[t];Ue(i),i.hidden=!1}},enable(){return this.input&&(this.input.disabled=!1,this.input.tabIndex=0),this.disabled=!1,this},disable(){return this.input&&(this.input.disabled=!0,this.input.tabIndex=-1),this.disabled=!0,this},filterChoice(e){const{children:t}=this.choices;if(this.element.dataset.input=e.trim(),m(e)){for(let e=0;e<t.length;e++){const i=t[e];Ue(i),i.hidden=!1}return}this.element.classList.add("querying");let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e];let n=s.textContent.toLowerCase(),r=n.replace(/[_-]+/g," ").replace(/\s+/g,"").trim();i.some((e=>n.includes(e)||r.includes(e)))?(Ue(s),s.hidden=!1):(Ye(s),s.hidden=!0)}return!0},createChoiceOption(e){const{template:t={},style:i}=this.schema.choice.option,s=c(e),n=J({class:["field--choice__choice"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:s?"concept":"value",value:s?e.id:e}});if(ts.call(this,n,i),this.items.set(e.id,n),"meta-concept"===e.type){let i=this.model.getProjectionSchema(e.concept,r(t.tag))[0],s=i.type,a={type:s,[s]:i.content||i.projection},o=Zn.call(this,a,e.concept,{focusable:!1,meta:e.name});n.dataset.type="meta-concept",n.dataset.value=e.name,n.append(o)}else if(s){if(!this.model.hasProjectionSchema(e,t.tag))return n;let i=this.model.createProjection(e,t.tag).init({focusable:!1});i.readonly=!0,i.focusable=!1,i.parent=this.projection,n.append(i.render())}else n.append(e.toString());return n},setChoice(e){const{children:t}=this.choices;let i=!1;for(let s=0;s<t.length;s++){const n=t[s];let r=Is.call(this,n);r&&Ss(r,e)?(n.classList.add("selected"),n.dataset.selected="selected",this.selection=n,Ue(n),i=!0):(n.classList.remove("selected"),delete n.dataset.selected)}return this},delete(){if(this.hasValue())this.reset();else{let e=this.source.delete();e.success?(this.clear(),Ie(this.element),this.element.remove()):(this.environment.notify(e.message),Je(this.element))}},_spaceHandler(e){let t=this.source.getCandidates();if(a(t))return void this.notify("No candidates found.",Ze.INFO);const i=H();if(t.forEach((e=>{i.append(this.createChoiceOption(e))})),Ie(this.choices),this.placeholder){const{style:e}=this.schema.choice.option;let t=J({class:["field--choice__choice","field--choice__choice--placeholder"],tabindex:0,dataset:{nature:"field-component",view:"choice",id:this.id,type:"placeholder"}},this.placeholder);this.choices.append(t),ts.call(this,t,e)}this.choices.append(i),this.filterChoice(this.input.value),Ue(this.choices),this.element.classList.add("querying")},escapeHandler(e){let t=!0;if(this.messageElement&&!tt(this.messageElement)&&(Ye(this.messageElement),t=!1),!this.expanded&&"open"===this.selectList.dataset.state)return Ye(this.selectList),this.selectList.dataset.state="close",!0;if(t){let t=Ce(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}this.focus()},enterHandler(e){const t=Ls.call(this,e);L(t)&&this.selection!==t&&("placeholder"===ks(t)?this.source.removeValue():this.setValue(Is.call(this,t),!0),this.expanded||(Ye(this.selectList),this.selectList.dataset.state="close",this.focus()))},backspaceHandler(e){Ls.call(this,e)&&this.input&&this.input.focus()},clickHandler(e){const t=Ls.call(this,e);L(t)&&this.selection!==t?("placeholder"===ks(t)?this.source.removeValue():this.setValue(Is.call(this,t),!0),this.expanded||(Ye(this.selectList),this.selectList.dataset.state="close")):e===this.selectListValue&&(Ue(this.selectList),this.selectList.dataset.state="open")},arrowHandler(e,t){if(!L(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);if(!this.expanded&&t===this.selectListValue)return this.arrowHandler(e,this.selectListValue.parentElement);let n=Ls.call(this,t);if(n){let t=ht(n,e,this.choices,!1);return L(t)?(t.focus(),!0):this.arrowHandler(e,this.choices)}if(this.expanded&&i!==this.element)return s();let r=ht(t,e,i,!1);return L(r)?(r===this.selectList&&(r=this.input||this.choices),r===this.choices&&this.choices.hasChildNodes()&&("up"===e?r=pt(this.choices):"down"===e?r=ct(this.choices):"left"===e?r=ut(this.choices):"right"===e&&(r=dt(this.choices))),r.focus(),!0):s()},bindEvents(){L(this.input)&&this.element.addEventListener("input",(e=>{this.filterChoice(this.input.value)})),this.projection.registerHandler("value.changed",((e,t)=>{this.setValue(e)}))}},Ns=Object.assign(Object.create(gs),Os),Ms={init(){return this},render(){const e=H(),{content:t,markers:i,marker:s,self:n}=this.schema;var r=new DOMParser;return L(this.element)||(this.element=W({id:this.id,class:[],dataset:{nature:"field",view:"dynamic",id:this.id}})),L(this.content)||(this.content=r.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),f(this.place)&&(this.place=this.content.querySelector("[data-"+s+"]")),f(this.markers)&&(this.markers=new Map,this.content.querySelectorAll("[data-"+s+"]").forEach((e=>{let t=e.getAttribute("data-"+s);f(this.markers.get(t))?this.markers.set(t,[e]):this.markers.set(t,this.markers.get(t).concat([e]))}))),f(this.aliases)&&(this.aliases=new Map,i.forEach((e=>{let t=[];e.aliases.forEach((e=>{let i=this.markers.get(e.mv);const s=[];i.forEach((t=>{const i={};i.target=t;let n=[];e.props.forEach((e=>{const i={};i.property=e.props,i.value=e.value,f(t.style)||f(t.style[e.props])?i.default=t[e.props]:i.default=t.style[e.props],n.push(i)})),i.impacts=n,s.push(i)})),t.push(s)})),this.aliases.set(e.mv,t)}))),f(this.self)&&!a(n)&&(this.self=[],n.forEach((e=>{const t={};t.property=e,f(this.place.style[e])?t.default=this.place[e]:t.default=this.place.style[e],this.self.push(t)}))),e.hasChildNodes()&&this.element.appendChild(e),this.update=this.refresh,this.clear=this.clean,this},refresh(e){let t=this.aliases.get(e.toString());f(t)||t.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{f(e.target[t.property])?e.target.style[t.property]=t.value:e.target[t.property]=t.value}))}))})),f(this.self)||this.self.forEach((t=>{f(this.place.style[t.property])?this.place[t.property]=e:this.place.style[t.property]=e}))},clean(e){let t=this.aliases.get(e);f(t)||t.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{f(e.target.style[t.property])?e.target[t.property]=t.default:e.target.style[t.property]=t.default}))}))})),f(this.self)||this.self.forEach((e=>{f(this.place.style[e.property])?this.place[e.property]=e.default:this.place.style[e.property]=e.default}))}},Rs=Object.assign(Object.create(gs),Ms),_s={content:"",init(e){return this.transform=e,this},render(){const e=H(),{content:t,source:i,marker:s,markers:n,dd:r,sd:o,self:l}=this.schema;var h=new DOMParser;if(L(this.element)||(this.element=W({id:this.id,class:[],dataset:{nature:"field",view:"interactive",id:this.id}})),L(this.content)||(this.content=h.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),f(this.place)&&(this.place=this.content.querySelector("[data-"+i.marker+"]")),!L(this.field)&&!f(i.tag))switch(i.type="external",this.field=Zn.call(this,i,null,this.args),this.field.type){case"text":let e=this.field.element.querySelector(".field--textbox__input");e.classList.remove("field--textbox__input"),e.classList.add("field--svg__input");break;case"choice":let t=100/this.field.choices.childNodes.length,i=t-10,s=this.field.element.querySelector(".bare-list");s.style.width="inherit",s.style.height="inherit",this.field.element.querySelectorAll(".field--choice__choice").forEach((e=>{e.style.width=t+"%",e.style["font-size"]=i+"%"}));break;case"binary":let n=this.field.element;if(n.style.display="flex",n.style.border="1px solid black",""!==this.field.label.innerHTML){let e=this.field.element.querySelector(".field--checkbox__label");e.style.width="75%",e.style["font-size"]="70%",this.field.element.querySelector(".field--binary__input").style.width="25%"}}return!f(this.self)||a(l)||f(l)||(this.self=[],l.forEach((e=>{const t={};t.property=e,f(this.place.style[e])?t.default=this.place[e]:t.default=this.place.style[e],this.self.push(t)}))),!f(this.sd)||a(o)||f(o)||(this.sd=new Map,o.forEach((e=>{e.type="template";var t=Zn.call(this,e,null,this.args);this.sd.set(t.mv,t)}))),!f(this.dd)||a(r)||f(r)||(this.dd=[],r.forEach((e=>{e.type="template";var t=Zn.call(this,e,null,this.args);this.dd.push(t);var i=this.content.querySelector("[data-"+e.marker+"]");f(i)?this.content.appendChild(t.content):i.appendChild(t.content)}))),L(this.foreign)||(this.foreign=this.createForeign()),e.hasChildNodes()&&this.element.appendChild(e),this.initValue=this.update,this.bindEvents(),this.element},createForeign(){let e,t,i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");if(f(this.place.getAttribute("width"))?i.setAttribute("width",30):i.setAttribute("width",this.place.getAttribute("width")),f(this.place.getAttribute("height"))?i.setAttribute("height",15):i.setAttribute("height",this.place.getAttribute("height")),e=f(this.place.getAttribute("x"))?Number(this.place.getAttribute("cx")):Number(this.place.getAttribute("x")),t=f(this.place.getAttribute("y"))?Number(this.place.getAttribute("cy")):Number(this.place.getAttribute("y")),"text"===this.place.tagName||"ellipse"===this.place.tagName){let i,s,n,r=this.place.getBBox();switch(i=0===r.width?30:r.width,s=0===r.height?15:r.height,f(this.place.style["text-anchor"]),n=this.place.getAttribute("text-anchor"),f(n)&&(n="middle"),n){case"middle":e-=i/2;break;case"end":e-=i}t-=s}return i.setAttribute("x",e),i.setAttribute("y",t),i.classList.add("field--svg__foreign"),i.appendChild(this.field.element),f(this.place.getAttribute("transform"))||i.setAttribute("transform",this.place.getAttribute("transform")),i},selfUpdate(){let e;f(this.aliases)||(e=this.aliases.get(this.value)),f(e)||e.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{f(e.target[t.property])?e.target.style[t.property]=t.value:e.target[t.property]=t.value}))}))})),f(this.self)||this.self.forEach((e=>{f(this.place.style[e.property])?this.place[e.property]=this.value:this.place.style[e.property]=this.value}))},clear(){let e;f(this.aliases)||(e=this.aliases.get(this.value)),f(e)||e.forEach((e=>{e.forEach((e=>{e.impacts.forEach((t=>{f(e.target.style[t.property])?e.target[t.property]=t.default:e.target.style[t.property]=t.default}))}))})),f(this.self)||this.self.forEach((e=>{f(this.place.style[e.property])?this.place[e.property]=e.default:this.place.style[e.property]=e.default}))},updateStatics(){if(!f(this.sd)){let e=this.sd.get(this.value);f(e)||this.content.appendChild(e.content)}},clearStatics(){if(!f(this.sd)){let e=this.sd.get(this.value);f(e)||e.content.parentNode.removeChild(e.content)}},updateDynamics(e){f(this.dd)||this.dd.forEach((t=>{t.update(e)}))},clearDynamics(e){f(this.dd)||this.dd.forEach((t=>{t.clear(e)}))},update(e){f(this.value)||(this.clearStatics(),this.clearDynamics(this.value),this.clear()),""===e?this.value=this.attributeName:f(this.property)?this.value=e:this.value=this.translateProperty(e),this.selfUpdate(),this.updateDynamics(this.value),this.updateStatics()},bindEvents(){this.place.addEventListener("click",(e=>{this.place.replaceWith(this.foreign),this.field.focus(),this.parent.setIndex(this)}))},getContent(){return L(this.content)||(this.content=parser.parseFromString(content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement),this.content},arrowHandler(e,t){return this.parent.arrowHandler(e,this)},focus(){this.focusIn()},focusIn(){this.place.replaceWith(this.foreign),this.field.focus()},focusOut(){this.foreign.replaceWith(this.place),""===this.field.value?this.update(this.attributeName):this.update(this.field.value)},translateProperty(e){let t,i=new Map;return this.property.forEach((s=>{switch(s.type){case"affectation":i.set(s.target,this.translateProc(s.proc,i,e));break;case"result":return t=this.translateProc(s.proc,i,e),t.value}})),t.value},translateProc(e,t,i){let s={};const n={};let r;switch(e.type){case"filter":let a;if(r=t.get(e.target),"V"===e.order[0]?(s.value=i,s.type=this.source.name):s=t.get(e.order[0]),"string"===s.type){a="";for(let e=0;e<s.value.length;e++){const t={type:"string"};t.value=s.value.charAt(e),this.evaluate(r,t)&&(a+=s.value.charAt(e))}}else a=[],s.value.forEach((e=>{this.evaluate(r,e)&&a.push(e)}));return n.type=s.type,n.value=a,n;case"lenght":return n.type="int","V"===e.target?(s.value=i,s.type=this.source.name):s=t.get(e.target),n.value=s.value.length,n;case"check":return r=t.get(e.pred),n.type="bool","V"===e.param?(s.value=i,s.type=this.source.name):s=t.get(e.param),n.value=this.evaluate(r,s),n;case"pred":return e}},evaluate(e,t){switch(e.vars.value=t.value,e.op){case"!=":return e.vars.name===e.order[0]?t.value!==e.order[1]:t.value!=e.order[0];case"=":return e.vars.name===e.order[0]?t.value===e.order[1]:t.value===e.order[0];case"<=":return e.vars.name===e.order[0]?t.value<=e.order[1]:t.value<=e.order[0];case"<":return e.vars.name===e.order[0]?t.value<e.order[1]:t.value<e.order[0];case"<=":return e.vars.name===e.order[0]?t.value<=e.order[1]:t.value<=e.order[0];case">":return e.vars.name===e.order[0]?t.value>e.order[1]:t.value>e.order[0];case"function":return window[proc.fun](...proc.args)}}},Vs=Object.assign(Object.create(gs),_s),Ps={content:[{type:"static",static:{type:"text",content:"+",focusable:!1}}]};function Ts(e){if(!L(e))return!1;const{nature:t,id:i}=e.dataset;return"field-component"===t&&i===this.id}function Hs(e){const t=e=>e.parentElement===this.list;return t(e)?e:Ce(e,t,3)}const Ds={list:null,items:null,elements:null,selection:null,content:null,init(e){const{focusable:t=!0}=this.schema;return this.items=new Map,this.elements=new Map,this.children=[],this.focusable=t,y(this.schema,"list")||(this.schema.list={item:{}}),this},hasChanges:()=>!1,hasValue(){return this.items.size>0},getValue(){return this.list.children},setValue(e,t=!1){t&&this.source.setValue(e),this.list&&(Ie(this.list),e.forEach((e=>{var t=this.createItem(e);this.list.append(t)}))),this.refresh()},clear(){this.items.clear(),this.list&&Ie(this.list)},focus(e){if(this.hasValue()&&this.list)this.list.firstElementChild.focus();else{let e=ct(this.element,(e=>e!==this.list));if(!L(e))return this;e.focus()}return this},navigate(e,t,i){let s=null;if("up"===e?s=pt(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"down"===e?s=ct(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"left"===e?s=ut(this.element,(e=>e!==this.notification&&e.hasChildNodes())):"right"===e&&(s=dt(this.element,(e=>e!==this.notification&&e.hasChildNodes()))),!L(s))return!1;let n=this.environment.resolveElement(s);return!f(n)&&(n.focus(),!0)},focusIn(e){this.focused=!0,this.element.classList.add("active");const{component:t}=e.dataset},focusOut(){if(!this.readonly)return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},createElement(){return this.source.createElement()},getItem(e){return f(e)?null:y(e,"id")?this.items.get(e.id):this.items.get(e)},getItemIndex:e=>L(e)?e.dataset.index:null,createItem(e){const{template:t={},style:i}=this.schema.list.item;if(!this.model.hasProjectionSchema(e,t.tag))return"";let s=this.model.createProjection(e,t.tag);s.optional=!0,s.collapsible=!0,s.parent=this.projection;let n=s.init(t.options).render();return n.dataset.index=e.index,s.element.parent=this,s.registerHandler("view.changed",(e=>{ts.call(this.projection,e,i)})),ts.call(this.projection,n,i),this.items.set(e.id,n),n},addItem(e){if(!L(this.list))return;const t=this.createItem(e);e.index?this.list.children[e.index-1].after(t):this.list.append(t),this.refresh()},removeItem(e){this.hasList&&!f(e)&&(this.items.delete(e.id),this.items.forEach(((e,t)=>{let i=this.source.getElement(t);i&&(e.dataset.index=i.index)})),this.refresh())},moveItem(e,t,i=!1){return this.list.children[t].before(e),e.dataset.index=t,i&&this.source.swapElement(+this.getItemIndex(e),+t),this},swapItem(e,t,i=!1){const s=this.getItemIndex(e),n=this.getItemIndex(t);return this.moveItem(t,s),this.moveItem(e,n),i&&this.source.swapElement(+s,+n),this},delete(e){if(e===this.element)return this.environment.save(this.source.getParent()),void this.source.remove();const{index:t}=e.dataset;var i=this.source.removeElementAt(+t);if(i.success)if(this.hasValue()){let e=+t<this.list.childElementCount?+t:this.list.childElementCount-1;this.list.children[e].focus()}else this.focus();else this.environment.notify(`This element cannot be deleted: ${i.message}`),Je(e)},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.list&&this.list.classList.remove("empty")):(this.element.classList.add("empty"),this.list&&this.list.classList.add("empty")),this.elements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=ys.call(this,t,t.state);if(i===t.currentState)return;let n=t.content;s&&(n=s.content);let r=H();n.forEach((e=>{let t=Zn.call(this,e,null,{focusable:!1});r.append(t)})),Ie(e).append(r)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},render(){const e=H(),{list:t,style:i,action:s={}}=this.schema;if(L(this.element)||(this.element=W({id:this.id,class:["field","field--list"],tabindex:-1,dataset:{nature:"field",view:"list",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),ts.call(this.projection,this.element,this.schema.style)),t&&!L(this.list)){const{style:i}=t;this.list=W({class:["field--list__list"],dataset:{nature:"field-component",view:"list",id:this.id}}),this.source.hasValue()||this.list.classList.add("empty"),t.currentState=null,this.elements.set(t,this.list),ts.call(this.projection,this.list,i),e.append(this.list)}let n=r(s.add,Ps);if(n){const{position:t="after",content:i,help:s,style:r}=n;let a=he({class:["field-action","field--list__add"],tabindex:0,title:s,dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"add"}});i.forEach((e=>{let t=Zn.call(this,e,null,{focusable:!1});a.append(t)})),n.currentState=null,this.elements.set(n,a),ts.call(this.projection,a,r),"before"===t&&this.list?this.list.before(a):e.append(a)}return this.list&&this.source.getValue().forEach((e=>{var t=this.createItem(e);this.list.append(t)})),ts.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},_spaceHandler(e){this.notify(`Add or remove ${this.source.accept.name}`)},spaceHandler(e){return!!L(e)&&e.parentElement===this.list&&(this.createElement(),!0)},deleteHandler(e){return!(!Ts.call(this,e)||e.parentElement!==this.list||(this.delete(e),0))},escapeHandler(e){let t=!0;if(this.messageElement&&!tt(this.messageElement)&&(Ye(this.messageElement),t=!1),t){let t=Ce(e,(e=>0===e.tabIndex));return this.environment.resolveElement(t).focus(t),!0}return this.focus(),!1},enterHandler(e){const t=(e=>Ts.call(this,e)?e:Ce(e,(e=>Ts.call(this,e)),5))(e);if(f(t))return this.focus(),!1;const{action:i,index:s,component:n}=t.dataset;return"add"===i?(this.createElement(),!0):"remove"===i&&(this.delete(t.parentElement),!0)},backspaceHandler:e=>!1,clickHandler(e){const t=(e=>Ts.call(this,e)?e:Ce(e,(e=>Ts.call(this,e)),5))(e);if(f(t))return;const{action:i,index:s,name:n}=t.dataset;"add"===i?this.createElement():"remove"===i&&this.delete(t.parentElement)},_arrowHandler(e,t){if(!L(t))return!1;let i=Hs.call(this,t);if(i){let t=ht(i,e,this.list);return!!L(t)&&(this.swapItem(i,t,!0),i.focus(),!0)}return!1},arrowHandler(e,t){if(!L(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);if(i===this.list){let i=ht(t,e,this.list);return L(i)?(this.environment.resolveElement(i).focus(),!0):this.arrowHandler(e,this.list)}if(i!==this.element)return s();let n=ht(t,e,this.element);if(!L(n))return s();if(n===this.notification)return this.arrowHandler(e,n);if(n===this.list){if(!this.list.hasChildNodes())return s();"up"===e?n=pt(this.list):"down"===e?n=ct(this.list):"left"===e?n=ut(this.list):"right"===e&&(n=dt(this.list))}return n.focus(),!0},bindEvents(){this.projection.registerHandler("value.added",(e=>{this.addItem(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeItem(e)})),this.projection.registerHandler("value.changed",(e=>{this.clear(),this.list&&this.source.getValue().forEach((e=>{let t=this.createItem(e);this.list.append(t)}))})),this.projection.registerHandler("value.swapped",(e=>{const[t,i]=e;let s=this.getItem(t),n=this.getItem(i),r=+this.getItemIndex(s);this.getItemIndex(n),r!==t.index&&this.swapItem(s,n)}))}},$s=Object.assign(Object.create(gs),Ds);Object.defineProperty($s,"size",{get(){return this.items.size}}),Object.defineProperty($s,"hasList",{get(){return L(this.list)}});const Bs={init(){return this},render(){const e=H(),{content:t,mv:i}=this.schema;var s=new DOMParser;return L(this.element)||(this.element=W({id:this.id,class:[],dataset:{nature:"field",view:"static",id:this.id}})),L(this.content)||(this.content=s.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),f(this.mv)&&(this.mv=i),e.hasChildNodes()&&this.element.appendChild(e),this}},zs=Object.assign(Object.create(gs),Bs);var qs=0;const Fs={content:{type:"static",static:{type:"text",content:"Add"}}},Ws={content:{type:"static",static:{type:"text",content:"Remove"}}},Us={table:null,header:null,body:null,footer:null,elements:null,contentElements:null,content:null,init(){const{content:e=[],template:t,focusable:i=!0}=this.schema;return this.elements=new Map,this.focusable=i,this.content=e,this.contentElements=new Map,this.template=this.model.getProjectionSchema(this.source.accept,t.tag)[0].projection,this},render(){const{content:e,action:t={}}=this.schema,{disposition:i}=this.template,s=H();if(!Array.isArray(e))throw new Error("Empty content for listfield");if(L(this.element)||(this.element=W({class:["field","field--table"],id:this.id,tabindex:-1,dataset:{nature:"field",view:"table",id:this.id}}),this.readonly&&this.element.classList.add("readonly"),ts.call(this.projection,this.element,this.schema.style)),e.forEach((e=>{if("table"===e.type){let t=r(e.table,{});const{style:i,header:n,body:a={},footer:o}=t;if(this.table=ce({class:["field--table__table"],tabindex:0,dataset:{nature:"field-component",view:"table",id:this.id}}),n){const{style:e}=n;this.header=ue({class:["field--table-header"],dataset:{nature:"field-component",view:"table",id:this.id}}),ts.call(this.projection,this.header,e),this.table.append(this.header)}if(a){const{style:e}=a;this.body=pe({class:["field--table-body"],dataset:{nature:"field-component",view:"table",id:this.id}}),ts.call(this.projection,this.body,e),this.table.append(this.body)}if(o){const{style:e}=o;this.footer=me({class:["field--table-footer"],dataset:{nature:"field-component",view:"table",id:this.id}}),ts.call(this.projection,this.footer,e),this.table.append(this.footer)}t.currentState=null,this.contentElements.set(t,this.table),ts.call(this.projection,this.table,i),s.append(this.table)}else if("action"===e.type){let t=r(e,Fs);const{content:i,style:n}=t;let a=Zn.call(this,i,null),o=he({class:["field-action","field--table__add"],tabindex:0,dataset:{nature:"field-component",view:"table",component:"action",id:this.id,action:"add"}},[a]);t.currentState=null,this.contentElements.set(t,o),ts.call(this.projection,o,n),s.append(o)}else{let t=Zn.call(this,e);this.contentElements.set(e,t),s.append(t)}})),this.header){let e=ge({class:["field--table-header-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id}});i.forEach((t=>{const{header:i}=t,{style:s,content:n}=i;var r=Zn.call(this,n),a=fe({class:["field--table-header-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},r);ts.call(this.projection,a,s),e.append(a)}));let t=be({class:["field--table-header-cell","field--table-header-cell--action"]},"Action");e.append(t),this.header.append(e)}return this.source.hasValue()&&this.source.getValue().forEach((e=>{this.addRow(e)})),s.hasChildNodes()&&(this.element.append(s),this.bindEvents()),this.refresh(),this.element},hasChanges:()=>!1,hasValue(){return this.body.rows.length>0},getValue(){return this.body.rows},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){if(!this.readonly)return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){this.hasValue()?(this.element.classList.remove("empty"),this.table.classList.remove("empty")):(this.element.classList.add("empty"),this.table.classList.add("empty")),this.contentElements.forEach(((e,t)=>{if(!Array.isArray(t.state))return;const{currentState:i}=t,s=ys.call(this,t,t.state);if(i===t.currentState)return;let n=null;n=s?Zn.call(this,s.content,null):Zn.call(this,t.content,null),Ie(e).append(n)})),this.hasError?this.element.classList.add("error"):this.element.classList.remove("error")},createElement(){return this.source.createElement()},addRow(e){const{action:t={},before:i={},after:s={}}=this.schema,{disposition:n}=this.template,a=r(e.index,this.table.rows.length),o="row"+qs++,l=ge({class:["field--table-row"],tabindex:-1,dataset:{nature:"field-component",view:"table",id:this.id,index:a,elementId:o}});this.elements.set(o,l),n.forEach((t=>{const{body:i}=t,{style:s,content:n}=i;var r=Zn.call(this,n,e),a=be({class:["field--table-cell"],dataset:{nature:"field-component",view:"table",id:this.id}},r);ts.call(this.projection,a,s),l.append(a)}));var h=be({class:["field--table__cell-action"]}),{content:c,style:d}=r(t.remove,Ws),u=Zn.call(this,c),p=he({class:["btn","field--table__button"],dataset:{nature:"field-component",view:"list",component:"action",id:this.id,action:"remove",rowId:o}},u),m=he({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-up",rowId:o}},"Move up"),g=he({class:["btn","field--table__button"],dataset:{nature:"field-component",id:this.id,action:"move-down",rowId:o}},"Move down");ts.call(this.projection,p,d),h.append(p,m,g),l.append(h),this.body.append(l),this.refresh()},removeRow(e){var t=this.body.rows.item(e.index);if(!L(t))throw new Error("Table error: Row not found");Ie(t),t.remove();for(let t=e.index;t<this.body.rows.length;t++){const e=this.body.rows.item(t),{index:i}=e.dataset;e.dataset.index=+i-1}this.refresh()},removeElement(e){return this.source.removeElement(e)},delete(e){if(e===this.element||e===this.table)return void this.source.delete();const{index:t}=e.dataset;this.source.removeElementAt(+t)||(this.environment.notify("This element cannot be deleted"),Je(e))},bindEvents(){this.element.addEventListener("click",(e=>{const{target:t}=e,i=function(e){const t="field-component";return e.dataset.nature===t?e:Ce(e,(e=>e.dataset.nature===t))}(t);if(!L(i))return;const{id:s,action:n}=i.dataset;if(s===this.id)if("add"===n)this.createElement();else if("remove"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e);this.delete(t)}else if("move-up"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.previousElementSibling;s&&s.before(t)}else if("move-down"===n){const{rowId:e}=i.dataset;let t=this.elements.get(e),s=t.nextElementSibling;s&&s.after(t)}}),!0),this.projection.registerHandler("value.added",(e=>{this.addRow(e)})),this.projection.registerHandler("value.removed",(e=>{this.removeRow(e)})),this.projection.registerHandler("value.changed",(e=>{Ie(this.body),this.source.getValue().forEach((e=>{this.addRow(e)}))}))}},Ys=Object.assign(Object.create(gs),Us),Gs=e=>L(e,["input","textarea"]),Js="error";function Xs(){return L(this.choice)||(this.choice=G({class:["bare-list","field--textbox__choices"],dataset:{nature:"field-component",view:"text",component:"choice",id:this.id}}),this.append(this.choice)),this.choice}function Ks(e){return J({class:["field--textbox__choice"],tabindex:0,dataset:{nature:"field-component",view:"text",component:"choice-item",value:e,id:this.id}},e)}function Zs(e){return e.parentElement===this.choice?e:Ce(e,(e=>e.parentElement===this.choice),3)}function Qs(e){const{placeholder:t="",type:i}=e;let s="";return s=this._placeholder?r(Gn.call(this,this._placeholder),""):r(Gn.call(this,t),""),this.readonly||this.resizable?Q({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:s,dataset:{placeholder:s,nature:"field-component",view:this.type,id:this.id}}):this.multiline?ne({class:["field--textbox__input"],placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}}):se({class:["field--textbox__input"],type:r(i,"text"),placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}})}const en={input:null,choice:null,value:"",placeholder:null,multiline:!1,resizable:!1,content:null,hasOwnSource:!1,init(e={}){Object.assign(this.schema,e);const{multiline:t=!1,placeholder:i="",resizable:s=!1,focusable:n=!0,source:r}=this.schema;if(this.multiline=t,this.focusable=n,this.resizable=s,this.children=[],this._placeholder=i,r){const e=this.projection.concept.getAttribute(r).getTarget();e.register(this),this.source=e,this.hasOwnSource=!0}return y(this.schema,"choice")||(this.schema.choice={}),this},focus(e){return this.input.focus(),this},focusIn(){return this.focused=!0,this.value=this.getValue(),this.element.classList.add("active"),this.element.classList.add("focus"),this},focusOut(){return this.hasChanges()&&this.setValue(this.getValue(),!0),m(this.getValue())&&(this.input.textContent=""),this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.choice&&Ye(this.choice),this.input.blur(),this.element.classList.remove("active"),this.element.classList.remove("focus"),this.refresh(),this.focused=!1,this},hasChanges(){return this.value!=this.getValue()},hasValue(){return!a(this.getValue())},getValue(){return Gs(this.input)?this.input.value:this.input.textContent},setValue(e,t=!1){var i;(i=t?this.source.setValue(e):{success:!0}).success||(Je(this.element),this.environment.notify(i.message,"error")),this.setInputValue(e),this.value=e,this.refresh()},setInputValue(e){Gs(this.input)?this.input.value=e:this.input.textContent=e},getCandidates(){let e=this.source.getCandidates();return Array.isArray(e)?e:[]},enable(){return this.input.disabled=!1,this.input.tabIndex=0,this.disabled=!1,this.element.classList.add("disabled"),this},disable(){return this.input.disabled=!0,this.input.tabIndex=-1,this.disabled=!0,this.element.classList.remove("disabled"),this},refresh(){ys.call(this,this.schema,this.schema.state),this.hasValue()?this.element.classList.remove("empty"):this.element.classList.add("empty"),this.element.dataset.value=this.value,this.hasError?(this.element.classList.add(Js),this.input.classList.add(Js)):(this.element.classList.remove(Js),this.input.classList.remove(Js)),this.choice&&this.filterChoice(this.getValue())},render(){const e=H(),{container:t,input:i={},style:s}=this.schema;if(L(this.element)||(this.element=W({id:this.id,class:["field","text-field","field--textbox"],dataset:{nature:"field",view:"text",id:this.id,disabled:this.disabled,readonly:this.readonly,value:""}}),this.readonly&&this.element.classList.add("readonly"),this.disabled&&this.element.classList.add("disabled"),ts.call(this.projection,this.element,this.schema.style)),t){const{content:i=[],style:s}=t;i.forEach((t=>{if("input"===t.type){const{style:i}=t.input;this.input=Qs.call(this,t.input),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",ts.call(this.projection,this.input,i),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}else{let i=Zn.call(this,t,null,{focusable:!1});e.append(i)}})),ts.call(this.projection,this.element,s)}else{if(!L(this.input)){const{style:t}=i;this.input=Qs.call(this,i),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",ts.call(this,this.input,t),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}ts.call(this.projection,this.element,s)}return e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.source.hasValue()&&this.setValue(this.source.getValue()),this.refresh(),this.element},filterChoice(e){const{children:t}=this.choice;if(m(e)){for(let e=0;e<t.length;e++){const i=t[e];Ue(i),i.hidden=!1}return!0}let i=e.trim().toLowerCase().replace(/\s+/g," ").split(" ");for(let e=0;e<t.length;e++){const s=t[e],{value:n}=s.dataset;i.some((e=>n.toLowerCase().includes(e)))?(Ue(s),s.hidden=!1):(Ye(s),s.hidden=!0)}return!0},selectChoice(e){if(!L(e))return;const t=function(e){return e.dataset.value}(e);return this.setValue(t,!0),this.input.focus(),Ye(this.choice),this},update(e,t,i){"delete"!==e?"value.changed"===e&&this.setValue(t):this.delete()},_spaceHandler(e){const t=new Set(this.getCandidates());if(0===t.size)this.notify("Enter any text.",Ze.INFO);else{Xs.call(this);const e=H();t.forEach((t=>e.append(Ks.call(this,t)))),Ie(this.choice).append(e),this.filterChoice(this.getValue()),Ue(this.choice)}},escapeHandler(e){let t=!0;if(this.messageElement&&!tt(this.messageElement)&&(Ye(this.messageElement),t=!1),this.choice&&!tt(this.choice)&&(Ye(this.choice),t=!1),t){let t=Ce(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return i&&i.focus(t),!1}return this.input.focus(),!0},enterHandler(e){const t=Zs.call(this,e);return t?this.selectChoice(t):this.multiline||(e===this.input?this.setValue(this.getValue(),!0):this.focus()),!0},backspaceHandler(e){Zs.call(this,e)&&this.input.focus()},clickHandler(e){const t=Zs.call(this,e);L(t)&&this.selectChoice(t)},arrowHandler(e,t){if(!L(t))return!1;const{parentElement:i}=t,s=()=>!!this.parent&&this.parent.arrowHandler(e,this.element);let n=Zs.call(this,t);if(L(n)){let t=ht(n,e,this.choice);return L(t)?(t.focus(),!0):this.arrowHandler(e,this.choice)}if(i!==this.element)return s();let r=null;if("right"===e){if(t===this.input&&!(this.getValue().length<$e(this.input)+1))return!1;r=ht(t,e,this.element,!1)}else if("left"===e){if(t===this.input&&0!==$e(this.input))return!1;r=ht(t,e,this.element,!1)}else r=ht(t,e,this.element,!1);return L(r)&&r.dataset.id===this.id?("up"===e?r=pt(this.choice):"down"===e?r=ct(this.choice):"left"===e?r=ut(this.choice):"right"===e&&(r=dt(this.choice)),r.focus(),!0):s()},bindEvents(){this.element.addEventListener("input",(e=>{this.hasError&&this.source.setValue(this.getValue(),!0),this.refresh()})),this.hasOwnSource||this.projection.registerHandler("value.changed",(e=>{this.setValue(e)}))}},tn=Object.assign(Object.create(gs),en),sn={init(){return this.arrowStyle=this.schema.arrowStyle,this},render(){const{decorator:e}=this.schema;return L(this.element)||(this.element=document.createElementNS("http://www.w3.org/2000/svg","path"),this.element.style.fill="transparent",this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="arrow",this.element.dataset.id=this.id),this.source.getAttributeByName("target").target.register(this.projection),this.source.getAttributeByName("source").target.register(this.projection),L(this.decorator)||f(e.attribute.dynamic.name)||(this.decorator=Zn.call(this,e.attribute),this.base="left",this.ratio=.02),f(this.registered)&&(this.registered=[]),this.computeStyle(),this.bindEvent(),this.element},getStyle(){},signal(){f(this.valSource)||f(this.valTarget)||this.projection.parent.accept(this.valSource,this.valTarget,this)},computeStyle(){const{stroke:e,dasharray:t,width:i,linecap:s,end:n,start:a}=this.schema.arrowStyle;this.element.style.stroke=e,f(t)||(this.element.style["stroke-dasharray"]=t),this.element.style["stroke-width"]=r(i,1),this.element.style["stroke-linecap"]=s,n&&this.createMarkerEnd()},createMarkerEnd(){f(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.end=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.end.id="marker"+this.id,this.end.setAttribute("refY",5),this.end.setAttribute("refX",10),this.end.setAttribute("markerUnit","strokeWidth"),this.end.setAttribute("markerWidth",10),this.end.setAttribute("markerHeight",10),this.end.setAttribute("orient","auto"),this.end.classList.add("end");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.end.appendChild(e),this.definitions.appendChild(this.end),this.element.setAttribute("marker-end","url(#"+this.end.id+")")},createMarkerStart(){f(this.definitions)&&(this.definitions=document.createElementNS("http://www.w3.org/2000/svg","defs")),this.start=document.createElementNS("http://www.w3.org/2000/svg","marker"),this.start.id="marker"+this.id,this.start.setAttribute("refY",5),this.start.setAttribute("refX",1),this.start.setAttribute("markerUnit","strokeWidth"),this.start.setAttribute("markerWidth",10),this.start.setAttribute("markerHeight",10),this.start.setAttribute("orient","auto"),this.start.classList.add("start");let e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","black"),this.start.appendChild(e),this.definitions.appendChild(this.end),this.element.setAttribute("marker-start","url(#"+this.end.id+")")},setValues(){f(this.source.getAttributeByName("target").target.value)||(this.valTarget=this.source.getAttributeByName("target").target.value),f(this.source.getAttributeByName("source").target.value)||(this.valSource=this.source.getAttributeByName("source").target.value)},refresh(){this.setValues(),this.updateRegister(),this.signal()},deleteRef(e,t){this.valTarget!==e.id&&this.valSource!==e.id||this.projection.parent.removeArrow(this,t)},setLine(e,t){this.element.setAttribute("d","M "+e.x+", "+e.y+"L "+t.x+", "+t.y)},setPath(e){this.element.setAttribute("d",e)},updateRegister(){for(let e=0;e<this.registered.length;e++)this.registered[e]={name:this.registered[e].name,value:this.source.getAttributeByName(this.registered[e].name).target.value}},register(e){f(this.getAttribute)&&(this.registered.push({name:e,value:this.source.getAttributeByName(e).target.value}),this.source.getAttributeByName(e).target.register(this.projection),this.projection.registerHandler("value.added",(e=>{this.refresh()})))},get(e){console.log(this.registered);for(let t=0;t<this.registered.length;t++)if(this.registered[t].name===e)return this.registered[t].value},bindEvent(){this.projection.registerHandler("value.changed",(e=>{console.log(e),this.refresh()})),this.projection.registerHandler("displayed",(()=>{this.refresh()}))}},nn=Object.assign(Object.create(gs),sn),rn={init(){return this},render(){const{content:e,x:t,y:i}=this.schema;var s=new DOMParser;return f(this.element)&&(this.element=s.parseFromString(e.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,console.log(this.element),this.element.id=this.id,this.element.classList.add("field"),this.element.tabindex=-1,this.element.dataset.nature="field",this.element.dataset.view="svg",this.element.dataset.id=this.id),this.element.setAttribute("x",t),this.element.setAttribute("y",i),console.log(this.element),this.element}},an=Object.assign(Object.create(gs),rn),on={binary:(e,t,i)=>Object.create(Cs,{object:{value:"field"},name:{value:"binary-field"},type:{value:"binary"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),choice:(e,t,i)=>Object.create(Ns,{object:{value:"field"},name:{value:"choice-field"},type:{value:"choice"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),list:(e,t,i)=>Object.create($s,{object:{value:"field"},name:{value:"list-field"},type:{value:"list"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),table:(e,t,i)=>Object.create(Ys,{object:{value:"field"},name:{value:"table-field"},type:{value:"table"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),text:(e,t,i)=>Object.create(tn,{object:{value:"field"},name:{value:"text-field"},type:{value:"text"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),interactive:(e,t,i)=>Object.create(Vs,{object:{value:"field"},name:{value:"interactive-field"},type:{value:"interactive"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),static:(e,t,i)=>Object.create(zs,{object:{value:"field"},name:{value:"static-field"},type:{value:"static"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),dynamic:(e,t,i)=>Object.create(Rs,{object:{value:"field"},name:{value:"dynamic-field"},type:{value:"dynamic"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),add:(e,t,i)=>Object.create(vs,{object:{value:"field"},name:{value:"add-field"},type:{value:"add"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),arrow:(e,t,i)=>Object.create(nn,{object:{value:"field"},name:{value:"arrow"},type:{value:"arrow"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}}),svg:(e,t,i)=>Object.create(an,{object:{value:"field"},name:{value:"svg"},type:{value:"svg"},id:{value:hn()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept}})};var ln=0;const hn=()=>"field"+ln++,cn={createField(e,t,i){const{type:s}=t,n=on[s];if(f(n))throw new Error(`Missing handler: The '${s}' field could not be handled`);var a=n(e,t,i);if(f(a))throw new Error(`Bad request: The '${s}' field could not be created`);return a.errors=[],a.readonly=r(t.readonly,!1),f(a.id)&&(a.id=hn()),a}},dn={init(){throw new Error("This function has not been implemented")},element:null,children:null,statusElement:null,attached:null,readonly:!1,visible:!1,disabled:!1,active:!1,focused:!1,get hasAttached(){return!a(this.attached)},attach(e,t){this.attached.push(e)},detach(e){this.attached.slice(this.attached.indexOf(e),1)},getAttached(e){return h(e)?this.attached.filter((t=>e(t))):this.attached},show(){return Ue(this.element),this.visible=!0,this.active=!0,this},hide(){return Ye(this.element),this.visible=!1,this},toggle(){return Ge(this.container),this.visible=!this.visible,this},focus(){return this.element.focus(),this.focused=!0,this.active=!0,this},_focusIn:e=>!1,navigate(e,t,i){return this.focusable?(this.element.focus(),!0):this.parent.arrowHandler(e,this.element)},clear:()=>!0,delete(){this.environment.notify("This element cannot be removed",Ze.WARNING,1500),Je(this.element)},spaceHandler(e){return this.arrowHandler("right",e)},_spaceHandler(e){return this.environment.notify("Nothing do here.",Ze.NORMAL,1500),!1},escapeHandler(e){let t=Ce(e,(e=>0===e.tabIndex));return this.projection.resolveElement(t).focus(t),!0},enterHandler(e){this.element.click()},deleteHandler(e){return this.environment.notify("This element cannot be removed",Ze.WARNING,1500),Je(this.element),!1},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){return!!this.parent&&this.parent.arrowHandler(e,t)},clickHandler:e=>(console.warn("CLICK_HANDLER NOT IMPLEMENTED"),!1),controlHandler:e=>(console.warn("CONTROL NOT IMPLEMENTED"),!1)},un=Object.assign(dn),pn={init(){return this.children=[],this},render(){const e=H(),{help:t,style:i,content:s}=this.schema;return L(this.element)||(this.element=Z({class:["static","audio-static"],src:s,dataset:{nature:"static",static:"audio",id:this.id,ignore:"all"}})),f(t)||(this.element.title=t),ts.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},bindEvents(){}},mn=Object.assign(Object.create(un),pn);function gn(e,t){let i=e.param.find((e=>e.name===t));if(f(i))return;const{type:s="string",value:n}=i;let a=r(n,i.default);return f(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}function fn(e){if(f(e))return"";const{type:t}=e;return"property"===t?(this.hasProperty=!0,r(this.source.getProperty(e.name),"")):"param"===t?gn.call(this,this.schema.template,e.name):"raw"===t?O(e.raw):e}function bn(e){return m(e)?"":e.startsWith("http://")||e.startsWith("https://")?new URL(e).href:bn(`https://${e}`)}const vn={url:null,alt:null,width:null,height:null,init(){const{url:e,width:t,height:i,alt:s}=this.schema;return this.width=t,this.height=i,this.alt=s,this},render(){let e=!1;const{help:t,style:i,url:s}=this.schema;return this.url=bn(fn.call(this,s)),L(this.element)||(this.element=K({class:["static","image-static"],src:this.url,alt:this.alt,dataset:{nature:"static",static:"image",id:this.id,ignore:"all"}}),e=!0),f(this.width)||isNaN(this.width)||(this.element.width=this.width),f(this.height)||isNaN(this.height)||(this.element.height=this.height),f(t)||(this.element.title=t),ts.call(this.projection,this.element,i),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return m(this.url)?this.element.classList.add("empty"):this.element.classList.remove("empty"),this},update(){const{url:e}=this.schema;return this.url=bn(fn.call(this,e)),this.element.src=this.url,this.refresh(),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},yn=Object.assign(Object.create(un),vn),wn={email:e=>`mailto:${e}`,phone:e=>`tel:${e}`,link:e=>`${e}`,url:e=>`${e}`};function xn(e,t){let i=e.param.find((e=>e.name===t));if(f(i))return;const{type:s="string",value:n}=i;let a=r(n,i.default);return f(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}function En(e){if(f(e))return"";const{type:t}=e;return"property"===t?(this.hasProperty=!0,r(this.source.getProperty(e.name),"")):"param"===t?xn.call(this,this.schema.template,e.name):"raw"===t?O(e.raw):e}const An={url:null,urlType:null,href:null,hrefHandler:null,content:null,init(){const{content:e=[],urlType:t="link"}=this.schema;if(this.content=e,this.urlType=t,this.children=[],this.hrefHandler=wn[this.urlType],!h(this.hrefHandler))throw new TypeError("type not handled");return this},render(){let e=!1;const t=H(),{help:i,style:s,url:n}=this.schema;return this.href=this.hrefHandler(En.call(this,n)),L(this.element)||(this.element=X({class:["static","link"],href:this.href,dataset:{nature:"static",static:"link",id:this.id,ignore:"all"}}),"link"===this.urlType&&(this.element.target="_blank"),e=!0),this.content.forEach((e=>{let i=Zn.call(this,e,this.projection.concept,{focusable:!1});t.append(i)})),f(i)||(this.element.title=i),ts.call(this.projection,this.element,s),t.hasChildNodes()&&this.element.append(t),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this},update(){const{url:e}=this.schema;return this.element.href=this.hrefHandler(En.call(this,e)),Ie(this.element),this.content.forEach((e=>{this.element.append(Zn.call(this,e,this.projection.concept,{focusable:!1}))})),this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},jn=Object.assign(Object.create(un),An);function Cn(e,t){let i=e.param.find((e=>e.name===t));if(f(i))return;const{type:s="string",value:n}=i;let a=r(n,i.default);return f(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}function Ln(e){if(f(e))return"";const{type:t}=e;return"property"===t?(this.hasProperty=!0,r(this.source.getProperty(e.name),"")):"param"===t?Cn.call(this,this.schema.template,e.name):"html"===t?O(e.html):"raw"===t?O(e.raw):e}const kn={editable:null,focusable:null,hasProperty:!1,asHTML:!1,init(e={}){Object.assign(this.schema,e);const{content:t,editable:i=!1,focusable:s=!1}=this.schema;return this.children=[],this._content=t,this.editable=i,this.focusable=s,this},render(){let e=!1;const{content:t,help:i,style:s}=this.schema;if(!L(this.element)){if(this.element=Q({class:["text","static","text-static"],editable:this.editable,dataset:{nature:"static",view:"text",static:"text",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0),Array.isArray(t))t.forEach((e=>{let t=Ln.call(this,e),i=Q({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",content:t,id:this.id,ignore:"all"}},t);ts.call(this.projection,i,e.style),this.element.append(i)}));else{let e=Ln.call(this,t);this.element.append(e),this.element.content=e}e=!0}return f(i)||(this.element.title=i),ts.call(this.projection,this.element,s),e&&this.bindEvents(),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},getLength(){return this.element.textContent.length},backspaceHandler(e){return this.arrowHandler("left",e)},arrowHandler(e,t){if(!this.editable&&this.parent)return this.parent.arrowHandler(e,t);if("right"===e){if(this.getLength()<$e(this.element)+1&&this.parent)return this.parent.arrowHandler(e,t)}else if("left"===e){if(0===$e(this.element)&&this.parent)return this.parent.arrowHandler(e,t)}else if(this.parent)return this.parent.arrowHandler(e,t);return!1},escapeHandler(e){let t=Ce(e,(e=>0===e.tabIndex));this.projection.resolveElement(t).focus(t)},update(){const{content:e}=this.schema;return Ie(this.element),Array.isArray(e)?e.forEach((e=>{this.element.append(Q({class:["text","static","text-static"],dataset:{nature:"static-component",view:"text",static:"text",id:this.id,ignore:"all"}},Ln.call(this,e)))})):this.element.append(Ln.call(this,e)),this},refresh(){return this},bindEvents(){this.hasProperty&&(this.projection.registerHandler("value.changed",(e=>{this.update()})),this.projection.registerHandler("value.added",(e=>{this.update()})),this.projection.registerHandler("value.removed",(e=>{this.update()})))}},In=Object.assign(Object.create(un),kn),Sn={contentType:null,editable:null,focusable:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0}=this.schema;return this.children=[],this.focusable=t,this},render(){const e=H(),{help:t,style:i,content:s}=this.schema;return L(this.element)||(this.element=he({class:["btn","static"],dataset:{nature:"static",view:"plink",static:"plink",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),s.forEach((t=>{let i=Zn.call(this,t,this.projection.concept,{focusable:!1});e.append(i)})),f(t)||(this.element.title=t),ts.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(e){let t=Ce(e,(e=>0===e.tabIndex));this.environment.resolveElement(t).focus(t)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){let t=this.projection.findView(this.schema.tag);return-1===t||this.projection.changeView(t),!1},refresh(){return this},bindEvents(){}},On=Object.assign(Object.create(un),Sn),Nn={template:null,selector:null,content:null,init(){return this.selector=this.schema.selector,this.template=Ee(this.selector),this},render(){const{style:e,content:t}=this.schema;return j(this.element)||(this.element=Ae(this.template)),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},refresh(){return this}},Mn=Object.assign(Object.create(un),Nn);function Rn(e,t){let i=e.param.find((e=>e.name===t));if(f(i))return;const{type:s="string",value:n}=i;let a=r(n,i.default);return f(a)?null:"string"===s?a.toString():"number"===s?+a:void 0}const _n={contentType:null,editable:null,focusable:null,disabled:null,init(e={}){Object.assign(this.schema,e);const{focusable:t=!0,disabled:i=!1}=this.schema;return this.children=[],this.focusable=t,this.disabled=i,this},render(){const e=H(),{help:t,style:i,content:s}=this.schema;return L(this.element)||(this.element=he({class:["btn","static"],dataset:{nature:"static",view:"button",static:"button",id:this.id,ignore:"all"}}),this.focusable&&(this.element.tabIndex=0)),s.forEach((t=>{let i=Zn.call(this,t,this.projection.concept,{template:this.schema.template,focusable:!1});e.append(i)})),f(t)||(this.element.title=t),ts.call(this.projection,this.element,i),e.hasChildNodes()&&(this.element.append(e),this.bindEvents()),this.refresh(),this.element},focusIn(){return this.focused=!0,this.element.classList.add("active"),this},focusOut(){return this.messageElement&&(Ye(this.messageElement),Ie(this.messageElement)),this.element.classList.remove("active"),this.refresh(),this.focused=!1,this},arrowHandler(e,t){return(!this.editable&&this.parent||!!this.parent)&&this.parent.arrowHandler(e,t)},escapeHandler(e){let t=Ce(e,(e=>0===e.tabIndex));this.environment.resolveElement(t).focus(t)},enterHandler(e){const t=this.projection.schema.findIndex((e=>e.tags.includes(this.schema.tag)));return this.projection.changeView(t),!1},clickHandler(e){let t=this.source;if(this.schema.bind&&(t=this.source.getValue(!0)),this.schema.action){const{type:e,value:i,target:s}=this.schema.action;if(f(s)&&t.createElement(),c(i))for(const e in i){const t=i[e];"param"===t.type&&(i[e]=Rn.call(this,this.schema.template,t.name))}return"attribute"===s.type&&(console.log(i),t.getAttribute(s.name).target.createElement({value:i})),!1}return this.environment.triggerEvent({name:this.schema.trigger,args:[t]}),!1},refresh(){return this},bindEvents(){}},Vn=Object.assign(Object.create(un),_n);var Pn=0;const Tn=()=>"static"+Pn++,Hn={audio:(e,t,i)=>Object.create(mn,{object:{value:"static"},name:{value:"audio-static"},type:{value:"audio"},id:{value:Tn()},model:{value:e},schema:{value:t},projection:{value:i}}),plink:(e,t,i)=>Object.create(On,{object:{value:"static"},name:{value:"plink-static"},type:{value:"plink"},id:{value:Tn()},model:{value:e},schema:{value:t},projection:{value:i}}),image:(e,t,i)=>Object.create(yn,{object:{value:"static"},name:{value:"image-static"},type:{value:"image"},id:{value:Tn()},model:{value:e},schema:{value:t},projection:{value:i}}),link:(e,t,i)=>Object.create(jn,{object:{value:"field"},name:{value:"link-static"},type:{value:"link"},id:{value:Tn()},model:{value:e},schema:{value:t},projection:{value:i}}),text:(e,t,i)=>Object.create(In,{object:{value:"static"},name:{value:"text-static"},type:{value:"text"},id:{value:Tn()},model:{value:e},schema:{value:t},projection:{value:i}}),html:(e,t,i)=>Object.create(Mn,{object:{value:"static"},name:{value:"html-static"},type:{value:"html"},id:{value:Tn()},model:{value:e},schema:{value:t},projection:{value:i}}),button:(e,t,i)=>Object.create(Vn,{object:{value:"static"},name:{value:"button-static"},type:{value:"button"},id:{value:Tn()},model:{value:e},schema:{value:t},projection:{value:i}})},Dn={createStatic(e,t,i){const{type:s}=t,n=Hn[s];if(f(n))throw new Error(`Missing handler: The '${s}' static could not be handled`);var r=n(e,t,i);if(f(r))throw new Error(`Bad request: The '${s}' static could not be created`);return f(r.id)&&(r.id=Tn()),r}},$n={focusable:null,readonly:!1,visible:!1,editable:!1,active:!1,container:null,elements:null,children:null,editing:!1,getStyle(){return this.schema.style},setStyle(e){return this.schema.style=e,ts.call(this.projection,this.container,e),this.refresh(),!0},getContainer(){return this.container},isRoot(){return f(this.parent)},getField(e){return this.projection.getField(e)},getStatic(e){return this.projection.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},show(){return Ue(this.element),this.visible=!0,this.active=!0,this},hide(){return Ye(this.element),this.visible=!1,this},toggle(){return Ge(this.container),this.visible=!this.visible,this},_focusIn:e=>!1,spaceHandler(e){return e===this.container&&!f(this.parent)&&this.parent.spaceHandler(this.container)},_spaceHandler(e){return console.warn(`CTRL_SPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},escapeHandler(e){if(this.isRoot())return!1;let t=Ce(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return!f(i)&&(i.focus(t),!0)},enterHandler(e){let t=we('[tabindex]:not([tabindex="-1"])',this.container),i=this.environment.resolveElement(t);return!f(i)&&(i.focus(),!0)},delete(){var e=this.source.delete();e.success||this.environment.notify(e.message)},deleteHandler(e){if(this.projection.element!==this)return!1;if(!this.projection.optional)return Je(this.container),!1;let t=Ce(e,(e=>0===e.tabIndex)),i=this.container.cloneNode(!0);this.source.hasParent()&&this.environment.save(this.source.getParent(),i),this.source.delete();let s=this.environment.resolveElement(t);return f(s)||s.focus(),!1},backspaceHandler(e){return console.warn(`BACKSPACE_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},arrowHandler(e,t){if(t===this.container)return!f(this.parent)&&this.parent.arrowHandler(e,this.container);let i=ht(t,e,this.container);if(!L(i))return!f(this.parent)&&"layout"===this.parent.object&&this.parent.arrowHandler(e,this.container);let s=this.environment.resolveElement(i);return s&&(h(s.navigate)?s.navigate(e):s.focus()),!0},shiftHandler(e,t){if("up"===e){let e=nt(window.getComputedStyle(this.container).marginTop);this.container.style.marginTop=`${e+1}px`}return!0},_arrowHandler(e,t){return console.warn(`CTRL_ARROW_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},clickHandler(e){return console.warn(`CLICK_HANDLER NOT IMPLEMENTED FOR ${this.name}`),!1},controlHandler(e){this.toolbar&&this.toolbar.remove()}},Bn={ROW:"row",COLUMN:"column"},zn={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},qn={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"};var Fn=0;function Wn(e,t,i){return Object.create(Yn,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:"layout"+Fn++},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})}const Un={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema,{orientation:s=Bn.ROW,wrappable:n=!0,alignItems:r,justifyContent:a}=this.schema.layout;return this.orientation=s,this.wrappable=n,this.alignItems=r,this.justifyContent=a,this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){y(Bn,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=W({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let t=H(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{label:e,content:t,style:i,help:s}=this.schema,n=H();L(this.container)||(this.container=W({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),s&&(this.container.title=s);for(let e=0;e<t.length;e++){let i=Zn.call(this,t[e],null,this.args),s=this.environment.resolveElement(i);s&&(s.parent=this),this.elements.push(i),n.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",ts.call(this.projection,this.container,i),n.hasChildNodes()&&(this.container.append(n),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=qn[this.justifyContent],this.container.style.alignItems=zn[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=we('[tabindex]:not([tabindex="-1"])',this.container);if(f(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},Yn=Object.assign({},$n,Un);function Gn(e){return"property"===e.type?this.projection.concept.getProperty(e.name):e}function Jn(e,t,i){const{tag:s,placeholder:n={},style:a,options:o}=t;if(!i.hasAttribute(e)){let t=`Attribute '${e}' does not exist in the concept '${i.name}'`;return this.environment.notify(t,Ze.ERROR),this.environment.addError({source:"projection",code:"attribute_not_found",message:t}),ie({hidden:!0},e)}r(t.required,i.isAttributeRequired(e))&&!i.isAttributeCreated(e)&&i.createAttribute(e);const l={name:e,get created(){return i.isAttributeCreated(e)},schema:t,placeholder:ie({class:["projection-element"],hidden:!0},e),parent:this,projection:this.projection,element:null};if(this.projection.attributes.push(l),!l.created){const{content:t}=n;return l.placeholder=t?Zn.call(this,t,i,{focusable:!0}):ie({class:["projection-element","projection-element--placeholder"],tabindex:0,dataset:{object:"attribute",id:e}},`Add ${e}`),l.placeholder.addEventListener("click",(t=>{i.createAttribute(e),this.projection.resolveElement(l.element).focus()})),l.placeholder}{const{target:t,schema:n}=i.getAttributeByName(e);let r=this.projection.model.createProjection(t,s).init(o);if(r.parent=this.projection,r._style=a,l.element=r.render(),f(l.element))return ie({hidden:!0},e);r.element.parent=this}return l.element}function Xn(e,t){const{value:i,placement:s}=e,{target:n,description:r}=t.getAttributeByName(i);let a=this.projection.model.createProjection(n,s.tag).init();a.parent=this.projection,a.render(),f(n.value)||a.element.initValue(n.value),a.element.parent=this;let o=i[0].toUpperCase()+i.substring(1);return a.element.attributeName=o,a.element}function Kn(e,t){let i=this.projection.model.createProjection(t,e.tag).init();return i.parent=this.projection,i.render(),i.element.parent=this,i.element}function Zn(e,t,i={}){if(e.kind)return Qn.call(this,e,t,i);const s=r(t,this.projection.concept);if("container"===e.type){let t=Wn(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("layout"===e.type){let t=Cr.createLayout(this.model,e.layout,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("field"===e.type){let t=cn.createField(this.model,e.field,this.projection);return t.parent=this,t.init(i),this.model.registerField(t),t.render()}if("static"===e.type){let t=Dn.createStatic(this.model,e.static,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerStatic(t),t.render()}if("dynamic"===e.type)return Zn.call(this,e.dynamic,t,i);if("attribute"===e.type)return Jn.call(this,e.name,e,s);if("svg-attribute"===e.type)return Xn.call(this,e,s);if("external"===e.type)return Kn.call(this,e,s);if("g-fragment"===e.type){let t=e.name,i=this.model.getGFragmentSchema(t.toLowerCase());return(new DOMParser).parseFromString(i.content.content.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement}if("template"===e.type){let s=e.name;"param"===s.type&&(s=this.projection.getParam(s.name)),console.log(e);let n=this.model.getTemplateSchema(s);n.param&&(e.param&&n.param.forEach((t=>{Object.assign(t,e.param.find((e=>e.name===t.name)))})),this.projection.addParam(n.param));const r=H();let a,o=Object.assign({template:n},i),l=!1;return n.content.forEach((e=>{r.append(Zn.call(this,e,t,o))})),l?a:r}if("projection"===e.type){const{tag:t,style:i,src:n,required:r=!1}=e;if(n&&"attribute"===n.type)return Jn.call(this,n.name,e,s);const a={schema:e,placeholder:ie({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return a.update=function(e,n,r){if(a.element&&(a.element.remove(),a.element=null),s.hasValue()){let e=s.getValue(!0),n=this.projection.model.createProjection(e,t).init();n.placeholder=a.placeholder,n.parent=this.projection,a.element=n.render(),a.placeholder&&a.placeholder.after(a.element),L(a.element)&&ts.call(this.projection,a.element,i),n.element.parent=this.projection.element}},s.register(a),a.update(),a.element||a.placeholder}if("property"===e.type){const{name:t}=e;return this.projection.concept.getProperty(t)}if("html"===e.type){const{html:t}=e;return O(t)}if("raw"===e.type){const{raw:t}=e;return t}if("state"===e.type){let s={},n=ys.call(this,s,e.state);return Zn.call(this,n.content,t,i)}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}function Qn(e,t,i={}){const s=r(t,this.projection.concept),{kind:n}=e;if("container"===n){let t=Wn(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("layout"===n){let t=Cr.createLayout(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerLayout(t),t.render()}if("field"===n){let t=cn.createField(this.model,e,this.projection);return t.parent=this,t.init(i),this.model.registerField(t),t.render()}if("static"===n){let t=Dn.createStatic(this.model,e,this.projection);return t.source=s,t.parent=this,t.init(i),this.model.registerStatic(t),t.render()}if("dynamic"===n)return Zn.call(this,e,t,i);if("attribute"===n)return Jn.call(this,e.name,e,s);if("template"===n){let s=e.name;"param"===s.type&&(s=this.projection.getParam(s.name));let n=this.model.getTemplateSchema(s);n.param&&(e.param&&n.param.forEach((t=>{Object.assign(t,e.param.find((e=>e.name===t.name)))})),this.projection.addParam(n.param));const r=H();return n.content.forEach((e=>{r.append(Zn.call(this,e,t,i))})),r}if("projection"===n){const{tag:t,style:i,required:n=!1}=e,r={schema:e,placeholder:ie({class:["projection-element"],hidden:!0}),parent:this,projection:this.projection,element:null};return r.update=function(e,n,a){if(r.element&&(r.element.remove(),r.element=null),s.hasValue()){let e=s.getValue(!0),n=this.projection.model.createProjection(e,t).init();n.placeholder=r.placeholder,n.parent=this.projection,r.element=n.render(),r.placeholder&&r.placeholder.after(r.element),L(r.element)&&ts.call(this.projection,r.element,i),n.element.parent=this.projection.element}},s.register(r),r.update(),r.element||r.placeholder}if("property"===n){const{name:t}=e;return this.projection.concept.getProperty(t)}if("html"===n){const{html:t}=e;return O(t)}if("raw"===n){const{raw:t}=e;return t}if("state"===n){let s={},n=ys.call(this,s,e.state);return Zn.call(this,n.content,t,i)}throw console.error(e),new TypeError("Bad argument: The type is not recognized")}const er={HORIZONTAL:"horizontal",VERTICAL:"vertical"},tr=[{concept:{name:"stack-layout"},type:"layout",tags:[],projection:{type:"stack",orientation:"vertical",disposition:[{type:"attribute",name:"orientation"}]}}],ir={orientation:null,args:null,init(e={}){const{orientation:t=er.HORIZONTAL,editable:i=!0,focusable:s=!1}=this.schema;return this.orientation=t,this.focusable=s,this.editable=i,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){this.orientation=e,this.refresh()},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();L(this.container)||(this.container=W({class:["layout-container","stack-layout"],title:i,dataset:{nature:"layout",layout:"stack",id:this.id}}));for(let t=0;t<e.length;t++){let i=Zn.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",ts.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.container.style.display="flex",this.container.style.flexWrap="nowrap",this.refresh(),this.container},design(){return{concept:[{name:"stack-layout",nature:"concrete",attributes:[{name:"orientation",target:{name:"string",default:this.orientation,constraint:{values:["horizontal","vertical"]}}}]}],projection:tr,handlers:{orientation:(e,t)=>{this.setOrientation(t)}}}},refresh(){return this.orientation===er.VERTICAL?this.container.style.flexDirection="column":this.orientation===er.HORIZONTAL&&(this.container.style.flexDirection="row"),this},focus(e){if(this.focusable)this.container.focus();else{let e=we('[tabindex]:not([tabindex="-1"])',this.container);if(f(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},sr=Object.assign({},$n,ir),nr={args:null,init(e={}){const{editable:t=!0,focusable:i=!1}=this.schema;return this.focusable=i,this.editable=t,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();L(this.container)||(this.container=W({class:["layout-container"],title:i,dataset:{nature:"layout",layout:"wrap",id:this.id}}));for(let t=0;t<e.length;t++){let i=Zn.call(this,e[t],this.source,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",ts.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="inline-flex",this.container.style.alignItems="baseline",this.refresh(),this.container},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},focus(e){if(this.focusable)this.container.focus();else{let e=we('[tabindex]:not([tabindex="-1"])',this.container);if(f(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)}))}},rr=Object.assign({},$n,nr),ar={elements:null,edit:!1,btnEdit:!1,btnCollapse:!1,menu:!1,collapsed:!1,init(e={}){const{editable:t=!0,collapsible:i=!1,focusable:s=!1}=this.schema;return this.focusable=s,this.collapsible=i,this.editable=t,this.elements=[],this.children=[],Object.assign(this,e),this},collapse(e){if(!this.collapsed)return this.collapseContainer=W({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e){if(!this.collapsed)return;let t=H(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!0,this.refresh(),this},refresh(){return this.collapsed?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();L(this.container)||(this.container=W({class:["layout-container"],dataset:{nature:"layout",layout:"table"}})),this.focusable?this.container.tabIndex=-1:this.container.dataset.ignore="all";for(let t=0;t<e.length;t++){let i=e[t],n=W({class:["table-row"]});n.style.display="table-row";for(let e=0;e<i.length;e++){const t=i[e];let s=W({class:["table-cell"]},Zn.call(this,t.content));s.style.display="table-cell",ts.call(this.projection,s,t.style),n.append(s)}s.append(n)}return ts.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.container.style.display="table",this.refresh(),this.container},bindEvents(){this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},or=Object.assign({},$n,ar),lr={ROW:"row",COLUMN:"column"},hr={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center",stretch:"stretch",baseline:"baseline"},cr={start:"flex-start",end:"flex-end","flex-start":"flex-start","flex-end":"flex-end",center:"center","space-between":"space-between","space-around":"space-around","space-evenly":"space-evenly"},dr={orientation:null,wrappable:null,alignItems:null,justifyContent:null,args:null,init(e={}){const{orientation:t=lr.ROW,wrappable:i=!0,alignItems:s,justifyContent:n,editable:r=!0,focusable:a=!1}=this.schema;return this.orientation=t,this.wrappable=i,this.alignItems=s,this.justifyContent=n,this.focusable=a,this.editable=r,this.elements=[],this.children=[],this.args=e,Object.assign(this,e),this},getOrientation(){return this.orientation},setOrientation(e){y(lr,e)&&(this.orientation=e,this.refresh())},collapse(e=!1){if(!this.collapsed||e)return this.collapseContainer=W({class:"layout-container-collapse"},this.elements),this.btnCollapse.after(this.collapseContainer),this.collapsed=!0,this.refresh(),this},expand(e=!1){if(!this.collapsed&&!e)return;let t=H(Array.from(this.collapseContainer.children));return this.btnCollapse.after(t),this.collapseContainer.remove(),this.collapsed=!1,this.refresh(),this},render(){const{disposition:e,style:t,help:i}=this.schema;if(!Array.isArray(e))throw new SyntaxError("Bad disposition");const s=H();L(this.container)||(this.container=W({class:["layout-container"],dataset:{nature:"layout",layout:"flex",id:this.id}})),i&&(this.container.title=i);for(let t=0;t<e.length;t++){let i=Zn.call(this,e[t],null,this.args),n=this.environment.resolveElement(i);n&&(n.parent=this),this.elements.push(i),s.append(i)}return this.focusable?this.container.tabIndex=0:this.container.dataset.ignore="all",ts.call(this.projection,this.container,t),s.hasChildNodes()&&(this.container.append(s),this.bindEvents()),this.collapsed&&this.collapse(!0),this.container.style.display="flex",this.refresh(),this.container},refresh(){return this.container.style.flexDirection=this.orientation,this.container.style.justifyContent=cr[this.justifyContent],this.container.style.alignItems=hr[this.alignItems],this.wrappable?this.container.style.flexWrap="wrap":this.container.style.flexWrap="nowrap",this},focus(e){if(this.focusable)this.container.focus();else{let e=we('[tabindex]:not([tabindex="-1"])',this.container);if(f(e))return!1;let t=this.environment.resolveElement(e);t&&t.focus(e)}},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this},focusOut(){return this.container.classList.remove("active"),this.container.classList.remove("focus"),this.focused=!1,this},bindEvents(){this.container.addEventListener("change",(e=>{const{target:t}=e,{prop:i}=t.dataset;"orientation"===i&&this.setOrientation(t.value)})),this.projection.registerHandler("view.changed",((e,t)=>{t&&t.parent===this.projection&&(e.parent=this)})),this.btnCollapse&&this.btnCollapse.addEventListener("click",(e=>{this.collapsed?this.expand():this.collapse()}))}},ur=Object.assign({},$n,dr),pr={content:"",init(){return this},render(){const e=H(),{content:t,attributes:i=[],link:s}=this.schema;var n=new DOMParser;if(L(this.element)||(this.element=W({id:this.id,class:[],dataset:{nature:"layout",view:"svg",id:this.id}})),this.element.setAttribute("tabIndex",0),this.focusable=!0,L(this.content)||(this.content=n.parseFromString(t.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,e.appendChild(this.content)),f(this.link)&&!f(s)){this.link=this.projection.schema.findIndex((e=>e.tags.includes(s.tag)));let e=this.content.querySelector("[data-"+s.marker+"]");s.type="svg-link",s.external?e.addEventListener("click",(e=>{let t=this.source,i=this.environment.createProjection(t,s.tag),n=this.environment.findWindow("side-instance");f(n)&&(n=this.environment.createWindow("side-instance"),n.container.classList.add("model-projection-sideview")),n.instances.size>0&&Array.from(n.instances)[0].delete();let r=this.environment.createInstance(t,i,{type:"projection",close:"DELETE-PROJECTION"});n.addInstance(r)})):e.addEventListener("click",(e=>{this.projection.changeView(this.link)}))}return f(this.deciders)&&!a(i)&&(this.deciders=this.attributeHandler(i),this.update()),e.hasChildNodes()&&this.element.appendChild(e),this.element},attributeHandler(e){let t=[];return e.forEach((e=>{switch(e.placement.type){case"in-place":let i=this.content.querySelector("[data-"+e.placement.marker+"]");e.type="svg-attribute";let s=Zn.call(this,e,null,this.args);f(e.property)||(s.property=mr(e.property)),t.push(s),i.appendChild(s.content);break;case"link-place":let{type:n,sd:r=[],dd:o=[]}=e.placement;f(this.linkAttr)&&(this.linkAttr=[]);let l={};l.name=e.value,l.field=this.informations.get(e.value),"list"===l.field.type?l.value=l.field.items:l.value=l.field.value,f(e.property)||(l.property=mr(e.property)),a(r)||(l.sd=new Map,r.forEach((e=>{e.type="template";const t={};var i=Zn.call(this,e,null,this.args);t.render=i,t.parent=this.content.querySelector("[data-"+e.marker+"]"),l.sd.set(i.mv,t)}))),!f(this.dd)||a(o)||f(o)||(l.dd=[],o.forEach((e=>{e.type="template";var t=Zn.call(this,e,null,this.args);l.dd.push(t),t.property=l.property;var i=this.content.querySelector("[data-"+e.marker+"]");f(i)?"before"===this.content.getAttribute("data-"+e.marker)?this.content.prepend(t.content):this.content.appendChild(t.content):"before"===i.getAttribute("data-"+e.marker)?i.prepend(t.content):i.appendChild(t.content)}))),this.linkAttr.push(l)}})),t},update(){f(this.linkAttr)||this.linkAttr.forEach((e=>{this.clearStatics(e.sd,e.value),f(e.property)?this.clearDynamics(e.dd,e.value):this.clearDynamics(e.dd,this.translateProperty(e.value,e.property)),"list"===e.field.type?e.value=e.field.items:e.value=e.field.value,f(e.property)?this.updateDynamics(e.dd,e.value):this.updateDynamics(e.dd,this.translateProperty(e.value,e.property)),this.updateStatics(e.sd,e.value)})),f(this.deciders)||a(this.deciders)||this.deciders.forEach((e=>{e.update(e.field.value)}))},clearDynamics(e,t){f(e)||e.forEach((e=>{e.clear(t)}))},updateDynamics(e,t){f(e)||e.forEach((e=>{e.update(t)}))},clearStatics(e,t){if(!f(e)){let i=e.get(t);f(i)||i.parent.removeChild(i.render.content)}},updateStatics(e,t){if(!f(e)){let i=e.get(t);f(i)||i.parent.appendChild(i.render.content)}},focus(){return this.element.focus(),this.focused=!0,f(this.deciders)||this.deciders.forEach((e=>{e.focusOut()})),this},focusIn(){return this.focus(),this},focusOut(){return this.focused=!1,this},arrowHandler(e,t){if(t===this.element)return!f(this.parent)&&this.parent.arrowHandler(e,this.element);let i=getClosestSVG(t.foreign,e,this,!1);return!f(i)&&(t.focusOut(),i.focus(),!0)},enterHandler(e){this.index=0,this.deciders[0].focusIn()},escapeHandler(e){if(e!==this.element)return this.focus();let t=Ce(e,(e=>0===e.tabIndex)),i=this.environment.resolveElement(t);return i&&i.focus(t),!1},setIndex(e){let t=0;this.deciders.forEach((i=>{i.id!==e.id?t++:this.index=t}))},translateProperty(e,t){let i,s=new Map;return t.forEach((t=>{switch(t.type){case"affectation":s.set(t.target,this.translateProc(t.proc,s,e));break;case"result":return i=this.translateProc(t.proc,s,e),i.value}})),i.value},translateProc(e,t,i){let s={};const n={};let r;switch(e.type){case"filter":let a;if(r=t.get(e.target),"V"===e.order[0]?(s.value=i,s.type=this.source.name):s=t.get(e.order[0]),n.type=s.type,"string"===s.type){a="";for(let e=0;e<s.value.length;e++){const t={type:"string"};t.value=s.value.charAt(e),this.evaluate(r,t)&&(a+=s.value.charAt(e))}return n.result=a,n}return"table"===s.type?(a=[],s.value.forEach(((e,t)=>{const i={type:"table"};i.value=this.projection.resolveElement(e).value;let s=this.evaluate(r,i);s&&a.push(s)}))):(a=[],s.value.forEach((e=>{this.evaluate(r,e)&&a.push(e)}))),n.type=s.type,n.value=a,n;case"lenght":return n.type="int","V"===e.target?(s.value=i,i instanceof Map?s.type="list":s.type=this.source.name):s=t.get(e.target),"list"===s.type?n.value=s.value.size:n.value=s.value.length,n;case"check":return r=t.get(e.pred),n.type="bool","V"===e.param?(s.value=i,s.type=this.source.name):s=t.get(e.param),n.value=this.evaluate(r,s),n;case"pred":return e}},evaluate(e,t){switch(e.vars.value=t.value,e.op){case"!=":return e.vars.name===e.order[0]?t.value!==e.order[1]:t.value!=e.order[0];case"=":return e.vars.name===e.order[0]?t.value===e.order[1]:t.value===e.order[0];case"<=":return e.vars.name===e.order[0]?t.value<=e.order[1]:t.value<=e.order[0];case"<":return e.vars.name===e.order[0]?t.value<e.order[1]:t.value<e.order[0];case"<=":return e.vars.name===e.order[0]?t.value<=e.order[1]:t.value<=e.order[0];case">":return e.vars.name===e.order[0]?t.value>e.order[1]:t.value>e.order[0];case"funI":return t.value[e.fun].call(t.value,e.order[0]);case"funO":return window[e.fun](...e.args)}}};function mr(e){let t=e.split(";"),i=[];return t.forEach((e=>{const t={};let s=e.indexOf(":"),n=e.substring(0,s).replace(/\s/g,""),r=e.substring(s+1,s.lenght).replace(/\s/g,"");switch(n){case"VAR":t.type="affectation";let e=r.indexOf("=");t.target=r.substring(0,e).replace(/\s/g,"");let s=r.substring(e+1,r.lenght).replace(/\s/g,"");t.proc=gr(s),i.push(t);break;case"RETURN":t.type="result",t.proc=gr(r.replace(/\s/g,"")),i.push(t)}})),i}function gr(e){const t={};let i,s,n,r={},a=e.indexOf("(");if(-1===a)return t.type="value",t.value=e,t;let o=e.substring(0,a),l=e.substring(a+1,e.length-1);switch(o){case"COUNT":return t.type="lenght",t.target=l,t;case"PREDICATE":t.type="pred";let e=l.lastIndexOf("}")+1,o=l.substring(1,e-1);for(i=o.indexOf(",");-1!==i;)r.name=o.substring(0,i),r.value="",o=o.substring(i+1,o.lenght),i=o.indexOf(",");""!==o&&(r.name=o,r.value=""),t.vars=r;let h=l.substring(e+1,l.length-1);a=h.indexOf("("),t.op=h.substring(0,a);let c=h.substring(a+1,h.lenght);switch(s=[],i=c.indexOf(","),t.op){case"funI":for(t.fun=c.substring(0,i),c=c.substring(i+1,c.length),i=c.indexOf(","),t.caller=c.substring(0,i),c=c.substring(i+1,c.length),i=c.indexOf(",");-1!==i;)s.push(c.substring(0,i)),c=c.substring(i+1,c.lenght),i=c.indexOf(",");""!==c&&s.push(c),t.order=s;break;default:for(;-1!==i;)s.push(c.substring(0,i)),c=c.substring(i+1,c.lenght),i=c.indexOf(",");""!==c&&s.push(c),t.order=s}return t;case"FILTER":if(t.type="filter",a=l.indexOf("("),-1===a)return t.target=l,t;for(n=l.substring(a+1,l.length-1),t.target=l.substring(0,a),s=[],i=n.indexOf(",");-1!==i;)s.push(n.substring(0,i)),n=n.substring(i+1,n.length),i=n.indexOf(",");return""!==n&&s.push(n),t.order=s,t;case"CHECK":t.type="check",a=l.indexOf("(");let d=l.substring(a+1,l.length-1);return t.pred=l.substring(0,a),t.param=d,t}}const fr=Object.assign(Object.create($n),pr);function br(e){const{placeholder:t="",type:i}=e;let s=Gn.call(this,t);return this.readonly||this.resizable?Q({class:["field--textbox__input","field--textbox__input-pseudo"],editable:!this.readonly,title:s,dataset:{placeholder:s,nature:"field-component",view:this.type,id:this.id}}):this.multiline?ne({class:["field--textbox__input"],placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}}):se({class:["field--textbox__input"],type:r(i,"text"),placeholder:s,title:s,dataset:{nature:"field-component",view:this.type,id:this.id}})}const vr={init(){return this},render(){const e=H(),{current:t={},root:i}=this.schema;this.isRoot=i;var s=new DOMParser;if(L(this.element)||(this.element=W({id:this.id,dataset:{nature:"layout",view:"visualizer",id:this.id}})),!L(this.content)&&(this.svg=this.source.value,!f(this.svg))){if(this.content=s.parseFromString(this.svg.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement,"svg"!==this.content.tagName){let e=s.parseFromString('<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"/>',"image/svg+xml").documentElement;e.appendChild(this.content),this.content=e}e.appendChild(this.content)}if(!L(this.input)){const{placeholder:i="",type:s,style:n}=t;this.input=br.call(this,t),this.disabled&&(this.input.disabled=!0),this.focusable?this.input.tabIndex=0:this.input.dataset.ignore="all",ts.call(this,this.input,n),this.multiline&&this.input.classList.add("field--textbox__input--multiline"),e.append(this.input)}if(i&&f(this.buttons)){this.buttons=[];const t={type:"static",static:{type:"button",trigger:"make interactive",content:[{type:"static",static:{type:"text",content:"Interactive",focusable:!0}}]}};this.mkeInteractive=Zn.call(this,t,null,this.args);let i=this.environment.resolveElement(this.mkeInteractive);i.parent=this,i.visualizer=this,this.buttons.push(i),e.append(this.mkeInteractive);const s={type:"static",static:{type:"button",trigger:"make dynamic",content:[{type:"static",static:{type:"text",content:"Dynamic",focusable:!0}}]}};this.mkeDynamic=Zn.call(this,s,null,this.args),i=this.environment.resolveElement(this.mkeDynamic),i.visualizer=this,i.parent=this,this.buttons.push(i),e.append(this.mkeDynamic);const n={type:"static",static:{type:"button",trigger:"make static",content:[{type:"static",static:{type:"text",content:"Static",focusable:!0}}]}};this.mkeStatic=Zn.call(this,n,null,this.args),i=this.environment.resolveElement(this.mkeStatic),i.visualizer=this,i.parent=this,this.buttons.push(i),e.append(this.mkeStatic)}return e.hasChildNodes()&&this.element.appendChild(e),this.bindEvent(),this.element},focusIn(e){return this.input.focus()},focusOut(){},createProj(){let e=this.current;"tspan"===e.tagName.toLowerCase()&&(e=e.parentNode);let t=new XMLSerializer;return this.cleanInput(),this.updateInput(t.serializeToString(this.content)),'<g xmlns="http://www.w3.org/2000/svg">'+t.serializeToString(e)+"</g>"},cleanInput(){this.input.value="",this.current.parentNode.removeChild(this.current)},updateInput(e){this.source.setValue(e)},bindEvent(){this.content.addEventListener("click",(e=>{var t=new XMLSerializer;let i=e.target;"tspan"===i.tagName.toLowerCase()&&(i=i.parentNode);var s=t.serializeToString(i);this.input.value=s,this.current=i})),this.input.addEventListener("keydown",(e=>{if(""!==this.input.value&&!f(this.current)&&"Enter"===e.key){var t=(new DOMParser).parseFromString(this.input.value.replace(/\&nbsp;/g,""),"image/svg+xml").documentElement;this.current!==this.content?this.current.replaceWith(t):this.content=t,this.current=t;var i=new XMLSerializer;this.isRoot?this.updateInput(i.serializeToString(this.content)):this.updateInput(i.serializeToString(this.content.childNodes[0]))}}))}},yr=Object.assign(Object.create($n),vr),wr={init(){return this.startingPoint=r(this.schema.startingPoint,{x:129,y:190}),this.next=r(this.schema.next,{x:0,y:40}),this.items=new Map,this.places=new Map,this.color="#d5d5d5",this},render(){const{base:e,attributes:t=[],anchor:i="top",width:s=400,height:n=400,baseX:r,baseY:a,baseRatio:o=.2}=this.schema,l=H();if(L(this.element)||(this.element=W({id:this.id,class:[],dataset:{nature:"layout",view:"pattern",id:this.id}})),f(this.svgArea)&&(this.svgArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.templateArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.itemsArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgArea.appendChild(this.templateArea),this.svgArea.appendChild(this.itemsArea),l.appendChild(this.svgArea)),L(this.base)||(this.base=Zn.call(this,e.pattern),this.baseHolder=this.createHolder(this.base),this.baseHolder.setAttribute("x",0),this.baseHolder.setAttribute("y",0),this.svgArea.prepend(this.baseHolder)),f(this.buttons)){this.buttons=new Map,this.button=Zn.call(this,t[0].attribute);let e=this.createHolder(this.button);e.setAttribute("x",this.startingPoint.x),e.setAttribute("y",this.startingPoint.y),e.dataset.x=this.startingPoint.x,e.dataset.y=this.startingPoint.y,this.places.set("x"+this.startingPoint.x+"y"+this.startingPoint.y,e),this.button.parentNode.style.background="white",this.buttons.set(this.button,e),this.itemsArea.appendChild(e)}return l.hasChildNodes()&&this.element.append(l),this.bindEvents(),this.element},createHolder(e,t){let i=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return i.appendChild(s),s.appendChild(e),f(t)||(s.style.background=this.color),i},adapt(e){return this.adaptForeign(e.parentNode,e),this.adaptSVG(e.parentNode.parentNode,e.parentNode)},adaptForeign(e,t){t.style.width="fit-content";let i=t.getBoundingClientRect();e.setAttribute("width",i.width),e.setAttribute("height",i.height)},adaptSVG(e,t){let i=Number(t.getAttribute("width")),s=Number(t.getAttribute("height"));return e.setAttribute("width",i),e.setAttribute("height",s),e.setAttribute("viewBox","0 0 "+i+" "+s),{w:i,h:s}},upSize(e,t){f(this.svgArea.getAttribute("width"))&&(this.svgArea.setAttribute("width",e),this.svgArea.setAttribute("height",t));let i=Number(this.svgArea.getAttribute("width")),s=Number(this.svgArea.getAttribute("height"));if(i<e||s<t){console.log(this.schema.attributes[0].template);const e=this.schema.attributes[0].template,t=Zn.call(this,{type:"g-fragment",name:e});let i=this.createHolder(t,this.color);this.svgArea.prepend(i),this.adapt(t),f(this.last)&&(this.last=this.svgArea),this.addTemplate(i),this.last=i}},bindEvents(){this.projection.registerHandler("displayed",(e=>{const t=this.adapt(this.base);this.upSize(t.w,t.h);const i=this.adapt(this.button);this.center(i,this.buttons.get(this.button))}))},createItem(e,t){const i=t.item;if(!this.model.hasProjectionSchema(e,i.tag))return"";let s=this.model.createProjection(e);return s.optional=!0,s.parent=this.projection,s.init().render()},addTemplate(e){let t=Number(this.last.getAttribute("width"))/2+Number(this.last.getAttribute("x"))-e.getAttribute("width")/2,i=Number(this.last.getAttribute("height"))+Number(this.last.getAttribute("y"));e.setAttribute("x",t),e.setAttribute("y",i);let s=Number(this.svgArea.getAttribute("height"))+Number(e.getAttribute("height"));this.svgArea.setAttribute("height",s),console.log(e)},addItem(e,t){if(!f(this.items.get(e.id))||this.prio!=t.element)return;let i=this.buttons.get(t.element),s=this.createItem(e,t),n=this.createHolder(s,this.color);this.items.set(e.id,n),this.itemsArea.appendChild(n);let r=this.adapt(s);this.placeItem(n,i),this.center(r,n),this.placeButton(i,t.element)},placeItem(e,t){let i=Number(t.getAttribute("x")),s=Number(t.getAttribute("y"));e.setAttribute("x",i),e.setAttribute("y",s);let n=Number(t.dataset.x),r=Number(t.dataset.y);e.dataset.x=n,e.dataset.y=r,this.places.set("x"+n+"y"+r,e)},center(e,t){t.setAttribute("x",Number(t.dataset.x)-e.w/2)},placeButton(e,t){let i=Number(e.getAttribute("x"))+this.next.x,s=Number(e.dataset.x)+this.next.x,n=Number(e.getAttribute("y"))+this.next.y,r=Number(e.dataset.y)+this.next.y;f(this.places.get("x"+s+"y"+r))?(e.setAttribute("x",i),e.dataset.x=s,e.setAttribute("y",n),e.dataset.y=r,this.places.set("x"+s+"y"+r,e),this.upSize(i+Number(e.getAttribute("width")),n+Number(e.getAttribute("height")))):(e.remove(),this.buttons.delete(t))},removeItem(e){let t=this.items.get(e.id);f(t)||(this.createNewButton(t),t.remove(),this.items.delete(e.id))},createNewButton(e){let t=Number(e.dataset.x),i=Number(e.dataset.y),s=Zn.call(this,this.schema.attributes[0].attribute);this.createHolder(s);let n=this.createHolder(s);n.setAttribute("x",t),n.setAttribute("y",i),n.dataset.x=t,n.dataset.y=i,this.places.set("x"+this.startingPoint.x+"y"+this.startingPoint.y,n),s.parentNode.style.background="white",this.itemsArea.appendChild(n);const r=this.adapt(s);this.center(r,n),this.buttons.set(s,n)}},xr=Object.assign({},$n,wr);var Er=0;const Ar=()=>"layout"+Er++,jr={stack:(e,t,i)=>Object.create(sr,{object:{value:"layout"},name:{value:"stack-layout"},type:{value:"stack"},id:{value:Ar()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),wrap:(e,t,i)=>Object.create(rr,{object:{value:"layout"},name:{value:"wrap-layout"},type:{value:"wrap"},id:{value:Ar()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),table:(e,t,i)=>Object.create(or,{object:{value:"layout"},name:{value:"table-layout"},type:{value:"table"},id:{value:Ar()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),flex:(e,t,i)=>Object.create(ur,{object:{value:"layout"},name:{value:"flex-layout"},type:{value:"flex"},id:{value:Ar()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),svg:(e,t,i)=>Object.create(fr,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:Ar()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),visualizer:(e,t,i)=>Object.create(yr,{object:{value:"layout"},name:{value:"svg-layout"},type:{value:"svg"},id:{value:Ar()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(e,t,i)=>Object.create(xr,{object:{value:"layout"},name:{value:"pattern-layout"},type:{value:"pattern"},id:{value:Ar()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},Cr={createLayout(e,t,i){const{type:s}=t,n=jr[s];if(f(n))throw new TypeError(`Missing handler: The '${s}' layout could not be handled`);const r=n(e,t,i);if(f(r))throw new Error(`Bad request: The '${s}' layout could not be created`);return r.createLayout=this.createLayout,f(r.id)&&(r.id=Ar()),r}},Lr={},kr={init(){const{dimensions:e={}}=this.schema;return this.ratio=.4,this.width=r(e.width,500),this.height=r(e.height,500),this.buttons=[],this.dummies=[],this.transLink=[],this.transLinkId=[],this.arrowInventory=[],this.linkInventory={},this},render(){const{attributes:e=[],center:t,direction:i,intensity:s,fixed:n=[],arrowManagement:r}=this.schema;switch(this.center=t,this.intensity=500,i){case"-":this.direction=-1;break;default:this.direction=1}const o=H();if(f(this.instances)&&(this.instances=new Map),f(this.holders)&&(this.holders=new Map),L(this.container)||(this.container=W({class:["algorithm-container"],dataset:{nature:"algorithm",algorithm:"force",id:this.id},tabindex:1}),this.container.style.border="solid 1px black"),L(this.interactionsArea)||(this.interactionsArea=W({class:["layout-container","projection"],dataset:{nature:"layout",layout:"flex",id:"iA"+this.id,projection:-1},tabindex:1}),o.append(this.interactionsArea)),this.focusable=!0,L(this.ids)||(this.ids=[]),a(e)||e.forEach((e=>{let t=Zn.call(this,e);this.interactionsArea.append(t);let i=this.environment.resolveElement(t);i.parent=this,this.buttons.push(i)})),L(this.svgArea)||(this.svgArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgArea.setAttribute("width",this.width),this.svgArea.setAttribute("height",this.height),this.linksArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.linksArea.classList.add("linkArea"),this.nodesArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.nodesArea.classList.add("nodeArea"),this.definitionsArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.definitionsArea.classList.add("definitionArea"),this.svgArea.appendChild(this.linksArea),this.svgArea.appendChild(this.nodesArea),this.svgArea.appendChild(this.definitionsArea),this.svgArea.setAttribute("tabindex",1),this.svgArea.setAttribute("data-projection",-1),this.svgArea.setAttribute("id","sA"+this.id)),o.append(this.svgArea),!L(this.openArrow))switch(r.type){case"interaction-management":this.openArrow=W({class:["button-container","projection"],dataset:{nature:"layout",layout:"flex",id:"iA"+this.id,projection:-1},tabindex:1}),this.openArrow.innerHTML=r.content,this.openArrow.addEventListener("click",(e=>{let t=this.environment.findWindow("side-instance");f(t)&&(t=this.environment.createWindow("side-instance"),t.container.classList.add("model-projection-sideview")),t.instances.size>0&&Array.from(t.instances)[0].delete(),r.attribute.forEach((e=>{let i=this.source.getAttributeByName(e.dynamic.name).target,s=this.environment.createProjection(i,e.dynamic.tag),n=this.environment.createInstance(i,s,{type:"projection",close:"DELETE-PROJECTION"});t.addInstance(n)})),this.environment.setActiveReceiver(this,this.projection.rtags[0])})),this.interactionsArea.append(this.openArrow)}return o.hasChildNodes()&&this.container.append(o),this.bindEvents(),this.container},setUpForce(e,t,i,s,n,r){let a=300;this.isRoot||(a=150),this.force=d3.layout.force().size([e,t]).nodes([]).linkDistance(a).charge(s*i).on("tick",this.ticked.bind(this));var o=d3.select("#sA"+this.id),l=o.select(".nodeArea"),h=o.select(".linkArea");this.nodes=this.force.nodes(),this.node=l.selectAll(".node"+this.id),this.links=this.force.links(),this.link=h.selectAll(".link"+this.id),this.force.start()},restart(){let e=d3.select("#sA"+this.id).select(".linkArea");this.link=e.selectAll(".link"+this.id).data(this.links);let t=d3.select("#sA"+this.id).select(".nodeArea");this.node=t.selectAll(".node"+this.id).data(this.nodes),this.force.start(),this.isRoot||this.environment.getRootReceiver(this.projection.rtags[0]).restart()},branchRoot(e,t){let i=this.createHolder(e);return this.nodesArea.append(i),this.adapt(e),i},branch(){const{attributes:e=[],center:t,direction:i,intensity:s,fixed:n=[]}=this.schema;!a(n)&&f(this.fixedArea)&&n.forEach((e=>{this.setUpForce(this.width,this.height,this.intensity,this.direction),this.nodes.push({x:e.coordinates.width,y:e.coordinates.height,fixed:!0,nbLink:0,points:[]});let t=Zn.call(this,e.attribute),i=this.environment.getRootReceiver(this.projection.rtags[0]).branchRoot(t,e.ratio);this.nodesArea.appendChild(i),i.classList.add("node"+this.id),this.nodes[this.nodes.length-1].width=Number(i.getAttribute("width")),this.nodes[this.nodes.length-1].height=Number(i.getAttribute("height")),f(this.instances)&&(this.instances=new Map),this.registerShape(i),this.instances.set(this.environment.resolveElement(t).source.id,t),this.ids.push(i),this.restart()})),this.buttons.forEach((e=>{e.refresh()})),this.openArrow.click()},addItem(e,t){f(this.force)&&this.setUpForce(this.width,this.height,this.intensity,this.direction);let i=this.environment.getRootReceiver(this.projection.rtags[0]),{item:s,holder:n,id:r}=i.addItemRoot(e,t);"algorithm"===s.dataset.nature&&this.environment.resolveElement(s).branch(),this.instances.set(r,s),this.nodes.push({nbLink:0,points:[]}),n.classList.add("node"+this.id),n.id=this.nodes.length-1,this.nodesArea.append(n),this.nodes[this.nodes.length-1].size=this.getRadius(n),this.nodes[this.nodes.length-1].width=Number(n.getAttribute("width")),this.nodes[this.nodes.length-1].height=Number(n.getAttribute("height")),this.registerShape(n),this.holders.set(s,n),this.ids.push(n),this.restart()},addItemRoot(e,t){let{item:i,id:s}=this.createItemRoot(e,t),n=this.createHolder(i);return this.nodesArea.append(n),this.adapt(i),{item:i,holder:n,id:s}},registerShape(e){let t=e.querySelector("[data-shape]");const i={};let s;if(!f(t))switch(t.tagName){case"ellipse":if(this.environment.getRootReceiver(this.projection.rtags[0])!==this){let n=e.getBoundingClientRect(),r=Number(e.getAttribute("width"))/n.width,a=Number(e.getAttribute("height"))/n.height;s=t.getBoundingClientRect(),i.rx=s.width*r,i.ry=s.height*a}else s=t.getBoundingClientRect(),i.rx=s.width,i.ry=s.height;return this.nodes[this.nodes.length-1].ellipse=i,void(this.nodes[this.nodes.length-1].tag="ellipse");case"polygon":let n=t.getAttribute("data-shape").split(",");const r={w:Number(n[0]),h:Number(n[1])};let a=[];return t.getAttribute("points").split(" ").forEach((e=>{let t=e.split(",");a.push({x:Number(t[0]),y:Number(t[1]),rW:Number(t[0])/r.w,rH:Number(t[1])/r.h})})),i.points=a,this.nodes[this.nodes.length-1].polygon=i,this.nodes[this.nodes.length-1].tag="polygon",console.log("Schema"),void console.log(i)}s=e.getBoundingClientRect(),i.width=s.width/2,i.height=s.height/2,this.nodes[this.nodes.length-1].rect=i,this.nodes[this.nodes.length-1].tag="svg"},adjustShape(e,t,i,s){switch(t.tag){case"ellipse":const n={};return n.rx=t.ellipse.rx*i,n.ry=t.ellipse.ry*s,e.ellipse=n,void(e.tag="ellipse");case"rect":case"svg":const r={};return r.width=t.rect.width*i,r.height=t.rect.height*s,e.rect=r,void(e.tag="svg")}},adapt(e,t=.5){this.adaptForeign(e.parentNode,e),this.adaptSVG(e.parentNode.parentNode,e.parentNode,t)},createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return t.appendChild(i),i.appendChild(e),t},createItemRoot(e,t){t.item;let i=this.model.createProjection(e);return i.optional=!0,{item:i.init().render(),id:i.element.source.id}},createItem(e,t){t.item;let i=this.model.createProjection(e);i.optional=!0,i.parent=this.projection;let s=i.init().render();return this.instances.set(i.element.source.id,s),s},removeItem(e){this.force.stop();let t=this.holders.get(this.instances.get(e.id));this.nodes.splice(t.id,1),t.remove();for(let t=0;t<this.arrowInventory.length;t++)this.arrowInventory[t].deleteRef(e,t);this.restart()},removeDummy(e){for(let t=0;t<this.dummies.length;t++){let i=this.dummies[t];i.ref===e&&(i.item.remove(),this.dummies.splice(t,1),t--)}for(let t=0;t<this.nodes.length;t++)this.nodes[t].ref===e&&(this.nodes.splice(t,1),t--)},removeArrow(e,t=-1){let i,s;this.force.stop();for(let t=0;t<this.links.length;t++)if(this.links[t].cID===e.id){i=this.links[t].ref,s=this.links[t].dummy,this.links.splice(t,1);break}f(i)?this.restart():(this.removeDummy(i),e.element.remove(),t>0?this.arrowInventory.splice(t,1):this.restart())},adaptForeign(e,t){t.style.width="fit-content";let i=t.getBoundingClientRect();e.setAttribute("width",i.width),e.setAttribute("height",i.height)},adaptSVG(e,t,i=.4){e.setAttribute("width",Number(t.getAttribute("width"))*i),e.setAttribute("height",Number(t.getAttribute("height"))*i),e.setAttribute("viewBox","0 0 "+t.getAttribute("width")+" "+t.getAttribute("height"))},adaptSVGSimple(e,t,i,s){e.setAttribute("width",i),e.setAttribute("height",s),e.setAttribute("viewBox","0 0 "+t.getAttribute("width")+" "+t.getAttribute("height"))},ticked(){var e=this.computeBorders,t=this.computeSelfBorders,i=this.adjustShape,s=Ir.getPerpendicularLine,n=Ir.getPointConstructedEllipse,r=Ir.getEllipseCenter,o=this.svgArea,l=this.linkInventory;let h=this.links,c=this.width,d=this.height;this.link.attr("d",(function(i){if(i.source!==i.target){let t=e(i,i.source,i.target),s=e(i,i.target,i.source),n=s.x-t.x,r=s.y-t.y,a=Math.sqrt(n*n+r*r),o=l[i.source.index+","+i.target.index].length;return o>1&&(a/=1+1/o*(i.linkIndex-1)),i.source.points[i.sourceIndex]=t,i.target.points[i.targetIndex]=s,i.dr=a,i.s=t,i.t=s,"M"+s.x+","+s.y+"A"+a+","+a+" 0 0 1,"+t.x+","+t.y+"A"+a+","+a+" 0 0 0,"+s.x+","+s.y}{let e,s,n=t(i);switch(n.direction){case"top":e={x:-.03*c,y:-.05*d},s={x:.03*c,y:-.05*d};break;case"bot":e={x:-.03*c,y:.05*d},s={x:.03*c,y:.05*d};break;case"left":e={x:-.03*c,y:.05*d},s={x:-.03*c,y:-.05*d};break;default:e={x:.03*c,y:-.05*d},s={x:.03*c,y:.05*d}}return l[i.source.index+","+i.target.index].length>1&&(e.x=e.x*i.linkIndex,e.y=e.y*i.linkIndex,s.x=s.x*i.linkIndex,s.y=s.y*i.linkIndex),"M"+n.x+","+n.y+"c"+e.x+","+e.y+" "+s.x+","+s.y+" 0, 0"}}));let u=!0;for(;u;)this.nodes.forEach((e=>{this.nodes.forEach((t=>{u=this.collide(e,t)}))}));f(this.node)||this.node.attr("x",(function(e){if(!f(e.ref)){let t=r(h[e.ref].dr,h[e.ref].s,h[e.ref].t,o),i=s(h[e.ref].s,h[e.ref].t),a=n(i,h[e.ref].dr,h[e.ref].dr,t),l=Ir.getCloserBorder(a,h[e.ref].t);return e.fx=l.x,l.x-e.width/2}return(e.x=Math.max(e.width/2,Math.min(c-e.width/2,e.x)))-e.width/2})).attr("y",(function(e){if(!f(e.ref)){let t=r(h[e.ref].dr,h[e.ref].s,h[e.ref].t,o),i=s(h[e.ref].s,h[e.ref].t),a=n(i,h[e.ref].dr,h[e.ref].dr,t),l=Ir.getCloserBorder(a,h[e.ref].t);return e.fy=l.y,l.y-e.height/2}return(e.y=Math.max(e.height/2,Math.min(d-e.height/2,e.y)))-e.height/2})).attr("id",(function(e){return f(e.ref),e.index})),a(this.transLink)||this.transLink.forEach((t=>{let s=t.arrow,n=t.source,r=t.target,a={};f(n.rW)?a=n.source:(a.x=n.source.x*n.rW+n.base.x-n.base.width/2,a.y=(n.source.y+n.off)*n.rH+n.base.y-n.base.height/2,i(a,n.source,n.rW,n.rH));let o={};f(r.rW)?o=r.source:(o.x=r.source.x*r.rW+r.base.x-r.base.width/2,o.y=(r.source.y+r.off)*r.rH+r.base.y-r.base.height/2,i(o,r.source,r.rW,r.rH));let l=e(t,a,o),h=e(t,o,a),c=h.x-l.x,d=h.y-l.y,u=Math.sqrt(c*c+d*d);s.setAttribute("d","M"+h.x+","+h.y+"A"+u+","+u+" 0 0 1,"+l.x+","+l.y+"A"+u+","+u+" 0 0 0,"+h.x+","+h.y)}))},collide(e,t){if(!f(e.ref))return console.log(e.ref),!1;if(!f(t.ref)&&t!==e)if(console.log(e.ref),e.x<t.fx&&e.y<t.fy&&e.x+e.width/2>t.fx-t.width/2&&e.y+e.height/2>t.fx-t.height/2){console.log("hoho1");let i=e.x+e.width/2-(t.fx-t.width/2),s=1.1*(e.y+e.height/2-(t.fy-t.height/2));switch(Math.min(i,s)){case i:e.x-=i;break;case s:e.y-=s}}else if(e.x>t.fx&&e.y<t.fy&&t.fx+t.width/2>e.x-e.width/2&&e.y+e.height/2>t.fy-t.height/2){console.log("hoho2");let i=e.x+e.width/2-(t.fx-t.width/2),s=1.1*(e.y+e.height/2-(t.fy-t.height/2));switch(Math.min(i,s)){case i:e.x-=i;break;case s:e.y-=s}}else if(e.x>t.fx&&e.y>t.fy&&t.fx+t.width/2>e.x-e.width/2&&t.fy+t.height/2>e.y-e.height/2){console.log("hoho3");let i=t.fx+t.width/2-(e.x-e.width/2),s=1.1*(t.fy+t.height/2-(e.y-e.height/2));switch(Math.min(i,s)){case i:e.x+=i;break;case s:e.y+=s}}else if(e.x<t.fx&&e.y>t.fy&&e.x+e.width/2>t.fx-t.width/2&&e.y-e.height/2<t.fy+t.height/2){console.log("hoho4");let i=e.x+e.width/2-(t.fx-t.width/2),s=1.1*(t.fy+t.height/2-(e.y-e.height/2));switch(Math.min(i,s)){case i:e.x-=i;break;case s:e.y+=s}}if(t&&t!==e)if(e.x<t.x&&e.y<t.y&&e.x+e.width/2>t.x-t.width/2&&e.y+e.height/2>t.x-t.height/2){let i=e.x+e.width/2-(t.x-t.width/2),s=1.1*(e.y+e.height/2-(t.y-t.height/2));switch(Math.min(i,s)){case i:e.x-=i/2,t.x+=i/2;break;case s:e.y-=s/2,t.y+=s/2}}else if(e.x>t.x&&e.y<t.y&&t.x+t.width/2>e.x-e.width/2&&e.y+e.height/2>t.y-t.height/2){let i=t.x+t.width/2-(e.x-e.width/2),s=1.1*(e.y+e.height/2-(t.y-t.height/2));switch(Math.min(i,s)){case i:e.x+=i/2,t.x-=i/2;break;case s:e.y-=s/2,t.y+=s/2}}else if(e.x>t.x&&e.y>t.y&&t.x+t.width/2>e.x-e.width/2&&t.y+t.height/2>e.y-e.height/2){let i=t.x+t.width/2-(e.x-e.width/2),s=1.1*(t.y+t.height/2-(e.y-e.height/2));switch(Math.min(i,s)){case i:e.x+=i/2,t.x-=i/2;break;case s:e.y+=s/2,t.y-=s/2}}else if(e.x<t.x&&e.y>t.y&&e.x+e.width/2>t.x-t.width/2&&e.y-e.height/2<t.y+t.height/2){let i=e.x+e.width/2-(t.x-t.width/2),s=1.1*(t.y+t.height/2-(e.y-e.height/2));switch(Math.min(i,s)){case i:e.x-=i/2,t.x+=i/2;break;case s:e.y+=s/2,t.y-=s/2}}return!1},computeBorders(e,t,i){let s,n;switch(t.tag){case"ellipse":return s=Ir.getPointEllipse(t,i,t.ellipse),n=Ir.getCloserBorder(s,i),n;case"polygon":return n=Ir.getPointPolygon(t,i,t.polygon),n;case"rect":case"svg":return s=Ir.getPointRect(t,i,t.rect),n=Ir.getCloserBorder(s,i),n}},computeSelfBorders(e){switch(e.source.tag){case"ellipse":return Ir.getSelfPointEllipse(e.source);case"rect":case"svg":schema=Ir.getSelfPointRect(e.source)}},getRadius(e){let t=e.getAttribute("width"),i=e.getAttribute("height");return Math.sqrt(t/2*(t/2)+i/2*(i/2))},accept(e,t,i){let s=this.instances.get(e),n=this.environment.findReceiverInstance(e,this.projection.rtags[0]),r=this.instances.get(t),a=this.environment.findReceiverInstance(t,this.projection.rtags[0]);if(this.environment.getRootReceiver(this.projection.rtags[0]).checkTransLinkId(i))return void this.environment.getRootReceiver(this.projection.rtags[0]).acceptTransArrow(i,n,a,e,t);if(n.container!=this||a.container!=this)return n.container===a.container?void n.container.accept(e,t,i):void this.environment.getRootReceiver(this.projection.rtags[0]).acceptTransArrow(i,n,a,e,t);let o=Number(s.parentNode.parentNode.id),l=Number(r.parentNode.parentNode.id),h=this.checkValue(i.id,i.source.id,o,l);if(-2!==h){if(this.linksArea.append(i.element),i.definitions&&this.definitionsArea.append(i.definitions),i.element.classList.add("link"+this.id),h>=0){let e=this.links[h].target,t=this.links[h].source;return this.linkInventory[t.index+","+e.index]=this.linkInventory[t.index+","+e.index].filter((e=>e!==i.id)),this.links[h].target=l,this.links[h].source=o,f(this.linkInventory[o+","+l])?(this.linkInventory[o+","+l]=[i.id],this.links[this.links.length-1].linkIndex=1):(this.linkInventory[o+","+l].push(i.id),this.links[this.links.length-1].linkIndex=this.linkInventory[o+","+l].length),void this.restart()}if(this.links.push({source:o,target:l,cID:i.id,concept:i.source.id,ref:this.links.length}),o!==l?(this.nodes[o].nbLink++,this.nodes[l].nbLink++,this.links[this.links.length-1].sourceIndex=this.nodes[o].nbLink,this.links[this.links.length-1].targetIndex=this.nodes[l].nbLink):(this.nodes[o].nbLink++,this.links[this.links.length-1].sourceIndex=this.nodes[o].nbLink),this.nodes.push({ref:this.links.length-1,fixed:!0,width:.1*this.height,height:.1*this.height}),this.arrowInventory.push(i),f(this.linkInventory[o+","+l])?(this.linkInventory[o+","+l]=[i.id],this.links[this.links.length-1].linkIndex=1):(this.linkInventory[o+","+l].push(i.id),this.links[this.links.length-1].linkIndex=this.linkInventory[o+","+l].length),i.decorator)this.decoratorHandler(i.decorator),this.links[this.links.length-1].dummy=!1;else{let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("node"+this.id),this.nodesArea.append(e),this.dummies.push({item:e,ref:this.links.length-1}),this.links[this.links.length-1].dummy=!0,this.ids.push(e)}this.restart()}},acceptTransArrow(e,t,i,s,n){let r={};if(this.transLinkId.includes(e.id)){let r,a;for(a=0;a<this.transLink.length;a++)if(this.transLink[a].arrow===e.element){r=this.transLink[a];break}let o={};if(t.container===i.container){for(this.transLink.splice(a,1),a=0;a<this.transLinkId.length;a++)if(this.transLinkId[a]===e.id){this.transLinkId.splice(a,1);break}return void t.container.accept(s,n,e)}t.container!=this?this.setTransSchema(o,t):o.source=this.nodes[Number(t.instance.parentNode.parentNode.id)];let l={};i.container!=this?this.setTransSchema(l,i):l.source=this.nodes[Number(i.instance.parentNode.parentNode.id)],this.transLink[a]={arrow:e.element,source:o,target:l,s,t:n}}else{this.transLinkId.push(e.id),t.container!=this?this.setTransSchema(r,t):r.source=this.nodes[Number(t.instance.parentNode.parentNode.id)];let a={};i.container!=this?this.setTransSchema(a,i):a.source=this.nodes[Number(i.instance.parentNode.parentNode.id)],this.linksArea.append(e.element),e.definitions&&this.definitionsArea.append(e.definitions),this.transLink.push({arrow:e.element,source:r,target:a,s,t:n})}this.restart()},setTransSchema(e,t){let i=t.container,s=t.container.container.parentNode.parentNode,n=t.container.container.parentNode,r=Number(s.getAttribute("width"))/Number(n.getAttribute("width")),a=Number(s.getAttribute("height"))/Number(n.getAttribute("height")),o=Number(n.getAttribute("height"))-i.height;e.rH=a,e.rW=r,e.off=o,e.base=this.nodes[Number(s.id)],e.source=i.nodes[Number(t.instance.parentNode.parentNode.id)]},checkTransLinkId(e){let t=!1;return this.transLinkId.forEach((i=>{i!==e.id||(t=!0)})),t},decoratorHandler(e,t=1){let i=this.createHolder(e);this.nodesArea.append(i),this.adapt(e,t),i.classList.add("node"+this.id),this.nodes[this.nodes.length-1].width=Number(i.getAttribute("width")),this.nodes[this.nodes.length-1].height=Number(i.getAttribute("height")),this.ids.push(i)},checkValue(e,t,i,s){for(let e=0;e<this.links.length;e++){if(this.links[e].concept===t&&this.links[e].target.index===s&&this.links[e].source.index===i)return-2;if(this.links[e].concept===t)return e}return-1},focus(){return this.container.focus(),this},focusIn(){return this.focused=!0,this.container.classList.add("active"),this.container.classList.add("focus"),this.container.focus(),this},focusOut(){return this.focused=!1,this.container.classList.remove("active"),this.container.classList.remove("focus"),this},enterHandler(){this.focused&&this.interactionsArea.focus()},bindEvents(){this.svgArea.addEventListener("click",(e=>{const{target:t}=e;t===this.svgArea&&(this.svgArea.classList.add("active"),this.svgArea.classList.add("focus"),this.svgArea.focus())}))}},Ir={getPointEllipse(e,t,i){const s=i.rx/2,n=i.ry/2,r=e.x,a=e.y,o=this.getDeq(e,t);let l=n*n+s*s*o.a*o.a,h=2*s*s*o.a*o.b-2*r*n*n-2*a*o.a*s*s,c=h*h-4*l*(r*r*n*n+s*s*a*a+s*s*o.b*o.b-2*a*s*s*o.b-s*s*n*n);if(c>=0){let e=(-h-Math.sqrt(c))/(2*l),t=e*o.a+o.b,i=(-h+Math.sqrt(c))/(2*l);return{x1:{x:e,y:t},x2:{x:i,y:i*o.a+o.b}}}console.log("Nothing found")},getPointConstructedEllipse(e,t,i,s){const n=t,r=i,a=s.x,o=s.y;let l=r*r+n*n*e.a*e.a,h=2*n*n*e.a*e.b-2*a*r*r-2*o*e.a*n*n,c=h*h-4*l*(a*a*r*r+n*n*o*o+n*n*e.b*e.b-2*o*n*n*e.b-n*n*r*r);if(c>=0){let t=(-h-Math.sqrt(c))/(2*l),i=t*e.a+e.b,s=(-h+Math.sqrt(c))/(2*l);return{x1:{x:t,y:i},x2:{x:s,y:s*e.a+e.b}}}},getEllipseCenter(e,t,i,s){let n=(t.x-i.x)/2,r=(t.y-i.y)/2,a=-Math.sqrt((e*e*(e*e)-e*e*(r*r)-e*e*(n*n))/(e*e*(r*r)+e*e*n*n)),o=a*(-e*n/e);return{x:a*(e*r/e)+(t.x+i.x)/2,y:o+(t.y+i.y)/2}},getPerpendicularLine(e,t){let i=(e.x+t.x)/2,s=(e.y+t.y)/2,n=-1/Ir.getDeq(e,t).a;return{a:n,b:s-n*i}},getSelfPointEllipse(e){let t={x:e.x-e.ellipse.rx/2,y:e.y},i={x:e.x+e.ellipse.rx/2,y:e.y},s={x:e.x,y:e.y-e.ellipse.ry/2},n={x:e.x,y:e.y-e.ellipse.ry/2},r=0,a=0,o=0,l=0;switch(e.points.forEach((e=>{r+=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),a+=Math.sqrt((e.x-i.x)*(e.x-i.x)+(e.y-i.y)*(e.y-i.y)),o+=Math.sqrt((e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y)),l+=Math.sqrt((e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y))})),Math.max(r,a,o,l)){case o:return{x:s.x,y:s.y,direction:"top"};case a:return{x:i.x,y:i.y,direction:"right"};case l:return{x:n.x,y:n.y,direction:"bot"};default:return{x:t.x,y:t.y,direction:"left"}}},getPointPolygon(e,t,i){let s=[];i.points.forEach((t=>{s.push({x:t.rW*e.width+e.x-e.width/2,y:t.rH*e.height+e.y-e.height/2})}));let n=s[0].x-t.x,r=s[0].y-t.y,a=Math.sqrt(n*n+r*r),o=a,l=0;for(let e=1;e<s.length;e++)n=s[e].x-t.x,r=s[e].y-t.y,a=Math.sqrt(n*n+r*r),a<o&&(o=a,l=e);return s[l]},getPointRect(e,t,i){const s={};let n=this.getDeq(e,t),r=(e.x-i.width)*n.a+n.b,a=(e.x+i.width)*n.a+n.b;if(r>=e.y-i.height&&r<=e.y+i.height)return s.x1={x:e.x-i.width,y:r},s.x2={x:e.x+i.width,y:a},s;let o=(e.y-i.height-n.b)/n.a,l=(e.y+i.height-n.b)/n.a;return o>=e.x-i.width&&l<=e.x+i.width?(s.x1={x:o,y:e.y-i.height},s.x2={x:l,y:e.y+i.height},s):void 0},getDeq(e,t){let i=(t.y-e.y)/(t.x-e.x);return{a:i,b:e.y-i*e.x}},getCloserBorder(e,t){let i=Math.sqrt((e.x1.x-t.x)*(e.x1.x-t.x)+(e.x1.y-t.y)*(e.x1.y-t.y));return Math.sqrt((e.x2.x-t.x)*(e.x2.x-t.x)+(e.x2.y-t.y)*(e.x2.y-t.y))<i?e.x2:e.x1}},Sr=Object.assign({},Lr,kr),Or={init(){return this.width=r(this.schema.dimensions.width,500),this.height=r(this.schema.dimensions.height,500),this.buttons=[],this.anchors=new Map,this.items={},this.patterns=[],this.augmentCount=0,this.anchorIndex=0,this.arrowInventory=new Map,this.childs=new Map,this.holders=new Map,this},render(){const{pattern:e,dimensions:t,arrow:i,attributes:s,anchorAttr:n}=this.schema,r=H();if(L(this.container)||(this.container=W({class:["pattern-container"],dataset:{nature:"algorithm",algorithm:"pattern",id:this.id},tabindex:1})),L(this.interactionsArea)||(this.interactionsArea=W({class:["layout-container","projection"],dataset:{nature:"layout",layout:"flex",orientation:"row",id:"iA"+this.id,projection:-1},tabindex:1}),r.append(this.interactionsArea),this.interactionsArea.style.backgroundColor="white"),!a(s)&&f(this.attributes)&&(this.attributes=[],s.forEach((e=>{let t=Zn.call(this,e);this.attributes.push(t),this.interactionsArea.append(t)}))),!f(e.size.ratio)&&f(this.patternInventory)){this.patternInventory=new Map,this.anchorInventory=new Map;let t=Zn.call(this,e.attribute),i=this.environment.resolveElement(t);i.buttonIndex=this.buttons.length,this.buttons.push(i),this.registerPattern(e,t),this.interactionsArea.append(t)}return!a(n)&&f(this.anchorAttr)&&(this.anchorAttr=new Map,n.forEach((e=>{let t=Zn.call(this,e.attribute);this.anchorAttr.set(t,e.placement),this.registerPattern(e,t),this.interactionsArea.append(t)}))),L(this.svgArea)||(this.svgArea=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgArea.setAttribute("width",this.width),this.svgArea.setAttribute("height",this.height),this.arrowsArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgArea.append(this.arrowsArea),this.arrowsArea.classList.add("arrowArea"),this.definitionsArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgArea.append(this.definitionsArea),this.definitionsArea.classList.add("definitionArea"),this.patternArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgArea.append(this.patternArea),this.waitingArea=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgArea.append(this.waitingArea),r.appendChild(this.svgArea)),f(this.openArrow)&&!f(i)&&(this.openArrow=W({class:["button-container","projection"],dataset:{nature:"layout",layout:"flex",id:"iA"+this.id,projection:-1},tabindex:1}),this.openArrow.innerHTML=i.content,this.openArrow.addEventListener("click",(e=>{let t=this.environment.findWindow("side-instance");f(t)&&(t=this.environment.createWindow("side-instance"),t.container.classList.add("model-projection-sideview")),t.instances.size>0&&Array.from(t.instances)[0].delete(),i.attribute.forEach((e=>{let i=this.source.getAttributeByName(e.dynamic.name).target,s=this.environment.createProjection(i,e.dynamic.tag),n=this.environment.createInstance(i,s,{type:"projection",close:"DELETE-PROJECTION"});t.addInstance(n)})),f(i.ranking)||(this.orderRef=i.ranking.target,this.order=i.ranking.order,this.setOrderFunctions()),this.environment.setActiveReceiver(this,this.projection.rtags[0])})),this.interactionsArea.append(this.openArrow)),r.hasChildNodes()&&this.container.append(r),this.container},registerPattern(e,t){let i={},s=e.placement,n={};switch(s.type){case"evolutive-anchors":n.type="fixed",n.current={x:s.first.x,y:s.first.y},n.next={x:s.next.x,y:s.next.y},i.placement=n,console.log(i.placement);break;case"anchor-based":n.type="duo",n.from="start",n.to="end",i.placement=n}if(e.size){let t=e.size,s={};switch(t.type){case"ratio-sized":s.type="parent",s.ratio=t.ratio;break;case"absolute-sized":s.type="auto",s.ratio=t.ratio;break;case"inherited-size":s.type="relative",s.marker=t.marker,s.property=t.property}i.size=s}this.patternInventory.set(t,i),this.anchorInventory.set(t,{data:{first:{x:.5,y:.5},next:{x:0,y:40}},inventory:new Map})},setOrderFunctions(){switch(this.order){case"Ascending":this.acceptOrder=this.acceptAscending,this.modifyOrder=this.modifyAscending;break;case"Descending":break;case"MinMax":this.acceptOrder=this.acceptMinMax,this.modifyOrder=this.modifyMinMax}},createItem(e,t){const i=t.item;if(!this.model.hasProjectionSchema(e,i.tag))return"";let s=this.model.createProjection(e,i.tag);return s.optional=!0,s.parent=this.projection,s.init().render()},addItem(e,t){let i=this.patternInventory.get(t.element),s={x:0,y:0},n=this.computePlacement(i,s);if(n)return void this.addToWaitingList(t,i.placement,e);let r=this.createItem(e,t),a=this.createHolder(r);if(f(this.refHolder)&&!n&&(this.refHolder=a),a.setAttribute("x",s.x),a.setAttribute("y",s.y),a.dataset.source=e.id,a.dataset.buttonIndex=t.buttonIndex,f(this.items[t.element])&&(this.items[t.element]=[]),a.dataset.items=this.items[t.element].length,this.items[t.element].push(a),this.patternArea.append(a),this.patterns.push(e.id),this.holders.set(e.id,a),this.adapt(r,i.size),this.registerAnchor(this.anchorInventory.get(t.element),a,e),this.augmentCount>0){let e=a;for(let t=0;t<this.augmentCount;t++)e=this.augmentItem(e);for(let t=0;t<this.anchorIndex;t++)this.nextAnchor(e.dataset.source)}},computePlacement(e,t){let i=e.placement;switch(i.type){case"fixed":t.x=i.current.x,t.y=i.current.y;let s=i.current;return s.x+=i.next.x,s.y+=i.next.y,e.placement.current=s,!1;case"duo":return!0}},computePlacementChild(e,t,i,s,n){let r=this.anchors.get(i),a=this.anchors.get(s),o=this.findFreeIndex(r,a);if(-1===o){let e=this.nextAnchor(i);if(a.index<e){let t=a.index;for(;t<e;)t=this.nextAnchor(s)}o=e,r=this.anchors.get(i),a=this.anchors.get(s)}let l=r.indexes[o],h=a.indexes[o],c=l.x-h.x,d=l.y-h.y,u=Math.sqrt(c*c+d*d);return n.updateWidth(u),n.updateHeight(r.next.y),this.adaptSimple(t,u),e.setAttribute("x",Math.min(l.x,h.x)),e.setAttribute("y",Math.min(l.y,h.y)),e.style.boder="solid black 3",this.svgArea.append(e),this.registerAnchorOccupation(i,o),this.registerAnchorOccupation(s,o),o},addToWaitingList(e,t,i){f(this.waiting)&&(this.waiting=[]);let s=this.environment.findWindow("side-instance");f(s)&&(s=this.environment.createWindow("side-instance"),s.container.classList.add("model-projection-sideview")),s.instances.size>0&&Array.from(s.instances)[0].delete();let n=i,r=this.environment.createProjection(n,e.item.tag),a=this.environment.createInstance(n,r,{type:"projection",close:"DELETE-PROJECTION"});s.addInstance(a),console.log(r),console.log(n),n.getAttributeByName(t.from).target.register(r),n.getAttributeByName(t.to).target.register(r),r.registerHandler("value.changed",(e=>{this.notifyValue(r)})),this.waiting.push({projection:r,from:t.from,to:t.to})},setForWaiting(e,t,i,s){this.interactionsArea.appendChild(i.interactionsArea),this.adaptForWaiting(i.interactionsArea,t),this.waitingRoom.append(e),i.registerWaiter(this,s)},registerAnchor(e,t,i){let s=e.data;{s.type;let n={x:t.x.baseVal.value+e.data.first.x*t.width.baseVal.value,y:t.y.baseVal.value+e.data.first.y*t.height.baseVal.value},r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",n.x),r.setAttribute("cy",n.y),r.setAttribute("r",3),r.style.fill="red",this.svgArea.append(r),this.anchors.set(i.id,{current:n,next:s.next,index:0,free:[0],indexes:[n]})}},nextAnchor(e,t=!0){let i=this.anchors.get(e),s={x:i.current.x,y:i.current.y};s.x+=i.next.x,s.y+=i.next.y;let n=i.index+1,r=i.indexes;r.push(s);let a=i.free;return a.push(i.index+1),this.anchors.set(e,{current:s,next:i.next,indexes:r,index:n,free:a}),n>this.anchorIndex&&(this.anchorIndex=n),t&&this.checkAugment(this.holders.get(e)),n},nextAnchorChild(e,t){let i=this.childAnchors.get(t),s=i.get(e),n=s.current;n.x+=s.next.x,n.y+=s.next.y;let r=s.index+1,a=s.indexes;a.push(n);let o=s.free;return o.push(s.index+1),i.set(e,{current:n,next:s.next,index:s.index+1,free:o,indexes:a}),this.childAnchors.set(t,i),r},createHolder(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return t.appendChild(i),i.appendChild(e),t},adapt(e,t){this.adaptForeign(e.parentNode,e),this.adaptSVG(e.parentNode.parentNode,e.parentNode,t)},adaptSimple(e,t){this.adaptForeign(e.parentNode,e),this.adaptSVGSimple(e.parentNode.parentNode,e.parentNode,t)},adaptForeign(e,t){t.style.width="fit-content";let i=t.getBoundingClientRect();e.setAttribute("width",i.width),e.setAttribute("height",i.height)},adaptSVG(e,t,i){let s=Number(t.getAttribute("width")),n=Number(t.getAttribute("height"));switch(e.setAttribute("viewBox","0 0 "+s+" "+n),i.type){case"parent":let t=this.width*i.ratio,r=n*(t/s);e.setAttribute("width",t),e.setAttribute("height",r);break;case"auto":e.setAttribute("width",s*i.ratio),e.setAttribute("height",n*i.ratio);break;case"relative":let a=this.items[this.buttons[0].element][0].dataset.source,o=this.items[this.buttons[0].element][3].dataset.source,l=this.findFreeIndex(this.anchors.get(a),this.anchors.get(o));this.registerAnchorOccupation(a,l),this.registerAnchorOccupation(o,l);let h=this.anchors.get(a),c=this.anchors.get(o),d=h.indexes[l],u=c.indexes[l];this.adaptRelative(e,d,u,i)}},adaptSVGSimple(e,t,i){e.setAttribute("width",i),e.setAttribute("height",i/Number(t.getAttribute("width"))*Number(t.getAttribute("height"))),e.setAttribute("viewBox","0 0 "+t.getAttribute("width")+" "+t.getAttribute("height"))},adaptRatioSVG(e,t,i){e.setAttribute("width",this.width*i),e.setAttribute("height",this.width*i*Number(t.getAttribute("height"))/Number(t.getAttribute("width"))),e.setAttribute("viewBox","0 0 "+t.getAttribute("width")+" "+t.getAttribute("height"))},adaptForWaiting(e,t){let i=e.getBoundingClientRect(),s=t.parentNode;s.setAttribute("width",400),s.setAttribute("height",i.height+100);let n=s.parentNode;n.setAttribute("width",400),n.setAttribute("height",i.height+100),n.setAttribute("viewBox","0 0 400 "+i.height+100),this.waitingRoom.setAttribute("width",400),this.waitingRoom.setAttribute("height",i.height+100),t.remove(),s.appendChild(e)},focusIn(){},focusOut(){},clickHandler(e){},updateWidth(e){this.width=e,this.svgArea.setAttribute("width",e)},updateHeight(e){this.height=e,this.svgArea.setAttribute("height",e)},augmentItem(e){this.local(e.querySelector("svg")),e.remove();let t=this.createHolder(e.childNodes[0].childNodes[0]);t.setAttribute("x",Number(e.getAttribute("x"))),t.setAttribute("y",Number(e.getAttribute("y"))),t.dataset.source=e.dataset.source,t.dataset.buttonIndex=e.dataset.buttonIndex,t.dataset.items=e.dataset.items,this.items[this.buttons[t.dataset.buttonIndex].element][t.dataset.items]=t,this.patternArea.append(t);let i=this.patternInventory.get(this.buttons[Number(t.dataset.buttonIndex)].element);return this.adapt(t.childNodes[0].childNodes[0],i.size),this.holders.set(e.dataset.source,t),t},local(e){let t=e.querySelector("[data-extension]"),i=t.getAttribute("data-extension"),s=Number(t.getAttribute(i)),n=Number(t.getAttribute("data-add"));t.setAttribute(i,s+n),this.arrange(e,i,n)},arrange(e,t,i){switch(t){case"height":e.height.baseVal.valueInSpecifiedUnits+=i,e.viewBox.baseVal.height+=i;break;case"width":e.width.baseVal.valueInSpecifiedUnits+=i,e.viewBox.baseVal.width+=i}},augmentChild(e,t){let i=e.container.parentNode,s=i.parentNode;s.setAttribute("height",Number(s.getAttribute("height"))+t.y);let n=Number(s.getAttribute("height")),r=Number(i.getAttribute("width")),a=r/Number(s.getAttribute("width"))*n;i.setAttribute("height",a),s.setAttribute("viewBox","0 0 "+r+" "+a),(s.x.baseVal.value+s.width.baseVal.value>this.refHolder.width.baseVal.value||s.y.baseVal.value+s.height.baseVal.value>this.refHolder.height.baseVal.value)&&this.items[this.buttons[0].element].forEach((e=>{this.augmentItem(e)}))},arrangeAbsolute(e,t,i){switch(t){case"height":e.height.baseVal.valueInSpecifiedUnits=i,e.viewBox.baseVal.height=i;break;case"width":e.width.baseVal.valueInSpecifiedUnits=i,e.viewBox.baseVal.width=i}},branch(){this.buttons.forEach((e=>{e.refresh()}))},checkAugment(e){let t=this.anchors.get(e.dataset.source);if(e.x.baseVal.value+e.width.baseVal.value<t.current.x||e.y.baseVal.value+e.height.baseVal.value<t.current.y){let i=this.augmentItem(e);this.augmentCount++,this.items[this.buttons[e.dataset.buttonIndex].element].filter((e=>e!==i)).forEach((e=>{for(;this.nextAnchor(e.dataset.source,!1)<t.index;);this.augmentItem(e)})),this.refHolder=this.items[this.buttons[e.dataset.buttonIndex].element][0]}},checkForChildGrowth(e,t,i){let s=this.childs.get(e);(s.x.baseVal.value+s.width.baseVal.value<t.x||s.y.baseVal.value+s.height.baseVal.value<t.y)&&this.augmentChild(e,i)},accept(e,t,i){let s,n;if(!f(this.targetWaiter))return void this.targetWaiter.acceptAsChild(e,t,i,this);let r=this.arrowInventory.get(i.source.id);if(!f(r)){if(r.projID!==i.id)return;return void this.modifyArrow(e,t,i,r.index)}if(!f(this.orderRef))return void this.acceptOrder(e,t,i);let o=this.anchors.get(e),l=this.anchors.get(t);if(e===t){let s;return a(o.free)?(s=this.nextAnchor(e),o=this.anchors.get(e)):s=o.free[0],i.setPath("M "+o.indexes[s].x+" "+o.indexes[s].y+"l 30 0 l 0 20 l -30 0"),i.definitions&&this.definitionsArea.append(i.definitions),this.arrowsArea.append(i.element),void this.registerArrow(e,t,i,h)}let h=this.findFreeIndex(o,l);if(-1===h){let s=this.nextAnchor(e);if(l.index<s){let n=l.index;for(;n<s;)n=this.nextAnchor(t);return this.accept(e,t,i)}}s=o.indexes[h],n=l.indexes[h],i.setLine(s,n),i.definitions&&this.definitionsArea.append(i.definitions),this.arrowsArea.append(i.element),i.decorator&&(this.createDecorator(i),this.placeDecorator(i,s,n,i.decorator.parentNode.parentNode)),this.registerArrow(e,t,i,h)},acceptAscending(e,t,i){i.register(this.orderRef);let s,n,r=i.get(this.orderRef);f(r)||(s=this.findAnchorIndex(e,r),n=this.findAnchorIndex(t,r),i.setLine(s,n),i.definitions&&this.definitionsArea.append(i.definitions),i.decorator&&(this.createDecorator(i),this.placeDecorator(i,s,n,i.decorator.parentNode.parentNode)),this.arrowsArea.append(i.element),this.registerArrowOrder(e,t,i,r))},modifyAscending(e,t,i){let s=i.get(this.orderRef);if(f(s))return void i.remove();let n=this.findAnchorIndex(e,s),r=this.findAnchorIndex(t,s);i.setLine(n,r),i.definitions&&this.definitionsArea.append(i.definitions),this.arrowsArea.append(i.element),this.registerArrowOrder(e,t,i,s),this.placeDecorator(i,n,r,i.decorator.parentNode.parentNode)},acceptMinMax(e,t,i){i.register(this.orderRef);let s,n,r,a=i.get(this.orderRef);if(!f(a)){if(f(this.orderRanking))this.orderRanking=[{value:a,arrow:i}],s=0;else{let e=this.injectOrderMinMax(a,i);s=e.index,e.move&&this.moveAfterMinMax(e.index)}if(e===t)return n=this.findAnchorIndex(e,s),i.setPath("M "+n.x+" "+n.y+"l 30 0 l 0 20 l -30 0"),this.arrowsArea.append(i.element),i.definitions&&this.definitionsArea.append(i.definitions),void this.registerArrowOrder(e,t,i,s);n=this.findAnchorIndex(e,s),r=this.findAnchorIndex(t,s),i.setLine(n,r),i.definitions&&this.definitionsArea.append(i.definitions),i.decorator&&(this.createDecorator(i),this.placeDecorator(i,n,r,i.decorator.parentNode.parentNode)),this.arrowsArea.append(i.element),this.registerArrowOrder(e,t,i,s)}},injectOrderMinMax(e,t){let i=0;for(;i<this.orderRanking.length&&this.orderRanking[i].value<e;)i++;return i===this.orderRanking.length?(this.orderRanking.push({value:e,arrow:t}),{index:i,move:!1}):(this.orderRanking.splice(i,0,{value:e,arrow:t}),{index:i,move:!0})},moveAfterMinMax(e){for(let t=e+1;t<this.orderRanking.length;t++){let e,i,s=this.orderRanking[t],n=this.arrowInventory.get(s.arrow.source.id),r=s.arrow,a=this.anchors.get(n.source),o=this.anchors.get(n.target);for(;a.index<t;)this.nextAnchor(n.source),a=this.anchors.get(n.source);if(n.source===n.target)a.indexes[t],r.setPath("M "+e.x+" "+e.y+"l 30 0 l 0 20 l -30 0");else{for(;o.index<t;)this.nextAnchor(n.target),o=this.anchors.get(n.target);e=a.indexes[t],i=o.indexes[t],r.setLine(e,i),r.decorator&&this.placeDecorator(r,e,i,r.decorator.parentNode.parentNode)}n.index=t}},moveBeforeMinMax(e,t){for(let i=e-1;i>=t;i--){let e,t,s=this.orderRanking[i],n=this.arrowInventory.get(s.arrow.source.id),r=s.arrow,a=this.anchors.get(n.source);if(n.source===n.target)a.indexes[i],r.setPath("M "+e.x+" "+e.y+"l 30 0 l 0 20 l -30 0");else{let s=this.anchors.get(n.target);e=a.indexes[i],t=s.indexes[i],r.setLine(e,t),r.decorator&&this.placeDecorator(r,e,t,r.decorator.parentNode.parentNode)}n.index=i}},modifyMinMax(e,t,i){let s=i.get(this.orderRef);if(1===this.orderRanking.length)return;let n=0;for(;n<this.orderRanking.length&&this.orderRanking[n].arrow.id!==i.id;)n++;this.orderRanking.splice(n,1);let r=this.injectOrderMinMax(s,i);r.index<this.orderRanking.length-1&&this.moveAfterMinMax(r.index),r.index>n&&this.moveBeforeMinMax(r.index,n);let a=this.anchors.get(e),o=this.anchors.get(t);for(;a.index<r.index;)this.nextAnchor(e),a=this.anchors.get(e);if(e===t){let n=a.indexes[r.index];return i.setPath("M "+n.x+" "+n.y+"l 30 0 l 0 20 l -30 0"),void this.registerArrowOrder(e,t,i,s)}for(;o.index<r.index;)this.nextAnchor(t),o=this.anchors.get(t);let l=a.indexes[r.index],h=o.indexes[r.index];i.setLine(l,h),i.decorator&&this.placeDecorator(i,l,h,i.decorator.parentNode.parentNode),this.registerArrowOrder(e,t,i,s)},findAnchorIndex(e,t){let i=this.anchors.get(e);if(i.indexes.length<=t){for(let s=i.indexes.length;s<=t;s++)this.nextAnchor(e);i=this.anchors.get(e)}return i.indexes[t]},acceptAsChild(e,t,i,s){let n=this.childAnchors.get(s),r=n.get(e),a=n.get(t),o=this.findFreeIndex(r,a);if(-1===o){let i=this.nextAnchorChild(e,s);for(;a.index<i;)this.nextAnchorChild(t,s),n=this.childAnchors.get(s),a=n.get(t);n=this.childAnchors.get(s),r=n.get(e),a=n.get(t),o=i}let l=r.indexes[o],h=a.indexes[o];i.setLine(l,h),i.definitions&&this.definitionsArea.append(i.definitions),this.arrowsArea.append(i.element),this.checkForChildGrowth(s,l,r.next),this.registerAnchorOccupationChild(e,s,o),this.registerAnchorOccupationChild(t,s,o)},modifyArrow(e,t,i,s){let n,r,a,o,l,h,c=this.arrowInventory.get(i.source.id);if((c.source!==e||c.target!==t)&&!c.order){if(this.freeAnchor(c.source,s),this.freeAnchor(c.target,s),n=this.anchors.get(e),r=this.anchors.get(t),a=this.findFreeIndex(n,r),-1===a){for(a=this.nextAnchor(e),o=r.index;o<a;)o=this.nextAnchor(t);n=this.anchors.get(e),r=this.anchors.get(t)}return l=n.indexes[a],h=r.indexes[a],i.setLine(l,h),this.arrowInventory.set(i.source.id,{source:e,target:t,index:a,projID:i.id}),this.registerAnchorOccupation(e,a),this.registerAnchorOccupation(t,a),void this.placeDecorator(i,l,h,i.decorator.parentNode.parentNode)}c.order&&this.modifyOrder(e,t,i,s)},registerArrow(e,t,i,s){this.arrowInventory.set(i.source.id,{source:e,target:t,index:s,projID:i.id}),this.registerAnchorOccupation(e,s),e!==t&&this.registerAnchorOccupation(t,s)},registerArrowOrder(e,t,i,s){this.arrowInventory.set(i.source.id,{source:e,target:t,index:s,projID:i.id,order:!0})},createDecorator(e){let t=this.createHolder(e.decorator);this.patternArea.append(t),this.adaptForeign(e.decorator.parentNode,e.decorator),this.adaptRatioSVG(e.decorator.parentNode.parentNode,e.decorator.parentNode,e.ratio)},placeDecorator(e,t,i,s){let n,r,a;switch(a=t.x<i.x?t:i,e.base){case"center":let e=t.x-i.x,o=t.y-i.y,l=Math.sqrt(e*e+o*o);n=a.x+l/2-Number(s.getAttribute("width"))/2,r=a.y-Number(s.getAttribute("height"));break;case"left":n=a.x+3,r=a.y-Number(s.getAttribute("height"));break;case"right":a=t.x>i.x?t:i,n=a.x-3-Number(s.getAttribute("width")),r=a.y-Number(s.getAttribute("height"))}s.setAttribute("x",n),s.setAttribute("y",r)},freeAnchor(e,t){let i=this.anchors.get(e),s=i.free;s.push(t),this.anchors.set(e,{current:i.current,next:i.next,index:i.index,free:s,indexes:i.indexes})},registerAnchorOccupation(e,t){let i,s=this.anchors.get(e),n=s.free;for(let e=0;e<n.length;e++)if(n[e]===t){i=e;break}n.splice(i,1),this.anchors.set(e,{current:s.current,next:s.next,index:s.index,free:n,indexes:s.indexes})},registerAnchorOccupationChild(e,t,i){let s,n=this.childAnchors.get(t),r=n.get(e),a=r.free;for(let e=0;e<a.length;e++)if(a[e]===i){s=e;break}a.splice(s,1),n.set(e,{current:r.current,next:r.next,index:r.index,free:a,indexes:r.indexes}),this.childAnchors.set(n)},findFreeIndex(e,t){for(let i=0;i<e.free.length;i++){let s=e.free[i];if(t.free.includes(s))return s}return-1},removeArrow(e){e.element.remove(),e.decorator&&e.decorator.parentNode.parentNode.remove();let t=this.arrowInventory.get(e.source.id);f(t)||(this.freeAnchor(t.source,t.index),this.freeAnchor(t.target,t.index),this.arrowInventory.delete(e.source.id))},registerWaiter(e){this.targetWaiter=e,this.attributes[0].addEventListener("click",(t=>{this.exit(e)})),this.attributes[1].addEventListener("click",(t=>{this.exit(e)}))},setValues(){f(this.source.getAttributeByName("to").target.value)||(this.valTarget=this.source.getAttributeByName("to").target.value),f(this.source.getAttributeByName("from").target.value)||(this.valSource=this.source.getAttributeByName("from").target.value)},exit(e){this.setValues(),this.tryToExit(e)},joinSvgArea(e,t,i){console.log("Exiting"),console.log(e),console.log(t),console.log(i);let s=e.element;s.svgArea.remove();let n=this.createHolder(s.container),r=this.anchors.get(t),a=this.anchors.get(i),o=this.findFreeIndex(r,a);if(-1===o){let e=this.nextAnchor(t);if(a.index<e){let t=a.index;for(;t<e;)t=this.nextAnchor(i)}o=e,r=this.anchors.get(t),a=this.anchors.get(i)}let l=r.indexes[o],h=a.indexes[o],c=l.x-h.x,d=l.y-h.y,u=Math.sqrt(c*c+d*d);n.setAttribute("x",Math.min(l.x,h.x)),n.setAttribute("y",l.y),n.setAttribute("width",u);let p=s.container.parentNode;p.setAttribute("width",u),this.svgArea.append(n);let m=s.container.getBoundingClientRect();p.setAttribute("height",m.height),n.setAttribute("height",m.height)},setChildAnchors(e,t,i,s){f(this.childAnchors)&&(this.childAnchors=new Map);let n,r,a=[],o=new Map;for(let e=0;e<this.patterns.length;e++)this.patterns[e]===t&&(n=e),this.patterns[e]===i&&(r=e);for(let e=Math.min(r,n);e<=Math.max(r,n);e++)a.push(this.patterns[e]);a.forEach((t=>{let i=this.anchors.get(t);o.set(t,{current:{x:i.indexes[e].x+(Math.max(r,n)-Math.min(r,n)+1)*i.next.x,y:i.indexes[e].y+(Math.max(r,n)-Math.min(r,n)+1)*i.next.y},next:i.next,index:0,free:[0],indexes:[{x:i.indexes[e].x+(Math.max(r,n)-Math.min(r,n)+1)*i.next.x,y:i.indexes[e].y+(Math.max(r,n)-Math.min(r,n)+1)*i.next.y}]})})),this.childAnchors.set(s,o)},place(){this.container.prepend(this.interactionsArea)},notifyValue(e){console.log(e);for(let t=0;t<this.waiting.length;t++)if(this.waiting[t].projection===e){let i=e.element.source.getAttributeByName(this.waiting[t].from).target.value,s=e.element.source.getAttributeByName(this.waiting[t].to).target.value;if(console.log(e.element.source),!f(i)&&!f(s))return this.waiting.splice(t,1),void this.joinSvgArea(e,i,s)}}},Nr=Object.assign({},Lr,Or);var Mr=0;const Rr=()=>"algo"+Mr++,_r={force:(e,t,i)=>Object.create(Sr,{object:{value:"algorithm"},name:{value:"force-algorithm"},type:{value:"force"},id:{value:Rr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}}),pattern:(e,t,i)=>Object.create(Nr,{object:{value:"algorithm"},name:{value:"pattern-algorithm"},type:{value:"pattern"},id:{value:Rr()},model:{value:e},schema:{value:t},projection:{value:i},source:{value:i.concept,writable:!0}})},Vr={createAlgo(e,t,i){const{type:s}=t,n=_r[s];if(f(n))throw new TypeError(`Missing handler: The '${s}' algo could not be handled`);const r=n(e,t,i);if(f(r))throw new Error(`Bad request: The '${s}' algo could not be created`);return r.createAlgo=this.createAlgo,f(r.id)&&(r.id=Rr()),r}};var Pr=0;const Tr={createProjection(e,t,i,s){var n=Object.create(Hr,{id:{value:r(t.id,"projection"+Pr++)},model:{value:e},schema:{value:t,writable:!0},environment:{value:s}});return n.concept=i,n}},Hr={handlers:null,init(e={}){return this.containers=new Map,this.attributes=[],this.params=[],this.templates=[],this.handlers={},this.args=e,this.concept.register(this),this},schema:null,concept:null,environment:null,parent:null,containers:null,placeholder:null,element:null,attributes:null,params:null,index:0,editing:!1,optional:!1,collapsible:!1,searchable:!1,focusable:!0,get hasMultipleViews(){return this.schema.length>1},get isReadOnly(){return r(this.getSchema().readonly,!1)},isRoot(){return f(this.parent)},getSchema(e){return this.schema[r(e,this.index)]},hasSchema(e){return-1!==this.schema.findIndex((t=>t.tags.includes(e)))},getContainer(e){return this.containers.get(r(e,this.index))},getStyle(){const{style:e}=this.getSchema();return e},addTemplate(e){this.templates.push(e)},addParam(e){this.params.push(...Array.isArray(e)?e:[e])},getParam(e,t){let i=this.params.find((t=>t.name===e));if(f(i))return;const{type:s="string",value:n}=i;let a=r(n,i.default);return f(a)?null:"string"===s?a.toString():"number"===s?+a:"boolean"===s?E(a):void 0},getParent(){return this.isRoot()?null:this.parent},getAttributes(e){return this.attributes.filter((t=>t.name===e))},getField(e){return this.environment.getField(e)},getStatic(e){return this.environment.getStatic(e)},getLayout(e){return this.environment.getLayout(e)},resolveElement(e){return this.environment.resolveElement(e)},getHandlers(e){return r(this.handlers[e],[])},update(e,t,i){if(a(this.containers))return;if("delete"===e)return void this.delete();const s=this.getHandlers(e);switch(a(s)||s.forEach((e=>{e(t,i)})),e){case"attribute.added":return void this.getAttributes(t.name).forEach((e=>{const{schema:i}=e,s=this.model.createProjection(t.target,i.tag).init();s.parent=this,s.optional=!0;const n=s.render();ts.call(this,n,i.style),s.element.parent=e.parent,e.element=n,e.placeholder&&(e.placeholder.after(n),Ye(e.placeholder))}));case"attribute.removed":return void this.getAttributes(t.name).forEach((e=>{e.element&&(Ie(e.element).remove(),e.element=null),e.placeholder&&Ue(e.placeholder)}))}},delete(){return this.concept&&this.concept.unregister(this),this.placeholder&&this.getContainer().after(this.placeholder),this.containers.forEach((e=>{if(Ie(e),L(e)&&e.remove(),"path"===e.tagName){console.log(e);let t=this.environment.resolveElement(e);console.log(t),t.projection.parent.removeArrow(t)}})),this.model.removeProjection(this.id),!0},registerHandler(e,t){return Array.isArray(this.handlers[e])||(this.handlers[e]=[]),this.handlers[e].push(t),!0},unregisterHandler(e,t){if(!y(this.handlers,e))return!1;for(let i=0;i<this.handlers[e].length;i++)if(this.handlers[e][i]===t)return this.handlers[e].splice(i,1),!0;return!1},focus(){this.element.focus()},render(){const e=this.getSchema();if(f(e))return null;const{type:t,projection:i,content:s,kind:n,sibling:o,rtags:l}=e;var h=null;if("layout"===t||"layout"===n)this.element=Cr.createLayout(this.model,r(i,s),this).init(this.args),this.model.registerLayout(this.element);else if("field"===t||"field"===n){let t=y(e,"field")?e.field:r(i,s);this.element=cn.createField(this.model,t,this).init(this.args),this.model.registerField(this.element)}else"static"===t||"static"===n?(this.element=Dn.createStatic(this.model,r(i,s),this).init(this.args),this.element.source=this.concept,this.model.registerStatic(this.element)):"dynamic"===t||"dynamic"===n?(this.element=Dn.createStatic(this.model,r(i,s),this).init(this.args),this.model.registerStatic(this.element)):"algorithm"===t?(this.element=Vr.createAlgo(this.model,r(i,s),this).init(this.args),this.model.registerAlgorithm(this.element)):(this.element=Wn(this.model,e.container,this).init(this.args),this.model.registerLayout(this.element));if(this.isRoot()&&(this.element.focusable=!0),this.focusable||(this.element.focusable=!1),this.readonly&&(this.element.readonly=!0),h=this.element.render(),"layout"!==t&&"container"!==t||gt(h),this.element.focusable||(h.tabIndex=-1),!j(h))throw new Error("Projection element container could not be created");if(h.classList.add("projection"),Object.assign(h.dataset,{projection:this.id,concept:this.concept.id,object:this.concept.object}),this.optional){let e=he({class:["btn","structure__btn-delete","projection__btn-delete"],title:`Delete ${this.concept.name}`,tabindex:-1,dataset:{action:"delete",projection:this.id}});e.addEventListener("click",(e=>{let t=this.getContainer(),i=Ce(t,(e=>0===e.tabIndex));this.environment.save(this.concept.getParent(),t.cloneNode(!0)),this.concept.delete();let s=this.environment.resolveElement(i);f(s)||s.focus()})),h.dataset.deletable=!0,h.prepend(e)}if(this.collapsible){let e=he({class:["btn","projection__btn-collapse"],title:`Collapse ${this.concept.name}`,tabindex:-1,dataset:{action:"collapse",projection:this.id}});e.addEventListener("click",(e=>{this.getContainer().classList.toggle("collapsed")})),h.dataset.collapsible=!0,h.prepend(e)}return this._style&&ts.call(this,h,this._style),this.containers.set(this.index,h),!o||f(o.tag)||f(o.receiver)||this.createSibling(this.concept,o),l&&!a(l)&&(this.rtags=l,this.environment.registerReceiver(this.element,l[0])),h},refresh(){this.editing?this.containers.forEach((e=>{e.tabIndex=0})):this.containers.forEach((e=>{e.tabIndex=null}))},createSibling(e,t){const{tag:i,receiver:s}=t;let n=this.model.createProjection(e,i).init();n.render();let r=this.environment.getActiveReceiver(s);n.parent=r,n.element.refresh()},changeView(e){if(!this.hasMultipleViews)return void this.environment.notify("There is no alternative projection for this concept");let t=this.getContainer();this.index=r(e,(this.index+1)%this.schema.length);let i=this.getContainer();L(i)||(this.params=[],i=this.render()),t.replaceWith(i),this.element=this.resolveElement(i),"svg"===this.element.type&&this.element.update();const s=this.getHandlers("view.changed");return a(s)||s.forEach((e=>e(i))),this.focus(),this},findView(e){if(!this.hasSchema(e)){if(!this.model.hasProjectionSchema(this.concept,e))return-1;let t=this.model.getProjectionSchema(this.concept,e);this.schema.push(...t)}return this.schema.findIndex((t=>t.tags.includes(e)))},export(){return{id:this.id,root:this.isRoot(),concept:{id:this.concept.id,name:this.concept.name}}},bindEvents(){}},Dr=[{concept:{name:"set"},type:"field",tags:[],content:{type:"list"}},{concept:{name:"boolean"},type:"field",tags:[],content:{type:"binary"}},{concept:{name:"string"},type:"field",tags:[],content:{type:"text"}},{concept:{name:"number"},type:"field",tags:[],content:{type:"text",input:{type:"number"}}},{concept:{name:"reference"},type:"field",tags:[],content:{type:"choice"}}];function $r(e,t){return Object.create(Br,{schema:{value:r(e,{projection:[],template:[],style:[]}),writable:!0},environment:{value:t}})}const Br={projections:null,fields:null,statics:null,layouts:null,algos:null,init(e){return this.projections=[],this.fields=new Map,this.statics=new Map,this.layouts=new Map,this.algos=new Map,this},addSchema(e){return Array.isArray(e.projection)&&this.schema.projection.push(...e.projection),Array.isArray(e.template)&&this.schema.template.push(...e.template),Array.isArray(e.style)&&this.schema.style.push(...e.style),this.environment.update("projection-model.updated"),!0},setSchema(e){return this.schema=[...e,...Dr],this.environment.update("projection-model.updated"),this},done(){for(;!a(this.projections);)this.projections[0].delete();return this.projections=[],this.fields.clear(),this.layouts.clear(),this.statics.clear(),this},createProjection(e,t){const i=this.getProjectionSchema(e,t);a(i)&&this.environment.notify(`Missing projection (#${t}) for ${e.name}`,Ze.WARNING);const s=Tr.createProjection(this,i,e,this.environment);return s.tag=t,this.addProjection(s),s},getProjections(){return this.projections.slice()},getProjection(e){return Number.isInteger(e)?this.projections[e]:this.projections.find((t=>t.id===e))},addProjection(e){if(f(e))throw new TypeError("Bad request: The 'projection' argument must be a Projection");return this.projections.push(e),this},removeProjection(e){var t=this.projections.findIndex((t=>t.id===e));return-1!==t&&(this.projections.splice(t,1),!0)},registerField(e){return e.environment=this.environment,this.fields.set(e.id,e),this},unregisterField(e){var t=this.fields.get(e.id);return t&&(t.environment=null,this.fields.delete(t.id)),this},getField(e){return this.fields.get(e)},registerStatic(e){return e.environment=this.environment,this.statics.set(e.id,e),this},unregisterStatic(e){var t=this.statics.get(e.id);return t&&(t.environment=null,this.statics.delete(t.id)),this},getStatic(e){return this.statics.get(e)},registerLayout(e){return e.environment=this.environment,this.layouts.set(e.id,e),this},unregisterLayout(e){var t=this.layouts.get(e.id);return t&&(t.environment=null,this.layouts.delete(t.id)),this},getLayout(e){return this.layouts.get(e)},registerAlgorithm(e){return e.environment=this.environment,this.algos.set(e.id,e),this},unregisterAlgorithm(e){var t=this.algos.get(e.id);return t&&(t.environment=null,this.algos.delete(t.id)),this},getAlgo(e){return this.algos.get(e)},getMetadata(e){let t=this.schema.find((t=>t.id===e));return t?t.metadata:null},hasConceptProjection(e,t){let i=null;return i=l(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((t=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||!f(i=t.concept.prototype)&&"prototype"!==e.nature&&e.hasPrototype(i);var i})),d(t)&&!a(t)?-1!==i.findIndex((e=>(e=>Array.isArray(e.tags)&&e.tags.includes(t))(e))):!a(i)},getSchema(){return this.schema},getProjectionSchema(e,t){if(f(e))throw new TypeError("Bad parameter: concept");var i=null;return i=l(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((t=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||!f(i=t.concept.prototype)&&"prototype"!==e.nature&&e.hasPrototype(i);var i})),d(t)&&!a(t)?i.filter((e=>e.tags&&e.tags.includes(t))):i},getTemplateSchema(e){let t=this.schema.template.find((t=>t.name===e));return f(t)?null:ft(t)},getGFragmentSchema(e){let t=this.schema.find((t=>"g-fragment"===t.type&&t.name===e));return f(t)?null:ft(t)},getRuleSchema(e){let t=this.schema.find((t=>"rule"===t.type&&t.name===e));return f(t)?null:ft(t)},getStyleSchema(e){let t=this.schema.style.find((t=>t.name===e));return f(t)?null:ft(t)},hasProjectionSchema(e,t){if(f(e))throw new TypeError("Bad parameter: concept");let i=[];return i=l(e)?this.schema.projection.filter((t=>t.concept.name===e)):this.schema.projection.filter((t=>{return(t=>t&&(t===e.name||e.schema&&t===e.schema.base))(t.concept.name)||!f(i=t.concept.prototype)&&"prototype"!==e.nature&&e.hasPrototype&&e.hasPrototype(i);var i})),d(t)&&!a(t)?i.some((e=>e.tags&&e.tags.includes(t))):!a(i)},export(){const e=[];return this.getProjections().forEach((t=>{e.push(t.export())})),e}},zr={unloadAllConcept(){return this.hasConceptModel&&(this.conceptModel.done(),this.conceptModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-concept@post"}),this},unloadAllProjection(){return this.hasProjectionModel&&(this.projectionModel.done(),this.projectionModel=null,this.refresh()),this.triggerEvent({name:"editor.unload-projection@post"}),this},loadSession(){this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)}))},loadConcept(e,t){let i=e.concept||e,s=e.values;return Array.isArray(i)?a(i)?(this.notify("The concept schema is empty",Ze.ERROR),!1):(f(this.conceptModel)&&(this.conceptModel=Ki.createModel(null,this).init()),this.conceptModel.addConceptSchema(i),this.conceptModel.init(s),this.triggerEvent({name:"editor.load-concept@post",args:[t,JSON.stringify(e)]}),this.refresh(),this):(this.notify("Invalid concept schema",Ze.ERROR),!1)},loadConcepts(e){return Array.isArray(e)?a(e)?(this.notify("The concept schema is empty",Ze.ERROR),!1):(f(this.conceptModel)&&(this.conceptModel=Ki.createModel(null,this).init()),e.forEach((e=>{this.conceptModel.addConceptSchema(e)})),this.refresh(),this):(this.notify("Invalid concept schema",Ze.ERROR),!1)},loadProjection(e,t){return this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,f(this.projectionModel)&&(this.projectionModel=$r(e,this).init()),this.projectionModel.addSchema(e),f(this.projectionModel),this.instances.forEach((e=>{e.projection=this.projectionModel.createProjection(e.concept).init(),e.render()})),this.triggerEvent({name:"editor.load-projection@post",args:[t,JSON.stringify(e)]}),this.refresh(),this},loadProjections(e){return Array.isArray(e)?a(e)?(this.notify("The concept schema is empty",Ze.ERROR),!1):(this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,f(this.projectionModel)&&(this.projectionModel=$r(null,this).init()),e.forEach((e=>{this.projectionModel.addSchema(e)})),this.refresh(),this):(this.notify("Invalid concept schema",Ze.ERROR),!1)},load(e,t){let i=e.type;if(m(i)){let t=e.name.indexOf(".")+1;i=e.name.substring(t)}else i=et[i];"jsoncp"===i&&"json"===i||this.addResource(e,t);let s=new FileReader;return s.onload=e=>{const i=JSON.parse(s.result),{type:n}=i;"concept"===n?this.loadConcept(i,t):"projection"===n?this.loadProjection(i,t):"model"===n&&(this.loadConcept(i.concept,"model"),this.loadProjection(i.projection,"model"))},s.readAsText(e),!0},unload(){return this.unloadAllConcept(),this.unloadAllProjection(),this.clear(),this}},qr={getField(e){if(!L(e))return console.warn("Field error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return f(t)?(console.warn("Field error: Missing id attribute on field"),null):["field","field-component"].includes(i)?this.projectionModel.getField(t):(console.warn("Field error: Unknown nature attribute on field"),null)},getStatic(e){if(!L(e))return console.warn("Static error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return f(t)?(console.warn("Static error: Missing id attribute on field"),null):["static","static-component"].includes(i)?this.projectionModel.getStatic(t):(console.warn("Static error: Unknown nature attribute on field"),null)},getLayout(e){if(!L(e))return console.warn("Layout error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return f(t)?(console.warn("Layout error: Missing id attribute on field"),null):["layout","layout-component"].includes(i)?this.projectionModel.getLayout(t):(console.warn("Layout error: Unknown nature attribute on field"),null)},getAlgo(e){if(!L(e))return console.warn("Algorithm error: Bad argument"),null;const{id:t,nature:i}=e.dataset;return f(t)?(console.warn("Algorithm error: Missing id attribute on field"),null):["algorithm","algorithm-component"].includes(i)?this.projectionModel.getAlgo(t):(console.warn("Layout error: Unknown nature attribute on field"),null)},resolveElement(e){if(!L(e))return null;const{nature:t}=e.dataset;if(f(t))return null;let i=null;switch(t){case"field":case"field-component":i=this.getField(e);break;case"layout":case"layout-component":i=this.getLayout(e);break;case"static":case"static-component":i=this.getStatic(e);break;case"algorithm":i=this.getAlgo(e)}return i&&(i.environment=this),i}};var Fr=0;const Wr={createState(e,t){const{id:i,name:s}=e;let n="value"+Fr++,r=JSON.stringify(e.clone()),a=(b(new Date,"hh:dd"),ie({class:["ico","ico-delete"]},"✖")),o=he({class:["btn","btn-delete"],title:`Delete ${s} state`},a),l=W({class:["model-state-preview"],title:`Preview ${s}`},t),h=Q({class:["model-state-content","fit-content"]},`${e.getName()}`),c=J({class:["model-state"],title:`Restore ${s} state`,dataset:{id:n,concept:i}},[o,h,l]);c.addEventListener("click",(e=>{let t=function(e){const t=e=>e===c||e===o;return t(e)?e:Ce(e,(e=>t(e)),5)}(e.target);if(this.unhighlight(),t===o)this.removeState(n);else{let e=this.restore(r);this.removeState(n);let t=we(`.projection[data-concept="${e.id}"]`,this.body);t&&t.focus()}}));let d=`.projection[data-concept="${i}"]`;if(c.addEventListener("mouseenter",(e=>{let t=we(d,this.body);t&&this.highlight(t)})),c.addEventListener("mouseleave",(e=>{this.unhighlight()})),this.states.length>8){let{id:e}=this.stateList.lastChild.dataset;this.removeValue(e)}let u=Object.create({},{id:{value:n},object:{value:"value"},type:{value:"state"},element:{value:c},concept:{value:e},value:{value:r}});return this.addState(u),u},getState(e){if(!f(e)&&!a(this.states))return this.states[e]},addState(e){return this.stateList.append(e.element),this.states.push(e),this.refresh(),e},removeState(e){if(f(e))return;const t=this.states.findIndex((t=>t.id===e));if(-1===t)return null;let i=this.states.splice(t,1)[0],{element:s}=i;return Ie(s).remove(),this.refresh(),this}};var Ur=0;const Yr={conceptModel:null,projectionModel:null,concept:null,activeConcept:null,activeProjection:null,activeInstance:null,container:null,header:null,body:null,instanceSection:null,designSection:null,navigationSection:null,valueWindow:null,valueList:null,breadcrumb:null,filter:null,home:null,style:null,logs:null,status:null,group:null,input:null,copyValue:null,states:null,activeElement:null,decoratedElements:null,config:null,active:!1,visible:!1,frozen:!1,handlers:null,actions:null,attached:null,instances:null,windows:null,values:null,resources:null,models:null,errors:null,init(e={}){const{conceptModel:t,projectionModel:i,toolbar:s=[],config:n={},handlers:r={},actions:a={}}=e;this.config=Object.assign({},n),this.handlers=new Map,this.actions=new Map,this.attached=[],this.instances=new Map,this.windows=new Map,this.values=new Map,this.resources=new Map,this.models=new Map,this.errors=[],Object.assign(this,_t,Tt),this.states=[],this.decoratedElements=new Set;for(const e in r){const t=r[e];this.registerHandler(e,t)}return this.header=Bt.call(this).init(),this.home=qt.call(this).init(),this.breadcrumb=zt.call(this).init(),this.logs=Wt.call(this).init(),this.status=Ft.call(this).init(),this.render(),Array.isArray(t)?this.loadConcepts(t):t&&this.loadConcept(t),Array.isArray(i)?this.loadProjections(i):i&&this.loadProjection(i),this.isReady?(this.conceptModel.getRootConcepts().forEach((e=>{this.createInstance(e)})),this.open()):(this.home.open(),this.refresh()),this},setConfig(e){return!f(e)&&(this.config=e,this.refresh(),this)},getConfig(e){return f(e)?this.config:this.config[e]},getName(){return r(this.config.name,`editor${(new Date).getTime()}`)},createConcept(e){if(f(e))throw new TypeError("Missing argument: The 'name' is required to create a concept");return this.conceptModel.isConcept(e)?this.conceptModel.createConcept(e):(this.notify(`The concept '${e}' is not defined in the model`,Ze.ERROR),!1)},addConcept(e){let t=e.concept||e;Array.isArray(t)?this.conceptModel.schema.push(...t):this.conceptModel.schema.push(t),this.refresh()},createProjection(e,t){if(f(e))throw new TypeError("Missing argument: The 'concept' is required to create a projection");return this.projectionModel.hasConceptProjection(e,t)?this.projectionModel.createProjection(e,t).init():(this.notify(`The projection for the concept '${e.name}' is not defined in the model`,Ze.ERROR),!1)},addProjection(e){Array.isArray(e)?this.projectionModel.schema.projection.push(...e):this.projectionModel.addSchema(e),this.refresh()},download(e,t,i){const s="application/jsoncp";window.URL=window.webkitURL||window.URL;var n=X({class:["bare-link","download-item__link"]},"Download");m(n.href)||window.URL.revokeObjectURL(n.href);var a=new Blob([JSON.stringify(e)],{type:s});return Object.assign(n,{download:`${r(t,(new Date).getTime())}.jsoncp`,href:window.URL.createObjectURL(a)}),n.dataset.downloadurl=[s,n.download,n.href].join(":"),n.click(),setTimeout((()=>{window.URL.revokeObjectURL(n.href),n.remove()}),1500),e},export(e=!1){const t="application/jsoncp";window.URL=window.webkitURL||window.URL;var i=X({});this.container.append(i),m(i.href)||window.URL.revokeObjectURL(i.href);const s={concept:this.conceptModel.schema,values:this.conceptModel.export(),editor:this.config};var n=new Blob([JSON.stringify(s)],{type:t});return Object.assign(i,{download:"model.jsoncp",href:window.URL.createObjectURL(n)}),console.log(n.type),i.dataset.downloadurl=[t,i.download,i.href].join(":"),e?(Se(JSON.stringify(s)),this.notify("The model has been copied to clipboard",Ze.SUCCESS)):(i.click(),this.notify("The model has been downloaded",Ze.SUCCESS)),setTimeout((()=>{window.URL.revokeObjectURL(i.href),i.remove()}),1500),s},save(e,t){this.createState(e,t),this.refresh()},restore(e){let t=JSON.parse(e),i=this.conceptModel.getConcept(t.id);return i.restore(t),this.refresh(),i},undo(){if(a(this.states))return void this.notify("There are no previous state",Ze.NORMAL,2e3);let e=function(e){if(!Array.isArray(e))throw new TypeError("Bad argument");if(!a(e))return e[e.length-1]}(this.states);this.restore(e.value),this.removeState(e.id)},notify(e,t,i=4500){let s=U({class:["notify"],html:e});const n="open";t&&s.classList.add(t),this.container.append(s),setTimeout((()=>{s.classList.add(n)}),50),setTimeout((()=>{s.classList.remove(n),setTimeout((()=>{s.remove()}),500)}),i)},addResource(e,t){let i=r(t,e.name.split(".")[0]);this.resources.set(i,e);let s=new FileReader;return s.onload=e=>{this.addModel(i,s.result)},s.readAsText(e),this.refresh(),e},getResource(e){return this.resources.get(e)},hasResource(e){return this.resources.has(e)},removeResource(e){return this.resources.delete(e),this.triggerEvent({name:"resource.removed"}),this.refresh(),!0},addError(e){return this.errors.push(e),this.refresh(),Je(this.status.editorstatusBadge),e},removeError(e){return this.errors.pop(),this.refresh(),!0},clearError(e){return this.errors=[],this.refresh(),!0},getModel(e){let t=this.models.get(e);return f(t)?null:JSON.parse(t)},addModel(e,t){this.models.set(e,t)},removeModel(e){return this.triggerEvent({name:"model.remove@pre",args:[e]},(()=>{this.models.delete(e),this.refresh(),this.triggerEvent({name:"model.remove@post"})}),!1),!0},hasModel(e){return this.models.has(e)},getValue(e){if(this.values.has(e))return this.values.get(e)},addValue(e){let t="value"+Ur++,i=ie({class:["ico","ico-copy"]}),s=ie({class:["ico","ico-delete"]},"✖"),n=he({class:["btn","btn-copy","fit-content"],title:`Copy ${e.name}`},[i,e.name]),r=he({class:["btn","btn-delete"]},s),a=J({class:["model-value"],dataset:{id:t}},[n,r]);if(n.addEventListener("click",(t=>{this.copy(e)})),r.addEventListener("click",(e=>{this.removeValue(t)})),this.values.size>5){let{id:e}=this.valueList.lastChild.dataset;this.removeValue(e)}return this.valueList.prepend(a),this.values.set(t,{element:a,value:e}),this.refresh(),e},removeValue(e){if(f(e)||!this.values.has(e))return;let{element:t}=this.values.get(e);return Ie(t).remove(),this.values.delete(e),this.refresh(),this},copy(e,t=!1){return f(e)||(this.copyValue=e,Se(JSON.stringify(e)),t&&this.addValue(e),this.notify(`${e.name} copied`,Ze.NORMAL)),this},paste(e,t){let i=r(t,this.copyValue);if(!f(i)){if(f(e)){let e=this.createConcept(i.name).init();e.setValue(i),this.createInstance(e)}else"prototype"===i.nature?e.setValue(i.value):e.setValue(i);return this}},show(){return this.triggerEvent({name:"editor.show@pre"},(()=>{Ue(this.container),this.attached.forEach((e=>e.show())),this.visible=!0,this.triggerEvent({name:"editor.show@post"})}),!1),this},hide(){return this.triggerEvent({name:"editor.hide@pre"},(()=>{Ye(this.container),this.attached.forEach((e=>e.hide())),this.visible=!1,this.triggerEvent({name:"editor.hide@post"})}),!1),this},toggle(){return this.triggerEvent({name:"editor.toggle@pre"},(()=>{Ge(this.container),this.visible=!this.visible,this.triggerEvent({name:"editor.toggle@post"})}),!1),this},open(){return this.triggerEvent({name:"editor.open@pre"},(()=>{this.show(),this.active=!0,this.isReady&&this.home.close(),this.triggerEvent({name:"editor.open@post"})}),!1),this},close(){return this.triggerEvent({name:"editor.close@pre"},(()=>{this.hide(),this.active=!1,this.done(),this.clear(),this.triggerEvent({name:"editor.close@post"})}),!1),this},destroy(){return this.triggerEvent({name:"editor.destroy@pre"},(()=>{this.hide(),this.done(),this.instances.forEach((e=>e.delete())),Ie(this.container).remove()}),!1),!0},freeze(){return this.triggerEvent({name:"editor.freeze@pre"},(()=>{this.frozen=!0,this.refresh(),this.triggerEvent({name:"editor.freeze@post"})}),!1),this},unfreeze(){return this.frozen=!1,this.refresh(),this},done(){return this.conceptModel&&this.conceptModel.done(),this.projectionModel&&this.projectionModel.done(),this},highlight(e){return L(e)?(function(e){L(e)&&e.classList.add(qe)}(e),this.decoratedElements.add(e),this):this},unhighlight(e){return L(e)?(Xe(e),this.decoratedElements.delete(e),this):(this.decoratedElements.forEach((e=>Xe(e))),this.decoratedElements.clear(),this)},createWindow(){let e=W({class:["editor-window"],tabindex:0});this.body.append(e)},clear(){return this.triggerEvent({name:"editor.clear@pre"},(()=>{this.instances.forEach((e=>e.delete())),this.instances.clear(),this.resources.clear(),this.models.clear(),this.states.forEach((e=>e.element.remove())),this.states=[],this.activeElement=null,this.activeInstance=null,this.activeConcept=null,this.activeProjection=null,this.refresh(),this.triggerEvent({name:"editor.clear@post"})}),!1),this},update(e,t,i){this.triggerEvent({name:e})},attach(e){this.attached.push(e)},detach(e){let t=this.attached.findIndex((t=>t===e));if(-1===t)return null;this.attached.splice(t,1)},render(e){const t=H();if(this.home.isRendered||t.append(this.home.render()),this.header.isRendered||t.append(this.header.render()),L(this.navigationSection)||(this.navigationSection=$({class:["model-navigation-section"]}),this.viewSection=B({class:["model-view-section"]}),this.navigationSection.append(this.viewSection),t.append(this.navigationSection)),!L(this.body)){this.body=W({class:["editor-body"],tabindex:0});let e=W({class:["editor-body-main"],tabindex:0});this.instanceSection=$({class:["model-concept-section"]}),e.append(this.instanceSection),this.body.append(e),t.append(this.body)}return L(this.timeline)||(this.timeline=W({class:["editor-timeline"]}),this.stateList=G({class:["bare-list","model-state-list"]}),this.timeline.append(this.stateList),t.append(this.timeline)),this.logs.isRendered||t.append(this.logs.render()),this.breadcrumb.isRendered||this.navigationSection.append(this.breadcrumb.render()),L(this.valueSection)||(this.valueSection=W({class:["model-value-window"]}),this.valueList=G({class:["bare-list","model-value-list"]}),this.valueSection.append(this.valueList),this.navigationSection.append(this.valueSection)),this.status.isRendered||t.append(this.status.render()),L(this.input)||(this.input=se({type:"file",class:["hidden"],accept:".json,.jsoncp"}),t.append(this.input)),t.hasChildNodes()&&(this.container.append(t),this.bindEvents()),L(e)&&e.append(this.container),this.refresh(),this.container},refresh(e=!1){return this.frozen&&!e||(this.home.isOpen?this.container.classList.add("unfocus"):this.container.classList.remove("unfocus"),this.hasValues?Ue(this.valueWindow):Ye(this.valueWindow),this.header.refresh(),this.breadcrumb.refresh(),this.home.refresh(),this.logs.refresh(),this.status.refresh(),this.instanceSection.dataset.view=this.status.view,["grid"].includes(this.status.view)?Ye(this.viewSection):["tab"].includes(this.status.view)&&Ue(this.viewSection),a(this.states)?Ye(this.timeline):(Ue(this.timeline),this.states.forEach((e=>{this.conceptModel.hasConcept(e.concept.id)?this.hasActiveConcept&&this.activeConcept===e.concept?e.element.classList.add("active"):e.element.classList.remove("active"):this.removeState(e.id)})))),this},updateActiveElement(e){return this.activeElement&&this.activeElement===e||(this.activeElement=e,this.triggerEvent({name:"editor.element@active:updated"})),this},updateActiveConcept(e){return this.hasActiveConcept&&this.activeConcept===e||(this.activeConcept=e,this.triggerEvent({name:"editor.concept@active:updated"}),this.refresh()),this},updateActiveProjection(e){if(this.activeProjection&&this.activeProjection===e)return this;let t=xe(".active-parent",this.body);for(let e=0;e<t.length;e++)t[e].classList.remove("active-parent");this.activeProjection=e;let i=this.activeProjection.parent;for(;i;)i.getContainer().classList.add("active-parent"),i=i.parent;return this.triggerEvent({name:"editor.projection@active:updated"}),this.refresh(),this},updateActiveInstance(e){if(this.activeInstance){if(this.activeInstance===e)return this;this.activeInstance,this.activeInstance.container.classList.remove("active")}return this.activeInstance=e,this.activeInstance.container.classList.add("active"),this.triggerEvent({name:"editor.instance@active:updated"}),this.refresh(),this},bindEvents(){var e=null,t=null;const i={open:e=>{const{context:t}=e.dataset;t?this[t].open():this.open()},close:e=>{const{context:t,id:i,type:s}=e.dataset;t?this[t].close():this.close()},collapse:e=>{const{rel:t,target:i}=e.dataset;if("parent"===t){let t=Ce(e,(e=>e.dataset.name===i));if(L(t)){const{alias:i=""}=t.dataset;t.classList.toggle("collapsed");let s=t.classList.contains("collapsed");e.dataset.state=s?"ON":"OFF",e.title=s?`Expand ${i.toLowerCase()}`:`Collapse ${i.toLowerCase()}`}}},delete:e=>{const{target:t}=e.dataset;if("parent"===t){let t=e.parentElement;Ie(t),t.remove()}},"delete:value":e=>{const{id:t}=e.dataset;this.conceptModel.removeValue(t),this.header._valueSelector.update()},"delete:resource":e=>{const{id:t}=e.dataset;this.removeResource(t)},"change-view":e=>{const{value:t}=e.dataset;this.status.changeView(t)},"add-group":e=>{this.status.addGroup()},style:e=>{this.style.toggle()},home:e=>{this.home.toggle()},logs:e=>{this.logs.toggle()},export:e=>{this.export()},"export--copy":e=>{this.export(!0)},"create-instance":e=>{const{concept:t}=e.dataset;let i=this.createConcept(t);this.createInstance(i)},"create-instance:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t),s=this.createConcept(i.name);s.initValue(i),this.createInstance(s)},"copy:value":e=>{const{id:t}=e.dataset;let i=this.conceptModel.getValue(t);this.copy(i)},save:e=>{this.save()},undo:e=>{this.undo()},load:e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},unload:e=>{this.unload()},"load-concept":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-concept":e=>{this.unloadAllConcept()},"download-concept":e=>{const{schema:t,values:i}=this.conceptModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({concept:t},`${s}_model`)},"load-projection":e=>{let t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.input.dispatchEvent(t)},"unload-projection":e=>{this.unloadAllProjection()},"download-projection":e=>{const{schema:t,views:i}=this.projectionModel;let s=this.getName().toLowerCase().replace(/\s+/g," ").replace(" ","_");this.download({projection:t},`${s}_projection`)}},s={[Ke.up_arrow]:"up",[Ke.right_arrow]:"right",[Ke.down_arrow]:"down",[Ke.left_arrow]:"left"};this.container.addEventListener("click",(e=>{var t=function(e){const t=e=>!y(e.dataset,"ignore");return t(e)?e:Ce(e,t,10)}(e.target);const{action:s,context:n,id:r}=t.dataset;if("instance"===n)return void this.getInstance(r).actionHandler(s);if("menu"===n)return void this.home.actionHandler(s,t);if(this.activeElement&&this.activeElement.clickHandler(t),f(s))return;if(this.actions.has(s))return console.warn(s),this.actions.get(s).call(this,t),void t.blur();const a=i[s];h(a)?(a(t),t.blur()):s&&this.triggerEvent({name:s})}),!0),this.input.addEventListener("change",(e=>{let i=this.input.files[0];this.load(i,t),this.input.value=""})),this.body.addEventListener("copy",(e=>{if(!st(e.target)){let t=this.activeConcept.copy(!1);this.copy(t,!0),e.preventDefault()}})),this.body.addEventListener("keydown",(t=>{const{target:i}=t,{nature:n}=i.dataset;var r=!1;switch(t.key){case Ke.backspace:this.activeElement&&e!==Ke.ctrl&&!0===this.activeElement.backspaceHandler(i)&&t.preventDefault();break;case Ke.ctrl:case Ke.shift:t.preventDefault(),r=!0;break;case Ke.delete:this.activeElement&&e!==Ke.ctrl&&!st(i)&&this.activeElement.deleteHandler(i)&&t.preventDefault();break;case Ke.spacebar:this.activeElement&&e!==Ke.ctrl&&this.activeElement.spaceHandler(i)&&t.preventDefault();break;case Ke.alt:t.preventDefault();break;case Ke.enter:this.activeElement?!0===this.activeElement.enterHandler(i)&&t.preventDefault():"concept-container"===n?this.activeInstance.projection.focus():"editable"===n?i.blur():"BUTTON"===i.tagName?(i.click(),t.preventDefault()):t.preventDefault();break;case Ke.escape:this.activeElement&&(!0===this.activeElement.escapeHandler(i)?t.preventDefault():Ce(i,(e=>0===e.tabIndex)).focus());break;case Ke.insert:this.activeElement&&t.preventDefault();break;case Ke.up_arrow:case Ke.right_arrow:case Ke.down_arrow:case Ke.left_arrow:if(this.activeElement&&![Ke.ctrl,Ke.shift,Ke.alt].includes(e))!0===this.activeElement.arrowHandler(s[t.key],i)&&t.preventDefault();else if("concept-container"===n&&![Ke.ctrl,Ke.shift,Ke.alt].includes(e)){let e=ht(i,s[t.key],this.instanceSection);if(!L(e))return!1;e.focus()}break;case"s":e===Ke.ctrl&&(this.activeConcept.copy(),this.header.valueCount++,this.refresh(),t.preventDefault());break;case"c":if(e===Ke.ctrl){let e=new ClipboardEvent("copy");this.body.dispatchEvent(e)}break;case"v":if(e===Ke.ctrl){if(st(i))return;this.paste(this.activeConcept,this.copyValue)}break;case"e":e===Ke.ctrl&&this.activeConcept&&(this.createInstance(this.activeConcept,this.activeProjection,{type:"projection",close:"DELETE-PROJECTION"}),t.preventDefault());break;case"f":break;case"z":e===Ke.ctrl&&(st(i)||(this.undo(),t.preventDefault()))}r&&(e=t.key)}),!1),this.body.addEventListener("keyup",(t=>{var i=t.target;const{nature:n}=i.dataset;switch(t.key){case Ke.spacebar:this.activeElement&&e===Ke.ctrl&&this.activeElement._spaceHandler(i);break;case Ke.delete:this.activeElement&&e===Ke.ctrl&&this.activeElement.delete(i);break;case Ke.alt:break;case Ke.up_arrow:case Ke.down_arrow:case Ke.right_arrow:case Ke.left_arrow:if(this.activeElement&&e===Ke.ctrl)!0===this.activeElement._arrowHandler(s[t.key],i)&&t.preventDefault();else if("concept-container"===n&&e===Ke.ctrl){let n=ht(i,s[t.key],this.instanceSection);if(!L(n))return!1;this.swapInstance(i,n,!0),i.focus(),e=Ke.ctrl}}e===t.key&&(e=-1)}),!1),this.body.addEventListener("focusin",(t=>{const{target:i}=t,s=this.resolveElement(i);if(e=-1,s?(this.activeElement&&this.activeElement!==s&&(this.activeElement.focusOut(),this.activeElement=null),this.updateActiveElement(s),this.activeElement.focusIn(i)):(this.activeElement&&this.activeElement.focusOut(i),this.activeElement=null),this.activeElement){let e=this.activeElement.projection;this.updateActiveProjection(e),this.updateActiveConcept(e.concept)}else this.activeConcept=null,this.activeProjection=null;this.refresh()})),this.registerHandler("export",(()=>this.export())),this.registerHandler("value.changed",(()=>this.refresh())),this.registerHandler("value.added",(()=>this.refresh())),this.registerHandler("value.removed",(()=>this.refresh())),this.registerHandler("load-resource",(e=>{let i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t=e[0],this.input.dispatchEvent(i)}))}},Gr=Object.assign(Wr,zr,qr,Ut,Yr);Object.defineProperty(Gr,"hasConceptModel",{get(){return!f(this.conceptModel)}}),Object.defineProperty(Gr,"hasProjectionModel",{get(){return!f(this.projectionModel)}}),Object.defineProperty(Gr,"hasInstances",{get(){return this.instances.size>0}}),Object.defineProperty(Gr,"hasWindows",{get(){return this.windows.size>0}}),Object.defineProperty(Gr,"hasValues",{get(){return this.values.size>0}}),Object.defineProperty(Gr,"isReady",{get(){return this.hasConceptModel&&this.hasProjectionModel}}),Object.defineProperty(Gr,"hasActiveConcept",{get(){return!f(this.activeConcept)}}),Object.defineProperty(Gr,"hasActiveProjection",{get(){return!f(this.activeProjection)}}),Object.defineProperty(Gr,"hasActiveInstance",{get(){return!f(this.activeInstance)}}),Object.defineProperty(Gr,"hasError",{get(){return!a(this.errors)}});const Jr="editor",Xr=i(787),Kr=i(498),Zr=i(353),Qr=i(369),ea=i(82),ta=i(140),ia=i(871),sa=i(145),na=i(528),ra=i(297);i(538);let aa=function(e){const t=mt(".app-editor"),i=(e=>L(e)&&y(e.dataset,"gentleman"))(t)?[t]:xe('[data-gentleman="editor"]',t),s=[];return i.forEach((e=>{s.push(function(e){let t=mt(e);return L(e)||(t=W({tabindex:-1})),t.classList.add("gentleman-editor"),t.dataset.gentleman=Jr,Object.create(Gr,{object:{value:"environment"},type:{value:Jr},name:{value:"gentleman editor"},container:{value:t}})}(e))})),s}()[0];aa.init({config:{header:!1},conceptModel:[Xr,Zr,ea],projectionModel:[Qr,Kr,ta,ia]});const oa={general:"general",people:"people",projects:"project",tools:"tool"},la={general:"General information",people:"Members",projects:"Funded projects",tools:"Tools"},ha={editorInstance:null,organization:null,container:null,menu:null,items:null,views:null,selectedItem:null,init(e,t){return this.container=e,this.items=new Map,this.views=new Map,this.editor=t,this.bindDOM(),this.bindEvents(),this.render(),this},get hasSelectedItem(){return L(this.selectedItem)},getItemName:e=>L(e)?e.dataset.cmsName:null,refresh(){this.container.dataset.item=this.hasSelectedItem?this.getItemName(this.selectedItem):""},render(){return this.instance||(this.organization=this.editor.createConcept("research-organization"),this.editorInstance=this.editor.createInstance(this.organization),this.editorInstance.changeSize("fullscreen"),this.selectItem("general"),this.refresh()),this},fetchData(){let e=this.organization.getAttribute("members").getTarget(),t=this.organization.getAttribute("projects").getTarget();this.organization.getAttribute("name").setValue(sa.name),this.organization.getAttribute("description").setValue(sa.description),this.organization.getAttribute("phone").setValue(sa.phone),this.organization.getAttribute("website").setValue(sa.website),this.organization.getAttribute("email").setValue(sa.email);let i=this.organization.getAttribute("socials").getTarget();for(const e in sa.socials){const t=sa.socials[e];let s=aa.createConcept("social");s.getAttribute("name").setValue(e),s.getAttribute("handle").setValue(t),i.addElement(s)}na.forEach((t=>{let i=aa.createConcept("person");const[s,n]=t.name.split(",");i.getAttribute("first-name").setValue(n),i.getAttribute("last-name").setValue(s),i.getAttribute("occupation").setValue(t.position),i.getAttribute("website").setValue(t.website),i.getAttribute("email").setValue(t.email),i.getAttribute("phone").setValue(t.phone),i.getAttribute("photo").setValue(t.photo),e.addElement(i)})),ra.forEach((e=>{let i=aa.createConcept("project");const{name:s,description:n,startYear:r,endYear:a,funding:o,logo:l}=e;i.getAttribute("name").setValue(s),i.getAttribute("description").setValue(n),i.getAttribute("start-date").setValue(r),i.getAttribute("end-date").setValue(a),i.getAttribute("funding").setValue(o),i.getAttribute("logo").setValue(l);let h=i.getAttribute("partners").getTarget();e.partners.forEach((e=>{let t=aa.createConcept("partner");t.getAttribute("name").setValue(e),h.addElement(t)})),t.addElement(i)}))},selectItem(e){if(f(e))return!1;if(!this.items.has(e))return!1;let t=this.items.get(e);return t===this.selectedItem||(this.selectedItem&&this.selectedItem.classList.remove("selected"),this.selectedItem=t,this.selectedItem.classList.add("selected"),this.updateView()),this},updateView(){let e=this.getItemName(this.selectedItem);if(f(e)||!y(oa,e))return;let t=oa[e],i=this.editorInstance.projection,s=i.findView(t);if(-1===s)return!1;i.changeView(s),this.editorInstance.setTitle(`GEODES – ${la[e]}`),this.refresh()},bindDOM(){this.menu=we('[data-cms="menu"]'),xe('[data-cms="menu-item"]',this.menu).forEach((e=>{const{cmsName:t}=e.dataset;this.items.set(t,e)}))},bindEvents(){const e=e=>L(e)&&"menu-item"===e.dataset.cms;this.menu.addEventListener("click",(t=>{let i=(s=t.target,e(s)?s:Ce(s,e,3));var s;L(i)&&this.selectItem(this.getItemName(i))}))}};ha.init(we(".page-body"),aa),ha.fetchData()})()})();